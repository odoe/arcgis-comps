import { fy as p, fz as u, S, r, s, aF as F, t, K as p$1, e, d as d$1, i } from './index.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const m="analysis-view-handles";let w=class extends(p(u)){constructor(e){super(e),this.type="analysis-3d",this.allAnalysisViews=new S,this._creatingViewCount=0,this._analysisViewCreationTasks=new Map,this._analysisModules={"area-measurement":{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}};}initialize(){for(const e of this.layer.analyses)this._createAnalysisView(e);this.handles.add([this.layer.analyses.on("after-add",(e=>{this._createAnalysisView(e.item);})),this.layer.analyses.on("after-remove",(e=>{const s=this.allAnalysisViews.removeAt(this.allAnalysisViews.findIndex((s=>s.analysis===e.item)));r(s)&&s.destroy();const i=this._analysisViewCreationTasks.get(e.item);r(i)&&(i.abort(),this._analysisViewCreationTasks.delete(e.item));}))],m);}destroy(){this.handles.remove(m),this.allAnalysisViews.drain((e=>e.destroy())),this._analysisViewCreationTasks.clear(),this._creatingViewCount=0;}whenAnalysisView(e){const s$1=this._analysisViewCreationTasks.get(e);if(r(s$1))return s$1.promise;const t=new s("layerview:no-analysisview-for-analysis","The analysis has not been added to the AnalysisLayer of this layer view",{analysis:e});return Promise.reject(t)}isUpdating(){return 0!==this._creatingViewCount||this.allAnalysisViews.some((e=>e.updating))}_createAnalysisView(e){this._analysisViewCreationTasks.set(e,F((s=>this._createAnalysisViewPromise(e,s))));}async _createAnalysisViewPromise(e,s$1){this._creatingViewCount+=1;const a=e.type,r=this._analysisModules[a];if(t(r.module)){const e=await this._loadAnalysisModule(a);r.module=e;}const o=new r.module.default({analysis:e,view:this.view,parent:this});if(await o.when(),this._creatingViewCount-=1,p$1(s$1))throw o.destroy(),new s("layerview:no-analysisview-for-analysis","The analysis has not been added to the AnalysisLayer of this layer view",{analysis:e});return this.allAnalysisViews.add(o),o}_loadAnalysisModule(e){switch(e){case"area-measurement":return import('./AreaMeasurementView3D.js').then(function (n) { return n.A; });case"direct-line-measurement":return import('./DirectLineMeasurementView3D.js').then(function (n) { return n.D; });case"line-of-sight":return import('./LineOfSightView.js');case"slice":return import('./SliceView.js');default:return null}}};e([d$1()],w.prototype,"type",void 0),e([d$1()],w.prototype,"layer",void 0),e([d$1()],w.prototype,"allAnalysisViews",void 0),e([d$1()],w.prototype,"_creatingViewCount",void 0),w=e([i("esri.views.3d.layers.AnalysisLayerView3D")],w);const d=w;

export default d;
