'use strict';

const aaBoundingRect = require('./aaBoundingRect-56648c00.js');
const geometry = require('./geometry-ef17530a.js');
const request = require('./messageBundle-8be88d04.js');
const jsonUtils = require('./jsonUtils-b6068079.js');
const normalizeUtils = require('./normalizeUtils-a793b472.js');

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function u(n){if(!n)return null;let r=null;const u=n.spatialReference,d=request.S$3(u);if(!d)return "toJSON"in n?n.toJSON():n;const I=request.T$3(u)?102100:4326,g=normalizeUtils.r[I].maxX,j=normalizeUtils.r[I].minX,M=normalizeUtils.r[I].plus180Line,N=normalizeUtils.r[I].minus180Line;let O;const S="toJSON"in n?n.toJSON():n;if(jsonUtils.l(S))O=h(S,g,j);else if(jsonUtils.f(S))S.points=S.points.map((n=>h(n,g,j))),O=S;else if(jsonUtils.s(S))O=y(S,d);else if(jsonUtils.c(S)||jsonUtils.y(S)){const n=J;geometry.c(n,S);const m={xmin:n[0],ymin:n[1],xmax:n[2],ymax:n[3]},s=normalizeUtils.i(m.xmin,j)*(2*g),e=0===s?S:p(S,s);m.xmin+=s,m.xmax+=s,request.y$6(m,M)&&m.xmax!==g||request.y$6(m,N)&&m.xmin!==j?r=e:O=e;}else O=S;if(null!==r){return (new v).cut(r,g)}return O}function p(n,t){const i=normalizeUtils.s(n);for(const m of i)for(const n of m)n[0]+=t;return n}function y(n,t){if(!t)return n;const i=d(n,t).map((n=>n.extent));return i.length<2?i[0]||n:i.length>2?(n.xmin=t.valid[0],n.xmax=t.valid[1],n):{rings:i.map((n=>[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]))}}function h(n,t,i){if(Array.isArray(n)){const m=n[0];if(m>t){const i=normalizeUtils.i(m,t);n[0]=m+i*(-2*t);}else if(m<i){const t=normalizeUtils.i(m,i);n[0]=m+t*(-2*i);}}else {const m=n.x;if(m>t){const i=normalizeUtils.i(m,t);n.x+=i*(-2*t);}else if(m<i){const t=normalizeUtils.i(m,i);n.x+=t*(-2*i);}}return n}function d(n,t){const i=[],{ymin:m,ymax:s}=n,e=n.xmax-n.xmin,x=n.xmin,o=n.xmax;let a;const[r,f]=t.valid;a=I(n.xmin,t);const c=a.x,l=a.frameId;a=I(n.xmax,t);const u=a.x,p=a.frameId,y=c===u&&e>0;if(e>2*f){const n={xmin:x<o?c:u,ymin:m,xmax:f,ymax:s},t={xmin:r,ymin:m,xmax:x<o?u:c,ymax:s},e={xmin:0,ymin:m,xmax:f,ymax:s},a={xmin:r,ymin:m,xmax:0,ymax:s},y=[],h=[];g(n,e)&&y.push(l),g(n,a)&&h.push(l),g(t,e)&&y.push(p),g(t,a)&&h.push(p);for(let i=l+1;i<p;i++)y.push(i),h.push(i);i.push({extent:n,frameIds:[l]},{extent:t,frameIds:[p]},{extent:e,frameIds:y},{extent:a,frameIds:h});}else c>u||y?i.push({extent:{xmin:c,ymin:m,xmax:f,ymax:s},frameIds:[l]},{extent:{xmin:r,ymin:m,xmax:u,ymax:s},frameIds:[p]}):i.push({extent:{xmin:c,ymin:m,xmax:u,ymax:s},frameIds:[l]});return i}function I(n,t){const[i,m]=t.valid,s=2*m;let e,x=0;return n>m?(e=Math.ceil(Math.abs(n-m)/s),n-=e*s,x=e):n<i&&(e=Math.ceil(Math.abs(n-i)/s),n+=e*s,x=-e),{x:n,frameId:x}}function g(n,t){const{xmin:i,ymin:m,xmax:s,ymax:e}=t;return j(n,i,m)&&j(n,i,e)&&j(n,s,e)&&j(n,s,m)}function j(n,t,i){return t>=n.xmin&&t<=n.xmax&&i>=n.ymin&&i<=n.ymax}class v{cut(n,t){let i;if(n.rings)this.closed=!0,i=n.rings,this.minPts=4;else {if(!n.paths)return null;this.closed=!1,i=n.paths,this.minPts=2;}const m=i.length,s=-2*t;for(let e=0;e<m;e++){const n=i[e];if(n&&n.length>=this.minPts){const t=[];for(const i of n)t.push([i[0]+s,i[1]]);i.push(t);}}return this.closed?n.rings=i:n.paths=i,n}}const J=aaBoundingRect.u();

exports.u = u;
