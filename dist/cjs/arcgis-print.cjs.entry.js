'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

const index = require('./index-fde8502c.js');
const request = require('./messageBundle-8be88d04.js');
const print = require('./print-8c55a8bc.js');
const Portal = require('./Portal-8d16604d.js');
const Heading = require('./Heading-d7c5e432.js');
const Popover = require('./Popover-a5af0472.js');
require('./screenUtils-d911ae62.js');
require('./geometry-ef17530a.js');
require('./visualVariableUtils-1740874b.js');
require('./Color-7d915caa.js');
require('./colorUtils-e70dbab5.js');
require('./mathUtils-af6066f0.js');
require('./common-41a349f2.js');
require('./Graphic-0aff6059.js');
require('./PopupTemplate-a0b855f8.js');
require('./opacityUtils-f2e4b347.js');
require('./enumeration-f235fe07.js');
require('./Identifiable-a4f50f85.js');
require('./symbols-29b793e5.js');
require('./Symbol-f0556e23.js');
require('./aaBoundingBox-c372701a.js');
require('./aaBoundingRect-56648c00.js');
require('./persistableUrlUtils-c611d652.js');
require('./jsonUtils-b6068079.js');
require('./lengthUtils-179eaf12.js');
require('./unitUtils-083cb8d0.js');
require('./sizeVariableUtils-9012516e.js');
require('./normalizeUtils-a793b472.js');
require('./Field-b92c6f4a.js');
require('./fieldType-32f95259.js');
require('./utils-8a0a0870.js');
require('./FeatureSet-8efc5965.js');
require('./GPMessage-d3ae977e.js');
require('./floorFilterUtils-a9b30733.js');

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let p$1=class extends request.p{constructor(t){super(t),this._handles=new request.u,this.state="pending",this.url="";}initialize(){this._handles.add([request.i$1(this,["extension","name"],(()=>this._setFormattedFileName()))]);}destroy(){this._handles.destroy();}_setFormattedFileName(){if(!this.name||!this.extension)return;let t=this.name+"."+this.extension;this.count&&(t=this.name+"("+this.count+")."+this.extension),this.formattedName=t;}};request.e([request.d()],p$1.prototype,"count",void 0),request.e([request.d()],p$1.prototype,"error",void 0),request.e([request.d()],p$1.prototype,"extension",void 0),request.e([request.d()],p$1.prototype,"formattedName",void 0),request.e([request.d()],p$1.prototype,"name",void 0),request.e([request.d()],p$1.prototype,"state",void 0),request.e([request.d()],p$1.prototype,"url",void 0),p$1=request.e([request.i("esri.widgets.print.FileLink")],p$1);const a$1=p$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$1=class extends request.p{constructor(e){super(e),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null;}};request.e([request.d()],s$1.prototype,"extent",void 0),request.e([request.d()],s$1.prototype,"extraParameters",void 0),request.e([request.d()],s$1.prototype,"outSpatialReference",void 0),request.e([request.d()],s$1.prototype,"template",void 0),request.e([request.d()],s$1.prototype,"updateDelay",void 0),request.e([request.d()],s$1.prototype,"view",void 0),s$1=request.e([request.i("esri.rest.support.PrintParameters")],s$1);const p=s$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let i$1=class extends request.a$2{constructor(o){super(o),this.description=null,this.format=null,this.label=null,this.layout=null,this.layoutOptions=null;}};request.e([request.d()],i$1.prototype,"description",void 0),request.e([request.d({json:{read:print.n}})],i$1.prototype,"format",void 0),request.e([request.d()],i$1.prototype,"label",void 0),request.e([request.d({json:{read:print.r}})],i$1.prototype,"layout",void 0),request.e([request.d()],i$1.prototype,"layoutOptions",void 0),i$1=request.e([request.i("esri.widgets.Print.CustomTemplate")],i$1);const a=i$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const w$1=6e4,S$1=request.S.ofType(a);function j(e){e.layoutOptions||(e.layoutOptions={}),e.layoutOptions.customTextElements||(e.layoutOptions.customTextElements=[]);const t="date";if(!e.layoutOptions.customTextElements.find((e=>t in e))){const{customTextElements:t}=e.layoutOptions;t.push({date:request.L$1(Date.now(),request.S$1("short-date"))});}}let P$1=class extends Portal.m{constructor(e){super(e),this._handles=new request.u,this.allowedFormats="all",this.allowedLayouts="all",this.defaultTemplates=new S$1,this.extraParameters=null,this.includeDefaultTemplates=!0,this.effectivePrintServiceUrl=null,this.error=null,this.portal=Portal.B.getDefault(),this.printServiceUrl=null,this.templatesInfo=null,this.updateDelay=1e3,this.view=null,this.print=this.print.bind(this);}destroy(){this._handles.destroy(),this._handles=null,this.view=null;}get state(){return "loading"===this.loadStatus?"initializing":this.error||"failed"===this.loadStatus?"error":this.get("view.ready")&&"loaded"===this.loadStatus?"ready":"disabled"}set scaleEnabled(e){request.r$3(request.s$1.getLogger(this.declaredClass),"scaleEnabled",{version:"4.22"}),this.set("scaleEnabled",e);}async load(e){return this.addResolvingPromise(this._loadResources(e).catch((e=>this.error=e))),this}async print(e){const{view:t,extraParameters:r,updateDelay:o}=this;if(!t)throw new request.s("print:view-required","view is not set");j(e);const s=new p({view:t,template:e,extraParameters:r,updateDelay:o});try{return await print.Q(this.effectivePrintServiceUrl,s)}catch(a){throw new request.s("print:export-error","An error occurred while exporting the web map.",{error:a})}}async _loadResources(e){let t=[];const{printServiceUrl:r}=this;if(!r){var o;if(this.destroyed)return;const{portal:r}=this;try{await r.load(e);}catch(a){throw new request.s("print:could-not-load-portal","Cannot load print resource information from portal",{url:this.effectivePrintServiceUrl})}const l=null==(o=r.helperServices)?void 0:o.printTask;var s;if(l)this._set("effectivePrintServiceUrl",l.url),t=(null!=(s=null==l?void 0:l.templates)?s:[]).map((e=>a.fromJSON(e)));}t.length>0&&this.defaultTemplates.addMany(t),await this._loadServiceDescription(e);}async _loadServiceDescription(e){const t=await this._getPrintTemplatesFromService(e);this._set("templatesInfo",t);}_getPrintTemplatesFromService(e){if(-1===this.effectivePrintServiceUrl.toLowerCase().split("/").indexOf("gpserver"))throw new request.s("print:invalid-print-service-url","Can't fetch print templates information from provided URL",{url:this.effectivePrintServiceUrl});return request.E(this.effectivePrintServiceUrl,{...e,query:{f:"json"},timeout:w$1}).then((e=>{const t=e&&e.data,r=t&&t.parameters;let o=null,i=null;r.forEach((e=>{let t,r=e.choiceList&&e.choiceList.slice();r&&r.length&&e.defaultValue&&(t=r.indexOf(e.defaultValue)),t>-1&&(r.splice(t,1),r.unshift(e.defaultValue));const s=(e,t)=>{const r="all"===t?e:e.filter((e=>t.indexOf(e)>-1));return 0===r.length?e:r};if("Format"===e.name){const t=s(r.map(print.n),this.allowedFormats),i=print.n(e.defaultValue);o={defaultValue:t.includes(i)?i:t[0],choiceList:t};}else if("Layout_Template"===e.name){let t,o;r=r.filter((e=>"map_only"!==e.toLowerCase())),r.some(((e,r)=>{const o=e.toLowerCase();return o.indexOf("letter")>-1&&o.indexOf("landscape")>-1?(t=r,!0):o.indexOf("a4")>-1&&o.indexOf("landscape")>-1&&(t=r,!1)})),t&&(o=r[t],r.splice(t,1),r.unshift(o));const a=s(r.map(print.r),this.allowedLayouts),l=print.r(e.defaultValue);i={defaultValue:a.includes(l)?l:a[0],choiceList:a};}})),this.error=null;return {format:o,layout:i}})).catch((e=>{throw new request.s("print:unavailable-service-info","Can't fetch templates info from service",{error:e})}))}};request.e([request.d()],P$1.prototype,"allowedFormats",void 0),request.e([request.d()],P$1.prototype,"allowedLayouts",void 0),request.e([request.d({type:S$1})],P$1.prototype,"defaultTemplates",void 0),request.e([request.d()],P$1.prototype,"extraParameters",void 0),request.e([request.d()],P$1.prototype,"includeDefaultTemplates",void 0),request.e([request.d({aliasOf:{source:"printServiceUrl",overridable:!0},readOnly:!0})],P$1.prototype,"effectivePrintServiceUrl",void 0),request.e([request.d()],P$1.prototype,"error",void 0),request.e([request.d({type:Portal.B})],P$1.prototype,"portal",void 0),request.e([request.d()],P$1.prototype,"printServiceUrl",void 0),request.e([request.d({readOnly:!0})],P$1.prototype,"state",null),request.e([request.d()],P$1.prototype,"scaleEnabled",null),request.e([request.d({readOnly:!0})],P$1.prototype,"templatesInfo",void 0),request.e([request.d()],P$1.prototype,"updateDelay",void 0),request.e([request.d()],P$1.prototype,"view",void 0),P$1=request.e([request.i("esri.widgets.Print.PrintViewModel")],P$1);const g=P$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let i=class extends request.p{constructor(t){super(t),this.attributionEnabled=!0,this.author=null,this.copyright=null,this.dpi=96,this.fileName=null,this.forceFeatureAttributes=!1,this.format=null,this.layout=null,this.legendEnabled=!0,this.height=null,this.scale=null,this.scaleEnabled=!1,this.title=null,this.width=null;}};request.e([request.d()],i.prototype,"attributionEnabled",void 0),request.e([request.d()],i.prototype,"author",void 0),request.e([request.d()],i.prototype,"copyright",void 0),request.e([request.d()],i.prototype,"dpi",void 0),request.e([request.d()],i.prototype,"fileName",void 0),request.e([request.d()],i.prototype,"forceFeatureAttributes",void 0),request.e([request.d()],i.prototype,"format",void 0),request.e([request.d()],i.prototype,"layout",void 0),request.e([request.d()],i.prototype,"legendEnabled",void 0),request.e([request.d()],i.prototype,"height",void 0),request.e([request.d()],i.prototype,"scale",void 0),request.e([request.d()],i.prototype,"scaleEnabled",void 0),request.e([request.d()],i.prototype,"title",void 0),request.e([request.d()],i.prototype,"width",void 0),i=request.e([request.i("esri.widgets.Print.TemplateOptions")],i);const s=i;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const w=request.S.ofType(a$1),O="MAP_ONLY",x={base:"esri-print",headerTitle:"esri-print__header-title",inputText:"esri-print__input-text",layoutTabList:"esri-print__layout-tab-list",layoutTab:"esri-print__layout-tab",layoutSection:"esri-print__layout-section",mapOnlySection:"esri-print__map-only-section",scaleInput:"esri-print__scale-input",templateList:"esri-print__template-list",templateListScroller:"esri-print__template-list-scroller",templateListFooter:"esri-print__template-list-footer",loader:"esri-print__loader",advancedOptionsButton:"esri-print__advanced-options-button",advancedOptionsButtonContainer:"esri-print__advanced-options-button-container",advancedOptionsButtonTitle:"esri-print__advanced-options-button-title",advancedOptionsButtonIconOpened:"esri-print__advanced-options-button-icon--opened",advancedOptionsButtonIconClosed:"esri-print__advanced-options-button-icon--closed",advancedOptionsButtonIconClosed_RTL:"esri-print__advanced-options-button-icon--closed-rtl",refreshButton:"esri-print__refresh-button",swapButton:"esri-print__swap-button",linkButton:"esri-print__link-button",printButton:"esri-print__export-button",templateButton:"esri-print__template-button",formSectionContainer:"esri-print__form-section-container",advancedOptionsSection:"esri-print__advanced-options-section",advancedOptionsContainer:"esri-print__advanced-options-container",authorInfoContainer:"esri-print__author-info-container",copyrightInfoContainer:"esri-print__copyright-info-container",exportedFilesContainer:"esri-print__export-panel-container",exportedFilesTitle:"esri-print__export-title",exportedFile:"esri-print__exported-file",exportedFileLink:"esri-widget__anchor esri-print__exported-file-link",exportedFileLinkTitle:"esri-print__exported-file-link-title",heightContainer:"esri-print__height-container",legendInfoContainer:"esri-print__legend-info-container",printWidgetContainer:"esri-print__container",panelContainer:"esri-print__panel-container",scaleInfoContainer:"esri-print__scale-info-container",scaleInputContainer:"esri-print__scale-input-container",sizeContainer:"esri-print__size-container",widthContainer:"esri-print__width-container",widget:"esri-widget",panel:"esri-widget--panel",widgetButton:"esri-widget--button",button:"esri-button",buttonSecondary:"esri-button--secondary",buttonTertiary:"esri-button--tertiary",select:"esri-select",input:"esri-input",disabled:"esri-disabled",anchorDisabled:"esri-widget__anchor--disabled",buttonDisabled:"esri-button--disabled",panelError:"esri-print__panel--error",exportedFileError:"esri-print__exported-file--error",hide:"esri-hidden",rotate:"esri-rotating",anchor:"esri-widget__anchor",menu:"esri-menu",menuList:"esri-menu__list",menuItem:"esri-menu__list-item",menuItemFocus:"esri-menu__list-item--focus",menuHeader:"esri-menu__header",iconCheckMark:"esri-icon-check-mark",iconDownload:"esri-icon-download",iconLaunchLink:"esri-icon-launch-link-external",iconError:"esri-icon-error",iconPrinter:"esri-icon-printer",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconDownArrow:"esri-icon-down-arrow",iconRefresh:"esri-icon-refresh",iconSpinner:"esri-icon-loading-indicator",iconSwap:"esri-icon-swap",iconLinked:"esri-icon-link-horizontal",iconUnlinked:"esri-icon-unlocked-link-horizontal",widgetIcon:"esri-icon-printer"},C="esri.widgets.Print",L=request.s$1.getLogger(C),I="User sets an invalid layout, resetting it to the default valid one...",S="User sets an invalid format, resetting it to the default valid one...";function k(e){const t=8.3333,i=11.4583;return {width:Math.round(e*t),height:Math.round(e*i)}}function F(e){return !isNaN(e)&&e>0}function M(e){return (null==e?void 0:e.toUpperCase())===O}let E=class extends request.z{constructor(e,t){super(e,t),this._activeTabFocusRequested=!1,this._advancedOptionsVisibleForLayout=!1,this._advancedOptionsVisibleForMapOnly=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._focusedTemplateIndex=0,this._layoutTabSelected=!0,this._pendingExportScroll=!1,this._rootNode=null,this._selectTemplateNode=null,this._templateListPopover=new Popover.f({owner:this,placement:"top",offset:[0,-100],anchorElement:()=>this._selectTemplateNode,renderContentFunction:this.renderTemplateList}),this.allowedFormats=null,this.allowedLayouts=null,this.exportedLinks=new w,this.extraParameters=null,this.headingLevel=3,this.iconClass=x.widgetIcon,this.includeDefaultTemplates=null,this.label=void 0,this.portal=null,this.printServiceUrl=null,this.templateOptions=new s,this.view=null,this.viewModel=new g,this.handleTemplateListCreation=e=>e.focus(),this.handleTemplateChildBlur=e=>{var t;(null==(t=e.relatedTarget)?void 0:t.closest(`.${x.templateList}`))||this.handleCloseTemplateSelection();},this.handleCloseTemplateSelection=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!1,this._selectTemplateNode.focus();},this.handleSelectTemplateClick=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!0;},this.handleTemplateListClick=e=>{const t=e.target;this.applyTemplate(t["data-template"]);},this.handleTemplateListKeyDown=e=>{if(request.y(e.key))return this.applyTemplate(this.viewModel.defaultTemplates.getItemAt(this._focusedTemplateIndex)),void e.preventDefault();if("ArrowDown"===e.key||"ArrowUp"===e.key){const{defaultTemplates:t}=this.viewModel,i="ArrowDown"===e.key?1:-1,a=(this._focusedTemplateIndex+i)%t.length;this._focusedTemplateIndex=a<0?t.length-1:a;const n=e.currentTarget;request.w$1(n.querySelectorAll(`.${x.menuItem}`)[this._focusedTemplateIndex],n.parentElement),e.preventDefault();}"Escape"===e.key&&this.handleCloseTemplateSelection();},this._removeLink=e=>{const t=e.currentTarget["data-item"];t&&"error"===t.state&&this.exportedLinks.remove(t);},this._focusOnTabChange=this._focusOnTabChange.bind(this);}initialize(){this.own([request.i$1(this,"viewModel.templatesInfo",(e=>{const{format:t,layout:i}=this.templateOptions;if(e){const a=i===e.layout.defaultValue||M(i)||e.layout.choiceList&&e.layout.choiceList.indexOf(i)>-1,n=t===e.format.defaultValue||e.format.choiceList&&e.format.choiceList.indexOf(t)>-1;a||(i&&L.warn(I),this.templateOptions.layout=e.layout.defaultValue),n||(t&&L.warn(S),this.templateOptions.format=e.format.defaultValue),M(i)&&(this._layoutTabSelected=!1);}})),request.i$1(this,"templateOptions.format",(e=>{const{viewModel:{templatesInfo:t}}=this;if(t&&e){let i=!1;t.format.choiceList&&t.format.choiceList.forEach((t=>{t.toUpperCase()===e.toUpperCase()&&(this.templateOptions.format=t,i=!0);})),i||(this.templateOptions.format=t.format.defaultValue,L.warn(S)),this.scheduleRender();}})),request.i$1(this,"templateOptions.layout",(e=>{const{viewModel:{templatesInfo:t}}=this;if(t&&e){this._layoutTabSelected=!M(e);let i=!this._layoutTabSelected;i||t.layout.choiceList&&t.layout.choiceList.forEach((t=>{t.toUpperCase()===e.toUpperCase()&&(this.templateOptions.layout=t,i=!0);})),i||(this.templateOptions.layout=t.layout.defaultValue,L.warn(I)),this.scheduleRender();}})),request.i$1(this,"templateOptions.dpi",(e=>{e<=0?this.templateOptions.dpi=1:this.scheduleRender();})),request.i$1(this,"viewModel.view.scale",(e=>{const{scale:t,scaleEnabled:i}=this.templateOptions;i&&t||(this.templateOptions.scale=e);}))]);const{height:e,width:t}=this.templateOptions;this.templateOptions.width=t||800,this.templateOptions.height=e||1100;const i=setTimeout((()=>{this._awaitingServerResponse=!0,this.scheduleRender();}),500);this.viewModel.load().then((()=>clearTimeout(i)));}render(){const{attributionEnabled:e,author:t,copyright:i,dpi:a,format:n,height:s,layout:o,legendEnabled:l,scaleEnabled:r,scale:p,width:d}=this.templateOptions,c="ready"!==this.get("viewModel.state"),h=this.renderTitleOrFileNameSection(),{includeDefaultTemplates:u,messages:m,viewModel:_}=this,v=this.get("viewModel.templatesInfo.format.choiceList")||[],y=v.length>0?v.map((e=>request.n$1("option",{key:e,selected:e===n,value:e},e.toUpperCase()))):request.n$1("option",{key:"format-default-option"},m.formatDefaultOption),g=request.n$1("div",{class:x.formSectionContainer},request.n$1("label",null,m.fileFormatTitle,request.n$1("select",{class:x.select,onchange:this._updateFromOption,"data-target-property":"format",bind:this},y))),f=this.get("viewModel.templatesInfo.layout.choiceList")||[],w=f.length>0?f.map((e=>{const t=e===o,i=m[e]||e;return request.n$1("option",{key:e,selected:t,value:e},i)})):request.n$1("option",{key:"layout-default-option"},m.layoutDefaultOption),O=request.n$1("div",{class:x.formSectionContainer},request.n$1("label",null,m.layoutTitle,request.n$1("select",{class:x.select,onchange:this._updateFromOption,"data-target-property":"layout",bind:this},w))),C=request.n$1("div",{class:x.formSectionContainer},request.n$1("label",null,m.dpi,request.n$1("input",{type:"number",class:this.classes(x.inputText,x.input),"data-input-name":"dpi",onchange:this._handleDPIChange,value:`${a}`,min:"1",tabIndex:0,bind:this}))),L=request.n$1("div",{class:this.classes(x.scaleInfoContainer,x.formSectionContainer)},request.n$1("label",null,request.n$1("input",{"data-option-name":"scaleEnabled",checked:r,type:"checkbox",tabIndex:0,onchange:this._toggleInputValue,bind:this}),m.scale),request.n$1("div",{class:x.scaleInputContainer},request.n$1("input",{"aria-label":m.scaleLabel,"aria-valuenow":`${p}`,role:"spinbutton",type:"number",class:this.classes(x.inputText,x.input,x.scaleInput),tabIndex:0,"data-input-name":"scale",onchange:this._updateInputValue,disabled:!r,value:`${p}`,bind:this}),request.n$1("button",{type:"button","aria-label":m.reset,class:this.classes(x.widgetButton,x.refreshButton,x.iconRefresh),tabIndex:0,onclick:this._resetToCurrentScale,bind:this}))),I=this._advancedOptionsVisibleForLayout?request.n$1("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:x.advancedOptionsContainer},L,request.n$1("div",{class:this.classes(x.authorInfoContainer,x.formSectionContainer)},request.n$1("label",null,m.author,request.n$1("input",{type:"text",value:t,class:this.classes(x.inputText,x.input),tabIndex:0,"data-input-name":"author",onchange:this._updateInputValue,bind:this}))),request.n$1("div",{class:this.classes(x.copyrightInfoContainer,x.formSectionContainer)},request.n$1("label",null,m.copyright,request.n$1("input",{type:"text",class:this.classes(x.inputText,x.input),tabIndex:0,value:i,"data-input-name":"copyright",onchange:this._updateInputValue,bind:this}))),C,request.n$1("div",{class:this.classes(x.legendInfoContainer,x.formSectionContainer)},request.n$1("label",null,request.n$1("input",{type:"checkbox","data-option-name":"legendEnabled",tabIndex:0,checked:l,onchange:this._toggleInputValue,bind:this}),m.legend))):null,S=this._advancedOptionsVisibleForMapOnly?request.n$1("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:x.advancedOptionsContainer},L,C,request.n$1("div",{class:x.formSectionContainer},request.n$1("label",null,request.n$1("input",{"data-option-name":"attributionEnabled",type:"checkbox",onchange:this._toggleInputValue,tabIndex:0,checked:e,bind:this}),m.attribution))):null,k=this._layoutTabSelected?request.n$1("section",{key:"esri-print__layoutContent",id:`${this.id}__layoutContent`,"aria-labelledby":`${this.id}__layoutTab`,class:x.layoutSection,role:"tabpanel","aria-selected":this._layoutTabSelected.toString()},request.n$1("div",{class:x.panelContainer},h,O,this._layoutTabSelected?g:null),request.n$1("div",{class:this.classes(x.panelContainer,x.advancedOptionsSection)},request.n$1("button",{"aria-label":m.advancedOptions,"aria-expanded":this._advancedOptionsVisibleForLayout?"true":"false",class:x.advancedOptionsButton,onclick:this._showAdvancedOptions,bind:this,type:"button"},request.n$1("div",{class:x.advancedOptionsButtonContainer},request.n$1("span",{"aria-hidden":"true",class:this.classes(x.iconRightTriangleArrow,x.advancedOptionsButtonIconClosed)}),request.n$1("span",{"aria-hidden":"true",class:this.classes(x.iconLeftTriangleArrow,x.advancedOptionsButtonIconClosed_RTL)}),request.n$1("span",{"aria-hidden":"true",class:this.classes(x.iconDownArrow,x.advancedOptionsButtonIconOpened)}),request.n$1("span",{class:x.advancedOptionsButtonTitle},m.advancedOptions))),I)):request.n$1("section",{key:"esri-print__mapOnlyContent",id:`${this.id}__mapOnlyContent`,"aria-selected":(!this._layoutTabSelected).toString(),"aria-labelledby":`${this.id}__mapOnlyTab`,class:x.mapOnlySection,role:"tabpanel"},request.n$1("div",{class:x.panelContainer},h,this._layoutTabSelected?null:g,request.n$1("div",{class:this.classes(x.sizeContainer,x.formSectionContainer)},request.n$1("div",{class:x.widthContainer},request.n$1("label",null,m.width,request.n$1("input",{type:"number",class:this.classes(x.inputText,x.input),"data-input-name":"width",onchange:this._updateInputValue,value:`${d}`,tabIndex:0,bind:this}))),request.n$1("div",{class:x.heightContainer},request.n$1("label",null,m.height,request.n$1("input",{type:"number",class:this.classes(x.inputText,x.input),"data-input-name":"height",onchange:this._updateInputValue,value:`${s}`,tabIndex:0,bind:this}))),request.n$1("button",{type:"button","aria-label":m.swap,class:this.classes(x.widgetButton,x.swapButton,x.iconSwap),onclick:this._switchInput,tabIndex:0,bind:this})),request.n$1("div",{class:this.classes(x.panelContainer,x.advancedOptionsSection)},request.n$1("button",{"aria-label":m.advancedOptions,"aria-expanded":this._advancedOptionsVisibleForMapOnly?"true":"false",type:"button",class:x.advancedOptionsButton,onclick:this._showAdvancedOptions,bind:this},request.n$1("div",{class:x.advancedOptionsButtonContainer},request.n$1("span",{"aria-hidden":"true",class:this.classes(x.iconRightTriangleArrow,x.advancedOptionsButtonIconClosed)}),request.n$1("span",{"aria-hidden":"true",class:this.classes(x.iconLeftTriangleArrow,x.advancedOptionsButtonIconClosed_RTL)}),request.n$1("span",{"aria-hidden":"true",class:this.classes(x.iconDownArrow,x.advancedOptionsButtonIconOpened)}),request.n$1("span",{class:x.advancedOptionsButtonTitle},m.advancedOptions))),S))),F=this.exportedLinks.toArray(),M=this._renderExportedLink(F),E={[x.buttonDisabled]:c||!o&&!n},P=null!=this.get("view")&&"2d"!==this.get("view.type"),A=request.n$1("div",{class:x.panelError},P?m.sceneViewError:m.serviceError),B=request.n$1("div",null,request.n$1("ul",{class:x.layoutTabList,role:"tablist",onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,bind:this},request.n$1("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,id:`${this.id}__layoutTab`,"data-tab-id":"layoutTab",class:x.layoutTab,role:"tab",tabIndex:0,"aria-selected":`${this._layoutTabSelected}`},m.layoutTab),request.n$1("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,id:`${this.id}__mapOnlyTab`,"data-tab-id":"mapOnlyTab",class:x.layoutTab,role:"tab",tabIndex:0,"aria-selected":`${!this._layoutTabSelected}`},m.mapOnlyTab)),k,request.n$1("button",{"aria-label":m.exportDescription,type:"button",class:this.classes(x.printButton,x.button,E),disabled:c,tabIndex:0,onclick:this._handlePrintMap,bind:this},m.export),u&&_.defaultTemplates.length>0?this.renderTemplateSectionTrigger():null,request.n$1("div",{class:x.exportedFilesContainer,afterUpdate:this._scrollExportIntoView,bind:this},request.n$1(Heading.s,{class:x.exportedFilesTitle,level:this.headingLevel},m.exportText),F.length>0?null:request.n$1("div",null,request.n$1("div",null,m.exportHint)),M)),V=request.n$1("div",{class:x.printWidgetContainer},request.n$1("header",{class:x.headerTitle},m.export),this.error||P||!this.view?A:B),D="initializing"===this.get("viewModel.state")?this._renderLoader():V;return request.n$1("div",{afterCreate:this._handleRootAfterCreate,bind:this,class:this.classes(x.base,x.widget,x.panel)},D)}renderTemplateSectionTrigger(){const{messages:e,_templateListPopover:t}=this,i=t.open;return request.n$1("button",{afterCreate:e=>this._selectTemplateNode=e,"aria-controls":i?`${this.id}__template-selection`:"","aria-label":e.selectTemplateDescription,"aria-pressed":i.toString(),class:this.classes(x.button,x.buttonTertiary,x.templateButton),onclick:this.handleSelectTemplateClick,title:e.selectTemplateDescription},e.selectTemplate)}renderTemplateList(){const{messages:e,messagesCommon:t,viewModel:i}=this,{defaultTemplates:a}=i,n=e.selectTemplateDescription,s=`${this.id}__template-selection`;return request.n$1("div",{class:this.classes(x.templateList,x.widget,x.panel),id:s},request.n$1(Heading.s,{class:x.menuHeader,level:this.headingLevel},e.selectTemplate),request.n$1("div",{class:x.templateListScroller},request.n$1("ul",{afterCreate:this.handleTemplateListCreation,"aria-activedescendant":`${this.id}__template-item--${this._focusedTemplateIndex}`,"aria-label":n,class:x.menuList,key:"templates",onblur:this.handleTemplateChildBlur,onclick:this.handleTemplateListClick,onkeydown:this.handleTemplateListKeyDown,role:"listbox",tabIndex:0,title:n},a.toArray().map(((t,i)=>{const{description:a}=t,n=i===this._focusedTemplateIndex,s=t.label;return request.n$1("li",{"aria-label":a,class:this.classes(x.menuItem,{[x.menuItemFocus]:n}),"data-template":t,id:`${this.id}__template-item--${i}`,key:s,title:a},M(s)?e.mapOnlyTab:s)})))),request.n$1("div",{class:x.templateListFooter},request.n$1("button",{type:"button",class:this.classes(x.button,x.buttonSecondary),onblur:this.handleTemplateChildBlur,onclick:this.handleCloseTemplateSelection},t.done)))}applyTemplate(e){var t;const{format:i,layout:a,layoutOptions:n}=e,{templateOptions:s}=this;this._templateListPopover.open=!1,this._toggleTab("map-only"===a?"mapOnlyTab":"layoutTab",!1),i&&(s.format=i),a&&(s.layout=a),this._focusedTemplateIndex=null,s.legendEnabled=null!=(t=null==n?void 0:n.legend)?t:s.legendEnabled,this.handleCloseTemplateSelection();}renderTitleOrFileNameSection(){const{templateOptions:e,messages:t}=this;let i,a,n,s;return this._layoutTabSelected?(i=t.title,a=t.titlePlaceHolder,n=e.title,s="title"):(i=t.fileName,a=t.fileNamePlaceHolder,n=e.fileName,s="fileName"),request.n$1("div",{class:x.formSectionContainer,key:s},request.n$1("label",null,i,request.n$1("input",{type:"text",tabIndex:0,placeholder:a,class:this.classes(x.inputText,x.input),value:n,"data-input-name":s,onchange:this._updateInputValue,bind:this})))}_handleRootAfterCreate(e){this._rootNode=e,this.own(request.r$1(e,"scroll",(()=>{this._templateListPopover.open&&this.handleCloseTemplateSelection();})));}_focusOnTabChange(e){if(!this._activeTabFocusRequested)return;const t=e.getAttribute("data-tab-id");("layoutTab"===t&&this._layoutTabSelected||"mapOnlyTab"===t&&!this._layoutTabSelected)&&(e.focus(),this._activeTabFocusRequested=!1);}_renderLoader(){const e={[x.loader]:this._awaitingServerResponse};return request.n$1("div",{class:this.classes(e),key:"loader"})}_createFileLink(e,t){const i=t||this.messages.untitled,a=e.format.toLowerCase(),n=a.indexOf("png")>-1?"png":a,s=i+n;return void 0!==this._exportedFileNameMap[s]?this._exportedFileNameMap[s]++:this._exportedFileNameMap[s]=0,new a$1({name:i,extension:n,count:this._exportedFileNameMap[s]})}_toPrintTemplate({attributionEnabled:e,author:t,copyright:i,dpi:a,forceFeatureAttributes:n,format:s,height:o,layout:l,legendEnabled:r,title:p,scale:d,scaleEnabled:h,width:u}){const m=new print.p({attributionVisible:e,layoutOptions:{authorText:t||"",copyrightText:i||"",titleText:p||""},forceFeatureAttributes:n,format:s,layout:l,scalePreserved:h,outScale:d});return u&&(m.exportOptions.width=u),o&&(m.exportOptions.height=o),a&&(m.exportOptions.dpi=a),r||(m.layoutOptions.legendLayers=[]),m}_resetToCurrentScale(){this.templateOptions.scale=this.viewModel.view.scale;}_updateInputValue(e){const t=e.target,i=t.getAttribute("data-input-name");let a;if("number"===t.type){if(!F(t.valueAsNumber)){const e=this.templateOptions[i];return void(t.value=`${e}`)}a=t.valueAsNumber;}else a=t.value;this.templateOptions[i]=a;}_handleDPIChange(e){this._updateInputValue(e);const t=e.currentTarget.valueAsNumber,{height:i,width:a}=k(t),{templateOptions:n}=this;n.height=i,n.width=a;}_handlePrintMap(){this._pendingExportScroll=!0;const{templateOptions:e}=this,t=this._toPrintTemplate(e),i=this._layoutTabSelected?t.layoutOptions.titleText:e.fileName,a=this._createFileLink(t,i);this.exportedLinks.add(a),this.emit("submit",{link:a}),this.viewModel.print(t).then((e=>{a.set({url:e&&e.url,state:"ready"});})).catch((e=>{a.set({error:e,state:"error"});})).then((()=>{this.emit("complete",{link:a}),this.scheduleRender();}));}_updateFromOption(e){const t=e.target,i=t.selectedOptions?t.selectedOptions.item(0).value:t.options[t.selectedIndex].value,a=t.getAttribute("data-target-property");this.templateOptions[a]=i;}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width];}_showAdvancedOptions(){this._layoutTabSelected?this._advancedOptionsVisibleForLayout=!this._advancedOptionsVisibleForLayout:this._advancedOptionsVisibleForMapOnly=!this._advancedOptionsVisibleForMapOnly;}_scrollExportIntoView(){if(this._pendingExportScroll){this._pendingExportScroll=!1;const{_rootNode:e,_rootNode:{clientHeight:t,scrollHeight:i}}=this,a=i-t;a>0&&(e.scrollTop=a);}}_toggleInputValue(e){const t=e.target,i=t.getAttribute("data-option-name");this.templateOptions[i]=t.checked,"scaleEnabled"===i&&(this.templateOptions[i]||this._resetToCurrentScale());}_renderExportedLink(e){const t=this.messages;return e.map((e=>{const{error:i,url:a,formattedName:n,state:l}=e,r="error"===l,p="pending"===l,d="ready"===l,c={[x.anchorDisabled]:p||r};let h=a||null;h&&(h=request.j$2(h));const u=request.E$4(a,location.href),m={[x.iconSpinner]:p,[x.rotate]:p,[x.iconDownload]:u&&d,[x.iconLaunchLink]:!u&&d,[x.iconError]:r,[x.exportedFileError]:r},_={[x.exportedFileError]:r};let b;b=p?t.pending:d?t.ready:t.errorMessage;const v=r?"print-task:cim-symbol-unsupported"===i.name?t.exportWebMapCIMError:t.exportWebMapError:"";return request.n$1("div",{"aria-label":b,class:x.exportedFile,"data-item":e,key:n,onclick:this._removeLink,title:v},request.n$1("a",{"aria-label":`${n}. ${t.linkReady}`,download:n,href:h,rel:"noreferrer",tabIndex:0,target:"_blank",class:this.classes(x.exportedFileLink,c)},request.n$1("span",{class:this.classes(m)}),request.n$1("span",{class:this.classes(x.exportedFileLinkTitle,_)},n)))}))}_toggleLayoutPanel(e){const t=e.target;this._toggleTab(t.getAttribute("data-tab-id"));}_toggleTab(e,t=!0){if(this._layoutTabSelected="layoutTab"===e,this._layoutTabSelected){const e=this.get("viewModel.templatesInfo.layout.choiceList");this.templateOptions.layout=e&&e[0];}else this.templateOptions.layout=O;t&&(this._activeTabFocusRequested=!0);}_handleLayoutPanelKeyDown(e){const t=request.i$2(e),i=e.target.getAttribute("data-tab-id");if(request.y(t))return this._toggleTab(i),e.preventDefault(),void e.stopPropagation();"ArrowLeft"!==t&&"ArrowRight"!==t||(this._toggleTab("layoutTab"===i?"mapOnlyTab":"layoutTab"),e.preventDefault(),e.stopPropagation());}};request.e([request.o("viewModel.allowedFormats")],E.prototype,"allowedFormats",void 0),request.e([request.o("viewModel.allowedLayouts")],E.prototype,"allowedLayouts",void 0),request.e([request.o("viewModel.error")],E.prototype,"error",void 0),request.e([request.d({type:w})],E.prototype,"exportedLinks",void 0),request.e([request.o("viewModel.extraParameters")],E.prototype,"extraParameters",void 0),request.e([request.d()],E.prototype,"headingLevel",void 0),request.e([request.d()],E.prototype,"iconClass",void 0),request.e([request.o("viewModel.includeDefaultTemplates")],E.prototype,"includeDefaultTemplates",void 0),request.e([request.d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],E.prototype,"label",void 0),request.e([request.d(),request.e$1("esri/widgets/Print/t9n/Print")],E.prototype,"messages",void 0),request.e([request.d(),request.e$1("esri/t9n/common")],E.prototype,"messagesCommon",void 0),request.e([request.o("viewModel.portal")],E.prototype,"portal",void 0),request.e([request.o("viewModel.printServiceUrl")],E.prototype,"printServiceUrl",void 0),request.e([request.d({type:s})],E.prototype,"templateOptions",void 0),request.e([request.o("viewModel.view")],E.prototype,"view",void 0),request.e([request.d({type:g})],E.prototype,"viewModel",void 0),E=request.e([request.i("esri.widgets.Print")],E);const P=E;

const arcgisPrintCss = "@import url('https://js.arcgis.com/next/esri/themes/light/main.css');";

let ArcGISPrint = class {
  constructor(hostRef) {
    index.registerInstance(this, hostRef);
    this.loaded = index.createEvent(this, "loaded", 7);
    this.position = 'bottom-left';
  }
  validateAllowedFormats(value) {
    if (value && this.widget) {
      this.widget.allowedFormats = value.split(',');
    }
  }
  validateAllowedLayouts(value) {
    if (value && this.widget) {
      this.widget.allowedLayouts = value.split(',');
    }
  }
  validateView(value) {
    if (value) {
      this.widget.view = value;
      if (this.el.parentElement.tagName.toLowerCase() !== 'arcgis-expand') {
        this.widget.view.ui.add(this.widget, this.position);
      }
    }
  }
  componentWillLoad() {
    const params = {
      container: this.el,
    };
    if (this.allowedFormats) {
      params.allowedFormats = this.allowedFormats.split(',');
    }
    if (this.allowedLayouts) {
      params.allowedLayouts = this.allowedLayouts.split(',');
    }
    if (this.view) {
      params.view = this.view;
    }
    const widget = new P(params);
    this.widget = widget;
    this.loaded.emit(true);
  }
  get el() { return index.getElement(this); }
  static get watchers() { return {
    "allowedFormats": ["validateAllowedFormats"],
    "allowedLayouts": ["validateAllowedLayouts"],
    "view": ["validateView"]
  }; }
};
ArcGISPrint.style = arcgisPrintCss;

exports.arcgis_print = ArcGISPrint;
