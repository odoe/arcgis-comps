'use strict';

const arcadeUtils = require('./arcadeUtils-bf80022b.js');
const geomasync = require('./geomasync-0754683a.js');
const request = require('./MapView-1195e7f1.js');
require('./number-1d2f969a.js');
require('./FeatureSetReader-1f650286.js');
require('./centroid-7cf9ad55.js');
require('./geometryEngineAsync-a86adfb9.js');
require('./index-b630e408.js');

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function te(e){return e&&"function"==typeof e.then}const re=100;function ne(e){return e instanceof Error?request.C$6(e):request.C$6(new Error(e))}function oe(e){return request.k$4(e)}function ae(e,t){const r=[];for(let n=0;n<t.arguments.length;n++)r.push(se(e,t.arguments[n]));return request.s$20(r)}function ce(e,t,r){return request.f$11(((n,o)=>{ae(e,t).then((a=>{try{n(r(e,t,a));}catch(c){o(c);}}),o);}))}function ie(e,t,r){try{return ae(e,t).then((n=>{try{const o=r(e,t,n);return te(o)?o:request.k$4(o)}catch(o){return ne(o)}}))}catch(n){return ne(n)}}function se(e,t,r){try{if(t.breakpoint&&!0!==r){return t.breakpoint().then((()=>se(e,t,!0)))}switch(t.type){case"VariableDeclarator":return Me(e,t);case"VariableDeclaration":return Fe(e,t,0);case"BlockStatement":return Oe(e,t);case"FunctionDeclaration":return Ce(e,t);case"ReturnStatement":return Ue(e,t);case"IfStatement":return Re(e,t);case"ExpressionStatement":return Te(e,t);case"UpdateExpression":return Ie(e,t);case"AssignmentExpression":return Se(e,t);case"ForStatement":return de(e,t);case"ForInStatement":return Ne(e,t);case"BreakStatement":return request.k$4(arcadeUtils.j);case"EmptyStatement":return request.k$4(arcadeUtils.R);case"ContinueStatement":return request.k$4(arcadeUtils.D);case"TemplateElement":return Ye(e,t);case"TemplateLiteral":return Ge(e,t);case"Identifier":return Ve(e,t);case"MemberExpression":return De(e,t);case"Literal":return oe(t.value);case"CallExpression":return Be(e,t);case"UnaryExpression":return je(e,t);case"BinaryExpression":return Le(e,t);case"LogicalExpression":return _e(e,t);case"ArrayExpression":return ke(e,t);case"ObjectExpression":return le(e,t);case"Property":return ue(e,t);default:return ne(arcadeUtils.b(t,"RUNTIME","UNREOGNISED"))}}catch(n){return ne(n)}}function le(e,t){try{const n=[];for(let r=0;r<t.properties.length;r++)n.push(se(e,t.properties[r]));return request.s$20(n).then((e=>request.f$11((t=>{const n={};for(let r=0;r<e.length;r++){const t=e[r];if(arcadeUtils.C(t.value))throw new Error("Illegal Argument");if(!1===arcadeUtils.Z(t.key))throw new Error("Illegal Argument");t.value===arcadeUtils.R?n[t.key.toString()]=null:n[t.key.toString()]=t.value;}const o=new arcadeUtils.h$1(n);o.immutable=!1,t(o);}))))}catch(n){return ne(n)}}function ue(e,t){try{return se(e,t.value).then((r=>request.f$11((n=>{"Identifier"===t.key.type?n({key:t.key.name,value:r}):se(e,t.key).then((e=>{n({key:e,value:r});}));}))))}catch(r){return request.C$6(r)}}function fe(e,t,r){try{return se(e,t.body).then((n=>{try{return r.lastAction=n,r.lastAction===arcadeUtils.j||r.lastAction instanceof arcadeUtils.M?(r.testResult=!1,request.k$4(r)):null!==t.update?se(e,t.update).then((()=>request.k$4(r))):request.k$4(r)}catch(o){return request.C$6(o)}}))}catch(n){return request.C$6(n)}}function he(e,t,r){try{return null!==t.test?se(e,t.test).then((n=>{try{return !0===e.abortSignal.aborted?request.C$6(new Error("Cancelled")):(r.testResult=n,!1===r.testResult?request.k$4(r):!0!==r.testResult?request.C$6(new Error(arcadeUtils.b(t,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))):fe(e,t,r))}catch(o){return request.C$6(o)}})):fe(e,t,r)}catch(n){return request.C$6(n)}}function pe(e,t,r,n,o,a){try{he(e,t,r).then((()=>{try{!0===r.testResult?++a>re?(a=0,setTimeout((()=>{pe(e,t,r,n,o,a);}),0)):pe(e,t,r,n,o,a):r.lastAction instanceof arcadeUtils.M?n(r.lastAction):n(arcadeUtils.R);}catch(c){o(c);}}),(e=>{o(e);}));}catch(c){o(c);}}function de(e,t){try{return null!==t.init?se(e,t.init).then((()=>request.f$11(((r,n)=>{pe(e,t,{testResult:!0,lastAction:arcadeUtils.R},(e=>{r(e);}),(e=>{n(e);}),0);})))):request.f$11(((r,n)=>{pe(e,t,{testResult:!0,lastAction:arcadeUtils.R},(e=>{r(e);}),(e=>{n(e);}),0);}))}catch(r){return request.C$6(r)}}function me(e,t,r,n,o,a,c,i,s,l){try{if(n<=a)return void i(arcadeUtils.R);o.value="k"===c?r[a]:a,se(e,t.body).then((u=>{try{u instanceof arcadeUtils.M?i(u):u===arcadeUtils.j?i(arcadeUtils.R):++l>re?(l=0,setTimeout((()=>{me(e,t,r,n,o,a+1,c,i,s,l);}),0)):me(e,t,r,n,o,a+1,c,i,s,l);}catch(f){s(f);}}),(e=>{s(e);}));}catch(u){s(u);}}function ge(e,t,r,n,o,a,c,i,s){try{if(r.length()<=o)return void c(arcadeUtils.R);n.value="k"===a?r.get(o):o,se(e,t.body).then((l=>{l instanceof arcadeUtils.M?c(l):l===arcadeUtils.j?c(arcadeUtils.R):++s>re?(s=0,setTimeout((()=>{ge(e,t,r,n,o+1,a,c,i,s);}),0)):ge(e,t,r,n,o+1,a,c,i,s);}),(e=>{i(e);}));}catch(l){i(l);}}function ye(e,t,r,n,o,a){try{if(void 0===a&&(a="i"),0===r.length)return void n.resolve(arcadeUtils.R);me(e,t,r,r.length,o,0,a,(e=>{n.resolve(e);}),(e=>{n.reject(e);}),0);}catch(c){n.reject(c);}}function Ee(e,t,r,n,o,a){try{if(void 0===a&&(a="i"),0===r.length)return void n.resolve(arcadeUtils.R);ge(e,t,r,o,0,a,(e=>{n.resolve(e);}),(e=>{n.reject(e);}),0);}catch(c){n.reject(c);}}function we(e,t,r,n,o){try{ye(e,t,r.keys(),n,o,"k");}catch(a){n.reject(a);}}function ve(e,t,r,o,a,c,i,s){try{e.next().then((l=>{try{if(null===l)c(arcadeUtils.R);else {const u=arcadeUtils.b$1.createFromGraphicLikeObject(l.geometry,l.attributes,o);u._underlyingGraphic=l,a.value=u;se(t,r.body).then((n=>{try{n===arcadeUtils.j?c(arcadeUtils.R):n instanceof arcadeUtils.M?c(n):++s>re?(s=0,setTimeout((()=>{ve(e,t,r,o,a,c,i,s);}),0)):ve(e,t,r,o,a,c,i,s);}catch(l){i(l);}}),(e=>{i(e);}));}}catch(u){i(u);}}),(e=>{i(e);}));}catch(l){i(l);}}function Ne(e,t){return request.f$11(((o,a)=>{se(e,t.right).then((c=>{try{let i=null;i="VariableDeclaration"===t.left.type?se(e,t.left):request.k$4(),i.then((()=>{try{let i="";if("VariableDeclaration"===t.left.type){const e=t.left.declarations[0].id;"Identifier"===e.type&&(i=e.name);}else "Identifier"===t.left.type&&(i=t.left.name);if(!i)throw new Error(arcadeUtils.b(t,"RUNTIME","INVALIDVARIABLE"));i=i.toLowerCase();let s=null;if(null!==e.localScope&&void 0!==e.localScope[i]&&(s=e.localScope[i]),null===s&&void 0!==e.globalScope[i]&&(s=e.globalScope[i]),null===s)return void a(new Error(arcadeUtils.b(t,"RUNTIME","VARIABLENOTDECLARED")));arcadeUtils.I$1(c)||arcadeUtils.Z(c)?ye(e,t,c,{reject:a,resolve:o},s):arcadeUtils.J(c)?Ee(e,t,c,{reject:a,resolve:o},s):c instanceof arcadeUtils.h$1||c instanceof arcadeUtils.b$1?we(e,t,c,{reject:a,resolve:o},s):arcadeUtils.A(c)?ve(c.iterator(e.abortSignal),e,t,c,s,(e=>{o(e);}),(e=>{a(e);}),0):ye(e,t,[],{reject:a,resolve:o},s);}catch(i){a(i);}}),a);}catch(i){a(i);}}),a);}))}function Ie(e,t){try{const o=t.argument;if("MemberExpression"===o.type){const a={t:null};return se(e,o.object).then((t=>{let r=null;return a.t=t,!0===o.computed?r=se(e,o.property):"Identifier"===o.property.type&&(r=request.k$4(o.property.name)),r})).then((e=>request.f$11((o=>{const c=a.t;let i;if(arcadeUtils.I$1(c)){if(!arcadeUtils.Y(e))throw new Error("Invalid Parameter");if(e<0&&(e=c.length+e),e<0||e>=c.length)throw new Error("Assignment outside of array bounds");i=arcadeUtils.ee(c[e]),c[e]="++"===t.operator?i+1:i-1;}else if(c instanceof arcadeUtils.h$1){if(!1===arcadeUtils.Z(e))throw new Error("Dictionary accessor must be a string");if(!0!==c.hasField(e))throw new Error("Invalid Parameter");i=arcadeUtils.ee(c.field(e)),c.setField(e,"++"===t.operator?i+1:i-1);}else {if(!(c instanceof arcadeUtils.b$1))throw arcadeUtils.J(c)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===arcadeUtils.Z(e))throw new Error("Feature accessor must be a string");if(!0!==c.hasField(e))throw new Error("Invalid Parameter");i=arcadeUtils.ee(c.field(e)),c.setField(e,"++"===t.operator?i+1:i-1);}!1===t.prefix?o(i):o("++"===t.operator?i+1:i-1);}))))}return request.f$11(((r,n)=>{const o="Identifier"===t.argument.type?t.argument.name.toLowerCase():"";if(!o)throw new Error("Invalid identifier");let a;return null!==e.localScope&&void 0!==e.localScope[o]?(a=arcadeUtils.ee(e.localScope[o].value),e.localScope[o]={value:"++"===t.operator?a+1:a-1,valueset:!0,node:t},void(!1===t.prefix?r(a):r("++"===t.operator?a+1:a-1))):void 0!==e.globalScope[o]?(a=arcadeUtils.ee(e.globalScope[o].value),e.globalScope[o]={value:"++"===t.operator?a+1:a-1,valueset:!0,node:t},void(!1===t.prefix?r(a):r("++"===t.operator?a+1:a-1))):void n(new Error("Variable not recognised"))}))}catch(o){return request.C$6(o)}}function be(e,t,r,n){switch(t){case"=":return e===arcadeUtils.R?null:e;case"/=":return arcadeUtils.ee(r)/arcadeUtils.ee(e);case"*=":return arcadeUtils.ee(r)*arcadeUtils.ee(e);case"-=":return arcadeUtils.ee(r)-arcadeUtils.ee(e);case"+=":return arcadeUtils.Z(r)||arcadeUtils.Z(e)?arcadeUtils.$(r)+arcadeUtils.$(e):arcadeUtils.ee(r)+arcadeUtils.ee(e);case"%=":return arcadeUtils.ee(r)%arcadeUtils.ee(e);default:throw new Error(arcadeUtils.b(n,"RUNTIME","OPERATORNOTRECOGNISED"))}}function Se(e,t){return request.f$11(((o,a)=>{const c=t.left;if("MemberExpression"===c.type)se(e,t.right).then((i=>{try{se(e,c.object).then((s=>{try{let l=null;if(!0===c.computed)l=se(e,c.property);else {if("Identifier"!==c.property.type)throw new Error("Expected computed or identifier for assignemnt target");l=request.k$4(c.property.name);}l.then((e=>{try{if(arcadeUtils.I$1(s)){if(!arcadeUtils.Y(e))throw new Error("Invalid Parameter");if(e<0&&(e=s.length+e),e<0||e>s.length)throw new Error("Assignment outside of array bounds");if(e===s.length){if("="!==t.operator)throw new Error("Invalid Parameter");s[e]=be(i,t.operator,s[e],t);}else s[e]=be(i,t.operator,s[e],t);}else if(s instanceof arcadeUtils.h$1){if(!1===arcadeUtils.Z(e))throw new Error("Dictionary accessor must be a string");if(!0===s.hasField(e))s.setField(e,be(i,t.operator,s.field(e),t));else {if("="!==t.operator)throw new Error("Invalid Parameter");s.setField(e,be(i,t.operator,null,t));}}else {if(!(s instanceof arcadeUtils.b$1))throw arcadeUtils.J(s)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===arcadeUtils.Z(e))throw new Error("Feature accessor must be a string");if(!0===s.hasField(e))s.setField(e,be(i,t.operator,s.field(e),t));else {if("="!==t.operator)throw new Error("Invalid Parameter");s.setField(e,be(i,t.operator,null,t));}}o(arcadeUtils.R);}catch(c){a(c);}}),a);}catch(l){a(l);}}),a);}catch(s){a(s);}}),a);else {const r=c.name.toLowerCase();if(null!==e.localScope&&void 0!==e.localScope[r])return void se(e,t.right).then((n=>{try{e.localScope[r]={value:be(n,t.operator,e.localScope[r].value,t),valueset:!0,node:t.right},o(arcadeUtils.R);}catch(c){a(c);}}),a);void 0!==e.globalScope[r]?se(e,t.right).then((n=>{try{e.globalScope[r]={value:be(n,t.operator,e.globalScope[r].value,t),valueset:!0,node:t.right},o(arcadeUtils.R);}catch(c){a(c);}}),a):a(new Error("Cannot assign undeclared variable"));}}))}function Te(e,t){try{return "AssignmentExpression"===t.expression.type?se(e,t.expression):(se(e,t.expression).then((e=>request.f$11((t=>{t(e===arcadeUtils.R?arcadeUtils.R:new arcadeUtils.N$1(e));})))))}catch(r){return request.C$6(r)}}function Re(e,t){return request.f$11(((r,n)=>{"AssignmentExpression"!==t.test.type&&"UpdateExpression"!==t.test.type?se(e,t.test).then((o=>{try{!0===o?se(e,t.consequent).then(r,n):!1===o?null!==t.alternate?se(e,t.alternate).then(r,n):r(arcadeUtils.R):n(new Error(arcadeUtils.b(t.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION")));}catch(a){n(a);}}),n):n(new Error(arcadeUtils.b(t.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")));}))}function Oe(e,t){try{return Ae(e,t,0)}catch(r){return ne(r)}}function Ae(e,t,r){try{return r>=t.body.length?request.k$4(arcadeUtils.R):request.f$11(((n,o)=>{se(e,t.body[r]).then((a=>{try{a instanceof arcadeUtils.M||a===arcadeUtils.j||a===arcadeUtils.D||r===t.body.length-1?n(a):Ae(e,t,r+1).then(n,o);}catch(c){o(c);}}),o);}))}catch(n){return ne(n)}}function Ue(e,t){return request.f$11(((r,n)=>{null===t.argument?r(new arcadeUtils.M(arcadeUtils.R)):se(e,t.argument).then((e=>{try{r(new arcadeUtils.M(e));}catch(t){n(t);}}),n);}))}function Ce(e,t){try{const r=t.id.name.toLowerCase();return e.globalScope[r]={valueset:!0,node:null,value:new arcadeUtils.t(t,e)},request.k$4(arcadeUtils.R)}catch(r){return ne(r)}}function Fe(e,t,r){return request.f$11(((n,o)=>{r>=t.declarations.length?n(arcadeUtils.R):se(e,t.declarations[r]).then((()=>{r===t.declarations.length-1?n(arcadeUtils.R):Fe(e,t,r+1).then((()=>{n(arcadeUtils.R);}),o);}),o);}))}function Me(e,t){try{let r=null;return r=null===t.init?request.k$4(null):se(e,t.init),null!==e.localScope?r.then((r=>request.f$11((n=>{if(r===arcadeUtils.R&&(r=null),"Identifier"!==t.id.type)throw new Error("Can only assign a regular variable");const o=t.id.name.toLowerCase();e.localScope[o]={value:r,valueset:!0,node:t.init},n(arcadeUtils.R);})))):r.then((r=>request.f$11((n=>{if("Identifier"!==t.id.type)throw new Error("Can only assign a regular variable");const o=t.id.name.toLowerCase();r===arcadeUtils.R&&(r=null),e.globalScope[o]={value:r,valueset:!0,node:t.init},n(arcadeUtils.R);}))))}catch(r){return ne(r)}}let xe=0;function Pe(e,t,n,o){let i;switch(t=t.toLowerCase()){case"hasz":{const t=e.hasZ;return void 0!==t&&t}case"hasm":{const t=e.hasM;return void 0!==t&&t}case"spatialreference":{let t=e.spatialReference._arcadeCacheId;if(void 0===t){let r=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(r=!1),r&&(xe++,e.spatialReference._arcadeCacheId=xe,t=xe);}const n=new arcadeUtils.h$1({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==t&&(n._arcadeCacheId="SPREF"+t.toString()),n}}switch(e.type){case"extent":switch(t){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const r=e[t];return void 0!==r?r:null}case"type":return "Extent"}break;case"polygon":switch(t){case"rings":i=e.cache._arcadeCacheId,void 0===i&&(xe++,i=xe,e.cache._arcadeCacheId=i);return new arcadeUtils.h$2(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,i);case"type":return "Polygon"}break;case"point":switch(t){case"x":case"y":case"z":case"m":return void 0!==e[t]?e[t]:null;case"type":return "Point"}break;case"polyline":switch(t){case"paths":i=e.cache._arcadeCacheId,void 0===i&&(xe++,i=xe,e.cache._arcadeCacheId=i);return new arcadeUtils.h$2(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,i);case"type":return "Polyline"}break;case"multipoint":switch(t){case"points":i=e.cache._arcadeCacheId,void 0===i&&(xe++,i=xe,e.cache._arcadeCacheId=i);return new arcadeUtils.i(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,i,1);case"type":return "Multipoint"}}throw new Error(arcadeUtils.b(o,"RUNTIME","PROPERTYNOTFOUND"))}function De(e,t){try{return se(e,t.object).then((o=>{try{return null===o?request.C$6(new Error(arcadeUtils.b(t,"RUNTIME","NOTFOUND"))):!1===t.computed?"Identifier"===t.property.type?o instanceof arcadeUtils.h$1||o instanceof arcadeUtils.b$1?request.k$4(o.field(t.property.name)):o instanceof request.p$12?request.k$4(Pe(o,t.property.name,e,t)):request.C$6(new Error(arcadeUtils.b(t,"RUNTIME","INVALIDTYPE"))):request.C$6(new Error(arcadeUtils.b(t,"RUNTIME","INVALIDTYPE"))):se(e,t.property).then((a=>request.f$11(((c,i)=>{if(o instanceof arcadeUtils.h$1||o instanceof arcadeUtils.b$1)arcadeUtils.Z(a)?c(o.field(a)):i(new Error(arcadeUtils.b(t,"RUNTIME","INVALIDTYPE")));else if(o instanceof request.p$12)arcadeUtils.Z(a)?c(Pe(o,a,e,t)):i(new Error(arcadeUtils.b(t,"RUNTIME","INVALIDTYPE")));else if(arcadeUtils.I$1(o))if(arcadeUtils.Y(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=o.length+a),a>=o.length||a<0)throw new Error(arcadeUtils.b(t,"RUNTIME","OUTOFBOUNDS"));c(o[a]);}else i(new Error(arcadeUtils.b(t,"RUNTIME","INVALIDTYPE")));else if(arcadeUtils.J(o))if(arcadeUtils.Y(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=o.length()+a),a>=o.length()||a<0)throw new Error(arcadeUtils.b(t,"RUNTIME","OUTOFBOUNDS"));c(o.get(a));}else i(new Error(arcadeUtils.b(t,"RUNTIME","INVALIDTYPE")));else if(arcadeUtils.Z(o))if(arcadeUtils.Y(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=o.length+a),a>=o.length||a<0)throw new Error(arcadeUtils.b(t,"RUNTIME","OUTOFBOUNDS"));c(o[a]);}else i(new Error(arcadeUtils.b(t,"RUNTIME","INVALIDTYPE")));else i(new Error(arcadeUtils.b(t,"RUNTIME","INVALIDTYPE")));}))))}catch(a){return ne(a)}}))}catch(o){return ne(o)}}function je(e,t){try{return se(e,t.argument).then((e=>request.f$11(((r,n)=>{arcadeUtils.v(e)&&"!"===t.operator?r(!e):"-"===t.operator?r(-1*arcadeUtils.ee(e)):"+"===t.operator?r(1*arcadeUtils.ee(e)):"~"===t.operator?r(~arcadeUtils.ee(e)):n(new Error(arcadeUtils.b(t,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR")));}))))}catch(r){return ne(r)}}function ke(e,t){try{const r=[];for(let n=0;n<t.elements.length;n++)r.push(se(e,t.elements[n]));return request.s$20(r).then((e=>request.f$11(((r,n)=>{for(let o=0;o<e.length;o++){if(arcadeUtils.C(e[o]))return void n(new Error(arcadeUtils.b(t,"RUNTIME","FUNCTIONCONTEXTILLEGAL")));e[o]===arcadeUtils.R&&(e[o]=null);}r(e);}))))}catch(r){return ne(r)}}function Le(e,t){try{return request.s$20([se(e,t.left),se(e,t.right)]).then((e=>request.f$11(((r,n)=>{const o=e[0],a=e[1];switch(t.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":r(arcadeUtils.be(arcadeUtils.ee(o),arcadeUtils.ee(a),t.operator));case"==":r(arcadeUtils.W(o,a));break;case"!=":r(!arcadeUtils.W(o,a));break;case"<":case">":case"<=":case">=":r(arcadeUtils.B(o,a,t.operator));break;case"+":arcadeUtils.Z(o)||arcadeUtils.Z(a)?r(arcadeUtils.$(o)+arcadeUtils.$(a)):r(arcadeUtils.ee(o)+arcadeUtils.ee(a));break;case"-":r(arcadeUtils.ee(o)-arcadeUtils.ee(a));break;case"*":r(arcadeUtils.ee(o)*arcadeUtils.ee(a));break;case"/":r(arcadeUtils.ee(o)/arcadeUtils.ee(a));break;case"%":r(arcadeUtils.ee(o)%arcadeUtils.ee(a));break;default:n(new Error(arcadeUtils.b(t,"RUNTIME","OPERATORNOTRECOGNISED")));}}))))}catch(r){return ne(r)}}function _e(e,t){return request.f$11(((r,n)=>{"AssignmentExpression"!==t.left.type&&"UpdateExpression"!==t.left.type?"AssignmentExpression"!==t.right.type&&"UpdateExpression"!==t.right.type?se(e,t.left).then((o=>{try{if(!arcadeUtils.v(o))throw new Error(arcadeUtils.b(t,"RUNTIME","ONLYBOOLEAN"));switch(t.operator){case"||":!0===o?r(o):se(e,t.right).then((e=>{try{if(!arcadeUtils.v(e))throw new Error(arcadeUtils.b(t,"RUNTIME","ONLYORORAND"));r(e);}catch(o){n(o);}}),n);break;case"&&":!1===o?r(o):se(e,t.right).then((e=>{try{if(!arcadeUtils.v(e))throw new Error(arcadeUtils.b(t,"RUNTIME","ONLYORORAND"));r(e);}catch(o){n(o);}}),n);break;default:throw new Error(arcadeUtils.b(t,"RUNTIME","ONLYORORAND"))}}catch(a){n(a);}}),n):n(new Error(arcadeUtils.b(t.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):n(new Error(arcadeUtils.b(t.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")));}))}function Ve(e,t){return request.f$11(((r,n)=>{const o=t.name.toLowerCase();if(null===e.localScope||void 0===e.localScope[o])if(void 0===e.globalScope[o])n(new Error(arcadeUtils.b(t,"RUNTIME","VARIABLENOTFOUND")));else {const t=e.globalScope[o];!0===t.valueset?r(t.value):null!==t.d?t.d.then(r,n):(t.d=se(e,t.node),t.d.then((e=>{try{t.value=e,t.valueset=!0,r(e);}catch(o){n(o);}}),n));}else {const t=e.localScope[o];!0===t.valueset?r(t.value):null!==t.d?t.d.then(r,n):(t.d=se(e,t.node),t.d.then((e=>{try{t.value=e,t.valueset=!0,r(e);}catch(o){n(o);}}),n));}}))}function Be(e,t){try{if("Identifier"!==t.callee.type)return ne(arcadeUtils.b(t,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==e.localScope&&void 0!==e.localScope[t.callee.name.toLowerCase()]){const r=e.localScope[t.callee.name.toLowerCase()];return r.value instanceof arcadeUtils.T?r.value.fn(e,t):r.value instanceof arcadeUtils.t?$e(e,t,r.value.definition):ne(arcadeUtils.b(t,"RUNTIME","NOTAFUNCTION"))}if(void 0!==e.globalScope[t.callee.name.toLowerCase()]){const r=e.globalScope[t.callee.name.toLowerCase()];return r.value instanceof arcadeUtils.T?r.value.fn(e,t):r.value instanceof arcadeUtils.t?$e(e,t,r.value.definition):ne(arcadeUtils.b(t,"RUNTIME","NOTAFUNCTION"))}return ne(arcadeUtils.b(t,"RUNTIME","NOTFOUND"))}catch(r){return ne(r)}}function Ye(e,t){return request.k$4(t.value?t.value.cooked:"")}function Ge(e,t){return request.f$11((r=>{const n=[];arcadeUtils.O(t.expressions,((t,r,o,a)=>se(e,r).then((e=>{n[o]=arcadeUtils.$(e);})))).then((()=>{let e="",o=0;for(const r of t.quasis)if(e+=r.value?r.value.cooked:"",!1===r.tail){e+=n[o]?n[o]:"",o++;}r(e);}));}))}const ze={};function qe(o){return null===o?"":arcadeUtils.I$1(o)||arcadeUtils.J(o)?"Array":arcadeUtils.E(o)?"Date":arcadeUtils.Z(o)?"String":arcadeUtils.v(o)?"Boolean":arcadeUtils.Y(o)?"Number":o instanceof arcadeUtils.e?"Attachment":o instanceof arcadeUtils.s?"Portal":o instanceof arcadeUtils.h$1?"Dictionary":o instanceof arcadeUtils.b$1?"Feature":o instanceof request.b$3?"Point":o instanceof request.v$1?"Polygon":o instanceof request.m$5?"Polyline":o instanceof request.m$12?"Multipoint":o instanceof request.M?"Extent":arcadeUtils.C(o)?"Function":arcadeUtils.A(o)?"FeatureSet":arcadeUtils.L$1(o)?"FeatureSetCollection":o===arcadeUtils.R?"":"number"==typeof o&&isNaN(o)?"Number":"Unrecognised Type"}function He(e,t,r,n){return request.f$11(((o,a)=>{se(e,t.arguments[r]).then((c=>{try{if(arcadeUtils.W(c,n))return void se(e,t.arguments[r+1]).then(o,a);{const c=t.arguments.length-r;return 1===c?void se(e,t.arguments[r]).then(o,a):(2===c&&o(null),3===c?void se(e,t.arguments[r+2]).then(o,a):void He(e,t,r+2,n).then(o,a))}}catch(i){a(i);}}),a);}))}function Ze(e,t,r,n){return request.f$11(((o,a)=>{if(!0===n)se(e,t.arguments[r+1]).then(o,a);else {3===t.arguments.length-r?se(e,t.arguments[r+2]).then(o,a):se(e,t.arguments[r+2]).then((n=>{try{if(!1===arcadeUtils.v(n))return void a(new Error("WHEN needs boolean test conditions"));Ze(e,t,r+2,n).then(o,a);}catch(c){a(c);}}));}}))}function We(e,t){try{const r=e.length,n=Math.floor(r/2);return 0===r?request.k$4([]):1===r?request.k$4([e[0]]):request.f$11(((o,a)=>{const c=[We(e.slice(0,n),t),We(e.slice(n,r),t)];request.s$20(c).then((e=>{try{Ke(e[0],e[1],t,[]).then(o,a);}catch(r){a(r);}}),a);}))}catch(r){return ne(r)}}function Ke(e,t,r,n){return request.f$11(((o,a)=>{const c=n;e.length>0||t.length>0?e.length>0&&t.length>0?r(e[0],t[0]).then((i=>{try{isNaN(i)&&(i=1),i<=0?(c.push(e[0]),e=e.slice(1)):(c.push(t[0]),t=t.slice(1)),Ke(e,t,r,n).then(o,a);}catch(s){a(s);}}),a):e.length>0?(c.push(e[0]),Ke(e=e.slice(1),t,r,n).then(o,a)):t.length>0&&(c.push(t[0]),t=t.slice(1),Ke(e,t,r,n).then(o,a)):o(n);}))}function Xe(e,t){const r=e.length,n=Math.floor(r/2);return t||(t=function(e,t){return e<t?-1:e===t?0:1}),0===r?[]:1===r?[e[0]]:Je(Xe(e.slice(0,n),t),Xe(e.slice(n,r),t),t)}function Je(e,t,r){const n=[];for(;e.length>0||t.length>0;)if(e.length>0&&t.length>0){let o=r(e[0],t[0]);isNaN(o)&&(o=1),o<=0?(n.push(e[0]),e=e.slice(1)):(n.push(t[0]),t=t.slice(1));}else e.length>0?(n.push(e[0]),e=e.slice(1)):t.length>0&&(n.push(t[0]),t=t.slice(1));return n}function Qe(e,t,r){try{const n=e.body;if(r.length!==e.params.length)return ne(new Error("Invalid Parameter calls to function."));for(let o=0;o<r.length;o++){const n=e.params[o];"Identifier"===n.type&&(t.localScope[n.name.toLowerCase()]={d:null,value:r[o],valueset:!0,node:null});}return se(t,n).then((e=>request.f$11(((t,r)=>{e instanceof arcadeUtils.M?t(e.value):e!==arcadeUtils.j?e!==arcadeUtils.D?t(e instanceof arcadeUtils.N$1?e.value:e):r(new Error("Cannot Continue from a Function")):r(new Error("Cannot Break from a Function"));}))))}catch(n){return request.C$6(n)}}function $e(e,t,r){return ie(e,t,(function(t,n,o){const a={spatialReference:e.spatialReference,services:e.services,console:e.console,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:e.depthCounter+1};if(a.depthCounter>64)throw new Error("Exceeded maximum function depth");return Qe(r,a,o)}))}function et(e){const t=function(){const t={abortSignal:e.context.abortSignal,spatialReference:e.context.spatialReference,console:e.context.console,lrucache:e.context.lrucache,interceptor:e.context.interceptor,services:e.context.services,localScope:{},globalScope:e.context.globalScope,depthCounter:e.context.depthCounter+1};if(t.depthCounter>64)throw new Error("Exceeded maximum function depth");return Qe(e.definition,t,arguments)};return t}arcadeUtils.h(ze,ce),arcadeUtils.y(ze,ce),arcadeUtils.L(ze,ce),arcadeUtils.N(ze,ce),arcadeUtils.P(ze,ce),arcadeUtils.o(ze,ce),geomasync.registerFunctions({functions:ze,compiled:!1,signatures:null,failDefferred:null,evaluateIdentifier:null,arcadeCustomFunctionHandler:null,mode:"async",standardFunction:ce,standardFunctionAsync:ie}),ze.typeof=function(e,t){return ce(e,t,(function(e,t,r){arcadeUtils.z(r,1,1);const n=qe(r[0]);if("Unrecognised Type"===n)throw new Error("Unrecognised Type");return n}))},ze.iif=function(e,t){return request.f$11(((r,n)=>{arcadeUtils.z(null===t.arguments?[]:t.arguments,3,3),se(e,t.arguments[0]).then((o=>{try{if(!1===arcadeUtils.v(o))return void n(new Error("IF Function must have a boolean test condition"));request.s$20([se(e,t.arguments[1]),se(e,t.arguments[2])]).then((e=>{r(o?e[0]:e[1]);}),n);}catch(a){n(a);}}),n);}))},ze.decode=function(e,t){return request.f$11(((r,n)=>{t.arguments.length<2?n(new Error("Missing Parameters")):2!==t.arguments.length?(t.arguments.length-1)%2!=0?se(e,t.arguments[0]).then((o=>{try{He(e,t,1,o).then(r,n);}catch(a){n(a);}}),n):n(new Error("Must have a default value result.")):se(e,t.arguments[1]).then(r,n);}))},ze.when=function(e,t){try{return t.arguments.length<3?ne("Missing Parameters"):t.arguments.length%2==0?ne("Must have a default value result."):se(e,t.arguments[0]).then((r=>request.f$11(((n,o)=>{if(!1===arcadeUtils.v(r))return void o(new Error("WHEN needs boolean test conditions"));Ze(e,t,0,r).then(n,o);}))))}catch(r){return ne(r)}},ze.sort=function(e,t){return ie(e,t,(function(e,t,r){arcadeUtils.z(r,1,2);let n=r[0];if(arcadeUtils.J(n)&&(n=n.toArray()),!1===arcadeUtils.I$1(n))return ne(Error("Illegal Argument"));if(r.length>1){if(!1===arcadeUtils.C(r[1]))return ne(Error("Illegal Argument"));return We(n,et(r[1]))}{let e=n;if(0===e.length)return request.k$4([]);const t={};for(let n=0;n<e.length;n++){const r=qe(e[n]);""!==r&&(t[r]=!0);}if(!0===t.Array||!0===t.Dictionary||!0===t.Feature||!0===t.Point||!0===t.Polygon||!0===t.Polyline||!0===t.Multipoint||!0===t.Extent||!0===t.Function)return request.k$4(e.slice(0));let r=0,o="";for(const n in t)r++,o=n;return r>1||"String"===o?e=Xe(e,(function(e,t){if(null==e||e===arcadeUtils.R)return null==t||t===arcadeUtils.R?0:1;if(null==t||t===arcadeUtils.R)return -1;const r=arcadeUtils.$(e),n=arcadeUtils.$(t);return r<n?-1:r===n?0:1})):"Number"===o?e=Xe(e,(function(e,t){return e-t})):"Boolean"===o?e=Xe(e,(function(e,t){return e===t?0:t?-1:1})):"Date"===o&&(e=Xe(e,(function(e,t){return t-e}))),request.k$4(e)}}))};const tt={failDefferred:ne,resolveDeffered:oe,fixSpatialReference:arcadeUtils.ae,parseArguments:ae,standardFunction:ce,standardFunctionAsync:ie,evaluateIdentifier:Ve,arcadeCustomFunction:et};for(const pt in ze)ze[pt]={value:new arcadeUtils.T(ze[pt]),valueset:!0,node:null};const rt=function(){};function nt(e,t){const o=new rt;null==e&&(e={}),null==t&&(t={});const a=new arcadeUtils.h$1({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});a.immutable=!1,o.textformatting={value:a,valueset:!0,node:null};for(const r in t)o[r]={value:new arcadeUtils.T(t[r]),native:!0,valueset:!0,node:null};for(const r in e)e[r]&&"esri.Graphic"===e[r].declaredClass?o[r]={value:arcadeUtils.b$1.createFromGraphic(e[r]),valueset:!0,node:null}:o[r]={value:e[r],valueset:!0,node:null};return o}function ot(e){console.log(e);}rt.prototype=ze,rt.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},rt.prototype.pi={value:Math.PI,valueset:!0,node:null};const at=tt;function ct(e){const t={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:ce,standardFunctionAsync:ie,failDefferred:ne,evaluateIdentifier:Ve,arcadeCustomFunctionHandler:et};for(let r=0;r<e.length;r++)e[r].registerFunctions(t);for(const r in t.functions)ze[r]={value:new arcadeUtils.T(t.functions[r]),valueset:!0,node:null},rt.prototype[r]=ze[r];for(let r=0;r<t.signatures.length;r++)arcadeUtils.r(t.signatures[r],"async");}function it(e,t){let r=t.spatialReference;null==r&&(r=new request.k({wkid:102100}));const n=nt(t.vars,t.customfunctions);return se({spatialReference:r,services:t.services,abortSignal:void 0===t.abortSignal||null===t.abortSignal?{aborted:!1}:t.abortSignal,globalScope:n,console:t.console?t.console:ot,lrucache:t.lrucache,interceptor:t.interceptor,localScope:null,depthCounter:1},e.body[0].body).then((e=>request.f$11(((t,r)=>{e instanceof arcadeUtils.M&&(e=e.value),e instanceof arcadeUtils.N$1&&(e=e.value),e===arcadeUtils.R&&(e=null),e!==arcadeUtils.j?e!==arcadeUtils.D?e instanceof arcadeUtils.T||e instanceof arcadeUtils.t?r(new Error("Cannot return FUNCTION")):t(e):r(new Error("Cannot return CONTINUE")):r(new Error("Cannot return BREAK"));}))))}function st(e,t){return arcadeUtils.f(e)}function lt(e,t){return arcadeUtils.S(e,t,"full")}function ut(e,t){return arcadeUtils.p(e,t)}function ft(e,t){return arcadeUtils.u(e,t)}function ht(e){return arcadeUtils.I(e)}

exports.executeScript = it;
exports.extend = ct;
exports.extractFieldLiterals = st;
exports.findFunctionCalls = ht;
exports.functionHelper = at;
exports.referencesFunction = ft;
exports.referencesMember = ut;
exports.validateScript = lt;
