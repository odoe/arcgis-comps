'use strict';

const request = require('./messageBundle-8be88d04.js');
const Graphic = require('./Graphic-0aff6059.js');
const CollectionFlattener = require('./CollectionFlattener-bc4cde45.js');
const workers = require('./workers-bde9fe32.js');
const DefaultUI = require('./DefaultUI-75d05512.js');
const screenUtils$1 = require('./screenUtils-e9e44bb6.js');
const geometry = require('./geometry-ef17530a.js');
const Viewpoint = require('./Viewpoint-bbe11330.js');
const screenUtils = require('./screenUtils-d911ae62.js');
const TileInfo = require('./TileInfo-83a1d8a2.js');
const unitBezier = require('./unitBezier-5ab0945f.js');
const projection = require('./projection-b19710fa.js');
const vec2 = require('./vec2-d000a8cb.js');
const vec2f64 = require('./vec2f64-60b3c97e.js');
require('./TileStrategy-58dbe4b8.js');
const TileStore = require('./TileStore-1f212ad3.js');
require('./TileKey-d800cfb2.js');
const Color = require('./Color-7d915caa.js');
const screenshotUtils = require('./screenshotUtils-176d2414.js');

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var p$3;let a$6=p$3=class extends request.a$2{constructor(o){super(o),this.color=new Color.h([0,0,0,1]);}clone(){return new p$3(request.l$1({color:this.color}))}};request.e([request.d({type:Color.h,json:{write:!0}})],a$6.prototype,"color",void 0),a$6=p$3=request.e([request.i("esri.webmap.background.ColorBackground")],a$6);const m$3=a$6;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class m$2{constructor(t,i,s,e){const o=t.targetGeometry,n=i.targetGeometry;e?"string"==typeof e&&(e=unitBezier.r(e)||unitBezier.t.ease):e=unitBezier.t.ease,this.easing=e,this.duration=s,this.sCenterX=o.x,this.sCenterY=o.y,this.sScale=t.scale,this.sRotation=t.rotation,this.tCenterX=n.x,this.tCenterY=n.y,this.tScale=i.scale,this.tRotation=i.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360);}applyRatio(t,i){const s=this.easing(i);let e,o,n,a;i>=1?(e=this.tCenterX,o=this.tCenterY,n=this.tRotation,a=this.tScale):(e=this.sCenterX+s*this.dCenterX,o=this.sCenterY+s*this.dCenterY,n=this.sRotation+s*this.dRotation,a=this.sScale+s*this.dScale),t.targetGeometry.x=e,t.targetGeometry.y=o,t.scale=a,t.rotation=n;}}let u$1=class extends request.p{constructor(t){super(t),this.duration=200,this.transition=null,this.easing=unitBezier.t.ease,this.view=null,this.viewpoint=null,this.viewpoint=new Viewpoint.u({targetGeometry:new request.b$2,scale:0,rotation:0}),this._updateTask=request.A({postRender:this._postRender.bind(this)}),this._updateTask.pause();}destroy(){this._updateTask.remove(),this._updateTask=null;}animate(t,i,s){this.stop();const e=this.viewpoint;DefaultUI.Z(e,i),this.transition=new m$2(this.viewpoint,t.target,s&&s.duration||this.duration,s&&s.easing||this.easing);const o=()=>{this.animation===t&&this._updateTask&&("finished"===t.state&&(this.transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null);};return t.when(o,o),this._startTime=performance.now(),this._updateTask.resume(),this.animation=t,t}animateContinous(t,i){this.stop(),this.updateFunction=i,this.viewpoint=t;const s=new DefaultUI.n({target:t.clone()}),e=()=>{this.animation===s&&this._updateTask&&(this.animation=null,this.updateFunction=null);};return s.when(e,e),this._startTime=performance.now(),this._updateTask.resume(),this.animation=s,s}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null);}_postRender(t){const i=this.animation;if(i&&i.state!==DefaultUI.n.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,t.deltaTime);else {const t=(performance.now()-this._startTime)/this.transition.duration,i=t>=1;this.transition.applyRatio(this.viewpoint,t),i&&this.animation.finish();}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone());}else this._updateTask.pause();}};request.e([request.d()],u$1.prototype,"animation",void 0),request.e([request.d()],u$1.prototype,"duration",void 0),request.e([request.d()],u$1.prototype,"transition",void 0),request.e([request.d()],u$1.prototype,"easing",void 0),request.e([request.d()],u$1.prototype,"view",void 0),request.e([request.d()],u$1.prototype,"viewpoint",void 0),u$1=request.e([request.i("esri.views.2d.AnimationManager")],u$1);const d$1=u$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class a$5{constructor(t){this.view=t,this._frameTaskHandle=null,this._updateRequested=!1,this.stationary=!0,this.updateEnabled=!0,this.animationInProgress=!1,this.prepare=()=>{this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions;},this.update=()=>{if(this._updateRequested=!1,!this.updateEnabled)return;const{basemapView:t,graphicsView:a,labelManager:s,layerViews:i,state:{id:r}}=this.view;t.baseLayerViews.forEach(this._updateLayerView,this),i.forEach(this._updateLayerView,this),t.referenceLayerViews.forEach(this._updateLayerView,this),request.r(s)&&(s.lastUpdateId!==r&&(s.viewChange(),s.lastUpdateId=r),s.updateRequested&&s.processUpdate(this._updateParameters)),request.r(a)&&(a.lastUpdateId!==r&&(a.viewChange(),a.lastUpdateId=r),a.updateRequested&&a.processUpdate(this._updateParameters)),this.view.graphicsTileStore.setViewState(this._updateParameters.state),this.animationInProgress||this._updateRequested||this._frameTaskHandle.pause();};}destroy(){this.stop();}start(){this.stationary=this.view.stationary,this._updateParameters={state:this.view.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:this.view.renderingOptions},this._stationaryHandle=this.view.watch("stationary",(e=>{this.stationary=e,this.requestFrame();})),this._frameTaskHandle=request.A(this);}stop(){this._frameTaskHandle&&(this._stationaryHandle.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1);}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame());}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume();}_updateLayerView(e){const t=this.view.state,a=e.lastUpdateId;null!=a&&(this.stationary||e.moving)||(e.moving=!0,e.moveStart()),a!==t.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=t.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&e.layerViews.forEach(this._updateLayerView,this);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function t$3(){return Promise.all([Promise.resolve().then(function () { return require('./webgl-5afb8d78.js'); }),Promise.resolve().then(function () { return require('./mapViewDeps-94950719.js'); })])}const s$3=()=>t$3().then((()=>Promise.resolve().then(function () { return require('./TileLayerView2D-eef28ee4.js'); }))),a$4=()=>t$3().then((()=>Promise.resolve().then(function () { return require('./FeatureLayerView2D-7bf75e1e.js'); }))),i$3={"base-dynamic":()=>t$3().then((()=>Promise.resolve().then(function () { return require('./BaseDynamicLayerView2D-b01b9169.js'); }))),"base-tile":s$3,"bing-maps":s$3,csv:a$4,"geo-rss":()=>t$3().then((()=>Promise.resolve().then(function () { return require('./GeoRSSLayerView2D-446e5b54.js'); }))),feature:a$4,geojson:a$4,graphics:()=>t$3().then((()=>Promise.resolve().then(function () { return require('./GraphicsLayerView2D-705ede81.js'); }))),group:()=>t$3().then((()=>Promise.resolve().then(function () { return require('./GroupLayerView2D-2dfab664.js'); }))),imagery:()=>t$3().then((()=>Promise.resolve().then(function () { return require('./ImageryLayerView2D-06888989.js'); }))),"imagery-tile":()=>t$3().then((()=>Promise.resolve().then(function () { return require('./ImageryTileLayerView2D-7b965316.js'); }))),kml:()=>t$3().then((()=>Promise.resolve().then(function () { return require('./KMLLayerView2D-e7c0a6cf.js'); }))),"map-image":()=>t$3().then((()=>Promise.resolve().then(function () { return require('./MapImageLayerView2D-97ea7157.js'); }))),"map-notes":()=>t$3().then((()=>Promise.resolve().then(function () { return require('./MapNotesLayerView2D-2ad22723.js'); }))),"ogc-feature":()=>t$3().then((()=>Promise.resolve().then(function () { return require('./OGCFeatureLayerView2D-9e246b7a.js'); }))),"open-street-map":s$3,route:()=>t$3().then((()=>Promise.resolve().then(function () { return require('./RouteLayerView2D-c3a04859.js'); }))),stream:()=>t$3().then((()=>Promise.resolve().then(function () { return require('./StreamLayerView2D-ce8bb4fe.js'); }))),"subtype-group":()=>t$3().then((()=>Promise.resolve().then(function () { return require('./SubtypeGroupLayerView2D-ed354210.js'); }))),tile:s$3,"vector-tile":()=>t$3().then((()=>Promise.resolve().then(function () { return require('./VectorTileLayerView2D-feffac6e.js'); }))),wcs:()=>t$3().then((()=>Promise.resolve().then(function () { return require('./ImageryTileLayerView2D-7b965316.js'); }))),"web-tile":s$3,wfs:a$4,wms:()=>t$3().then((()=>Promise.resolve().then(function () { return require('./WMSLayerView2D-73ccf30f.js'); }))),wmts:()=>t$3().then((()=>Promise.resolve().then(function () { return require('./WMTSLayerView2D-fe04181e.js'); }))),analysis:null,"base-elevation":null,"building-scene":null,elevation:null,"integrated-mesh":null,"point-cloud":null,voxel:null,scene:null,unknown:null,unsupported:null};function o$3(r){const t=r.declaredClass?r.declaredClass.slice(r.declaredClass.lastIndexOf(".")+1):"Unknown",s=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new request.s(`${s}:view-not-supported`,`${t} is not supported in 2D`)}const l$1={hasLayerViewModule:e=>request.r(i$3[e.type]),importLayerView:e=>{const t=i$3[e.type];if(!request.r(t))throw o$3(e);return t(e)}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function o$2(o,m){const{spatialReference:r}=m,i=[m.x,m.y];let s=Number.POSITIVE_INFINITY,x=0,c=0;const a=[0,0],f="extent"===o.type?[[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]]]:o.rings;for(const n of f)for(let o=0;o<n.length-1;o++){geometry.o(a,i,n,o);const m=vec2.d(i,a);m<s&&(s=m,x=a[0],c=a[1]);}return {coordinate:new request.b$2({x,y:c,spatialReference:r}),distance:s}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var u;const g=request.s$1.getLogger("esri.views.MapView");let h$1=u=class extends request.p{constructor(e){super(e),this.geometry=null,this.spatialReference=null;}get normalizedGeometry(){return request.t$1(this.geometry)||!this.spatialReference?null:this.spatialReference.equals(this.geometry.spatialReference)?this.geometry:request.g$3(this.geometry,this.spatialReference)?request.M$2(this.geometry,this.spatialReference):projection.H()?projection.O(this.geometry,this.spatialReference):(g.error("#constraints.geometry","unsupported coordinate system. The source geometry cannot be projected to the view's coordinate system. The projection engine cannot be loaded.",{geometry:this.geometry}),null)}constrain(e,r){if(request.t$1(this.normalizedGeometry))return e;const t=e.targetGeometry;if("extent"===this.normalizedGeometry.type?request.r$5(this.normalizedGeometry,t):request.c$1(this.normalizedGeometry,t))return e;const{coordinate:s}=o$2(this.normalizedGeometry,t);return s?(e.targetGeometry=s,e):e}clone(){var e,r;return new u({geometry:null==(e=this.geometry)?void 0:e.clone(),spatialReference:null==(r=this.spatialReference)?void 0:r.clone()})}};request.e([request.d({constructOnly:!0})],h$1.prototype,"geometry",void 0),request.e([request.d({readOnly:!0})],h$1.prototype,"normalizedGeometry",null),request.e([request.d({constructOnly:!0})],h$1.prototype,"spatialReference",void 0),h$1=u=request.e([request.i("esri.views.2d.constraints.GeometryConstraint")],h$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var s$2;let a$3=s$2=class extends request.p{constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0;}constrain(o,r){return this.enabled&&r?(this.rotationEnabled||(o.rotation=r.rotation),o):o}clone(){return new s$2({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};request.e([request.d()],a$3.prototype,"enabled",void 0),request.e([request.d()],a$3.prototype,"rotationEnabled",void 0),a$3=s$2=request.e([request.i("esri.views.2d.constraints.RotationConstraint")],a$3);const n$1=a$3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var a$2;let c$4=a$2=class extends request.p{constructor(e){super(e),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0;}initialize(){let e,{lods:t,minScale:o,maxScale:s,minZoom:i,maxZoom:a}=this,c=-1,r=-1,l=!1,n=!1;if(0!==o&&0!==s&&o<s&&([o,s]=[s,o]),!t||!t.length)return this._set("effectiveMinScale",o),void this._set("effectiveMaxScale",s);t=t.map((e=>e.clone())),t.sort(((e,t)=>t.scale-e.scale)),t.forEach(((e,t)=>e.level=t));for(const f of t)!l&&o>0&&o>=f.scale&&(c=f.level,l=!0),!n&&s>0&&s>=f.scale&&(r=e?e.level:-1,n=!0),e=f;-1===i&&(i=0===o?0:c),-1===a&&(a=0===s?t.length-1:r),i=Math.max(i,0),i=Math.min(i,t.length-1),a=Math.max(a,0),a=Math.min(a,t.length-1),i>a&&([i,a]=[a,i]),o=t[i].scale,s=t[a].scale,t.splice(0,i),t.splice(a-i+1,t.length),t.forEach(((e,t)=>{this._lodByScale[e.scale]=e,this._scales[t]=e.scale;})),this._set("effectiveLODs",t),this._set("effectiveMinZoom",i),this._set("effectiveMaxZoom",a),this._set("effectiveMinScale",o),this._set("effectiveMaxScale",s);}constrain(e,t){if(t&&e.scale===t.scale)return e;const o=this.effectiveMinScale,s=this.effectiveMaxScale,i=e.targetGeometry,a=t&&t.targetGeometry,c=0!==s&&e.scale<s,r=0!==o&&e.scale>o;if(c||r){const c=r?o:s;if(a){const o=(c-t.scale)/(e.scale-t.scale);i.x=a.x+(i.x-a.x)*o,i.y=a.y+(i.y-a.y)*o;}e.scale=c;}return this.snapToZoom&&this.effectiveLODs&&(e.scale=this._getClosestScale(e.scale)),e}fit(e){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(e,null);const t=this.scaleToZoom(e.scale),o=Math.abs(t-Math.floor(t));return e.scale=this.zoomToScale(o>.99?Math.round(t):Math.floor(t)),e}zoomToScale(e){if(!this.effectiveLODs)return 0;e-=this.effectiveMinZoom,e=Math.max(0,e);const t=this._scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];const o=Math.round(e-.5),s=Math.round(e);return t[s]+(s-e)*(t[o]-t[s])}scaleToZoom(e){if(!this.effectiveLODs)return -1;const t=this._scales;let o,s;if(e>=t[0])return this.effectiveMinZoom;if(e<=t[t.length-1])return this.effectiveMaxZoom;for(let i=0;i<t.length-1;i++){if(o=t[i],s=t[i+1],s===e){return i+this.effectiveMinZoom+1}if(o>e&&s<e){return i+this.effectiveMinZoom+1-(e-s)/(o-s)}}}snapToClosestScale(e){if(!this.effectiveLODs)return e;const t=this.scaleToZoom(e);return this.zoomToScale(Math.round(t))}snapToNextScale(e,t=.5){if(!this.effectiveLODs)return e*t;const o=Math.round(this.scaleToZoom(e));return this.zoomToScale(o+1)}snapToPreviousScale(e,t=2){if(!this.effectiveLODs)return e*t;const o=Math.round(this.scaleToZoom(e));return this.zoomToScale(o-1)}clone(){return new a$2({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(e){return this._lodByScale[e]||(e=this._scales.reduce(((t,o)=>Math.abs(o-e)<=Math.abs(t-e)?o:t),this._scales[0])),this._lodByScale[e].scale}};request.e([request.d({readOnly:!0})],c$4.prototype,"effectiveLODs",void 0),request.e([request.d({readOnly:!0})],c$4.prototype,"effectiveMinZoom",void 0),request.e([request.d({readOnly:!0})],c$4.prototype,"effectiveMaxZoom",void 0),request.e([request.d({readOnly:!0})],c$4.prototype,"effectiveMinScale",void 0),request.e([request.d({readOnly:!0})],c$4.prototype,"effectiveMaxScale",void 0),request.e([request.d({type:[TileInfo.p]})],c$4.prototype,"lods",void 0),request.e([request.d()],c$4.prototype,"minZoom",void 0),request.e([request.d()],c$4.prototype,"maxZoom",void 0),request.e([request.d()],c$4.prototype,"minScale",void 0),request.e([request.d()],c$4.prototype,"maxScale",void 0),request.e([request.d()],c$4.prototype,"snapToZoom",void 0),c$4=a$2=request.e([request.i("esri.views.2d.constraints.ZoomConstraint")],c$4);const r=c$4;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const p$2={base:null,key:"type",typeMap:{extent:request.M,polygon:geometry.v}};let c$3=class extends request.n$2.EventedAccessor{constructor(){super(...arguments),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0;}initialize(){this.watch(["_zoom","_rotation"],this.emit.bind(this,"update"),!0);}destroy(){this.view=null,this._set("_zoom",null),this._set("_rotation",null);}set geometry(o){o?this._set("geometry",o):this._set("geometry",null);}get _defaultLODs(){const o=this.get("view.defaultsFromMap.tileInfo"),t=this.get("view.spatialReference");return o&&t&&o.spatialReference.equals(t)?o.lods:null}get _geometry(){return new h$1({geometry:this.geometry,spatialReference:this.view.spatialReference})}get _rotation(){return new n$1({rotationEnabled:this.rotationEnabled})}get _zoom(){return new r({lods:this.lods||this._defaultLODs,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale,snapToZoom:this.snapToZoom})}canZoomInTo(o){const t=this.effectiveMaxScale;return 0===t||o>=t}canZoomOutTo(o){const t=this.effectiveMinScale;return 0===t||o<=t}constrain(o,t){return this._zoom.constrain(o,t),this._rotation.constrain(o,t),this._geometry.constrain(o,t),o}constrainByGeometry(o){return this._geometry.constrain(o)}fit(o){return this._zoom.fit(o)}zoomToScale(o){return this._zoom.zoomToScale(o)}scaleToZoom(o){return this._zoom.scaleToZoom(o)}snapScale(o){return this._zoom.snapToClosestScale(o)}snapToNextScale(o){return this._zoom.snapToNextScale(o)}snapToPreviousScale(o){return this._zoom.snapToPreviousScale(o)}};request.e([request.d({readOnly:!0,aliasOf:"_zoom.effectiveLODs"})],c$3.prototype,"effectiveLODs",void 0),request.e([request.d({readOnly:!0,aliasOf:"_zoom.effectiveMinScale"})],c$3.prototype,"effectiveMinScale",void 0),request.e([request.d({readOnly:!0,aliasOf:"_zoom.effectiveMaxScale"})],c$3.prototype,"effectiveMaxScale",void 0),request.e([request.d({readOnly:!0,aliasOf:"_zoom.effectiveMinZoom"})],c$3.prototype,"effectiveMinZoom",void 0),request.e([request.d({readOnly:!0,aliasOf:"_zoom.effectiveMaxZoom"})],c$3.prototype,"effectiveMaxZoom",void 0),request.e([request.d({types:p$2,value:null})],c$3.prototype,"geometry",null),request.e([request.d({type:[TileInfo.p]})],c$3.prototype,"lods",void 0),request.e([request.d()],c$3.prototype,"minScale",void 0),request.e([request.d()],c$3.prototype,"maxScale",void 0),request.e([request.d()],c$3.prototype,"minZoom",void 0),request.e([request.d()],c$3.prototype,"maxZoom",void 0),request.e([request.d()],c$3.prototype,"rotationEnabled",void 0),request.e([request.d()],c$3.prototype,"snapToZoom",void 0),request.e([request.d()],c$3.prototype,"view",void 0),request.e([request.d()],c$3.prototype,"_defaultLODs",null),request.e([request.d({type:h$1})],c$3.prototype,"_geometry",null),request.e([request.d({type:n$1})],c$3.prototype,"_rotation",null),request.e([request.d({readOnly:!0,type:r})],c$3.prototype,"_zoom",null),c$3=request.e([request.i("esri.views.2d.MapViewConstraints")],c$3);const y=c$3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let c$2=class extends request.p{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0;}};request.e([request.d()],c$2.prototype,"left",void 0),request.e([request.d()],c$2.prototype,"top",void 0),request.e([request.d()],c$2.prototype,"right",void 0),request.e([request.d()],c$2.prototype,"bottom",void 0),c$2=request.e([request.i("esri.views.2d.PaddedViewState.Padding")],c$2);let h=class extends DefaultUI.U{constructor(...t){super(...t),this.paddedViewState=new DefaultUI.U,this._updateContent=(()=>{const t=vec2f64.n();return ()=>{const e=this._get("size"),s=this._get("padding");if(!e||!s)return;const o=this.paddedViewState;vec2.r(t,s.left+s.right,s.top+s.bottom),vec2.o(t,e,t),vec2.a(o.size,t);const a=o.viewpoint;a&&(this.viewpoint=a);}})(),this.watch(["size","padding"],this._updateContent,!0),this.padding=new c$2,this.size=[0,0];}set padding(t){this._set("padding",t||new c$2);}set viewpoint(t){if(t){const e=t.clone();this.paddedViewState.viewpoint=t,DefaultUI.bt(e,t,this._get("size"),this._get("padding"));const s=this._viewpoint2D,o=e.targetGeometry;s.center[0]=o.x,s.center[1]=o.y,s.rotation=e.rotation,s.scale=e.scale,s.spatialReference=o.spatialReference,this._update();}}};request.e([request.d()],h.prototype,"paddedViewState",void 0),request.e([request.d({type:c$2})],h.prototype,"padding",null),request.e([request.d()],h.prototype,"viewpoint",null),h=request.e([request.i("esri.views.2d.PaddedViewState")],h);const m$1=h;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const s$1=s=>-1!==s.indexOf("Brush");class e$2{constructor(){this._names=new Map;}begin(e){this._names.has(e)||(this._names.set(e,!1),s$1(e)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${e}.Start`));}end(s){this._names.has(s)&&!this._names.get(s)&&(this._names.set(s,!0),performance.mark(`Esri.${s}.End`));}record(s){this._names.has(s)||(this._names.set(s,!0),performance.mark(`Esri.${s}`));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const N$1=request.s$1.getLogger("esri.views.MapView");function q(t){return t&&"esri.Viewpoint"===t.declaredClass}const L$1=160;let A=class extends(DefaultUI.a(DefaultUI.P)){constructor(t){super(t),this._stationaryTimer=null,this.frameTask=new a$5(this),this.featuresTilingScheme=null,this.fullOpacity=1,this.graphicsView=null,this.initialExtent=null,this.labelManager=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.resizeAlign="center",this.supportsGround=!1,this.timeline=new e$2,this.type="2d",this.constraints=new y,this.padding={top:0,right:0,bottom:0,left:0};const e=this.handles,i=()=>this.notifyChange("updating");e.add([this.watch("viewpoint",(()=>{this._lastStationaryEventTimestamp=performance.now(),this._flipStationary(L$1);}),!0),this.on("resize",(t=>this._resizeHandler(t))),this.watch("animationManager.animation",(t=>{this.animation=t;})),this.allLayerViews.on("change",(()=>{i(),e.remove("map-view-base-layerViewsUpdating"),e.add(this.allLayerViews.map((t=>t.watch("updating",i))),"map-view-base-layerViewsUpdating");}))],"map-view-base");}destroy(){this.destroyed||(this._set("preconditionsReady",!1),this._gotoTask=this.frameTask=null);}set animation(t){const e=this._get("animation");if(t===e)return;if(e&&e.stop(),!t||t.isFulfilled())return void this._set("animation",null);this._set("animation",t),this.frameTask.animationInProgress=!0;const i=()=>{t===this._get("animation")&&(this._set("animation",null),this.frameTask.requestFrame()),this.frameTask.animationInProgress=!1;};t.when(i,i);}get center(){if(!this.ready)return this._get("center");const{center:t,spatialReference:e}=this.state.paddedViewState;return new request.b$2({x:t[0],y:t[1],spatialReference:e})}set center(t){if(null==t)return;if(!this._normalizeInput(t))return void N$1.error("#center",`incompatible spatialReference ${JSON.stringify(t.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`);if(!this.ready)return this._set("center",t),void this.notifyChange("initialExtentRequired");const e=this.viewpoint;DefaultUI.wt(e,e,t),this.viewpoint=e;}set constraints(t){const e=this._get("constraints");e&&(this.handles.remove("map-view-base-constraints"),e.destroy()),this._set("constraints",t),t&&(t.view=this,this.ready&&(this.state.viewpoint=t.fit(this.state.paddedViewState.viewpoint)),this.handles.add(t.on("update",(()=>{this.ready&&this.state&&(this.state.viewpoint=t.fit(this.state.paddedViewState.viewpoint));})),"map-view-base-constraints"));}get extent(){return this.ready?this.state.paddedViewState.extent.clone():this._get("extent")}set extent(t){if(null==t)return;const e=this._normalizeInput(t);if(!e)return void N$1.error("#center",`incompatible spatialReference ${JSON.stringify(t.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`);if(!e.width||!e.height)return void N$1.error("#extent","invalid extent size");if(!this.ready)return this._set("extent",e),this._set("center",null),this._set("viewpoint",null),this._set("scale",0),this._set("zoom",-1),void this.notifyChange("initialExtentRequired");const i=this.viewpoint;DefaultUI.tt(i,i,e,this.size,{constraints:this.constraints}),this.viewpoint=i;}get graphicsTileStore(){return new TileStore.l(this.featuresTilingScheme)}get initialExtentRequired(){const{extent:t,center:e,scale:i,viewpoint:s,zoom:n}=this;return !this.get("map.initialViewProperties.viewpoint")&&(!t&&((!e||0===i&&-1===n)&&!s))}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(t){this.ready?(this.state.padding=t,this._set("padding",this.state.padding)):this._set("padding",t);}get resolution(){return this.state?this.state.resolution:0}get rotation(){return this.ready?this.state.rotation:this._get("rotation")}set rotation(t){if(isNaN(t))return;if(!this.ready)return void this._set("rotation",t);const e=this.viewpoint;DefaultUI.kt(e,e,t),this.viewpoint=e;}get scale(){return this.ready?this.state.scale:this._get("scale")}set scale(t){if(!t||isNaN(t))return;if(!this.ready){this._set("scale",t),this._set("zoom",-1);const e=this._get("extent");return e&&(this._set("extent",null),this._set("center",e.center)),void this.notifyChange("initialExtentRequired")}const e=this.viewpoint;DefaultUI.Rt(e,e,t),this.viewpoint=e;}get stationary(){return !(this.animation||this.navigating||this._get("resizing")||this._stationaryTimer)}get updating(){return !this.destroyed&&(!0===this.get("layerViewManager.updating")||!0===this.get("labelManager.updating")||!0===this.get("graphicsView.updating")||this.allLayerViews.some((t=>!t.destroyed&&!("layerViews"in t)&&!0===t.updating)))}get viewpoint(){if(!this.ready)return this._get("viewpoint");const t=this.state.paddedViewState;return t&&t.viewpoint.clone()}set viewpoint(t){if(null==t)return;const i=this._normalizeInput(t);if(!i)return void(!t.scale||isNaN(t.scale)?N$1.error("#viewpoint",`invalid scale value of ${t.scale}`):request.t$1(t.targetGeometry)?N$1.error("#viewpoint","geometry not defined"):N$1.error("#viewpoint",`incompatible spatialReference ${JSON.stringify(t.targetGeometry.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`));if(!this.ready)return this._set("viewpoint",i),this._set("extent",null),this._set("center",null),this._set("zoom",-1),this._set("scale",0),void this.notifyChange("initialExtentRequired");const s=new Viewpoint.u({targetGeometry:new request.b$2,scale:0,rotation:0});DefaultUI.Z(s,i),this.constraints.constrain(s,this.state.paddedViewState.viewpoint),this.state.viewpoint=s,this.frameTask.requestFrame(),this._set("viewpoint",s);}get zoom(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")}set zoom(t){if(null==t)return;if(!this.ready){this.notifyChange("initialExtentRequired"),this._set("zoom",t),this._set("scale",0);const e=this._get("extent");e&&(this._set("extent",null),this._set("center",e.center));}if(!this.constraints.effectiveLODs)return;const e=this.viewpoint;DefaultUI.Rt(e,e,this.constraints.zoomToScale(t)),this.viewpoint=e,this._set("zoom",this.constraints.scaleToZoom(this.scale));}goTo(t,e){if(t)return this.animation&&(this.animation=null),this._createAnimation(),request.d$2(this,"ready",e&&e.signal).then((()=>{const i={animate:!0,...e},s=DefaultUI.ht(t,this);return this.animation.update(s),this._gotoTask={},i.animate?this._gotoAnimated(s,i):this._gotoImmediate(s,i)}));N$1.error("#goTo()","target cannot be null or undefined");}hitTest(t){return Promise.reject("Should be implemented by subclasses")}popupHitTest(t){return this.hitTest(t).then((e=>({...e,mapPoint:this.toMap(t)})))}toMap(t){if(!this.ready)return null;const e=[0,0],[i,s]=this.state.toMap(e,[t.x,t.y]),n=this.spatialReference;return new request.b$2({x:i,y:s,spatialReference:n})}isTileInfoRequired(){return !0}toScreen(t){if(!this.ready)return null;const e=this._normalizeInput(t),i=[e.x,e.y];return this.state.toScreen(i,i),screenUtils.c(i[0],i[1])}pixelSizeAt(){return this.ready?this.state.resolution:(N$1.error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}requestUpdate(){this.ready&&this.frameTask.requestUpdate();}getDefaultSpatialReference(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||null}isSpatialReferenceSupported(t,e){return !(!e&&!this._get("ready"))||null!==this._getDefaultViewpoint()}importLayerView(t){return l$1.importLayerView(t)}hasLayerViewModule(t){return l$1.hasLayerViewModule(t)}_createAnimation(){return this.animation&&!this.animation.done||(this.animation=new DefaultUI.n),this.animation}_cancellableGoTo(t,e,i){const s=()=>t===this._gotoTask,n=i.then((()=>{s()&&(this.animation=null);})).catch((t=>{throw s()&&(this.animation=null,e.done||(e.stop(),this.frameTask.animationInProgress=!1)),t})),a=new Promise((t=>t(n)));return e.when().catch((()=>{s()&&a.cancel&&a.cancel();})),a}_gotoImmediate(t,e){const s=this._gotoTask,n=this.animation,a=t.then((t=>{if(request.h(e),s!==this._gotoTask)throw new request.s("view:goto-interrupted","Goto was interrupted");this.viewpoint=n.target=t,n.finish();}));return this._cancellableGoTo(s,n,a)}_gotoAnimated(t,e){const s=this._gotoTask,n=this.animation,a=t.then((t=>{if(request.h(e),s!==this._gotoTask)throw new request.s("view:goto-interrupted","Goto was interrupted");return n.update(t),this.animationManager.animate(n,this.viewpoint,e),n.when().then((()=>{}),(()=>{}))}));return this._cancellableGoTo(s,n,a)}_resizeHandler(t){const e=this.state;if(!e)return;let i=this.state.paddedViewState.viewpoint;const s=this.state.paddedViewState.size.concat();e.size=[t.width,t.height],DefaultUI.Gt(i,i,s,this.state.paddedViewState.size,this.resizeAlign),i=this.constraints.constrain(i,null),this.state.viewpoint=i;}_startup(){const t=this._getDefaultViewpoint();this.constraints.view=this,this.constraints.fit(t),this._set("animationManager",new d$1({view:this})),this._set("state",new m$1({padding:this._get("padding"),size:this.size,viewpoint:t})),this._set("featuresTilingScheme",new TileStore.h(TileInfo.j.create({spatialReference:this.spatialReference,size:512,numLODs:36}))),this._set("ready",!0),this.frameTask&&this.frameTask.start();}_teardown(){this.frameTask&&this.frameTask.stop(),this._set("ready",!1),this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null);const{center:[t,e],spatialReference:i,rotation:s,scale:n}=this.state.paddedViewState,a=new request.b$2({x:t,y:e,spatialReference:i});this._set("viewpoint",null),this._set("extent",null),this._set("center",a),this._set("zoom",-1),this._set("rotation",s),this._set("scale",n),this._set("spatialReference",i),this.constraints.view=null,this.animationManager.destroy(),this._set("animationManager",null),this._set("state",null),this.animation=null;}_flipStationary(t){return null!==this._stationaryTimer||(this._stationaryTimer=setTimeout((()=>{this._stationaryTimer=null;const t=performance.now()-this._lastStationaryEventTimestamp;t<L$1&&(this._stationaryTimer=this._flipStationary(t));}),t)),this._stationaryTimer}_normalizeInput(t,e=this.spatialReference){const i=t&&t.targetGeometry||t;return e?i?e.equals(i.spatialReference)?t:request.g$3(i,e)?q(t)?(t.targetGeometry=request.M$2(i,e),t):request.M$2(i,e):null:null:t}_getDefaultViewpoint(){const t=this.constraints,i={zoom:this._get("zoom"),scale:this._get("scale"),center:this._normalizeInput(this._get("center")),extent:this._normalizeInput(this._get("extent")),rotation:this._get("rotation"),viewpoint:this._normalizeInput(this._get("viewpoint")),spatialReference:this._userSpatialReference};t.effectiveLODs?-1!==i.zoom&&(i.scale=t.zoomToScale(i.zoom)):i.zoom=-1;let s=null,n=null,r=0;const o=i.viewpoint&&i.viewpoint.rotation,l=i.viewpoint&&i.viewpoint.targetGeometry;request.r(l)&&("extent"===l.type?s=l:"point"===l.type&&(n=l,r=i.viewpoint.scale));const p=this._normalizeInput(this.get("map.initialViewProperties.viewpoint.targetGeometry.extent")),h=this._normalizeInput(this.initialExtent),d=i.extent||s||p||h,m=i.center||n||d&&d.center,c=this.get("map.initialViewProperties.viewpoint.scale"),u=i.scale||r||c||d&&DefaultUI.J(d,this.size),g=this.get("map.initialViewProperties.viewpoint.rotation"),y=i.rotation||o||g||0;return m&&u?new Viewpoint.u({targetGeometry:m,scale:u,rotation:y}):null}};request.e([request.d()],A.prototype,"_stationaryTimer",void 0),request.e([request.d()],A.prototype,"animation",null),request.e([request.d({readOnly:!0})],A.prototype,"animationManager",void 0),request.e([request.d({value:null,type:request.b$2,dependsOn:["state.id","ready"]})],A.prototype,"center",null),request.e([request.d({type:y})],A.prototype,"constraints",null),request.e([request.d({value:null,type:request.M,dependsOn:["state.id","ready"]})],A.prototype,"extent",null),request.e([request.d({readOnly:!0})],A.prototype,"featuresTilingScheme",void 0),request.e([request.d()],A.prototype,"fullOpacity",void 0),request.e([request.d({readOnly:!0})],A.prototype,"graphicsTileStore",null),request.e([request.d()],A.prototype,"graphicsView",void 0),request.e([request.d({type:request.M})],A.prototype,"initialExtent",void 0),request.e([request.d({dependsOn:["map.initialViewProperties?.viewpoint"]})],A.prototype,"initialExtentRequired",null),request.e([request.d()],A.prototype,"labelManager",void 0),request.e([request.d({value:{top:0,right:0,bottom:0,left:0},cast:t=>({top:0,right:0,bottom:0,left:0,...t})})],A.prototype,"padding",null),request.e([request.d({type:Object})],A.prototype,"renderingOptions",void 0),request.e([request.d()],A.prototype,"resizeAlign",void 0),request.e([request.d({readOnly:!0,dependsOn:["state.id"]})],A.prototype,"resolution",null),request.e([request.d({value:0,type:Number,dependsOn:["state.id","ready"]})],A.prototype,"rotation",null),request.e([request.d({value:0,type:Number,dependsOn:["state.id","ready"]})],A.prototype,"scale",null),request.e([request.d({type:request.k,dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],A.prototype,"spatialReference",void 0),request.e([request.d({readOnly:!0})],A.prototype,"state",void 0),request.e([request.d({dependsOn:["animation","navigating","resizing","_stationaryTimer"]})],A.prototype,"stationary",null),request.e([request.d({readOnly:!0})],A.prototype,"supportsGround",void 0),request.e([request.d({type:e$2,readOnly:!0})],A.prototype,"timeline",void 0),request.e([request.d({readOnly:!0})],A.prototype,"type",void 0),request.e([request.d({readOnly:!0,dependsOn:["layerViewManager.updating","labelManager.updating","graphicsView?.updating"]})],A.prototype,"updating",null),request.e([request.d({value:null,type:Viewpoint.u,dependsOn:["state.id","ready"]})],A.prototype,"viewpoint",null),request.e([request.d({value:-1,dependsOn:["state.id"]})],A.prototype,"zoom",null),A=request.e([request.i("esri.views.MapViewBase")],A);const U=A;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class a$1 extends screenUtils$1.i{constructor(t,i){super(!0),this.view=t,this.registerIncoming("double-click",i,(t=>this._handleDoubleClick(t,i)));}_handleDoubleClick(t,a){DefaultUI.t(t.data,"primary")&&(t.stopPropagation(),a?this.view.mapViewNavigation.zoomOut([t.data.x,t.data.y]):this.view.mapViewNavigation.zoomIn([t.data.x,t.data.y]));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class e$1 extends screenUtils$1.i{constructor(t,e,a){super(!0),this.view=t,this.pointerType=e,this.registerIncoming("double-tap-drag",a,(t=>this._handleDoubleTapDrag(t)));}_handleDoubleTapDrag(t){const{data:e}=t,{pointerType:a}=e;if(a!==this.pointerType)return;t.stopPropagation();const{action:s,delta:i}=e,{view:r}=this,{mapViewNavigation:n}=r;switch(s){case"begin":{const{scale:t}=r;this._startScale=t,this._currentScale=t,this._previousDelta=i,n.begin();break}case"update":{if(this._previousDelta.y===i.y)return;this._previousDelta=i;const t=1.015**i.y,e=this._startScale*t,a=e/this._currentScale;n.setViewpointImmediate(a),this._currentScale=e;break}case"end":{const{constraints:t}=r,{effectiveLODs:e,snapToZoom:a}=t;if(!a||!e)return void n.end();const s=t.snapScale(this._currentScale),o=(i.y>0?Math.max(s,t.snapToPreviousScale(this._startScale)):Math.min(s,t.snapToNextScale(this._startScale)))/this._currentScale;n.zoom(o);break}}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class n extends screenUtils$1.i{constructor(i,n,o){super(!0),this.view=i,this.pointerAction=n,this.registerIncoming("drag",o,(t=>this._handleDrag(t))),this.registerIncoming("pointer-down",(()=>this.stopMomentumNavigation()));const e=this.view.mapViewNavigation;this.dragEventSeparator=new DefaultUI.t$1({start:(t,i)=>{e.pan.begin(this.view,i.data),i.stopPropagation();},update:(t,i)=>{e.pan.update(this.view,i.data),i.stopPropagation();},end:(t,i)=>{e.pan.end(this.view,i.data),i.stopPropagation();},condition:(t,i)=>1===t&&DefaultUI.t(i.data,this.pointerAction)});}_handleDrag(t){const i=this.view.mapViewNavigation;i.pinch.zoomMomentum||i.pinch.rotateMomentum?this.stopMomentumNavigation():this.dragEventSeparator.handle(t);}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class o$1 extends screenUtils$1.i{constructor(a,o,r){super(!0),this.view=a,this.pointerAction=o;const e=this.view.mapViewNavigation;this.dragEventSeparator=new DefaultUI.t$1({start:(t,a)=>{e.rotate.begin(this.view,a.data),a.stopPropagation();},update:(t,a)=>{e.rotate.update(this.view,a.data),a.stopPropagation();},end:(t,a)=>{e.rotate.end(),a.stopPropagation();},condition:(t,a)=>1===t&&DefaultUI.t(a.data,this.pointerAction)}),this.registerIncoming("drag",r,(t=>this.dragEventSeparator.handle(t)));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class l extends screenUtils$1.i{constructor(i){super(!0),this.view=i,this.frameTask=null,this.watchHandles=new request.u,this.currentDevice=null,this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.handle=this.registerIncoming("gamepad",(t=>this.handleEvent(t))),this.handle.pause();}onInstall(t){super.onInstall(t),this.watchHandles.add([request.i$1(this.view.navigation.gamepad,"enabled",(t=>{t?(this.handle.resume(),this.frameTask||(this.frameTask=request.A({update:t=>this.frameUpdate(t.deltaTime)}))):(this.handle.pause(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null));}))]);}onUninstall(){this.watchHandles.removeAll(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null),super.onUninstall();}handleEvent(t){const i=this.view.navigation.gamepad.device;i&&t.data.device!==i||this.currentDevice&&this.currentDevice!==t.data.device||("end"===t.data.action?(this.currentDevice=null,DefaultUI.a$1(this.transformation)):(this.currentDevice=t.data.device,DefaultUI.i(t.data,this.view.navigation.gamepad,this.transformation)));}frameUpdate(t){const i=this.transformation;if(DefaultUI.s(i))return;const e=this.view.viewpoint.clone(),n=this.view.navigation.gamepad.velocityFactor,r=m*n*t;DefaultUI.Ft(e,e,[i.translation[0]*r,-i.translation[1]*r]);const o=1+i.translation[2]*c$1*t,l=this.view.constraints.rotationEnabled?-i.heading*d*t:0,v=this.view.size,p=[v[0]/2,v[1]];DefaultUI.St(e,e,o,l,p,v);const f=this.view.constraints.constrain(e,this.view.viewpoint);this.view.viewpoint=f;}}const d=.06,m=.7,c$1=6e-4;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class i$2 extends screenUtils$1.i{constructor(e,i,t){super(!0),this.view=e,this.keys=i,this._pressed=!1,this._keyMap={[i.left]:"left",[i.right]:"right",[i.up]:"up",[i.down]:"down"},this.registerIncoming("key-down",t,(e=>this._handleKeyDown(e))),this.registerIncoming("key-up",t,(e=>this._handleKeyUp(e))),this.registerIncoming("blur",t,(()=>this._handleBlur()));}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0);}_handleKeyUp(e){this._handleKey(e,!1);}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop());}_handleKey(e,i){const t=this._keyMap[e.data.key];if(this._pressed=null!=t,this._pressed){if(i)switch(this.view.mapViewNavigation.begin(),t){case"left":this.view.mapViewNavigation.continousPanLeft();break;case"right":this.view.mapViewNavigation.continousPanRight();break;case"up":this.view.mapViewNavigation.continousPanUp();break;case"down":this.view.mapViewNavigation.continousPanDown();}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation();}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class i$1 extends screenUtils$1.i{constructor(e,i,t){super(!0),this.view=e,this.keys=i,this._pressed=!1,this._keyToDirection={[i.clockwiseOption1]:"clockwise",[i.clockwiseOption2]:"clockwise",[i.counterClockwiseOption1]:"counterClockwise",[i.counterClockwiseOption2]:"counterClockwise",[i.resetOption1]:"reset",[i.resetOption2]:"reset"},this.registerIncoming("key-down",t,(e=>this._handleKeyDown(e))),this.registerIncoming("key-up",t,(e=>this._handleKeyUp(e))),this.registerIncoming("blur",t,(()=>this._handleBlur()));}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0);}_handleKeyUp(e){this._handleKey(e,!1);}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop());}_handleKey(e,i){const t=e.modifiers;if(t.size>0&&!t.has("Shift")||!this.view.constraints.rotationEnabled)return;const s=this._keyToDirection[e.data.key];if(this._pressed=null!=s,this._pressed){if(i)switch(this.view.mapViewNavigation.begin(),s){case"clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation();}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation();}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class t$2 extends screenUtils$1.i{constructor(o,t,e){super(!0),this.view=o,this.keys=t,this._keysToZoomAction={},this.registerIncoming("key-down",e,(o=>this._handleKeyDown(o))),t.zoomIn.forEach((o=>this._keysToZoomAction[o]=0)),t.zoomOut.forEach((o=>this._keysToZoomAction[o]=1));}_handleKeyDown(o){this._handleKey(o);}_handleKey(o){const t=o.modifiers;if(t.size>0&&!t.has("Shift"))return;const{key:e}=o.data;if(!(e in this._keysToZoomAction))return;const i=this._keysToZoomAction[e],{mapViewNavigation:s}=this.view;let n=null;switch(i){case 0:n=s.zoomIn();break;case 1:n=s.zoomOut();break;default:return}s.begin(),n.then((()=>s.end())),o.stopPropagation();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const t$1=.6;class o extends screenUtils$1.i{constructor(e,t){super(!0),this.view=e,this._canZoom=!0,this.registerIncoming("mouse-wheel",t,(e=>this._handleMouseWheel(e)));}_handleMouseWheel(e){if(!this.view.navigation.mouseWheelZoomEnabled)return;if(e.preventDefault(),e.stopPropagation(),!this._canZoom)return;const o=this.view.mapViewNavigation,{x:n,y:i,deltaY:s}=e.data,a=1/t$1**(1/60*s),h=o.zoom(a,[n,i]);h&&(this._canZoom=!1,h.catch((()=>{})).then((()=>{this._canZoom=!0,o.end();})));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class a extends screenUtils$1.i{constructor(i){super(!0),this.view=i,this.registerIncoming("drag",(t=>this._handleDrag(t))),this.registerIncoming("pointer-down",(()=>this.stopMomentumNavigation()));const a=this.view.mapViewNavigation;this.dragEventSeparator=new DefaultUI.t$1({start:(t,i)=>{a.pinch.begin(this.view,i.data),i.stopPropagation();},update:(t,i)=>{a.pinch.update(this.view,i.data),i.stopPropagation();},end:(t,i)=>{a.pinch.end(this.view),i.stopPropagation();},condition:t=>t>=2});}_handleDrag(t){this.dragEventSeparator.handle(t);}stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class s extends screenUtils$1.i{constructor(e=DefaultUI.l.maximumDoubleClickDelay,o=DefaultUI.l.maximumDoubleClickDistance,n=DefaultUI.l.maximumDoubleTouchDelay,s=DefaultUI.l.maximumDoubleTouchDistance,u=request.o$5){super(!1),this.maximumDoubleClickDelay=e,this.maximumDoubleClickDistance=o,this.maximumDoubleTouchDelay=n,this.maximumDoubleTouchDistance=s,this._clock=u,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=screenUtils.c(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new DefaultUI.t$1({start:(t,e)=>this._dragStart(t,e),update:(t,e)=>this._dragUpdate(e),end:(t,e)=>this._dragEnd(e)}),this.registerIncoming("drag",(t=>this._dragEventSeparator.handle(t))),this.registerIncoming("pointer-down",(t=>this._handlePointerDown(t))),this.registerIncoming("pointer-up",(()=>this._handlePointerUp()));}onUninstall(){this._pointerState.forEach((t=>{null!=t.doubleTapTimeout&&(t.doubleTapTimeout.remove(),t.doubleTapTimeout=null);}));}get hasPendingInputs(){return request.n$6(this._pointerState,(t=>null!=t.doubleTapTimeout))}_clearPointerDown(t){const e=this._pointerState.get(t);e&&(e.doubleTapTimeout.remove(),e.doubleTapTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs());}_createDoubleTapDragData(t,e,i){const{button:a,buttons:o,pointer:r,pointers:n,pointerType:s,timestamp:u}=i;return {action:t,delta:e,button:a,buttons:o,pointer:r,pointers:n,pointerType:s,timestamp:u}}_dragStart(t,e){if(!this._doubleTapDragReady||1!==t)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:a,modifiers:o}=e,{center:r}=a;this._dragStartCenter=r;const n=this._createDoubleTapDragData("begin",screenUtils.c(0,0),a);this._doubleTapDrag.emit(n,void 0,o),e.stopPropagation();}_dragUpdate(t){if(!this._doubleTapDragActive)return;const{data:e,modifiers:a}=t,{center:o}=e,r=screenUtils.c(o.x-this._dragStartCenter.x,o.y-this._dragStartCenter.y),n=this._createDoubleTapDragData("update",r,e);this._doubleTapDrag.emit(n,void 0,a),t.stopPropagation();}_dragEnd(t){if(!this._doubleTapDragActive)return;const{data:e,modifiers:a}=t,{center:o}=e,r=screenUtils.c(o.x-this._dragStartCenter.x,o.y-this._dragStartCenter.y),n=this._createDoubleTapDragData("end",r,e);this._doubleTapDrag.emit(n,void 0,a),this._doubleTapDragActive=!1,t.stopPropagation();}_handlePointerDown(t){const{data:e}=t,i=this._pointerId(e),a=this._pointerState.get(i),{pointerType:o}=e.native;if(a){const r="touch"===o?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;this._clearPointerDown(i),DefaultUI.e(a.event.data,e)>r?this._storePointerDown(t):this._doubleTapDragReady=!0;}else this._storePointerDown(t);}_handlePointerUp(){this._doubleTapDragReady=!1;}_pointerId(t){const{native:e}=t,{pointerId:i,button:a,pointerType:o}=e;return "mouse"===o?`${i}:${a}`:`${o}`}_storePointerDown(t){const{data:e}=t,{pointerType:i}=e.native,a=this._pointerId(e),o="touch"===i?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay,r=this._clock.setTimeout((()=>this._clearPointerDown(a)),o);this._pointerState.set(a,{event:t,doubleTapTimeout:r}),this.refreshHasPendingInputs();}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const k$1={counter:"Ctrl",pan:{left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},zoom:{zoomIn:["=","+"],zoomOut:["-","_"]},rotate:{clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"}};let C$1=class extends request.p{constructor(){super(...arguments),this._handles=new request.u;}initialize(){this._handles.add([request.m$3(this.view,"ready",(()=>this._disconnect())),request.s$4(this.view,"ready",(()=>this._connect()))]);}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this._disconnect();}_disconnect(){this._inputManager&&(this.view.viewEvents.disconnect(),this._inputManager.destroy(),this._inputManager=null,this._source.destroy(),this._source=null);}_connect(){const e=this.view.surface,o$2=new DefaultUI.u(e,this.view.input),r=[new DefaultUI.n$1,new DefaultUI.o,new DefaultUI.s$1,new DefaultUI.s$2(this.view.navigation),new s],t=new screenUtils$1.d({eventSource:o$2,recognizers:r});t.installHandlers("prevent-context-menu",[new DefaultUI.e$1],screenUtils$1.u.INTERNAL),t.installHandlers("navigation",[new a(this.view),new l(this.view),new o(this.view),new a$1(this.view),new a$1(this.view,[k$1.counter]),new n(this.view,"primary"),new i$2(this.view,k$1.pan),new t$2(this.view,k$1.zoom),new i$1(this.view,k$1.rotate),new o$1(this.view,"secondary"),new e$1(this.view,"touch")],screenUtils$1.u.INTERNAL),this.view.viewEvents.connect(t),this._source=o$2,this._inputManager=t,request.i$1(this.view.navigation,"browserTouchPanEnabled",(e=>{this._source.browserTouchPanningEnabled=!e;}));}get test(){return {inputManager:this._inputManager}}};request.e([request.d()],C$1.prototype,"view",void 0),C$1=request.e([request.i("esri.views.2d.input.MapViewInputManager")],C$1);const E$1=C$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let p$1=0,i=class extends request.p{constructor(){super(...arguments),this.color=new Color.h([0,255,255]),this.haloOpacity=1,this.fillOpacity=.25;}get version(){return p$1++}};request.e([request.d({readOnly:!0})],i.prototype,"version",null),request.e([request.d({type:Color.h})],i.prototype,"color",void 0),request.e([request.d({type:Color.h})],i.prototype,"haloColor",void 0),request.e([request.d()],i.prototype,"haloOpacity",void 0),request.e([request.d()],i.prototype,"fillOpacity",void 0),i=request.e([request.i("esri.views.2d.support.HighlightOptions")],i);const c=i;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function t(t,h,i,e,d,l,n,o){let u;t.ignorePadding&&(e={left:0,right:0,top:0,bottom:0}),null!=t.width&&null!=t.height?u=[t.width,t.height]:null==t.width&&null!=t.height?u=[t.height,t.height]:null!=t.width&&null==t.height?u=[t.width,t.width]:null==t.width&&null==t.height&&(u=null);const r=i[0]-(e.left+e.right),a=i[1]-(e.top+e.bottom);let g,w,c=t.area||{x:0,y:0,width:r,height:a};if(u){const t=r/a,h=u[0]/u[1];if(h>t){const t=c.width/h;c={x:c.x,y:Math.round(c.y+(c.height-t)/2),width:c.width,height:Math.round(t)};}else {const t=c.height*h;c={x:Math.round(c.x+(c.width-t)/2),y:c.y,width:Math.round(t),height:c.height};}}else u=[c.width,c.height];u[0]>c.width?(g=Math.min(u[0]/c.width,h),w=u[0]/c.width/g):(g=1,w=u[0]/c.width);return {resolutionScale:g,cropArea:{x:Math.round((c.x+e.left)*g),y:Math.round((c.y+e.top)*g),width:Math.round(c.width*g),height:Math.round(c.height*g)},outputScale:w,format:d,quality:l,children:n,rotation:o}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let e=class extends DefaultUI.u$1{constructor(o){super(o),this.components=["attribution","zoom"];}};request.e([request.d()],e.prototype,"components",void 0),e=request.e([request.i("esri.views.ui.2d.DefaultUI2D")],e);const p=e;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const S=request.s$1.getLogger("esri.views.MapView");let O,C,L,k,E,x;async function N(){const[,{GraphicsView2D:e,GraphicContainer:t,LabelManager:i,MapViewNavigation:r,MagnifierView2D:s,Stage:a}]=await Promise.all([Promise.resolve().then(function () { return require('./webgl-5afb8d78.js'); }),Promise.resolve().then(function () { return require('./mapViewDeps-94950719.js'); })]);C=e,L=t,k=i,E=r,x=s,O=a;}function P(e){return e instanceof Graphic.h}function W(e,t,r){if(e)if(Array.isArray(e)||request.S.isCollection(e)){if(0===e.length)return;e.forEach((e=>W(e,t,r)));}else P(e)?t.add(e):r.add(e);}let R=class extends(DefaultUI.m(screenUtils$1._(U))){constructor(e){super(e),this._magnifierView=null,this._stage=null,this._resolveWhenReady=[],this.rootLayerViews=new CollectionFlattener.p({getCollections:()=>{var e,t;return [null==(e=this.basemapView)?void 0:e.baseLayerViews,this.layerViews,null==(t=this.basemapView)?void 0:t.referenceLayerViews]},getChildrenFunction:()=>null}),this.floors=new request.S,this.graphicsView=null,this.highlightOptions=new c,this.inputManager=new E$1({view:this}),this.mapViewNavigation=null,this.supersampleScreenshotsEnabled=!1,this.ui=new p,this.rendering=!1,workers.c();}destroy(){this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null);}get background(){return this.get("map.initialViewProperties.background")||null}set background(e){void 0===e?this._clearOverride("background"):this._override("background",e);}get textureManager(){return this._stage.painter.textureManager}get navigating(){return !(!this.mapViewNavigation||!this.mapViewNavigation.interacting)}toMap(e){if(screenUtils$1.i$1(e)){const t=screenUtils$1.c(this,e);return super.toMap(t)}return super.toMap(e)}hitTest(e,t){const i=screenUtils$1.i$1(e)?screenUtils$1.c(this,e):e;if(!this.ready||isNaN(i.x)||isNaN(i.y))return Promise.resolve({screenPoint:i,results:[]});const r=this.toMap(i),s=[this.graphicsView];s.push.apply(s,this.allLayerViews.toArray().reverse());const a=new Set,n=new Set,o=new Set,h=new Set;return t&&(W(t&&t.include,a,o),W(t&&t.exclude,n,h)),Promise.all(s.map((e=>!e||!e.hitTest||o.size>0&&!e.layer||o.size>0&&e.layer&&!o.has(e.layer)||h.size>0&&e.layer&&h.has(e.layer)?null:e.hitTest(i.x,i.y)))).then((e=>({screenPoint:i,results:e.filter((e=>null!=e&&(!(a.size>0)||a.has(e))&&(!(n.size>0)||!n.has(e)))).map((e=>({mapPoint:r,graphic:e})))})))}takeScreenshot(e){if(e=e||{},!this.ready)return Promise.reject("Map view cannot be used before it is ready");const t$1=this.supersampleScreenshotsEnabled?Math.min(4,screenshotUtils.g(this.size,Math.min(4096,this._stage.context.parameters.maxTextureSize))):1;let i;e.layers?(i=[],e.layers.forEach((e=>{const t=this.allLayerViews.find((t=>t.layer.id===e.id));t&&"container"in t&&t.container&&i.push(t.container);}))):i=this._stage.children;const{format:r,quality:s}=screenshotUtils.l(e.format,e.quality),a=t(e,t$1,this.size,this.padding,r,s,i,e.rotation);return this._stage.takeScreenshot(a)}on(e,t,i,r){const s=this.inputManager&&this.viewEvents.on(e,t,i,r);return s||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){if(this.graphicsView){this.graphicsView.graphicUpdateHandler(e);}}whenReady(){return new Promise((e=>{this.ready?e(this):this._resolveWhenReady.push(e);}))}forceDOMReadyCycle(){this.forceReadyCycle();}validate(){let e=DefaultUI.s$3({checkMajorWebPerformanceCaveat:!1});return request.s$3("safari")&&request.s$3("safari")<9&&(e=new request.s("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:request.s$3("safari")})),request.r(e)?(S.warn("#validate()",e.message),Promise.reject(e)):N()}_startup(){this.timeline.begin("MapView Startup"),super._startup(),this.graphics.owner=this;const e={disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},t=new O(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenshotsEnabled,contextOptions:e,renderingOptions:this.renderingOptions,timeline:this.timeline}),i=new C({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new L(this.featuresTilingScheme)}),r=new E({view:this,animationManager:this.animationManager}),s=new k({view:this});this._magnifierView=new x,this._magnifierView.magnifier=this.magnifier,this._stage=t,this.frameTask.graphicsView=i,this._set("graphicsView",i),this._set("mapViewNavigation",r),this._set("labelManager",s),this.handles.add([this.rootLayerViews.on("change",(()=>this._updateStageChildren())),t.on("post-render",(()=>this._set("rendering",t.renderRequested))),t.on("will-render",(()=>this._set("rendering",t.renderRequested))),t.on("webgl-error",(e=>this.fatalError=e.error)),request.i$1(this,"stationary",(e=>t.stationary=e),!0),request.i$1(this,"state.id",(()=>t.state=this.state),!0),request.i$1(this,"background",(e=>{t.background=e,this._magnifierView.background=e;}),!0),request.i$1(this,"magnifier",(e=>this._magnifierView.magnifier=e),!0),request.i$1(this,"renderingOptions",(e=>t.renderingOptions=e),!0),request.i$1(this,"highlightOptions",(()=>t.highlightOptions=this.highlightOptions),!0)],"map-view"),t.state=this.state,this._updateStageChildren();const a=this._resolveWhenReady;this._resolveWhenReady=[],a.forEach((e=>e(this))),this.timeline.end("MapView Startup");}_teardown(){this.handles.remove("map-view"),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._stage.destroy();this.graphicsView.destroy(),this.mapViewNavigation.destroy(),this._stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,super._teardown();}_updateStageChildren(){this._stage.removeAllChildren(),this.rootLayerViews.forEach((e=>{this._stage.addChild(e.container);}));const e=this.graphicsView;this._stage.addChild(e.container),this._stage.addChild(this._magnifierView);}};request.e([request.d({type:m$3})],R.prototype,"background",null),request.e([request.d()],R.prototype,"floors",void 0),request.e([request.d()],R.prototype,"graphicsView",void 0),request.e([request.d({type:c})],R.prototype,"highlightOptions",void 0),request.e([request.d({readOnly:!0})],R.prototype,"inputManager",void 0),request.e([request.d({readOnly:!0})],R.prototype,"textureManager",null),request.e([request.d({readOnly:!0})],R.prototype,"mapViewNavigation",void 0),request.e([request.d({type:Boolean})],R.prototype,"navigating",null),request.e([request.d({type:Boolean,constructOnly:!0})],R.prototype,"supersampleScreenshotsEnabled",void 0),request.e([request.d({type:p})],R.prototype,"ui",void 0),request.e([request.d({readOnly:!0})],R.prototype,"rendering",void 0),request.e([request.d({constructOnly:!0})],R.prototype,"renderCanvas",void 0),request.e([request.d({constructOnly:!0})],R.prototype,"deactivatedWebGLExtensions",void 0),request.e([request.d({constructOnly:!0})],R.prototype,"debugWebGLExtensions",void 0),R=request.e([request.i("esri.views.MapView")],R);const G=R;

exports.G = G;
exports.e = e$2;
exports.m = m$3;
