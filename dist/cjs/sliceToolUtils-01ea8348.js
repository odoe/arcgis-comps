'use strict';

require('./geometry-ef17530a.js');
const request = require('./messageBundle-8be88d04.js');
const mathUtils = require('./mathUtils-af6066f0.js');
const mat4 = require('./mat4-f68486bc.js');
const mat4f64 = require('./mat4f64-fc3339e5.js');
const quat = require('./quat-17613ceb.js');
const common = require('./common-41a349f2.js');
const boundedPlane = require('./boundedPlane-f1094694.js');
const plane = require('./plane-0816c6c9.js');
const sphere = require('./sphere-ef7f801f.js');
const vectorStacks = require('./vectorStacks-f48a010a.js');
const screenUtils = require('./screenUtils-d911ae62.js');
const mat3 = require('./mat3-1d3e0d51.js');
const quatf64 = require('./quatf64-e7a7f39e.js');
const vec2 = require('./vec2-d000a8cb.js');
const projection = require('./projection-b19710fa.js');
const unitUtils = require('./unitUtils-083cb8d0.js');
const aaBoundingRect = require('./aaBoundingRect-56648c00.js');
const lineSegment = require('./lineSegment-a86bf7bd.js');
const ColorMaterial = require('./ColorMaterial-61b9182b.js');
const CameraSpace_glsl = require('./CameraSpace.glsl-44d7b3f4.js');
const intersectorUtils = require('./intersectorUtils-0e8a6b4b.js');
const vec4f64 = require('./vec4f64-d3fa6cd2.js');
const aaBoundingBox = require('./aaBoundingBox-c372701a.js');
const BufferView = require('./BufferView-b78db189.js');
const InterleavedLayout = require('./InterleavedLayout-4132788d.js');
const Texture = require('./Texture-16b1a373.js');
const Util = require('./Util-5c6af8a4.js');
const OrderIndependentTransparency = require('./OrderIndependentTransparency-866eb67c.js');
const LineVisualElement = require('./LineVisualElement-62f61931.js');
const vec4f32 = require('./vec4f32-284fd490.js');
const ImageMaterial = require('./ImageMaterial-c3952697.js');
const persistable = require('./persistable-288135cc.js');
const mathUtils$1 = require('./mathUtils-87b1f941.js');

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function i(i){i.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),i.vertex.code.add(Texture.t`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));
return viewDirectionDistance*perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
}`);}function r$1(e,i,r){e.setUniform1f("perScreenPixelRatio",r.camera.perScreenPixelRatio),e.setUniform1f("screenSize",i.screenSize);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function t(t){const c=new Texture.n;return c.include(Texture.r,{linearDepth:!1}),c.include(i,{}),c.include(Texture.c,t),c.fragment.include(Texture.e$1),c.vertex.uniforms.add("proj","mat4").add("view","mat4"),c.fragment.uniforms.add("color","vec4"),c.attributes.add("position","vec3"),c.varyings.add("vWorldPosition","vec3"),t.multipassTerrainEnabled&&c.varyings.add("depth","float"),t.screenSizeEnabled&&c.attributes.add("offset","vec3"),t.shadingEnabled&&(c.vertex.uniforms.add("viewNormal","mat4"),c.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),c.attributes.add("normal","vec3"),c.varyings.add("vViewNormal","vec3")),c.vertex.code.add(Texture.t`
    void main(void) {
      vWorldPosition = ${t.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),t.shadingEnabled&&c.vertex.code.add(Texture.t`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),c.vertex.code.add(Texture.t`
    ${t.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),t.multipassTerrainEnabled&&(c.fragment.include(Texture.a),c.include(Texture.r$6,t)),c.fragment.code.add(Texture.t`
    void main() {
      discardBySlice(vWorldPosition);
      ${t.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),t.shadingEnabled?c.fragment.code.add(Texture.t`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(color, shadedColor, shadingFactor);`):c.fragment.code.add(Texture.t`vec4 finalColor = color;`),c.fragment.code.add(Texture.t`
      if (finalColor.a < ${Texture.t.float(Texture.o$1)}) {
        discard;
      }
      ${7===t.output?Texture.t`gl_FragColor = vec4(finalColor.a);`:""}

      ${0===t.output?Texture.t`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${t.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),c}const c$3=Object.freeze({__proto__:null,build:t});

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class S$2 extends Texture.t$2{initializeProgram(e){const r=S$2.shader.get(),i=this.configuration,t=r.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new Texture.n$1(e.rctx,t,P)}bindPass(e,r){const{screenSizeEnabled:t,shadingEnabled:a}=this.configuration,{color:n,shadingTint:l,shadingDirection:p}=e;Texture.t$5(this.program,r.camera.projectionMatrix),this.program.setUniform4fv("color",n),r.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",r.camera.nearFar),this.program.setUniform2fv("inverseViewport",r.inverseViewport),Texture.t$7(this.program,r)),a&&(this.program.setUniform4fv("shadedColor",this.blendColor(w$2,l,n)),this.program.setUniform3fv("shadingDirection",p),this.program.setUniformMatrix4fv("viewNormal",r.camera.viewInverseTransposeMatrix)),t&&r$1(this.program,e,r);}bindDraw(e){Texture.a$4(this.program,e),Texture.o$5(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Texture.l$2(this.program,this.configuration,e),this.program.rebindTextures();}blendColor(e,r,i){const t=1-r[3],o=r[3]+i[3]*t;return 0===o?(e[3]=o,e):(e[0]=(r[0]*r[3]+i[0]*i[3]*t)/o,e[1]=(r[1]*r[3]+i[1]*i[3]*t)/o,e[2]=(r[2]*r[3]+i[2]*i[3]*t)/o,e[3]=i[3],e)}setPipelineState(e){const r=this.configuration,i=3===e,t=2===e;return OrderIndependentTransparency.g({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?OrderIndependentTransparency.u:OrderIndependentTransparency.c(e),culling:OrderIndependentTransparency.s(r.cullFace),depthTest:{func:t?513:r.shadingEnabled?515:513},depthWrite:i?r.writeDepth&&OrderIndependentTransparency.l:OrderIndependentTransparency.l$1(e),colorWrite:OrderIndependentTransparency.r,polygonOffset:i||t?null:OrderIndependentTransparency.i$1})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}S$2.shader=new Texture.t$3(c$3,(()=>Promise.resolve().then(function () { return require('./ShadedColorMaterial.glsl-fd9d94f0.js'); })));class j$1 extends Texture.t$1{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1;}}request.e([Texture.e({count:8})],j$1.prototype,"output",void 0),request.e([Texture.e({count:3})],j$1.prototype,"cullFace",void 0),request.e([Texture.e()],j$1.prototype,"slicePlaneEnabled",void 0),request.e([Texture.e()],j$1.prototype,"transparent",void 0),request.e([Texture.e()],j$1.prototype,"writeDepth",void 0),request.e([Texture.e()],j$1.prototype,"screenSizeEnabled",void 0),request.e([Texture.e()],j$1.prototype,"shadingEnabled",void 0),request.e([Texture.e({count:4})],j$1.prototype,"transparencyPassType",void 0),request.e([Texture.e()],j$1.prototype,"multipassTerrainEnabled",void 0),request.e([Texture.e()],j$1.prototype,"cullAboveGround",void 0);const P=new Map([["position",0],["normal",1],["offset",2]]),w$2=vec4f64.n();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class q$1 extends Texture.a$5{constructor(e){super(e,C$1),this.supportsEdges=!0,this.techniqueConfig=new j$1,this._vertexAttributeLocations=P;}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.screenSizeEnabled=this.parameters.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.parameters.shadingEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.parameters}intersect(e,i,o,u,c,l,f){if(this.parameters.screenSizeEnabled){const o=e.vertexAttributes.get("offset"),h={applyToVertex:(e,i,a,n)=>{const c=mathUtils.o(z$1,o.data[3*n+0],o.data[3*n+1],o.data[3*n+2]),l=mathUtils.o(w$1,e,i,a);return mathUtils.d(c,c,this.parameters.screenSize*u.camera.computeRenderPixelSizeAt(c)),mathUtils.u(l,l,c),[l[0],l[1],l[2]]},applyToAabb:e=>{const t=aaBoundingBox.p(e,z$1);return aaBoundingBox.Y(e,this.parameters.screenSize*u.camera.computeRenderPixelSizeAt(t))}};Texture.h(e,i,u,c,l,h,f);}else Texture.h(e,i,u,c,l,void 0,f);}requiresSlot(e,t){if(4===ColorMaterial.t$4(t))return 2===e;let r=2;return this.parameters.transparent&&(r=this.parameters.writeDepth?4:7),e===r||20===e}createGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new S$1(e):null}createBufferWriter(){return new x$1(this.parameters.screenSizeEnabled)}}class S$1 extends Texture.e$5{updateParameters(e){return this.ensureTechnique(S$2,e)}beginSlot(e){return this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e);}}const C$1={color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:mathUtils.j$1(common.n(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0,...Texture.n$2};class x$1{constructor(e){this.screenSizeEnabled=e;const t=InterleavedLayout.A().vec3f("position").vec3f("normal");this.screenSizeEnabled&&t.vec3f("offset"),this.vertexBufferLayout=t;}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,r,s){if(Texture.g$2(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,s),this.screenSizeEnabled){if(!t.vertexAttributes.has("offset"))throw new Error("offset vertex attribute required for screenSizeEnabled ShadedColorMaterial");{const i=t.vertexAttributes.get("offset"),a=t.indices.get("offset");Util.i(3===i.size);const n=r.getField("offset",BufferView.i);if(!n)throw new Error("unable to acquire view for offset");Texture.u$2(a,i.data,e.invTranspTransformation,n,s);}}}}const z$1=common.n(),w$1=common.n();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class Y{constructor(e){this.camera=new ColorMaterial.J,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=mat4f64.e(),this._worldFrame=null,this._renderLocation=common.n(),this._renderLocationDirty=!0,this._location=new request.b$2({x:0,y:0,z:0}),this._elevationAlignedLocation=new request.b$2,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new request.n$2.EventEmitter,this._screenLocation={screenPointArray:screenUtils.i(),renderScreenPointArray:screenUtils.x(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=e.view.spatialReference;for(const t in e)this[t]=e[t];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera);}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null;}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject();}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject();}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject());}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:request.h$3((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject();}))}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject());}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject());}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){$(e)&&(this._screenLocationDirty=!0),mat4.n(this._modelTransform,e),this._updateEngineObject();}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=mat4f64.e()),ee(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location;}get location(){return this._location}set location(e){ColorMaterial.Z$1(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location});}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){ColorMaterial.Z$1(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location});}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const e=request.r(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1;}grabbableForEvent(){return !0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject());}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject());}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}));}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject());}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e;}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}));}get focused(){return this._focused}get screenLocation(){return this.ensureScreenLocation(),this._screenLocation}ensureScreenLocation(){if(!this._screenLocationDirty)return;this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1;let e;if($(this._modelTransform)){const t=this._calculateModelTransformOffset(_e);e=mathUtils.u(t,t,this.renderLocation);}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray);}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject();}intersectionDistance(t,i){if(!this.available)return null;const s=screenUtils.d(t,te),r=this._getCollisionRadius(i),n=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(vec2.q(this.screenLocation.screenPointArray,s)<r*r)return this.screenLocation.renderScreenPointArray[2]+n;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,ne),a=r*this.screenLocation.pixelSize,c=CameraSpace_glsl.s(this.camera,s,se);if(request.t$1(c))return null;for(const s of e){if(0===s.length)continue;const e=mathUtils.I(ce,s[0],i);for(let t=1;t<s.length;t++){const o=mathUtils.I(le,s[t],i),r=lineSegment.B(lineSegment.l(e,o,ie),c);if(null!=r&&r<a*a){const t=mathUtils.u(vectorStacks.c.get(),e,o);mathUtils.d(t,t,.5);const i=screenUtils.y(vectorStacks.c.get());return this.camera.projectToRenderScreen(t,i),i[2]+n}mathUtils.r(e,o);}}break}case"disc":{var a;const e=this.collisionType.direction,t=null!=(a=this.collisionType.offset)?a:common.f,i=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(i,ne),l=r*this.screenLocation.pixelSize,h=CameraSpace_glsl.s(this.camera,s,se);if(request.t$1(h))return null;const d=mat3.a(oe,c),_=mathUtils.L(de,e,d),g=mathUtils.I(ue,t,c);plane.v(g,_,ae);const m=he;if(plane.D(ae,h,m)&&mathUtils.x$1(m,g)<l*l)return this.screenLocation.renderScreenPointArray[2]+n;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,i=this._getWorldToScreenObjectScale(),a=this._calculateObjectTransform(i,ne),c=r*this.camera.computeScreenPixelSizeAt(this.renderLocation),l=CameraSpace_glsl.s(this.camera,s,se);if(request.t$1(l))return null;const d=mat3.a(oe,a),_=mathUtils.L(de,t,d),g=this._calculateModelTransformPosition(ue);plane.v(g,_,ae);const m=he;if(!plane.D(ae,l,m))break;for(const s of e){if(0===s.length)continue;const e=mathUtils.I(ce,s[0],a);for(let t=1;t<s.length;t++){const i=mathUtils.I(le,s[t],a),o=lineSegment.b(lineSegment.l(e,i,ie),m);if(null!=o&&o<c*c){const t=mathUtils.u(vectorStacks.c.get(),e,i);mathUtils.d(t,t,.5);const s=screenUtils.y(vectorStacks.c.get());return this.camera.projectToRenderScreen(t,s),s[2]+n}mathUtils.r(e,i);}}break}}return null}attach(e={manipulator3D:{}}){var t;if(!this.view._stage)return;const i=e.manipulator3D;if(request.t$1(i.engineLayerId)){const e=new ColorMaterial.n({isPickable:!1,updatePolicy:1});this.view._stage.add(e),i.engineLayerId=e.id,this._engineLayer=e;}else null!=(t=this.view._stage)&&t.getObject&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,request.t$1(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),projection.tn(this._location.spatialReference,this.view.spatialReference)||(this.location=new request.b$2({x:0,y:0,z:0,spatialReference:this.view.spatialReference}));}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1;}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject();}onElevationChange(e){projection.on(this.location,ge,e.spatialReference),aaBoundingRect.j(e.extent,ge)&&(this.location=this._location);}_evaluateElevationAlignment(e=this.location){if(request.t$1(this.elevationInfo))return !1;let t=null,i=0;const s=request.c$2(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=request.c$2(ColorMaterial.i(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":i=request.c$2(ColorMaterial.i(this.view.elevationProvider,e,"ground"),0)+s;break;case"relative-to-scene":i=request.c$2(ColorMaterial.i(this.view.elevationProvider,e,"scene"),0)+s;break;case"absolute-height":i=s;}return (i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=ne;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t);}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),s=(this.focused?2:1)|(this.selected?8:4),o=this._noDisplayCount>0;for(const{stateMask:r,objects:n}of i){if(o){for(const e of n)e.setVisible(!1);continue}const e=!(0!=(15&r))||(s&r)==(15&r),i=!(0!=(65520&r))||(this.state&r)==(65520&r);if(e&&i)for(const s of n)s.setVisible(!0),s.transformation=t;else for(const t of n)t.setVisible(!1);}}_ensureEngineResources(){if(request.t$1(this._engineResources)){const e=request.e$2(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach((({material:e})=>{i.has(e)||(t.push(e),i.add(e));}));const s=(e,t)=>{const{geometry:i,material:s,transform:o}=t;Array.isArray(i)?i.forEach((t=>e.addGeometry(t,s,o))):e.addGeometry(i,s,o);},o=new Map;this._renderObjects.forEach((e=>{const t=new intersectorUtils.T({castShadow:!1});s(t,e);const i=e.stateMask||0,r=o.get(i)||[];r.push(t),o.set(i,r);}));const r=[];o.forEach(((e,t)=>r.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:r,layer:e,materials:t};}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||request.t$1(this._engineResources))return;const{objectsByState:e,layer:t,materials:i}=this._engineResources;i.forEach((e=>{const t=request.e$2(this._materialIdReferences),i=t.get(e.id)||0;0===i&&this.view._stage.add(e),t.set(e.id,i+1);})),e.forEach((({objects:e})=>{t.addMany(e),this.view._stage.addMany(e);})),this._engineResourcesAddedToStage=!0;}_removeResourcesFromStage(e=!1){if(!this._engineResourcesAddedToStage||request.t$1(this._engineResources))return;const{objectsByState:t,layer:i,materials:s}=this._engineResources;t.forEach((({objects:e})=>{i.removeMany(e),this.view._stage.removeMany(e);})),s.forEach((e=>{const t=request.e$2(this._materialIdReferences),i=t.get(e.id);1===i?(this.view._stage.remove(e),t.delete(e.id)):t.set(e.id,i-1);})),e&&this.view._stage.remove(i),this._engineResourcesAddedToStage=!1;}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,re);return mathUtils.o(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return mathUtils.c(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return mat4.s(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&mat4.e(t,t,this._worldFrame),mat4.e(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,request.r(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if(request.r(this._engineResources))for(const t in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[t];for(const t of i.objects)if(t.isVisible){e=!0;break}if(e)break}return {areAnyResourcesVisible:e}}}function $(e){return 0!==e[12]||0!==e[13]||0!==e[14]}function ee(e,t,s){switch(e.viewingMode){case"local":return mat4.r(s),!0;case"global":{const o=unitUtils.p(e.renderCoordsHelper.spatialReference);return projection.ue(t,0,ce,0,o.radius),projection.zn(mathUtils.M(ce[0]),mathUtils.M(ce[1]),s),!0}}}const te=screenUtils.i(),ie=lineSegment.v(),se=sphere.d(),oe=quatf64.e(),re=mat4f64.e(),ne=mat4f64.e(),ae=plane.p(),ce=common.n(),le=common.n(),he=common.n(),de=common.n(),ue=common.n(),_e=common.n(),ge=new request.b$2({x:0,y:0,z:0,spatialReference:null});

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function d$4(e,t=4,r=!0){const n=vec4f64.r(e[0],e[1],e[2],e.length>3?e[3]:1),o=e[3]<1;return r?new q$1({color:n,transparent:o,writeDepth:!0,cullFace:2,renderOccluded:t}):new ColorMaterial.h$1({color:n,transparent:o,writeDepth:!0,cullFace:2,renderOccluded:t})}function j(e,t=4){const r=vec4f64.r(e[0],e[1],e[2],4===e.length?e[3]:1);return new ColorMaterial.h$1({color:r,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:t})}function y$1(e,t,a,i){const m=mathUtils.c(vectorStacks.c.get(),e,a),u=b$1(m,mathUtils._(vectorStacks.c.get(),i,m),a,vectorStacks.f.get());mat4.h(u,u);const p=mathUtils.I(vectorStacks.c.get(),t,u);return Math.atan2(p[1],p[0])}function b$1(e,t,r,n){const c=mathUtils.j$1(vectorStacks.c.get(),e),i=mathUtils.j$1(vectorStacks.c.get(),t),l=mathUtils._(vectorStacks.c.get(),c,i);return n[0]=c[0],n[1]=c[1],n[2]=c[2],n[3]=0,n[4]=i[0],n[5]=i[1],n[6]=i[2],n[7]=0,n[8]=l[0],n[9]=l[1],n[10]=l[2],n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n}function O(t,r){const n=t.getViewForGraphic(r);return request.r(n)&&"computeAttachmentOrigin"in n?n.computeAttachmentOrigin(r,t.spatialReference):null}function v$1(t,r,n){const o=O(t,n);request.r(o)?r.elevationAlignedLocation=o:F$1(r,n.geometry);}function F$1(e,r){if(request.t$1(r))return;const n="mesh"===r.type?r.anchor:ColorMaterial.R$1(r);request.t$1(n)||(e.location=ColorMaterial.f$3(n));}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
request.s$3("mac")?"Meta":"Control";const a$1=2,c$2=1.15,m$2=1.15,h=1.1,l$1=.7,n=[1,.5,0],x=2,C=1,S=[...n,l$1],U=[0,0,0,.04],b=[...n,.5],d$3=[...n,1],g=[1,1,1,1],k=[1,.8,.6,1],q=[1,.93,.86,1],u=[...n,1],v=[...n,1],w=3,y=11,z=22.5,A=40,B=48,D=2.25,E=[...n,1],F=4,G=1,H=.3,I=6,J=4,K=12,L=40,N=27;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function r(){const r=new Texture.n;return r.extensions.add("GL_OES_standard_derivatives"),r.vertex.uniforms.add("proj","mat4").add("view","mat4"),r.attributes.add("position","vec3"),r.attributes.add("uv0","vec2"),r.varyings.add("vUV","vec2"),r.vertex.code.add(Texture.t`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),r.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),r.fragment.code.add(Texture.t`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),r}const a=Object.freeze({__proto__:null,build:r});

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class d$2 extends Texture.t$2{initializeProgram(r){const e=d$2.shader.get().build();return new Texture.n$1(r.rctx,e,Texture.o)}bindPass(e,i){Texture.t$5(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",e.backgroundColor),this.program.setUniform4fv("gridColor",e.gridColor),this.program.setUniform1f("gridWidth",e.gridWidth);}bindDraw(r){Texture.a$4(this.program,r),this.program.rebindTextures();}initializePipeline(){return OrderIndependentTransparency.g({blending:OrderIndependentTransparency.e(1,1,771,771),depthTest:{func:513},colorWrite:OrderIndependentTransparency.r})}}d$2.shader=new Texture.t$3(a,(()=>Promise.resolve().then(function () { return require('./SlicePlaneMaterial.glsl-b8a596d4.js'); })));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class l extends Texture.a$5{constructor(r){super(r,m$1),this._config=new Texture.t$1;}intersect(r,e,t,i,n,o,s){return Texture.h(r,e,i,n,o,void 0,s)}createBufferWriter(){return new ColorMaterial.f$2(ColorMaterial.o$5)}requiresSlot(r){return 7===r}createGLMaterial(r){return 0===r.output?new c$1(r):null}getTechniqueConfig(){return this._config}}class c$1 extends Texture.e$5{constructor(r){super(r),this.ensureTechnique(d$2,null);}updateParameters(){return request.e$2(this.technique)}beginSlot(){return request.e$2(this.technique)}bind(r,e){e.bindPass(this._material.parameters,r);}}const m$1={backgroundColor:[1,0,0,.5],gridColor:[0,1,0,.5],gridWidth:4,...Texture.n$2};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class d$1 extends LineVisualElement.c{constructor(r){super(r),this._material=null,this._renderOccluded=4,this._gridWidth=1,this._gridColor=vec4f32.r(1,0,0,1),this._backgroundColor=vec4f32.r(1,0,0,1),this.applyProps(r);}get renderOccluded(){return this._renderOccluded}set renderOccluded(r){r!==this._renderOccluded&&(this._renderOccluded=r,this._updateMaterial());}get gridWidth(){return this._gridWidth}set gridWidth(r){this._gridWidth!==r&&(this._gridWidth=r,this._updateMaterial());}get gridColor(){return this._gridColor}set gridColor(r){mathUtils.a$1(this._gridColor,r),this._updateMaterial();}get backgroundColor(){return this._backgroundColor}set backgroundColor(r){mathUtils.a$1(this._backgroundColor,r),this._updateMaterial();}createExternalResources(){this._material=new l(this.materialParameters);}destroyExternalResources(){this._material=null;}forEachExternalMaterial(e){request.r(this._material)&&e(this._material);}createGeometries(e){if(request.r(this._material)){const r=ColorMaterial.P.createSquareGeometry();e.addGeometry(r,this._material);}}get materialParameters(){return {backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){request.r(this._material)&&this._material.setParameters(this.materialParameters);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var m;let c=m=class extends request.a$2{constructor(t){super(t),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10;}clone(){return new m({position:request.l$1(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}equals(t){return this.heading===t.heading&&this.tilt===t.tilt&&request.p$7(this.position,t.position)&&this.width===t.width&&this.height===t.height}};request.e([request.d({readOnly:!0,json:{read:!1,write:!0}})],c.prototype,"type",void 0),request.e([request.d({type:request.b$2}),persistable.g()],c.prototype,"position",void 0),request.e([request.d({type:Number,nonNullable:!0,range:{min:0,max:360}}),persistable.g(),request.c((t=>mathUtils$1.U.normalize(request.a$4(t),0,!0)))],c.prototype,"heading",void 0),request.e([request.d({type:Number,nonNullable:!0,range:{min:0,max:360}}),persistable.g(),request.c((t=>mathUtils$1.U.normalize(request.a$4(t),0,!0)))],c.prototype,"tilt",void 0),request.e([request.d({type:Number,nonNullable:!0}),persistable.g()],c.prototype,"width",void 0),request.e([request.d({type:Number,nonNullable:!0}),persistable.g()],c.prototype,"height",void 0),c=m=request.e([request.i("esri.widgets.Slice.SlicePlane")],c);const d=c;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const ze=request.s$1.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function Ve(e,t,i){const s=t.worldUpAtPosition(e.origin,vectorStacks.c.get()),o=e.basis1,r=ut(e,s),n=Math.round(r/kt)*kt;return boundedPlane.ps(e,n-r,o,i)}function We(e,t){return b$1(e.basis1,e.basis2,e.origin,t)}function Ze(e,t,i,s){const o=t.worldUpAtPosition(e.origin,vectorStacks.c.get()),r=vectorStacks.c.get();switch(i){case 1:mathUtils.r(r,o);break;case 2:mathUtils.r(r,e.basis1);}return plane.v(e.origin,r,s)}function Ke(e,t,i,s){const o=mathUtils.s(s.basis1),r=mathUtils.s(s.basis2),n=et(s),a=tt(s),g=mathUtils.o(vectorStacks.c.get(),0,0,0);mathUtils.u(g,mathUtils.d(vectorStacks.c.get(),s.basis1,t.direction[0]),mathUtils.d(vectorStacks.c.get(),s.basis2,t.direction[1])),mathUtils.u(g,s.origin,g);let u=0,p=1;if(it(t))1===t.direction[0]&&-1===t.direction[1]?u=kt:1===t.direction[0]&&1===t.direction[1]?u=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(u=3*Math.PI/2),p=a;else {const e=0!==t.direction[0]?1:2;u=1===e?kt:0,p=(1===e?r:o)-n;}const f=mat4.r(vectorStacks.f.get());mat4.m(f,f,u),mat4.i(f,f,mathUtils.o(vectorStacks.c.get(),p,p,p)),mat4.e(f,i,f),f[12]=0,f[13]=0,f[14]=0,e.modelTransform=f,e.renderLocation=g;}function Qe(e,t,i,s){const o=s.worldUpAtPosition(i.origin,vectorStacks.c.get()),r=Ye(i,0),n=mat4.r(vectorStacks.f.get());mat4.m(n,n,r.edge*Math.PI/2),mat4.b(n,n,-ut(i,o)),mat4.e(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=r.position;}function Ye(e,t){switch(t){case 0:return {basis:e.basis1,direction:1,position:mathUtils.u(vectorStacks.c.get(),e.origin,e.basis1),edge:t};case 1:return {basis:e.basis2,direction:1,position:mathUtils.u(vectorStacks.c.get(),e.origin,e.basis2),edge:t};case 2:return {basis:e.basis1,direction:-1,position:mathUtils.c(vectorStacks.c.get(),e.origin,e.basis1),edge:t};case 3:return {basis:e.basis2,direction:-1,position:mathUtils.c(vectorStacks.c.get(),e.origin,e.basis2),edge:t}}}function et(e){const t=mathUtils.s(e.basis1),i=mathUtils.s(e.basis2);return H*Math.min(t,i)}function tt(e){return et(e)}function it(e){return 0!==e.direction[0]&&0!==e.direction[1]}function st(e,t=1){const i=0===t?A:0,s=[common.r(i,0,-B/2),common.r(i,0,B/2)],o=mt(s,!0),r=(e,t)=>ct(s,s,{tubeRadius:w,tipRadius:y,tipLength:z,tubeFocusMultiplier:c$2,tipFocusMultiplier:m$2,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),n=r(0,!1),a=r(D,!0),c=new ColorMaterial.h$1({color:g,cullFace:2,renderOccluded:16}),l=new ColorMaterial.h$1({color:k,cullFace:2,renderOccluded:16}),m=new ColorMaterial.h$1({color:q,cullFace:2,renderOccluded:16}),d=new ColorMaterial.h$1({color:v,transparent:!0,writeDepth:!1,cullFace:1,renderOccluded:2}),g$1=ColorMaterial.P.createPolylineGeometry([[i,0,0],[i-A,0,0]]),u$1=ColorMaterial.P.createPolylineGeometry([[i,0,0],[i-A,0,0]]),p=new ColorMaterial.V$1({color:u,renderOccluded:4});return new Y({view:e,renderObjects:[...n.normal.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?c:"cap"===e?l:m,transform:i,stateMask:1|wt}))),...a.normal.map((({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:1|wt}))),{geometry:g$1,material:p,stateMask:1|wt|jt},...n.focused.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?c:"cap"===e?l:m,transform:i,stateMask:2|wt}))),...a.focused.map((({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:2|wt}))),{geometry:u$1,material:p,stateMask:2|wt|jt}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[o]},collisionPriority:1,radius:y,state:wt})}function ot(e,t){const i=new ImageMaterial.h({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),s=L,o=N,r=o*h,n=e=>{const t=new Uint32Array([0,1,2,2,3,0]);return new Texture.u$1([["position",{size:3,data:[s-e,-e,0,s+e,-e,0,s+e,e,0,s-e,e,0],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1]}]],[["position",t],["uv0",t]])},a=ColorMaterial.P.createPolylineGeometry([[0,0,0],[s-o,0,0]]),c=ColorMaterial.P.createPolylineGeometry([[0,0,0],[s-r,0,0]]),l=new ColorMaterial.V$1({color:d$3,renderOccluded:4}),m=[{geometry:n(o),material:i,stateMask:1|wt},{geometry:a,material:l,stateMask:1|wt},{geometry:n(r),material:i,stateMask:2|wt},{geometry:c,material:l,stateMask:2|wt}];return new Y({view:e,renderObjects:m,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[s,0,0]},collisionPriority:1,radius:o/2,state:wt})}function rt(e){return new LineVisualElement.m({view:e,attached:!0,color:S,width:C,writeDepthEnabled:!1,renderOccluded:4,geometry:[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]]]})}function nt(e){return new d$1({view:e,attached:!0,backgroundColor:[...U],gridColor:b,gridWidth:4,renderOccluded:4})}function at(e,t){const i=it(t),s=i?[common.r(1,0,0),common.r(0,0,0),common.r(0,1,0)]:[common.r(1,0,0),common.r(-1,0,0)],o=ColorMaterial.P.createPolylineGeometry(s),r=E,n=e=>new ColorMaterial.W$1({color:r,width:e,renderOccluded:4}),a=()=>new ColorMaterial.V$1({color:r,renderOccluded:4}),c=i?F:G,l=c*a$1,m=G,d=e=>e>1?n(e):a(),g=[{geometry:o,material:d(c),stateMask:1|vt},{geometry:o,material:d(l),stateMask:2|vt},{geometry:o,material:d(m),stateMask:Pt}],u=new Y({view:e,renderObjects:g,collisionType:{type:"line",paths:[s]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?I:J});return u.state=vt,u}function ct(e,t,i){const s=s=>{const o=(s?t:e).slice(0),n=mathUtils.c(vectorStacks.c.get(),o[0],o[1]);mathUtils.j$1(n,n);const a=mathUtils.c(vectorStacks.c.get(),o[o.length-1],o[o.length-2]);if(mathUtils.j$1(a,a),i.padding>0){const e=mathUtils.d(common.n(),a,-i.padding);if(o[o.length-1]=mathUtils.u(e,e,o[o.length-1]),i.bothEnds){const e=mathUtils.d(common.n(),n,-i.padding);o[0]=mathUtils.u(e,e,o[0]);}}const c=s?i.tipFocusMultiplier:1,g=i.tipLength*(i.focusTipLength?c:1),y=i.tipRadius*c,w=mat4.r(vectorStacks.f.get());if(i.padding>0){const e=g/4,t=mathUtils.o(vectorStacks.c.get(),0,e,0),s=1+i.padding/e;mat4.c(w,w,t),mat4.i(w,w,mathUtils.o(vectorStacks.c.get(),s,s,s)),mat4.c(w,w,mathUtils.d(t,t,-1/s));}const j=mat4.r(mat4f64.e()),v=common.r(0,1,0),R=mat4.P(mat4f64.e(),quat.S(vectorStacks.o.get(),v,a));R[12]=o[o.length-1][0],R[13]=o[o.length-1][1],R[14]=o[o.length-1][2],mat4.e(R,R,w);const O=[{part:"tube",geometry:lt(i.tubeRadius*(s?i.tubeFocusMultiplier:1)+i.padding,i.flat,o),transform:j}];let T,S;if(request.r(i.flat)?T=ColorMaterial.P.createExtrudedTriangle(g,y,y,i.flat.thickness):(T=ColorMaterial.P.createConeGeometry(g,y,24,!1,!1,!0),S=ColorMaterial.P.createConeGeometry(g,y,24,!1,!0,!1)),O.push({part:"tip",geometry:T,transform:R}),S&&O.push({part:"cap",geometry:S,transform:R}),i.bothEnds){const e=mat4.P(mat4f64.e(),quat.S(vectorStacks.o.get(),v,n));e[12]=o[0][0],e[13]=o[0][1],e[14]=o[0][2],mat4.e(e,e,w),O.push({part:"tip",geometry:T,transform:e}),S&&O.push({part:"cap",geometry:S,transform:e});}return O};return {normal:s(!1),focused:s(!0)}}function lt(e,t,i){const s=[];if(request.r(t))s.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else {const t=12;for(let i=0;i<t;i++){const o=i/t*2*Math.PI;s.push([Math.cos(o)*e,Math.sin(o)*e]);}}return ColorMaterial.P.createPathExtrusionGeometry(s,i,[],[],!1)}function mt(e,t){const i=mathUtils.c(common.n(),e[e.length-1],e[e.length-2]);if(mathUtils.j$1(i,i),mathUtils.d(i,i,K),mathUtils.u(i,i,e[e.length-1]),t){const t=mathUtils.c(common.n(),e[0],e[1]);return mathUtils.j$1(t,t),mathUtils.d(t,t,K),mathUtils.u(t,t,e[0]),[t,...e,i]}return [...e,i]}function dt(e,t,s,n=new d){if(request.t$1(e))return null;const a=request.r(n.position)?n.position:new request.b$2;t.fromRenderCoords(e.origin,a,s),n.position=a;const c=t.worldUpAtPosition(e.origin,vectorStacks.c.get()),l=t.worldBasisAtPosition(e.origin,1,vectorStacks.c.get());return n.width=2*mathUtils.s(e.basis1),n.height=2*mathUtils.s(e.basis2),n.tilt=mathUtils.m(ut(e,c)),n.heading=mathUtils.m(pt(e,c,l)),n}function ut(e,t){return sphere.i(t,e.basis2,e.basis1)+kt}function pt(e,t,i){return sphere.i(e.basis1,i,t)-kt}function ft(e,t,i,o,r,n,a=boundedPlane.G()){return n.toRenderCoords(e,a.origin)?(n.worldBasisAtPosition(a.origin,0,a.basis1),n.worldBasisAtPosition(a.origin,1,a.basis2),plane.B(a.basis2,a.basis1,a.origin,a.plane),boundedPlane.ps(a,-mathUtils.M(t),boundedPlane.ms(a),a),boundedPlane.ps(a,mathUtils.M(i),a.basis1,a),mathUtils.d(a.basis1,a.basis1,o/2),mathUtils.d(a.basis2,a.basis2,r/2),boundedPlane.K(a),a):(ze.error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function ht(e,t,i=boundedPlane.G()){if(request.t$1(e)||request.t$1(e.position))return null;let s=e.position;return e.position.hasZ||(s=e.position.clone(),s.z=request.c$2(ColorMaterial.i(t.elevationProvider,e.position),0)),ft(s,e.heading,e.tilt,e.width,e.height,t.renderCoordsHelper,i)}function yt(t){switch(t.type){case"analysis":case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return !1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return !0;default:return !1}}const wt=16,jt=32,kt=Math.PI/2,vt=16,Pt=32;

exports.C = C;
exports.Ke = Ke;
exports.O = O;
exports.Pt = Pt;
exports.Qe = Qe;
exports.S = S;
exports.U = U;
exports.Ve = Ve;
exports.We = We;
exports.Y = Y;
exports.Ze = Ze;
exports.at = at;
exports.b = b;
exports.d = d$4;
exports.d$1 = d;
exports.dt = dt;
exports.ht = ht;
exports.it = it;
exports.j = j;
exports.jt = jt;
exports.nt = nt;
exports.ot = ot;
exports.q = q$1;
exports.r = r;
exports.rt = rt;
exports.st = st;
exports.t = t;
exports.tt = tt;
exports.v = v$1;
exports.vt = vt;
exports.x = x;
exports.y = y$1;
exports.yt = yt;
