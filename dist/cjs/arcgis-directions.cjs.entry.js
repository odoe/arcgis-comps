'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

const index = require('./index-fde8502c.js');
const request = require('./messageBundle-8be88d04.js');
const Search = require('./Search-d3923c79.js');
const Color = require('./Color-7d915caa.js');
const Graphic = require('./Graphic-0aff6059.js');
const SimpleLineSymbol = require('./symbols-29b793e5.js');
const GraphicsLayer = require('./GraphicsLayer-5076fd9b.js');
const queryUtils = require('./queryUtils-2959d136.js');
const FeatureSet = require('./FeatureSet-8efc5965.js');
require('./geometry-ef17530a.js');
const enumeration = require('./enumeration-f235fe07.js');
const RouteTask = require('./RouteTask-f17ed057.js');
const GoTo = require('./GoTo-be01affb.js');
const Heading = require('./Heading-d7c5e432.js');
const accessibleHandler = require('./accessibleHandler-652e5d90.js');
const sortable_esm = require('./sortable.esm-bcce1d94.js');
require('./reactiveUtils-ef5dccea.js');
require('./Popover-a5af0472.js');
require('./PopupTemplate-a0b855f8.js');
require('./opacityUtils-f2e4b347.js');
require('./Identifiable-a4f50f85.js');
require('./Portal-8d16604d.js');
require('./layerViewUtils-96bae70b.js');
require('./unitUtils-083cb8d0.js');
require('./scaleUtils-5c377ab3.js');
require('./utils-8a0a0870.js');
require('./Task-95a3fa39.js');
require('./units-77498be1.js');
require('./trimExtend-5a37c80f.js');
require('./jsonUtils-b6068079.js');
require('./project-dab29fc8.js');
require('./vmEvent-9b257013.js');
require('./colorUtils-e70dbab5.js');
require('./mathUtils-af6066f0.js');
require('./common-41a349f2.js');
require('./Symbol-f0556e23.js');
require('./screenUtils-d911ae62.js');
require('./aaBoundingBox-c372701a.js');
require('./aaBoundingRect-56648c00.js');
require('./persistableUrlUtils-c611d652.js');
require('./GraphicsCollection-d70ae8cb.js');
require('./HandleOwner-9c4c158c.js');
require('./Layer-31cde361.js');
require('./BlendLayer-6a2ab430.js');
require('./mat4-f68486bc.js');
require('./ScaleRangeLayer-5320a5ba.js');
require('./ElevationInfo-d3e3d64f.js');
require('./lengthUtils-179eaf12.js');
require('./GPMessage-d3ae977e.js');
require('./Field-b92c6f4a.js');
require('./fieldType-32f95259.js');
require('./normalizeUtils-a793b472.js');

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function o$1(o){if(!o||!o.length)return null;let l=request.e$2(request.S.isCollection(o)?o.getItemAt(0).geometry:o[0].geometry),r=l.extent&&l.extent.clone(),i=l;null===r&&(r=new request.M(i.x,i.y,i.x,i.y,l.spatialReference));for(let m=1;m<o.length;m++){l=request.e$2(request.S.isCollection(o)?o.getItemAt(m).geometry:o[m].geometry),i=l;let c=l.extent;null===c&&(c=new request.M(i.x,i.y,i.x,i.y,l.spatialReference)),r=r.union(c);}return r.width<0&&r.height<0?null:r}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$1=class extends FeatureSet['default']{constructor(o){super(o),this.doNotLocateOnRestrictedElements=null;}};request.e([request.d({type:Boolean,json:{write:!0}})],s$1.prototype,"doNotLocateOnRestrictedElements",void 0),s$1=request.e([request.i("esri.rest.support.NetworkFeatureSet")],s$1);const c$2=s$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var v;let j=v=class extends request.a$2{constructor(t){super(t),this.accumulateAttributes=null,this.apiKey=null,this.attributeParameterValues=null,this.directionsLanguage=null,this.directionsLengthUnits=null,this.directionsOutputType=null,this.directionsStyleName=null,this.directionsTimeAttribute=null,this.findBestSequence=null,this.ignoreInvalidLocations=null,this.impedanceAttribute=null,this.outputGeometryPrecision=null,this.outputGeometryPrecisionUnits=null,this.outputLines="true-shape",this.outSpatialReference=null,this.pointBarriers=null,this.polygonBarriers=null,this.polylineBarriers=null,this.preserveFirstStop=null,this.preserveLastStop=null,this.restrictionAttributes=null,this.restrictUTurns=null,this.returnBarriers=!1,this.returnDirections=!1,this.returnPolygonBarriers=!1,this.returnPolylineBarriers=!1,this.returnRoutes=!0,this.returnStops=!1,this.returnZ=!0,this.startTime=null,this.startTimeIsUTC=!0,this.stops=null,this.travelMode=null,this.useHierarchy=null,this.useTimeWindows=null;}readStartTime(t,e){return null!=e.startTime?new Date(e.startTime):null}writeStartTime(t,e){e.startTime=t?t.getTime():null;}clone(){return new v(request.l$1({accumulateAttributes:this.accumulateAttributes,apiKey:this.apiKey,attributeParameterValues:this.attributeParameterValues,directionsLanguage:this.directionsLanguage,directionsLengthUnits:this.directionsLengthUnits,directionsOutputType:this.directionsOutputType,directionsStyleName:this.directionsStyleName,directionsTimeAttribute:this.directionsTimeAttribute,findBestSequence:this.findBestSequence,ignoreInvalidLocations:this.ignoreInvalidLocations,impedanceAttribute:this.impedanceAttribute,outputGeometryPrecision:this.outputGeometryPrecision,outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,outputLines:this.outputLines,outSpatialReference:this.outSpatialReference,pointBarriers:this.pointBarriers,polygonBarriers:this.polygonBarriers,polylineBarriers:this.polylineBarriers,preserveFirstStop:this.preserveFirstStop,preserveLastStop:this.preserveLastStop,restrictionAttributes:this.restrictionAttributes,restrictUTurns:this.restrictUTurns,returnBarriers:this.returnBarriers,returnDirections:this.returnDirections,returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,returnRoutes:this.returnRoutes,returnStops:this.returnStops,returnZ:this.returnZ,startTime:this.startTime,startTimeIsUTC:this.startTimeIsUTC,stops:this.stops,travelMode:this.travelMode,useHierarchy:this.useHierarchy,useTimeWindows:this.useTimeWindows}))}};request.e([request.d({type:[String],json:{write:!0}})],j.prototype,"accumulateAttributes",void 0),request.e([request.d(Search.t)],j.prototype,"apiKey",void 0),request.e([request.d({json:{write:!0}})],j.prototype,"attributeParameterValues",void 0),request.e([request.d({type:String,json:{write:!0}})],j.prototype,"directionsLanguage",void 0),request.e([enumeration.r(queryUtils.s)],j.prototype,"directionsLengthUnits",void 0),request.e([enumeration.r(queryUtils.r)],j.prototype,"directionsOutputType",void 0),request.e([request.d({type:String,json:{write:!0}})],j.prototype,"directionsStyleName",void 0),request.e([request.d({type:String,json:{write:!0}})],j.prototype,"directionsTimeAttribute",void 0),request.e([request.d({json:{write:!0}})],j.prototype,"findBestSequence",void 0),request.e([request.d({json:{write:!0}})],j.prototype,"ignoreInvalidLocations",void 0),request.e([request.d({type:String,json:{read:{source:"impedanceAttributeName"},write:{target:"impedanceAttributeName"}}})],j.prototype,"impedanceAttribute",void 0),request.e([request.d({type:Number,json:{write:!0}})],j.prototype,"outputGeometryPrecision",void 0),request.e([enumeration.r(queryUtils.i)],j.prototype,"outputGeometryPrecisionUnits",void 0),request.e([enumeration.r(queryUtils.t)],j.prototype,"outputLines",void 0),request.e([request.d({type:request.k,json:{write:!0}})],j.prototype,"outSpatialReference",void 0),request.e([request.d({json:{write:!0}})],j.prototype,"pointBarriers",void 0),request.e([request.d({json:{write:!0}})],j.prototype,"polygonBarriers",void 0),request.e([request.d({json:{write:!0}})],j.prototype,"polylineBarriers",void 0),request.e([request.d({json:{write:!0}})],j.prototype,"preserveFirstStop",void 0),request.e([request.d({json:{write:!0}})],j.prototype,"preserveLastStop",void 0),request.e([request.d({type:[String],json:{write:!0}})],j.prototype,"restrictionAttributes",void 0),request.e([enumeration.r(queryUtils.n)],j.prototype,"restrictUTurns",void 0),request.e([request.d({type:Boolean,json:{write:!0}})],j.prototype,"returnBarriers",void 0),request.e([request.d({type:Boolean,json:{write:!0}})],j.prototype,"returnDirections",void 0),request.e([request.d({type:Boolean,json:{write:!0}})],j.prototype,"returnPolygonBarriers",void 0),request.e([request.d({type:Boolean,json:{write:!0}})],j.prototype,"returnPolylineBarriers",void 0),request.e([request.d({type:Boolean,json:{write:!0}})],j.prototype,"returnRoutes",void 0),request.e([request.d({type:Boolean,json:{write:!0}})],j.prototype,"returnStops",void 0),request.e([request.d({type:Boolean,json:{write:!0}})],j.prototype,"returnZ",void 0),request.e([request.d({type:Date,json:{type:Number,write:!0}})],j.prototype,"startTime",void 0),request.e([request.o$2("startTime")],j.prototype,"readStartTime",null),request.e([request.r$2("startTime")],j.prototype,"writeStartTime",null),request.e([request.d({type:Boolean,json:{write:!0}})],j.prototype,"startTimeIsUTC",void 0),request.e([request.d({json:{write:!0}})],j.prototype,"stops",void 0),request.e([request.d({type:queryUtils.m,json:{write:!0}})],j.prototype,"travelMode",void 0),request.e([request.d({type:Boolean,json:{write:!0}})],j.prototype,"useHierarchy",void 0),request.e([request.d({type:Boolean,json:{write:!0}})],j.prototype,"useTimeWindows",void 0),j=v=request.e([request.i("esri.rest.support.RouteParameters")],j);const S=j;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function n(t,e){return !(!A$1(t)||!e||-22091616e5===t.get("attributes.ETA"))}function i$2(r,n,i,s){const u=new Date(i),o=new Date(u.getTime()+60*u.getTimezoneOffset()*1e3),a=request.L$1(o,{hour:"2-digit",minute:"2-digit",hour12:!1});if(n){const t=(i-n)/1e3/60/60,s=Math.floor(t),u=60*(t-s),o=request.m(s,{minimumIntegerDigits:2}),c=request.m(u,{minimumIntegerDigits:2});return `${a} ${r.gmt}${s<0?"":"+"}${o}${c}`}return s?request.L$1(o,{hour:"numeric",minute:"numeric"}):a}function s(t){return "esriNAUSeconds"===t||"esriNAUMinutes"===t||"esriNAUHours"===t||"esriNAUDays"===t}function u(t,e,r){const n=s(e),i=s(r),u=n?o(t,e):c$1(t,e);return n===i?i?a$1(u,r):l(u,r):t}function o(t,e,r){switch(t=t||0,e){case"esriNAUSeconds":t/=60**(r?-1:1);break;case"esriNAUHours":t*=60**(r?-1:1);break;case"esriNAUDays":t*=1440**(r?-1:1);}return t}function a$1(t,e){return o(t,e,!0)}function c$1(t,e,r){switch(t=t||0,(e||"").replace("esriNAU","esri")){case"esriInches":t*=.0254**(r?-1:1);break;case"esriFeet":t*=.3048**(r?-1:1);break;case"esriYards":t*=.9144**(r?-1:1);break;case"esriMiles":t*=1609.344**(r?-1:1);break;case"esriNauticalMiles":t*=1851.995396854**(r?-1:1);break;case"esriMillimeters":t/=1e3**(r?-1:1);break;case"esriCentimeters":t/=100**(r?-1:1);break;case"esriKilometers":t*=1e3**(r?-1:1);break;case"esriDecimeters":t/=10**(r?-1:1);}return t}function l(t,e){return c$1(t,e,!0)}function m(t){const e=t&&t.attributes||{};return null===(e.ArriveCurbApproach||null)&&null!==(e.DepartCurbApproach||null)}function p$2(t){const e=t&&t.attributes||{};return null!==(e.ArriveCurbApproach||null)&&null===(e.DepartCurbApproach||null)}function b(t){return t&&t.get("attributes.isWaypoint")}function h(t){const e=t&&t.get("attributes.Status");return !e||6===e}function A$1(t){return t._associatedStop}function g(t,e={}){const{unit:r="minutes"}=e;return d(t,r)}function d(t,e){const r=60,n=60,i="days"===(e=e.toLowerCase())?t*24:"hours"===e?t:"minutes"===e?t/r:t/r/n;if(i<1)return `${Math.floor(i*n)}m`;const s=i%1*r;return `${Math.floor(i)}:${String(Math.floor(s)).padStart(2,"0")}h`}function D(t,e,n,i={}){const{fromUnits:s,toUnits:o}=i,a=u(n,s,o);if(!a)return "";const c=e.units[o],l=c?c.abbr:o.replace("esri","").toLowerCase();return request.s$2(t.distanceTemplate,{distance:a,units:l},{format:{distance:{type:"number",intlOptions:{minimumFractionDigits:2,maximumFractionDigits:2}}}})}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const N$1=request.s$1.getLogger("esri.widgets.Directions.DirectionsViewModel"),z={first:new SimpleLineSymbol.y({color:[105,220,255,1],size:19,outline:{color:[51,51,51,1],width:3}}),middle:new SimpleLineSymbol.y({color:[51,51,51,1],size:12,outline:{color:[105,220,255,1],width:3}}),last:new SimpleLineSymbol.n({width:23,height:23,url:`data:image/svg+xml;base64,${btoa('<svg width="30" height="30" viewBox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="none"><path d="M15.15.3C6.9.3.3 6.9.3 15.15S6.9 29.7 15.15 29.7 29.7 23.1 29.7 15.15C29.7 6.9 23.25.3 15.15.3z" fill="#333"/><path d="M15 4.8C9.3 4.8 4.8 9.45 4.8 15c0 5.55 4.65 10.2 10.2 10.2 5.55 0 10.2-4.5 10.2-10.2 0-5.55-4.5-10.2-10.2-10.2z" fill="#69DCFF"/><path fill="#333" d="M10.5 10.5h9v9h-9z"/></g></svg>')}`}),unlocated:new SimpleLineSymbol.n({height:18,width:18,url:`data:image/svg+xml;base64,${btoa('<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M10.1.2C4.6.2.2 4.6.2 10.1s4.4 9.7 9.9 9.7 9.7-4.4 9.7-9.7c0-5.5-4.3-9.9-9.7-9.9z" fill="#333" fill-rule="nonzero"/><path d="M10 2.7c-4.08 0-7.3 3.328-7.3 7.3s3.328 7.3 7.3 7.3 7.3-3.22 7.3-7.3c0-3.972-3.22-7.3-7.3-7.3z" fill="#69DCFF" fill-rule="nonzero"/><path d="M11.414 10l5.304-5.303-1.415-1.415L10 8.586 4.697 3.282 3.282 4.697 8.586 10l-5.304 5.303 1.415 1.415L10 11.414l5.303 5.304 1.415-1.415L11.414 10z" fill="#333"/></g></svg>')}`}),waypoint:new SimpleLineSymbol.y({color:[255,255,255,1],size:10,outline:{color:[20,89,127,1],width:2.5}})};let U=class extends(GoTo.e(request.n$2.EventedAccessor)){constructor(t){super(t),this._handles=new request.u,this._routeLayer=new GraphicsLayer.h({listMode:"hide"}),this._highlightLayer=new GraphicsLayer.h({listMode:"hide"}),this._stopId=9999,this._stopLayer=new GraphicsLayer.h({listMode:"hide"}),this._serviceDescriptionLoadStatus=0,this.apiKey=void 0,this.departureTime="now",this.lastRoute=null,this.routeSymbol=new SimpleLineSymbol.m({color:[105,220,255,1],width:7,cap:"round",join:"round"}),this.routeParameters=new S({ignoreInvalidLocations:!0,directionsOutputType:"complete",findBestSequence:!1,preserveFirstStop:!0,preserveLastStop:!0,restrictUTurns:"at-dead-ends-and-intersections",directionsLengthUnits:"kilometers",returnBarriers:!1,returnDirections:!0,returnPolygonBarriers:!1,returnPolylineBarriers:!1,returnRoutes:!1,returnStops:!0,returnZ:!0,startTime:null,startTimeIsUTC:!0,stops:null,useHierarchy:!0,useTimeWindows:!1}),this.routeServiceUrl="https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",this.serviceDescription=null,this.error=null,this.stops=new request.S,this.view=null;}initialize(){this._handles.add([request.$(this,"stops","change",(()=>{this.clearResults(),this._addStopsToLayer();})),request.i$1(this,"view.map",((t,e)=>{const r=[this._routeLayer,this._stopLayer,this._highlightLayer];e&&e.removeMany(r),t&&t.addMany(r);})),request.f(this,"lastRoute",(()=>this._addRouteToLayer()))]);}destroy(){this.stops.destroy();const t=this.get("view.map");t&&t.removeMany([this._routeLayer,this._stopLayer,this._highlightLayer]);}get _directionsLanguage(){const{routeParameters:t,serviceDescription:e}=this,{directionsSupportedLanguages:r}=e;if(!r)return;const s=(t.directionsLanguage||request.i$6()).slice(0,2);return r.find((t=>t.toLowerCase().slice(0,2)===s))}get _routeTask(){return new RouteTask['default'](this.routeServiceUrl)}get impedanceAttribute(){var t,e,r,s,o,i;const a=null!=(t=null!=(e=null==(r=this.routeParameters)||null==(s=r.travelMode)?void 0:s.impedanceAttributeName)?e:null==(o=this.routeParameters)?void 0:o.impedanceAttribute)?t:null==(i=this.serviceDescription)?void 0:i.impedance;return this.getCostAttribute(a)}set maxStops(t){const e=50,r=2;t=t<=r?r:t>e?e:t,this._set("maxStops",t);}get selectedTravelMode(){const{serviceDescription:t}=this;if(!t)return null;const{defaultTravelMode:e,supportedTravelModes:r=[]}=t;let s=null;for(let o=0;o<r.length;o++)r[o].id===e&&(s=r[o]);return s||r[0]||null}set selectedTravelMode(t){void 0!==t?this._override("selectedTravelMode",t):this._clearOverride("selectedTravelMode");}get state(){const t=this._serviceDescriptionLoadStatus;return 4===t?"unauthenticated":0===t?"disabled":1===t?"initializing":this._activeRouteController?"routing":3===t||this.error?"error":"ready"}set stopSymbols(t){const e={...z,...t};this._set("stopSymbols",e);}get timeAttribute(){var t,e,r,s,o,i;const a=null!=(t=null!=(e=null==(r=this.routeParameters)||null==(s=r.travelMode)?void 0:s.timeAttributeName)?e:null==(o=this.routeParameters)?void 0:o.directionsTimeAttribute)?t:null==(i=this.serviceDescription)?void 0:i.directionsTimeAttribute;return this.getCostAttribute(a)}get travelModes(){var t,e;return null!=(t=null==(e=this.serviceDescription)?void 0:e.supportedTravelModes)?t:[]}async load(){if(!this.serviceDescription)try{this._serviceDescriptionLoadStatus=1,this.notifyChange("state"),await this._loadServiceDescription(),this._serviceDescriptionLoadStatus=2,this.notifyChange("state");}catch(t){const e="identity-manager:user-aborted"===t.name;if(this._serviceDescriptionLoadStatus=e?4:3,this.notifyChange("state"),!e){const e=new request.s("directions-view-model:service-metadata-unavailable","Cannot load route service metadata",{error:t});throw this._set("error",e),e}}}highlightSegment(t){const{view:s,_highlightLayer:o}=this;if(!s||request.t$1(t.symbol))return;this.clearHighlights();const i=t.symbol.clone();i.color=new Color.h([0,0,0,.8]),i.width=Math.ceil(i.width/2);const a=new Graphic.h({geometry:t.geometry,symbol:i});o.graphics.add(a);}clearHighlights(){this._highlightLayer.graphics.removeAll();}centerAt(t){const{view:e}=this;e&&this.callGoTo({target:t});}clearResults(){this._set("lastRoute",null);}getDirections(){const{state:t}=this;if("unauthenticated"===t||"initializing"===t||"disabled"===t||3===this._serviceDescriptionLoadStatus)return Promise.reject(new request.s("directions-view-model:not-loaded","Cannot get directions until view model loads."));this._set("error",null),this._activeRouteController&&(this._activeRouteController.abort(),this._activeRouteController=null);const{apiKey:e,departureTime:r}=this,s="now"===r,i="now"===r?new Date:r;if(i&&!s){const t=60*i.getTimezoneOffset()*1e3;i.setTime(i.getTime()-t);}const a=this.routeParameters.clone();if(a.set({startTime:i,startTimeIsUTC:s,directionsLanguage:this._directionsLanguage,apiKey:e}),this.selectedTravelMode&&(a.travelMode=this.selectedTravelMode),this.stops.length<=1){const t=new request.s("directions-view-model:not-enough-stops","Not enough stops for routing");return this._set("error",t),Promise.reject(t)}const l=new AbortController,{signal:n}=l;this._activeRouteController=l;const c=this._enqueue((()=>{const t=this.stops.clone().toArray(),e={},r=r=>{const s=r&&r.routeResults&&r.routeResults[0]&&r.routeResults[0].stops||[];(r&&r.routeResults&&r.routeResults[0]&&r.routeResults[0].directions&&r.routeResults[0].directions.features||[]).map((r=>{for(let s=0;s<t.length;s++)if(r.attributes.text.indexOf(t[s].attributes.Name)>-1){const o=t[s].attributes.Name;r.attributes.text=r.attributes.text.replace(o,e[o]),r._associatedStop=t[s];break}})),t.map((t=>t.attributes.Name=e[t.attributes.Name])),s.map((t=>{t.attributes.Name=e[t.attributes.Name];}));},s=t=>{if(t&&t.routeResults&&t.routeResults[0]){const e=t.routeResults[0],r=e.stops||[],s=this.stops.clone().toArray();let o=e.directions&&e.directions.routeName||e.routeName||"";r.map(((t,e)=>{const r=t.attributes,i=s[e].attributes;o=o.replace(r.Name,i.Name),Object.keys(r).forEach((t=>{0===t.indexOf("Cumul_")&&(i[t]=r[t]);})),i.ArriveCurbApproach=r.ArriveCurbApproach,i.ArriveTime=r.ArriveTime,i.ArriveTimeUTC=r.ArriveTimeUTC,i.DepartCurbApproach=r.DepartCurbApproach,i.DepartTime=r.DepartTime,i.DepartTimeUTC=r.DepartTimeUTC,i.Sequence=r.Sequence,i.Status=r.Status;})),e.directions&&(e.directions.routeName=o),null!==e.route&&(e.route.attributes.Name=o),e.routeName=o;}},o=t=>{const r=t&&t.routeResults&&t.routeResults[0]&&t.routeResults[0].stops||[],s=this.stops.toArray();let o=r.length===s.length,i=0;for(;o&&i<r.length;)o=o&&e[r[i].attributes.Name]===s[i++].attributes.Name;return o};return (()=>{t.map((t=>{const r=t.attributes,s=`${(r.Name||"[not yet geocoded]").substr(0,100)}_#${++this._stopId}`;e[s]=r.Name,r.Name=s;}));})(),a.stops=new c$2({doNotLocateOnRestrictedElements:!0,features:t}),this._routeTask.solve(a,{signal:n}).then((t=>o(t)?(s(t),r(t),this._set("lastRoute",t),t):(N$1.warn("Response stops don't match current stops of the ViewModel, invalidating the results."),this._set("lastRoute",null),null))).catch((t=>{throw r(null),t}))})).then((t=>(this._activeRouteController=null,this.notifyChange("state"),this.zoomToRoute(),t))).catch((t=>{if(this._activeRouteController=null,this.notifyChange("state"),!request.d$1(t))throw t=new request.s("directions-view-model:unable-to-route","Unable to route to these addresses",{error:t}),this._set("error",t),t}));return this.notifyChange("state"),c}getCostAttribute(t){const e=this.serviceDescription&&this.serviceDescription.networkDataset.networkAttributes||[];let r="";for(let s=0;s<e.length;s++)if(e[s].name===t&&"esriNAUTCost"===e[s].usageType){r=e[s];break}return r}reset(){this.stops.removeAll(),this.clearHighlights(),this._set("lastRoute",null);}zoomToRoute(){const{directionLines:t,view:e}=this;if(!t||!e)return;const r=o$1(t),s=r.width>r.height;this.callGoTo({target:r.expand(s?2:1)});}async _loadServiceDescription(){const t=await queryUtils.c(this.routeServiceUrl,this.apiKey);this._set("serviceDescription",t);}_enqueue(t){this._requestQueueTail||(this._requestQueueTail=Promise.resolve());const e=new Promise(((e,r)=>{this._requestQueueTail.catch((()=>{})).then((()=>{try{const s=t.call(this);request.O$1(s)?s.then(e,r):e(s);}catch(s){r(s);}}));}));return this._requestQueueTail=e,e}_addStopsToLayer(){this._stopLayer.graphics.removeAll();const t=this.stops.clone().map(((t,e)=>{const{first:r,middle:s,last:o,unlocated:i,waypoint:a}=this.stopSymbols;return b(t)?t.symbol=a:void 0===t.attributes.Status?t.symbol=0===e?r:e===this.stops.length-1?o:s:t.symbol=b(t)?a:h(t)?m(t)?r:p$2(t)?o:s:i,t}));this._stopLayer.graphics.addMany(t);}_addRouteToLayer(){this._routeLayer.graphics.removeAll();const{directionLines:t}=this;t&&(t.forEach((t=>{t.symbol=this.routeSymbol;})),this._routeLayer.graphics.addMany(t));}};request.e([request.d()],U.prototype,"_directionsLanguage",null),request.e([request.d({type:RouteTask['default']})],U.prototype,"_routeTask",null),request.e([request.d()],U.prototype,"apiKey",void 0),request.e([request.d()],U.prototype,"departureTime",void 0),request.e([request.d({aliasOf:"lastRoute.routeResults.0.directions.features"})],U.prototype,"directionLines",void 0),request.e([request.d({readOnly:!0})],U.prototype,"impedanceAttribute",null),request.e([request.d({readOnly:!0})],U.prototype,"lastRoute",void 0),request.e([request.d({value:50})],U.prototype,"maxStops",null),request.e([request.d()],U.prototype,"routeSymbol",void 0),request.e([request.d({type:S})],U.prototype,"routeParameters",void 0),request.e([request.d()],U.prototype,"routeServiceUrl",void 0),request.e([request.d()],U.prototype,"selectedTravelMode",null),request.e([request.d({readOnly:!0})],U.prototype,"serviceDescription",void 0),request.e([request.d({readOnly:!0})],U.prototype,"state",null),request.e([request.d()],U.prototype,"error",void 0),request.e([request.d({type:request.S})],U.prototype,"stops",void 0),request.e([request.d({value:z})],U.prototype,"stopSymbols",null),request.e([request.d({readOnly:!0})],U.prototype,"timeAttribute",null),request.e([request.d()],U.prototype,"travelModes",null),request.e([request.d()],U.prototype,"view",void 0),request.e([request.d()],U.prototype,"getDirections",null),request.e([request.d()],U.prototype,"zoomToRoute",null),U=request.e([request.i("esri.widgets.Directions.DirectionsViewModel")],U);const x=U;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let c=class extends request.p{constructor(){super(...arguments),this.messages=null,this.messagesUnits=null;}get primary(){const t=this.get("directionsViewModel.lastRoute.routeResults.0.directions"),s$1=this.directionsViewModel.impedanceAttribute,e=this.get("directionsViewModel.routeParameters.directionsLengthUnits");return s(s$1.units)?g(t.totalTime,{unit:s$1.units.replace("esriNAU","")}):D(this.messages,this.messagesUnits,t.totalLength,{toUnits:e})}get secondary(){const t=this.get("directionsViewModel.lastRoute.routeResults.0.directions"),s$1=this.get("directionsViewModel.routeParameters.directionsLengthUnits"),{impedanceAttribute:e}=this.directionsViewModel;return s(e.units)?D(this.messages,this.messagesUnits,t.totalLength,{toUnits:s$1}):g(t.totalTime)}};request.e([request.d()],c.prototype,"directionsViewModel",void 0),request.e([request.d()],c.prototype,"messages",void 0),request.e([request.d()],c.prototype,"messagesUnits",void 0),request.e([request.d({readOnly:!0})],c.prototype,"primary",null),request.e([request.d({readOnly:!0})],c.prototype,"secondary",null),c=request.e([request.i("esri.widgets.Directions.support.CostSummary")],c);const a=c;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const r={esriDMTBearLeft:"bear-left",esriDMTBearRight:"bear-right",esriDMTDoorPassage:"walk-through-door",esriDMTElevator:"elevator",esriDMTEndOfFerry:"disembark",esriDMTEscalator:"escalator",esriDMTFerry:"embark",esriDMTForkCenter:"fork-middle",esriDMTForkLeft:"fork-left",esriDMTForkRight:"fork-right",esriDMTHighwayChange:"highway-change",esriDMTHighwayExit:"exit-highway-right",esriDMTHighwayMerge:"merge-on-highway",esriDMTPedestrianRamp:"take-pedestrian-ramp",esriDMTRampLeft:"ramp-left",esriDMTRampRight:"ramp-right",esriDMTRoundabout:"roundabout-left",esriDMTSharpLeft:"sharp-left",esriDMTSharpRight:"sharp-right",esriDMTStairs:"stairs",esriDMTStraight:"straight",esriDMTTurnLeft:"left",esriDMTTurnLeftLeft:"left-left",esriDMTTurnLeftRight:"left-right",esriDMTTurnRight:"right",esriDMTTurnRightLeft:"right-left",esriDMTTurnRightRight:"right-right",esriDMTUnknown:"unknown",esriDMTUTurn:"u-turn-left"};function e(e){return r[e]}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const i$1={base:"esri-directions esri-widget esri-widget--panel",directionsButton:"esri-directions__button",clearRouteButton:"esri-directions__clear-route-button",scroller:"esri-directions__scroller",panelContent:"esri-directions__panel-content",panelContentLoading:"esri-directions__panel-content--loading",panelContentError:"esri-directions__panel-content--error",panelContentSignIn:"esri-directions__panel-content--sign-in",loader:"esri-directions__loader",message:"esri-directions__message",travelModeSelect:"esri-directions__travel-modes-select",departureTime:"esri-directions__departure-time",departureTimeSelect:"esri-directions__departure-time-select",directionsSection:"esri-directions__directions-section",departureTimeControls:"esri-directions__departure-time-controls",section:"esri-directions__section",summary:"esri-directions__summary",stopIcon:"esri-directions__stop-icon",interactiveStopIcon:"esri-directions__stop-icon--interactive",removeStopButton:"esri-directions__remove-stop",removeStop:"esri-directions__remove-stop-icon",reverseStops:"esri-directions__reverse-stops",stopIconContainer:"esri-directions__stop-icon-container",lastStopIconContainer:"esri-directions__stop-icon-container--last",stopHandle:"esri-directions__stop-handle",stopInput:"esri-directions__stop-input",stopOptions:"esri-directions__stop-options",stopHandleIcon:"esri-directions__stop-handle-icon",verticalSplitter:"esri-directions__vertical-splitter",stopRow:"esri-directions__stop-row",stopRowGhost:"esri-directions__stop-row-ghost",validStopRow:"esri-directions__stop-row--valid",stops:"esri-directions__stops",addStop:"esri-directions__add-stop",addStopText:"esri-directions__add-stop-text",directionCosts:"esri-directions__costs",costsDetails:"esri-directions__costs-details",primaryCosts:"esri-directions__costs-value",secondaryCosts:"esri-directions__other-costs-total",routeActions:"esri-directions__route-actions",maneuvers:"esri-directions__maneuvers",maneuverList:"esri-directions__maneuver-list",maneuverSection:"esri-directions__maneuver-section",maneuverSectionHeader:"esri-directions__maneuver-section-header",maneuverSectionHeaderButton:"esri-directions__maneuver-section-header-toggle-button",maneuverSectionTitle:"esri-directions__maneuver-section-title",collapsibleSection:"esri-directions__maneuver-section--collapsible",maneuverSectionToggle:"esri-directions__maneuver-section-toggle",maneuver:"esri-directions__maneuver",maneuverActive:"esri-directions__maneuver--active",maneuverCosts:"esri-directions__maneuver-costs",maneuverCostsContainer:"esri-directions__maneuver-costs-container",maneuverIcon:"esri-directions__maneuver-icon",cumulativeCost:"esri-directions__cost--cumulative",intermediateCost:"esri-directions__cost--intermediate",horizontalSplitter:"esri-directions__horizontal-splitter",sectionSplitter:"esri-directions__section-splitter",disclaimer:"esri-directions__disclaimer",signInContent:"esri-directions__sign-in-content",signInButton:"esri-directions__sign-in-button",contentTitle:"esri-directions__content-title",warningCard:"esri-directions__warning-card",warningHeader:"esri-directions__warning-header",warningHeading:"esri-directions__warning-heading",warningMessage:"esri-directions__warning-message",stopsIcon:"esri-icon-radio-unchecked",lastStopIcon:"esri-icon-radio-checked",handleIcon:"esri-icon-handle-vertical",addStopIcon:"esri-icon-plus",removeStopIcon:"esri-icon-trash",reverseStopIcon:"esri-icon-up-down-arrows",openIcon:"esri-icon-down",closeIcon:"esri-icon-up",warningIcon:"esri-icon-notice-triangle",widgetIcon:"esri-icon-directions",anchor:"esri-widget__anchor",button:"esri-button",buttonSecondary:"esri-button--secondary",buttonTertiary:"esri-button--tertiary",emptyContent:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",select:"esri-select",screenReaderText:"esri-icon-font-fallback-text"},t$1=()=>request.a$1("esri/themes/base/images/maneuvers/");

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let t=class extends request.p{constructor(o){super(o),this.maneuvers=[],this.name=null,this.open=!1;}};request.e([request.d()],t.prototype,"maneuvers",void 0),request.e([request.d()],t.prototype,"name",void 0),request.e([request.d()],t.prototype,"open",void 0),t=request.e([request.i("esri.widgets.Directions.support.RouteSection")],t);const p$1=t;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let i=class extends request.p{constructor(t){super(t),this.routePath=null;}get sections(){const t=this.routePath;return t?this._createSections(t):[]}_createSections(t){const r=(t=this._filterDuplicateStops(t)).map(((t,r)=>A$1(t)?r:-1)).filter((t=>t>-1));return r.map(((e,o)=>{const i=A$1(t[e]).attributes.Name,p=o===r.length-1?[]:t.slice(r[o]+1,r[o+1]);return new p$1({name:i,maneuvers:p,open:0===o})}))}_filterDuplicateStops(t){let r;return t.filter((t=>{const e=A$1(t),o=e===r;return r=e,!e||!o}))}};request.e([request.d()],i.prototype,"routePath",void 0),request.e([request.d({readOnly:!0})],i.prototype,"sections",null),i=request.e([request.i("esri.widgets.Directions.support.RouteSections")],i);const p=i;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const A={awaitingViewClickStop:"awaiting-view-click-stop"};function E(e){return e.results[0].results[0]}function O(){return [{},{}]}const B={hour:"numeric",minute:"numeric"},F={minimumIntegerDigits:2};function V(e){const t=e.getTimezoneOffset(),s=t>0?"-":"+",i=60,r=Math.abs(Math.floor(t/i)),o=Math.abs(Math.floor(t)%i);return `GMT${s}${request.m(r,F)}${request.m(o,F)}`}const N=100,K=500;function q(e){return !(null==e.composedPath||!e.composedPath().find((e=>{var t;return null==(t=e.classList)?void 0:t.contains("esri-search__suggestions-list")})))}let G=class extends request.z{constructor(e,s){super(e,s),this._autoStopRemovalDelay=N,this._costSummary=new a,this._departureTime="now",this._datePicker=new Search.x,this._handles=new request.u,this._newPlaceholderStop=null,this._pointerPressedSearchSuggestionStop=null,this._routeSections=new p,this._stops=new request.S(O()),this._stopsToSearches=new Map,this._timePicker=new Search.f,this.apiKey=null,this.goToOverride=null,this.headingLevel=2,this.iconClass=i$1.widgetIcon,this.label=void 0,this.lastRoute=null,this.maxStops=null,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.routeServiceUrl=void 0,this.routeSymbol=null,this.searchProperties=null,this.stopSymbols=null,this.view=null,this.viewModel=new x,this._setUpDragAndDropStops=e=>{this._sortable=sortable_esm.Sortable.create(e,{draggable:`.${i$1.validStopRow}`,ghostClass:i$1.stopRowGhost,handle:`.${i$1.stopHandle}`,onEnd:this._handleStopInputDragEnd});},this._handleDragHandlePointerDown=()=>this._stops.forEach((e=>this._acquireSearch(e).activeMenu="none")),this._handleStopInputDragEnd=({oldIndex:e,newIndex:t,target:s})=>{if(e===t)return;const{children:i}=s,r=i[t],o=i[e],n=t-e<0;s.insertBefore(r,n?o.nextElementSibling:o);const a=this._stops;a.reorder(a.getItemAt(e),t),this._processStops();};}initialize(){this.own([request.i$1(this,"viewModel.lastRoute",(()=>{this._routeSections.routePath=this.get("viewModel.directionLines"),this._activeManeuver=null,this._focusedManeuver=null,this.scheduleRender();})),request.i$1(this,"viewModel.selectedTravelMode, viewModel.departureTime",(()=>{this.get("viewModel.stops.length")>1&&this.getDirections();})),request.s$4(this,"view",((e,t)=>{if(t&&(this._viewClickHandle=null,this._handles.remove(t)),e){const t=this._prepPointerDownUpClick(),s=this._prepViewClick();t.pause(),s.pause(),this._handles.add([request.r$1(e.surface,"mousedown",(()=>this._autoStopRemovalDelay=K)),request.r$1(e.surface,"mouseup",(()=>this._autoStopRemovalDelay=N)),t,s],this.view.surface),this._pointerDownUpHandle=t,this._viewClickHandle=s;}})),request.a(this,"routeServiceUrl",(()=>this.viewModel.load())),request.f(this,"viewModel.stops.length",(e=>{0===e&&(this._stops.toArray().forEach((e=>this._removeStop(e,!0))),this._stops.addMany(O()),this.scheduleRender());}))]);}destroy(){this._datePicker.destroy(),this._timePicker.destroy(),this._stopsToSearches.forEach((e=>e.destroy())),this._sortable&&this._sortable.destroy();}getDirections(){return null}zoomToRoute(){}render(){return request.n$1("div",{class:this.classes(i$1.base,i$1.scroller)},this._renderPanelContent())}_renderPanelContent(){const{viewModel:{state:e}}=this,t="initializing"===e,s="error"===e&&!this.viewModel.serviceDescription,i="unauthenticated"===e,r={[i$1.panelContentLoading]:t,[i$1.panelContentError]:s,[i$1.panelContentSignIn]:i},o=t?"presentation":"group",n=i?this._renderSignIn():s?this._renderMessage(this._getErrorMessage()):t?this._renderLoader():this._renderReadyContent();return request.n$1("div",{class:this.classes(i$1.panelContent,r),role:o},n)}_renderReadyContent(){return [this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSectionSplitter(),this._renderDirectionsContainer(),this._renderDisclaimer()]}_renderSignIn(){return request.n$1("div",{key:"sign-in",class:i$1.signInContent},request.n$1(Heading.s,{class:i$1.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),request.n$1(Heading.s,{level:this.headingLevel+1},this.messages.signInRequired),request.n$1("button",{class:this.classes(i$1.button,i$1.buttonSecondary,i$1.signInButton),tabIndex:0,onclick:this._handleSignInClick,bind:this,type:"button"},this.messagesCommon.auth.signIn))}_handleSignInClick(){this.viewModel.load().catch((()=>{}));}_renderTravelModeOptions(){const{travelModes:e}=this.viewModel;if(0===e.length)return null;const{selectedTravelMode:t}=this.viewModel,s=t.name||this.messages.travelMode;return request.n$1("select",{"aria-label":s,bind:this,class:this.classes(i$1.travelModeSelect,i$1.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:s},e.map((e=>{const s=e.id===t.id;return request.n$1("option",{key:e,"data-mode":e,selected:s,value:e.id},e.name)})))}_handleTravelModeChange(e){const t=e.currentTarget,s=t.item(t.selectedIndex);this.viewModel.selectedTravelMode=s["data-mode"];}_renderStopsContainer(){return request.n$1("div",{class:i$1.section,key:"esri-directions__stops-container",role:"group"},this._renderStops())}_renderDepartureTimeControls(){const e=this._departureTime,{messages:t}=this,s=t.departureTime;return request.n$1("div",{class:i$1.departureTime,key:"esri-directions__departure-time-controls",role:"group"},request.n$1("select",{"aria-label":s,bind:this,class:this.classes(i$1.departureTimeSelect,i$1.select),onchange:this._handleDepartureOptionChange,title:s},request.n$1("option",{value:"now",selected:"now"===e},t.leaveNow),request.n$1("option",{value:"depart-by",selected:"depart-by"===e},t.departBy),request.n$1("option",{value:"unspecified",selected:"unspecified"===e},t.timeUnspecified)),"depart-by"===e?this._renderTimeControls():null)}_renderStops(){const e=this._stops;let t=0;e.forEach((e=>{"none"!==this._acquireSearch(e).activeMenu&&(t+=1);}));const s=e.toArray().map(((s,i)=>{const r=e.length,o=i>1&&!s.result,n={[i$1.stopsIcon]:i>=0&&i<r-1,[i$1.lastStopIcon]:i===r-1},a={[i$1.lastStopIconContainer]:i===r-1},l={[i$1.validStopRow]:!o},c=e.getItemAt(r-1),d=c&&c.result,h=e.getItemAt(i+1),u=h&&h.result,p=i===r-1,m=i===r-2,v=2===r&&0===i||r>2&&!p&&!m||r>2&&m&&u||r>2&&p&&!s.result,_=2===r||3===r&&!d||o,g=this._acquireSearch(s),{messages:S}=this,{removeStop:w,reverseStops:M,unlocated:y}=S,T=request.s$2(S.stopLabelTemplate,{number:i+1,label:s.result?s.result.name:y}),C=`${this.id}__stop--${i}`,f=!!g.searchTerm&&!!g.selectedResult&&!!s.result&&g.selectedResult===s.result,k={zIndex:"none"!==g.activeMenu?""+t--:""};return request.n$1("li",{"aria-label":T,afterCreate:this._handleStopFieldCreation,bind:this,class:this.classes(i$1.stopRow,l),id:C,key:i,"data-stop-index":i,styles:k},request.n$1("div",{class:i$1.stopHandle},request.n$1("span",{"aria-hidden":"true",class:this.classes(i$1.stopIcon,i$1.handleIcon,i$1.stopHandleIcon,i$1.interactiveStopIcon),onpointerdown:this._handleDragHandlePointerDown}),request.n$1("div",{bind:this,"aria-labelledby":C,class:this.classes(i$1.stopIconContainer,a),"data-stop-index":i,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},request.n$1("span",{class:this.classes(i$1.stopIcon,n),tabindex:f?"0":null}))),request.n$1("div",{class:i$1.stopInput},g.render()),request.n$1("div",{class:i$1.stopOptions,role:"group"},request.n$1("div",{"aria-label":w,class:i$1.removeStopButton,bind:this,"data-stop-index":i,hidden:_,onkeydown:this._handleRemoveStop,onclick:this._handleRemoveStop,role:"button",tabIndex:0,title:w},request.n$1("span",{"aria-hidden":"true",class:this.classes(i$1.stopIcon,i$1.removeStop,i$1.removeStopIcon,i$1.interactiveStopIcon)}),request.n$1("span",{class:i$1.screenReaderText},"removeStopTitle")),request.n$1("div",{"aria-label":M,class:i$1.reverseStops,bind:this,hidden:v,onkeydown:this._handleReverseStops,onclick:this._handleReverseStops,role:"button",tabIndex:0,title:M},request.n$1("span",{"aria-hidden":"true",class:this.classes(i$1.stopIcon,i$1.reverseStopIcon,i$1.interactiveStopIcon)}),request.n$1("span",{class:i$1.screenReaderText},"removeStopTitle"))))})),i=e.every((e=>{const t=this._stopsToSearches.get(e);return e.result&&t.selectedResult===e.result})),r=this._stops.length>=this.maxStops,o=this.messages.addStop,n=e.length>=2&&i&&!r?request.n$1("div",{"aria-label":o,bind:this,class:i$1.addStop,key:"esri-directions__add-stop",onfocus:this._handleAddStopFocus,tabIndex:0},request.n$1("span",{"aria-hidden":"true",class:this.classes(i$1.addStopIcon,i$1.stopIcon,i$1.interactiveStopIcon)}),request.n$1("div",{"aria-hidden":"true",class:i$1.addStopText},o)):null;return request.n$1("div",null,request.n$1("ol",{class:i$1.stops,role:"group",afterCreate:this._setUpDragAndDropStops},s),n)}_handleStopIconClick(e){const t=e.currentTarget["data-stop-index"],s=this._stops.getItemAt(t);s&&s.result&&this._centerAtStop(s);}_handleClearRouteClick(){this.viewModel.reset();}_centerAtStop(e){this.viewModel.centerAt(e.result.feature);}_handleStopFieldCreation(e){const t=this._newPlaceholderStop;if(!t)return;const s=e["data-stop-index"],i=this._stops.getItemAt(s);if(t===i){const e=this._acquireSearch(i);e.when((()=>{this.renderNow(),e.focus();}));}this._newPlaceholderStop=null;}_handleStopInputBlur(e,t){this._handles.remove(A.awaitingViewClickStop),this.view.cursor=this._previousCursor;if(!e.selectedResult||!t.result||e.selectedResult!==t.result)return "none"!==e.activeMenu||!e.searchTerm||e.selectedResult===t.result&&(e.selectedResult||t.result)?void(e.searchTerm||(this._viewClickHandle.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout((()=>{if(this.destroyed)return;if(this._viewClickHandle.pause(),"searching"===e.viewModel.state)return void this._pointerDownUpHandle.pause();if(this._pointerPressedSearchSuggestionStop)return;this._removeStop(t);!!t.result&&(t.result=null,this._processStops()),this.scheduleRender();}),this._autoStopRemovalDelay))):(e.search(),void this._pointerDownUpHandle.pause());this._pointerDownUpHandle.pause();}_handleStopInputFocus(e,t){if(this._pointerDownUpHandle.resume(),this._handles.has(A.awaitingViewClickStop))return;const{view:s,view:{cursor:i}}=this;this._previousCursor=i,this._handles.add(request.i$1(e,"searchTerm",(e=>{s.cursor=0===e.length?"copy":i;})),A.awaitingViewClickStop),this._activeStop=t;}_prepViewClick(){const e=this.get("viewModel.view"),t=request.n$5(e,"click",this._handleViewClick.bind(this)),i=request.n$5(e.surface,"click",(()=>{clearTimeout(this._autoStopRemovalTimeoutId),i.pause();}));return {remove(){i.remove(),t.remove();},pause(){i.pause(),t.pause();},resume(){i.resume(),t.resume();}}}_prepPointerDownUpClick(){const e=request.n$5(document,"pointerdown",(e=>{this._pointerPressedSearchSuggestionStop=q(e)?this._activeStop:null;})),t=request.n$5(document,"pointerup",(e=>{this._pointerDownUpHandle.pause();const t=q(e),s=this._activeStop;t||s!==this._pointerPressedSearchSuggestionStop||this._removeStop(s),this.scheduleRender(),this._pointerPressedSearchSuggestionStop=t?this._activeStop:null;}));return {remove(){t.remove(),e.remove();},pause(){t.pause(),e.pause();},resume(){e.resume();}}}_handleViewClick(e){const t=this._stopsToSearches.get(this._activeStop);t&&!t.searchTerm&&(t.search(e.mapPoint).then((e=>{const s=E(e),i=this._activeStop;i.result=s,i.result.feature.attributes.Name=s.name,t.searchTerm=s.name;})),this.scheduleRender()),this._viewClickHandle.pause(),clearTimeout(this._autoStopRemovalTimeoutId);}_handleAddStopFocus(){this._addNewPlaceholder();}_addNewPlaceholder(){if(this._pointerDownUpHandle.pause(),this._newPlaceholderStop)return;const e={};this._stops.add(e),this._newPlaceholderStop=e;}_handleReverseStops(){this._reverseStops();}_reverseStops(){this._stops.reverse(),this._processStops();}_handleRemoveStop(e){const t=e.currentTarget["data-stop-index"];this._removeStop(this._stops.getItemAt(t)),this._processStops();}_removeStop(e,t=!1){this._stops.length<=2&&!t||(this._disposeSearch(e),this._stops.remove(e));}_handleDepartureOptionChange(e){const t=e.currentTarget,s=t.item(t.selectedIndex);"now"===s.value?(this._departureTime="now",this.viewModel.departureTime="now",this._handles.remove("departure-time-controls")):"depart-by"===s.value?(this._departureTime="depart-by",this._handles.add([request.i$1(this._datePicker,"value",(()=>this._updateDepartureTime())),request.i$1(this._timePicker,"value",(()=>this._updateDepartureTime()))],"departure-time-controls")):(this._departureTime="unspecified",this.viewModel.departureTime=null);}_updateDepartureTime(){const e=this._datePicker.value,t=this._timePicker.value;this.viewModel.departureTime=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes());}_renderTimeControls(){return request.n$1("div",{class:i$1.departureTimeControls,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())}_renderSectionSplitter(){return request.n$1("div",{class:i$1.sectionSplitter})}_renderDisclaimer(){const{messages:e}=this,t=`<a class="${i$1.anchor}" href="http://www.esri.com/legal/software-license" rel="noreferrer" target="_blank">${e.esriTerms}</a>`,s=request.s$2(e.disclaimer,{esriTerms:t});return request.n$1("div",{class:i$1.disclaimer,innerHTML:s,key:"esri-directions__disclaimer"})}_renderDirectionsContainer(){return request.n$1("div",{class:this.classes(i$1.directionsSection,i$1.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())}_renderLoader(){return request.n$1("div",{class:i$1.loader,key:"loader"})}_renderWarningCard(){return request.n$1("div",{class:i$1.warningCard,role:"alert"},request.n$1("div",{class:i$1.warningHeader},request.n$1("span",{class:i$1.warningIcon,"aria-hidden":"true"}),request.n$1(Heading.s,{class:i$1.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),request.n$1("div",{class:i$1.warningMessage},this._getErrorMessage()))}_renderDirectionsContainerContent(){const{lastRoute:e,state:t}=this.viewModel,s="routing"===t;return "error"===t?this._renderWarningCard():s?this._renderLoader():e?request.n$1("div",{class:i$1.summary,key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):request.n$1("div",{key:"esri-directions__placeholder",class:i$1.emptyContent},this._renderPlaceholder(),request.n$1(Heading.s,{class:i$1.message,level:this.headingLevel},this.messages.directionsPlaceholder))}_renderPlaceholder(){return request.n$1("svg",{class:i$1.emptyIllustration,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},request.n$1("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))}_renderMessage(e){return request.n$1(Heading.s,{level:this.headingLevel},e)}_renderRouteActions(){return request.n$1("div",{class:i$1.routeActions},request.n$1("button",{"aria-label":this.messages.clearRoute,class:this.classes(i$1.clearRouteButton,i$1.button,i$1.buttonTertiary),tabIndex:0,onclick:this._handleClearRouteClick,bind:this,type:"button"},this.messages.clearRoute))}_renderManeuverSections(){const{sections:e}=this._routeSections;return request.n$1("div",{class:i$1.maneuvers,role:"group"},e.map(((t,s)=>{const{open:i}=t;let r;t.maneuvers.length>0&&i&&(r=request.n$1("ol",{class:i$1.maneuverList},t.maneuvers.map((e=>this._renderManeuver(e)))));const o=e.length>2,n=s===e.length-1,a={[i$1.collapsibleSection]:o},l={[i$1.openIcon]:!i,[i$1.closeIcon]:i};let c;if(o&&!n){const e=i?this.messagesCommon.open:this.messagesCommon.close;c=request.n$1("header",{class:this.classes(i$1.maneuverSectionHeader,i$1.maneuverSectionToggle),key:"esri-directions__maneuver-section-header"},request.n$1("div",{"aria-expanded":i.toString(),"aria-label":e,bind:this,class:i$1.maneuverSectionHeaderButton,"data-maneuver-section":t,onkeydown:this._handleSectionToggle,onclick:this._handleSectionToggle,role:"button",tabIndex:0,title:e},request.n$1(Heading.s,{class:i$1.maneuverSectionTitle,level:this.headingLevel},t.name),request.n$1("span",{"aria-hidden":"true",class:this.classes(l)})));}else c=request.n$1("header",{class:i$1.maneuverSectionHeader,key:"esri-directions__maneuver-section-header"},request.n$1(Heading.s,{class:i$1.maneuverSectionTitle,level:this.headingLevel},t.name));return request.n$1("section",{class:this.classes(i$1.maneuverSection,a)},c,r)})))}_handleSectionToggle(e){const t=e.currentTarget["data-maneuver-section"];t.open=!t.open;}_renderCosts(){const e=this.get("viewModel.directionLines"),t=e[e.length-1],s=new Date(t.attributes.arriveTimeUTC),i=this._costSummary.set({directionsViewModel:this.viewModel,messages:this.messages,messagesUnits:this.messagesUnits}),{messages:r}=this,o=r.zoomToRoute,n=request.L$1(s,B),a=request.s$2(r.etaTemplate,{time:`<strong>${n}</strong>`,gmt:`${V(s)}`}),l=r.primaryCosts,c=r.secondaryCosts,d=r.eta;return request.n$1("div",{"aria-label":o,bind:this,class:i$1.directionCosts,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,role:"button",tabIndex:0,title:o},request.n$1("div",{class:i$1.costsDetails,role:"group"},request.n$1("div",{"aria-label":l,class:i$1.primaryCosts,title:l},i.primary),request.n$1("div",{class:i$1.verticalSplitter}),request.n$1("div",{"aria-label":c,class:i$1.secondaryCosts,title:c},i.secondary)),request.n$1("div",{"aria-label":d,innerHTML:a,title:d}))}_handleSummaryInteraction(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute();}_getErrorMessage(){const{messages:e}=this,{error:t}=this.viewModel;return "directions-view-model:unable-to-route"===t.name?e.errors.unableToRoute:"directions-view-model:service-metadata-unavailable"===t.name?e.errors.unableToLoadServiceMetadata:e.errors.unknownError}_normalizeSearchSources(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e);}_overrideDefaultSources(e){e.viewModel.defaultSources.forEach((e=>{e.autoNavigate=!1;}));}_applyLocatorSourceOverrides({allSources:e}){0!==e.length&&e.forEach((e=>{"url"in e&&e.url&&(null===e.locationType&&(e.locationType="street"),Search.S(e.url)&&this.apiKey&&null==e.apiKey&&(e.apiKey=this.apiKey,e.url=Search.w));}));}_acquireSearch(e){const t=this.get("viewModel.view");if(this._stopsToSearches.has(e)){const s=this._stopsToSearches.get(e);return s.view=t,this._overrideDefaultSources(s),s}const s=new Search.y({view:t,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});return this._normalizeSearchSources(s),this._handles.add([request.$(s,"allSources","change",(()=>this._normalizeSearchSources(s))),s.on("select-result",(()=>{e.result=s.selectedResult,e.result.feature.attributes.Name=s.selectedResult.name,this._processStops(),this.scheduleRender();})),s.on("search-focus",(()=>this._handleStopInputFocus(s,e))),s.on("search-blur",(()=>this._handleStopInputBlur(s,e)))],s),this._stopsToSearches.set(e,s),s}_disposeSearch(e){this._stopsToSearches.get(e).destroy(),this._stopsToSearches.delete(e);}_processStops(){const e=this.viewModel;e.stops.removeAll(),e.stops.addMany(this._stops.filter((e=>!!e.result)).map((e=>e.result.feature))),e.stops.length>1&&e.getDirections();}_renderManeuver(e){const t="";let s;const{attributes:i}=e,r=this.get("viewModel.routeParameters.directionsLengthUnits"),{messages:o,messagesUnits:n$1}=this,a=D(o,n$1,i.length,{toUnits:r}),l=g(i.time),c=A$1(e);n(e,this.get("viewModel.routeParameters.startTime"))?s=i$2(o,i.arriveTimeUTC,i.ETA,"now"===this._departureTime):a&&(s=l?`${a}&nbsp;&middot;&nbsp;${l}`:a);const d=c,h=this._getFormattedManeuverText(e),u=this._getIconPath(i.maneuverType);if(d)return request.n$1("li",{class:i$1.maneuver,key:e},request.n$1("header",null,c.attributes.Name));const p=`esri-directions__maneuver-${e.uid}`,m=`esri-directions__cumulative-costs-${e.uid}`,v=`esri-directions__intermediate-costs-${e.uid}`,_={[i$1.maneuverActive]:this._activeManeuver===e};return request.n$1("li",{"aria-labelledby":`${p} ${m} ${v}`,bind:this,class:this.classes(i$1.maneuver,_),"data-maneuver":e,key:e,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},request.n$1("img",{alt:"",class:i$1.maneuverIcon,src:u}),request.n$1("div",{class:i$1.maneuverCostsContainer},request.n$1("span",{id:p,innerHTML:h}),request.n$1("div",{class:i$1.maneuverCosts},request.n$1("div",{class:i$1.horizontalSplitter}),request.n$1("div",{id:m,"aria-label":o.cumulativeCosts,class:i$1.cumulativeCost,innerHTML:t,title:o.cumulativeCosts}),request.n$1("div",{id:v,"aria-label":o.intermediateCosts,class:i$1.intermediateCost,innerHTML:s,title:o.intermediateCosts}))))}_getIconPath(e$1){const t=e(e$1),s=2===window.devicePixelRatio?"@2x":"";return `${t$1()}${t}${s}.png`}_handleManeuverClick(e){const t=e.currentTarget["data-maneuver"];if(this._activeManeuver===t)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=t,this.viewModel.centerAt(t),this.viewModel.highlightSegment(t);}_handleManeuverMouseOver(e){if(this._activeManeuver||this._focusedManeuver)return;const t=e.currentTarget["data-maneuver"];this.viewModel.highlightSegment(t);}_handleManeuverMouseOut(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights();}_handleManeuverBlur(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights());}_handleManeuverFocus(e){if(this._activeManeuver)return;const t=e.currentTarget["data-maneuver"];this._focusedManeuver=t,this.viewModel.highlightSegment(t);}_getFormattedManeuverText(e){const{attributes:{text:t},strings:s}=e;if(!s)return t;let i=t;return s.forEach((e=>{i=i.replace(e.string,`<strong>${e.string}</strong>`);})),i}};request.e([request.o("viewModel.apiKey")],G.prototype,"apiKey",void 0),request.e([request.o("viewModel.goToOverride")],G.prototype,"goToOverride",void 0),request.e([request.d()],G.prototype,"headingLevel",void 0),request.e([request.d()],G.prototype,"iconClass",void 0),request.e([request.d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],G.prototype,"label",void 0),request.e([request.o("viewModel.lastRoute")],G.prototype,"lastRoute",void 0),request.e([request.o("viewModel.maxStops")],G.prototype,"maxStops",void 0),request.e([request.d(),request.e$1("esri/widgets/Directions/t9n/Directions")],G.prototype,"messages",void 0),request.e([request.d(),request.e$1("esri/t9n/common")],G.prototype,"messagesCommon",void 0),request.e([request.d(),request.e$1("esri/core/t9n/Units")],G.prototype,"messagesUnits",void 0),request.e([request.o("viewModel.routeServiceUrl")],G.prototype,"routeServiceUrl",void 0),request.e([request.o("viewModel.routeSymbol")],G.prototype,"routeSymbol",void 0),request.e([request.d()],G.prototype,"searchProperties",void 0),request.e([request.o("viewModel.stopSymbols")],G.prototype,"stopSymbols",void 0),request.e([request.o("viewModel.view")],G.prototype,"view",void 0),request.e([request.d({type:x})],G.prototype,"viewModel",void 0),request.e([request.o("viewModel.getDirections")],G.prototype,"getDirections",null),request.e([request.o("viewModel.zoomToRoute")],G.prototype,"zoomToRoute",null),request.e([accessibleHandler.t()],G.prototype,"_handleStopIconClick",null),request.e([accessibleHandler.t()],G.prototype,"_handleClearRouteClick",null),request.e([accessibleHandler.t()],G.prototype,"_handleReverseStops",null),request.e([accessibleHandler.t()],G.prototype,"_handleRemoveStop",null),request.e([accessibleHandler.t()],G.prototype,"_handleSectionToggle",null),request.e([accessibleHandler.t()],G.prototype,"_handleSummaryInteraction",null),request.e([accessibleHandler.t()],G.prototype,"_handleManeuverClick",null),G=request.e([request.i("esri.widgets.Directions")],G);const W=G;

const arcgisDirectionsCss = "@import url('https://js.arcgis.com/next/esri/themes/light/main.css');";

let ArcGISDirections = class {
  constructor(hostRef) {
    index.registerInstance(this, hostRef);
    this.loaded = index.createEvent(this, "loaded", 7);
    this.position = 'bottom-left';
  }
  validateApiKey(value) {
    if (value && this.widget) {
      this.widget.apiKey = value;
    }
  }
  validateView(value) {
    if (value) {
      this.widget.view = value;
      if (this.el.parentElement.tagName.toLowerCase() !== 'arcgis-expand') {
        this.widget.view.ui.add(this.widget, this.position);
      }
    }
  }
  componentWillLoad() {
    const params = {
      container: this.el
    };
    if (this.apiKey) {
      params.apiKey = this.apiKey;
    }
    if (this.view) {
      params.view = this.view;
    }
    const directions = new W(params);
    this.widget = directions;
    this.loaded.emit(true);
  }
  get el() { return index.getElement(this); }
  static get watchers() { return {
    "apiKey": ["validateApiKey"],
    "view": ["validateView"]
  }; }
};
ArcGISDirections.style = arcgisDirectionsCss;

exports.arcgis_directions = ArcGISDirections;
