import{n as t}from"./p-382f7028.js";import{y as n,u as r,i as s,c as o,l as e,p as a,o as i,m as c,T as f,h as l,a as u,b as d,d as p,A as g,O as h,x as m,g as w,w as A,E as y,L as v,B as I,F as j,I as M,U,j as x,V as L,M as S,S as D,k as E,q as F,v as k,z as N,C as _,D as b,G as z,H as O}from"./p-f06611ed.js";import{A as P}from"./p-a72732f2.js";import{t as B}from"./p-04a0cfca.js";import{d0 as H,d1 as $,d2 as q}from"./p-e58503d5.js";import{u as G,a as V,o as W,r as C,z as J,_ as K,l as Q,H as R,c as T,q as X,M as Y}from"./p-2f398ed1.js";import{n as Z}from"./p-d3105731.js";const tt=P().vec3f("position").u16("componentIndex").u16("u16padding"),nt=P().vec2u8("sideness"),rt=B(nt),st=P().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("u8padding",{glPadding:!0}).u16("u16padding",{glPadding:!0}),ot=st.clone().vec3f("normal"),et=st.clone().vec3f("normalA").vec3f("normalB"),at=new Map([["position0",0],["position1",1],["componentIndex",2],["variantOffset",3],["variantStroke",4],["variantExtension",5],["normal",6],["normalA",6],["normalB",7],["sideness",8]]);class it{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?dt:ut}write(t,n,r){const s=this.edgeHashFunction(r);wt.seed=s;const o=wt.getIntRange(0,255),e=wt.getIntRange(0,this.settings.variants-1),a=wt.getFloat(),i=255*(.5*function(t){const n=t<0?-1:1;return Math.abs(t)**1.2*n}(-(1-Math.min(a/.7,1))+Math.max(0,a-.7)/(1-.7))+.5);t.position0.setVec(n,r.position0),t.position1.setVec(n,r.position1),t.componentIndex.set(n,r.componentIndex),t.variantOffset.set(n,o),t.variantStroke.set(n,e),t.variantExtension.set(n,i)}trim(t,n){return t.slice(0,n)}}const ct=new Float32Array(6),ft=new Uint32Array(ct.buffer),lt=new Uint32Array(1);function ut(t){const n=ct;n[0]=t.position0[0],n[1]=t.position0[1],n[2]=t.position0[2],n[3]=t.position1[0],n[4]=t.position1[1],n[5]=t.position1[2],lt[0]=5381;for(let t=0;t<ft.length;t++)lt[0]=31*lt[0]+ft[t];return lt[0]}function dt(t){const n=ct;n[0]=pt(t.position0[0]),n[1]=pt(t.position0[1]),n[2]=pt(t.position0[2]),n[3]=pt(t.position1[0]),n[4]=pt(t.position1[1]),n[5]=pt(t.position1[2]),lt[0]=5381;for(let t=0;t<ft.length;t++)lt[0]=31*lt[0]+ft[t];return lt[0]}function pt(t){return Math.round(1e4*t)/1e4}class gt{constructor(){this.commonWriter=new it}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return ot.createBuffer(t)}write(t,n,r){this.commonWriter.write(t,n,r),G(mt,r.faceNormal0,r.faceNormal1),V(mt,mt),t.normal.setVec(n,mt)}trim(t,n){return this.commonWriter.trim(t,n)}}gt.Layout=ot,gt.glLayout=B(ot,1);class ht{constructor(){this.commonWriter=new it}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return et.createBuffer(t)}write(t,n,r){this.commonWriter.write(t,n,r),t.normalA.setVec(n,r.faceNormal0),t.normalB.setVec(n,r.faceNormal1)}trim(t,n){return this.commonWriter.trim(t,n)}}ht.Layout=et,ht.glLayout=B(et,1);const mt=Z(),wt=new H;function At(t,n){return n.push(t.buffer),{buffer:t.buffer,layout:vt(t.layout)}}function yt(t){return function(t){const n=P();return n.stride=t.stride,n.fieldNames=t.fieldNames,t.fields.forEach((t=>n.fields.set(t[0],{...t[1],constructor:Mt(t[1].constructor)}))),n}(t.layout).createView(t.buffer)}function vt(t){const n=new Array;return t.fields.forEach(((t,r)=>{const s={...t,constructor:jt(t.constructor)};n.push([r,s])})),{stride:t.stride,fields:n,fieldNames:t.fieldNames}}const It=[n,r,s,o,e,a,i,c,f,l,u,d,p,g,h,m,w,A,y,v,I,j,M,U,x,L,S,D,E,F,k,N,_,b,z,O];function jt(t){return`${t.ElementType}_${t.ElementCount}`}function Mt(t){return Ut.get(t)}const Ut=new Map;function xt(t,n,r){const s=n/3,o=new Uint32Array(r+1),e=new Uint32Array(r+1),a=(t,n)=>{t<n?o[t+1]++:e[n+1]++};for(let n=0;n<s;n++){const r=t[3*n],s=t[3*n+1],o=t[3*n+2];a(r,s),a(s,o),a(o,r)}let i=0,c=0;for(let t=0;t<r;t++){const n=o[t+1],r=e[t+1];o[t+1]=i,e[t+1]=c,i+=n,c+=r}const f=new Uint32Array(6*s),l=o[r],u=(t,n,r)=>{if(t<n){const s=o[t+1]++;f[2*s]=n,f[2*s+1]=r}else{const s=e[n+1]++;f[2*l+2*s]=t,f[2*l+2*s+1]=r}};for(let n=0;n<s;n++){const r=t[3*n],s=t[3*n+1],o=t[3*n+2];u(r,s,n),u(s,o,n),u(o,r,n)}const d=(t,n)=>{const r=2*t,s=n-t;for(let t=1;t<s;t++){const n=f[r+2*t],s=f[r+2*t+1];let o=t-1;for(;o>=0&&f[r+2*o]>n;o--)f[r+2*o+2]=f[r+2*o],f[r+2*o+3]=f[r+2*o+1];f[r+2*o+2]=n,f[r+2*o+3]=s}};for(let t=0;t<r;t++)d(o[t],o[t+1]),d(l+e[t],l+e[t+1]);const p=new Int32Array(3*s),g=(n,r)=>n===t[3*r]?0:n===t[3*r+1]?1:n===t[3*r+2]?2:-1,h=(t,n)=>{const r=g(t,n);p[3*n+r]=-1},m=(t,n,r,s)=>{const o=g(t,n);p[3*n+o]=s;const e=g(r,s);p[3*s+e]=n};for(let t=0;t<r;t++){let n=o[t];const r=o[t+1];let s=e[t];const a=e[t+1];for(;n<r&&s<a;){const r=f[2*n],o=f[2*l+2*s];r===o?(m(t,f[2*n+1],o,f[2*l+2*s+1]),n++,s++):r<o?(h(t,f[2*n+1]),n++):(h(o,f[2*l+2*s+1]),s++)}for(;n<r;)h(t,f[2*n+1]),n++;for(;s<a;)h(f[2*l+2*s],f[2*l+2*s+1]),s++}return p}It.forEach((t=>Ut.set(jt(t),t)));const Lt=-1;function St(t,n){return t.cosAngle<n}function Dt(t,n){return t.cosAngle>n}function Et(t,n){const r=Q(t.cosAngle),s=kt.fwd,o=kt.ortho;return R(s,t.position1,t.position0),r*(J(K(o,t.faceNormal0,t.faceNormal1),s)>0?-1:1)>n}function Ft(t){const n=t.faces.length/3,r=t.vertices.position,s=t.faces,o=Nt.v0,e=Nt.v1,a=Nt.v2,i=new Float32Array(3*n);for(let t=0;t<n;t++){const n=s[3*t+1],c=s[3*t+2];r.getVec(s[3*t+0],o),r.getVec(n,e),r.getVec(c,a),T(e,e,o),T(a,a,o),K(o,e,a),V(o,o),i[3*t+0]=o[0],i[3*t+1]=o[1],i[3*t+2]=o[2]}return i}const kt={edge:{position0:Z(),position1:Z(),faceNormal0:Z(),faceNormal1:Z(),componentIndex:0,cosAngle:0},ortho:Z(),fwd:Z()},Nt={v0:Z(),v1:Z(),v2:Z()},_t={anglePlanar:4,angleSignificantEdge:35};function bt(t){const n=Pt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Bt.updateSettings(t.writerSettings),Ht.updateSettings(t.writerSettings),function(t,n,r,s=_t){const o=t.vertices.position,e=t.vertices.componentIndex,a=Y(s.anglePlanar),i=Y(s.angleSignificantEdge),c=Math.cos(i),f=Math.cos(a),l=kt.edge,u=l.position0,d=l.position1,p=l.faceNormal0,g=l.faceNormal1,h=Ft(t),m=function(t){const n=t.faces.length/3,r=t.faces,s=t.neighbors;let o=0;for(let t=0;t<n;t++){const n=r[3*t+0],e=r[3*t+1],a=r[3*t+2];o+=s[3*t+0]===Lt||n<e?1:0,o+=s[3*t+1]===Lt||e<a?1:0,o+=s[3*t+2]===Lt||a<n?1:0}const e=new Int32Array(4*o);let a=0;for(let t=0;t<n;t++){const n=s[3*t+0],o=s[3*t+1],i=s[3*t+2],c=r[3*t+0],f=r[3*t+1],l=r[3*t+2];(n===Lt||c<f)&&(e[a++]=c,e[a++]=f,e[a++]=t,e[a++]=n),(o===Lt||f<l)&&(e[a++]=f,e[a++]=l,e[a++]=t,e[a++]=o),(i===Lt||l<c)&&(e[a++]=l,e[a++]=c,e[a++]=t,e[a++]=i)}return e}(t),w=m.length/4,A=n.allocate(w);let y=0;const v=r.allocate(w);let I=0,j=0,M=0;const U=$(0,w),x=new Float32Array(w);q(x,((t,n,r)=>{o.getVec(m[4*n+0],u),o.getVec(m[4*n+1],d),r[n]=X(u,d)})),U.sort(((t,n)=>x[n]-x[t]));const L=new Array,S=new Array;for(let t=0;t<w;t++){const s=U[t],i=x[s],w=m[4*s+0],D=m[4*s+1],E=m[4*s+2],F=m[4*s+3],k=F===Lt;if(o.getVec(w,u),o.getVec(D,d),k)W(p,h[3*E+0],h[3*E+1],h[3*E+2]),C(g,p),l.componentIndex=e.get(w),l.cosAngle=J(p,g);else{if(W(p,h[3*E+0],h[3*E+1],h[3*E+2]),W(g,h[3*F+0],h[3*F+1],h[3*F+2]),l.componentIndex=e.get(w),l.cosAngle=J(p,g),Dt(l,f))continue;l.cosAngle<-.9999&&C(g,p)}j+=i,M++,k||St(l,c)?(n.write(A,y++,l),L.push(i)):Et(l,a)&&(r.write(v,I++,l),S.push(i))}const D=new Float32Array(L.reverse()),E=new Float32Array(S.reverse());return{regular:{instancesData:n.trim(A,y),lodInfo:{lengths:D}},silhouette:{instancesData:r.trim(v,I),lodInfo:{lengths:E}},averageEdgeLength:j/M}}(n,Bt,Ht)}function zt(t){return{data:tt.createView(t.dataBuffer),indices:"Uint32Array"===t.indicesType?new Uint32Array(t.indicesBuffer):"Uint16Array"===t.indicesType?new Uint16Array(t.indicesBuffer):void 0,indicesLength:t.indicesLength,writerSettings:t.writerSettings,skipDeduplicate:t.skipDeduplicate}}function Ot(t,n){return n.push(t.regular.lodInfo.lengths.buffer),n.push(t.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:At(t.regular.instancesData,n),lodInfo:{lengths:t.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:At(t.silhouette.instancesData,n),lodInfo:{lengths:t.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:t.averageEdgeLength}}function Pt(n,r,s,o){if(r)return{faces:s,facesLength:o,neighbors:xt(s,o,n.count),vertices:n};const e=t(n.buffer,n.stride/4,{originalIndices:s,originalIndicesLength:o}),a=xt(e.indices,o,e.uniqueCount);return{faces:e.indices,facesLength:e.indices.length,neighbors:a,vertices:tt.createView(e.buffer)}}const Bt=new gt,Ht=new ht,$t=Object.freeze({__proto__:null,work:bt,wrappedWork:async function(t){const n=zt(t),r=bt(n),s=[n.data.buffer];return{result:Ot(r,s),transferList:s}}});export{yt as D,$t as E,gt as d,tt as e,bt as f,nt as i,at as p,rt as t,ht as w}