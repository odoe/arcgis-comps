import{A as t,Q as n,ak as e,Z as r}from"./p-e58503d5.js";import{v as o}from"./p-c048b814.js";import{v as u}from"./p-c1cd5521.js";import{t as s}from"./p-ca4492df.js";import{r as c}from"./p-2db4840f.js";function l(t){const n={};for(const e in t){if("declaredClass"===e)continue;const r=t[e];if(null!=r&&"function"!=typeof r)if(Array.isArray(r)){n[e]=[];for(let t=0;t<r.length;t++)n[e][t]=l(r[t])}else"object"==typeof r?r.toJSON&&(n[e]=JSON.stringify(r)):n[e]=r}return n}const a="Layer does not support extent calculation.";function f(n,e){const r=n.geometry,u=n.toJSON(),s=u;if(t(r)&&(s.geometry=JSON.stringify(r),s.geometryType=o(r),s.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),u.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=u.groupByFieldsForStatistics.join(",")),u.objectIds&&(s.objectIds=u.objectIds.join(",")),u.orderByFields&&(s.orderByFields=u.orderByFields.join(",")),!u.outFields||!u.returnDistinctValues&&(null!=e&&e.returnCountOnly||null!=e&&e.returnExtentOnly||null!=e&&e.returnIdsOnly)?delete s.outFields:s.outFields=-1!==u.outFields.indexOf("*")?"*":u.outFields.join(","),u.outSR?s.outSR=u.outSR.wkid||JSON.stringify(u.outSR):r&&(u.returnGeometry||u.returnCentroid)&&(s.outSR=s.inSR),u.returnGeometry&&delete u.returnGeometry,u.outStatistics&&(s.outStatistics=JSON.stringify(u.outStatistics)),u.pixelSize&&(s.pixelSize=JSON.stringify(u.pixelSize)),u.quantizationParameters&&(s.quantizationParameters=JSON.stringify(u.quantizationParameters)),u.parameterValues&&(s.parameterValues=JSON.stringify(u.parameterValues)),u.rangeValues&&(s.rangeValues=JSON.stringify(u.rangeValues)),u.dynamicDataSource&&(s.layer=JSON.stringify({source:u.dynamicDataSource}),delete u.dynamicDataSource),u.timeExtent){const t=u.timeExtent,{start:n,end:e}=t;null==n&&null==e||(s.time=n===e?n:`${null==n?"null":n},${null==e?"null":e}`),delete u.timeExtent}return s}async function i(n,e,r,o){const u=t(e.timeExtent)&&e.timeExtent.isEmpty?{data:{features:[]}}:await j(n,e,"json",o);return c(e,r,u.data),u}async function y(n,e,r,o){if(t(e.timeExtent)&&e.timeExtent.isEmpty)return Promise.resolve({data:r.createFeatureResult()});const u=await d(n,e,o),c=u;return c.data=s(u.data,r),c}function d(t,n,e){return j(t,n,"pbf",e)}function p(n,e,r){return t(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):j(n,e,"json",r,{returnIdsOnly:!0})}function O(n,e,r){return t(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):j(n,e,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function m(n,e,r){return t(e.timeExtent)&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):j(n,e,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then((t=>{const n=t.data;if(n.hasOwnProperty("extent"))return t;if(n.features)throw new Error(a);if(n.hasOwnProperty("count"))throw new Error(a);return t}))}function j(o,s,c,a={},i={}){const y="string"==typeof o?r(o):o,d=s.geometry?[s.geometry]:[];return a.responseType="pbf"===c?"array-buffer":"json",u(d,null,a).then((r=>{const o=r&&r[0];t(o)&&((s=s.clone()).geometry=o);const u=l({...y.query,f:c,...i,...f(s,i)});return n(e(y.path,"query"),{...a,query:{...u,...a.query}})}))}const x=Object.freeze({__proto__:null,executeQuery:i,executeQueryForCount:O,executeQueryForExtent:m,executeQueryForIds:p,executeQueryPBF:y,executeQueryPBFBuffer:d,queryToQueryStringParameters:f,runQuery:j});export{m as S,y as c,d,p as f,j as g,O as p,x as q,l as t,i as y}