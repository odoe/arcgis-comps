import{s as n}from"./p-e58503d5.js";import{s as e,t}from"./p-182bb5be.js";import{B as o}from"./p-765e6c28.js";const r={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function i(n){return r[n]}function*u(n){switch(n.type){case"Feature":yield n;break;case"FeatureCollection":for(const e of n.features)e&&(yield e)}}function*c(n){if(!n)return null;switch(n.type){case"Point":yield n.coordinates;break;case"LineString":case"MultiPoint":yield*n.coordinates;break;case"MultiLineString":case"Polygon":for(const e of n.coordinates)yield*e;break;case"MultiPolygon":for(const e of n.coordinates)for(const n of e)yield*n}}function*s(n,o={}){const{geometryType:r,objectIdField:u}=o;for(const s of n){var c;const{geometry:n,properties:l,id:f}=s;if(n&&i(n.type)!==r)continue;const y=l||{};let p=null!=(c=y[u])?c:null;u&&null!=f&&!y[u]&&(y[u]=p=f);const d=new e(n?a(new t,n,o):null,y,null,p);yield d}}function l(n){for(const e of n)if(e.length>2)return!0;return!1}function f(n){let e=0;for(let t=0;t<n.length;t++){const o=n[t],r=n[(t+1)%n.length];e+=o[0]*r[1]-r[0]*o[1]}return e<=0}function y(n){const e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]||n.push(e),n}function a(n,e,t){switch(e.type){case"LineString":return function(n,e,t){return g(n,e.coordinates,t),n}(n,e,t);case"MultiLineString":return function(n,e,t){for(const o of e.coordinates)g(n,o,t);return n}(n,e,t);case"MultiPoint":return function(n,e,t){return g(n,e.coordinates,t),n}(n,e,t);case"MultiPolygon":return function(n,e,t){for(const o of e.coordinates){p(n,o[0],t);for(let e=1;e<o.length;e++)d(n,o[e],t)}return n}(n,e,t);case"Point":return function(n,e,t){return w(n,e.coordinates,t),n}(n,e,t);case"Polygon":return function(n,e,t){const o=e.coordinates;p(n,o[0],t);for(let e=1;e<o.length;e++)d(n,o[e],t);return n}(n,e,t)}}function p(n,e,t){const o=y(e);!function(n){return!f(n)}(o)?g(n,o,t):m(n,o,t)}function d(n,e,t){const o=y(e);!function(n){return f(n)}(o)?g(n,o,t):m(n,o,t)}function g(n,e,t){for(const o of e)w(n,o,t);n.lengths.push(e.length)}function m(n,e,t){for(let o=e.length-1;o>=0;o--)w(n,e[o],t);n.lengths.push(e.length)}function w(n,e,t){const[o,r,i]=e;n.coords.push(o,r),t.hasZ&&n.coords.push(i||0)}function P(n){switch(typeof n){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function b(e){if(!e)throw new n("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new n("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:t}=e;if(!t)return;const o="string"==typeof t?t:"name"===t.type?t.properties.name:"EPSG"===t.type?t.properties.code:null,r=new RegExp(".*(CRS84H?|4326)$","i");if(!o||!r.test(o))throw new n("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}function S(n,e={}){const t=[],r=new Set,s=new Set;let f,y=!1,a=null,p=!1,{geometryType:d=null}=e,g=!1;for(const e of u(n)){const{geometry:n,properties:o,id:u}=e;if((!n||(d||(d=i(n.type)),i(n.type)===d))&&(y||(y=l(c(n))),p||(p=null!=u,p&&(f=typeof u,a=Object.keys(o).filter((n=>o[n]===u)))),p&&null!=u&&(a.length>1?a=a.filter((n=>o[n]===u)):1===a.length&&(a=o[a[0]]===u?a:[])),!g&&o)){let n=!0;for(const e in o){if(r.has(e))continue;const i=o[e];if(null==i){n=!1,s.add(e);continue}const u=P(i);"unknown"!==u?(s.delete(e),r.add(e),t.push({name:e,alias:e,type:u})):s.add(e)}g=n}}const m=a&&1===a.length&&a[0]||null;if(m)for(const n of t)if(n.name===m&&o(n)){n.type="esriFieldTypeOID";break}return{fields:t,geometryType:d,hasZ:y,objectIdFieldName:m,objectIdFieldType:f,unknownFields:Array.from(s)}}function j(n,e){return Array.from(s(u(n),e))}export{j as L,b as O,S as T,i}