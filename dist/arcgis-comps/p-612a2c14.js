import{A as t,af as e,V as i,e as s,d as n,i as r,p as o,S as a,Y as l,bQ as u,v as c,c as h,w as d,t as p,x as f,f as m,a as v,s as g,m as b,o as w,j as y,z as _,$ as M,l as I,aB as A,bR as F,y as k,Q as x,T as C,ay as T,bS as E,M as P,bT as $,u as O,b as L,H as j,r as z,g as N,O as R,aF as V,K as S,bU as D,a8 as U,aE as B,bV as H,by as q,bW as W,aI as G,bA as K}from"./p-e58503d5.js";import{l as Q,d as X,a as Y}from"./p-7731c620.js";import{e as Z}from"./p-2f398ed1.js";import{D as J,E as tt,N as et,O as it,F as st}from"./p-01e5a461.js";import{h as nt}from"./p-54330161.js";import{l as rt}from"./p-d443df87.js";import{u as ot,l as at}from"./p-ff2962f5.js";import{a as lt,e as ut,B as ct}from"./p-765e6c28.js";import{u as ht,i as dt,e as pt,g as ft,h as mt,a as vt,c as gt,b as bt}from"./p-93765525.js";import{s as wt}from"./p-da9e7ba9.js";import{e as yt,t as _t}from"./p-a8f0aa27.js";import{b as Mt,m as It}from"./p-5e833dfc.js";import{Q as At}from"./p-4a96de15.js";import{G as Ft}from"./p-dae095dd.js";import"./p-b79fcce3.js";import{S as kt}from"./p-8bc9b36a.js";import{b as xt}from"./p-3e39c093.js";import{v as Ct,M as Tt,q as Et}from"./p-2ae44317.js";import{e as Pt}from"./p-f3659a34.js";import{e as $t}from"./p-ca657fcf.js";import{e as Ot}from"./p-b312c1fd.js";import{t as Lt}from"./p-b8beb0d3.js";import{t as jt}from"./p-2a99994a.js";import{c as zt}from"./p-fb38a9d0.js";let Nt=null;function Rt(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function Vt(t,e,i){const{backgroundColor:s,outline:n,dotSize:r}=t,o=i&&i.swatchSize||22,a=Math.round(o*o/r**2*.8),l=window.devicePixelRatio,u=document.createElement("canvas"),c=o*l;u.width=c,u.height=c,u.style.width=u.width/l+"px",u.style.height=u.height/l+"px";const h=u.getContext("2d");if(s&&(h.fillStyle=s.toCss(!0),h.fillRect(0,0,c,c),h.fill()),h.fillStyle=e.toCss(!0),Nt&&Nt.length/2===a)for(let t=0;t<2*a;t+=2)h.fillRect(Nt[t],Nt[t+1],r*l,r*l),h.fill();else{Nt=[];for(let t=0;t<2*a;t+=2){const t=Rt(0,c),e=Rt(0,c);Nt.push(t,e),h.fillRect(t,e,r*l,r*l),h.fill()}}n&&(n.color&&(h.strokeStyle=n.color.toCss(!0)),h.lineWidth=n.width,h.strokeRect(0,0,c,c));const d=new Image(o,o);return d.src=u.toDataURL(),d.style.filter=i.effect,d}function St(t,e={}){const i="horizontal"===e.align,s=i?75:24,n=i?24:75,{width:r=s,height:o=n,gradient:a=!0}=e,l=window.devicePixelRatio,u=r*l,c=o*l,h=document.createElement("canvas");h.width=u,h.height=c,h.style.width=`${r}px`,h.style.height=`${o}px`;const d=h.getContext("2d");if(a){const e=d.createLinearGradient(0,0,i?u:0,i?0:c),s=t.length,n=1===s?0:1/(s-1);t.forEach(((t,i)=>e.addColorStop(i*n,t.toString()))),d.fillStyle=e,d.fillRect(0,0,u,c)}else{const e=i?u/t.length:u,s=i?c:c/t.length;let n=0,r=0;for(const o of t)d.fillStyle=o.toString(),d.fillRect(n,r,e,s),n=i?n+e:0,r=i?0:r+s}const p=document.createElement("div");return p.style.width=`${r}px`,p.style.height=`${o}px`,p.style.filter=null==e?void 0:e.effect,p.appendChild(h),p}async function Dt(t,e){switch(t.type){case"web-style":{const{previewWebStyleSymbol:i}=await import("./p-a07d1a6d.js");return i(t,Dt,e)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:i}=await import("./p-095e34be.js");return i(t,e)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:i}=await import("./p-d7210ae3.js");return i(t,e)}case"cim":{const{previewCIMSymbol:i}=await import("./p-c40deac9.js");return i(t,e)}default:return}}function Ut(t){return t&&"opacity"in t?t.opacity*Ut(t.parent):1}async function Bt(s,n){var r,o;if(!s)return;const a=s.sourceLayer,l=null!=(r=t(n)&&null!=(o=n.useSourceLayer)&&o?a:s.layer)?r:a,u=Ut(l);if(t(s.symbol)&&(!t(n)||!0!==n.ignoreGraphicSymbol)){const e="web-style"===s.symbol.type?await s.symbol.fetchSymbol(t(n)?n.abortOptions:null):s.symbol.clone();return Ct(e,null,u),e}const c=t(n)&&n.renderer||l&&"renderer"in l&&l.renderer;let h=c&&"getSymbolAsync"in c?await c.getSymbolAsync(s,n):null;if(!h)return;if(h="web-style"===h.type?await h.fetchSymbol(t(n)?n.abortOptions:null):h.clone(),!("visualVariables"in c)||!c.visualVariables||!c.visualVariables.length)return Ct(h,null,u),h;if("arcadeRequiredForVisualVariables"in c&&c.arcadeRequiredForVisualVariables&&(e(n)||e(n.arcade))){const t={...i(n)};t.arcade=await lt(),n=t}const d=await import("./p-9f1c2d50.js"),p=[],f=[],m=[],v=[];for(const t of c.visualVariables)switch(t.type){case"color":p.push(t);break;case"opacity":f.push(t);break;case"rotation":v.push(t);break;case"size":t.target||m.push(t)}const g=!!p.length&&p[p.length-1],b=g?d.getColor(g,s,n):null,w=!!f.length&&f[f.length-1];let y=w?d.getOpacity(w,s,n):null;if(null!=u&&(y=null!=y?y*u:u),Ct(h,b,y),m.length){const t=d.getAllSizes(m,s,n);await Tt(h,t)}for(const t of v)Et(h,d.getRotationAngle(t,s,n),t.axis);return h}let Ht=class extends o{constructor(){super(...arguments),this.items=new a,this._watchUpdatingTracking=new Q,this._callbacks=new Map,this._projector=l(),this._hiddenProjector=l()}get needsRender(){return this.items.length>0}initialize(){const t=document.createElement("div");t.className="esri-overlay-surface",this._set("surface",t),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),t.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(this.items,(t=>{for(const e of t.added){const t=()=>e.render();this._callbacks.set(e,t),this._projector.append(this.surface,t)}for(const e of t.removed){const t=this._projector.detach(this._callbacks.get(e));this.surface.removeChild(t.domNode),this._callbacks.delete(e)}}))}addItem(t){this.items.add(t)}removeItem(t){this.items.remove(t)}destroy(){this.items.removeAll(),this._callbacks.forEach((t=>this._projector.detach(t))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(t){const e=this._hiddenSurface,i=this._hiddenProjector;let s=null;const n=()=>(s=t.render(),s);i.append(e,n),i.renderNow();const r={left:0,top:0,right:0,bottom:0};if(s&&s.domNode){const t=s.domNode.getBoundingClientRect();r.left=t.left,r.top=t.top,r.right=t.right,r.bottom=t.bottom}for(i.detach(n);e.firstChild;)e.removeChild(e.firstChild);return r}overlaps(t,e){const i=this.computeBoundingRect(t),s=this.computeBoundingRect(e);return Math.max(i.left,s.left)<=Math.min(i.right,s.right)&&Math.max(i.top,s.top)<=Math.min(i.bottom,s.bottom)}get hasVisibleItems(){return this.items.some((t=>t.visible))}renderCanvas(t){if(!this.items.some((t=>t.visible)))return;const e=t.getContext("2d");e.save(),e.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach((t=>{e.save(),t.renderCanvas(e),e.restore()})),e.restore()}};s([n({readOnly:!0})],Ht.prototype,"surface",void 0),s([n({readOnly:!0})],Ht.prototype,"items",void 0),s([n({readOnly:!0})],Ht.prototype,"needsRender",null),s([n({readOnly:!0})],Ht.prototype,"_watchUpdatingTracking",void 0),s([n({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],Ht.prototype,"updating",void 0),Ht=s([r("esri.views.overlay.ViewOverlay")],Ht);const qt=Ht;function Wt(t,e,i,s){let n=null,r=1e3;"number"==typeof e?(r=e,s=i):(n=null!=e?e:null,r=i);let o,a=0;const l=()=>{a=0,t.apply(s,o)},u=(...t)=>{n&&n.apply(s,t),o=t,r?a||(a=setTimeout(l,r)):l()};return u.remove=()=>{a&&(clearTimeout(a),a=0)},u.forceUpdate=()=>{a&&(clearTimeout(a),l())},u.hasPendingUpdates=()=>!!a,u}function Gt(t,e,i,s=2,n="abbr"){return`${c(e,{minimumFractionDigits:s,maximumFractionDigits:s})} ${function(t,e,i){return t.units[e][i]}(t,i,n)}`}function Kt(t,e,i,s=2,n="abbr"){const r=tt(e,i);return Gt(t,J(e,i,r),r,s,n)}function Qt(t,e,i,s=2,n="abbr"){const r=et(e,i);return Gt(t,J(e,i,r),r,s,n)}function Xt(t,e,i,s=2,n="abbr"){const r=it(e,i);return Gt(t,J(e,i,r),r,s,n)}function Yt(t,e,i,s=2,n="abbr"){const r=st(e,i);return Gt(t,J(e,i,r),r,s,n)}function Zt(t,e,i=2){let s=J(t,e,"degrees"),n=s-Math.floor(s);s-=n,n*=60;let r=n-Math.floor(n);return n-=r,r*=60,`${s.toFixed()}Â° ${n.toFixed()}' ${r.toFixed(i)}"`}const Jt=["B","kB","MB","GB","TB"],te=h.getLogger("esri.widgets.Feature.support.featureUtils"),ee=/href=(""|'')/gi,ie=/(\{([^\{\r\n]+)\})/g,se=/\'/g,ne=/^\s*expression\//i,re=/(\n)/gi,oe=/[\u00A0-\u9999<>\&]/gim,ae=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,le=/^(?:mailto:|tel:)/,ue="relationships/",ce=f("short-date-short-time");function he(t){if(!e(t))return t.get("sourceLayer")||t.get("layer")}async function de(t,e){return"function"==typeof t?t.call(null,e):t}function pe(t=""){if(t)return!le.test(t.trim().toLowerCase())}function fe(t){return!!t&&ne.test(t)}function me(t,e){const i=function(t,e){if(!fe(e)||!t)return null;const i=e.replace(ne,"").toLowerCase();let s;return t.some((t=>t.name.toLowerCase()===i&&(s=t,!0))),s}(e,null==t?void 0:t.fieldName);return i?i.title||null:t?t.label||t.fieldName:null}function ve(t,e){const i=ge(e,t);return i?i.name:t}function ge(t,e){return t&&"function"==typeof t.getField?t.getField(e):null}function be(t){return`${t}`.trim()}function we({attributes:t,globalAttributes:e,layer:i,text:s,expressionAttributes:n,fieldInfoMap:r}){return s?ye({formattedAttributes:e,template:Me(s,{...e,...n,...t},i),fieldInfoMap:r}):""}function ye({formattedAttributes:t,template:e,fieldInfoMap:i}){return be(function(t){return t.replace(ee,"")}(u(u(e,(t=>function(t,e){const i=e.get(t.toLowerCase());return`{${i&&i.fieldName||t}}`}(t,i))),t)))}function _e(t,e){return t.replace(ie,((t,i,s)=>{const n=ge(e,s);return n?`{${n.name}}`:i}))}function Me(t,e,i){const s=_e(t,i);return s?s.replace(ae,((t,i,s)=>function(t,e,i){const s=(e=be(e))&&"{"!==e[0];return u(t,function(t,e=!1){const i={...t};return Object.keys(i).forEach((t=>function(t,e,i=!1){const s=e[t];if("string"==typeof s){const n="%27",r=(i?encodeURIComponent(s):s).replace(se,n);e[t]=r}}(t,i,e))),i}(i,s))}(t,i||s,e))):s}function Ie(t,e){const i=e.fieldName,s=Ae(e.fieldInfos,i),n=null==s?void 0:s.clone(),r=e.preventPlacesFormatting,o=e.layer,a=ge(o,i);if(n&&"date"===(null==a?void 0:a.type)){const t=n.format||new ht;t.dateFormat=t.dateFormat||"short-date-short-time",t.dateTimeFormatOptions=function(t){return"feature"===(null==t?void 0:t.type)}(o)&&o.datesInUnknownTimezone||function(t){return!(null==t||!t.layer)}(o)&&function(t){return"map-image"===(null==t?void 0:t.type)}(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,n.format=t}const l=n&&n.format;return"string"==typeof(t=function(t,e){if("string"==typeof t&&e&&null==e.dateFormat&&(null!=e.places||null!=e.digitSeparator)){const e=Number(t);if(!isNaN(e))return e}return t}(t,l))||null==t||null==l?t:r?c(t,{...d(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(t)}function Ae(t,e){if(!t||!t.length||!e)return;const i=e.toLowerCase();let s;return t.some((t=>!(!t.fieldName||t.fieldName.toLowerCase()!==i||(s=t,0)))),s}function Fe(t){const e=[];if(!t)return e;const{fieldInfos:i,content:s}=t;return i&&e.push(...i),s&&Array.isArray(s)?(s.forEach((t=>{if("fields"===t.type){const i=t&&t.fieldInfos;i&&e.push(...i)}})),e):e}function ke(t){return t.replace(oe,(t=>`&#${t.charCodeAt(0)};`))}function xe(t){return"string"==typeof t?t.replace(re,'<br class="esri-text-new-line" />'):t}function Ce({fieldInfos:t,attributes:e,layer:i,graphic:s,fieldInfoMap:n,relatedInfos:r}){const o={};return null==r||r.forEach((t=>function(t,e){t&&e&&(e.relatedFeatures&&e.relatedFeatures&&e.relatedFeatures.forEach((i=>Ee({attributes:t,graphic:i,relatedInfo:e}))),e.relatedStatsFeatures&&e.relatedStatsFeatures&&e.relatedStatsFeatures.forEach((i=>Ee({attributes:t,graphic:i,relatedInfo:e}))))}(o,t))),Object.keys(e).forEach((r=>{o[r]=function(t){const{value:e,fieldName:i,fieldInfos:s,fieldInfoMap:n,layer:r,graphic:o}=t;if(null==e)return"";const a=function({fieldName:t,value:e,graphic:i,layer:s}){if(Te(t))return null;if(!s||"function"!=typeof s.getFieldDomain)return null;const n=s.getFieldDomain(t,{feature:i});return n&&"coded-value"===n.type?n.getName(e):null}({fieldName:i,value:e,graphic:o,layer:r});if(a)return a;const l=function({fieldName:t,graphic:e,layer:i}){if(Te(t))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:s}=i;if(!s||t!==s)return null;const n=i.getFeatureType(e);return n?n.name:null}({fieldName:i,graphic:o,layer:r});if(l)return l;if(n.get(i.toLowerCase()))return Ie(e,{fieldInfos:s,fieldName:i,layer:r});const u=r&&r.fieldsIndex;return u&&u.isDateField(i)?p(e,ce):xe(e)}({fieldName:r,fieldInfos:t,fieldInfoMap:n,layer:i,value:e[r],graphic:s})})),o}function Te(t=""){return!!t&&-1!==t.indexOf(ue)}function Ee({attributes:t,graphic:e,relatedInfo:i}){t&&e&&i&&Object.keys(e.attributes).forEach((s=>{const n=function(t){return t?`${ue}${t.layerId}/${t.fieldName}`:""}({layerId:i.relation.id.toString(),fieldName:s});t[n]=e.attributes[s]}))}const Pe=t=>{if(!t)return!1;const e=t.toUpperCase();return e.indexOf("CURRENT_TIMESTAMP")>-1||e.indexOf("CURRENT_DATE")>-1||e.indexOf("CURRENT_TIME")>-1},$e=({layer:e,method:i,query:s,definitionExpression:n})=>{var r,o;if(null==(r=e.capabilities)||null==(o=r.query)||!o.supportsCacheHint||"attachments"===i)return;const a=t(s.where)&&s.where,l=t(s.geometry)&&s.geometry;Pe(n)||Pe(a)||"extent"===(null==l?void 0:l.type)||"tile"===s.resultType||(s.cacheHint=!0)},Oe={editing:!1,operations:{add:!0,update:!0,delete:!0}},Le=a.ofType(rt);let je=class extends X{constructor(t){super(t),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...Oe},this.activeAttachmentInfo=null,this.attachmentInfos=new Le,this.graphic=null,this.mode="view",this.handles.add([v(this,"graphic",(()=>this._graphicChanged()))])}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(t){return{...Oe,...t}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}async getAttachments(){const{_attachmentLayer:t,attachmentInfos:e}=this;if(!t||"function"!=typeof t.queryAttachments)throw new g("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),s=new ot({objectIds:[i],returnMetadata:!0}),n=[],r=t.queryAttachments(s).then((t=>t[i]||n)).catch((()=>n));this._getAttachmentsPromise=r,this.notifyChange("state");const o=await r;return e.removeAll(),o.length&&e.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(t){const{_attachmentLayer:e,attachmentInfos:i,graphic:s,abilities:n}=this;if(!t)throw new g("invalid-attachment","addAttachment(): An attachment is required.",{attachment:t});if(!n.operations.add)throw new g("invalid-abilities","addAttachment(): add abilities are required.");if(!e||"function"!=typeof e.addAttachment)throw new g("invalid-layer","addAttachment(): A valid layer is required.");const r=e.addAttachment(s,t).then((t=>this._queryAttachment(t.objectId))),o=await r;return i.add(o),o}async deleteAttachment(t){const{_attachmentLayer:e,attachmentInfos:i,graphic:s,abilities:n}=this;if(!t)throw new g("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations.delete)throw new g("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!e||"function"!=typeof e.deleteAttachments)throw new g("invalid-layer","deleteAttachment(): A valid layer is required.");const r=e.deleteAttachments(s,[t.id]).then((()=>t)),o=await r;return i.remove(o),o}async updateAttachment(t,e=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:s,graphic:n,abilities:r}=this;if(!t)throw new g("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:t});if(!e)throw new g("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!r.operations.update)throw new g("invalid-abilities","updateAttachment(): Update abilities are required.");const o=s.findIndex((t=>t===e));if(!i||"function"!=typeof i.updateAttachment)throw new g("invalid-layer","updateAttachment(): A valid layer is required.");const a=i.updateAttachment(n,e.id,t).then((t=>this._queryAttachment(t.objectId))),l=await a;return s.splice(o,1,l),l}async _queryAttachment(t){if(!t)throw new g("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:e}=this,i=this._getFeatureId(),s=new ot({objectIds:[i],attachmentsWhere:`AttachmentId=${t}`,returnMetadata:!0});return e.queryAttachments(s).then((t=>t[i][0]))}_getFeatureId(){const{_attachmentLayer:t,graphic:e}=this;if(!t||!e)return null;const{objectIdField:i}=t,{attributes:s}=e;return s&&s[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>{})))}_setAttachmentLayer(){const{graphic:e}=this,i=he(e);this._attachmentLayer=i?"scene"===i.type&&t(i.associatedLayer)?i.associatedLayer:i:null}};s([n()],je.prototype,"abilities",void 0),s([m("abilities")],je.prototype,"castAbilities",null),s([n()],je.prototype,"activeAttachmentInfo",void 0),s([n({readOnly:!0,type:Le})],je.prototype,"attachmentInfos",void 0),s([n({type:nt})],je.prototype,"graphic",void 0),s([n()],je.prototype,"mode",void 0),s([n({readOnly:!0})],je.prototype,"state",null),s([n({readOnly:!0})],je.prototype,"supportsResizeAttachments",null),je=s([r("esri.widgets.Attachments.AttachmentsViewModel")],je);const ze=je,Ne={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},Re=window.CSS;let Ve=class extends _{constructor(t,e){super(t,e),this.abilities=null,this.displayType="auto",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new ze,this.visibleElements={...Ne},this._supportsImageOrientation=Re&&Re.supports&&Re.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own(M(this,"viewModel.attachmentInfos","change",(()=>this.scheduleRender())),v(this,"viewModel.mode",(()=>this._modeChanged())))}get effectiveDisplayType(){return"auto"===this.displayType?this.viewModel.supportsResizeAttachments?"preview":"list":this.displayType}castVisibleElements(t){return{...Ne,...t}}addAttachment(){const{_addAttachmentForm:t,viewModel:e}=this;return this._set("submitting",!0),this._set("error",null),e.addAttachment(t).then((t=>(this._set("submitting",!1),this._set("error",null),e.mode="view",t))).catch((t=>{throw this._set("submitting",!1),this._set("error",new g("attachments:add-attachment",this.messages.addErrorMessage,t)),t}))}deleteAttachment(t){const{viewModel:e}=this;return this._set("submitting",!0),this._set("error",null),e.deleteAttachment(t).then((t=>(this._set("submitting",!1),this._set("error",null),e.mode="view",t))).catch((t=>{throw this._set("submitting",!1),this._set("error",new g("attachments:delete-attachment",this.messages.deleteErrorMessage,t)),t}))}updateAttachment(){const{viewModel:t}=this,{_updateAttachmentForm:e}=this;return this._set("submitting",!0),this._set("error",null),t.updateAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((t=>{throw this._set("submitting",!1),this._set("error",new g("attachments:update-attachment",this.messages.updateErrorMessage,t)),t}))}render(){const{submitting:t,viewModel:e}=this,{state:i}=e;return I("div",{class:this.classes("esri-attachments","esri-widget")},t?this.renderProgressBar():null,"loading"===i?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:t,visibleElements:e}=this;return t&&e.errorMessage?I("div",{key:"error-message",class:"esri-attachments__error-message"},t.message):null}renderAttachments(){const{mode:t,activeAttachmentInfo:e}=this.viewModel;return"add"===t?this.renderAddForm():"edit"===t?this.renderDetailsForm(e):this.renderAttachmentContainer()}renderLoading(){return I("div",{class:"esri-attachments__loader-container",key:"loader"},I("div",{class:"esri-attachments__loader"}))}renderProgressBar(){return this.visibleElements.progressBar?I("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null}renderAddForm(){const{submitting:t,selectedFile:e}=this,i=t||!e,s=this.visibleElements.cancelAddButton?I("button",{type:"button",bind:this,disabled:t,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",t&&"esri-button--disabled")},this.messages.cancel):null,n=this.visibleElements.addSubmitButton?I("button",{type:"submit",disabled:i,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",{"esri-button--disabled":i})},this.messages.add):null,r=e?I("span",{key:"file-name",class:"esri-attachments__file-name"},e.name):null,o=I("form",{bind:this,afterCreate:A,afterRemoved:F,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},I("fieldset",{class:"esri-attachments__file-fieldset"},r,I("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},e?this.messages.changeFile:this.messages.selectFile,I("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),n,s);return I("div",{key:"add-form-container",class:"esri-attachments__form-node"},o)}renderDetailsForm(t){const{visibleElements:e,viewModel:i,selectedFile:s,submitting:n}=this,{contentType:r,size:o,url:a}=t,{abilities:l}=i,h=n||!s,d=l.editing&&l.operations.delete&&e.deleteButton?I("button",{key:"delete-button",type:"button",disabled:n,bind:this,onclick:e=>this._submitDeleteAttachment(e,t),class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-attachments__delete-button",{"esri-button--disabled":n})},this.messages.delete):null,p=l.editing&&l.operations.update&&e.updateButton?I("button",{disabled:h,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",{"esri-button--disabled":h})},this.messages.update):null,f=this.visibleElements.cancelUpdateButton?I("button",{disabled:n,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-button--third",{"esri-button--disabled":n})},this.messages.cancel):null,m=s?I("span",{key:"file-name",class:"esri-attachments__file-name"},s.name):null,v=l.editing&&l.operations.update?I("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},m,I("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,I("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,g=I("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},I("label",null,function(t,e){let i=0===e?0:Math.floor(Math.log(e)/Math.log(1024));i=Z(i,0,Jt.length-1);const s=c(e/1024**i,{maximumFractionDigits:2});return u(t.units.bytes[Jt[i]],{fileSize:s})}(this.messagesUnits,o))),b=I("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},I("label",null,r)),w=I("form",{bind:this,afterCreate:A,afterRemoved:F,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},I("div",{class:"esri-attachments__metadata"},g,b),v,I("div",{class:"esri-attachments__actions"},d,f,p));return I("div",{key:"edit-form-container",class:"esri-attachments__form-node"},I("a",{class:"esri-attachments__item-link",href:a,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:t,size:400}),I("div",{class:"esri-attachments__item-link-overlay"},I("span",{class:"esri-attachments__item-link-overlay-icon"},I("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},I("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),I("path",{fill:"none",d:"M0 0h32v32H0z"}))))),w)}renderImageMask({attachmentInfo:t,size:e}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:s,name:n,url:r}=t,o=i&&function(t){const e=t.toLowerCase();return"image/bmp"===e||"image/emf"===e||"image/exif"===e||"image/gif"===e||"image/x-icon"===e||"image/jpeg"===e||"image/png"===e||"image/tiff"===e||"image/x-wmf"===e}(s),a=this._getCSSTransform(t,o),l=a?{transform:a,"image-orientation":"none"}:{},u=-1===r.indexOf("?")?"?":"&",c=o?`${r}${u}w=${e}`:function(t){const e=b("esri/themes/base/images/files/");return t?"text/plain"===t?`${e}text-32.svg`:"application/pdf"===t?`${e}pdf-32.svg`:"text/csv"===t?`${e}csv-32.svg`:"application/gpx+xml"===t?`${e}gpx-32.svg`:"application/x-dwf"===t?`${e}cad-32.svg`:"application/postscript"===t||"application/json"===t||"text/xml"===t||"model/vrml"===t?`${e}code-32.svg`:"application/x-zip-compressed"===t||"application/x-7z-compressed"===t||"application/x-gzip"===t||"application/x-tar"===t||"application/x-gtar"===t||"application/x-bzip2"===t||"application/gzip"===t||"application/x-compress"===t||"application/x-apple-diskimage"===t||"application/x-rar-compressed"===t||"application/zip"===t?`${e}zip-32.svg`:-1!==t.indexOf("image/")?`${e}image-32.svg`:-1!==t.indexOf("audio/")?`${e}sound-32.svg`:-1!==t.indexOf("video/")?`${e}video-32.svg`:-1!==t.indexOf("msexcel")||-1!==t.indexOf("ms-excel")||-1!==t.indexOf("spreadsheetml")?`${e}excel-32.svg`:-1!==t.indexOf("msword")||-1!==t.indexOf("ms-word")||-1!==t.indexOf("wordprocessingml")?`${e}word-32.svg`:-1!==t.indexOf("powerpoint")||-1!==t.indexOf("presentationml")?`${e}report-32.svg`:`${e}generic-32.svg`:`${e}generic-32.svg`}(s),h={"esri-attachments__image--resizable":i};return I("div",{class:this.classes({"esri-attachments__item-mask--icon":!o},"esri-attachments__item-mask")},I("img",{styles:l,alt:n,src:c,class:this.classes(h,"esri-attachments__image")}))}renderAttachmentInfo({attachmentInfo:t,displayType:e}){const{viewModel:i}=this,{abilities:s}=i,{name:n,url:r}=t,o=this.renderImageMask({attachmentInfo:t,size:"list"===e?48:400}),a=s.editing?I("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",k(this.container)?"esri-icon-left":"esri-icon-right")}):null,l=[o,I("label",{class:"esri-attachments__label"},I("span",{class:"esri-attachments__filename"},n||this.messages.noTitle),a)],u=s.editing?I("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":t.id,onclick:()=>this._startEditAttachment(t),type:"button"},l):I("a",{key:"details-link",class:"esri-attachments__item-button",href:r,target:"_blank"},l);return I("li",{class:"esri-attachments__item",key:t},u)}renderAttachmentContainer(){const{effectiveDisplayType:t,viewModel:e,visibleElements:i}=this,{attachmentInfos:s,abilities:n}=e,r=s&&s.length,o={"esri-attachments__container--list":"preview"!==t,"esri-attachments__container--preview":"preview"===t},a=n.editing&&n.operations.add&&i.addButton?I("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes("esri-button","esri-button--tertiary","esri-attachments__add-attachment-button"),type:"button"},I("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null,l=r?I("ul",{class:"esri-attachments__items"},s.toArray().map((e=>this.renderAttachmentInfo({attachmentInfo:e,displayType:t})))):I("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return I("div",{key:"attachments-container",class:this.classes("esri-attachments__container",o)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(t){const e=t.target,i=e&&e.files&&e.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(t,e){t.preventDefault(),this.deleteAttachment(e)}_submitAddAttachment(t){t.preventDefault(),this.addAttachment()}_submitUpdateAttachment(t){t.preventDefault(),this.updateAttachment()}_startEditAttachment(t){const{viewModel:e}=this;e.activeAttachmentInfo=t,e.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(t){t.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(t,e){const{orientationInfo:i}=t;return!this._supportsImageOrientation&&e&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};s([w("viewModel.abilities")],Ve.prototype,"abilities",void 0),s([n()],Ve.prototype,"displayType",void 0),s([n({readOnly:!0})],Ve.prototype,"effectiveDisplayType",null),s([w("viewModel.graphic")],Ve.prototype,"graphic",void 0),s([n({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ve.prototype,"label",void 0),s([n(),y("esri/widgets/Attachments/t9n/Attachments")],Ve.prototype,"messages",void 0),s([n(),y("esri/core/t9n/Units")],Ve.prototype,"messagesUnits",void 0),s([n({readOnly:!0})],Ve.prototype,"selectedFile",void 0),s([n({readOnly:!0})],Ve.prototype,"submitting",void 0),s([n({readOnly:!0})],Ve.prototype,"error",void 0),s([n({type:ze})],Ve.prototype,"viewModel",void 0),s([n()],Ve.prototype,"visibleElements",void 0),s([m("visibleElements")],Ve.prototype,"castVisibleElements",null),Ve=s([r("esri.widgets.Attachments")],Ve);const Se=Ve;let De=class extends ze{constructor(t){super(t),this.description=null,this.title=null}};s([n()],De.prototype,"description",void 0),s([n()],De.prototype,"title",void 0),De=s([r("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],De);const Ue=De;let Be=class extends _{constructor(t,e){super(t,e),this.description=null,this.headingLevel=2,this.title=null}render(){return I("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:t}=this;return t?I(wt,{level:this.headingLevel,class:"esri-feature-element-info__title"},t):null}renderDescription(){const{description:t}=this;return t?I("div",{key:"description",class:"esri-feature-element-info__description"},t):null}};s([n()],Be.prototype,"description",void 0),s([n()],Be.prototype,"headingLevel",void 0),s([n()],Be.prototype,"title",void 0),Be=s([r("esri.widgets.Feature.support.FeatureElementInfo")],Be);const He=Be;let qe=class extends _{constructor(t,e){super(t,e),this._featureElementInfo=null,this.attachmentsWidget=new Se,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new Ue}initialize(){this._featureElementInfo=new He,v(this,["viewModel.description","viewModel.title","headingLevel"],(()=>this._setupFeatureElementInfo())),v(this,"viewModel.graphic",(t=>this.attachmentsWidget.graphic=t))}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var t;const{attachmentsWidget:e}=this;return I("div",{class:"esri-feature-attachments"},null==(t=this._featureElementInfo)?void 0:t.render(),null==e?void 0:e.render())}_setupFeatureElementInfo(){const{description:t,title:e,headingLevel:i}=this;this._featureElementInfo.set({description:t,title:e,headingLevel:i})}};s([n({readOnly:!0})],qe.prototype,"attachmentsWidget",void 0),s([w("viewModel.description")],qe.prototype,"description",void 0),s([w("attachmentsWidget.displayType")],qe.prototype,"displayType",void 0),s([w("viewModel.graphic")],qe.prototype,"graphic",void 0),s([n()],qe.prototype,"headingLevel",void 0),s([w("viewModel.title")],qe.prototype,"title",void 0),s([n({type:Ue})],qe.prototype,"viewModel",void 0),qe=s([r("esri.widgets.Feature.FeatureAttachments")],qe);const We=qe;let Ge=class extends(Y(o)){constructor(t){super(t),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(v(this,"creator",(t=>{this._destroyContent(),this._createContent(t)})))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:t,graphic:e,destroyer:i}=this;t&&(de(i,{graphic:e}).catch((()=>null)),this._set("created",null))}async _createContent(t){const{graphic:e}=this,i=de(t,{graphic:e}).catch((()=>null));this._loadingPromise=i,this.notifyChange("state");const s=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",s))}};s([n({readOnly:!0})],Ge.prototype,"created",void 0),s([n()],Ge.prototype,"creator",void 0),s([n()],Ge.prototype,"destroyer",void 0),s([n({type:nt})],Ge.prototype,"graphic",void 0),s([n({readOnly:!0})],Ge.prototype,"state",null),Ge=s([r("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Ge);const Ke=Ge;let Qe=class extends _{constructor(t,e){super(t,e),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=t=>{Array.from(t.querySelectorAll("a")).forEach((t=>{pe(t.href)&&!t.hasAttribute("target")&&t.setAttribute("target","_blank")}))}}renderLoading(){return I("div",{class:"esri-feature-content__loader-container",key:"loader"},I("div",{class:"esri-feature-content__loader"}))}renderCreated(){var t;const e=null==(t=this.viewModel)?void 0:t.created;return e?e instanceof HTMLElement?I("div",{key:e,bind:e,afterCreate:this._attachToNode}):yt(e)?I("div",{key:e},!e.destroyed&&e.render()):I("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var t;const e=null==(t=this.viewModel)?void 0:t.state;return I("div",{class:"esri-feature-content"},"loading"===e?this.renderLoading():this.renderCreated())}_attachToNode(t){t.appendChild(this)}};s([w("viewModel.creator")],Qe.prototype,"creator",void 0),s([w("viewModel.graphic")],Qe.prototype,"graphic",void 0),s([n({type:Ke})],Qe.prototype,"viewModel",void 0),Qe=s([r("esri.widgets.Feature.FeatureContent")],Qe);const Xe=Qe;let Ye=class extends o{constructor(t){super(t),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:t,fieldInfos:e}=this,i=[];return null==e||e.forEach((e=>{if(e.hasOwnProperty("visible")&&!e.visible)return;const s=e.clone();s.label=me(s,t),i.push(s)})),i}};s([n()],Ye.prototype,"attributes",void 0),s([n({type:[dt]})],Ye.prototype,"expressionInfos",void 0),s([n()],Ye.prototype,"description",void 0),s([n({type:[pt]})],Ye.prototype,"fieldInfos",void 0),s([n({readOnly:!0})],Ye.prototype,"formattedFieldInfos",null),s([n()],Ye.prototype,"title",void 0),Ye=s([r("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Ye);const Ze=Ye,Je=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];let ti=class extends _{constructor(t,e){super(t,e),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new Ze,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new He,v(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo()))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(t,e){const{attributes:i}=this.viewModel,s=t.fieldName,n=t.label||s,r=i?null==i[s]?"":i[s]:"",o=!(!t.format||!t.format.dateFormat),a="number"!=typeof r||o?function(t,e){if("string"!=typeof e||!e)return e;const i=function(t){let e=null;return Je.some((i=>(i.pattern.test(t)&&(e=i),!!e))),e}(e);if(!i)return e;const s=e.match(i.pattern),n=u(u(i.label,{messages:t,hierPart:s&&s[2]}),{appName:i.appName});return e.replace(i.pattern,`<a${i.target?` target="${i.target}"`:""} href="$1"${"_blank"===i.target?' rel="noreferrer"':""}>${n}</a>`)}(this.messagesURIUtils,r):this._forceLTR(r),l={"esri-feature-fields__field-data--date":o};return I("tr",{key:`fields-element-info-row-${s}-${e}`},I("th",{key:`fields-element-info-row-header-${s}-${e}`,class:"esri-feature-fields__field-header",innerHTML:n}),I("td",{key:`fields-element-info-row-data-${s}-${e}`,class:this.classes("esri-feature-fields__field-data",l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:t}=this.viewModel;return null!=t&&t.length?I("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},I("tbody",null,t.map(((t,e)=>this.renderFieldInfo(t,e))))):null}render(){var t;return I("div",{class:"esri-feature-fields"},null==(t=this._featureElementInfo)?void 0:t.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:t,title:e}=this;this._featureElementInfo.set({description:t,title:e})}_forceLTR(t){return`&lrm;${t}`}};s([w("viewModel.attributes")],ti.prototype,"attributes",void 0),s([w("viewModel.description")],ti.prototype,"description",void 0),s([w("viewModel.expressionInfos")],ti.prototype,"expressionInfos",void 0),s([w("viewModel.fieldInfos")],ti.prototype,"fieldInfos",void 0),s([w("viewModel.title")],ti.prototype,"title",void 0),s([n({type:Ze})],ti.prototype,"viewModel",void 0),s([n(),y("esri/widgets/Feature/t9n/Feature")],ti.prototype,"messages",void 0),s([n(),y("esri/widgets/support/t9n/uriUtils")],ti.prototype,"messagesURIUtils",void 0),ti=s([r("esri.widgets.Feature.FeatureFields")],ti);const ei=ti,ii=h.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),si=new Map;function ni(t){if(!Te(t))return null;const[e,i]=t.split("/").slice(1);return{layerId:e,fieldName:i}}let ri=class extends o{constructor(t){super(t),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(t){this._setContentElementMedia(t)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(t){const{formattedMediaInfoCount:e}=this;this.activeMediaInfoIndex=(t+e)%e}_pageContentElementMedia(t){const{activeMediaInfoIndex:e}=this;this._setContentElementMedia(e+t)}_formatMediaInfos(){const{attributes:t,mediaInfos:e,formattedAttributes:i,expressionAttributes:s,fieldInfoMap:n,layer:r}=this;return null==e?void 0:e.map((e=>{if(!e)return null;if(e.title=we({attributes:t,fieldInfoMap:n,globalAttributes:i,expressionAttributes:s,layer:r,text:e.title}),e.caption=we({attributes:t,fieldInfoMap:n,globalAttributes:i,expressionAttributes:s,layer:r,text:e.caption}),e.altText=we({attributes:t,fieldInfoMap:n,globalAttributes:i,expressionAttributes:s,layer:r,text:e.altText}),"image"===e.type){const{value:t}=e;return this._setImageValue({value:t,formattedAttributes:i,layer:r}),e.value.sourceURL?e:void 0}if("pie-chart"===e.type||"line-chart"===e.type||"column-chart"===e.type||"bar-chart"===e.type){const{value:s}=e;return this._setChartValue({value:s,chartType:e.type,attributes:t,formattedAttributes:i,layer:r}),e}return null})).filter(Boolean)}_setImageValue(t){const{fieldInfoMap:e}=this,{value:i,formattedAttributes:s,layer:n}=t,{linkURL:r,sourceURL:o}=i;if(o){const t=_e(o,n);i.sourceURL=ye({formattedAttributes:s,template:t,fieldInfoMap:e})}if(r){const t=_e(r,n);i.linkURL=ye({formattedAttributes:s,template:t,fieldInfoMap:e})}}_setChartValue(t){const{value:e,attributes:i,formattedAttributes:s,chartType:n,layer:r}=t,{popupTemplate:o,relatedInfos:a}=this,{fields:l,normalizeField:u}=e;if(e.fields=function(t,e){return t&&t.map((t=>ve(t,e)))}(l,r),u&&(e.normalizeField=ve(u,r)),!l.some((t=>!!(null!=s[t]||Te(t)&&a.size))))return;const c=null==o?void 0:o.fieldInfos;l.forEach((t=>{if(Te(t))return void(e.series=[...e.series,...this._getRelatedChartInfos({fieldInfos:c,fieldName:t,formattedAttributes:s,chartType:n,value:e})]);const r=this._getChartOption({value:e,attributes:i,chartType:n,formattedAttributes:s,fieldName:t,fieldInfos:c});e.series.push(r)}))}_getRelatedChartInfos(t){var e;const{fieldInfos:i,fieldName:s,formattedAttributes:n,chartType:r,value:o}=t,a=[],l=ni(s),{layerId:u,fieldName:c}=l,h=null==(e=this.relatedInfos)?void 0:e.get(u.toString());if(!h)return a;const{relatedFeatures:d,relation:p}=h;if(!p||!d)return a;const{cardinality:f}=p;return d.forEach((t=>{const{attributes:e}=t;e&&Object.keys(e).forEach((t=>{t===c&&a.push(this._getChartOption({value:o,attributes:e,formattedAttributes:n,fieldName:s,chartType:r,relatedFieldName:t,fieldInfos:i}))}))})),"one-to-many"===f||"many-to-many"===f?a:[a[0]]}_getTooltip({label:t,value:e,chartType:i}){return"pie-chart"===i?t:`${t}: ${e}`}_getChartOption(t){var e;const{value:i,attributes:s,formattedAttributes:n,fieldName:r,relatedFieldName:o,fieldInfos:a,chartType:l}=t,{layer:u}=this,{normalizeField:c,tooltipField:h}=i,d=c?Te(c)?s[ni(c).fieldName]:s[c]:null,p=o&&void 0!==s[o]?s[o]:void 0!==s[r]?s[r]:n[r],f=void 0===p?null:p&&d?p/d:p,m=new ft({value:f});if(Te(r)){const t=ni(r),e=ni(h),i=e?e.fieldName:null,n=Ie(f,{fieldInfos:a,fieldName:o,layer:u,preventPlacesFormatting:!!d}),c=t?t.label||t.fieldName:o;return m.tooltip=this._getTooltip({label:i&&void 0!==s[i]?s[i]:c,value:n,chartType:l}),m}const v=Ae(a,r),g=ve(r,u),b=h&&void 0!==n[h]?n[h]:me(v||new pt({fieldName:g}),null==(e=this.popupTemplate)?void 0:e.expressionInfos);return m.tooltip=this._getTooltip({label:b,value:n[g],chartType:l}),m}};s([n()],ri.prototype,"activeMediaInfoIndex",void 0),s([n({readOnly:!0})],ri.prototype,"activeMediaInfo",null),s([n()],ri.prototype,"attributes",void 0),s([n()],ri.prototype,"description",void 0),s([n()],ri.prototype,"fieldInfoMap",void 0),s([n()],ri.prototype,"formattedAttributes",void 0),s([n()],ri.prototype,"expressionAttributes",void 0),s([n({readOnly:!0})],ri.prototype,"formattedMediaInfos",null),s([n()],ri.prototype,"layer",void 0),s([n({readOnly:!0})],ri.prototype,"formattedMediaInfoCount",null),s([n()],ri.prototype,"mediaInfos",void 0),s([n()],ri.prototype,"popupTemplate",void 0),s([n()],ri.prototype,"relatedInfos",void 0),s([n()],ri.prototype,"title",void 0),ri=s([r("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],ri);const oi=ri;var ai=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],li=[{name:"default",colors:[].concat(ai.slice(30,39),ai.slice(28,30).reverse())},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const ui=new Map([["ar",()=>import("./p-d24e109e.js").then((t=>t.a))],["bs-ba",()=>import("./p-165f141e.js").then((t=>t.b))],["ca-es",()=>import("./p-36445a12.js").then((t=>t.c))],["cs-cz",()=>import("./p-b138a877.js").then((t=>t.c))],["da-dk",()=>import("./p-28b53674.js").then((t=>t.d))],["de-de",()=>import("./p-295fbc0e.js").then((t=>t.d))],["de-ch",()=>import("./p-a872b03a.js").then((t=>t.d))],["el-gr",()=>import("./p-1ec951ac.js").then((t=>t.e))],["en-us",()=>import("./p-0f564f5d.js").then((t=>t.e))],["en-ca",()=>import("./p-1e21fbd5.js").then((t=>t.e))],["es-es",()=>import("./p-01fac15a.js").then((t=>t.e))],["et-ee",()=>import("./p-27e13221.js").then((t=>t.e))],["fi-fi",()=>import("./p-16a12fde.js").then((t=>t.f))],["fr-fr",()=>import("./p-f03e863b.js").then((t=>t.f))],["he-il",()=>import("./p-1ceae54f.js").then((t=>t.h))],["hr-hr",()=>import("./p-1fc325c7.js").then((t=>t.h))],["hu-hu",()=>import("./p-47772cf1.js").then((t=>t.h))],["id-id",()=>import("./p-c7fb14dd.js").then((t=>t.i))],["it-it",()=>import("./p-0019b2e1.js").then((t=>t.i))],["ja-jp",()=>import("./p-b44094da.js").then((t=>t.j))],["ko-kr",()=>import("./p-6cbe357e.js").then((t=>t.k))],["lt-lt",()=>import("./p-466f16d6.js").then((t=>t.l))],["lv-lv",()=>import("./p-411892f7.js").then((t=>t.l))],["nb-no",()=>import("./p-9531c1b9.js").then((t=>t.n))],["nl-nl",()=>import("./p-c58e407e.js").then((t=>t.n))],["pl-pl",()=>import("./p-5b2248a8.js").then((t=>t.p))],["pt-br",()=>import("./p-009f491a.js").then((t=>t.p))],["pt-pt",()=>import("./p-dcf3890e.js").then((t=>t.p))],["ro-ro",()=>import("./p-bcd2c290.js").then((t=>t.r))],["ru-ru",()=>import("./p-8943a0da.js").then((t=>t.r))],["sk-sk",()=>import("./p-e82931a9.js").then((t=>t.s))],["sl-sl",()=>import("./p-1c2ca123.js").then((t=>t.s))],["sr-rs",()=>import("./p-a9f696ad.js").then((t=>t.s))],["sv-se",()=>import("./p-4ca6902f.js").then((t=>t.s))],["th-th",()=>import("./p-2055e35f.js").then((t=>t.t))],["tr-tr",()=>import("./p-c0b0c346.js").then((t=>t.t))],["uk-ua",()=>import("./p-a7184375.js").then((t=>t.u))],["vi-vn",()=>import("./p-f06c242c.js").then((t=>t.v))],["zh-cn",()=>import("./p-3f123fdb.js").then((t=>t.z))],["zh-hk",()=>import("./p-5cd40670.js").then((t=>t.z))],["zh-tw",()=>import("./p-5cd40670.js").then((t=>t.z))]]);let ci,hi;const di="esri-feature-media__icon",pi=.95;let fi=class extends _{constructor(t,e){super(t,e),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new oi,this.messages=null}initialize(){this._featureElementInfo=new He,this.own(v(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],(()=>this._setupMediaRefreshTimer())),v(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo())))}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var t;return I("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},null==(t=this._featureElementInfo)?void 0:t.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:t}=this.viewModel;return t?I("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(t){const{_refreshIntervalInfo:e}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:s}=this.viewModel,{value:n,refreshInterval:r,altText:o,title:a,type:l}=t,{sourceURL:u,linkURL:c}=n,h=pe(c)?"_blank":"_self",d="_blank"===h?"noreferrer":"",p=r?e:null,f=I("img",{alt:o||a,key:`media-${l}-${i}-${s}-${p?p.timestamp:0}`,src:p?p.sourceURL:u});return(c?I("a",{title:a,href:c,rel:d,target:h},f):null)||f}renderChartMediaInfo(t){const{activeMediaInfoIndex:e,formattedMediaInfoCount:i}=this.viewModel;return I("div",{key:`media-${t.type}-${e}-${i}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:t}=this.viewModel;return t?"image"===t.type?this.renderImageMediaInfo(t):-1!==t.type.indexOf("chart")?this.renderChartMediaInfo(t):null:null}renderMediaInfo(){const{activeMediaInfo:t}=this.viewModel;if(!t)return null;const e=t.title?I("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:t.title}):null,i=t.caption?I("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:t.caption}):null;return I("div",{key:"media-container",class:"esri-feature-media__item-container"},I("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),e,i)}renderMediaPageButton(t){if(this.viewModel.formattedMediaInfoCount<2)return null;const e="previous"===t,i=e?this.messages.previous:this.messages.next,s=this.classes("esri-feature-media__button",e?"esri-feature-media__previous":"esri-feature-media__next"),n=e?this.classes(di,"esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):this.classes(di,"esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),r=e?this.classes(di,"esri-feature-media__previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes(di,"esri-feature-media__next-icon--rtl","esri-icon-left-triangle-arrow");return I("button",{type:"button",key:e?"media-previous":"media-next",title:i,"aria-label":i,tabIndex:0,class:s,bind:this,onclick:e?this._previous:this._next},I("span",{"aria-hidden":"true",class:n}),I("span",{"aria-hidden":"true",class:r}))}_setupFeatureElementInfo(){const{description:t,title:e}=this;this._featureElementInfo.set({description:t,title:e})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getChartDependencies(t){const e=await async function(t=T()){if(t=function(t){return t?ui.has(t.toLowerCase())?t.toLowerCase():function(t){const e=t.split("-")[0].toLowerCase();let i=null;for(const t of ui.keys())if(t.startsWith(e)){i=t;break}return i}(t)||"en-us":"en-us"}(t),ci&&t===hi)return ci;ci=import("./p-8574655c.js").then((t=>t.i)),hi=t;try{const[e,i]=await Promise.all([ci,ui.get(hi)()]);hi===t&&(e.am4core.options.defaultLocale=i.default),e.am4core.options.suppressWarnings=!0,e.am4core.options.autoDispose=!0}catch{return ci=null,hi=null,null}return ci}(),{activeMediaInfo:i}=this.viewModel;this._renderChart({chartDiv:t,mediaInfo:i,chartsModule:e})}_handleMediaKeyup(t){const e=P(t);"ArrowLeft"===e&&(t.stopPropagation(),this.viewModel.previous()),"ArrowRight"===e&&(t.stopPropagation(),this.viewModel.next())}_renderChart(t){const{chartsModule:e,chartDiv:i,mediaInfo:s}=t,{value:n,type:r}=s,{am4core:o}=e,a=function(t,e="default"){const i=li.find((t=>t.name===e));return i?i.colors.map((e=>t.color(e))):null}(o);E()&&o.useTheme(e.am4themes_dark),o.useTheme(e.am4themes_animated),o.useTheme((function(t){t instanceof o.ColorSet&&a&&(t.list=a)}));const l="pie-chart"===r?this._createPieChart(t):this._createXYChart(t);i.setAttribute("aria-label",s.altText||s.title),l.data=n.series.map((t=>({tooltip:t.tooltip,value:t.value}))).filter((t=>"pie-chart"!==r||t.value>0))}_customizeChartTooltip(t,e){t.label.wrap=!0,t.label.maxWidth=200,t.autoTextColor=!1,t.getFillFromObject=!1,t.label.fill=e.color("#ffffff"),t.background.fill=e.color({r:0,g:0,b:0,a:.7})}_createPieChart(t){const{chartDiv:e,chartsModule:i}=t,{am4core:s,am4charts:n}=i,r=s.create(e,n.PieChart);r.rtl=k(this.container);const o=r.series.push(new n.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value="value",o.dataFields.category="tooltip",this._customizeChartTooltip(o.tooltip,s),r}_getMinSeriesValue(t){let e=0;return t.forEach((t=>e=Math.min(t.value,e))),e}_createColumnChart(t,e){const{chartsModule:i,mediaInfo:s}=e,{value:n}=s,{am4core:r,am4charts:o}=i,a=t.xAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,r),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dy=-a.tooltip.contentHeight}));const l=t.yAxes.push(new o.ValueAxis),u=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=pi,l.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(l.tooltip,r),u.wrap=!0;const c=t.series.push(new o.ColumnSeries);c.dataFields.valueY="value",c.dataFields.categoryX="tooltip",t.cursor=new o.XYCursor,n.series.length>15&&(t.scrollbarX=new r.Scrollbar)}_createBarChart(t,e){const{chartsModule:i,mediaInfo:s}=e,{value:n}=s,{am4core:r,am4charts:o}=i,a=t.yAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,r),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dx=a.tooltip.contentWidth}));const l=t.xAxes.push(new o.ValueAxis),u=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=pi,l.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(l.tooltip,r),u.wrap=!0;const c=t.series.push(new o.ColumnSeries);c.dataFields.valueX="value",c.dataFields.categoryY="tooltip",t.cursor=new o.XYCursor,n.series.length>15&&(t.scrollbarY=new r.Scrollbar)}_createLineChart(t,e){const{chartsModule:i,mediaInfo:s}=e,{value:n}=s,{am4core:r,am4charts:o}=i,a=t.xAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,r),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dy=-a.tooltip.contentHeight}));const l=t.yAxes.push(new o.ValueAxis),u=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=pi,l.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(l.tooltip,r),u.wrap=!0;const c=t.series.push(new o.LineSeries);c.dataFields.categoryX="tooltip",c.dataFields.valueY="value",t.cursor=new o.XYCursor,n.series.length>15&&(t.scrollbarX=new r.Scrollbar)}_createXYChart(t){const{chartDiv:e,chartsModule:i,mediaInfo:s}=t,{type:n}=s,{am4core:r,am4charts:o}=i,a=r.create(e,o.XYChart);return a.rtl=k(this.container),"column-chart"===n&&this._createColumnChart(a,t),"bar-chart"===n&&this._createBarChart(a,t),"line-chart"===n&&this._createLineChart(a,t),a}_clearMediaRefreshTimer(){const{_refreshTimer:t}=this;t&&(clearTimeout(t),this._refreshTimer=null)}_updateMediaInfoTimestamp(t){const e=Date.now();this._refreshIntervalInfo={timestamp:e,sourceURL:this._getImageSource(t,e)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:t}=this.viewModel;t&&"image"===t.type&&t.refreshInterval&&this._setRefreshTimeout(t)}_setRefreshTimeout(t){const{refreshInterval:e,value:i}=t;if(!e)return;const s=6e4*e;this._updateMediaInfoTimestamp(i.sourceURL);const n=setInterval((()=>{this._updateMediaInfoTimestamp(i.sourceURL)}),s);this._refreshTimer=n}_getImageSource(t,e){const i=-1!==t.indexOf("?")?"&":"?",[s,n=""]=t.split("#");return`${s}${i}timestamp=${e}${n?"#":""}${n}`}};s([w("viewModel.attributes")],fi.prototype,"attributes",void 0),s([w("viewModel.activeMediaInfoIndex")],fi.prototype,"activeMediaInfoIndex",void 0),s([w("viewModel.description")],fi.prototype,"description",void 0),s([w("viewModel.fieldInfoMap")],fi.prototype,"fieldInfoMap",void 0),s([w("viewModel.layer")],fi.prototype,"layer",void 0),s([w("viewModel.mediaInfos")],fi.prototype,"mediaInfos",void 0),s([w("viewModel.popupTemplate")],fi.prototype,"popupTemplate",void 0),s([w("viewModel.relatedInfos")],fi.prototype,"relatedInfos",void 0),s([w("viewModel.title")],fi.prototype,"title",void 0),s([n({type:oi})],fi.prototype,"viewModel",void 0),s([n(),y("esri/widgets/Feature/t9n/Feature")],fi.prototype,"messages",void 0),fi=s([r("esri.widgets.Feature.FeatureMedia")],fi);const mi=fi,vi=["$datastore","$map","$layer","$aggregatedfeatures"],gi=h.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");async function bi({graphic:t,view:e}){const{isAggregate:i,layer:s}=t;if(!i||!s||"2d"!==(null==e?void 0:e.type))return[];const n=await e.whenLayerView(s);if(!n.createQuery||!n.queryFeatures)return[];const r=n.createQuery();r.aggregateIds=[t.getObjectId()];const{features:o}=await n.queryFeatures(r);return o}async function wi({expressionAttributes:t,info:e,arcadeUtils:i,interceptor:s,spatialReference:n,map:r,graphic:o,view:a}){const l=`expression/${e.name}`,u=i.createSyntaxTree(e.expression),c=vi.filter((t=>i.hasVariable(u,t))),[h]=await $([bi({graphic:o,view:a}),i.loadScriptDependencies(u,!0,c)]),d=i.getViewInfo({spatialReference:n}),p=i.createExecContext(o,d);p.interceptor=s,p.useAsync=!0,function({aggregatedFeatures:t,arcadeUtils:e,featureSetVars:i,context:s,viewInfo:n,map:r,graphic:o,interceptor:a}){i.forEach((i=>{const l=i.toLowerCase();if("$map"===l&&(s.vars[l]=e.convertMapToFeatureSetCollection({map:r,spatialReference:n.sr,interceptor:a})),"$layer"===l&&(s.vars[l]=e.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:n.sr,interceptor:a})),"$datastore"===l&&(s.vars[l]=e.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:n.sr,interceptor:a})),"$aggregatedfeatures"===l){const i=o.layer,{fields:r,objectIdField:u,geometryType:c,spatialReference:h,displayField:d}=i,p=new Ft({fields:r,objectIdField:u,geometryType:c,spatialReference:h,displayField:d,..."feature"===i.type?{templates:i.templates,typeIdField:i.typeIdField,types:i.types}:null,source:t});s.vars[l]=e.convertFeatureLayerToFeatureSet({layer:p,spatialReference:n.sr,interceptor:a})}}))}({aggregatedFeatures:h,arcadeUtils:i,featureSetVars:c,context:p,viewInfo:d,map:r,graphic:o,interceptor:s});const f=i.createFunction(u,p),m=await i.executeAsyncFunction(f,p).catch((t=>gi.error("arcade-execution-error",{error:t,graphic:o,expressionInfo:e})));t[l]="string"==typeof m?xe(ke(m)):Array.isArray(m)?function(t){return`<ul class="esri-widget__list">${t.map((t=>`<li>${"string"==typeof t?xe(ke(t)):t}</li>`)).join("")}</ul>`}(m):m&&"esri.arcade.Dictionary"===m.declaredClass?function(t){return`<table class="esri-widget__table">${t.keys().map((e=>{const i=t.field(e);return`<tr><th>${e}</th><td>${"string"==typeof i?xe(ke(i)):i}</td></tr>`})).join("")}</table>`}(m):m}async function yi({popupTemplate:t,spatialReference:e,graphic:i,interceptor:s,map:n,view:r}){const o=t.expressionInfos,a=[],l={};if(!o||!o.length)return l;const u=await import("./p-1ce5adcc.js").then((function(t){return t.ar}));for(const t of o)a.push(wi({expressionAttributes:l,info:t,arcadeUtils:u,interceptor:s,spatialReference:e,map:n,graphic:i,view:r}));return await C(a),l}var _i;const Mi="esri.widgets.FeatureViewModel",Ii=h.getLogger(Mi),Ai={attachmentsContent:!0,customContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};let Fi=_i=class extends o{constructor(t){super(t),this._handles=new O,this._error=null,this._featureAbortController=null,this.graphicChangedThrottled=Wt(this.graphicChanged,1,this),this._expressionAttributes=null,this.abilities={...Ai},this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:e}=this;return"attachments"===t.type&&e.attachmentsContent||"custom"===t.type&&e.customContent||"fields"===t.type&&e.fieldsContent||"media"===t.type&&e.mediaContent||"text"===t.type&&e.textContent},this._handles.add(v(this,["graphic","_effectivePopupTemplate","abilities"],(()=>this.graphicChangedThrottled())))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return t(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function(t,e){const i=new Map;return t&&t.forEach((t=>{const s=ve(t.fieldName,e);t.fieldName=s,i.set(s.toLowerCase(),t)})),i}(Fe(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return he(this.graphic)}castAbilities(t){return{...Ai,...t}}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(t){this._set("graphic",t?t.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(t){void 0!==t?this._override("spatialReference",t):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(t){void 0!==t?this._override("map",t):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(t,e){const i=this.contentViewModels[t];i instanceof oi&&i.setActiveMedia(e)}nextMedia(t){const e=this.contentViewModels[t];e instanceof oi&&e.next()}previousMedia(t){const e=this.contentViewModels[t];e instanceof oi&&e.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:t}=this;if(!t)return;const e=new AbortController;this._featureAbortController=e;try{await this._queryFeature({signal:e.signal})}catch(e){L(e)||(this._error=e,Ii.error("error","The popupTemplate could not be displayed for this feature.",{error:e,graphic:t,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===e&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:t}=this;t&&t.abort(),this._featureAbortController=null}_compileContent(t){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(t)?t.filter(this._isAllowedContentType).map(((t,e)=>"attachments"===t.type?this._compileAttachments(t,e):"custom"===t.type?this._compileCustom(t,e):"fields"===t.type?this._compileFields(t,e):"media"===t.type?this._compileMedia(t,e):"text"===t.type?this._compileText(t,e):void 0)):"string"==typeof t?this._compileText(new mt({text:t}),0).text:t}_destroyContentViewModels(){this.contentViewModels.forEach((t=>t&&!t.destroyed&&t.destroy())),this._set("contentViewModels",[])}_compileAttachments(t,e){const{graphic:i}=this,{description:s,title:n}=t;return this.contentViewModels[e]=new Ue({graphic:i,...this._compileTitleAndDesc({title:n,description:s})}),t}_compileCustom(t,e){const{graphic:i}=this,{creator:s,destroyer:n}=t;return this.contentViewModels[e]=new Ke({graphic:i,creator:s,destroyer:n}),t}_compileTitleAndDesc({title:t,description:e}){const{_fieldInfoMap:i,_sourceLayer:s,graphic:n,formattedAttributes:r,_expressionAttributes:o}=this,{attributes:a}=n,l=r.global;return{title:we({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:s,text:t}),description:we({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:s,text:e})}}_compileFields(t,e){const{_effectivePopupTemplate:i,formattedAttributes:s}=this,n=t.clone(),r={...s.global,...s.content[e]},o=(null==t?void 0:t.fieldInfos)||(null==i?void 0:i.fieldInfos),a=null==o?void 0:o.filter((({fieldName:t})=>fe(t)||Te(t)||r.hasOwnProperty(t))),l=null==i?void 0:i.expressionInfos,{description:u,title:c}=n,h=new Ze({attributes:r,expressionInfos:l,fieldInfos:a,...this._compileTitleAndDesc({title:c,description:u})});return this.contentViewModels[e]=h,n.fieldInfos=h.formattedFieldInfos.slice(0),n}_compileMedia(t,e){const{graphic:i,_fieldInfoMap:s,_effectivePopupTemplate:n,relatedInfos:r,_sourceLayer:o,_expressionAttributes:a}=this,{attributes:l}=i,u=this.formattedAttributes.global,c=t.clone(),{description:h,mediaInfos:d,title:p}=c,f=new oi({activeMediaInfoIndex:c.activeMediaInfoIndex||0,attributes:l,layer:o,fieldInfoMap:s,formattedAttributes:u,expressionAttributes:a,mediaInfos:d,popupTemplate:n,relatedInfos:r,...this._compileTitleAndDesc({title:p,description:h})});return c.mediaInfos=f.formattedMediaInfos.slice(0),this.contentViewModels[e]=f,c}_compileText(t,e){const i=t.clone(),{graphic:s,_fieldInfoMap:n,_sourceLayer:r,_expressionAttributes:o}=this;if(i&&i.text){const{attributes:t}=s;i.text=we({attributes:t,fieldInfoMap:n,globalAttributes:this.formattedAttributes.global,expressionAttributes:o,layer:r,text:i.text})}return this.contentViewModels[e]=new Ke({graphic:s,creator:i.text}),i}_compileLastEditInfo(){const{_effectivePopupTemplate:t,_sourceLayer:e,graphic:i}=this;if(!t)return;const{lastEditInfoEnabled:s}=t,n=null==e?void 0:e.editFieldsInfo;return s&&n?function(t,e){const{creatorField:i,creationDateField:s,editorField:n,editDateField:r}=t;if(!e)return;const o=e[r];if("number"==typeof o){const t=e[n];return{type:"edit",date:p(o,ce),user:t}}const a=e[s];if("number"==typeof a){const t=e[i];return{type:"create",date:p(a,ce),user:t}}return null}(n,i.attributes):void 0}_compileTitle(t){const{_fieldInfoMap:e,_sourceLayer:i,graphic:s,_expressionAttributes:n}=this,{attributes:r}=s;return we({attributes:r,fieldInfoMap:e,globalAttributes:this.formattedAttributes.global,expressionAttributes:n,layer:i,text:t})}async _getTitle(){const{_effectivePopupTemplate:t,graphic:e}=this;return de(null==t?void 0:t.title,{graphic:e})}async _getContent(){const{_effectivePopupTemplate:t,graphic:e}=this;return de(null==t?void 0:t.content,{graphic:e})}async _queryFeature(t){const{_featureAbortController:e,_sourceLayer:i,graphic:s,_effectivePopupTemplate:n,spatialReference:r,map:o,view:a}=this,{content:{value:l},title:{value:u}}=await C({content:this._getContent(),title:this._getTitle()});if(e!==this._featureAbortController||!s)return;await async function({graphic:t,popupTemplate:e,layer:i,spatialReference:s},n){if(!i||!e)return;if("function"==typeof i.load&&await i.load(n),!t.attributes)return;const r=t.attributes[i.objectIdField];if(null==r)return;const o=[r],a=await e.getRequiredFields(i.fieldsIndex),l=ut(a,t),u=l?[]:a,c=e.returnGeometry||await async function(t){var e;if(null==(e=t.expressionInfos)||!e.length)return!1;const i=await lt(),{arcadeUtils:{hasGeometryFunctions:s}}=i;return s(t)}(e);if(l&&!c)return;const h=await async function(t,e){var i,s;const{layer:n,graphic:r,outFields:o,objectIds:a,returnGeometry:l,spatialReference:u}=t,c=a[0];if("number"!=typeof c&&"string"!=typeof c)return te.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:n,graphic:r,objectId:c,requiredFields:o}),null;if(null==(i=n.capabilities)||null==(s=i.operations)||!s.supportsQuery)return te.warn("The specified layer cannot be queried. The following fields will not be available.",{layer:n,graphic:r,requiredFields:o,returnGeometry:l}),null;const h=n.createQuery();return h.objectIds=a,h.outFields=null!=o&&o.length?o:[n.objectIdField],h.returnGeometry=!!l,h.returnZ=!!l,h.returnM=!!l,h.outSpatialReference=u,(await n.queryFeatures(h,e)).features[0]}({layer:i,graphic:t,outFields:u,objectIds:o,returnGeometry:c,spatialReference:s},n);h&&(h.geometry&&(t.geometry=h.geometry),h.attributes&&(t.attributes={...t.attributes,...h.attributes}))}({graphic:s,popupTemplate:n,layer:i,spatialReference:r},t);const{expressionAttributes:{value:c}}=await C({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:yi({popupTemplate:this._effectivePopupTemplate,spatialReference:r,graphic:s,map:o,interceptor:_i.interceptor,view:a})});e===this._featureAbortController&&s&&(this._expressionAttributes=c,this._set("formattedAttributes",this._createFormattedAttributes(l,c)),this._set("title",this._compileTitle(u)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createFormattedAttributes(t,e){const{_effectivePopupTemplate:i,graphic:s,relatedInfos:n,_sourceLayer:r,_fieldInfoMap:o}=this,a={...s.attributes,...e},l={global:Ce({fieldInfos:null==i?void 0:i.fieldInfos,graphic:s,attributes:a,layer:r,fieldInfoMap:o,relatedInfos:n}),content:[]};return Array.isArray(t)&&t.forEach(((t,e)=>{"fields"===t.type&&t.fieldInfos&&(l.content[e]=Ce({fieldInfos:t.fieldInfos,graphic:s,attributes:a,layer:r,fieldInfoMap:o,relatedInfos:n}))})),l}_checkForRelatedFeatures(t){const{graphic:e,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(e,Fe(i),t)}async _queryRelatedInfos(e,i,s){const{relatedInfos:n,_sourceLayer:r}=this;n.clear();const o=t(r.associatedLayer)?await r.associatedLayer.load(s):r;if(!o)return;const a=i.filter((t=>t&&Te(t.fieldName)));if(!a||!a.length)return;i.forEach((t=>this._configureRelatedInfo(t,o)));const l=await function({relatedInfos:t,layer:e},i){const s={};return t.forEach(((t,n)=>{const{relation:r}=t;if(!r){const t=new g("relation-required","A relation is required on a layer to retrieve related records.");throw ii.error(t),t}const{relatedTableId:o}=r;if("number"!=typeof o){const t=new g("A related table ID is required on a layer to retrieve related records.");throw ii.error(t),t}const a=`${e.url}/${o}`,l=si.get(a),u=l||function(t,e){return x(t,{query:{f:"json"},signal:e&&e.signal})}(a,i);l||si.set(a,u),s[n]=u})),C(s)}({relatedInfos:n,layer:o},s);Object.keys(l).forEach((t=>{var e;const i=n.get(t.toString()),s=null==(e=l[t])?void 0:e.value;i&&s&&(i.layerInfo=s.data)}));const u=await function({graphic:t,relatedInfos:e,layer:i},s){const n={};return e.forEach(((e,r)=>{e.layerInfo&&(n[r]=async function(t,e,i,s){const n=i.layerId.toString(),{layerInfo:r,queryTask:o,relation:a,relatedFields:l,outStatistics:u}=e,c=function({originRelationship:t,relationships:e,layerId:i}){let s;return e&&e.some((e=>(`${e.relatedTableId}`===i&&e.id===t.id&&(s=e),!!s))),s}({originRelationship:a,relationships:r.relationships,layerId:n});if(c.relationshipTableId&&c.keyFieldInRelationshipTable){const e=(await function(t,e,i,s){const n=new at;return n.outFields=["*"],n.relationshipId="number"==typeof e.id?e.id:parseInt(e.id,10),n.objectIds=[t.attributes[i.objectIdField]],i.queryRelatedFeatures(n,s)}(t,c,i,s))[t.attributes[i.objectIdField]];if(!e)return null;const n=e.features.map((t=>t.attributes[r.objectIdField]));if((null==u?void 0:u.length)>0&&r.supportsStatistics){const t=new Mt;t.where=function(t,e){let i=0;const s=[];for(;i<e.length;)s.push(`${t} IN (${e.slice(i,1e3+i)})`),i+=1e3;return s.join(" OR ")}(r.objectIdField,n),t.outFields=l,t.outStatistics=u;const i={features:Promise.resolve(e),statsFeatures:o.execute(t)};return C(i)}}const h=null==c?void 0:c.keyField;if(h){const i=ct(function(t,e){if(null!=t){e=e.toLowerCase();for(const i of t)if(i&&i.name.toLowerCase()===e)return i}return null}(r.fields,h)),n=function(t,e){const i=e.toLowerCase();for(const e in t)if(e.toLowerCase()===i)return t[e];return null}(t.attributes,a.keyField),l=i?`${h}=${n}`:`${h}='${n}'`,u=o.execute(new Mt({where:l,outFields:e.relatedFields}),s),c=e.outStatistics&&e.outStatistics.length>0&&r.supportsStatistics?o.execute(new Mt({where:l,outFields:e.relatedFields,outStatistics:e.outStatistics}),s):null,d={features:u};return c&&(d.statsFeatures=c),C(d)}return null}(t,e,i,s))})),C(n)}({graphic:e,relatedInfos:n,layer:o},s);Object.keys(u).forEach((t=>{var e;!function(t,e){if(!e)return;if(!t)return;const{features:i,statsFeatures:s}=t,n=i&&i.value;e.relatedFeatures=n?n.features:[];const r=s&&s.value;e.relatedStatsFeatures=r?r.features:[]}(null==(e=u[t])?void 0:e.value,n.get(t.toString()))}))}_configureRelatedInfo(t,e){const{relatedInfos:i}=this,s=ni(t.fieldName);if(!s)return;const{layerId:n,fieldName:r}=s;if(!n)return;const o=i.get(n.toString())||function(t,e){const i=function(t,e){if(!e.relationships)return null;let i=null;const{relationships:s}=e;return s.some((e=>e.id===parseInt(t,10)&&(i=e,!0))),i}(t,e);if(!i)return;const s=`${e.url}/${i.relatedTableId}`;return{url:s,queryTask:new At({url:s,sourceSpatialReference:e.spatialReference}),relation:i,relatedFields:[],outStatistics:[]}}(n,e);o&&(function({relatedInfo:t,fieldName:e,fieldInfo:i}){if(t.relatedFields.push(e),i.statisticType){const s=new It({statisticType:i.statisticType,onStatisticField:e,outStatisticFieldName:e});t.outStatistics.push(s)}}({relatedInfo:o,fieldName:r,fieldInfo:t}),this.relatedInfos.set(n,o))}};Fi.interceptor=new class{constructor(t,e){this.preLayerQueryCallback=t,this.preRequestCallback=e,this.preLayerQueryCallback||(this.preLayerQueryCallback=()=>{}),this.preRequestCallback||(this.preLayerQueryCallback=()=>{})}}((({query:t,layer:e,method:i})=>{$e({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})}),(({queryPayload:t,layer:e,method:i})=>{$e({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})})),s([n()],Fi.prototype,"_error",void 0),s([n()],Fi.prototype,"_featureAbortController",void 0),s([n({readOnly:!0})],Fi.prototype,"_effectivePopupTemplate",null),s([n({readOnly:!0})],Fi.prototype,"_fieldInfoMap",null),s([n({readOnly:!0})],Fi.prototype,"_sourceLayer",null),s([n()],Fi.prototype,"abilities",void 0),s([m("abilities")],Fi.prototype,"castAbilities",null),s([n({readOnly:!0})],Fi.prototype,"content",void 0),s([n({readOnly:!0})],Fi.prototype,"contentViewModels",void 0),s([n({type:Boolean})],Fi.prototype,"defaultPopupTemplateEnabled",void 0),s([n({readOnly:!0})],Fi.prototype,"state",null),s([n({readOnly:!0})],Fi.prototype,"formattedAttributes",void 0),s([n({type:nt,value:null})],Fi.prototype,"graphic",null),s([n({readOnly:!0})],Fi.prototype,"lastEditInfo",void 0),s([n()],Fi.prototype,"relatedInfos",void 0),s([n()],Fi.prototype,"spatialReference",null),s([n({readOnly:!0})],Fi.prototype,"title",void 0),s([n()],Fi.prototype,"map",null),s([n({readOnly:!0})],Fi.prototype,"waitingForContent",null),s([n()],Fi.prototype,"view",void 0),Fi=_i=s([r(Mi)],Fi);const ki=Fi,xi=t=>{let e=class extends t{constructor(){super(...arguments),this.renderNodeContent=t=>yt(t)&&!t.destroyed?I("div",{key:t},t.render()):t instanceof HTMLElement?I("div",{key:t,bind:t,afterCreate:this._attachToNode}):_t(t)?I("div",{key:t,bind:t.domNode,afterCreate:this._attachToNode}):null}_attachToNode(t){t.appendChild(this)}};return e=s([r("esri.widgets.Feature.ContentMixin")],e),e},Ci="esri-feature__content-element",Ti={title:!0,content:!0,lastEditedInfo:!0};let Ei=class extends(xi(_)){constructor(t,e){super(t,e),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements={...Ti},this.map=null,this.view=null,this.viewModel=new ki}initialize(){this.own(v(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))}loadDependencies(){return import("./p-f4c2bc8c.js")}destroy(){this._destroyContentWidgets()}castVisibleElements(t){return{...Ti,...t}}render(){const{state:t}=this.viewModel,e=I("div",{class:"esri-feature__size-container",key:"container"},this.renderTitle(),"error"===t?this.renderError():"loading"===t?this.renderLoading():this.renderContentContainer());return I("div",{class:this.classes("esri-feature","esri-widget")},e)}setActiveMedia(t,e){this.viewModel.setActiveMedia(t,e)}nextMedia(t){this.viewModel.nextMedia(t)}previousMedia(t){this.viewModel.previousMedia(t)}renderError(){const{messagesCommon:t,messages:e,visibleElements:i}=this;return I("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},i.title?I("div",{key:"error-title",slot:"title"},t.errorMessage):null,I("div",{key:"error-message",slot:"message"},e.loadingError))}renderLoading(){return I("div",{key:"loading-container",class:"esri-feature__loading-container"},I("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))}renderContentContainer(){const{visibleElements:t}=this;return t.content?I("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:t,title:e}=this;return t.title?I(wt,{level:this.headingLevel,class:"esri-feature__title",innerHTML:e}):null}renderContent(){const t=this.viewModel.content,e="content";if(!t)return null;if(Array.isArray(t))return t.length?I("div",{key:`${e}-content-elements`},t.map(this.renderContentElement,this)):null;if("string"==typeof t){const t=this._contentWidgets[0];return!t||t.destroyed?null:I("div",{key:`${e}-content`},t.render())}return this.renderNodeContent(t)}renderContentElement(t,e){const{visibleElements:i}=this;if("boolean"!=typeof i.content&&!i.content[t.type])return null;switch(t.type){case"attachments":return this.renderAttachments(e);case"custom":return this.renderCustom(t,e);case"fields":return this.renderFields(e);case"media":return this.renderMedia(e);case"text":return this.renderText(t,e);default:return null}}renderAttachments(t){const e=this._contentWidgets[t];if(!e||e.destroyed)return null;const{state:i,attachmentInfos:s}=e.viewModel;return"loading"===i||s.length>0?I("div",{key:this._buildKey("attachments-element",t),class:this.classes(Ci)},e.render()):null}renderCustom(t,e){const{creator:i}=t,s=this._contentWidgets[e];return!s||s.destroyed?null:i?I("div",{key:this._buildKey("custom-element",e),class:Ci},s.render()):null}renderFields(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:I("div",{key:this._buildKey("fields-element",t),class:Ci},e.render())}renderMedia(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:I("div",{key:this._buildKey("media-element",t),class:Ci},e.render())}renderLastEditInfo(){const{visibleElements:t,messages:e}=this,{lastEditInfo:i}=this.viewModel;if(!i||!t.lastEditedInfo)return null;const{date:s,user:n}=i,r=j("edit"===i.type?n?e.lastEditedByUser:e.lastEdited:n?e.lastCreatedByUser:e.lastCreated,{date:s,user:n});return I("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info",Ci)},r)}renderText(t,e){const i=this._contentWidgets[e];return!i||i.destroyed?null:t.text?I("div",{key:this._buildKey("text-element",e),class:this.classes(Ci,"esri-feature__text")},i.render()):null}_buildKey(t,...e){return`${t}__${this.get("viewModel.graphic.uid")||"0"}-${e.join("-")}`}_destroyContentWidgets(){this._contentWidgets.forEach((t=>{t.viewModel=null,t&&!t.destroyed&&t.destroy()})),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:t,visibleElements:e}=this,i=this.get("viewModel.content"),{contentViewModels:s}=this.viewModel;if(Array.isArray(i))i.forEach(((i,n)=>{"attachments"===i.type&&(this._contentWidgets[n]=new We({displayType:i.displayType,headingLevel:e.title?t+1:t,viewModel:s[n]})),"fields"===i.type&&(this._contentWidgets[n]=new ei({viewModel:s[n]})),"media"===i.type&&(this._contentWidgets[n]=new mi({viewModel:s[n]})),"text"===i.type&&(this._contentWidgets[n]=new Xe({viewModel:s[n]})),"custom"===i.type&&(this._contentWidgets[n]=new Xe({viewModel:s[n]}))}),this);else{const t=s[0];t&&!t.destroyed&&(this._contentWidgets[0]=new Xe({viewModel:t}))}this.scheduleRender()}};s([w("viewModel.graphic")],Ei.prototype,"graphic",void 0),s([w("viewModel.defaultPopupTemplateEnabled")],Ei.prototype,"defaultPopupTemplateEnabled",void 0),s([n()],Ei.prototype,"headingLevel",void 0),s([n({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ei.prototype,"label",void 0),s([n(),y("esri/widgets/Feature/t9n/Feature")],Ei.prototype,"messages",void 0),s([n(),y("esri/t9n/common")],Ei.prototype,"messagesCommon",void 0),s([n(),y("esri/widgets/support/t9n/uriUtils")],Ei.prototype,"messagesURIUtils",void 0),s([w("viewModel.spatialReference")],Ei.prototype,"spatialReference",void 0),s([w("viewModel.title")],Ei.prototype,"title",void 0),s([n()],Ei.prototype,"visibleElements",void 0),s([m("visibleElements")],Ei.prototype,"castVisibleElements",null),s([w("viewModel.map")],Ei.prototype,"map",void 0),s([w("viewModel.view")],Ei.prototype,"view",void 0),s([n({type:ki})],Ei.prototype,"viewModel",void 0),Ei=s([r("esri.widgets.Feature")],Ei);const Pi=Ei;let $i=class extends z.EventedAccessor{constructor(t){super(t),this._anchorHandles=new O,this.location=null,this.screenLocation=null,this.screenLocationEnabled=!1,this.view=null,this._anchorHandles.add([N(this,["screenLocationEnabled","location","view.size","view.stationary"],(()=>this._updateScreenPointAndHandle())),N(this,["view","view.ready"],(()=>this._wireUpView()))])}destroy(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null}_wireUpView(){const t="view";if(this._anchorHandles.remove(t),this._viewpointHandle=null,!this.get("view.ready"))return;this._setScreenLocation();const{view:e}=this,i=R(e,"3d"===e.type?"camera":"viewpoint",(()=>this._viewpointChange()));this._anchorHandles.add(i,t),this._viewpointHandle=i,this._toggleWatchingViewpoint()}_viewpointChange(){this._setScreenLocation(),this.emit("view-change")}_updateScreenPointAndHandle(){this._setScreenLocation(),this._toggleWatchingViewpoint()}_toggleWatchingViewpoint(){const{_viewpointHandle:t,location:e,screenLocationEnabled:i}=this;t&&(e&&i?t.resume():t.pause())}_setScreenLocation(){const{location:e,view:i,screenLocationEnabled:s}=this,n=this.get("view.ready"),r=s&&n&&t(e)?i.toScreen(e):null;this._set("screenLocation",r)}};s([n()],$i.prototype,"location",void 0),s([n({readOnly:!0})],$i.prototype,"screenLocation",void 0),s([n()],$i.prototype,"screenLocationEnabled",void 0),s([n()],$i.prototype,"view",void 0),$i=s([r("esri.widgets.support.AnchorElementViewModel")],$i);const Oi=$i;let Li=class extends Oi{constructor(t){super(t),this.visible=!1}};s([n()],Li.prototype,"visible",void 0),Li=s([r("esri.widgets.CompassViewModel")],Li);const ji=Li;let zi=class extends _{constructor(t,e){super(t,e),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new ji,this.visible=!1}initialize(){this.own([N(this,"visible",(t=>this._visibleChange(t)))])}destroy(){this._animationPromise=null}show(t){const{location:e,promise:i}=t;e&&(this.viewModel.location=e),this.visible=!0,i&&i.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:t}=this,{screenLocation:e}=this.viewModel,i=!!e,s={"esri-spinner--start":t&&i,"esri-spinner--finish":!t&&i},n=this._getPositionStyles();return I("div",{class:this.classes("esri-spinner",s),styles:n})}_visibleChange(t){if(t)return void(this.viewModel.screenLocationEnabled=!0);const e=V(this._animationDelay);this._animationPromise=e,e.catch((()=>{})).then((()=>{this._animationPromise===e&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:t,view:i}=this.viewModel;if(!i||e(t))return{};const{padding:s}=i;return{left:t.x-s.left+"px",top:t.y-s.top+"px"}}};s([w("viewModel.location")],zi.prototype,"location",void 0),s([w("viewModel.view")],zi.prototype,"view",void 0),s([n({type:ji})],zi.prototype,"viewModel",void 0),s([w("viewModel.visible")],zi.prototype,"visible",void 0),zi=s([r("esri.widgets.Spinner")],zi);const Ni=zi,Ri=S("mac")?"Meta":"Ctrl",Vi={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)Vi[t]=String.fromCharCode(t);for(let t=1;t<25;t++)Vi[111+t]=`F${t}`;for(let t=65;t<91;t++)Vi[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function Si(t){if(void 0!==t.key)return P(t);const e=Vi[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function Di(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class Ui{constructor(t,e=[]){this.eventType=t,this.keyModifiers=e}matches(t){if(t.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const e=t.modifiers;for(const t of this.keyModifiers)if(!e.has(t))return!1;return!0}}const Bi=h.getLogger("esri.views.input.InputHandler");class Hi{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const e=this._incoming[t];for(const t of e)this._incomingEventMatches.push(t.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((t=>t.eventType))),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?Bi.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback((t=>this._handleEvent(t))),t.setUninstallCallback((()=>this._onUninstall())),this._manager=t)}onUninstall(){}registerIncoming(t,e,i){let s;"function"==typeof e?(i=e,s=[]):s=e||[];const n="string"==typeof t?new Ui(t,s):t,r=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},o=t=>{const e=this._incoming[t.match.eventType];if(e){const i=e.indexOf(t);e.splice(i,1),r(),this._manager&&this._manager.updateDependencies()}},a=new qi(n,i,{onPause:o,onRemove:o,onResume:t=>{const e=this._incoming[t.match.eventType];e&&-1===e.indexOf(t)&&(e.push(t),r(),this._manager&&this._manager.updateDependencies())}});let l=this._incoming[n.eventType];return l||(l=[],this._incoming[n.eventType]=l),l.push(a),r(),this._manager&&this._manager.updateDependencies(),a}registerOutgoing(t){if(this._outgoing[t])throw Error("There is already a callback registered for this outgoing InputEvent: "+t);const e=new Wi(t,{onEmit:(t,e,i,s)=>{this._manager.emit(t.eventType,e,i,s)},onRemove:t=>{delete this._outgoing[t.eventType],this._manager.updateDependencies()}});return this._outgoing[t]=e,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),e}startCapturingPointer(t){this._manager.setPointerCapture(t,!0)}stopCapturingPointer(t){this._manager.setPointerCapture(t,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Bi.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){const e=this._incoming[t.type];if(e)for(const i of e)if(i.match.matches(t)&&(i.callback(t),t.shouldStopPropagation()))break}}class qi{constructor(t,e,i){this.match=t,this._callback=e,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class Wi{constructor(t,e){this.eventType=t,this._removed=!1,this._handler=e}emit(t,e,i){this._removed||this._handler.onEmit(this,t,e,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}class Gi extends Hi{constructor(t){super(!0),this._onChange=t,this._value="mouse",this.registerIncoming("pointer-down",(t=>{this._setValue("touch"===t.data.native.pointerType?"touch":"mouse")})),this._moveHandler=this.registerIncoming("pointer-move",(t=>{this._setValue("touch"===t.data.native.pointerType?"touch":"mouse")})),this._moveHandler.pause()}_setValue(t){t!==this._value&&("touch"===t?this._moveHandler.resume():this._moveHandler.pause(),this._value=t,this._onChange(t))}}const Ki=h.getLogger("esri.views.input.InputManager");let Qi=class extends o{constructor(t){super(t),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=Ri,this.latestPointerType="mouse",this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const t=Object.keys(this._nameToGroup);for(const e of t)this.uninstallHandlers(e);this.eventSource=null,this._currentPropagation=null}get hasPendingInputs(){return this._handlers.some((t=>t.handler.hasPendingInputs))}installHandlers(t,e,i=Yi.INTERNAL){if(this._nameToGroup[t])return void Ki.error("There is already an InputHandler group registered under the name `"+t+"`");if(0===e.length)return void Ki.error("Can't register a group of zero handlers");const s={name:t,handlers:e.map((t=>({handler:t,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null})))};this._nameToGroup[t]=s;for(let t=s.handlers.length-1;t>=0;t--){const e=s.handlers[t];this._handlers.push(e),e.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(t,i,s,n,r)=>{this._emitInputEvent(e.priorityIndex+1,t,i,s,r,n)},setPointerCapture:(t,i)=>{this._setPointerCapture(s,e,t,i)},setEventCallback:t=>{e.eventCallback=t},setUninstallCallback:t=>{e.uninstallCallback=t},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(t){const e=this._nameToGroup[t];e?(e.handlers.forEach((t=>{t.removed=!0,t.uninstallCallback()})),delete this._nameToGroup[t],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):Ki.error("There is no InputHandler group registered under the name `"+t+"`")}hasHandlers(t){return void 0!==this._nameToGroup[t]}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const t=new Set,e=new Set;this._handlersPriority=[];for(let t=this._handlers.length-1;t>=0;t--){const e=this._handlers[t];e.priorityIndex=t,this._handlersPriority.push(e)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const s=this._handlersPriority[i];s.priorityIndex=i;let n=s.handler.hasSideEffects;if(!n)for(const e of s.handler.outgoingEventTypes)if(t.has(e)){n=!0;break}if(n)for(const i of s.handler.incomingEventMatches){t.add(i.eventType);for(const t of i.keyModifiers)Di(t)||e.add(t)}s.active=n}this._sourceEvents=t,this._keyModifiers=e,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointerType(t){this._set("latestPointerType",t)}_onEventReceived(t,e){"pointer-capture-lost"===t&&this._pointerCaptures.delete(e.native.pointerId),this._updateKeyModifiers(t,e),this._emitInputEventFromSource(t,e,null!=this.test.timestamp?this.test.timestamp:e.native?e.native.timestamp:void 0,e.native?e.native.cancelable:void 0)}_updateKeyModifiers(t,e){if(!e)return;let i=!1;const s=()=>{if(!i){const t=new Set;this._activeKeyModifiers.forEach((e=>{t.add(e)})),this._activeKeyModifiers=t,i=!0}},n=(t,e)=>{e&&!this._activeKeyModifiers.has(t)?(s(),this._activeKeyModifiers.add(t)):!e&&this._activeKeyModifiers.has(t)&&(s(),this._activeKeyModifiers.delete(t))};if("key-down"===t||"key-up"===t){const i=e.key;this._keyModifiers.has(i)&&n(i,"key-down"===t)}const r=e.native;n("Alt",!(!r||!r.altKey)),n("Ctrl",!(!r||!r.ctrlKey)),n("Shift",!(!r||!r.shiftKey)),n("Meta",!(!r||!r.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerTypeHandler=new Gi((t=>this._setLatestPointerType(t))),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Yi.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],Yi.INTERNAL)}_setPointerCapture(t,e,i,s){const n=t.name+"-"+e.priorityIndex,r=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,r),s?(r.add(n),1===r.size&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):r.has(n)&&(r.delete(n),0===r.size&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter((t=>!t.removed)),this.updateDependencies()}_emitInputEventFromSource(t,e,i,s){this._emitInputEvent(0,t,e,i,s)}_emitInputEvent(t,e,i,s,n,r){const o=void 0!==s?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a={event:new Xi(e,i,o,r||this._activeKeyModifiers,void 0!==n&&n),priorityIndex:t};this._currentPropagation?this._currentPropagation.events.push(a):this._doNewPropagation(a)}_doNewPropagation(t){this._currentPropagation={events:new Pt,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:t.event.timestamp},this._currentPropagation.events.push(t),this._continuePropagation()}_continuePropagation(){const t=this._currentPropagation;if(t){for(;this._currentPropagation.events.length>0;){const{event:e,priorityIndex:i}=this._currentPropagation.events.pop(),s=e.data&&e.data.eventId;if(null==s||!this._stoppedPropagationEventIds.has(s))for(t.currentHandler=this._handlersPriority[i];t.currentHandler;){if(t.currentHandler.removed)t.needsHandlerGarbageCollect=!0;else{if(t.currentHandler.active&&!e.shouldStopPropagation()&&t.currentHandler.eventCallback(e),e.shouldStopPropagation()){null!=s&&this._stoppedPropagationEventIds.add(s);break}if(e.shouldPausePropagation((()=>this._continuePropagation())))return void this._pausePropagation({event:e,priorityIndex:t.currentHandler.priorityIndex+1})}t.currentHandler=this._handlersPriority[t.currentHandler.priorityIndex+1]}}t.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(t){const e=new Pt;for(e.push(t);this._currentPropagation.events.length;)e.push(this._currentPropagation.events.pop());this._currentPropagation.events=e,this._currentPropagation.currentHandler=null}_compareHandlerPriority(t,e){if(t.handler.hasSideEffects!==e.handler.hasSideEffects)return t.handler.hasSideEffects?1:-1;if(t.groupPriority!==e.groupPriority)return t.groupPriority>e.groupPriority?-1:1;for(const i of t.handler.incomingEventMatches)for(const t of e.handler.incomingEventMatches){if(i.eventType!==t.eventType)continue;const e=i.keyModifiers.filter((e=>-1!==t.keyModifiers.indexOf(e)));if(e.length===i.keyModifiers.length!=(e.length===t.keyModifiers.length))return i.keyModifiers.length>t.keyModifiers.length?-1:1}return t.priorityIndex>e.priorityIndex?-1:1}_sortHandlersPriority(t){const e=[];for(const i of t){let t=0;for(;t<e.length&&this._compareHandlerPriority(i,e[t])>=0;)t++;e.splice(t,0,i)}return e}get debug(){const t=t=>{const e=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=e};return{injectEvent:(e,i)=>{t((()=>{this._onEventReceived(e,i)}))},disablePointerCapture:t}}};s([n({readOnly:!0})],Qi.prototype,"hasPendingInputs",null),s([n()],Qi.prototype,"eventSource",void 0),s([n()],Qi.prototype,"recognizers",void 0),s([n({readOnly:!0})],Qi.prototype,"latestPointerType",void 0),Qi=s([r("esri.views.input.InputManager")],Qi);class Xi{constructor(t,e,i,s,n){this.type=t,this.data=e,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=0,this._resumeCallback=null}stopPropagation(){this._propagationState|=1}shouldStopPropagation(){return 0!=(1&this._propagationState)}async(t){this._propagationState|=2;const e=(t,e)=>{this._propagationState&=-3;const i=this._resumeCallback;if(this._resumeCallback=null,i&&i(),e)throw t;return t};return("function"==typeof t?t():t).then((t=>e(t,!1)),(t=>e(t,!0)))}shouldPausePropagation(t){return!!(2&this._propagationState)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}const Yi={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3},Zi=new vt({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),Ji=new vt({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),ts=new vt({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),es=new vt({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:"esri-icon-table"}),is=h.getLogger("esri.widgets.Popup.PopupViewModel");function ss(t){const{selectedFeature:e,location:i,view:s}=t;return s?"3d"===s.type?e||i:t.get("selectedFeature.geometry")||i:null}async function ns(t){const{location:e,selectedFeature:i,view:s,zoomFactor:n}=t,r=ss(t);if(!r){const t=new g("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:r,view:s});return is.error(t),Promise.reject(t)}const o=s.scale/n,a=t.get("selectedFeature.geometry")||e,l=a&&"point"===a.type&&function(t,e){if("3d"!==(null==e?void 0:e.type)||!t||"esri.Graphic"!==t.declaredClass)return!0;const i=e.getViewForGraphic(t);if(i&&"whenGraphicBounds"in i){let e=!1;return i.whenGraphicBounds(t,{useViewElevation:!0}).then((t=>{e=!t||!t.boundingBox||t.boundingBox[0]===t.boundingBox[3]&&t.boundingBox[1]===t.boundingBox[4]&&t.boundingBox[2]===t.boundingBox[5]})).catch((()=>{const e=new g("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:t});is.error(e)})),e}return!0}(i,s);Zi.active=!0,Zi.disabled=!0,await t.view.goTo({target:r,scale:l?o:void 0}),Zi.active=!1,Zi.disabled=!1,t.zoomToLocation=null,l&&(t.location=a)}async function rs(t){const{selectedFeature:e,view:i}=t;if("2d"!==(null==i?void 0:i.type)){const t=new g("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw is.error(t),t}if(!e.isAggregate){const t=new g("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw is.error(t),t}const s=e.sourceLayer,n=await i.whenLayerView(s),r=n.createQuery();r.aggregateIds=[e.getObjectId()],ts.active=!0,ts.disabled=!0;const{extent:o}=await n.queryExtent(r);await i.goTo({target:o}),ts.active=!1,ts.disabled=!1}const os=a.ofType({key:"type",defaultKeyValue:"button",base:gt,typeMap:{button:vt,toggle:bt}}),as="esri.widgets.Popup.PopupViewModel",ls=h.getLogger(as);let us=class extends(Ot(Oi)){constructor(t){super(t),this._handles=new O,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new os,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new nt({symbol:new kt({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some((t=>t.waitingForContent))}initialize(){this._handles.add([v(this,["autoOpenEnabled","view"],(()=>this._autoOpenEnabledChange())),this.on("view-change",(()=>this._autoClose())),N(this,["highlightEnabled","selectedFeature","visible","view"],(()=>this._highlightFeature())),N(this,"view.animation.state",(t=>this._animationStateChange(t))),N(this,"location",(t=>this._locationChange(t))),N(this,"selectedFeature",(t=>this._selectedFeatureChange(t))),N(this,["selectedFeatureIndex","featureCount","featuresPerPage"],(()=>this._selectedFeatureIndexChange())),N(this,["featurePage","selectedFeatureIndex","featureCount","featuresPerPage, featureViewModels"],(()=>this._setGraphicOnFeatureViewModels())),N(this,"featureViewModels",(()=>this._featureViewModelsChange())),this.on("trigger-action",(t=>function(t){const{event:e,view:i}=t,{action:s}=e,n=i&&i.popup;if(!s)return Promise.reject(new g("trigger-action:missing-arguments","Event has no action"));if(!n)return Promise.reject(new g("trigger-action:missing-arguments","view.popup is missing"));const{disabled:r,id:o}=s;if(!o)return Promise.reject(new g("trigger-action:invalid-action","action.id is missing"));if(r)return Promise.reject(new g("trigger-action:invalid-action","Action is disabled"));if(o===Zi.id)return ns(n.viewModel);if(o===ts.id)return rs(n.viewModel);if(o===es.id)return n.featureMenuOpen=!n.featureMenuOpen,n.viewModel.browseClusterEnabled=!n.viewModel.browseClusterEnabled,Promise.resolve();if(n.viewModel.browseClusterEnabled=!1,o===Ji.id){n.close();const{selectedFeature:t}=n;if(!t)return Promise.reject(new g(`trigger-action:${Ji.id}`,"selectedFeature is required",{selectedFeature:t}));const{sourceLayer:e}=t;return e?e.remove(t):i.graphics.remove(t),Promise.resolve()}return Promise.resolve()}({event:t,view:this.view}))),D(this,"waitingForResult",(()=>this._waitingForResultChange()),!0),N(this,["features","view","view.map","view.spatialReference"],(()=>this._updateFeatureVMs())),N(this,["view.scale"],this._viewScaleChange),D(this,"visible",(()=>this.browseClusterEnabled=!1)),N(this,"browseClusterEnabled",(t=>t?this.enableClusterBrowsing():this.disableClusterBrowsing()))])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const t=this._get("allActions")||new os;t.removeAll();const{actions:e,defaultActions:i,defaultPopupTemplateEnabled:s,includeDefaultActions:n,selectedFeature:r}=this,o=n?i.concat(e):e,a=r&&("function"==typeof r.getEffectivePopupTemplate&&r.getEffectivePopupTemplate(s)||r.popupTemplate),l=a&&a.actions,u=a&&a.overwriteActions?l:l?l.concat(o):o;return u&&u.filter(Boolean).forEach((e=>t.add(e))),t}get defaultActions(){var t;const e=this._get("defaultActions")||new os;return e.removeAll(),e.addMany(null!=(t=this.selectedFeature)&&t.isAggregate?[ts.clone(),es.clone()]:[Zi.clone()]),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(t){const e=t||[];this._set("features",e);const{pendingPromisesCount:i,promiseCount:s,selectedFeatureIndex:n}=this,r=s&&e.length;r&&i&&-1===n?this.selectedFeatureIndex=0:r&&-1!==n||(this.selectedFeatureIndex=e.length?0:-1)}get location(){return this._get("location")||null}set location(t){const e=this.get("view.spatialReference.isWebMercator");t&&t.get("spatialReference.isWGS84")&&e&&(t=U(t)),this._set("location",t)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(t){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(t)||!t.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",t),(t=t.slice(0)).forEach((t=>{this._pendingPromises.add(t),t.then((e=>{this._pendingPromises.has(t)&&this._updateFeatures(e),this._updatePendingPromises(t)}),(()=>this._updatePendingPromises(t)))})),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:t,selectedFeatureIndex:e}=this;return-1===e?null:t[e]||null}get selectedFeatureIndex(){const t=this._get("selectedFeatureIndex");return"number"==typeof t?t:-1}set selectedFeatureIndex(t){const{featureCount:e}=this;t=isNaN(t)||t<-1||!e?-1:(t+e)%e,this._set("selectedFeatureIndex",t)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:t}=this,e=ss(this);if(!e){const i=new g("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:e,view:t});return ls.error(i),Promise.reject(i)}return this.callGoTo({target:{target:e,scale:t.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null})}fetchFeatures(t,e){const{view:i}=this;if(!i||!t){const e=new g("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:t,view:i});return ls.error(e),Promise.reject(e)}return i.fetchPopupFeatures(t,{event:e&&e.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:e&&e.signal})}open(t){const e={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...t,visible:!0},{fetchFeatures:i}=e;delete e.fetchFeatures,i&&this._setFetchFeaturesPromises(e.location),this.set(e)}triggerAction(t){const e=this.allActions.getItemAt(t);e&&!e.disabled&&this.emit("trigger-action",{action:e})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){(function(t){t.features=t.features.filter((t=>t.isAggregate))})(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){await async function(t){const{selectedFeature:e,view:i}=t;if("2d"!==(null==i?void 0:i.type)){const t=new g("displayClusterExtent:invalid-view","View must be 2d MapView.",{view:i});throw is.error(t),t}if(!e.isAggregate){const t=new g("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw is.error(t),t}const s=e.sourceLayer,n=await i.whenLayerView(s),r=n.createQuery();r.aggregateIds=[e.getObjectId()];const{extent:o}=await n.queryExtent(r);t.selectedClusterBoundaryFeature.geometry=o,i.graphics.add(t.selectedClusterBoundaryFeature)}(this),await async function(t){const{selectedFeature:e,view:i}=t;if("2d"!==(null==i?void 0:i.type)){const t=new g("browseAggregateFeatures:invalid-view","View must be 2d MapView.",{view:i});throw is.error(t),t}if(!e.isAggregate){const t=new g("browseAggregateFeatures:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw is.error(t),t}const s=e.sourceLayer,n=await i.whenLayerView(s),r=n.createQuery();r.aggregateIds=[e.getObjectId()],es.active=!0,es.disabled=!0;const{features:o}=await n.queryFeatures(r);es.active=!1,es.disabled=!1,i.popup.open({features:[e].concat(o),featureMenuOpen:!0})}(this)}_animationStateChange(t){this.zoomToLocation||(Zi.disabled="waiting-for-target"===t)}_clearBrowsedClusterGraphics(){var t;const e=null==(t=this.view)?void 0:t.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){var t;(null!=(t=this.selectedFeature)&&t.isAggregate||this.browseClusterEnabled)&&(this.browseClusterEnabled=!1,this.visible=!1)}_locationChange(t){const{selectedFeature:e,updateLocationEnabled:i}=this;i&&t&&(!e||e.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:t,featureCount:e,featurePage:i,featuresPerPage:s,featureViewModels:n}=this;if(null===i)return;const r=((i-1)*s+e)%e;n.slice(r,r+s).forEach(((e,i)=>{e&&!e.graphic&&(e.graphic=t[r+i])}))}async _selectedFeatureChange(t){if(!t)return;const{location:e,updateLocationEnabled:s,view:n}=this;if(this.browseClusterEnabled){if(this._selectedClusterFeature&&(n.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),t.isAggregate)return;return t.symbol=await Bt(t),this._selectedClusterFeature=t,void n.graphics.add(this._selectedClusterFeature)}!s&&e||!t.geometry?s&&!t.geometry&&this.centerAtLocation().then((()=>{this.location=n.center.clone()})):this.location=i(this._getPointFromGeometry(t.geometry))}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(t){return this._fetchFeaturesWithController(this._getScreenPoint(t||this.location)).then((t=>{const{clientOnlyGraphics:e,promisesPerLayerView:i}=t,s=Promise.resolve(e),n=i.map((t=>t.promise));this.promises=[s,...n]}))}_destroyFeatureVMs(){this.featureViewModels.forEach((t=>t&&!t.destroyed&&t.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:t,features:e,featureViewModels:i}=this;if(null!=t&&t.isAggregate||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!e||!e.length)return;const s=i.slice(0),n=[];e.forEach(((e,i)=>{if(!e)return;let r=null;if(s.some(((t,i)=>(t&&t.graphic===e&&(r=t,s.splice(i,1)),!!r))),r)n[i]=r;else{var o,a;const s=new ki({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:null==(o=this.view)?void 0:o.spatialReference,graphic:e===t?e:null,map:null==(a=this.view)?void 0:a.map,view:this.view});n[i]=s}})),s.forEach((t=>t&&!t.destroyed&&t.destroy())),this._set("featureViewModels",n)}_getScreenPoint(t){const{view:e}=this;return e&&t&&"function"==typeof e.toScreen?e.toScreen(t):null}_autoOpenEnabledChange(){const t="auto-fetch-features",{_handles:e,autoOpenEnabled:i}=this;if(e.remove(t),i&&this.view){const i=this.view.on("click",(t=>{"mouse"===t.pointerType&&0!==t.button||this._fetchFeaturesAndOpen(t)}),Yi.WIDGET);e.add(i,t)}}_cancelFetchingFeatures(){const t=this._fetchFeaturesController;t&&t.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(t,e){this._cancelFetchingFeatures();const i=new AbortController,{signal:s}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const n=this.fetchFeatures(t,{signal:s,event:e});return n.catch((()=>{})).then((()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")})),n}_fetchFeaturesAndOpen(t){const{screenPoint:e,mapPoint:i}=t,{view:s}=this;this._fetchFeaturesWithController(e,t).then((t=>{const{clientOnlyGraphics:e,promisesPerLayerView:n,location:r}=t,o=[Promise.resolve(e),...n.map((t=>t.promise))];return s.popup.open({location:r||i,promises:o}),t}))}_updatePendingPromises(t){t&&this._pendingPromises.has(t)&&(this._pendingPromises.delete(t),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(t){return e(t)?null:"point"===t.type?t:"extent"===t.type?t.center:"polygon"===t.type?t.centroid:"multipoint"===t.type||"polyline"===t.type?t.extent.center:null}async _getLayerView(t,e){return await t.when(),t.whenLayerView(e)}async _highlightFeature(){const t="highlight";this._handles.remove(t);const{selectedFeature:e,highlightEnabled:i,view:s,visible:n}=this;if(!(e&&s&&i&&n))return;let{layer:r,sourceLayer:o}=e;if("map-notes"!==(null==o?void 0:o.type)&&"subtype-group"!==(null==o?void 0:o.type)||(r=o),!(r&&r instanceof xt))return;const a=this._getLayerView(s,r);this._highlightPromise=a;const l=await a;if(!(l&&$t(l)&&this._highlightPromise===a&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const u="objectIdField"in r&&r.objectIdField,c=e.attributes,h=l.highlight(c&&u&&c[u]||e);this._handles.add(h,t)}_updateFeatures(t){const{features:e}=this;if(!t||!t.length)return;if(!e.length)return void(this.features=t);const i=t.filter((t=>-1===e.indexOf(t)));this.features=e.concat(i)}};s([n()],us.prototype,"featurePage",void 0),s([n()],us.prototype,"isLoadingFeature",null),s([n({type:os})],us.prototype,"actions",void 0),s([n({readOnly:!0})],us.prototype,"active",null),s([n({readOnly:!0})],us.prototype,"allActions",null),s([n({type:Boolean})],us.prototype,"defaultPopupTemplateEnabled",void 0),s([n()],us.prototype,"autoCloseEnabled",void 0),s([n()],us.prototype,"autoOpenEnabled",void 0),s([n()],us.prototype,"browseClusterEnabled",void 0),s([n()],us.prototype,"content",void 0),s([n({type:os,readOnly:!0})],us.prototype,"defaultActions",null),s([n({readOnly:!0})],us.prototype,"featureCount",null),s([n()],us.prototype,"features",null),s([n()],us.prototype,"featuresPerPage",void 0),s([n()],us.prototype,"featureViewModelAbilities",void 0),s([n({readOnly:!0})],us.prototype,"featureViewModels",void 0),s([n()],us.prototype,"highlightEnabled",void 0),s([n()],us.prototype,"includeDefaultActions",void 0),s([n({type:B})],us.prototype,"location",null),s([n({readOnly:!0})],us.prototype,"pendingPromisesCount",null),s([n({readOnly:!0})],us.prototype,"selectedClusterBoundaryFeature",void 0),s([n({readOnly:!0})],us.prototype,"waitingForResult",null),s([n({readOnly:!0})],us.prototype,"promiseCount",null),s([n()],us.prototype,"promises",null),s([n({value:null,readOnly:!0})],us.prototype,"selectedFeature",null),s([n({value:-1})],us.prototype,"selectedFeatureIndex",null),s([n({readOnly:!0})],us.prototype,"selectedFeatureViewModel",null),s([n({readOnly:!0})],us.prototype,"state",null),s([n()],us.prototype,"title",void 0),s([n()],us.prototype,"updateLocationEnabled",void 0),s([n()],us.prototype,"view",void 0),s([n()],us.prototype,"visible",void 0),s([n()],us.prototype,"zoomFactor",void 0),s([n()],us.prototype,"zoomToLocation",void 0),s([n()],us.prototype,"centerAtLocation",null),us=s([r(as)],us);const cs=us,hs="selected-index",ds="popup-spinner",ps="esri-popup--shadow",fs="esri-popup__button",ms="esri-popup__icon",vs={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},gs="esri-popup";function bs(t,e){return void 0===e?`${gs}__${t}`:`${gs}__${t}-${e}`}const ws="esri.widgets.Popup",ys=h.getLogger(ws),_s={closeButton:!0,featureNavigation:!0};let Ms=class extends(xi(_)){constructor(t,e){super(t,e),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new O,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([t])=>{null!=t&&t.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback),this._displaySpinnerThrottled=Wt((()=>this._displaySpinner()),0),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new cs,this.visible=null,this.visibleElements={..._s},this._addSelectedFeatureIndexHandle(),this.own([N(this,"viewModel.screenLocation",(()=>this._positionContainer())),N(this,["viewModel.active","dockEnabled"],(()=>this._toggleScreenLocationEnabled())),N(this,"viewModel.screenLocation",((t,e)=>{!!t!=!!e&&this.reposition()})),N(this,["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],(()=>this.reposition())),N(this,"spinnerEnabled",(t=>this._spinnerEnabledChange(t))),N(this,"viewModel.view.size",((t,e)=>this._updateDockEnabledForViewSize(t,e))),N(this,"viewModel.view",((t,e)=>this._viewChange(t,e))),N(this,"viewModel.view.ready",((t,e)=>this._viewReadyChange(t,e))),N(this,["viewModel.waitingForResult","viewModel.location"],(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),N(this,["selectedFeatureWidget.viewModel.title","selectedFeatureWidget.viewModel.state"],(()=>this._setTitleFromFeatureWidget())),N(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.state"],(()=>this._setContentFromFeatureWidget())),D(this,"collapsed",(()=>{var t,e;"xsmall"===(null==(t=this.viewModel)||null==(e=t.view)?void 0:e.widthBreakpoint)&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()})),M(this,"viewModel.allActions","change",(()=>this._watchActions())),v(this,"viewModel.allActions",(()=>this._watchActions())),N(this,"viewModel.featureViewModels",(()=>this._featureMenuViewportScrollTop()))])}destroy(){var t,e;this._destroySelectedFeatureWidget(),this._destroySpinner(),null==(t=this._handles)||t.destroy(),this._unobserveFeatureMenuObserver(),null==(e=this._featureMenuIntersectionObserver)||e.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var t,e,i,s,n,r,o;return!!(this.selectedFeatureWidget?(null==(t=this.selectedFeatureWidget)||null==(e=t.viewModel)?void 0:e.waitingForContent)||"error"===(null==(i=this.selectedFeatureWidget)||null==(s=i.viewModel)?void 0:s.state)||(null==(n=this.selectedFeatureWidget)||null==(r=n.viewModel)?void 0:r.content):null==(o=this.viewModel)?void 0:o.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(t){this._set("actionsMenuOpen",!!t)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||vs}set dockOptions(t){const e={...vs},i=this.get("viewModel.view.breakpoints"),s={};i&&(s.width=i.xsmall,s.height=i.xsmall);const n={...e,...t},r={...e.breakpoint,...s},{breakpoint:o}=n;!0===o?n.breakpoint=r:"object"==typeof o&&(n.breakpoint={...r,...o}),this._set("dockOptions",n),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:t,visibleElements:e,headingLevel:i}=this,{selectedFeatureViewModel:s}=this.viewModel,n={...e,title:!1};return s?(t?(t.viewModel=s,t.visibleElements=n):this._feature=new Pi({headingLevel:i+1,viewModel:s,visibleElements:n}),this._feature):null}castVisibleElements(t){return{..._s,...t}}blur(){const{active:t}=this.viewModel;t||ys.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(t,e){return this.viewModel.fetchFeatures(t,e)}focus(){const{active:t}=this.viewModel;t||ys.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(t){var e,i;this._handles.remove(hs);const s={collapsed:!!t&&!!t.collapsed,actionsMenuOpen:!!t&&!!t.actionsMenuOpen,featureMenuOpen:!!t&&!!t.featureMenuOpen};"xsmall"===(null==(e=this.viewModel)||null==(i=e.view)?void 0:i.widthBreakpoint)&&(s.collapsed=!0),this.set(s),this.viewModel.open(t),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(t){this.viewModel.triggerAction(t)}render(){var t,e,i,s;const{actionsMenuOpen:n,dockEnabled:r,featureMenuVisible:o,dividedActions:a,currentAlignment:l,currentDockPosition:u}=this,{active:c}=this.viewModel,{menuActions:h}=a,d=null==(t=this.selectedFeature)||null==(e=t.layer)?void 0:e.title,p=null==(i=this.selectedFeature)||null==(s=i.layer)?void 0:s.id;return I("div",{class:this.classes("esri-popup",{"esri-popup--aligned-top-center":"top-center"===l,"esri-popup--aligned-bottom-center":"bottom-center"===l,"esri-popup--aligned-top-left":"top-left"===l,"esri-popup--aligned-bottom-left":"bottom-left"===l,"esri-popup--aligned-top-right":"top-right"===l,"esri-popup--aligned-bottom-right":"bottom-right"===l,"esri-popup--is-docked":c&&r,[ps]:c&&!r,"esri-popup--is-docked-top-left":"top-left"===u,"esri-popup--is-docked-top-center":"top-center"===u,"esri-popup--is-docked-top-right":"top-right"===u,"esri-popup--is-docked-bottom-left":"bottom-left"===u,"esri-popup--is-docked-bottom-center":"bottom-center"===u,"esri-popup--is-docked-bottom-right":"bottom-right"===u,"esri-popup--feature-menu-open":o,"esri-popup--actions-menu-open":c&&h.length>1&&n}),role:"presentation","data-layer-title":d,"data-layer-id":p,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},c?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return I("span",{"aria-hidden":"true",class:this.classes(ms,"esri-icon-loading-indicator","esri-rotating")})}renderNavigationLoading(){const{messagesCommon:t}=this;return this.viewModel.pendingPromisesCount?I("div",{key:bs("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":t.loading,title:t.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const t=k(this.container);return I("span",{"aria-hidden":"true",class:this.classes(ms,{"esri-icon-right-triangle-arrow":t,"esri-popup__pagination-previous-icon--rtl":t,"esri-icon-left-triangle-arrow":!t,"esri-popup__pagination-previous-icon":!t})})}renderPreviousButton(){const{messages:t}=this;return I("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(fs,"esri-popup__pagination-previous"),"aria-label":t.previous,title:t.previous},this.renderPreviousIcon())}renderNextIcon(){const t=k(this.container);return I("span",{"aria-hidden":"true",class:this.classes(ms,{"esri-icon-left-triangle-arrow":t,"esri-popup__pagination-next-icon--rtl":t,"esri-icon-right-triangle-arrow":!t,"esri-popup__pagination-next-icon":!t})})}renderNextButton(){const{messages:t}=this;return I("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(fs,"esri-popup__pagination-next"),"aria-label":t.next,title:t.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:t,featureMenuId:e,messagesCommon:i}=this,{featureCount:s,selectedFeatureIndex:n}=this.viewModel;return I("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(fs,"esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":e,"aria-expanded":t.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(s,n))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:t}=this,e=this._wouldDockTo();return I("span",{"aria-hidden":"true",class:this.classes({"esri-icon-minimize":t,"esri-popup__icon--dock-icon":!t,"esri-icon-dock-right":!t&&("top-right"===e||"bottom-right"===e),"esri-icon-dock-left":!t&&("top-left"===e||"bottom-left"===e),"esri-icon-maximize":!t&&"top-center"===e,"esri-icon-dock-bottom":!t&&"bottom-center"===e},ms)})}renderDockButton(){var t,e,i;const{dockEnabled:s,messages:n}=this,r=null==(t=this.viewModel)||null==(e=t.view)?void 0:e.widthBreakpoint,o=s?n.undock:n.dock;return"xsmall"!==r&&null!=(i=this.dockOptions)&&i.buttonEnabled?I("div",{role:"button","aria-label":o,title:o,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(fs,"esri-popup__button--dock")},this.renderDockIcon()):null}renderTitle(){const{title:t}=this.viewModel,{titleId:e,collapsible:i,contentCollapsed:s,messagesCommon:n}=this,r={"esri-popup__header-container--button":i},o=I(wt,{level:this.headingLevel,class:"esri-popup__header-title",innerHTML:t}),a=i?I("button",{key:`${t}--collapsible`,id:e,title:s?n.expand:n.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",r),"aria-expanded":s?"false":"true",onclick:this._toggleCollapsed},o):I("div",{key:t,id:e,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",r)},o);return t?a:null}renderCloseIcon(){return I("span",{"aria-hidden":"true",class:this.classes(ms,"esri-icon-close")})}renderCloseButton(){const{visibleElements:t,messagesCommon:e}=this;return t.closeButton?I("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:fs,"aria-label":e.close,title:e.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return I("header",{class:"esri-popup__header"},this.renderTitle(),I("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:t,hasContent:e,contentCollapsed:i}=this,{content:s}=this.viewModel;return e&&!i?I("article",{key:s,enterAnimation:this._createFeatureUpdatedAnimation(),id:t,class:"esri-popup__content"},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:t,actionsMenuButtonId:e,actionsMenuOpen:i,dividedActions:s,messagesCommon:n}=this,r=i?n.close:n.open,{menuActions:o}=s;return o.length?I("div",{key:bs("actions-menu-button"),class:this.classes(fs,"esri-popup__actions-menu-button"),role:"button",id:e,"aria-haspopup":"true","aria-controls":i?t:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":r,title:r},I("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null}renderMenuActions(){const{actionsMenuId:t,actionsMenuButtonId:e,actionsMenuOpen:i,dividedActions:s}=this,{menuActions:n,inlineActions:r}=s;return n.length&&i?I("ul",{id:t,role:"menu","aria-labelledby":e,key:bs("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},n.toArray().map(((t,e)=>this.renderAction({action:t,index:e+r.length,type:"menu-item"})))):null}renderInlineActions(){const{inlineActions:t}=this.dividedActions;return!!t.length&&t.toArray().map(((t,e)=>this.renderAction({action:t,index:e,type:"inline"})))}renderInlineActionsContainer(){const{inlineActions:t,menuActions:e}=this.dividedActions,i=!!t.length,s=!!e.length;return i||s?I("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":s.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?I("section",{key:bs("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:t,dividedActions:e}=this,{inlineActions:i,menuActions:s}=e,n=!!i.length,r={"esri-popup__footer--has-pagination":t,"esri-popup__footer--has-actions":n,"esri-popup__footer--has-actions-menu":!!s.length};return t||n?I("div",{key:bs("feature-buttons"),class:this.classes("esri-popup__footer",r)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:t}=this,{featureViewModels:e,isLoadingFeature:i}=this.viewModel,s=j(t.selectedFeatures,{total:e.length});return I("section",{key:bs("menu"),class:"esri-popup__feature-menu"},I("strong",{class:"esri-popup__feature-menu-header"},s),I("nav",{bind:this,class:"esri-popup__feature-menu-viewport","data-node-ref":"_featureMenuViewportNode",afterCreate:A},this.renderFeatureMenu(),I("div",{class:"esri-popup__feature-menu-observer",bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?I("div",{class:"esri-popup__feature-menu-loader"},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:I("div",{key:bs("pointer"),class:"esri-popup__pointer",role:"presentation"},I("div",{class:this.classes("esri-popup__pointer-direction",ps)}))}renderMainContainer(){const{dockEnabled:t,currentAlignment:e,currentDockPosition:i,titleId:s,contentId:n,collapsible:r,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:u}=this.viewModel,c="bottom-left"===e||"bottom-center"===e||"bottom-right"===e||"top-left"===i||"top-center"===i||"top-right"===i,h="top-left"===e||"top-center"===e||"top-right"===e||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i;return I("div",{class:this.classes("esri-popup__main-container","esri-widget",{[ps]:t,"esri-popup--is-collapsible":r,"esri-popup--is-collapsed":a}),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":u?s:"","aria-describedby":o&&!a?n:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},c?this.renderFooter():null,c?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null)}renderContent(){var t;const e=null==(t=this.viewModel)?void 0:t.content;return e?"string"==typeof e?I("div",{key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(t){return I("span",{key:"text",class:"esri-popup__action-text"},t)}renderActionIcon(t){const e=this._getActionClass(t),i=this._getActionImage(t),s={"esri-icon-loading-indicator":t.active,"esri-rotating":t.active,[ms]:!!e,"esri-popup__action-image":!t.active&&!!i};return e&&(s[e]=!t.active),I("span",{key:"icon","aria-hidden":"true",class:this.classes(ms,s),styles:this._getIconStyles(i)})}renderAction(t){const{action:e,index:i,type:s}=t,n=this._getActionTitle(e),r={"esri-popup__action":"toggle"!==e.type,"esri-popup__action-toggle":"toggle"===e.type,"esri-popup__action-toggle--on":"toggle"===e.type&&e.value,"esri-popup__button--disabled":e.disabled},o=[this.renderActionIcon(e),this.renderActionText(n)],a="menu-item"===s?I("li",{key:e.uid,role:"menuitem",tabIndex:0,title:n,"aria-label":n,class:this.classes(fs,r),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},o):I("div",{key:e.uid,role:"button",tabIndex:0,title:n,"aria-label":n,class:this.classes(fs,r),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},o);return e.visible?a:null}renderFeatureMenuItem(t,e){const{messages:i,messagesCommon:s}=this,{selectedFeatureIndex:n,selectedFeatureViewModel:r}=this.viewModel,o=t===r,a={"esri-popup__feature-menu-item--selected":o},l=o?I("span",{key:bs(`feature-menu-selected-feature-${n}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:"esri-icon-check-mark"}):null,u=I("span",{innerHTML:t.title||s.untitled});return I("li",{role:"menuitem",tabIndex:-1,key:bs(`feature-menu-feature-${n}`),class:this.classes(a,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":e,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},I("span",{class:"esri-popup__feature-menu-title"},u,l))}renderFeatureMenu(){const{featureMenuId:t}=this,{featureViewModels:e}=this.viewModel;return e.length>1?I("ol",{class:"esri-popup__feature-menu-list",id:t,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},e.filter((t=>!!t.graphic)).map(((t,e)=>this.renderFeatureMenuItem(t,e)))):null}_getActionTitle(t){const{messages:e,selectedFeature:i,messagesCommon:s}=this,{id:n}=t,r=null==i?void 0:i.attributes,o="zoom-to-feature"===n?j(t.title,{messages:e}):"remove-selected-feature"===n?j(t.title,{messages:s}):"zoom-to-clustered-features"===n||"browse-clustered-features"===n?j(t.title,{messages:e}):t.title;return o&&r?j(o,r):o}_getActionClass(t){const{selectedFeature:e}=this,i=null==e?void 0:e.attributes,{className:s,image:n}=t,r=n||s?s:"esri-icon-default-action";return r&&i?j(r,i):r}_getActionImage(t){const{selectedFeature:e}=this,i=null==e?void 0:e.attributes,{image:s}=t;return s&&i?j(s,i):s}_createFeatureUpdatedAnimation(){return H("enter","esri-popup--feature-updated")}_getInlineActionCount(){const{maxInlineActions:t,featureNavigationVisible:e}=this;if("number"!=typeof t)return null;const i=Math.round(t);return Math.max(e?i-1:i,0)}_watchActions(){const{allActions:t}=this.viewModel;this.notifyChange("dividedActions");const e="actions";this._handles.remove(e),t&&t.forEach((t=>{this._handles.add(N(t,["active","className","disabled","id","title","image","visible"],(()=>this.scheduleRender())),e)}))}_divideActions(){const{allActions:t}=this.viewModel,e=this._getInlineActionCount(),i=null===e,s=0===e;return{inlineActions:i?t.slice(0):s?new a:t.slice(0,e),menuActions:i?new a:t.slice(s?0:e)}}_featureMenuOpenChanged(t){t?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(t){t?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:t,messagesCommon:e}=this;var i,s;t&&(this.viewModel.title="error"===(null==(i=t.viewModel)?void 0:i.state)?e.errorMessage:(null==(s=t.viewModel)?void 0:s.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:t}=this;t&&(this.viewModel.content=t)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(t){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(t),this._featureMenuIntersectionObserverNode=t}_handleFeatureMenuKeyup(t){"Escape"===P(t)&&(t.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(t){"Escape"===P(t)&&(t.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_handleFeatureMenuItemKeyup(t){const e=P(t),{_featureMenuNode:i}=this,s=t.currentTarget["data-feature-index"];if(!i)return;const n=i.querySelectorAll("li"),r=n.length;"ArrowUp"!==e?"ArrowDown"!==e?"Home"!==e?"End"!==e||(t.stopPropagation(),n[n.length-1].focus()):(t.stopPropagation(),n[0].focus()):(t.stopPropagation(),n[(s+1+r)%r].focus()):(t.stopPropagation(),n[(s-1+r)%r].focus())}_handleActionMenuItemKeyup(t){const e=P(t),{_actionsMenuNode:i}=this,s=t.currentTarget["data-action-index"];if(!i)return;const n=i.querySelectorAll("li"),r=n.length;"ArrowUp"!==e?"ArrowDown"!==e?"Home"!==e?"End"!==e||(t.stopPropagation(),n[n.length-1].focus()):(t.stopPropagation(),n[0].focus()):(t.stopPropagation(),n[(s+1+r)%r].focus()):(t.stopPropagation(),n[(s-1+r)%r].focus())}_handleMainKeyup(t){const e=P(t);"ArrowLeft"===e&&(t.stopPropagation(),this.previous()),"ArrowRight"===e&&(t.stopPropagation(),this.next())}_spinnerEnabledChange(t){if(this._destroySpinner(),!t)return;const e=this.get("viewModel.view");this._createSpinner(e)}_hideSpinner(){const{_spinner:t}=this;t&&(t.location=null,t.hide())}_displaySpinner(){const{_spinner:t}=this;if(!t)return;const{location:e,waitingForResult:i}=this.viewModel;i?t.show({location:e}):t.hide()}_getIconStyles(t){return{"background-image":t?`url(${t})`:""}}_addSelectedFeatureIndexHandle(){const t=N(this,"viewModel.selectedFeatureIndex",((t,e)=>this._selectedFeatureIndexUpdated(t,e)));this._handles.add(t,hs)}_selectedFeatureIndexUpdated(t,e){const{featureCount:i}=this;i&&t!==e&&-1!==t&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:t}=this;t&&(t.viewModel=null,t&&!t.destroyed&&t.destroy()),this._feature=null}_isScreenLocationWithinView(t,e){return t.x>-1&&t.y>-1&&t.x<=e.width&&t.y<=e.height}_isOutsideView(t){const{popupHeight:e,popupWidth:i,screenLocation:s,side:n,view:r}=t;if(isNaN(i)||isNaN(e)||!r||!s)return!1;const o=r.padding;return"right"===n&&s.x+i/2>r.width-o.right||"left"===n&&s.x-i/2<o.left||"top"===n&&s.y-e<o.top||"bottom"===n&&s.y+e>r.height-o.bottom}_calculateAutoAlignment(t){if("auto"!==t)return t;const{_pointerOffsetInPx:i,_containerNode:s,_mainContainerNode:n,viewModel:r}=this,{screenLocation:o,view:a}=r;if(e(o)||!a||!s)return"top-center";if(!this._isScreenLocationWithinView(o,a))return this._get("currentAlignment")||"top-center";function l(t){return parseInt(t.replace(/[^-\d\.]/g,""),10)}const u=n?window.getComputedStyle(n,null):null,c=u?l(u.getPropertyValue("max-height")):0,h=u?l(u.getPropertyValue("height")):0,{height:d,width:p}=s.getBoundingClientRect(),f=p+i,m=Math.max(d,c,h)+i,v=this._isOutsideView({popupHeight:m,popupWidth:f,screenLocation:o,side:"right",view:a}),g=this._isOutsideView({popupHeight:m,popupWidth:f,screenLocation:o,side:"left",view:a}),b=this._isOutsideView({popupHeight:m,popupWidth:f,screenLocation:o,side:"top",view:a}),w=this._isOutsideView({popupHeight:m,popupWidth:f,screenLocation:o,side:"bottom",view:a});return g?b?"bottom-right":"top-right":v?b?"bottom-left":"top-left":b?w?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(t){return"function"==typeof t?t.call(this):t}_getCurrentAlignment(){const{alignment:t,dockEnabled:e}=this;return e||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(t)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(t){const e=["left","right"];return k(this.container)&&e.reverse(),t.replace(/leading/gi,e[0]).replace(/trailing/gi,e[1])}_callDockPosition(t){return"function"==typeof t?t.call(this):t}_getDockPosition(){var t;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(t=this.dockOptions)?void 0:t.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(t){var e;if("auto"!==t)return t;const i=null==(e=this.viewModel)?void 0:e.view,s=k(this.container)?"top-left":"top-right";if(!i)return s;const n=i.padding||{left:0,right:0,top:0,bottom:0},r=i.width-n.left-n.right,{breakpoints:o}=i;return o&&r<=o.xsmall?"bottom-center":s}_positionContainer(t=this._containerNode){if(t&&(this._containerNode=t),!t)return;const{screenLocation:e}=this.viewModel,{width:i}=t.getBoundingClientRect(),s=this._calculatePositionStyle(e,i);s&&(t.style.top=s.top,t.style.left=s.left,t.style.bottom=s.bottom,t.style.right=s.right)}_calculateFullWidth(t){const{currentAlignment:e,_pointerOffsetInPx:i}=this;return"top-left"===e||"bottom-left"===e||"top-right"===e||"bottom-right"===e?t+i:t}_calculateAlignmentPosition(t,e,i,s){const{currentAlignment:n,_pointerOffsetInPx:r}=this,o=s/2,a=i.height-e,l=i.width-t,{padding:u}=this.view;return"bottom-center"===n?{top:e+r-u.top,left:t-o-u.left}:"top-left"===n?{bottom:a+r-u.bottom,right:l+r-u.right}:"bottom-left"===n?{top:e+r-u.top,right:l+r-u.right}:"top-right"===n?{bottom:a+r-u.bottom,left:t+r-u.left}:"bottom-right"===n?{top:e+r-u.top,left:t+r-u.left}:"top-center"===n?{bottom:a+r-u.bottom,left:t-o-u.left}:void 0}_calculatePositionStyle(t,i){const{dockEnabled:s,view:n}=this;if(!n)return;if(s)return{left:"",top:"",right:"",bottom:""};if(e(t)||!i)return;const r=this._calculateFullWidth(i),o=this._calculateAlignmentPosition(t.x,t.y,n,r);return o?{top:void 0!==o.top?`${o.top}px`:"auto",left:void 0!==o.left?`${o.left}px`:"auto",bottom:void 0!==o.bottom?`${o.bottom}px`:"auto",right:void 0!==o.right?`${o.right}px`:"auto"}:void 0}_viewChange(t,e){t&&e&&(this.close(),this.clear())}_viewReadyChange(t,e){if(t){const t=this.get("viewModel.view");this._wireUpView(t)}else e&&(this.close(),this.clear())}_wireUpView(t){if(this._destroySpinner(),!t)return;const{spinnerEnabled:e}=this;e&&this._createSpinner(t),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(t,e,i){const[s,n]=t,[r,o]=e,{width:a,height:l}=i;return s<=a&&r>a||s>a&&r<=a||n<=l&&o>l||n>l&&o<=l}_updateDockEnabledForViewSize(t,e){if(!t||!e)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},s=i.left+i.right,n=i.top+i.bottom,r=[],o=[];r[0]=t[0]-s,r[1]=t[1]-n,o[0]=e[0]-s,o[1]=e[1]-n;const{dockOptions:a}=this;this._dockingThresholdCrossed(r,o,a.breakpoint)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(t){this._focusDockButton&&(this._focusDockButton=!1,t.focus())}_closeButtonNodeUpdated(t){return this._focusClose?(this._focusClose=!1,void t.focus()):this._blurClose?(this._blurClose=!1,void t.blur()):void 0}_mainContainerNodeUpdated(t){return this._mainContainerNode=t,this._focusContainer?(this._focusContainer=!1,void t.focus()):this._blurContainer?(this._blurContainer=!1,void t.blur()):void 0}_featureMenuNodeUpdated(t){if(this._featureMenuNode=t,!t||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const e=t.querySelectorAll("li");e.length&&e[0].focus()}_actionsMenuNodeUpdated(t){if(this._actionsMenuNode=t,!t||!this._focusFirstAction)return;this._focusFirstAction=!1;const e=t.querySelectorAll("li");e.length&&e[0].focus()}_focusFeatureMenuButtonNode(t){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,t.focus())}_focusActionsMenuButtonNode(t){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,t.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:t,viewModel:e}=this;e&&(e.screenLocationEnabled=e.active&&!t)}_shouldDockAtCurrentViewSize(t){var e,i;const s=t.breakpoint,n=null==(e=this.viewModel)||null==(i=e.view)?void 0:i.ui;if(!n)return!1;const{width:r,height:o}=n;if(isNaN(r)||isNaN(o))return!1;const a=s.hasOwnProperty("width")&&r<=s.width,l=s.hasOwnProperty("height")&&o<=s.height;return a||l}_setDockEnabledForViewSize(t){t.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(t))}_getPageText(t,e){return this.featureNavigationVisible?j(this.messages.pageText,{index:e+1,total:t}):null}_destroySpinner(){const{_spinner:t,view:e}=this;t&&(e&&e.ui&&e.ui.remove(this._spinner,ds),t.destroy(),this._spinner=null)}_createSpinner(t){t&&(this._spinner=new Ni({view:t}),t.ui.add(this._spinner,{key:ds,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const t=!this.featureMenuOpen;this._featureMenuOpenChanged(t),this.actionsMenuOpen=!1,this.featureMenuOpen=t}_toggleActionsMenu(){const t=!this.actionsMenuOpen;this._actionsMenuOpenChanged(t),this.featureMenuOpen=!1,this.actionsMenuOpen=t}_triggerAction(t){const e=t.currentTarget["data-action-index"],i=this.viewModel.allActions.getItemAt(e);i&&"toggle"===i.type&&(i.value=!i.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(e)}_selectFeature(t){const e=t.currentTarget["data-feature-index"];isNaN(e)||(this.viewModel.selectedFeatureIndex=e),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};s([n({readOnly:!0})],Ms.prototype,"actionsMenuId",null),s([n({readOnly:!0})],Ms.prototype,"actionsMenuButtonId",null),s([n({readOnly:!0})],Ms.prototype,"featureMenuId",null),s([n({readOnly:!0})],Ms.prototype,"titleId",null),s([n({readOnly:!0})],Ms.prototype,"contentId",null),s([n({readOnly:!0})],Ms.prototype,"hasContent",null),s([n({readOnly:!0})],Ms.prototype,"featureNavigationVisible",null),s([n({readOnly:!0})],Ms.prototype,"collapsible",null),s([n({readOnly:!0})],Ms.prototype,"featureMenuVisible",null),s([n({readOnly:!0})],Ms.prototype,"contentCollapsed",null),s([n({readOnly:!0})],Ms.prototype,"dividedActions",null),s([w("viewModel.actions")],Ms.prototype,"actions",void 0),s([n()],Ms.prototype,"actionsMenuOpen",null),s([n()],Ms.prototype,"alignment",void 0),s([w("viewModel.autoCloseEnabled")],Ms.prototype,"autoCloseEnabled",void 0),s([w("viewModel.autoOpenEnabled")],Ms.prototype,"autoOpenEnabled",void 0),s([w("viewModel.defaultPopupTemplateEnabled")],Ms.prototype,"defaultPopupTemplateEnabled",void 0),s([w("viewModel.content")],Ms.prototype,"content",void 0),s([n()],Ms.prototype,"collapsed",void 0),s([n()],Ms.prototype,"collapseEnabled",void 0),s([n({readOnly:!0})],Ms.prototype,"currentAlignment",null),s([n({readOnly:!0})],Ms.prototype,"currentDockPosition",null),s([n()],Ms.prototype,"dockOptions",null),s([n()],Ms.prototype,"dockEnabled",void 0),s([w("viewModel.featureCount")],Ms.prototype,"featureCount",void 0),s([n()],Ms.prototype,"featureMenuOpen",void 0),s([w("viewModel.features")],Ms.prototype,"features",void 0),s([w("viewModel.goToOverride")],Ms.prototype,"goToOverride",void 0),s([n()],Ms.prototype,"headingLevel",void 0),s([w("viewModel.highlightEnabled")],Ms.prototype,"highlightEnabled",void 0),s([w("viewModel.location")],Ms.prototype,"location",void 0),s([n({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ms.prototype,"label",void 0),s([n()],Ms.prototype,"maxInlineActions",void 0),s([n(),y("esri/widgets/Popup/t9n/Popup")],Ms.prototype,"messages",void 0),s([n(),y("esri/t9n/common")],Ms.prototype,"messagesCommon",void 0),s([w("viewModel.promises")],Ms.prototype,"promises",void 0),s([w("viewModel.selectedFeature")],Ms.prototype,"selectedFeature",void 0),s([w("viewModel.selectedFeatureIndex")],Ms.prototype,"selectedFeatureIndex",void 0),s([n({readOnly:!0})],Ms.prototype,"selectedFeatureWidget",null),s([n()],Ms.prototype,"spinnerEnabled",void 0),s([w("viewModel.title")],Ms.prototype,"title",void 0),s([w("viewModel.updateLocationEnabled")],Ms.prototype,"updateLocationEnabled",void 0),s([w("viewModel.view")],Ms.prototype,"view",void 0),s([n({type:cs}),jt(["triggerAction","trigger-action"])],Ms.prototype,"viewModel",void 0),s([w("viewModel.visible")],Ms.prototype,"visible",void 0),s([n()],Ms.prototype,"visibleElements",void 0),s([m("visibleElements")],Ms.prototype,"castVisibleElements",null),s([Lt()],Ms.prototype,"_close",null),s([Lt()],Ms.prototype,"_toggleDockEnabled",null),s([Lt()],Ms.prototype,"_toggleFeatureMenu",null),s([Lt()],Ms.prototype,"_toggleActionsMenu",null),s([Lt()],Ms.prototype,"_triggerAction",null),s([Lt()],Ms.prototype,"_selectFeature",null),s([Lt()],Ms.prototype,"_next",null),s([Lt()],Ms.prototype,"_previous",null),Ms=s([r(ws)],Ms);const Is=Ms,As=[0,0];function Fs(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return As[0]=i.left+e.pageXOffset,As[1]=i.top+e.pageYOffset,As}function ks(t){t&&(K(t),t.parentNode&&t.parentNode.removeChild(t))}const xs=750,Cs=t=>{let e=class extends t{constructor(...t){super(...t),this._freqInfo={freq:16,time:xs},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([this.watch("cursor",(t=>{const e=this.surface;e&&e.setAttribute("data-cursor",t)})),this.watch("interacting",(t=>{const e=this.surface;e&&e.setAttribute("data-interacting",t.toString())}))])}initialize(){this.handles.add(this.watch("ui",((t,e)=>this._handleUIChange(t,e)))),this._wireUI(this.ui),this.handles.add([this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(t){const e=this._get("container");if(e===t)return;const i="dom-size";if(this.handles.remove(i),this._stopMeasuring(),e&&(e.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),ks(this.root),this._set("root",null),W(this.userContent,e),ks(this.userContent),this._set("userContent",null)),t){t.classList.add("esri-view");const e=document.createElement("div");e.className="esri-view-user-storage",W(t,e),t.appendChild(e),this._set("userContent",e);const s=document.createElement("div");s.className="esri-view-root",t.insertBefore(s,t.firstChild),this._set("root",s);const n=document.createElement("div");n.className="esri-view-surface",n.setAttribute("role","application"),n.tabIndex=0,s.appendChild(n),this._set("surface",n);const r=new qt;s.appendChild(r.surface),this._set("overlay",r),r.watch("needsRender",(t=>{t&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=G({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)})),this.forceDOMReadyCycle(),this.handles.add(v(this,"size",(t=>{const[e,i]=t,s="esri-view-surface--inset-outline";e>=document.body.clientWidth||i>=document.body.clientHeight?n.classList.add(s):n.classList.remove(s)})),i),this._set("container",t),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const t=document.activeElement===this.surface;return document.hasFocus()&&t}get popup(){return this._get("popup")||new Is({view:this})}set popup(t){const e=this._get("popup");e&&e!==t&&e.destroy(),this._set("popup",t)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(t,e,i){const s=this.position;return t-=s[0],e-=s[1],i?(i[0]=t,i[1]=e):i=[t,e],i}containerToPage(t,e,i){const s=this.position;return t+=s[0],e+=s[1],i?(i[0]=t,i[1]=e):i=[t,e],i}_handleUIChange(t,e){e&&(this.handles.remove("ui"),e.destroy()),t&&this._wireUI(t),this._set("ui",t)}_wireUI(t){this.handles.remove("ui"),t&&(t.view=this,this.handles.add([v(this,"root",(e=>{t.container=e?function(t){const e=document.createElement("div");return t.appendChild(e),e}(e):null})),v(this,"popup",((e,i)=>{const s="popup";i&&t.remove(i,s),e&&(e.view=t.view,t.add(e,{key:s,position:"manual"}))}))],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const t=this._freqInfo;t.freq=16,t.time=xs,this.handles.add([(()=>{const e=()=>{t.freq=16,t.time=xs};return window.addEventListener("resize",e),{remove(){window.removeEventListener("resize",e)}}})(),G({prepare:t=>{const e=this._measure(),i=this._freqInfo;if(i.time+=t.deltaTime,e&&(i.freq=16,this._get("resizing")||this._set("resizing",!0)),i.time<i.freq)return;i.time=0;const s=this._position();i.freq=s||e?16:Math.min(xs,2*i.freq),!e&&i.freq>=512&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const t=this.container,e=t?t.clientWidth:0,i=t?t.clientHeight:0;if(0===e||0===i)return this.suspended||this._set("suspended",!0),!1;const s=this.width,n=this.height;return e===s&&i===n?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",e),this._set("height",i),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:n,width:e,height:i}),!0)}_position(){const t=this.position,e=Fs(this.container);return!(t&&e[0]===t[0]&&e[1]===t[1]||(this._set("position",[e[0],e[1]]),0))}forceDOMReadyCycle(){}};return s([n({value:null,cast:t=>q(t)})],e.prototype,"container",null),s([n({readOnly:!0})],e.prototype,"focused",null),s([n({readOnly:!0})],e.prototype,"height",void 0),s([n({type:Is})],e.prototype,"popup",null),s([n({type:qt})],e.prototype,"overlay",void 0),s([n({readOnly:!0})],e.prototype,"position",void 0),s([n({readOnly:!0})],e.prototype,"resizing",void 0),s([n({readOnly:!0})],e.prototype,"root",void 0),s([n({value:null,readOnly:!0})],e.prototype,"size",null),s([n({readOnly:!0})],e.prototype,"surface",void 0),s([n({readOnly:!0})],e.prototype,"suspended",void 0),s([n()],e.prototype,"ui",void 0),s([n({readOnly:!0})],e.prototype,"userContent",void 0),s([n({readOnly:!0})],e.prototype,"width",void 0),s([n()],e.prototype,"widthBreakpoint",void 0),e=s([r("esri.views.DOMContainer")],e),e};function Ts(t){return t&&"focus"in t}function Es(t){return zt(t.x,t.y)}function Ps(t,e){const i=(t instanceof HTMLElement?t:t.surface).getBoundingClientRect();return zt(e.clientX-i.left,e.clientY-i.top)}function $s(t,e){return e instanceof Event?Ps(t,e):Es(e)}function Os(t){if(t instanceof Event)return!0;if("object"==typeof t&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}export{ze as A,Yt as F,Cs as _,Os as a,Si as b,$s as c,Qi as d,ji as e,Bt as f,Ts as g,Dt as h,Hi as i,Se as j,Wt as k,Gt as l,Ni as m,Ps as n,Zt as o,St as p,Xt as q,Kt as r,Qt as s,Es as t,Yi as u,Vt as y}