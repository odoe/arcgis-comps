import{z as e,$ as n,s as t,c as r,U as l,V as a,a as o,d as i,Z as s,A as u,e as f,J as c,aj as m,ak as d,a4 as E,al as p}from"./p-082c34d3.js";import{D as w,q as y,r as N,P as I,G as $,y as g,_ as D,e as b,a as A,b as h,g as x,w as L,T as O,j as S,c as T,C as F,v as P,E as M,d as v}from"./p-a332e4c0.js";import{c as G,E as j}from"./p-ba99496d.js";import{fy as B,fw as C,aR as H,d1 as R}from"./p-5420851c.js";import{WhereClause as V}from"./p-c0f8009d.js";import"./p-a184d75f.js";import"./p-a96c61aa.js";import"./p-dcac8868.js";import"./p-c3fd4463.js";import"./p-e991a11e.js";import"./p-18b587e8.js";import"./p-53bb6ab4.js";function k(e,n,t){const r=e.getVariables();if(r.length>0){const l=[];for(let e=0;e<r.length;e++)l.push(n.evaluateIdentifier(t,{name:r[e]}));return B(l).then((n=>{const t={};for(let e=0;e<r.length;e++)t[r[e]]=n[e];return e.parameters=t,e}))}return C(e)}function z(e,n,t=null){for(const t in e)if(t.toLowerCase()===n.toLowerCase())return e[t];return t}function W(e){if(null===e)return null;const n={type:z(e,"type",""),name:z(e,"name","")};if("range"===n.type)n.range=z(e,"range",[]);else{n.codedValues=[];for(const t of z(e,"codedValues",[]))n.codedValues.push({name:z(t,"name",""),code:z(t,"code",null)})}return n}function J(e){if(null===e)return null;const n={},t=z(e,"wkt",null);null!==t&&(n.wkt=t);const r=z(e,"wkid",null);return null!==r&&(n.wkid=r),n}function _(e){if(null===e)return null;const n={hasZ:z(e,"hasz",!1),hasM:z(e,"hasm",!1)},t=z(e,"spatialreference",null);t&&(n.spatialReference=J(t));const r=z(e,"x",null);if(null!==r)return n.x=r,n.y=z(e,"y",null),n;const l=z(e,"rings",null);if(null!==l)return n.rings=l,n;const a=z(e,"paths",null);if(null!==a)return n.paths=a,n;const o=z(e,"points",null);if(null!==o)return n.points=o,n;for(const t of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const r=z(e,t,null);null!==r&&(n[t]=r)}return n}function q(q){"async"===q.mode&&(q.functions.getuser=function(l,o){return q.standardFunctionAsync(l,o,((o,i,s)=>{e(s,1,2);let f=a(s[1],""),c=!0===f;if(f=!0===f||!1===f?"":n(f),s[0]instanceof t){let e=null;return l.services&&l.services.portal&&(e=l.services.portal),e=w(s[0],e),y(e,f,c).then((e=>{if(e){const n=JSON.parse(JSON.stringify(e));for(const e of["lastLogin","created","modified"])null!=n[e]&&(n[e]=new Date(n[e]));return r.convertObjectToArcadeDictionary(n)}return null}))}let m=null;if(u(s[0])&&(m=s[0]),m)return c=!1,f?null:m.load().then((()=>m.getOwningSystemUrl())).then((e=>{if(!e)return f?null:m.getIdentityUser().then((e=>e?r.convertObjectToArcadeDictionary({username:e}):null));let n=null;return l.services&&l.services.portal&&(n=l.services.portal),n=w(new t(e),n),y(n,f,c).then((e=>{if(e){const n=JSON.parse(JSON.stringify(e));for(const e of["lastLogin","created","modified"])null!=n[e]&&(n[e]=new Date(n[e]));return r.convertObjectToArcadeDictionary(n)}return null}))}));throw new Error("Invalid Parameter")}))},q.signatures.push({name:"getuser",min:"1",max:"2"}),q.functions.featuresetbyid=function(t,r){return q.standardFunctionAsync(t,r,((t,r,i)=>{if(e(i,2,4),i[0]instanceof N){const e=n(i[1]);let t=a(i[2],null);const r=l(a(i[3],!0));if(null===t&&(t=["*"]),!1===o(t))throw new Error("Invalid Parameter");return i[0].featureSetById(e,r,t)}throw new Error("Invalid Parameter")}))},q.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),q.functions.getfeatureset=function(t,r){return q.standardFunctionAsync(t,r,((r,l,o)=>{if(e(o,1,2),o[0]instanceof i){let e=a(o[1],"datasource");return null===e&&(e="datasource"),e=n(e).toLowerCase(),I(o[0]._layer,e,t.lrucache,t.interceptor,t.spatialReference)}throw new Error("Invalid Parameter")}))},q.signatures.push({name:"getfeatureset",min:"1",max:"2"}),q.functions.featuresetbyportalitem=function(r,i){return q.standardFunctionAsync(r,i,((i,u,f)=>{if(e(f,2,5),null===f[0])throw new Error("Portal is required");if(f[0]instanceof t){const e=n(f[1]),t=n(f[2]);let i=a(f[3],null);const s=l(a(f[4],!0));if(null===i&&(i=["*"]),!1===o(i))throw new Error("Invalid Parameter");let u=null;return r.services&&r.services.portal&&(u=r.services.portal),u=w(f[0],u),$(e,t,r.spatialReference,i,s,u,r.lrucache,r.interceptor)}if(!1===s(f[0]))throw new Error("Portal is required");const c=n(f[0]),m=n(f[1]);let d=a(f[2],null);const E=l(a(f[3],!0));if(null===d&&(d=["*"]),!1===o(d))throw new Error("Invalid Parameter");if(r.services&&r.services.portal)return $(c,m,r.spatialReference,d,E,r.services.portal,r.lrucache,r.interceptor);throw new Error("Portal is required")}))},q.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),q.functions.featuresetbyname=function(t,r){return q.standardFunctionAsync(t,r,((t,r,i)=>{if(e(i,2,4),i[0]instanceof N){const e=n(i[1]);let t=a(i[2],null);const r=l(a(i[3],!0));if(null===t&&(t=["*"]),!1===o(t))throw new Error("Invalid Parameter");return i[0].featureSetByName(e,r,t)}throw new Error("Invalid Parameter")}))},q.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),q.functions.featureset=function(n,t){return q.standardFunction(n,t,((t,l,a)=>{e(a,1,1);let i=a[0];const u={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(s(i))i=JSON.parse(i),void 0!==i.layerDefinition?(u.layerDefinition=i.layerDefinition,u.featureSet=i.featureSet,i.layerDefinition.spatialReference&&(u.layerDefinition.spatialReference=i.layerDefinition.spatialReference)):(u.featureSet.features=i.features,u.featureSet.geometryType=i.geometryType,u.layerDefinition.geometryType=u.featureSet.geometryType,u.layerDefinition.objectIdField=i.objectIdFieldName,u.layerDefinition.typeIdField=i.typeIdFieldName,u.layerDefinition.globalIdField=i.globalIdFieldName,u.layerDefinition.fields=i.fields,i.spatialReference&&(u.layerDefinition.spatialReference=i.spatialReference));else{if(!(a[0]instanceof r))throw new Error("Invalid Parameter");{i=JSON.parse(a[0].castToText());const e=z(i,"layerdefinition");if(null!==e){u.layerDefinition.geometryType=z(e,"geometrytype",""),u.featureSet.geometryType=u.layerDefinition.geometryType,u.layerDefinition.globalIdField=z(e,"globalidfield",""),u.layerDefinition.objectIdField=z(e,"objectidfield",""),u.layerDefinition.typeIdField=z(e,"typeidfield","");const n=z(e,"spatialreference",null);n&&(u.layerDefinition.spatialReference=J(n));for(const n of z(e,"fields",[])){const e={name:z(n,"name",""),alias:z(n,"alias",""),type:z(n,"type",""),nullable:z(n,"nullable",!0),editable:z(n,"editable",!0),length:z(n,"length",null),domain:W(z(n,"domain"))};u.layerDefinition.fields.push(e)}const t=z(i,"featureset",null);if(t){const e={};for(const n of u.layerDefinition.fields)e[n.name.toLowerCase()]=n.name;for(const n of z(t,"features",[])){const t={},r=z(n,"attributes",{});for(const n in r)t[e[n.toLowerCase()]]=r[n];u.featureSet.features.push({attributes:t,geometry:_(z(n,"geometry",null))})}}}else{u.layerDefinition.geometryType=z(i,"geometrytype",""),u.featureSet.geometryType=u.layerDefinition.geometryType,u.layerDefinition.objectIdField=z(i,"objectidfieldname",""),u.layerDefinition.typeIdField=z(i,"typeidfieldname","");const e=z(i,"spatialreference",null);e&&(u.layerDefinition.spatialReference=J(e));for(const e of z(i,"fields",[])){const n={name:z(e,"name",""),alias:z(e,"alias",""),type:z(e,"type",""),nullable:z(e,"nullable",!0),editable:z(e,"editable",!0),length:z(e,"length",null),domain:W(z(e,"domain"))};u.layerDefinition.fields.push(n)}const n={};for(const e of u.layerDefinition.fields)n[e.name.toLowerCase()]=e.name;for(const e of z(i,"features",[])){const t={},r=z(e,"attributes",{});for(const e in r)t[n[e.toLowerCase()]]=r[e];u.featureSet.features.push({attributes:t,geometry:_(z(e,"geometry",null))})}}}}if(!1===function(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==function(e){for(const n of["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])if(n===e)return!0;return!1}(e.layerDefinition.geometryType)&&null!==e.layerDefinition.objectIdField&&""!==e.layerDefinition.objectIdField&&!1!==o(e.layerDefinition.fields)&&!1!==o(e.featureSet.features)}(u))throw new Error("Invalid Parameter");return g.create(u,n.spatialReference)}))},q.signatures.push({name:"featureset",min:"1",max:"1"}),q.functions.filter=function(n,t){return q.standardFunctionAsync(n,t,((t,r,l)=>(e(l,2,2),u(l[0])?l[0].load().then((e=>{const t=V.create(l[1],e.getFieldsIndex()),r=t.getVariables();if(r.length>0){const e=[];for(let t=0;t<r.length;t++)e.push(q.evaluateIdentifier(n,{name:r[t]}));return B(e).then((e=>{const n={};for(let t=0;t<r.length;t++)n[r[t]]=e[t];return t.parameters=n,new D({parentfeatureset:l[0],whereclause:t})}))}return C(new D({parentfeatureset:l[0],whereclause:t}))})):q.failDefferred("Filter cannot accept this parameter type"))))},q.signatures.push({name:"filter",min:"2",max:"2"}),q.functions.orderby=function(n,t){return q.standardFunctionAsync(n,t,((n,t,r)=>{if(e(r,2,2),u(r[0])){const e=new b(r[1]);return C(new A({parentfeatureset:r[0],orderbyclause:e}))}return q.failDefferred("Order cannot accept this parameter type")}))},q.signatures.push({name:"orderby",min:"2",max:"2"}),q.functions.top=function(n,t){return q.standardFunctionAsync(n,t,((n,t,r)=>(e(r,2,2),u(r[0])?C(new h({parentfeatureset:r[0],topnum:r[1]})):o(r[0])?f(r[1])>=r[0].length?r[0].slice(0):r[0].slice(0,f(r[1])):c(r[0])?f(r[1])>=r[0].length()?r[0].slice(0):r[0].slice(0,f(r[1])):q.failDefferred("Top cannot accept this parameter type"))))},q.signatures.push({name:"top",min:"2",max:"2"}),q.functions.first=function(n,t){return q.standardFunctionAsync(n,t,((n,t,r)=>(e(r,1,1),u(r[0])?r[0].first(n.abortSignal).then((e=>{if(null!==e){const n=i.createFromGraphicLikeObject(e.geometry,e.attributes,r[0]);n._underlyingGraphic=e,e=n}return e})):o(r[0])?C(0===r[0].length?null:r[0][0]):c(r[0])?0===r[0].length()?C(null):C(r[0].get(0)):null)))},q.signatures.push({name:"first",min:"1",max:"1"}),q.functions.attachments=function(n,t){return q.standardFunctionAsync(n,t,((t,a,o)=>{e(o,1,2);const s={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(o.length>1)if(o[1]instanceof r){if(o[1].hasField("minsize")&&(s.minsize=f(o[1].field("minsize"))),o[1].hasField("metadata")&&(s.returnMetadata=l(o[1].field("metadata"))),o[1].hasField("maxsize")&&(s.maxsize=f(o[1].field("maxsize"))),o[1].hasField("types")){const e=m(o[1].field("types"),!1);e.length>0&&(s.types=e)}}else if(null!==o[1])throw new Error("Invalid Parameter");if(o[0]instanceof i){let e=o[0]._layer;return e instanceof H&&(e=x(e,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===e||!1===u(e)?[]:e.load().then((()=>e.queryAttachments(o[0].field(e.objectIdField),s.minsize,s.maxsize,s.types,s.returnMetadata)))}if(null===o[0])return[];throw new Error("Invalid Parameter")}))},q.signatures.push({name:"attachments",min:"1",max:"2"}),q.functions.featuresetbyrelationshipname=function(t,r){return q.standardFunctionAsync(t,r,((r,s,f)=>{e(f,2,4);const c=f[0],m=n(f[1]);let d=a(f[2],null);const E=l(a(f[3],!0));if(null===d&&(d=["*"]),!1===o(d))throw new Error("Invalid Parameter");if(null===f[0])return null;if(!(f[0]instanceof i))throw new Error("Invalid Parameter");let p=c._layer;return p instanceof H&&(p=x(p,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===p||!1===u(p)?null:p.load().then((e=>{const n=e.relationshipMetaData().filter((e=>e.name===m));if(0===n.length)return null;if(null!=n[0].relationshipTableId&&n[0].relationshipTableId>-1)return L(e,n[0],c.field(e.objectIdField),e.spatialReference,d,E,t.lrucache,t.interceptor);let r=e.serviceUrl();return r?(r="/"===r.charAt(r.length-1)?r+n[0].relatedTableId.toString():r+"/"+n[0].relatedTableId.toString(),O(r,e.spatialReference,d,E,t.lrucache,t.interceptor).then((t=>t.load().then((()=>t.relationshipMetaData())).then((r=>{if(r=r.filter((e=>e.id===n[0].id)),!1===c.hasField(n[0].keyField)||null===c.field(n[0].keyField))return e.getFeatureByObjectId(c.field(e.objectIdField),[n[0].keyField]).then((e=>{if(e){const l=V.create(r[0].keyField+"= @id",t.getFieldsIndex());return l.parameters={id:e.attributes[n[0].keyField]},t.filter(l)}return new G({parentfeatureset:t})}));const l=V.create(r[0].keyField+"= @id",t.getFieldsIndex());return l.parameters={id:c.field(n[0].keyField)},t.filter(l)}))))):null}))}))},q.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),q.functions.featuresetbyassociation=function(t,r){return q.standardFunctionAsync(t,r,((r,l,o)=>{e(o,2,3);const f=o[0],c=n(a(o[1],"")).toLowerCase(),m=s(o[2])?n(o[2]):null;if(null===o[0])return null;if(!(o[0]instanceof i))throw new Error("Invalid Parameter");let p=f._layer;return p instanceof H&&(p=x(p,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===p||!1===u(p)?null:p.load().then((()=>{const e=p.serviceUrl();return S(e,t.spatialReference)})).then((e=>{let n=null,t=null,r=!1;if(null!==m&&""!==m&&void 0!==m){for(const n of e.terminals)n.terminalName===m&&(t=n.terminalId);null===t&&(r=!0)}const l=e.associations.getFieldsIndex(),a=l.get("TOGLOBALID").name,o=l.get("FROMGLOBALID").name,i=l.get("TOTERMINALID").name,s=l.get("FROMTERMINALID").name,u=l.get("FROMNETWORKSOURCEID").name,w=l.get("TONETWORKSOURCEID").name,y=l.get("ASSOCIATIONTYPE").name,N=l.get("ISCONTENTVISIBLE").name,I=l.get("OBJECTID").name;for(const e of p.fields)if("global-id"===e.type){n=f.field(e.name);break}let $=null,g=new T(new R({name:"percentalong",alias:"percentalong",type:"double"}),V.create("0",e.associations.getFieldsIndex())),D=new T(new R({name:"side",alias:"side",type:"string"}),V.create("''",e.associations.getFieldsIndex()));const b="globalid",A="globalId",h={};for(const n in e.lkp)h[n]=e.lkp[n].sourceId;const x=new F(new R({name:"classname",alias:"classname",type:"string"}),null,h);let L="";switch(c){case"midspan":{L=`((${a}='${n}') OR ( ${o}='${n}')) AND (${y} IN (5))`,x.codefield=V.create(`CASE WHEN (${a}='${n}') THEN ${u} ELSE ${w} END`,e.associations.getFieldsIndex());const t=E(M.findField(e.associations.fields,o));t.name=b,t.alias=b,$=new T(t,V.create(`CASE WHEN (${o}='${n}') THEN ${a} ELSE ${o} END`,e.associations.getFieldsIndex())),g=e.unVersion>=4?new v(M.findField(e.associations.fields,l.get("PERCENTALONG").name)):new T(new R({name:"percentalong",alias:"percentalong",type:"double"}),V.create("0",e.associations.getFieldsIndex()));break}case"junctionedge":{L=`((${a}='${n}') OR ( ${o}='${n}')) AND (${y} IN (4,6))`,x.codefield=V.create(`CASE WHEN (${a}='${n}') THEN ${u} ELSE ${w} END`,e.associations.getFieldsIndex());const t=E(M.findField(e.associations.fields,o));t.name=b,t.alias=b,$=new T(t,V.create(`CASE WHEN (${o}='${n}') THEN ${a} ELSE ${o} END`,e.associations.getFieldsIndex())),D=new T(new R({name:"side",alias:"side",type:"string"}),V.create(`CASE WHEN (${y}=4) THEN 'from' ELSE 'to' END`,e.associations.getFieldsIndex()));break}case"connected":{let r=`${a}='@T'`,l=`${o}='@T'`;null!==t&&(r+=` AND ${i}=@A`,l+=` AND ${s}=@A`),L="(("+r+") OR ("+l+"))",L=d(L,"@T",n),r=d(r,"@T",n),null!==t&&(r=d(r,"@A",t.toString()),L=d(L,"@A",t.toString())),x.codefield=V.create("CASE WHEN "+r+` THEN ${u} ELSE ${w} END`,e.associations.getFieldsIndex());const f=E(M.findField(e.associations.fields,o));f.name=b,f.alias=b,$=new T(f,V.create("CASE WHEN "+r+` THEN ${o} ELSE ${a} END`,e.associations.getFieldsIndex()));break}case"container":L=`${a}='${n}' AND ${y} = 2`,null!==t&&(L+=` AND ${i} = `+t.toString()),x.codefield=u,L="( "+L+" )",$=new P(M.findField(e.associations.fields,o),b,b);case"content":L=`(${o}='${n}' AND ${y} = 2)`,null!==t&&(L+=` AND ${s} = `+t.toString()),x.codefield=w,L="( "+L+" )",$=new P(M.findField(e.associations.fields,a),b,b);break;case"structure":L=`(${a}='${n}' AND ${y} = 3)`,null!==t&&(L+=` AND ${i} = `+t.toString()),x.codefield=u,L="( "+L+" )",$=new P(M.findField(e.associations.fields,o),b,A);break;case"attached":L=`(${o}='${n}' AND ${y} = 3)`,null!==t&&(L+=` AND ${s} = `+t.toString()),x.codefield=w,L="( "+L+" )",$=new P(M.findField(e.associations.fields,a),b,A);break;default:throw new Error("Invalid Parameter")}return r&&(L="1 <> 1"),new M({parentfeatureset:e.associations,adaptedFields:[new v(M.findField(e.associations.fields,I)),new v(M.findField(e.associations.fields,N)),$,D,x,g],extraFilter:L?V.create(L,e.associations.getFieldsIndex()):null})}))}))},q.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),q.functions.groupby=function(t,l){return q.standardFunctionAsync(t,l,((l,a,i)=>(e(i,3,3),u(i[0])?i[0].load().then((e=>{const l=[],a=[];let u=!1,f=[];if(s(i[1]))f.push(i[1]);else if(i[1]instanceof r)f.push(i[1]);else if(o(i[1]))f=i[1];else{if(!c(i[1]))return q.failDefferred("Illegal Value: GroupBy");f=i[1].toArray()}for(const t of f)if(s(t)){const r=V.create(n(t),e.getFieldsIndex()),a=!0===j(r)?n(t):"%%%%FIELDNAME";l.push({name:a,expression:r}),"%%%%FIELDNAME"===a&&(u=!0)}else{if(!(t instanceof r))return q.failDefferred("Illegal Value: GroupBy");{const n=t.hasField("name")?t.field("name"):"%%%%FIELDNAME",r=t.hasField("expression")?t.field("expression"):"";if("%%%%FIELDNAME"===n&&(u=!0),!n)return q.failDefferred("Illegal Value: GroupBy");l.push({name:n,expression:V.create(r||n,e.getFieldsIndex())})}}if(f=[],s(i[2]))f.push(i[2]);else if(o(i[2]))f=i[2];else if(c(i[2]))f=i[2].toArray();else{if(!(i[2]instanceof r))return q.failDefferred("Illegal Value: GroupBy");f.push(i[2])}for(const n of f){if(!(n instanceof r))return q.failDefferred("Illegal Value: GroupBy");{const t=n.hasField("name")?n.field("name"):"",r=n.hasField("statistic")?n.field("statistic"):"",l=n.hasField("expression")?n.field("expression"):"";if(!t||!r||!l)return q.failDefferred("Illegal Value: GroupBy");a.push({name:t,statistic:r.toLowerCase(),expression:V.create(l,e.getFieldsIndex())})}}if(u){const n={};for(const t of e.fields)n[t.name.toLowerCase()]=1;for(const e of l)"%%%%FIELDNAME"!==e.name&&(n[e.name.toLowerCase()]=1);for(const e of a)"%%%%FIELDNAME"!==e.name&&(n[e.name.toLowerCase()]=1);let t=0;for(const e of l)if("%%%%FIELDNAME"===e.name){for(;1===n["field_"+t.toString()];)t++;n["field_"+t.toString()]=1,e.name="FIELD_"+t.toString()}}const m=[];for(const e of l)m.push(k(e.expression,q,t));for(const e of a)m.push(k(e.expression,q,t));return m.length>0?B(m).then((()=>C(i[0].groupby(l,a)))):C(i[0].groupby(l,a))})):q.failDefferred("Illegal Value: GroupBy"))))},q.signatures.push({name:"groupby",min:"3",max:"3"}),q.functions.distinct=function(t,l){return q.standardFunctionAsync(t,l,((l,a,i)=>u(i[0])?(e(i,2,2),i[0].load().then((e=>{const l=[];let a=[];if(s(i[1]))a.push(i[1]);else if(i[1]instanceof r)a.push(i[1]);else if(o(i[1]))a=i[1];else{if(!c(i[1]))return q.failDefferred("Illegal Value: GroupBy");a=i[1].toArray()}let u=!1;for(const t of a)if(s(t)){const r=V.create(n(t),e.getFieldsIndex()),a=!0===j(r)?n(t):"%%%%FIELDNAME";l.push({name:a,expression:r}),"%%%%FIELDNAME"===a&&(u=!0)}else{if(!(t instanceof r))return q.failDefferred("Illegal Value: GroupBy");{const n=t.hasField("name")?t.field("name"):"%%%%FIELDNAME",r=t.hasField("expression")?t.field("expression"):"";if("%%%%FIELDNAME"===n&&(u=!0),!n)return q.failDefferred("Illegal Value: GroupBy");l.push({name:n,expression:V.create(r||n,e.getFieldsIndex())})}}if(u){const n={};for(const t of e.fields)n[t.name.toLowerCase()]=1;for(const e of l)"%%%%FIELDNAME"!==e.name&&(n[e.name.toLowerCase()]=1);let t=0;for(const e of l)if("%%%%FIELDNAME"===e.name){for(;1===n["field_"+t.toString()];)t++;n["field_"+t.toString()]=1,e.name="FIELD_"+t.toString()}}const f=[];for(const e of l)f.push(k(e.expression,q,t));return f.length>0?B(f).then((()=>C(i[0].groupby(l,[])))):C(i[0].groupby(l,[]))}))):function(e,n,t,r){if(1===r.length){if(o(r[0]))return p(e,r[0],-1);if(c(r[0]))return p(e,r[0].toArray(),-1)}return p(e,r,-1)}("distinct",0,0,i)))})}export{q as registerFunctions}