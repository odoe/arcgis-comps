import{q as a,l as e,j as l,a7 as t,br as n,a1 as s,V as o}from"./p-c8bc3433.js";import{f as c,h as u,t as r}from"./p-e8bafa05.js";import"./p-84bf99cb.js";import"./p-e4802f24.js";const m="picture-fill",i=120,p=document.createElement("canvas");function d(a,e){const l=p.getContext("2d"),t=[];return e&&(e.weight&&t.push(e.weight),e.size&&t.push(e.size+"px"),e.family&&t.push(e.family)),l.font=t.join(" "),l.measureText(a).width}function v(a){if(0===a.length)return 0;if(a.length>2){const e=o(1),l=parseFloat(a);switch(a.slice(-2)){case"px":return l;case"pt":return l*e;case"in":return 72*l*e;case"pc":return 12*l*e;case"mm":return 2.8346456692913384*l*e;case"cm":return 28.346456692913385*l*e}}return parseFloat(a)}function h(o,p){var h,f;const y=null!=(null==p?void 0:p.size)?s(p.size):null,b=null!=(null==p?void 0:p.maxSize)?s(p.maxSize):null,M=null!=(null==p?void 0:p.opacity)?p.opacity:null,k=null!=(null==p?void 0:p.rotation)?p.rotation:"angle"in o?o.angle:null,L=a(o);let w=e(o);if(L&&!w){const a="type"in L?null:new l(L);"#ffffff"===(a?a.toHex():null)&&(w={color:"#bdc3c7",width:.75})}const x={shape:null,fill:null,stroke:w,offset:[0,0]};null!=(h=w)&&h.width&&(w.width=Math.min(w.width,80));const g=(null==(f=w)?void 0:f.width)||0;let j=null!=y&&(null==(null==p?void 0:p.scale)||(null==p?void 0:p.scale)),F=0,P=0,z=!1;switch(o.type){case"simple-marker":{const a=o.style,e=Math.min(null!=y?y:s(o.size),b||i);switch(F=e,P=e,a){case"circle":x.shape={type:"circle",cx:0,cy:0,r:.5*e},j||(F+=g,P+=g);break;case"cross":x.shape={type:"path",path:[{command:"M",values:[0,.5*P]},{command:"L",values:[F,.5*P]},{command:"M",values:[.5*F,0]},{command:"L",values:[.5*F,P]}]};break;case"diamond":x.shape={type:"path",path:[{command:"M",values:[0,.5*P]},{command:"L",values:[.5*F,0]},{command:"L",values:[F,.5*P]},{command:"L",values:[.5*F,P]},{command:"Z",values:[]}]},j||(F+=g,P+=g);break;case"square":x.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[F,0]},{command:"L",values:[F,P]},{command:"L",values:[0,P]},{command:"Z",values:[]}]},j||(F+=g,P+=g),k&&(z=!0);break;case"triangle":x.shape={type:"path",path:[{command:"M",values:[.5*F,0]},{command:"L",values:[F,P]},{command:"L",values:[0,P]},{command:"Z",values:[]}]},j||(F+=g,P+=g),k&&(z=!0);break;case"x":x.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[F,P]},{command:"M",values:[F,0]},{command:"L",values:[0,P]}]},k&&(z=!0);break;case"path":x.shape={type:"path",path:o.path||""},j||(F+=g,P+=g),k&&(z=!0),j=!0}break}case"simple-line":{const a=Math.min(null!=y?y:g,b||80),e=a>22?2*a:40;w.width=a,F=e,P=a,x.shape={type:"path",path:[{command:"M",values:[0,P]},{command:"L",values:[F,P]}]};break}case m:case"simple-fill":F=Math.min(null!=y?y:22,b||i)+g,P=F,j=!0,x.shape="object"==typeof(null==p?void 0:p.symbolConfig)&&null!=p&&p.symbolConfig.isSquareFill?r.squareFill[0]:r.fill[0];break;case"picture-marker":{let a=s(o.width),e=s(o.height);const l=null!=y?y:Math.max(a,e),t=a/e;a=t<=1?Math.ceil(l*t):l,e=t<=1?l:Math.ceil(l/t),F=Math.min(a,b||i),P=Math.min(e,b||i),x.shape={type:"image",x:-Math.round(F/2),y:-Math.round(P/2),width:F,height:P,src:o.url||""},k&&(z=!0);break}case"text":{const a=o,e=a.text||"Aa",l=a.font,t=Math.min(null!=y?y:s(l.size),b||i),n=d(e,{weight:l.weight,size:t,family:l.family}),c=/[\uE600-\uE6FF]/.test(e);F=c?t:n,P=t;let u=.25*v((l?t:0).toString());c&&(u+=5),x.shape={type:"text",text:e,x:0,y:u,align:"middle",decoration:l&&l.decoration,rotated:a.rotated,kerning:a.kerning},x.font=l&&{size:t,style:l.style,decoration:l.decoration,weight:l.weight,family:l.family};break}}if(!x.shape)return Promise.reject(new t("symbolPreview: renderPreviewHTML2D","symbol not supported."));const Z=L,q=o.color;let D=null;return Z&&"pattern"===Z.type&&q&&o.type!==m?D=n(Z.src,q.toCss(!0)).then((a=>(Z.src=a,x.fill=Z,x))):(x.fill=L,D=Promise.resolve(x)),D.then((a=>{const e=[[a]];if("object"==typeof(null==p?void 0:p.symbolConfig)&&null!=p&&p.symbolConfig.applyColorModulation){const l=.6*F;e.unshift([{...a,offset:[-l,0],fill:c(L,-.3)}]),e.push([{...a,offset:[l,0],fill:c(L,.3)}]),F+=2*l}return u(e,[F,P],{node:p&&p.node,scale:j,opacity:M,rotation:k,useRotationSize:z,effect:null==p?void 0:p.effect})}))}export{h as previewSymbol2D}