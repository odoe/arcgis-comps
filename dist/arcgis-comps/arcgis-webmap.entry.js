import { r as registerInstance, h as h$3, g as getElement } from './index-921bd636.js';
import { f as s$9, b0 as d$1, b1 as U, r, at as E, e as e$2, a as d$3, i as i$a, a2 as o, M as l$6, a1 as o$2, X as S, I as S$1, al as r$4, aj as b$2, l as t$2, C as s$a, g as c$b, p as p$9, bo as n$6, bz as a$9, bh as M$1, aQ as e$3, aL as T, d as d$6, ab as G, aw as V, bW as bt, ak as t$4 } from './jsxFactory-c96bb45c.js';
import { u as u$2, m as m$5, j as j$1, d as d$5, S as S$2, G as G$1 } from './MapView-e30b3dee.js';
import { am as m$4, M, J as k, v as o$1, f as r$1, d as r$2, aQ as r$3, a4 as B, ax as R, bu as j$2 } from './Graphic-6c72131a.js';
import { n as n$7 } from './loadAll-85b9593d.js';
import { l as l$5, O } from './MultiOriginJSONSupport-f6506b2f.js';
import { r as r$6 } from './originUtils-7b0bbc60.js';
import { a as a$8, d as d$4 } from './JSONSupport-5a9f556a.js';
import { d as d$2, L } from './arcgisLayerUrl-2aeded02.js';
import b$3 from './PortalItem-209a51a1.js';
import { n as n$9, e as e$4, t as t$3 } from './portalItemUtils-6e127923.js';
import { a as a$a, n as n$8 } from './project-277a95d8.js';
import { y as y$2 } from './TimeExtent-1bc95591.js';
import { l as l$7 } from './TimeInfo-9a5e9434.js';
import { y as y$3 } from './writeUtils-4d88cd58.js';
import { i as i$b } from './fieldType-b9f9365f.js';
import { r as r$5 } from './Version-66d9a1e2.js';
import './CollectionFlattener-567ea124.js';
import './HandleOwner-6fdf8ee8.js';
import './reactiveUtils-4ba1fb4b.js';
import './workers-5ad649f9.js';
import './unitUtils-b25ae8cb.js';
import './executeQueryJSON-165e5051.js';
import './utils-8991f658.js';
import './query-0da4fa5c.js';
import './normalizeUtils-1fd7c0f1.js';
import './pbfQueryUtils-e36554ac.js';
import './pbf-1b9dc626.js';
import './OptimizedFeature-6034ce0f.js';
import './OptimizedFeatureSet-27736f1f.js';
import './queryZScale-0ff40b9b.js';
import './zscale-cec9b507.js';
import './Query-792b142d.js';
import './Field-2b6029f8.js';
import './RangeDomain-de3132b0.js';
import './FeatureSet-22102ca4.js';
import './AttachmentQuery-42d07544.js';
import './Heading-7763ec3e.js';
import './utils-ce0d30fb.js';
import './asyncUtils-dc4bd819.js';
import './ItemCache-2d2e76a8.js';
import './MemCache-e219bcfb.js';
import './utils-f8425723.js';
import './widget-13824d6e.js';
import './vmEvent-bdc3bebc.js';
import './TopFeaturesQuery-31a64765.js';
import './QueryTask-f5ad3db8.js';
import './compilerUtils-128fda14.js';
import './featureConversionUtils-0aaeda4b.js';
import './Task-87780f0a.js';
import './FeatureLayer-9672bbd9.js';
import './UniqueValueRenderer-f2af8ece.js';
import './VisualVariablesMixin-bafacb39.js';
import './colorRamps-693d6433.js';
import './ColorStop-fb26d745.js';
import './sizeVariableUtils-4d3662df.js';
import './visualVariableUtils-506efb2b.js';
import './lengthUtils-7a485aa7.js';
import './diffUtils-491d81df.js';
import './jsonUtils-a31b4632.js';
import './styleUtils-8fedca21.js';
import './DictionaryRenderer-78308a28.js';
import './LRUCache-81490262.js';
import './jsonUtils-580ae154.js';
import './HeightModelInfo-a87824be.js';
import './APIKeyMixin-4866fda4.js';
import './ArcGISService-4cc51fbf.js';
import './BlendLayer-70766503.js';
import './jsonUtils-352e8eb7.js';
import './mat4-ef633c62.js';
import './_commonjsHelpers-020ca939.js';
import './CustomParametersMixin-89544c0d.js';
import './labelingInfo-683f3119.js';
import './commonProperties-fa43a2ed.js';
import './LabelClass-65776e47.js';
import './labelUtils-45e9126f.js';
import './defaultsJSON-53258912.js';
import './OperationalLayer-b04e38aa.js';
import './OrderedLayer-8b694b55.js';
import './PortalLayer-df690c5a.js';
import './RefreshableLayer-702beb88.js';
import './ScaleRangeLayer-99043c54.js';
import './TemporalLayer-b41e8e6e.js';
import './FeatureType-8cae0f8f.js';
import './fieldProperties-b0c243c7.js';
import './FieldsIndex-56cf15de.js';
import './LayerFloorInfo-2c65601c.js';
import './styleUtils-e2196c57.js';
import './popupUtils-4957d444.js';
import './TileStore-39bbbf67.js';
import './TileKey-c678a190.js';
import './quickselect-ccfd8cff.js';
import './layerViewUtils-9cf85499.js';
import './GoTo-7624d206.js';
import './mathUtils-91a58478.js';
import './TileInfo-1fc37c81.js';
import './Basemap-37cadf63.js';
import './TablesMixin-93b17242.js';
import './GraphicsCollection-f199ec2b.js';
import './Scheduler-fb8ceb54.js';
import './unitBezier-0f2e6a45.js';
import './mat2d-b05e5a52.js';
import './vec2-f635f36f.js';
import './vec2f64-503345b4.js';
import './projection-32646abc.js';
import './mat3-351ead7a.js';
import './vec2f32-7c7b1123.js';
import './TileStrategy-8fcd9a8c.js';
import './screenshotUtils-6f247196.js';
import './capabilities-eb3cc9c1.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const y$1=s$9.getLogger("esri.networks.Network");let m$3=class extends(l$5(m$4)){constructor(e){super(e),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null;}initialize(){this.when().catch((e=>{var r,t;d$1(e)||y$1.error("#load()",`Failed to load layer (title: '${null!=(r=this.title)?r:"no title"}', id: '${null!=(t=this.id)?t:"no id"}')`,{error:e});}));}get datasetName(){var e;return null==(e=this.dataElement)?void 0:e.name}get owner(){var e;return null==(e=this.dataElement)?void 0:e.userIdentity}get schemaGeneration(){var e;return null==(e=this.dataElement)?void 0:e.schemaGeneration}get parsedUrl(){const e=this.layerUrl;return e?U(e):null}get featureServiceUrl(){const e=this.parsedUrl&&d$2(this.parsedUrl.path);return r(e)?e.url.path:null}get networkServiceUrl(){return this.featureServiceUrl?this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer"):null}get layerId(){const e=this.parsedUrl&&d$2(this.parsedUrl.path);return r(e)?e.sublayer:null}async load(e){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),e)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,e)),this}getLayerIdBySourceId(e){if(this.dataElement){const r=this.dataElement.domainNetworks;for(const t of r){for(const r of t.edgeSources?t.edgeSources:[])if(r.sourceId===e)return r.layerId;for(const r of t.junctionSources?t.junctionSources:[])if(r.sourceId===e)return r.layerId}return null}return null}async _fetchLayerMetaData(e,t){const o=await E(e,{responseType:"json",query:{f:"json"},...t});this.read(o.data,{origin:"service"});}async _fetchDataElement(e,t,o){if(this.dataElement)return;const s=await E(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...o}).then((e=>{var r;return null==(r=e.data.layerDataElements)?void 0:r[0]}));s&&this.read(s,{origin:"service"});}};e$2([d$3({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}}},read:!1}})],m$3.prototype,"id",void 0),e$2([d$3({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}}},read:!1}})],m$3.prototype,"title",void 0),e$2([d$3({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],m$3.prototype,"layerUrl",void 0),e$2([d$3({type:Object,json:{origins:{service:{read:!0}},read:!1}})],m$3.prototype,"dataElement",void 0),e$2([d$3({type:M,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],m$3.prototype,"fullExtent",void 0),e$2([d$3({type:k,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],m$3.prototype,"spatialReference",void 0),e$2([d$3({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],m$3.prototype,"type",void 0),e$2([d$3({readOnly:!0})],m$3.prototype,"datasetName",null),e$2([d$3({readOnly:!0})],m$3.prototype,"owner",null),e$2([d$3({readOnly:!0})],m$3.prototype,"schemaGeneration",null),e$2([d$3({readOnly:!0})],m$3.prototype,"parsedUrl",null),e$2([d$3({readOnly:!0})],m$3.prototype,"featureServiceUrl",null),e$2([d$3({readOnly:!0})],m$3.prototype,"networkServiceUrl",null),e$2([d$3({readOnly:!0})],m$3.prototype,"layerId",null),m$3=e$2([i$a("esri.networks.Network")],m$3);const h$2=m$3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$8=class extends a$8{constructor(t){super(t),this.conditionBarriers=[],this.outputConditions=[],this.functions=[],this.functionBarriers=[],this.traversabilityScope=null,this.shortestPathNetworkAttributeName=null,this.includeBarriers=null,this.validateConsistency=null,this.ignoreBarriersAtStartingPoints=null;}};e$2([d$3({type:[Object],json:{write:!0}})],s$8.prototype,"conditionBarriers",void 0),e$2([d$3({type:[Object],json:{write:!0}})],s$8.prototype,"outputConditions",void 0),e$2([d$3({type:[Object],json:{write:!0}})],s$8.prototype,"functions",void 0),e$2([d$3({type:[Object],json:{write:!0}})],s$8.prototype,"functionBarriers",void 0),e$2([d$3({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],s$8.prototype,"traversabilityScope",void 0),e$2([d$3({type:String,json:{write:!0}})],s$8.prototype,"shortestPathNetworkAttributeName",void 0),e$2([d$3({type:Boolean,json:{write:!0}})],s$8.prototype,"includeBarriers",void 0),e$2([d$3({type:Boolean,json:{write:!0}})],s$8.prototype,"validateConsistency",void 0),e$2([d$3({type:Boolean,json:{write:!0}})],s$8.prototype,"ignoreBarriersAtStartingPoints",void 0),s$8=e$2([i$a("esri.networks.support.TraceConfiguration")],s$8);const i$9=s$8;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const t$1=new o({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork","subnetwork controllers":"subnetwork-controllers",loops:"loops",isolation:"isolation"});

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let i$8=class extends i$9{constructor(t){super(t),this.filterBarriers=[],this.domainNetworkName=null,this.filterBitsetNetworkAttributeName=null,this.filterFunctionBarriers=[],this.filterScope=null,this.includeContainers=null,this.includeContent=null,this.includeIsolated=null,this.includeStructures=null,this.includeUpToFirstSpatialContainer=null,this.nearestNeighbor=null,this.outputFilterCategories=[],this.outputFilters=[],this.propagators=[],this.subnetworkName=null,this.targetTierName=null,this.tierName=null,this.validateLocatability=null;}};e$2([d$3({type:[Object],json:{write:!0}})],i$8.prototype,"filterBarriers",void 0),e$2([d$3({type:String,json:{write:!0}})],i$8.prototype,"domainNetworkName",void 0),e$2([d$3({type:String,json:{write:!0}})],i$8.prototype,"filterBitsetNetworkAttributeName",void 0),e$2([d$3({type:[Object],json:{write:!0}})],i$8.prototype,"filterFunctionBarriers",void 0),e$2([d$3({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],i$8.prototype,"filterScope",void 0),e$2([d$3({type:Boolean,json:{write:!0}})],i$8.prototype,"includeContainers",void 0),e$2([d$3({type:Boolean,json:{write:!0}})],i$8.prototype,"includeContent",void 0),e$2([d$3({type:Boolean,json:{write:!0}})],i$8.prototype,"includeIsolated",void 0),e$2([d$3({type:Boolean,json:{write:!0}})],i$8.prototype,"includeStructures",void 0),e$2([d$3({type:Boolean,json:{write:!0}})],i$8.prototype,"includeUpToFirstSpatialContainer",void 0),e$2([d$3({type:Object,json:{write:!0}})],i$8.prototype,"nearestNeighbor",void 0),e$2([d$3({type:[Object],json:{write:!0}})],i$8.prototype,"outputFilterCategories",void 0),e$2([d$3({type:[Object],json:{write:!0}})],i$8.prototype,"outputFilters",void 0),e$2([d$3({type:[Object],json:{write:!0}})],i$8.prototype,"propagators",void 0),e$2([d$3({type:String,json:{write:!0}})],i$8.prototype,"subnetworkName",void 0),e$2([d$3({type:String,json:{write:!0}})],i$8.prototype,"targetTierName",void 0),e$2([d$3({type:String,json:{write:!0}})],i$8.prototype,"tierName",void 0),e$2([d$3({type:Boolean,json:{write:!0}})],i$8.prototype,"validateLocatability",void 0),i$8=e$2([i$a("esri.networks.support.UNTraceConfiguration")],i$8);const s$7=i$8;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let p$8=class extends O{constructor(r){super(r),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null;}readTraceConfiguration(r,e){return void 0!==r.tierName?s$7.fromJSON(r):i$9.fromJSON(r)}};e$2([d$3({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"}}},read:!1}})],p$8.prototype,"globalId",void 0),e$2([d$3({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],p$8.prototype,"title",void 0),e$2([d$3({type:i$9,json:{origins:{service:{read:!0}},read:!1}})],p$8.prototype,"traceConfiguration",void 0),e$2([o$1("service","traceConfiguration")],p$8.prototype,"readTraceConfiguration",null),e$2([d$3({type:Date,json:{origins:{service:{read:!0}},read:!1}})],p$8.prototype,"creationDate",void 0),e$2([d$3({type:String,json:{origins:{service:{read:!0}},read:!1}})],p$8.prototype,"creator",void 0),e$2([d$3({type:String,json:{origins:{service:{read:!0}},read:!1}})],p$8.prototype,"description",void 0),e$2([d$3({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"}}},read:!1}})],p$8.prototype,"minStartingPoints",void 0),e$2([d$3({type:[Object],json:{origins:{service:{read:!0}},read:!1}})],p$8.prototype,"resultTypes",void 0),e$2([d$3({type:[String],json:{origins:{service:{read:!0}},read:!1}})],p$8.prototype,"tags",void 0),e$2([d$3({type:t$1.apiValues,json:{type:t$1.jsonValues,origins:{service:{read:t$1.read}},read:!1}})],p$8.prototype,"traceType",void 0),p$8=e$2([i$a("esri.networks.support.NamedTraceConfiguration")],p$8);const c$a=p$8;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$6=class extends a$8{constructor(r){super(r),this.id=null,this.name=null;}};e$2([d$3({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],s$6.prototype,"id",void 0),e$2([d$3({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],s$6.prototype,"name",void 0),e$2([d$3({type:Boolean,json:{write:!0}})],s$6.prototype,"isUpstreamTerminal",void 0),s$6=e$2([i$a("esri.networks.support.Terminal")],s$6);const p$7=s$6;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const a$7=new o({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let n$5=class extends a$8{constructor(r){super(r),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null;}};e$2([d$3({type:String,json:{write:!0}})],n$5.prototype,"defaultConfiguration",void 0),e$2([d$3({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],n$5.prototype,"id",void 0),e$2([d$3({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],n$5.prototype,"name",void 0),e$2([d$3({type:[p$7],json:{write:!0}})],n$5.prototype,"terminals",void 0),e$2([d$3({type:a$7.apiValues,json:{type:a$7.jsonValues,read:a$7.read,write:a$7.write}})],n$5.prototype,"traversabilityModel",void 0),n$5=e$2([i$a("esri.networks.support.TerminalConfiguration")],n$5);const p$6=n$5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$5=class extends h$2{constructor(r){super(r),this.sharedNamedTraceConfigurations=[],this.type="utility";}get serviceTerritoryFeatureLayerId(){var r;return null==(r=this.dataElement)?void 0:r.serviceTerritoryFeatureLayerId}get terminalConfigurations(){var r;return (null==(r=this.dataElement)?void 0:r.terminalConfigurations.map((r=>p$6.fromJSON(r))))||[]}get domainNetworkNames(){var r;return (null==(r=this.dataElement)?void 0:r.domainNetworks.map((r=>r.domainNetworkName)))||[]}async load(r){return this.addResolvingPromise(super.load(r)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(r)),this}getTerminalConfiguration(r){let e=null,t=null;const o=r.layer;let a=null;if("feature"!==(null==o?void 0:o.type))return null;if(a=o.layerId,null===a)return null;const n=r.attributes;if(null==n)return null;for(const i of Object.keys(n))"ASSETGROUP"===i.toUpperCase()&&(e=r.getAttribute(i)),"ASSETTYPE"===i.toUpperCase()&&(t=r.getAttribute(i));if(!this.dataElement)return null;let s=null;const l=this.dataElement.domainNetworks;for(const i of l){var u;const r=null==(u=i.junctionSources)?void 0:u.find((r=>r.layerId===a));if(r){var d;const o=null==(d=r.assetGroups)?void 0:d.find((r=>r.assetGroupCode===e));if(o){var m;const r=null==(m=o.assetTypes)?void 0:m.find((r=>r.assetTypeCode===t));if(r){s=r.terminalConfigurationId;break}}}}if(null!=s){const r=this.dataElement.terminalConfigurations,e=null==r?void 0:r.find((r=>r.terminalConfigurationId===s));return e?p$6.fromJSON(e):null}return null}getTierNames(r){var e;const t=null==(e=this.dataElement)?void 0:e.domainNetworks.find((e=>e.domainNetworkName===r));return (null==t?void 0:t.tiers.map((r=>r.name)))||[]}async _loadNamedTraceConfigurationsFromNetwork(r){var e;if(0===(null==(e=this.sharedNamedTraceConfigurations)?void 0:e.length))return;const t=this.sharedNamedTraceConfigurations.map((r=>r.globalId)),o=await this._fetchTraceConfigData(this.networkServiceUrl,t,r);for(const a of this.sharedNamedTraceConfigurations){const r=null==o?void 0:o.find((r=>r.globalId===a.globalId));r&&a.read(r,{origin:"service"});}}_fetchTraceConfigData(r,t,o){return E(`${r}/traceConfigurations/query`,{responseType:"json",query:{globalIds:JSON.stringify(t),f:"json"},...o}).then((r=>r.data.traceConfigurations))}};e$2([d$3({type:[c$a],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],s$5.prototype,"sharedNamedTraceConfigurations",void 0),e$2([d$3({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],s$5.prototype,"type",void 0),e$2([d$3({readOnly:!0})],s$5.prototype,"serviceTerritoryFeatureLayerId",null),e$2([d$3({readOnly:!0})],s$5.prototype,"terminalConfigurations",null),e$2([d$3({readOnly:!0})],s$5.prototype,"domainNetworkNames",null),s$5=e$2([i$a("esri.networks.UtilityNetwork")],s$5);const l$4=s$5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$4=class extends a$8{constructor(r){super(r),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null;}};e$2([d$3({type:String,json:{write:!0}})],s$4.prototype,"facilityIdField",void 0),e$2([d$3({type:String,json:{write:!0}})],s$4.prototype,"layerId",void 0),e$2([d$3({type:String,json:{write:!0}})],s$4.prototype,"nameField",void 0),e$2([d$3({type:String,json:{write:!0}})],s$4.prototype,"siteIdField",void 0),e$2([d$3({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],s$4.prototype,"sublayerId",void 0),s$4=e$2([i$a("esri.layers.support.FacilityLayerInfo")],s$4);const i$7=s$4;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let i$6=class extends a$8{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null;}};e$2([d$3({type:String,json:{write:!0}})],i$6.prototype,"facilityIdField",void 0),e$2([d$3({type:String,json:{write:!0}})],i$6.prototype,"layerId",void 0),e$2([d$3({type:String,json:{write:!0}})],i$6.prototype,"levelIdField",void 0),e$2([d$3({type:String,json:{write:!0}})],i$6.prototype,"levelNumberField",void 0),e$2([d$3({type:String,json:{write:!0}})],i$6.prototype,"longNameField",void 0),e$2([d$3({type:String,json:{write:!0}})],i$6.prototype,"shortNameField",void 0),e$2([d$3({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],i$6.prototype,"sublayerId",void 0),e$2([d$3({type:String,json:{write:!0}})],i$6.prototype,"verticalOrderField",void 0),i$6=e$2([i$a("esri.layers.support.LevelLayerInfo")],i$6);const s$3=i$6;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$2=class extends a$8{constructor(r){super(r),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null;}};e$2([d$3({type:String,json:{write:!0}})],s$2.prototype,"layerId",void 0),e$2([d$3({type:String,json:{write:!0}})],s$2.prototype,"nameField",void 0),e$2([d$3({type:String,json:{write:!0}})],s$2.prototype,"siteIdField",void 0),e$2([d$3({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],s$2.prototype,"sublayerId",void 0),s$2=e$2([i$a("esri.layers.support.SiteLayerInfo")],s$2);const i$5=s$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let a$6=class extends a$8{constructor(r){super(r),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null;}};e$2([d$3({type:s$3,json:{write:!0}})],a$6.prototype,"levelLayer",void 0),e$2([d$3({type:i$7,json:{write:!0}})],a$6.prototype,"facilityLayer",void 0),e$2([d$3({type:i$5,json:{write:!0}})],a$6.prototype,"siteLayer",void 0),a$6=e$2([i$a("esri.support.MapFloorInfo")],a$6);const l$3=a$6;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var s$1;let a$5=s$1=class extends a$8{constructor(e){super(e),this.activeRange=null,this.currentRangeExtent=null,this.fullRangeExtent=null;}clone(){return new s$1(l$6({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}};e$2([d$3({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],a$5.prototype,"activeRange",void 0),e$2([d$3({type:[Number],json:{write:!0}})],a$5.prototype,"currentRangeExtent",void 0),e$2([d$3({type:[Number],json:{write:!0}})],a$5.prototype,"fullRangeExtent",void 0),a$5=s$1=e$2([i$a("esri.webdoc.RangeInfo")],a$5);const c$9=a$5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var s;let n$4=s=class extends a$8{constructor(e){super(e),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null;}clone(){return new s(l$6({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};e$2([d$3({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],n$4.prototype,"enabled",void 0),e$2([d$3({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],n$4.prototype,"longNames",void 0),e$2([d$3({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],n$4.prototype,"minimized",void 0),e$2([d$3({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],n$4.prototype,"pinnedLevels",void 0),e$2([d$3({type:String,json:{read:{source:"site"},write:{target:"site"}}})],n$4.prototype,"site",void 0),e$2([d$3({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],n$4.prototype,"facility",void 0),e$2([d$3({type:String,json:{read:{source:"level"},write:{target:"level"}}})],n$4.prototype,"level",void 0),n$4=s=e$2([i$a("esri.webdoc.widgets.FloorFilter")],n$4);const l$2=n$4;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var i$4;const n$3=new o({slider:"slider",picker:"picker"});let p$5=i$4=class extends a$8{constructor(e){super(e),this.interactionMode=null,this.numStops=null,this.stopInterval=null;}clone(){return new i$4({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};e$2([d$3({type:n$3.apiValues,nonNullable:!0,json:{type:n$3.jsonValues,default:null,read:{reader:n$3.read},write:{isRequired:!0,writer:n$3.write}}})],p$5.prototype,"interactionMode",void 0),e$2([d$3({type:Number,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const e=null!=this.stopInterval;return {enabled:!e,isRequired:!e}}}}})],p$5.prototype,"numStops",void 0),e$2([d$3({type:Number,json:{write:{overridePolicy(){return {isRequired:null==this.numStops}}}}})],p$5.prototype,"stopInterval",void 0),p$5=i$4=e$2([i$a("esri.webdoc.widgets.Range")],p$5);const a$4=p$5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var m$2;let c$8=m$2=class extends a$8{constructor(t){super(t),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null;}readCurrentTimeExtent(t){if(!t)return;const r=null!=t[0]?new Date(t[0]):null,o=null!=t[1]?new Date(t[1]):null;return new y$2({start:r,end:o})}writeCurrentTimeExtent(t,e,r$1){t&&o$2(r$1,[r(t.start)?t.start.getTime():null,r(t.end)?t.end.getTime():null],e);}readFullTimeExtent(t,r){const o=r.properties;if(!o)return;const s=null!=o.endTime?new Date(o.endTime):null,n=null!=o.startTime?new Date(o.startTime):null;return new y$2({start:n,end:s})}writeFullTimeExtent(t,e){if(!t)return;const r$1=e.properties=e.properties||{},o=t.end,s=t.start;o&&(r$1.endTime=r(o)?o.getTime():null),s&&(r$1.startTime=r(s)?s.getTime():null);}readStopInterval(t,e,o){return t?l$7.fromJSON({value:t.interval,unit:t.units},o):null}writeStopInterval(t,e,r,o){if(!t)return;const s=t.toJSON(o);o$2(r,{interval:s.value,units:s.unit},e);}readStops(t){return t&&t.length?t.map((t=>new Date(t))):null}writeStops(t,e,r){t&&t.length&&o$2(r,t.map((t=>t.getTime())),e);}clone(){return new m$2(l$6({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};e$2([d$3({type:y$2,json:{read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],c$8.prototype,"currentTimeExtent",void 0),e$2([o$1("currentTimeExtent")],c$8.prototype,"readCurrentTimeExtent",null),e$2([r$1("currentTimeExtent")],c$8.prototype,"writeCurrentTimeExtent",null),e$2([d$3({type:y$2,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],c$8.prototype,"fullTimeExtent",void 0),e$2([o$1("fullTimeExtent")],c$8.prototype,"readFullTimeExtent",null),e$2([r$1("fullTimeExtent")],c$8.prototype,"writeFullTimeExtent",null),e$2([d$3({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],c$8.prototype,"loop",void 0),e$2([d$3({type:Number,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){var t;const e=!!this.stopInterval,r=!(null==(t=this.stops)||!t.length),o=!(e||r);return {enabled:o,isRequired:o}}}}})],c$8.prototype,"numStops",void 0),e$2([d$3({type:[1,2],nonNullable:!0,json:{read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],c$8.prototype,"numThumbs",void 0),e$2([d$3({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],c$8.prototype,"stopDelay",void 0),e$2([d$3({type:l$7,json:{read:{source:"properties.timeStopInterval"},write:{target:"properties.timeStopInterval",overridePolicy(){var t;const e=null!=this.numStops,r=!(null==(t=this.stops)||!t.length);return {enabled:!r,isRequired:!(e||r)}}}}})],c$8.prototype,"stopInterval",void 0),e$2([o$1("stopInterval")],c$8.prototype,"readStopInterval",null),e$2([r$1("stopInterval")],c$8.prototype,"writeStopInterval",null),e$2([d$3({type:[Date],json:{read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return {isRequired:null==this.numStops&&!this.stopInterval}}}}})],c$8.prototype,"stops",void 0),e$2([o$1("stops")],c$8.prototype,"readStops",null),e$2([r$1("stops")],c$8.prototype,"writeStops",null),c$8=m$2=e$2([i$a("esri.webdoc.widgets.TimeSlider")],c$8);const d=c$8;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var m$1;let c$7=m$1=class extends a$8{constructor(r){super(r),this.range=null,this.timeSlider=null,this.floorFilter=null;}clone(){return new m$1(l$6({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};e$2([d$3({type:a$4,json:{write:!0}})],c$7.prototype,"range",void 0),e$2([d$3({type:d,json:{write:!0}})],c$7.prototype,"timeSlider",void 0),e$2([d$3({type:l$2,json:{write:!0}})],c$7.prototype,"floorFilter",void 0),c$7=m$1=e$2([i$a("esri.webdoc.Widgets")],c$7);const n$2=c$7;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const h$1={width:600,height:400},t=1.5;function i$3(i,e){e=e||h$1;let{width:d,height:n}=e;const g=d/n;return g<t?n=d/t:g>t&&(d=n*t),d>i.width&&(n*=i.width/d,d=i.width),n>i.height&&(d*=i.height/n,n=i.height),{width:Math.round(d),height:Math.round(n)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function n$1(n){return {enabled:!(null==n||!n.length)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var c$6;let a$3=c$6=class extends a$8{constructor(r){super(r),this.exactMatch=!1,this.name=null,this.type=null;}clone(){return new c$6({exactMatch:this.exactMatch,type:this.type,name:this.name})}};e$2([d$3({type:Boolean,json:{write:!0}})],a$3.prototype,"exactMatch",void 0),e$2([d$3({type:String,json:{write:!0}})],a$3.prototype,"name",void 0),e$2([r$2(i$b)],a$3.prototype,"type",void 0),a$3=c$6=e$2([i$a("esri.webdoc.applicationProperties.SearchLayerField")],a$3);const i$2=a$3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var c$5;let a$2=c$5=class extends a$8{constructor(r){super(r),this.field=null,this.id=null,this.subLayer=null;}clone(){return new c$5(l$6({field:this.field,id:this.id,subLayer:this.subLayer}))}};e$2([d$3({type:i$2,json:{write:{isRequired:!0}}})],a$2.prototype,"field",void 0),e$2([d$3({type:String,json:{write:{isRequired:!0}}})],a$2.prototype,"id",void 0),e$2([d$3({type:S,json:{write:!0}})],a$2.prototype,"subLayer",void 0),a$2=c$5=e$2([i$a("esri.webdoc.applicationProperties.SearchLayer")],a$2);const u$1=a$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var c$4;let a$1=c$4=class extends a$8{constructor(r){super(r),this.exactMatch=!1,this.name=null,this.type=null;}clone(){return new c$4({exactMatch:this.exactMatch,type:this.type,name:this.name})}};e$2([d$3({type:Boolean,json:{write:!0}})],a$1.prototype,"exactMatch",void 0),e$2([d$3({type:String,json:{write:!0}})],a$1.prototype,"name",void 0),e$2([r$2(i$b)],a$1.prototype,"type",void 0),a$1=c$4=e$2([i$a("esri.webdoc.applicationProperties.SearchTableField")],a$1);const i$1=a$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var p$4;let c$3=p$4=class extends a$8{constructor(r){super(r),this.field=null,this.id=null;}clone(){return new p$4(l$6({field:this.field,id:this.id}))}};e$2([d$3({type:i$1,json:{write:{isRequired:!0}}})],c$3.prototype,"field",void 0),e$2([d$3({type:String,json:{write:{isRequired:!0}}})],c$3.prototype,"id",void 0),c$3=p$4=e$2([i$a("esri.webdoc.applicationProperties.SearchTable")],c$3);const l$1=c$3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var p$3;const b$1=S$1.ofType(u$1),h=S$1.ofType(l$1);let u=p$3=class extends a$8{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new b$1,this.tables=new h;}readAddressSearchEnabled(e){return !e}writeAddressSearchEnabled(e,r,o){r[o]=!e;}clone(){return new p$3(l$6({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};e$2([d$3({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],u.prototype,"addressSearchEnabled",void 0),e$2([o$1("addressSearchEnabled")],u.prototype,"readAddressSearchEnabled",null),e$2([r$1("addressSearchEnabled")],u.prototype,"writeAddressSearchEnabled",null),e$2([d$3({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],u.prototype,"enabled",void 0),e$2([d$3({type:String,json:{write:!0}})],u.prototype,"hintText",void 0),e$2([d$3({type:b$1,json:{write:{overridePolicy:n$1},origins:{"web-scene":{write:{isRequired:!0}}}}})],u.prototype,"layers",void 0),e$2([d$3({type:h,json:{read:!0,write:{overridePolicy:n$1}}})],u.prototype,"tables",void 0),u=p$3=e$2([i$a("esri.webdoc.applicationProperties.Search")],u);const y=u;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var p$2;let a=p$2=class extends a$8{constructor(r){super(r),this.search=null;}clone(){return new p$2(l$6({search:this.search}))}};e$2([d$3({type:y,json:{write:!0}})],a.prototype,"search",void 0),a=p$2=e$2([i$a("esri.webdoc.applicationProperties.Viewing")],a);const i=a;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var p$1;let n=p$1=class extends a$8{constructor(o){super(o),this.editing=null,this.offline=null,this.viewing=null;}clone(){return new p$1(l$6({editing:this.editing,offline:this.offline,viewing:this.viewing}))}};e$2([d$3({json:{write:!0}})],n.prototype,"editing",void 0),e$2([d$3({json:{write:!0}})],n.prototype,"offline",void 0),e$2([d$3({type:i,json:{write:!0}})],n.prototype,"viewing",void 0),n=p$1=e$2([i$a("esri.webmap.ApplicationProperties")],n);const c$2=n;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var e$1;let p=e$1=class extends a$8{constructor(){super(...arguments),this.url="";}destroy(){this.url="";}clone(){return new e$1({url:this.url})}};e$2([d$3({type:String,json:{write:{isRequired:!0}}})],p.prototype,"url",void 0),p=e$1=e$2([i$a("esri.webdoc.support.Thumbnail")],p);const c$1=p;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var j;const b="esri.webmap.Bookmark",v=s$9.getLogger(b);let g=j=class extends(r$3(a$8)){constructor(e){super(e),this.name=null,this.thumbnail=new c$1;}set extent(e){r$4(v,"extent",{replacement:"viewpoint",version:"4.17"}),this._set("viewpoint",new u$2({targetGeometry:e.clone()})),this._set("extent",e);}castThumbnail(e){return "string"==typeof e?new c$1({url:e}):b$2(c$1,e)}set viewpoint(e){const{targetGeometry:t,scale:o}=e;r(t)&&("extent"===t.type?this._set("extent",t.clone()):"point"===t.type&&t$2(o)&&v.warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",e)),this._set("viewpoint",e);}readViewpoint(e,o){const{extent:r,viewpoint:i}=o;return u$2.fromJSON(i||{targetGeometry:r})}writeViewpoint(e,t,o,i){if(!e)return;const{targetGeometry:n}=e;if(r(n)&&"extent"!==n.type){const e="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";null!=i&&i.messages?i.messages.push(new s$a("property:unsupported",e)):v.error(e);}else t[o]=e.toJSON();}clone(){return new j(l$6({name:this.name,thumbnail:this.thumbnail,viewpoint:this.viewpoint}))}};e$2([d$3({type:M,nonNullable:!0,json:{read:!1,write:{isRequired:!0}}})],g.prototype,"extent",null),e$2([d$3({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],g.prototype,"name",void 0),e$2([d$3({type:c$1,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.url)})}}})],g.prototype,"thumbnail",void 0),e$2([c$b("thumbnail")],g.prototype,"castThumbnail",null),e$2([d$3({type:u$2,nonNullable:!0,json:{write:!0}})],g.prototype,"viewpoint",null),e$2([o$1("viewpoint",["extent","viewpoint"])],g.prototype,"readViewpoint",null),e$2([r$1("viewpoint")],g.prototype,"writeViewpoint",null),g=j=e$2([i$a(b)],g);const x=g;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var c;let l=c=class extends p$9{constructor(o){super(o),this.background=null,this.rangeInfo=null,this.spatialReference=null,this.viewpoint=null;}clone(){return new c(l$6({background:this.background,rangeInfo:this.rangeInfo,spatialReference:this.spatialReference,viewpoint:this.viewpoint}))}};e$2([d$3({type:m$5})],l.prototype,"background",void 0),e$2([d$3({type:c$9})],l.prototype,"rangeInfo",void 0),e$2([d$3({type:k})],l.prototype,"spatialReference",void 0),e$2([d$3({type:u$2})],l.prototype,"viewpoint",void 0),l=c=e$2([i$a("esri.webmap.InitialViewProperties")],l);const m=l;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class e extends r$5{constructor(s,e){super(s,e,"webmap");}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const X=new e(2,23),Y="Web Map",Z=S$1.ofType(x),ee=S$1.ofType(l$4),te=s$9.getLogger("esri.WebMap"),re=new Map;re.set("image/jpeg","jpeg"),re.set("image/jpg","jpg"),re.set("image/png","png"),re.set("image/gif","gif");const ie="ArcGIS Pro",oe="ArcGIS API for JavaScript",ae="CollectorDisabled",se="Collector",ne="Data Editing",le="OfflineDisabled",pe="Offline",me="Workforce Project",ue="Workforce Worker",he="Workforce Dispatcher",de="Offline Map Areas",ce="FieldMapsDisabled",ye="DeveloperBasemap",we=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map((e=>e.toLowerCase()));let fe=class extends(l$5(m$4.LoadableMixin(n$6(j$1)))){constructor(e){super(e),this.applicationProperties=null,this.bookmarks=new Z,this.floorInfo=null,this.initialViewProperties=new m,this.portalItem=null,this.presentation=null,this.sourceVersion=null,this.widgets=null,this.utilityNetworks=null,this.authoringApp=this.authoringAppVersion=null,this._isAuthoringAppSetByUser=this._isAuthoringAppVersionSetByUser=!1;}destroy(){const e=this.portalItem;this.portalItem=null,null==e||e.destroy();}initialize(){if(this.when().catch((e=>{te.error("#load()","Failed to load web map",e);})),this.resourceInfo){let t;try{t=this._validateJSON(this.resourceInfo);}catch(e){return void this.addResolvingPromise(Promise.reject(e))}this.read(t);}}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e);}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp=oe;}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e);}writeAuthoringAppVersion(e,r){e&&this._isAuthoringAppVersionSetByUser?r.authoringAppVersion=e:r.authoringAppVersion=a$9;}readInitialViewProperties(e$1,t){var r;const o=new m;t.background&&(o.background=m$5.fromJSON(t.background));const a=null==(r=t.initialState)?void 0:r.viewpoint;if(a){if(a.rotation){e.parse(t.version||"","webmap").lessThan(2,20)&&t.authoringApp===ie&&(a.rotation*=-1);}o.viewpoint=u$2.fromJSON(a);}return t.mapRangeInfo&&(o.rangeInfo=c$9.fromJSON(t.mapRangeInfo)),t.spatialReference&&(o.spatialReference=k.fromJSON(t.spatialReference)),o}writeInitialViewProperties(e,t,r,i){if(!e)return;const o=e.background;o&&o.color&&(t.background=o.write({},i)),e.viewpoint&&(t.initialState={viewpoint:e.viewpoint.write({},i)}),e.rangeInfo&&(t.mapRangeInfo=e.rangeInfo.toJSON(i)),e.spatialReference&&(t.spatialReference=e.spatialReference.write({},i));}writeLayers(e,t,r,i){t[r]=this._writeLayers(e,i,"operational-layers");}readSourceVersion(e$1,t){const[r,i]=t.version.split(".");return new e(parseInt(r,10),parseInt(i,10))}writeSourceVersion(e,t,r){t[r]=`${X.major}.${X.minor}`;}writeTables(e,t,r,i){const o=this._writeLayers(e,i,"tables");o.length&&(t[r]=o);}get thumbnailUrl(){return this.portalItem&&this.portalItem.thumbnailUrl||null}set thumbnailUrl(e){e?(this._override("thumbnailUrl",e),this._thumbnailFilename=this._generateCustomThumbnailFilename(e)):this._clearThumbnailOverride();}load(e){return this.addResolvingPromise(this._loadFromSource()),Promise.resolve(this)}loadAll(){return n$7(this,(e=>{e(this.ground,this.basemap,this.layers,this.tables);}))}read(e,t){t={...t,origin:"web-map"};const r=this._getAuthoringPropsState();d$4(this,e,(t=>super.read(e,t)),t),this._restoreAuthoringPropsFromState(r);}write(e,t){if("loaded"!==this.loadStatus){const e=new s$a("webmap:not-loaded","Web map must be loaded before it can be serialized");throw te.error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),e}return this._removeDanglingLayerRefs(),t={...t,origin:"web-map",restrictedWebMapWriting:!0,webmap:this},super.write(e,t)}async save(e){e=e||{},this._validateItem(),await this._updateFromPromise,await this.load(),await this._loadLayerContainers(),await this._beforeSave(),this._validateMap();const t=this.portalItem,r={origin:"web-map",messages:[],writtenProperties:[],url:t.itemUrl&&U(t.itemUrl),portal:t.portal||B.getDefault()},i=this.write({},r);return this._validateJSONForWriting(r,e),await this._updateItemProperties(t),await this._updateItem(t,i,r),await this._updateItemThumbnail(),t}async saveAs(e,t){t=t||{};const r=this._getPortalItem(e);await this._updateFromPromise,await this.load(),await this._loadLayerContainers(),await this._beforeSave(),this._validateMap();const i={origin:"web-map",messages:[],writtenProperties:[],url:null,portal:r.portal},o=this.write({},i);this._validateJSONForWriting(i,t),await this._updateItemPropertiesForSaveAs(r);const a=this._getThumbnailState();return await this._createItem(r,o,i,t),this._restoreThumbnailFromState(a),await this._updateItemThumbnail(),r}async updateFrom(e,t){const r=this._updateFromInternal(e,t);this._updateFromPromise=r,await r;r===this._updateFromPromise&&(this._updateFromPromise=null);}getLayerJSONFromResourceInfo(e){var t,r,i,a;const s=this.resourceInfo;return this._collectAllLayersJSON(M$1([null==s||null==(t=s.baseMap)?void 0:t.baseMapLayers,null==s?void 0:s.operationalLayers,null==(r=this.basemap)||null==(i=r.resourceInfo)||null==(a=i.data)?void 0:a.baseMapLayers])).find((t=>t.id===e.id))}_collectAllLayersJSON(e){return e.reduce(((e,t)=>(e.push(t),"GroupLayer"===t.layerType&&(e=e.concat(this._collectAllLayersJSON(t.layers||[]))),e)),[])}_writeLayers(e,t,r){t={...t,layerContainerType:r};return e.map((e=>e$3(y$3(e,"tables"===r?null:this.getLayerJSONFromResourceInfo(e),t)))).filter(Boolean).toArray()}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-map"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):Promise.resolve(null)}_loadFromItem(e){return e.load().catch((e=>{throw new s$a("webmap:load-portal-item","Failed to load portal item",{error:e})})).then((()=>{if("Web Map"!==e.type)throw new s$a("webmap:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Map'",{type:e.type})})).then((()=>e.fetchData())).then((t=>(this.resourceInfo=t,this._readAndLoadFromJSON(t,{origin:"web-map",portal:e.portal||B.getDefault()})))).then((()=>this._computeInitialViewpoint()))}_readAndLoadFromJSON(e,t){const r=this._validateJSON(e);return this.read(r,t),this._loadFromJSON(r,t)}_validateJSON(e$1){const t=e.parse(e$1.version||"","webmap");return X.validate(t),e$1.version=`${t.major}.${t.minor}`,e$1}_loadFromJSON(e,t){const r={context:{...t,layerContainerType:"operational-layers"}};return this.portalItem&&(r.context.portal=this.portalItem.portal||B.getDefault()),import('./layersCreator-3e395a16.js').then((({populateOperationalLayers:t})=>{const i=[],o=e.operationalLayers;o&&o.length&&i.push(t(this.layers,o,r));const a={...r,context:{...r.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"},s=e.tables;return s&&s.length&&i.push(t(this.tables,s,a)),T(i).then((()=>{}))}))}async _computeInitialViewpoint(){var e,t;let r=this.initialViewProperties;if(null==(e=r)||null==(t=e.viewpoint)?void 0:t.targetGeometry)return;const o=await this._getExtentFromItem();o&&(r=r?r.clone():new m,r.viewpoint=new u$2,r.viewpoint.targetGeometry=o,this.initialViewProperties=r);}async _getExtentFromItem(){var e,t;const r=null==(e=this.initialViewProperties)?void 0:e.spatialReference,i=null==(t=this.portalItem)?void 0:t.extent;if(r&&i){if(r.isWGS84)return i.clone();if(r.isWebMercator)return R(i);return (await import('./geometryServiceUtils-d82d2cfa.js')).getGeometryServiceURL(this.portalItem).then((e=>{const t=new a$a;return t.geometries=[i],t.outSpatialReference=r,n$8(e,t)})).then((e=>e[0])).catch((e=>(te.error("Error projecting item's extent:",e),null)))}return null}_removeDanglingLayerRefs(){const e=this.applicationProperties,t=e&&e.viewing&&e.viewing.search,r=e=>!!this.allLayers.find((t=>t.id===e));t&&t.layers&&(t.layers=t.layers.filter((e=>r(e.id)))),t&&t.tables&&(t.tables=t.tables.filter((e=>!!this.tables.find((t=>t.id===e.id)))));const i=e&&e.editing&&e.editing.locationTracking;i&&i.info&&!r(i.info.layerId)&&(e.editing=null);const o=this.presentation&&this.presentation.slides;o&&o.forEach((e=>{e.visibleLayers&&(e.visibleLayers=e.visibleLayers.filter((e=>r(e.id))));}));}_validateMap(){if(!this.basemap||!this.basemap.baseLayers.length)throw new s$a("webmap:save","Map does not have a valid basemap with a base layer.")}_validateItem(){if(!this.portalItem)throw te.error("save: requires the portalItem property to be set"),new s$a("webmap:portal-item-not-set","Portal item to save to has not been set on the WebMap");this._validateItemType(this.portalItem);}_validateItemType(e){if(e.type!==Y)throw new s$a("webmap:portal-item-wrong-type",`Portal item needs to have type "${Y}"`)}_loadLayerContainers(){const e=[];return this.basemap&&e.push(this.basemap.load()),this.ground&&e.push(this.ground.load()),T(e).then((()=>{}))}async _beforeSave(){const e=[];for(const t of this.allLayers)if("beforeSave"in t&&"function"==typeof t.beforeSave){const r=t.beforeSave();r&&e.push(r);}await T(e);}_loadAllLayers(){const e=this._getAllLayersAndTables().map((e=>e.load()));return T(e).then((()=>{}))}_getAllLayersAndTables(){return this.allLayers.concat(this.allTables)}_validateJSONForWriting(e,t){let r=e.messages.filter((e=>"error"===e.type)).map((e=>new s$a(e.name,e.message,e.details)));if(t.ignoreUnsupported&&(r=r.filter((e=>"layer:unsupported"!==e.name&&"symbol:unsupported"!==e.name&&"symbol-layer:unsupported"!==e.name&&"property:unsupported"!==e.name&&"url:unsupported"!==e.name))),r.length>0)throw new s$a("webmap:save","Failed to save webmap due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}async _updateItemProperties(e){e.extent=await this._getWGS84Extent(this.initialViewProperties.viewpoint.targetGeometry),await this._updateTypeKeywords(e);}async _updateItemPropertiesForSaveAs(e){n$9(e,ae),n$9(e,le),n$9(e,me),n$9(e,ue),n$9(e,he),n$9(e,de),n$9(e,ce),await this._updateItemProperties(e);}async _getWGS84Extent(e){const t=e.clone().normalize();let r;if(t.length>1)for(const i of t)r?i.width>r.width&&(r=i):r=i;else r=t[0];return this._projectToWGS84(r)}async _projectToWGS84(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return j$2(e);const r=await import('./geometryServiceUtils-d82d2cfa.js'),i=await r.getGeometryServiceURL(this.portalItem),o=new a$a;o.geometries=[e],o.outSpatialReference=k.WGS84;return (await n$8(i,o))[0]}async _updateTypeKeywords(e){e$4(e,oe),await this._loadAllLayers(),this._evalCollectorKeyword(e),this._evalDataEditingKeyword(e),this._evalOfflineKeyword(e),this._evalDeveloperBasemapKeyword(e),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)));}_evalCollectorKeyword(e){t$3(e,ae)||t$3(e,me)||t$3(e,ue)||t$3(e,he)||!this._hasEditableFeatureLayer()?n$9(e,se):e$4(e,se);}_evalDataEditingKeyword(e){this._hasEditableFeatureLayer()?e$4(e,ne):n$9(e,ne);}_evalOfflineKeyword(e){!t$3(e,le)&&this._isOfflineCapableMap()?e$4(e,pe):n$9(e,pe);}_evalDeveloperBasemapKeyword(e){d$5(this.basemap)?e$4(e,ye):n$9(e,ye);}_hasEditableFeatureLayer(){return this._getAllLayersAndTables().some((e=>e.loaded&&this._isFeatureServiceLayer(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled))}_isFeatureServiceLayer(e){return !("feature"!==e.type||!e.source||"feature-layer"!==e.source.type)}_isOfflineCapableMap(){return this._getAllLayersAndTables().filter((e=>"group"!==e.type)).every((e=>e.loaded&&this._isOfflineCapableLayer(e)))}_isOfflineCapableLayer(e){return this._isFeatureServiceLayer(e)&&e.capabilities.operations.supportsSync||("tile"===e.type||"vector-tile"===e.type)&&(e.capabilities.operations.supportsExportTiles||this._isExportableAGOLTileLayer(e)||S$2(e))&&e.spatialReference.equals(this.initialViewProperties.spatialReference)}_isExportableAGOLTileLayer(e){return "tile"===e.type&&(L(e.url)&&we.some((t=>e.url.toLowerCase().indexOf("/"+t+"/")>-1)))}async _updateItem(e,t,r){await e.update({data:t}),this._syncUpInstanceWithItem(e,t,r);}async _createItem(e,t,r,i){const o=this.portalItem,a=!!(o&&o.id&&o.portal.user),n=e.portal;if(await n._signIn(),!await this._canCopyItem(o,a,n))throw new s$a("webmap:save-as-copy-not-allowed","Owner of this map does not allow others to save a copy");await n.user.addItem({item:e,folder:i.folder,data:t}),this.portalItem=e,this._syncUpInstanceWithItem(e,t,r);}async _canCopyItem(e,t,r$1){return !(r(e)&&e.id&&e.typeKeywords&&e.typeKeywords.indexOf("useOnly")>-1)||e.portal.portalHostname===r$1.portalHostname&&(t||await e.reload(),"admin"===e.itemControl||"update"===e.itemControl)}_syncUpInstanceWithItem(e,t,r){O.prototype.read.call(this,{version:t.version,authoringApp:t.authoringApp,authoringAppVersion:t.authoringAppVersion},{origin:"web-map",ignoreDefaults:!0,url:e.itemUrl&&U(e.itemUrl)}),r$6(r),this.resourceInfo=t;}async _updateItemThumbnail(){this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename}),this._clearThumbnailOverride());}_getPortalItem(e){let t=b$3.from(e);return t.id&&(t=t.clone(),t.id=null),t.type||(t.type=Y),t.portal||(t.portal=B.getDefault()),this._validateItemType(t),t}async _updateFromInternal(e,t){if(t=t||{},await d$6(e,"ready"),this._updateInitialViewProperties(e,t),e.map===this)for(const r of e.allLayerViews)for(const e of ["visible","featureEffect"])e in r&&e in r.layer&&r._isOverridden(e)&&(r.layer[e]=r[e]);await this._updateThumbnailUrl(e,t);}_updateInitialViewProperties(e,t){var r;t.backgroundExcluded||(this.initialViewProperties.background=null==(r=e.background)?void 0:r.clone());if(this.initialViewProperties.spatialReference=e.spatialReference.clone(),t.viewpointExcluded||(this.initialViewProperties.viewpoint=new u$2({rotation:e.rotation,scale:t.scalePreserved?e.scale:null,targetGeometry:this._getViewExtent(e)})),!t.widgetsExcluded)for(const i of e.persistableViewModels)i.updateWebDocument(this);}_getViewExtent(e){const t=e.center.clone().normalize(),r=e.extent.clone(),i=r.width/2;return r.xmin=t.x-i,r.xmax=t.x+i,r}async _updateThumbnailUrl(e,t){if(t.thumbnailExcluded)return;const r=i$3(e,t.thumbnailSize),i=await e.takeScreenshot({format:"png",width:r.width,height:r.height});this._setAutoGeneratedThumbnail(i.dataUrl);}_setAutoGeneratedThumbnail(e){this.thumbnailUrl=e,this._thumbnailFilename=null;}_clearThumbnailOverride(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null;}_generateCustomThumbnailFilename(e){if(G(e)){const t=V(e),r=t&&t.mediaType,i=r&&re.get(r.toLowerCase())||null,o=`thumbnail${Date.now()}`;return i?`${o}.${i}`:o}return null}_getThumbnailState(){let e=this.thumbnailUrl;return e&&(e=this._isOverridden("thumbnailUrl")?e:bt(e,"w","8192")),{thumbnailUrl:e,filename:this._thumbnailFilename}}_restoreThumbnailFromState(e){this.thumbnailUrl=e.thumbnailUrl,this._thumbnailFilename=e.filename;}_getAuthoringPropsState(){return {authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}_restoreAuthoringPropsFromState(e){e.isAuthoringAppSetByUser?this.authoringApp=e.authoringApp:this._isAuthoringAppSetByUser=!1,e.isAuthoringAppVersionSetByUser?this.authoringAppVersion=e.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1;}static fromJSON(e){const t=e;if(!t)throw new s$a("webmap:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:t})}};fe.VERSION=X,e$2([d$3({type:c$2,json:{write:!0}})],fe.prototype,"applicationProperties",void 0),e$2([d$3({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],fe.prototype,"authoringApp",null),e$2([r$1("authoringApp")],fe.prototype,"writeAuthoringApp",null),e$2([d$3({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],fe.prototype,"authoringAppVersion",null),e$2([r$1("authoringAppVersion")],fe.prototype,"writeAuthoringAppVersion",null),e$2([d$3({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],fe.prototype,"basemap",void 0),e$2([d$3({type:Z,json:{write:{overridePolicy:e=>({enabled:!!(e&&e.length>0),ignoreOrigin:!0})}}})],fe.prototype,"bookmarks",void 0),e$2([d$3({type:l$3,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],fe.prototype,"floorInfo",void 0),e$2([d$3({type:m,nonNullable:!0,json:{read:{source:["background","initialState.viewpoint","mapRangeInfo","spatialReference"]},write:{ignoreOrigin:!0,target:{background:{type:m$5},"initialState.viewpoint":{type:u$2},mapRangeInfo:{type:c$9},spatialReference:{type:k}}}}})],fe.prototype,"initialViewProperties",void 0),e$2([o$1("initialViewProperties")],fe.prototype,"readInitialViewProperties",null),e$2([r$1("initialViewProperties")],fe.prototype,"writeInitialViewProperties",null),e$2([d$3({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],fe.prototype,"layers",void 0),e$2([r$1("layers")],fe.prototype,"writeLayers",null),e$2([d$3({type:b$3})],fe.prototype,"portalItem",void 0),e$2([d$3({json:{write:!0}})],fe.prototype,"presentation",void 0),e$2([d$3()],fe.prototype,"resourceInfo",void 0),e$2([d$3({readOnly:!0,type:e,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],fe.prototype,"sourceVersion",void 0),e$2([o$1("sourceVersion")],fe.prototype,"readSourceVersion",null),e$2([r$1("sourceVersion")],fe.prototype,"writeSourceVersion",null),e$2([d$3({json:{read:!1,write:{ignoreOrigin:!0}}})],fe.prototype,"tables",void 0),e$2([r$1("tables")],fe.prototype,"writeTables",null),e$2([d$3()],fe.prototype,"thumbnailUrl",null),e$2([d$3({type:n$2,json:{write:!0}})],fe.prototype,"widgets",void 0),e$2([d$3({type:ee,json:{read:!0,write:!0}})],fe.prototype,"utilityNetworks",void 0),fe=e$2([i$a("esri.WebMap")],fe);const ge=fe;

const arcgisWebmapCss = "@import url('https://js.arcgis.com/next/esri/themes/light/main.css');.map-view{padding:0;margin:0}";

let ArcGISWebMap = class {
  constructor(hostRef) {
    registerInstance(this, hostRef);
  }
  validateApiKey(value) {
    t$4.apiKey = value;
  }
  validateItemId(value, old) {
    if (value && value !== old) {
      this.loadMap();
    }
  }
  componentWillLoad() {
    if (this.apiKey) {
      t$4.apiKey = this.apiKey;
    }
    if (this.itemId) {
      this.loadMap();
    }
  }
  componentDidRender() {
    const elem = this.el.querySelector('.esri-view-user-storage');
    if (elem) {
      const elems = Array.from(elem.children);
      for (let e of elems) {
        if (e.tagName.toLowerCase().includes('arcgis-')) {
          e.view = this.view;
        }
      }
    }
  }
  loadMap() {
    const map = new ge({
      portalItem: {
        id: this.itemId
      }
    });
    const params = {};
    if (this.zoom) {
      params.zoom = this.zoom;
    }
    if (this.center) {
      if (typeof this.center === 'string') {
        params.center = this.center.split(',').map((x) => Number(x));
      }
      else {
        params.center = this.center;
      }
    }
    const view = new G$1(Object.assign({ container: this.el, map }, params));
    this.view = view;
    view.when(() => console.log('view ready'));
  }
  render() {
    return (h$3("div", { class: "map-view" }));
  }
  get el() { return getElement(this); }
  static get watchers() { return {
    "apiKey": ["validateApiKey"],
    "itemId": ["validateItemId"]
  }; }
};
ArcGISWebMap.style = arcgisWebmapCss;

export { ArcGISWebMap as arcgis_webmap };
