import{e as t,d as n,i as r,r as o,v as e,t as a}from"./p-9ae46e68.js";import{bY as s,bg as i,$ as u,bd as l,bv as c,c5 as f,E as p,c6 as m,c7 as h,c8 as b,c9 as y,ca as g,cb as v,bb as F,bc as A,cc as w,cd as j,bX as d,ce as x,aJ as P,b0 as C}from"./p-566b0715.js";import{e as N,a as M}from"./p-2794293b.js";import{i as z,f as B,c as I,h as q,e as L,C as O,B as E}from"./p-138c2b2c.js";import{e as J,a as R}from"./p-01158f1c.js";import{a as T,o as U,j as X,B as Y}from"./p-39da60a5.js";import{v as $,x as k}from"./p-bae36c84.js";import{a as D}from"./p-fe01b82b.js";import{I as G,v as H,P as K}from"./p-e49afbb8.js";import{T as Q,i as S}from"./p-19c767c2.js";import{e as V,a as W,f as Z,o as _}from"./p-76b2eeb3.js";function tt(t=at){return[t[0],t[1],t[2],t[3]]}function nt(t,n,r=tt()){return s(r,t),r[3]=n,r}function rt(t,n,r=tt()){return G(st,t,et(t)),G(it,n,et(n)),H(st,it,st),function(t,n){return t[3]=n,t}(r,u(K(r,st)))}function ot(t){return t}function et(t){return i(t[3])}const at=[0,0,1,0],st=N(),it=N();var ut;let lt=ut=class extends D{constructor(t){super(t),this.origin=l(),this.translation=l(),this.rotation=tt(),this.scale=c(1,1,1),this.geographic=!0}get localMatrix(){const t=J();return z(t,t,this.scale),B(t,t,et(this.rotation),this.rotation),I(t,t,this.translation),t}get localMatrixInverse(){return q(J(),this.localMatrix)}applyLocal(t,n){return f(n,t,this.localMatrix)}applyLocalInverse(t,n){return f(n,t,this.localMatrixInverse)}project(t,n){const r=new Float64Array(t.length),o=Q.fromTypedArray(r),e=Q.fromTypedArray(t);if(this.geographic){const t=h(y(n)),a=J();return $(n,this.origin,a,t),L(a,a,this.localMatrix),V(o,e,a),k(r,t,0,r,n,0,r.length/3),r}const{localMatrix:a,origin:s}=this;O(a,R)?W(o,e):V(o,e,a);for(let t=0;t<r.length;t+=3)r[t+0]+=s[0],r[t+1]+=s[1],r[t+2]+=s[2];return r}getOriginPoint(t){const[n,r,o]=this.origin;return new p({x:n,y:r,z:o,spatialReference:t})}equals(t){return o(t)&&this.geographic===t.geographic&&m(this.origin,t.origin)&&E(this.localMatrix,t.localMatrix)}clone(){const t={origin:b(this.origin),translation:b(this.translation),rotation:tt(this.rotation),scale:b(this.scale),geographic:this.geographic};return new ut(t)}};t([n({type:[Number],nonNullable:!0,json:{write:!0}})],lt.prototype,"origin",void 0),t([n({type:[Number],nonNullable:!0,json:{write:!0}})],lt.prototype,"translation",void 0),t([n({type:[Number],nonNullable:!0,json:{write:!0}})],lt.prototype,"rotation",void 0),t([n({type:[Number],nonNullable:!0,json:{write:!0}})],lt.prototype,"scale",void 0),t([n({type:Boolean,nonNullable:!0,json:{write:!0}})],lt.prototype,"geographic",void 0),t([n()],lt.prototype,"localMatrix",null),t([n()],lt.prototype,"localMatrixInverse",null),lt=ut=t([r("esri.geometry.support.MeshTransform")],lt);const ct=lt;function ft(t,n){var r;return t.isGeographic||t.isWebMercator&&(null==(r=null==n?void 0:n.geographic)||r)}const pt=e.getLogger("esri.geometry.support.meshUtils.normalProjection");function mt(t,n,r,o,e){return dt(o)?(jt(0,S.fromTypedArray(t),Q.fromTypedArray(n),Q.fromTypedArray(r),o,S.fromTypedArray(e)),e):(pt.error("Cannot convert spatial reference to PCPF"),e)}function ht(t,n,r,o,e){return dt(o)?(jt(1,S.fromTypedArray(t),Q.fromTypedArray(n),Q.fromTypedArray(r),o,S.fromTypedArray(e)),e):(pt.error("Cannot convert to spatial reference from PCPF"),e)}function bt(t,n,r){return k(t,n,0,r,g(n),0,t.length/3),r}function yt(t,n,r){return k(t,g(r),0,n,r,0,t.length/3),n}function gt(t,n,r){if(a(t))return n;const o=Q.fromTypedArray(t),e=Q.fromTypedArray(n);return V(e,o,r),n}function vt(t,n,r){if(a(t))return n;X(Mt,r);const o=S.fromTypedArray(t),e=S.fromTypedArray(n);return Z(e,o,Mt),Y(Mt)||_(e,e),n}function Ft(t,n,r){if(a(t))return n;X(Mt,r);const o=S.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),e=S.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT);if(Z(e,o,Mt),Y(Mt)||_(e,e),t!==n)for(let r=3;r<t.length;r+=4)n[r]=t[r];return n}function At(t,n,r,o,e){if(!dt(o))return pt.error("Cannot convert spatial reference to PCPF"),e;jt(0,S.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Q.fromTypedArray(n),Q.fromTypedArray(r),o,S.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<t.length;n+=4)e[n]=t[n];return e}function wt(t,n,r,o,e){if(!dt(o))return pt.error("Cannot convert to spatial reference from PCPF"),e;jt(1,S.fromTypedArray(t,16),Q.fromTypedArray(n),Q.fromTypedArray(r),o,S.fromTypedArray(e,16));for(let n=3;n<t.length;n+=4)e[n]=t[n];return e}function jt(t,n,r,o,e,a){if(!n)return;const s=r.count,i=g(e);if(xt(e))for(let r=0;r<s;r++)o.getVec(r,Pt),n.getVec(r,Ct),$(i,Pt,Nt,i),T(Mt,Nt),1===t&&U(Mt,Mt),w(Ct,Ct,Mt),a.setVec(r,Ct);else for(let e=0;e<s;e++){o.getVec(e,Pt),n.getVec(e,Ct),$(i,Pt,Nt,i),T(Mt,Nt);const s=j(r.get(e,1));let u=Math.cos(s);0===t&&(u=1/u),Mt[0]*=u,Mt[1]*=u,Mt[2]*=u,Mt[3]*=u,Mt[4]*=u,Mt[5]*=u,1===t&&U(Mt,Mt),w(Ct,Ct,Mt),d(Ct,Ct),a.setVec(e,Ct)}return a}function dt(t){return xt(t)||function(t){return t.isWebMercator}(t)}function xt(t){return t.isWGS84||v(t)||F(t)||A(t)}const Pt=l(),Ct=l(),Nt=J(),Mt=M();function zt(t,n,r){return ft(n.spatialReference,r)?function(t,n,r){const o=n.spatialReference,e=Tt(n,r,$t),a=new Float64Array(t.position.length),s=function(t,n,r,o){V(Q.fromTypedArray(o),Q.fromTypedArray(t),n);return yt(o,new Float64Array(t.length),r)}(t.position,e,o,a),i=X(Dt,e);return{position:s,normal:Ot(s,a,t.normal,i,o),tangent:Et(s,a,t.tangent,i,o)}}(t,n,r):function(t,n,r){const o=new Float64Array(t.position.length),e=t.position,a=n.x,s=n.y,i=n.z||0,{horizontal:u,vertical:l}=Yt(r?r.unit:null,n.spatialReference);for(let t=0;t<e.length;t+=3)o[t+0]=e[t+0]*u+a,o[t+1]=e[t+1]*u+s,o[t+2]=e[t+2]*l+i;return{position:o,normal:t.normal,tangent:t.tangent}}(t,n,r)}function Bt(t,n,r){const{position:e,normal:s,tangent:i}=t;if(a(n))return{position:e,normal:s,tangent:i};const u=n.localMatrix;return zt({position:gt(e,new Float64Array(e.length),u),normal:o(s)?vt(s,new Float32Array(s.length),u):null,tangent:o(i)?Ft(i,new Float32Array(i.length),u):null},n.getOriginPoint(r),{geographic:n.geographic})}function It(t,n,r){if(null!=r&&r.useTransform){var o;const{position:e,normal:a,tangent:s}=t;return{vertexAttributes:{position:e,normal:a,tangent:s},transform:new ct({origin:[n.x,n.y,null!=(o=n.z)?o:0],geographic:ft(n.spatialReference,r)})}}return{vertexAttributes:zt(t,n,r),transform:null}}function qt(t,n,r){return ft(n.spatialReference,r)?Rt(t,n,r):Jt(t,n,r)}function Lt(t,n,r,o){if(a(n))return qt(t,r,o);const e=Bt(t,n,r.spatialReference);return r.equals(n.getOriginPoint(r.spatialReference))?Jt(e,r,o):ft(r.spatialReference,o)?Rt(e,r,o):Jt(e,r,o)}function Ot(t,n,r,o,e){if(a(r))return null;const s=new Float32Array(r.length);return Z(S.fromTypedArray(s),S.fromTypedArray(r),o),ht(s,t,n,e,s),s}function Et(t,n,r,o,e){if(a(r))return null;const s=new Float32Array(r.length);Z(S.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT),S.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),o);for(let t=3;t<s.length;t+=4)s[t]=r[t];return wt(s,t,n,e,s),s}function Jt(t,n,r){const o=new Float64Array(t.position.length),e=t.position,a=n.x,s=n.y,i=n.z||0,{horizontal:u,vertical:l}=Yt(r?r.unit:null,n.spatialReference);for(let t=0;t<e.length;t+=3)o[t+0]=(e[t+0]-a)/u,o[t+1]=(e[t+1]-s)/u,o[t+2]=(e[t+2]-i)/l;return{position:o,normal:t.normal,tangent:t.tangent}}function Rt(t,n,r){const o=n.spatialReference;Tt(n,r,$t);const e=q(kt,$t),a=new Float64Array(t.position.length),s=function(t,n,r,o){const e=bt(t,n,o),a=Q.fromTypedArray(e),s=new Float64Array(e.length),i=Q.fromTypedArray(s);return V(i,a,r),s}(t.position,o,e,a),i=X(Dt,e);return{position:s,normal:Ut(t.normal,t.position,a,o,i),tangent:Xt(t.tangent,t.position,a,o,i)}}function Tt(t,n,r){$(t.spatialReference,[t.x,t.y,t.z||0],r,g(t.spatialReference));const{horizontal:o,vertical:e}=Yt(n?n.unit:null,t.spatialReference);return z(r,r,[o,o,e]),r}function Ut(t,n,r,o,e){if(a(t))return null;const s=mt(t,n,r,o,new Float32Array(t.length)),i=S.fromTypedArray(s);return Z(i,i,e),s}function Xt(t,n,r,o,e){if(a(t))return null;const s=At(t,n,r,o,new Float32Array(t.length)),i=S.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT);return Z(i,i,e),s}function Yt(t,n){if(a(t))return Gt;const r=n.isGeographic?1:x(n),o=n.isGeographic?1:P(n),e=C(1,t,"meters");return{horizontal:e*r,vertical:e*o}}const $t=J(),kt=J(),Dt=M(),Gt={horizontal:1,vertical:1};export{At as B,mt as F,yt as M,ct as O,wt as R,Bt as _,ht as a,It as b,tt as c,et as d,nt as e,Lt as f,qt as k,ot as l,rt as q,ft as r,bt as v,zt as x}