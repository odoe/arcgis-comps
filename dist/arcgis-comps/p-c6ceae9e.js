import{e as t,d as n,i as r,a1 as o,aE as a,A as e,af as s}from"./p-e58503d5.js";import{e as i,p as l,L as u,Y as c,D as f,d as p}from"./p-01e5a461.js";import{e as m}from"./p-8f986f60.js";import{i as h,f as g,c as y,h as w,e as v,C as A,B as j}from"./p-ccdb8e80.js";import{e as F,a as b}from"./p-2c84c65f.js";import{j as d}from"./p-b9aa4901.js";import{v as x,x as N}from"./p-c93d2280.js";import{I as M,F as z}from"./p-2f398ed1.js";import{n as I,r as L,b as B}from"./p-d3105731.js";import{a as O,l as k,x as q}from"./p-9bdf9304.js";import{T as C,i as D}from"./p-f06611ed.js";import{a as E,e as P,f as R}from"./p-2f5c7e83.js";import{M as T,_ as V,R as Y,v as _,F as G,B as H,V as J,k as K,L as Q}from"./p-c7a58085.js";var S;let U=S=class extends o{constructor(t){super(t),this.origin=I(),this.translation=I(),this.rotation=O(),this.scale=L(1,1,1),this.geographic=!0}get localMatrix(){const t=F();return h(t,t,this.scale),g(t,t,q(this.rotation),k(this.rotation)),y(t,t,this.translation),t}get localMatrixInverse(){return w(F(),this.localMatrix)}applyLocal(t,n){return M(n,t,this.localMatrix)}applyLocalInverse(t,n){return M(n,t,this.localMatrixInverse)}project(t,n){const r=new Float64Array(t.length),o=C.fromTypedArray(r),a=C.fromTypedArray(t);if(this.geographic){const t=i(l(n)),e=F();return x(n,this.origin,e,t),v(e,e,this.localMatrix),E(o,a,e),N(r,t,0,r,n,0,r.length/3),r}const{localMatrix:e,origin:s}=this;A(e,b)?P(o,a):E(o,a,e);for(let t=0;t<r.length;t+=3)r[t+0]+=s[0],r[t+1]+=s[1],r[t+2]+=s[2];return r}getOriginPoint(t){const[n,r,o]=this.origin;return new a({x:n,y:r,z:o,spatialReference:t})}equals(t){return e(t)&&this.geographic===t.geographic&&z(this.origin,t.origin)&&j(this.localMatrix,t.localMatrix)}clone(){const t={origin:B(this.origin),translation:B(this.translation),rotation:O(this.rotation),scale:B(this.scale),geographic:this.geographic};return new S(t)}};t([n({type:[Number],nonNullable:!0,json:{write:!0}})],U.prototype,"origin",void 0),t([n({type:[Number],nonNullable:!0,json:{write:!0}})],U.prototype,"translation",void 0),t([n({type:[Number],nonNullable:!0,json:{write:!0}})],U.prototype,"rotation",void 0),t([n({type:[Number],nonNullable:!0,json:{write:!0}})],U.prototype,"scale",void 0),t([n({type:Boolean,nonNullable:!0,json:{write:!0}})],U.prototype,"geographic",void 0),t([n()],U.prototype,"localMatrix",null),t([n()],U.prototype,"localMatrixInverse",null),U=S=t([r("esri.geometry.support.MeshTransform")],U);const W=U;function X(t,n){var r;return t.isGeographic||t.isWebMercator&&(null==(r=null==n?void 0:n.geographic)||r)}function Z(t,n,r){return X(n.spatialReference,r)?function(t,n,r){const o=n.spatialReference,a=it(n,r,ft),e=new Float64Array(t.position.length),s=function(t,n,r,o){E(C.fromTypedArray(o),C.fromTypedArray(t),n);const a=new Float64Array(t.length);return T(o,a,r)}(t.position,a,o,e),i=d(mt,a);return{position:s,normal:ot(s,e,t.normal,i,o),tangent:at(s,e,t.tangent,i,o)}}(t,n,r):function(t,n,r){const o=new Float64Array(t.position.length),a=t.position,e=n.x,s=n.y,i=n.z||0,{horizontal:l,vertical:u}=ct(r?r.unit:null,n.spatialReference);for(let t=0;t<a.length;t+=3)o[t+0]=a[t+0]*l+e,o[t+1]=a[t+1]*l+s,o[t+2]=a[t+2]*u+i;return{position:o,normal:t.normal,tangent:t.tangent}}(t,n,r)}function $(t,n,r){const{position:o,normal:a,tangent:i}=t;if(s(n))return{position:o,normal:a,tangent:i};const l=n.localMatrix;return Z({position:J(o,new Float64Array(o.length),l),normal:e(a)?K(a,new Float32Array(a.length),l):null,tangent:e(i)?Q(i,new Float32Array(i.length),l):null},n.getOriginPoint(r),{geographic:n.geographic})}function tt(t,n,r){if(null!=r&&r.useTransform){var o;const{position:a,normal:e,tangent:s}=t;return{vertexAttributes:{position:a,normal:e,tangent:s},transform:new W({origin:[n.x,n.y,null!=(o=n.z)?o:0],geographic:X(n.spatialReference,r)})}}return{vertexAttributes:Z(t,n,r),transform:null}}function nt(t,n,r){return X(n.spatialReference,r)?st(t,n,r):et(t,n,r)}function rt(t,n,r,o){if(s(n))return nt(t,r,o);const a=$(t,n,r.spatialReference);return r.equals(n.getOriginPoint(r.spatialReference))?et(a,r,o):X(r.spatialReference,o)?st(a,r,o):et(a,r,o)}function ot(t,n,r,o,a){if(s(r))return null;const e=new Float32Array(r.length);return R(D.fromTypedArray(e),D.fromTypedArray(r),o),V(e,t,n,a,e),e}function at(t,n,r,o,a){if(s(r))return null;const e=new Float32Array(r.length);R(D.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),D.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),o);for(let t=3;t<e.length;t+=4)e[t]=r[t];return Y(e,t,n,a,e),e}function et(t,n,r){const o=new Float64Array(t.position.length),a=t.position,e=n.x,s=n.y,i=n.z||0,{horizontal:l,vertical:u}=ct(r?r.unit:null,n.spatialReference);for(let t=0;t<a.length;t+=3)o[t+0]=(a[t+0]-e)/l,o[t+1]=(a[t+1]-s)/l,o[t+2]=(a[t+2]-i)/u;return{position:o,normal:t.normal,tangent:t.tangent}}function st(t,n,r){const o=n.spatialReference;it(n,r,ft);const a=w(pt,ft),e=new Float64Array(t.position.length),s=function(t,n,r,o){const a=_(t,n,o),e=C.fromTypedArray(a),s=new Float64Array(a.length),i=C.fromTypedArray(s);return E(i,e,r),s}(t.position,o,a,e),i=d(mt,a);return{position:s,normal:lt(t.normal,t.position,e,o,i),tangent:ut(t.tangent,t.position,e,o,i)}}function it(t,n,r){x(t.spatialReference,[t.x,t.y,t.z||0],r,p(t.spatialReference));const{horizontal:o,vertical:a}=ct(n?n.unit:null,t.spatialReference);return h(r,r,[o,o,a]),r}function lt(t,n,r,o,a){if(s(t))return null;const e=G(t,n,r,o,new Float32Array(t.length)),i=D.fromTypedArray(e);return R(i,i,a),e}function ut(t,n,r,o,a){if(s(t))return null;const e=H(t,n,r,o,new Float32Array(t.length)),i=D.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT);return R(i,i,a),e}function ct(t,n){if(s(t))return ht;const r=n.isGeographic?1:u(n),o=n.isGeographic?1:c(n),a=f(1,t,"meters");return{horizontal:a*r,vertical:a*o}}const ft=F(),pt=F(),mt=m(),ht={horizontal:1,vertical:1};export{rt as M,W as O,$ as _,tt as b,nt as k,X as r,Z as x}