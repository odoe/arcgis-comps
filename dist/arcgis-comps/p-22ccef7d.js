import{e as i,d as t,i as e,p as n,H as l}from"./p-e58503d5.js";import{u as r}from"./p-a131049b.js";import{B as s,H as u,K as o,f as a,i as d,j as h,O as v,L as c,k as m,Z as g,l as f,o as p}from"./p-765e6c28.js";const y={type:"number"},b={type:"number",intlOptions:{notation:"scientific"}},F={type:"date",intlOptions:{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}};let _=class extends n{constructor(i){super(i),this.arcade=null,this.config=null,this.feature=null,this.field=null,this.initialFeature=null,this.layer=null,this.description=null,this.editorType=null,this.error=null,this.format=null,this.group=null,this.hint=null,this.messages=null,this.name=null}get compiledFunc(){var i;const{arcade:t}=this;return t&&t.arcadeUtils.createFunction(null==(i=this.config)?void 0:i.visibilityExpression)}get compiledRequiredFunc(){var i;const{arcade:t}=this;return t&&t.arcadeUtils.createFunction(null==(i=this.config)?void 0:i.requiredExpression)}get evaluatedRequirement(){const i=this.compiledRequiredFunc;if(!i)return null;const{arcade:t}=this;return t.arcadeUtils.executeFunction(i,t.arcadeUtils.createExecContext(this.feature))}get evaluatedVisibility(){const i=this.compiledFunc;if(!i)return null;const{arcade:t}=this;return t.arcadeUtils.executeFunction(i,t.arcadeUtils.createExecContext(this.feature))}get domain(){var i,t;const{typeIdField:e}=this.layer,n=null==(i=this.field)?void 0:i.domain;if(e===this.name&&!n)return new r({name:"__internal-type-based-coded-value-domain__",codedValues:this.layer.types.map((({id:i,name:t})=>({code:i,name:t})))});const{feature:l}=this,s=e&&this.layer.getFieldDomain(this.name,{feature:l})||n,u=null==(t=this.config)?void 0:t.domain;return this._isDomainCompatible(u)?u:s}get editable(){var i;return this.layer.capabilities.operations.supportsEditing&&this.field.editable&&!1!==(null==(i=this.config)?void 0:i.editable)}get errorMessage(){return this._toErrorMessage()}get includeTime(){var i;const t=null==(i=this.config)?void 0:i.includeTime;return void 0===t||t}get label(){var i;return(null==(i=this.config)?void 0:i.label)||this.field.alias||this.field.name}get maxLength(){var i,t;if("date"===this.type)return-1;const e=null==(i=this.field)?void 0:i.length,n=null==(t=this.config)?void 0:t.maxLength;return!isNaN(n)&&n>=-1&&(-1===e||n<=e)?n:e}get minLength(){var i,t;if("date"===this.type)return-1;const e=null==(i=this.field)?void 0:i.length,n=null==(t=this.config)?void 0:t.minLength;return!isNaN(n)&&n>=-1&&(-1===e||n<=e)?n:-1}get required(){var i,t;return!!this.editable&&(!(null==(i=this.field)?void 0:i.nullable)||("boolean"==typeof this.evaluatedRequirement?this.evaluatedRequirement:!0===(null==(t=this.config)?void 0:t.required)))}get type(){const{field:i}=this;return s(i)?"number":u(i)?"text":o(i)?"date":"unsupported"}get valid(){const i=this.editable?this._validate():null;return this._set("error",i),null===i}get value(){return this._get("value")}set value(i){this.notifyChange("evaluatedVisibility"),this._set("value",i)}get visible(){return!this._isEditorField()&&("boolean"==typeof this.evaluatedVisibility?this.evaluatedVisibility:!!this.config||this._shownByDefault())}_isDomainCompatible(i){const{field:t}=this;if("coded-value"===(null==i?void 0:i.type)){const e=typeof i.codedValues[0].code;if("string"===e&&u(t)||"number"===e&&s(t))return!0}return!!("range"===(null==i?void 0:i.type)&&s(t)||o(t))}_validate(){const{domain:i,field:t,initialFeature:e,minLength:n,required:l,type:r,valid:s,value:u}=this,o=l&&null===u,v=void 0!==s;return!o&&e.getAttribute(t.name)===u&&v?null:"text"===r&&n>-1&&"string"==typeof u&&u.length<n?"length-validation-error::too-short":i?null!==u||l?a(i,u):null:o?d.INVALID_TYPE:h(t,u)}_shownByDefault(){var i;const t=null==(i=this.field)?void 0:i.type;return"oid"!==t&&"global-id"!==t&&!this._isGeometryField()}_isEditorField(){return v(this.layer).indexOf(this.name)>-1}_isGeometryField(){return c(this.layer).indexOf(this.name)>-1}_toErrorMessage(){const{domain:i,field:t,messages:e,minLength:n,value:r,required:s,type:u}=this,o=this.error;if(s&&null===r)return e.validationErrors.cannotBeNull;if(o===m.VALUE_OUT_OF_RANGE||o===g.OUT_OF_RANGE){const n=f(i)||p(t);return l(e.validationErrors.outsideRange,n,{format:{max:"date"===u?F:n.isInteger?y:b,min:"date"===u?F:n.isInteger?y:b}})}return o===m.INVALID_CODED_VALUE?e.validationErrors.invalidCodedValue:o===d.INVALID_TYPE?e.validationErrors.invalidType:"length-validation-error::too-short"===o?l(e.validationErrors.tooShort,{min:n}):null}};i([t()],_.prototype,"arcade",void 0),i([t()],_.prototype,"compiledFunc",null),i([t()],_.prototype,"compiledRequiredFunc",null),i([t()],_.prototype,"config",void 0),i([t()],_.prototype,"evaluatedRequirement",null),i([t()],_.prototype,"evaluatedVisibility",null),i([t()],_.prototype,"feature",void 0),i([t()],_.prototype,"field",void 0),i([t()],_.prototype,"initialFeature",void 0),i([t()],_.prototype,"layer",void 0),i([t({aliasOf:"config.description"})],_.prototype,"description",void 0),i([t()],_.prototype,"domain",null),i([t()],_.prototype,"editable",null),i([t({aliasOf:"config.editorType"})],_.prototype,"editorType",void 0),i([t({readOnly:!0})],_.prototype,"error",void 0),i([t({dependsOn:["error","messages","value"]})],_.prototype,"errorMessage",null),i([t({aliasOf:"config.format"})],_.prototype,"format",void 0),i([t()],_.prototype,"group",void 0),i([t({aliasOf:"config.hint"})],_.prototype,"hint",void 0),i([t()],_.prototype,"includeTime",null),i([t()],_.prototype,"label",null),i([t()],_.prototype,"maxLength",null),i([t()],_.prototype,"minLength",null),i([t()],_.prototype,"messages",void 0),i([t({aliasOf:"field.name"})],_.prototype,"name",void 0),i([t()],_.prototype,"required",null),i([t()],_.prototype,"type",null),i([t()],_.prototype,"valid",null),i([t({value:null})],_.prototype,"value",null),i([t()],_.prototype,"visible",null),_=i([e("esri.widgets.FeatureForm.InputField")],_);const O=_;export{O as E}