import{r as e,c as t,h as s,g as i}from"./p-84bf99cb.js";import{e as r,d as n,i as o,v as l,m as u,t as a,r as c,s as h,q as d,H as g,W as p,O as v,_ as m,V as f,a7 as y,a5 as w,E as S,k as _,p as b,J as x,al as M,$ as I,a as R,K as j,a0 as k,aG as T,aF as C,aq as E,M as $,w as P,x as F,z as L,n as A,o as N,h as O,A as G,bT as B,y as z,bU as D,j as K}from"./p-9ae46e68.js";import{g as V,M as U,a7 as H,v as W,E as Z,k as q,h as J,R as Q,j as Y,aU as X,ap as ee,Y as te,ay as se,x as ie}from"./p-566b0715.js";import{a as re,e as ne,t as oe}from"./p-1d6f3ddb.js";import{a as le}from"./p-fe01b82b.js";import{c as ue}from"./p-3a79c3a6.js";import{e as ae,n as ce,r as he}from"./p-41655335.js";import{l as de}from"./p-a7080451.js";import"./p-f12eb522.js";import{a as ge,n as pe}from"./p-47bfad81.js";let ve=class extends(V(le)){constructor(e){super(e),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};r([n()],ve.prototype,"autoNavigate",void 0),r([n()],ve.prototype,"filter",void 0),r([n()],ve.prototype,"getResults",void 0),r([n()],ve.prototype,"getSuggestions",void 0),r([n()],ve.prototype,"maxResults",void 0),r([n()],ve.prototype,"maxSuggestions",void 0),r([n()],ve.prototype,"minSuggestCharacters",void 0),r([n()],ve.prototype,"outFields",void 0),r([n()],ve.prototype,"placeholder",void 0),r([n()],ve.prototype,"popupEnabled",void 0),r([n()],ve.prototype,"popupTemplate",void 0),r([n()],ve.prototype,"prefix",void 0),r([n()],ve.prototype,"resultGraphicEnabled",void 0),r([n()],ve.prototype,"resultSymbol",void 0),r([n()],ve.prototype,"suggestionsEnabled",void 0),r([n()],ve.prototype,"suffix",void 0),r([n()],ve.prototype,"withinViewEnabled",void 0),r([n()],ve.prototype,"zoomScale",void 0),ve=r([o("esri.widgets.Search.SearchSource")],ve);const me=ve,fe=l.getLogger("esri.widgets.Search.support.geometryUtils");function ye(e,t){var s,i;if(!t)return fe.error("missing-parameter: view is missing."),Promise.reject(new u("searchgeometryutils:missing-parameter","view is missing."));if(!e)return fe.error("missing-parameter: point is missing."),Promise.reject(new u("searchgeometryutils:missing-parameter","point is missing."));if(e.hasZ||"2d"===t.type)return Promise.resolve(e);const r=null==t||null==(s=t.map)?void 0:s.ground;return r&&r.layers.length?r.queryElevation(e,{cache:null==(i=t.basemapTerrain)?void 0:i.elevationQueryCache}).then((e=>e.geometry)):Promise.resolve(e)}function we(e){if(a(e))return null;switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":return e.getPoint(0);case"polyline":return e.getPoint(0,0)}return null}function Se(e,t,s){return a(e)?null:"extent"===e.type?e:"multipoint"===e.type||"polygon"===e.type||"polyline"===e.type?e.extent:"point"===e.type?be(e,t,s):void 0}function _e(e,t,s){return a(e)||a(t)?null:be(e.center,t,s)}function be(e,t,s){const i=e.hasZ?e.z:void 0;return t&&t.map?(s?ue(t,s):t.extent).clone().centerAt(e).set({zmax:i,zmin:i}):new U({xmin:e.x-.25,ymin:e.y-.25,xmax:e.x+.25,ymax:e.y+.25,spatialReference:e.spatialReference,zmin:i,zmax:i})}const xe=/https?:\/\/services.*\.arcgis\.com/i,Me=/(?:\{([^}]+)\})/g,Ie=l.getLogger("esri.widgets.Search.support.layerSearchUtils");function Re(e,t){const{filter:s,withinViewEnabled:i}=e,r=t&&t.extent;return s&&s.geometry||(i&&r?r:void 0)}function je(e){return e&&-1!==e.indexOf("*")}async function ke(e){e&&await e.load()}function Te(e){var t,s,i;return null!=(t=null==e||null==(s=e.capabilities)||null==(i=s.query)?void 0:i.supportsPagination)&&t}function Ce(e){return e.displayField||e.layer.displayField||function(e){var t,s,i,r;return null!=(t=null==e||null==(s=e.fieldsIndex)||null==(i=s.fields)||null==(r=i.find((e=>"string"===e.type)))?void 0:r.name)?t:""}(e.layer)}function Ee(e,t){return!(!e||!t)&&t.every((t=>$e(e,t)))}function $e(e,t){return!!e.getField(t)}function Pe(e){return e.replace(/\'/g,"''")}function Fe(e,t){const s=t&&t.where;return s?`(${e}) AND (${s})`:e}function Le({searchTerm:e,layer:t,searchFields:s,filter:i,exactMatch:r,type:n}){const{definitionExpression:o,url:l}=t;let u="";return e&&s&&s.forEach((s=>{const o=t.getField(s),a="function"==typeof t.getFieldDomain&&t.getFieldDomain(s),c=(a&&"coded-value"===a.type?function(e,t,s){let i=null;const{codedValues:r}=e;return r&&r.some((e=>{const r=e.name,n=s?r:r.toLowerCase();return(s?t:t.toLowerCase())===n&&(i=e.code.toString(),!0)})),i}(a,e,r):null)||e||null;if(null!==c){const e=function({currentTerm:e,field:t,filter:s,exactMatch:i,url:r,type:n}){const o=t.type,l=t.name;if("string"===o||"date"===o||"global-id"===o){const t=xe.test(r),o=t&&function(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}(e)?"N":"";if(i&&"search"===n)return Fe(`${l} = ${o}'${e}'`,s);const u=t?l:`UPPER(${l})`,a=t?e:e.toUpperCase();return Fe(`${u} LIKE ${o}${i?`'${a}%'`:`'%${a}%'`}`,s)}if("oid"===o||"small-integer"===o||"integer"===o||"single"===o||"double"===o){const t=Number(e);return isNaN(t)?null:Fe(`${l} = ${t}`,s)}return Fe(`${l} = ${e}`,s)}({currentTerm:c,field:o,filter:i,exactMatch:r,url:l,type:n});e&&(u+=function(e,t){return e?` OR (${t})`:`(${t})`}(u,e))}})),o?`(${o}) AND (${u})`:u}function Ae(e,t,s){const i=e.sourceLayer,{attributes:r}=e,n="function"==typeof i.getFieldDomain&&i.getFieldDomain(s);if(t)return h(t,r);if(s&&r){const e=i.getField(s),t=function(e,t){return e[Object.keys(e).find((e=>e.toLowerCase()===t.toLowerCase()))]}(r,s);return null==t?"":n&&"coded-value"===n.type?function(e,t){let s=null;const{codedValues:i}=e;return i&&i.length&&i.some((e=>e.code===t&&(s=e.name,!0))),s}(n,t):"date"===(null==e?void 0:e.type)?d(new Date(t)):"number"==typeof t?t.toString():"string"!=typeof t?"":t.trim()}return""}function Ne(e,t,s,i,r,n,o){return e.features.map((e=>function(e,t,s,i,r,n,o){const l=e.clone(),u=e.sourceLayer,a=u&&u.objectIdField,h=a&&e.attributes[a],d=Ae(e,s.searchTemplate,r),p=Se(l.geometry,t,n),v="number"==typeof o?_e(g(p),t,o):p,m=e.clone();return c(v)&&(m.geometry=W.fromExtent(v)),{extent:v,target:m,feature:l,key:h,name:d,sourceIndex:i}}(e,t,s,i,r,n,o)))}var Oe;let Ge=Oe=class extends me{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(e,t)=>function(e,t){const{exactMatch:s=!1,location:i,maxResults:r,spatialReference:n,source:o,sourceIndex:l,suggestResult:a,view:c}=e,{layer:h,filter:d,zoomScale:g}=o,p=c&&c.scale,v=Re(o,c),m=t&&t.signal;return ke(h).then((()=>{const e=h.popupTemplate;return e?e.getRequiredFields(h.fieldsIndex):null})).then((e=>{var t,f;const{objectIdField:y,returnZ:w}=h,S=Ce(o);if(!$e(h,S))throw Ie.error("invalid-field: displayField is invalid."),new u("getResults():invalid-field","displayField is invalid.");const _=o.outFields||(e&&e.length?e:[S]),b=je(_);if(-1!==_.indexOf(y)||b||_.push(y),!b&&!Ee(h,_))throw Ie.error("invalid-field: outField is invalid."),new u("getResults():invalid-field","outField is invalid.");const x=h.createQuery(),{orderByFields:M}=o;if(M&&(x.orderByFields=M),n){x.outSpatialReference=n;const e=1/H(n);e&&(x.maxAllowableOffset=e)}const I="mesh"===h.geometryType||"multipatch"===h.geometryType,R=(null==(t=h.capabilities)||null==(f=t.data)?void 0:f.supportsZ)&&!I;if(x.returnZ=R&&!1!==w,x.returnGeometry=!0,x.multipatchOption=I?"xyFootprint":null,_&&(x.outFields=_),i)x.geometry=i;else if(a.key)x.objectIds=[a.key];else{const e=o.searchFields||[S];if(!Ee(h,e))throw Ie.error("invalid-field: search field is invalid."),new u("getResults():invalid-field","search field is invalid.");if(Te(h)&&(x.num=r),v&&(x.geometry=v),!a.text.trim())return[];const{prefix:t="",suffix:i=""}=o,n=Le({searchTerm:Pe(`${t}${a.text}${i}`),layer:h,searchFields:e,filter:d,exactMatch:s,type:"search"});if(!n)return[];x.where=n}return h.queryFeatures(x,{signal:m}).then((e=>Ne(e,c,o,l,S,p,g)))}))}({source:this,...e},t),this.getSuggestions=(e,t)=>function(e,t){const{source:s,spatialReference:i,view:r,suggestTerm:n,maxSuggestions:o,sourceIndex:l,exactMatch:a}=e,{layer:c,filter:h}=s,d=t&&t.signal,g=Re(s,r);return ke(c).then((()=>{if(!Te(c))return[];const e=Ce(s),t=s.searchFields||[e],r=[];s.suggestionTemplate?s.suggestionTemplate.replace(Me,((e,t)=>(r.push(t),e))):r.push(e);const p=je(r);-1!==r.indexOf(c.objectIdField)||p||r.push(c.objectIdField);const v=$e(c,e),m=p||Ee(c,r),f=Ee(c,t);if(!v)throw Ie.error("invalid-field: displayField is invalid."),new u("getSuggestions():invalid-field","displayField is invalid.");if(!m)throw Ie.error("invalid-field: outField is invalid."),new u("getSuggestions():invalid-field","outField is invalid.");if(!f)throw Ie.error("invalid-field: search field is invalid."),new u("getSuggestions():invalid-field","search field is invalid.");const y=c.createQuery(),{orderByFields:w}=s;if(w&&(y.orderByFields=w),y.outSpatialReference=i,y.returnGeometry=!1,y.num=o,y.outFields=r,g&&(y.geometry=g),!n.trim())return[];const{prefix:S="",suffix:_=""}=s,b=Le({searchTerm:Pe(`${S}${n}${_}`),layer:c,searchFields:t,filter:h,exactMatch:a,type:"suggest"});return b?(y.where=b,c.queryFeatures(y,{signal:d}).then((t=>function(e,t,s,i){return e.features.map((e=>function(e,t,s,i){const r=e.sourceLayer,{attributes:n}=e,{objectIdField:o}=r,l=n[o];return{text:Ae(e,t.suggestionTemplate,i),key:l,sourceIndex:s}}(e,t,s,i)))}(t,s,l,e)))):[]}))}({source:this,...e},t)}set layer(e){this._set("layer",e),e&&e.load().catch((()=>{}))}get name(){return this._getLayerTitle()||""}set name(e){void 0!==e?this._override("name",e):this._clearOverride("name")}clone(){return new Oe({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?g(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?g(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){var e,t;return null!=(e=null==(t=this.layer.fieldsIndex.fields.find((e=>"string"===e.type)))?void 0:t.name)?e:""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map((t=>{const s=e.getField(t);return s&&s.alias||t})).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};r([n({json:{read:{source:"field.name"},write:{target:"field.name"}}})],Ge.prototype,"displayField",void 0),r([n({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],Ge.prototype,"exactMatch",void 0),r([n({value:null})],Ge.prototype,"layer",null),r([n()],Ge.prototype,"name",null),r([n({type:[String],json:{write:!0}})],Ge.prototype,"orderByFields",void 0),r([n()],Ge.prototype,"searchFields",void 0),r([n()],Ge.prototype,"searchTemplate",void 0),r([n()],Ge.prototype,"suggestionTemplate",void 0),Ge=Oe=r([o("esri.widgets.Search.LayerSearchSource")],Ge);const Be=Ge;let ze=class extends le{constructor(e){super(e),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};r([n({type:String,json:{write:!0}})],ze.prototype,"address",void 0),r([n({type:Object,json:{write:!0}})],ze.prototype,"attributes",void 0),r([n({type:U,json:{write:!0}})],ze.prototype,"extent",void 0),r([n({type:Z,json:{write:!0}})],ze.prototype,"location",void 0),r([n({type:Number,json:{write:!0}})],ze.prototype,"score",void 0),ze=r([o("esri.rest.support.AddressCandidate")],ze);const De=ze,Ke={type:String,json:{read:{source:"token"},write:{target:"token"}}};let Ve=class extends le{constructor(e){super(e),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};r([n({type:Object,json:{write:!0}})],Ve.prototype,"address",void 0),r([n(Ke)],Ve.prototype,"apiKey",void 0),r([n({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],Ve.prototype,"categories",void 0),r([n({type:String,json:{write:!0}})],Ve.prototype,"countryCode",void 0),r([n({type:Boolean,json:{write:!0}})],Ve.prototype,"forStorage",void 0),r([n({type:Z,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],Ve.prototype,"location",void 0),r([n({type:String,json:{write:!0}})],Ve.prototype,"locationType",void 0),r([n({type:String,json:{write:!0}})],Ve.prototype,"magicKey",void 0),r([n({type:Number,json:{write:!0}})],Ve.prototype,"maxLocations",void 0),r([n({type:[String],json:{write:{writer:(e,t)=>{t.outFields=e?e.join(","):null}}}})],Ve.prototype,"outFields",void 0),r([n({type:q,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ve.prototype,"outSpatialReference",void 0),r([n({type:U,json:{write:{writer:(e,t)=>{const s=e?e.shiftCentralMeridian():null;t.searchExtent=s}}}})],Ve.prototype,"searchExtent",void 0),Ve=r([o("esri.rest.support.AddressToLocationsParameters")],Ve),Ve.from=p(Ve);const Ue=Ve;async function He(e,t,s){t=Ue.from(t);const i=ae(e),{address:r,...n}=t.toJSON(),o={...r,...n,f:"json"},l=ce({...i.query,...o}),u=he(l,s);return v(`${i.path}/findAddressCandidates`,u).then(We)}function We({data:e}){if(!e)return[];const{candidates:t,spatialReference:s}=e;return t?t.map((e=>{if(!e)return;const{extent:t,location:i}=e,r=!t||(n=t)&&"number"==typeof n.xmin&&"number"==typeof n.ymin&&"number"==typeof n.xmax&&"number"==typeof n.ymax;var n;return function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y}(i)&&r?(t&&(t.spatialReference=s),i.spatialReference=s,De.fromJSON(e)):void 0})):[]}let Ze=class extends le{constructor(e){super(e),this.addresses=null,this.categories=null,this.countryCode=null,this.locationType=null,this.outSpatialReference=null}};r([n({type:[Object],json:{read:{reader:e=>e&&e.records?e.records.map((e=>e.attributes)):null},write:{writer:(e,t)=>{const s=[];Array.isArray(e)&&e.forEach((e=>{s.push({attributes:e})})),t.addresses={records:s}}}}})],Ze.prototype,"addresses",void 0),r([n({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],Ze.prototype,"categories",void 0),r([n({type:String,json:{read:{source:"sourceCountry"},write:{target:"sourceCountry"}}})],Ze.prototype,"countryCode",void 0),r([n({type:String,json:{write:!0}})],Ze.prototype,"locationType",void 0),r([n({type:q,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ze.prototype,"outSpatialReference",void 0),Ze=r([o("esri.rest.support.AddressesToLocationsParameters")],Ze),Ze.from=p(Ze);const qe=Ze;function Je(e){const{data:t}=e;if(!t)return[];const{locations:s,spatialReference:i}=t;return s?s.map((e=>{const{location:t}=e;return t&&(t.spatialReference=i),De.fromJSON(e)})):[]}let Qe=class extends le{constructor(e){super(e),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};r([n(Ke)],Qe.prototype,"apiKey",void 0),r([n({type:Z,json:{write:{writer:(e,t)=>{const s=e?e.clone().normalize():null;t.location=void 0!==s?s:null}}}})],Qe.prototype,"location",void 0),r([n({type:String,json:{write:!0}})],Qe.prototype,"locationType",void 0),r([n({type:q,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Qe.prototype,"outSpatialReference",void 0),Qe=r([o("esri.rest.support.LocationToAddressParameters")],Qe),Qe.from=p(Qe);const Ye=Qe;async function Xe(e,t,s){t=Ye.from(t);const i=ae(e),r={...t.toJSON(),f:"json"},n=ce({...i.query,...r}),o=he(n,s);return v(`${i.path}/reverseGeocode`,o).then(et)}function et({data:e}){if(!e)return;const{address:t,location:s}=e;return De.fromJSON({address:t&&t.Match_addr||"",attributes:t||{},location:s,score:100})}let tt=class extends le{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};r([n({type:Boolean,json:{write:!0}})],tt.prototype,"isCollection",void 0),r([n({type:String,json:{write:!0}})],tt.prototype,"magicKey",void 0),r([n({type:String,json:{write:!0}})],tt.prototype,"text",void 0),tt=r([o("esri.rest.support.SuggestionCandidate")],tt);const st=tt;let it=class extends le{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};r([n(Ke)],it.prototype,"apiKey",void 0),r([n({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],it.prototype,"categories",void 0),r([n({type:String,json:{write:!0}})],it.prototype,"countryCode",void 0),r([n({type:Z,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],it.prototype,"location",void 0),r([n({type:Number,json:{write:!0}})],it.prototype,"maxSuggestions",void 0),r([n({type:q,json:{read:{source:"outSR"},write:{target:"outSR"}}})],it.prototype,"outSpatialReference",void 0),r([n({type:U,json:{write:{writer:(e,t)=>{const s=e?e.shiftCentralMeridian():null;t.searchExtent=JSON.stringify(s)}}}})],it.prototype,"searchExtent",void 0),r([n({type:String,json:{write:!0}})],it.prototype,"text",void 0),it=r([o("esri.rest.support.SuggestLocationsParameters")],it),it.from=p(it);const rt=it;async function nt(e,t,s){const i=ae(e),r={...(t=rt.from(t)).toJSON(),f:"json"},n=ce({...i.query,...r}),o=he(n,s);return v(`${i.path}/suggest`,o).then(ot)}function ot(e){const{data:t}=e;if(!t)return[];const{suggestions:s}=t;return s?s.map((e=>new st(e))):[]}let lt=class extends de{constructor(e){super(e),this.outSpatialReference=null,this.url=null}addressToLocations(e,t){!e.outSpatialReference&&this.outSpatialReference&&(e.outSpatialReference=this.outSpatialReference);const s={...this.requestOptions,...t};return He(this.url,e,s)}suggestLocations(e,t){const s={...this.requestOptions,...t};return nt(this.url,e,s)}addressesToLocations(e,t){!e.outSpatialReference&&this.outSpatialReference&&(e.outSpatialReference=this.outSpatialReference);const s={...this.requestOptions,...t};return async function(e,t,s){t=qe.from(t);const i=ae(e),r={...t.toJSON(),f:"json"},n=ce({...i.query,...r}),o=he(n,s);return v(`${i.path}/geocodeAddresses`,o).then(Je)}(this.url,e,s)}locationToAddress(e,t){!e.outSpatialReference&&this.outSpatialReference&&(e.outSpatialReference=this.outSpatialReference);const s={...this.requestOptions,...t};return Xe(this.url,e,s)}};r([n({type:q})],lt.prototype,"outSpatialReference",void 0),r([n()],lt.prototype,"url",void 0),lt=r([o("esri.tasks.Locator")],lt);const ut=lt;function at(e){const t=null==e?void 0:e.scale;return"number"==typeof t&&t<=3e5?e.get("extent.center"):null}function ct(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(e)}function ht(e,t){const{filter:s,withinViewEnabled:i}=e,r=t&&t.extent;return Se(s&&s.geometry,t,t&&t.scale)||(i&&r?r:void 0)}function dt(e,t){return e.filter(Boolean).map((e=>function(e,t){const{key:s,scale:i,sourceIndex:r,view:n,zoomScale:o,defaultZoomScale:l}=t,{attributes:u,extent:a,location:h,address:d}=e,g=new J({geometry:h,attributes:u}),p=a||h,v=Se(p,n,i),m="number"==typeof o?_e(v,n,o):"number"==typeof l&&"point"===p.type?_e(v,n,l):v,f=d||(h?`${h.x},${h.y}`:""),y=g.clone();return c(m)&&(y.geometry=W.fromExtent(m)),{extent:m,feature:g,target:y,key:s,name:f,sourceIndex:r}}(e,t)))}var gt;const pt="esri.widgets.Search.LocatorSearchSource",vt=l.getLogger(pt);let mt=gt=class extends me{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(e,t)=>function(e,t){return e.location?function(e,t){const{source:s,spatialReference:i,location:r,sourceIndex:n,view:o}=e,{apiKey:l,url:u,zoomScale:a,defaultZoomScale:c}=s,h=o&&o.scale,d=t&&t.signal,g=new Ye;return g.location=r,l&&(g.apiKey=l),i&&(g.outSpatialReference=i),Xe(u,g,{signal:d}).then((e=>dt([e],{sourceIndex:n,scale:h,view:o,zoomScale:a,defaultZoomScale:c})))}(e,t):function(e,t){const{source:s,suggestResult:i,spatialReference:r,view:n,maxResults:o,sourceIndex:l}=e,u=s&&s.zoomScale,a=s&&s.defaultZoomScale;if(!i.text.trim())return Promise.resolve(null);const c=`${!i.key&&s.prefix?s.prefix:""}${i.text}${!i.key&&s.suffix?s.suffix:""}`,h=new Ue,{apiKey:d,url:g}=s,p=n&&n.scale,v=ht(s,n),f=t&&t.signal;if(d&&(h.apiKey=d),!g)return Promise.resolve(null);s.categories&&(h.categories=s.categories),s.locationType&&(h.locationType=s.locationType),r&&(h.outSpatialReference=r);const y=at(n);y&&(h.location=y),h.maxLocations=o,v&&(h.searchExtent=m(v)),s.countryCode&&(h.countryCode=s.countryCode);const{key:w}=i,S=`${w}`;return w&&(h.magicKey=S),h.address={},h.address[s.singleLineFieldName||"Single Line Input"]=c,s.outFields&&(h.outFields=s.outFields),He(g,h,{signal:f}).then((e=>dt(e,{key:S,scale:p,sourceIndex:l,view:n,zoomScale:u,defaultZoomScale:a})))}(e,t)}({source:this,...e},t),this.getSuggestions=(e,t)=>function(e,t){const{source:s,spatialReference:i,view:r,suggestTerm:n,maxSuggestions:o,sourceIndex:l}=e,u=new rt,{apiKey:a,url:c}=s,h=ht(s,r),d=t&&t.signal;if(!c)return Promise.resolve(null);a&&(u.apiKey=a),s.categories&&(u.categories=s.categories),i&&(u.outSpatialReference=i);const g=at(r);if(g&&(u.location=g),!n.trim())return Promise.resolve(null);const{prefix:p="",suffix:v=""}=s;return u.text=`${p}${n}${v}`,h&&(u.searchExtent=m(h)),u.maxSuggestions=o,s.countryCode&&(u.countryCode=s.countryCode),nt(c,u,{signal:d}).then((e=>function(e,t){return e.map((e=>function(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}(e,t)))}(e,l)))}({source:this,...e},t)}set locator(e){f(vt,"locator",{replacement:"url",version:"4.22"}),this._set("url",e.url),this._set("locator",e)}get locator(){return f(vt,"locator",{replacement:"url",version:"4.22"}),this._get("locator")}clone(){return new gt({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?g(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?g(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,locator:this.locator,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};r([n()],mt.prototype,"apiKey",void 0),r([n()],mt.prototype,"categories",void 0),r([n()],mt.prototype,"countryCode",void 0),r([n({json:{write:!0}})],mt.prototype,"defaultZoomScale",void 0),r([n({type:ut,json:{read:!1,write:!1}})],mt.prototype,"locator",null),r([n()],mt.prototype,"locationType",void 0),r([n({json:{write:!0}})],mt.prototype,"name",void 0),r([n({json:{write:!0}})],mt.prototype,"placeholder",void 0),r([n()],mt.prototype,"searchTemplate",void 0),r([n({json:{write:!0}})],mt.prototype,"singleLineFieldName",void 0),r([n({json:{read:{source:"suggest"},write:{target:"suggest"}}})],mt.prototype,"suggestionsEnabled",void 0),r([n({json:{write:!0}})],mt.prototype,"url",void 0),r([n({json:{write:!0}})],mt.prototype,"zoomScale",void 0),mt=gt=r([o(pt)],mt);const ft=mt,yt=l.getLogger("esri.widgets.support.geolocationUtils"),wt={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function St(){return function(){const e=y("esri-geolocation");return e||yt.warn("geolocation-unsupported","Geolocation unsupported."),e}()&&function(){const e=window.isSecureContext;return e||yt.warn("insecure-context","Geolocation requires a secure origin."),e}()}function _t(e,t){return e.hasOwnProperty(t)&&null!=e[t]&&""!==e[t]}const bt="esri.widgets.Search.SearchViewModel",xt=l.getLogger(bt),Mt="highlight",It=S.ofType({key:e=>e.layer?"layer":"locator",base:me,typeMap:{layer:Be,locator:ft}}),Rt=q.WGS84,jt=/<(?:.|\s)*?>/g;let kt=class extends(re(_.EventedMixin(b))){constructor(e){super(e),this._handles=new x,this._gotoController=null,this._searching=null,this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new It,this.defaultSymbols={point:new X({url:M(y("trident")?"esri/images/search/search-symbol-32.png":"esri/images/search/search-symbol-32.svg"),size:24,width:24,height:24}),polyline:new ee({color:[130,130,130,1],width:2}),polygon:new te({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=Y.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new It,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const e=await $("esri/widgets/Search/t9n/Search");this.messages=e,this.defaultPopupTemplate=new ie({title:e.searchResult,content:"{Match_addr}"})};e(),this._handles.add([I(this,["defaultSources","sources"],"change",(()=>this.notifyChange("allSources"))),R(this,["includeDefaultSources","view","portal"],(()=>this._update())),j(e)])}destroy(){this._abortGoTo(),this.clearGraphics(),this._handles.destroy(),this._handles=null}get activeSource(){return this.allSources.getItemAt(this.activeSourceIndex)||null}get activeSourceIndex(){return 1!==this.allSources.length&&this.searchAllEnabled?-1:0}set activeSourceIndex(e){void 0!==e?this._override("activeSourceIndex",e):this._clearOverride("activeSourceIndex")}get allPlaceholder(){var e;return null==(e=this.messages)?void 0:e.allPlaceholder}set allPlaceholder(e){e?this._override("allPlaceholder",e):this._clearOverride("allPlaceholder")}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:s}=this,i="function"==typeof s?s.call(null,{sources:e,defaultSources:t}):s?t.concat(e):e,r=this._get("allSources")||new It;return r.removeAll(),r.addMany(i.filter(Boolean)),r}get defaultSymbol(){return f(xt,"defaultSymbol",{replacement:"defaultSymbols",version:"4.22"}),this._get("defaultSymbol")}set defaultSymbol(e){f(xt,"defaultSymbol",{replacement:"defaultSymbols",version:"4.22"}),this._set("defaultSymbol",e)}get locationEnabled(){return this._get("locationEnabled")||St()}set locationEnabled(e){if(void 0===e)return void this._clearOverride("locationEnabled");const t=St();if(e&&!t){const e=new u("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});xt.error(e)}this._override("locationEnabled",e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:s}=this;if(-1===t)return s;const i=e.getItemAt(t);return i?i.placeholder:""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),""===e&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":0===this.allSources.length?"disabled":"ready"}get updating(){return null!=this._updatingPromise}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup(),this.view&&this.view.graphics.remove(this.resultGraphic),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const s=this._createSuggestionForSearch(e),i=this.when().then((()=>this._getResultsFromSources(s,t).then((e=>{var i;if(null!=(i=m(null==t?void 0:t.signal))&&i.aborted)return null;const r={activeSourceIndex:this.activeSourceIndex,searchTerm:s.text,numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(r,e,s);const n=this._getFirstResult(r.results),o=(s.location&&n?n.name:s.text).replace(jt,"");return this._set("searchTerm",o),(s.key&&"number"==typeof s.sourceIndex||s.location)&&this._set("selectedSuggestion",s),this._set("results",r.results),this._set("resultCount",r.results.reduce(((e,t)=>e+t.results.length),0)),this.emit("search-complete",r),this._selectFirstResult(n).then((()=>r))})))).then((e=>(this._clearSearching(),e)),(e=>{throw this._clearSearching(),e}));return this._searching=i,this.notifyChange("state"),i}searchNearby(e){if(!this.locationEnabled){const e=new u("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});return xt.error(e),Promise.reject(e)}const t=function(e){return e||(e=wt),new Promise(((t,s)=>{setTimeout((()=>s(new u("geolocation:timeout","getting the current geolocation position timed out"))),15e3),navigator.geolocation.getCurrentPosition(t,s,e)}))}().then((t=>function(e,t){const{position:s,view:i}=e;return function(e,t,s){if(!t)return Promise.resolve(e);const i=t.spatialReference;return i.isWGS84?Promise.resolve(e):i.isWebMercator?Promise.resolve(Q(e)):function(e){if(w.geometryServiceUrl)return Promise.resolve(w.geometryServiceUrl);const t=Y.getDefault();return t.load(e).catch((()=>{})).then((()=>t.get("helperServices.geometry.url")))}(s).then((t=>{if(!t)throw new u("geometry-service:missing-url","Geometry service URL is missing");const r=new ge({geometries:[e],outSpatialReference:i});return pe(t,r,s).then((e=>e[0]))}))}(function(e){const t=e&&e.coords;return t?new Z({longitude:t.longitude,latitude:t.latitude,z:t.altitude||null,spatialReference:{wkid:4326}}):null}(function(e){const t=e&&e.coords||{};return e?{coords:{accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed},timestamp:e.timestamp}:e}(s)),i,t)}({position:t,view:this.view},e))).then((t=>this.search(t,e)));return this._searching=t,this.notifyChange("state"),t.catch((()=>{})).then((()=>this._clearSearching())),t}select(e){if(this.clearGraphics(),!e){const t=new u("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});return xt.error(t),Promise.reject(t)}const{view:t}=this,s=_t(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),i=this.allSources.getItemAt(s);if(!i){const e=new u("select:missing-source","Cannot select without a source.",{source:i});return xt.error(e),Promise.reject(e)}const r=i instanceof Be?this._getLayerSourcePopupTemplate(i):i.popupTemplate,n=i.resultSymbol||this._getDefaultSymbol(e),o=_t(i,"resultGraphicEnabled")?i.resultGraphicEnabled:this.resultGraphicEnabled,l=_t(i,"autoNavigate")?i.autoNavigate:this.autoNavigate,a=_t(i,"popupEnabled")?i.popupEnabled:this.popupEnabled,h=a?r||this.popupTemplate||this.defaultPopupTemplate:null,{feature:d}=e;if(!d){const e=new u("select:missing-feature","Cannot select without a feature.",{feature:d});return xt.error(e),Promise.reject(e)}const{attributes:g,geometry:p,layer:v,sourceLayer:m}=d,f=we(p),y={layerViewQuery:this._getLayerView(d),elevationQuery:t&&c(f)?ye(f,t).catch((()=>f)):Promise.resolve(f)};return k(y).then((r=>{const u=r.layerViewQuery.value,f=r.elevationQuery.value;n instanceof se&&(n.text=e.name);const y=t&&l?e.target||e.extent:null;return(c(y)?this._goToSearchResult(y):Promise.resolve()).then((()=>{var r;const l=u?d:new J({geometry:p,symbol:n,attributes:g,layer:v,sourceLayer:m,popupTemplate:h}),c=a&&(null==(r=this.view)?void 0:r.popup),y=c&&l.getEffectivePopupTemplate(c.defaultPopupTemplateEnabled);return y&&t.popup.open({features:[l],location:f}),u&&ne(u)&&!y&&this._highlightFeature({graphic:l,layerView:u}),!u&&o&&t&&t.graphics.push(l),this._set("selectedResult",e),this._set("resultGraphic",l),this.emit("select-result",{result:e,source:i,sourceIndex:s}),e}))}))}suggest(e,t,s){const i=e||this.searchTerm;return this.emit("suggest-start",{searchTerm:i}),this._suggestTimer(t,s).then((()=>this._suggestImmediate(i,s).then((e=>(this._set("suggestions",e.results),this._set("suggestionCount",e.results.reduce(((e,t)=>e+t.results.length),0)),this.emit("suggest-complete",e),e)))))}async when(){await T(this,"updating")}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const s=this._updatingPromise=k([null==e?void 0:e.load(),null==t?void 0:t.when()]);if(this.destroyed)return;if(this.notifyChange("updating"),await s,s!==this._updatingPromise)return}this._updatingPromise=null,this.notifyChange("updating");const s=C(this,"messages");this.destroyed||(this._handles.add(s),await s,this._updateDefaultSources())}_clearSearching(){this._searching=null,this.notifyChange("state")}_convertHelperServices(){var e,t;const s=null==(e=this.portal)||null==(t=e.helperServices)?void 0:t.geocode;return s?s.map((e=>{if(!1===e.placefinding)return;const t=w.apiKey&&ct(e.url)?{url:"https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer"}:null,s=ft.fromJSON({...e,...t}),i=s.url;return(ct(i)||function(e){return!!e&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/gi.test(e)}(i)||function(e){return!!e&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(e)}(i))&&s.set({singleLineFieldName:"SingleLine",outFields:s.outFields||["Addr_type","Match_addr","StAddr","City"],placeholder:s.placeholder||this.messages.placeholder,defaultZoomScale:"number"==typeof s.defaultZoomScale?s.defaultZoomScale:2500}),s.singleLineFieldName?s:void 0})).filter(Boolean):[]}_getLayerSources(e,t){var s;const i=null==(s=this.view)?void 0:s.map;return e.map((e=>{const s=i.findLayerById(e.id);if(!s)return;const r=this._getLayerJSON(e),n=Be.fromJSON(r);return n.placeholder=t,this._getLayer(s,r).then((e=>{n.layer=e})),n})).filter(Boolean).toArray()}_getTableSources(e,t){var s;const i=null==(s=this.view)?void 0:s.map;return e.map((e=>{const s=i.findTableById(e.id);if(!s)return;const r=this._getLayerJSON(e),n=Be.fromJSON(r);return n.placeholder=t,this._getLayer(s,r).then((e=>{n.layer=e})),n})).filter(Boolean).toArray()}_convertApplicationProperties(){var e,t,s;const i=null==(e=this.view)?void 0:e.map,r=null==i||null==(t=i.applicationProperties)||null==(s=t.viewing)?void 0:s.search;if(!r)return[];const{enabled:n,hintText:o,layers:l,tables:u}=r;return n?[...this._getLayerSources(l,o),...this._getTableSources(u,o)]:[]}_getSubLayer(e,t){return e.load().then((()=>{if(!e.allSublayers)return Promise.reject();const s=e.allSublayers.find((e=>e.id===t.subLayer));return s?s.createFeatureLayer():Promise.reject()}))}async _getBuildingSubLayer(e,t){await e.load();const s=e.allSublayers.find((e=>e.id===t.subLayer));return"building-component"!==(null==s?void 0:s.type)?Promise.reject():(await s.load(),null==s.associatedLayer?Promise.reject():(await s.associatedLayer.load(),s))}_getLayer(e,t){return"feature"===e.type||"scene"===e.type||"csv"===e.type||"geojson"===e.type||"ogc-feature"===e.type?Promise.resolve(e):"map-image"===e.type?this._getSubLayer(e,t).catch((()=>{const t=new u("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return xt.error(t),null})):"building-scene"===e.type?this._getBuildingSubLayer(e,t):Promise.resolve(null)}_getLayerJSON(e){return"function"==typeof e.toJSON?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()]),this.notifyChange("allSources")}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){var e;const t=null==(e=this.view)?void 0:e.popup,{resultGraphic:s}=this;if(!t||!s)return;const{selectedFeature:i}=t;i&&i===s&&t.close()}_suggestTimer(e,t){return E(null!=e?e:this.suggestionDelay,null,t&&t.signal)}_createLocationForSearch(e){return e instanceof J?we(e.geometry):e instanceof Z?e:Array.isArray(e)&&2===e.length?new Z({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&_t(e,"key")&&_t(e,"text")&&_t(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),s="string"==typeof e?e:this.searchTerm,{selectedSuggestion:i,selectedResult:r}=this,n=!e&&i&&r;return n&&i.key===r.key&&i.sourceIndex===r.sourceIndex||n&&i.location?i:{location:m(t),text:t?"":s,sourceIndex:null,key:null}}_getFirstResult(e){let t=null;return e&&e.some((e=>{const{results:s}=e,i=s[0],r=!!i;return r&&(t=i),r})),t}_selectFirstResult(e){return this.autoSelect&&e?this.select(e):Promise.resolve(null)}_suggestImmediate(e,t){return this.when().then((()=>this._getSuggestionsFromSources(e,t))).then((s=>{var i;if(null!=(i=m(null==t?void 0:t.signal))&&i.aborted)return null;const r={activeSourceIndex:this.activeSourceIndex,searchTerm:e,numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(r,s),r}))}_formatSourceResponse(e,t,s){const i=t&&t.value||[],r=t&&t.error,n=this.allSources.getItemAt(s);r?(e.errors.push({sourceIndex:s,source:n,error:r}),xt.error(r),e.numErrors++):(e.results.push({sourceIndex:s,source:n,results:i}),e.numResults+=i.length)}_formatResponse(e,t,s){if(t)if(-1===e.activeSourceIndex){const i=s&&_t(s,"sourceIndex")&&-1!==s.sourceIndex?s.sourceIndex:void 0;t.forEach(((t,s)=>{this._formatSourceResponse(e,t,void 0!==i?i:s)}))}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}_getResultsFromSources(e,t){const{allSources:s}=this,i=!e.location&&_t(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,r=[];if(!s.length){const e=new u("search:no-sources-defined","At least one source is required.",{allSources:s});return xt.error(e),Promise.reject(e)}return-1===i?s.forEach(((s,i)=>{r.push(this._getResultsFromSource(e,i,t))})):r.push(this._getResultsFromSource(e,i,t)),k(r)}_getSuggestionsFromSources(e,t){const{allSources:s,activeSourceIndex:i}=this,r=[];if(!s.length){const e=new u("suggest:no-sources-defined","At least one source is required.",{allSources:s});return xt.error(e),Promise.reject(e)}return-1===i?s.forEach(((s,i)=>{r.push(this._getSuggestionsFromSource(e,i,t))})):r.push(this._getSuggestionsFromSource(e,i,t)),k(r)}_getResultsFromSource(e,t,s){var i;const r=this.allSources.getItemAt(t),{location:n=null}=e,o=(null==(i=this.view)?void 0:i.spatialReference)||Rt,l=_t(r,"maxResults")?r.maxResults:this.maxResults,u=!!(r instanceof Be&&_t(r,"exactMatch"))&&r.exactMatch,{view:a}=this;return r.getResults({view:a,sourceIndex:t,location:n,suggestResult:e,spatialReference:o,exactMatch:u,maxResults:l},s)}_getSuggestionsFromSource(e,t,s){const i=this.allSources.getItemAt(t),r=_t(i,"suggestionsEnabled")?i.suggestionsEnabled:this.suggestionsEnabled,n=e.length,o=_t(i,"minSuggestCharacters")?i.minSuggestCharacters:this.minSuggestCharacters;if(r&&e.trim()&&n>=o){var l;const r=(null==(l=this.view)?void 0:l.spatialReference)||Rt,n=_t(i,"maxSuggestions")?i.maxSuggestions:this.maxSuggestions,{view:o}=this,u=!!(i instanceof Be&&_t(i,"exactMatch"))&&i.exactMatch;return i.getSuggestions({view:o,sourceIndex:t,suggestTerm:e,spatialReference:r,maxSuggestions:n,exactMatch:u},s)}return Promise.resolve(null)}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return _t(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){let t=null;return this.results.some((s=>s.results.some((i=>i===e&&(t=s.sourceIndex,!0))))),t}async _goToSearchResult(e){const t=!!e;this._abortGoTo();const s=new AbortController;this._gotoController=s;const i={target:{target:e},options:{animate:t,signal:s.signal}};await this.callGoTo(i),this._gotoController=null}_getDefaultSymbol(e){var t;const{defaultSymbols:s}=this,i=null==(t=e.feature)?void 0:t.geometry;if(!c(i))return null;const r=this._get("defaultSymbol");if(r&&("point"===i.type||"multipoint"===i.type))return r;switch(i.type){case"point":case"multipoint":return s.point;case"polyline":return s.polyline;case"extent":case"polygon":return s.polygon;default:return null}}_removeHighlight(){this._handles.remove(Mt)}async _getLayerView(e){const{view:t}=this;if(!e||!t||"building-component"===e.layer.type||"subtype-sublayer"===e.layer.type)return Promise.resolve(null);const{layer:s}=e;return await t.when(),t.whenLayerView(s)}_highlightFeature(e){const{graphic:t,layerView:s}=e,{attributes:i,layer:r}=t,{objectIdField:n}=r,o=s.highlight(i&&i[n]||t);this._handles.add(o,Mt)}};kt.ALL_INDEX=-1,r([n({readOnly:!0,value:null})],kt.prototype,"activeSource",null),r([n()],kt.prototype,"activeSourceIndex",null),r([n()],kt.prototype,"allPlaceholder",null),r([n({readOnly:!0,dependsOn:["defaultSources.length","sources.length","includeDefaultSources"]})],kt.prototype,"allSources",null),r([n()],kt.prototype,"autoNavigate",void 0),r([n()],kt.prototype,"autoSelect",void 0),r([n()],kt.prototype,"defaultPopupTemplate",void 0),r([n({readOnly:!0})],kt.prototype,"defaultSources",void 0),r([n()],kt.prototype,"defaultSymbol",null),r([n()],kt.prototype,"defaultSymbols",void 0),r([n()],kt.prototype,"includeDefaultSources",void 0),r([n()],kt.prototype,"locationEnabled",null),r([n()],kt.prototype,"maxInputLength",void 0),r([n()],kt.prototype,"maxResults",void 0),r([n()],kt.prototype,"maxSuggestions",void 0),r([n()],kt.prototype,"messages",void 0),r([n()],kt.prototype,"minSuggestCharacters",void 0),r([n({readOnly:!0})],kt.prototype,"placeholder",null),r([n()],kt.prototype,"popupEnabled",void 0),r([n({type:ie})],kt.prototype,"popupTemplate",void 0),r([n({type:Y})],kt.prototype,"portal",void 0),r([n()],kt.prototype,"resultCount",void 0),r([n()],kt.prototype,"resultGraphicEnabled",void 0),r([n({readOnly:!0})],kt.prototype,"resultGraphic",void 0),r([n({readOnly:!0})],kt.prototype,"results",void 0),r([n({readOnly:!0})],kt.prototype,"selectedSuggestion",void 0),r([n()],kt.prototype,"searchAllEnabled",void 0),r([n({readOnly:!0})],kt.prototype,"selectedResult",void 0),r([n()],kt.prototype,"searchTerm",null),r([n({type:It})],kt.prototype,"sources",void 0),r([n({readOnly:!0,dependsOn:["allSources.length","updating"]})],kt.prototype,"state",null),r([n()],kt.prototype,"suggestionDelay",void 0),r([n()],kt.prototype,"suggestionCount",void 0),r([n({readOnly:!0})],kt.prototype,"suggestions",void 0),r([n()],kt.prototype,"suggestionsEnabled",void 0),r([n({readOnly:!0})],kt.prototype,"updating",null),r([n()],kt.prototype,"view",void 0),r([n()],kt.prototype,"clear",null),kt=r([o(bt)],kt);const Tt=kt;let Ct=class extends L{constructor(e,t){super(e,t),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}render(){return A("div",{class:"esri-search-result-renderer esri-widget"},A("div",{key:"esri-search-renderer__container",class:this.classes("esri-search-result-renderer__more-results",{"esri-search-result-renderer__more-results--show-more-results":this.showMoreResultsOpen})},this.renderSearchResultName(),this.renderMoreResults()))}renderMoreResults(){return A("div",{key:"esri-search-renderer__more-results"},this.renderMoreResultsButton(),this.renderMoreResultsLists())}renderSearchResultName(){var e;const t=null==(e=this.viewModel)?void 0:e.selectedResult;return A("div",{key:"esri-search-renderer__result-name",class:"esri-search-result-renderer__more-results-item"},t&&t.name||"")}renderMoreResultsLists(){var e;const t=null==(e=this.viewModel)?void 0:e.results,{resultCount:s}=this.viewModel;if(s<2)return null;const i=t.map((e=>this.renderMoreResultsList(e)));return A("div",{key:"esri-search-renderer__more-results-container",class:"esri-search-result-renderer__more-results-list"},i)}renderMoreResultsButton(){const{messages:e}=this,{resultCount:t}=this.viewModel;return t<2?null:A("div",{key:"esri-search-renderer__more-results-button",class:"esri-search-result-renderer__more-results-item"},A("a",{class:"esri-widget__anchor",href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?e.hideMoreResults:e.showMoreResults))}renderMoreResultsHeader(e,t){return A("div",{key:`esri-search-result-renderer__header-${t}`,class:"esri-search-result-renderer__more-results-list-header"},e)}renderMoreResultsList(e){var t,s;const{results:i}=e,r=i.length,n=!!r,o=null==(t=this.viewModel)?void 0:t.selectedResult,l=1===r&&i[0]===o,u=this._getSourceName(e.source,e.sourceIndex),a=(null==(s=this.viewModel)?void 0:s.results.length)>1&&!l?this.renderMoreResultsHeader(u,e.sourceIndex):null,c=n&&i.map(((e,t)=>this.renderMoreResultsListItem(e,t))),h=n&&!l?A("ul",{key:`esri-search-result-renderer__list-${e.sourceIndex}`},c):null;return n?A("div",{key:`esri-search-result-renderer__results-${e.sourceIndex}`},a,h):null}renderMoreResultsListItem(e,t){return e!==this.get("viewModel.selectedResult")?A("li",{key:`esri-search-result-renderer__list-item-${t}`},A("a",{class:"esri-widget__anchor",href:"#",tabindex:"0",bind:this,"data-result":e,onclick:this._selectResultClick,onkeydown:this._selectResultClick},e.name)):null}_showMoreResultsClick(e){e.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const t=this.get("viewModel.view.popup");t&&t.reposition()}_selectResultClick(e){e.preventDefault(),this.viewModel&&this.viewModel.select(e.currentTarget["data-result"])}_getSourceName(e,t){return t===Tt.ALL_INDEX?this.messages.all:e.name}};r([n(),P("esri/widgets/Search/t9n/Search")],Ct.prototype,"messages",void 0),r([n()],Ct.prototype,"showMoreResultsOpen",void 0),r([n()],Ct.prototype,"viewModel",void 0),r([F()],Ct.prototype,"_showMoreResultsClick",null),r([F()],Ct.prototype,"_selectResultClick",null),Ct=r([o("esri.widgets.Search.SearchResultRenderer")],Ct);const Et=Ct,$t="esri-widget--button",Pt="esri-menu__list-item",Ft=/<[a-z/][\s\S]*>/i;let Lt=class extends L{constructor(e,t){super(e,t),this._activeMenuItemIndex=-1,this._handles=new x,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new Et,this._locateFailed=null,this._container=null,this.activeMenu="none",this.activeSource=null,this.activeSourceIndex=null,this.allPlaceholder=null,this.allSources=null,this.autoNavigate=null,this.autoSelect=null,this.defaultSources=null,this.disabled=!1,this.goToOverride=null,this.iconClass="esri-icon-search",this.includeDefaultSources=null,this.label=void 0,this.locationEnabled=null,this.maxResults=null,this.maxSuggestions=null,this.messages=null,this.messagesCommon=null,this.minSuggestCharacters=null,this.popupEnabled=null,this.popupTemplate=null,this.portal=null,this.resultGraphic=null,this.resultGraphicEnabled=null,this.results=null,this.searchAllEnabled=null,this.searchTerm=null,this.selectedResult=null,this.sources=null,this.suggestions=null,this.suggestionsEnabled=null,this.view=null,this.viewModel=new Tt,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=e=>{var t;const s=e.relatedTarget;s&&null!=(t=this._container)&&t.contains(s)||this._clearActiveMenu()},this.own(O(this,"searchTerm",(e=>{(e&&"warning"===this.activeMenu||!e&&!this.get("viewModel.selectedSuggestion.location"))&&this._clearActiveMenu()})),I(this,"viewModel.allSources","change",(()=>this._watchSourceChanges())),R(this,"activeMenu",(()=>this._resetActiveMenuItemIndex())),R(this,"viewModel.defaultPopupTemplate",(e=>{e&&(e.content=this._renderSearchResultsContent.bind(this))})))}destroy(){this._handles.destroy(),this._handles=null,this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),this._searchResultRenderer=null)}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}clear(){}focus(){var e;null==(e=this._inputNode)||e.focus(),this.emit("search-focus")}blur(){var e;null==(e=this._inputNode)||e.blur(),this.emit("search-blur")}search(e){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const t=new AbortController,{signal:s}=t;return this._searchController=t,this.viewModel.search(e,{signal:s}).catch((e=>{if(this._searchController===t)return this._clearActiveMenu(),this._searchController=null,e})).then((e=>{if(this._searchController===t)return this.activeMenu=e.numResults?"none":"warning",this._searchController=null,e}))}suggest(e){this._cancelSuggest();const t=new AbortController,{signal:s}=t;return this._suggestController=t,this.viewModel.suggest(e,null,{signal:s}).then((e=>{if(this._suggestController===t)return this._suggestController=null,e.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),e})).catch((()=>{if(this._suggestController===t)return this._suggestController=null,null}))}render(){const{state:e}=this.viewModel;return A("div",{class:this.classes("esri-search esri-widget",{"esri-disabled":"disabled"===e,"esri-widget--disabled":this.disabled})},"loading"===e?this.renderLoader():this.renderContainer())}renderSubmitButton(){const{messages:e}=this;return A("button",{"aria-label":e.searchButtonTitle,bind:this,class:this.classes("esri-search__submit-button",$t),key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:e.searchButtonTitle},A("span",{"aria-hidden":"true",class:"esri-icon-search"}))}renderWarningMenu(){return A("div",{key:"esri-search__error-menu",class:this.classes("esri-menu","esri-search__warning-menu")},A("div",{class:"esri-search__warning-body"},this.renderWarning()))}renderSourceMenuButton(){const{messages:e,activeMenu:t,sourceMenuId:s,sourceMenuButtonId:i}=this,{activeSourceIndex:r,allSources:n}=this.viewModel;return n.length>1?A("button",{id:i,key:"esri-search__source-menu-button",bind:this,"aria-label":e.searchIn,title:e.searchIn,"aria-haspopup":"true","aria-expanded":("source"===t).toString(),"aria-controls":s,class:this.classes("esri-search__sources-button",$t),onclick:this._handleSourcesMenuToggleClick,onfocus:this._clearActiveMenu,afterCreate:G,"data-node-ref":"_sourceMenuButtonNode"},A("span",{"aria-hidden":"true",class:"esri-icon-down-arrow esri-search__sources-button--down"}),A("span",{"aria-hidden":"true",class:"esri-icon-up-arrow esri-search__sources-button--up"}),A("span",{class:"esri-search__source-name"},this._getSourceName(r))):null}renderSourcesList(){const{allSources:e,searchAllEnabled:t}=this.viewModel,{_activeMenuItemIndex:s,activeMenu:i,sourceMenuId:r,sourceMenuButtonId:n}=this,o="source"===i&&s>-1?this._buildId("source-item",s):null;return e.length>1?A("ul",{"aria-activedescendant":o,"aria-labelledby":n,id:r,role:"menu",bind:this,afterCreate:G,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,"data-node-ref":"_sourceListNode",class:"esri-menu__list",tabIndex:-1},t?this.renderSource(Tt.ALL_INDEX):null,e.map(((e,t)=>this.renderSource(t))).toArray()):null}renderSourcesMenu(){const{allSources:e}=this.viewModel;return e.length>1?A("div",{key:"esri-search__source-menu",class:this.classes("esri-menu","esri-search__sources-menu")},this.renderSourcesList()):null}renderLoader(){const{messages:e,messagesCommon:t}=this;return A("div",{class:"esri-widget__loader",key:"base-loader"},A("span",{"aria-hidden":"true",class:"esri-widget__loader-animation"}),A("span",{class:"esri-icon-font-fallback-text"},e.searchButtonTitle),A("span",{class:"esri-widget__loader-text"},t.loading))}renderContainer(){const{allSources:e,state:t}=this.viewModel,{activeMenu:s}=this;return A("div",{tabIndex:-1,afterCreate:e=>{this._container=e,e.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:e=>{e.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes({"esri-search--multiple-sources":e.length>1,"esri-search--loading":"loading"===t,"esri-search--searching":"searching"===t,"esri-search--warning":"warning"===s,"esri-search--sources":"source"===s,"esri-search--show-suggestions":"suggestion"===s},"esri-search__container"),key:"base-container"},this.renderSourceMenuButton(),this.renderSourcesMenu(),this.renderInputContainer(),this.renderSubmitButton(),this.renderWarningMenu())}renderClearButton(){return this.searchTerm?A("button",{bind:this,class:this.classes("esri-search__clear-button",$t),key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle},A("span",{"aria-hidden":"true",class:"esri-icon-close"})):null}renderLocationGroup(){const{messages:e,locationEnabled:t,displayedSearchTerm:s}=this,i="suggestion"===this.activeMenu&&0===this._activeMenuItemIndex;return t&&!s?A("ul",{role:"group",key:"esri-search__suggestion-list-current-location",class:this.classes("esri-menu__list","esri-search__suggestions-list","esri-search__suggestions-list--current-location")},A("li",{bind:this,"data-current-location-item":!0,onclick:this._handleUseCurrentLocationClick,id:this._buildId("suggestion-item",0),"aria-selected":("suggestion"===this.activeMenu&&0===this._activeMenuItemIndex).toString(),role:"option",class:this.classes(Pt,i?"esri-menu__list-item--focus":null)},A("span",{"aria-hidden":"true",class:"esri-icon-locate-circled"})," ",e.useCurrentLocation)):null}renderInput(){const{activeMenu:e,locationEnabled:t,displayedSearchTerm:s,messages:i,suggestionsMenuId:r,inputId:n,_activeMenuItemIndex:o}=this,{maxInputLength:l,placeholder:u,searchTerm:a,suggestionCount:c}=this.viewModel,h=!((!t||s)&&!c),d="suggestion"===e&&o>-1?this._buildId("suggestion-item",o):null;return A("input",{"aria-activedescendant":d,"aria-autocomplete":"list","aria-expanded":(h&&"suggestion"===e).toString(),"aria-controls":h?r:null,"aria-haspopup":"listbox","aria-label":i.searchButtonTitle,bind:this,placeholder:u,maxlength:l,autocomplete:"off",type:"text",class:this.classes("esri-input","esri-search__input"),value:a,id:n,role:"combobox",onkeyup:this._handleInputKeyup,onclick:this._openSuggestionMenu,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:G,"data-node-ref":"_inputNode",onfocus:this.focus,onblur:this.blur,title:a?"":u})}renderForm(){return A("form",{key:"esri-search__form",bind:this,class:"esri-search__form",onsubmit:this._formSubmit,role:"search"},this.renderInput())}renderSuggestList(e){const{sourceIndex:t}=e,s=e.results;return e.results.length?A("ul",{role:"group",key:`esri-search__suggestion-list-${t}`,class:this.classes("esri-menu__list","esri-search__suggestions-list")},s.map((e=>this.renderSuggestion(e,this._menuItemCount++)))):null}renderSuggestionsGroup(){const{suggestions:e}=this.viewModel;return e?e.map((e=>[this.renderSuggestionHeader(e),this.renderSuggestList(e)])):null}renderSuggestionsMenu(){const{displayedSearchTerm:e,locationEnabled:t,suggestionsMenuId:s,inputId:i}=this,{suggestionCount:r}=this.viewModel,n=t&&!e||r;return this._menuItemCount=0,n?A("div",{id:s,key:"esri-search__suggestions-menu",class:this.classes("esri-menu","esri-search__suggestions-menu"),role:"listbox","aria-labelledby":i,bind:this,afterCreate:G,"data-node-ref":"_suggestionListNode"},this.renderLocationGroup(),this.renderSuggestionsGroup()):null}renderInputContainer(){return A("div",{key:"esri-search__input-container",class:"esri-search__input-container"},this.renderForm(),this.renderSuggestionsMenu(),this.renderClearButton())}renderSuggestionHeader(e){const{allSources:t,activeSourceIndex:s}=this.viewModel,{sourceIndex:i}=e;return e.results.length&&t.length>1&&s===Tt.ALL_INDEX?A("div",{key:`esri-search__suggestion-header-${i}`,class:"esri-menu__header"},this._getSourceName(i)):null}renderSuggestion(e,t){const{_activeMenuItemIndex:s,messages:i}=this,{searchTerm:r}=this.viewModel;if(r){const{text:n}=e,o=n||i.untitledResult,l=Ft.test(o),u=[];if(l)u.push(A("div",{innerHTML:o}));else{const e=this._splitResult(o,r),t=r.toLowerCase();e.forEach(((e,s)=>{e&&e.length&&(e.toLowerCase()===t?u.push(A("strong",{key:s},e)):u.push(e))}))}const a="suggestion"===this.activeMenu&&s===t;return A("li",{bind:this,id:this._buildId("suggestion-item",t),"aria-selected":("suggestion"===this.activeMenu&&this._activeMenuItemIndex===t).toString(),onclick:this._handleSuggestionClick,key:`esri-search__suggestion_${t}`,"data-suggestion":e,role:"option",class:this.classes(Pt,a?"esri-menu__list-item--focus":null)},u)}}renderSource(e){const{activeSourceIndex:t,searchAllEnabled:s}=this.viewModel,i={"esri-menu__list-item--active":e===t,"esri-menu__list-item--focus":"source"===this.activeMenu&&e===(s?this._activeMenuItemIndex-1:this._activeMenuItemIndex)};return A("li",{bind:this,key:`esri-search__source-${e}`,id:this._buildId("source-item",s?e+1:e),"aria-checked":(e===t).toString(),onclick:this._handleSourceClick,"data-source-index":e,role:"menuitemradio",class:this.classes("esri-search__source",Pt,i)},this._getSourceName(e))}renderNoResultsWarning(e){const{messages:t}=this,s=e?h(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return A("div",{key:"esri-search__no_results"},A("div",{class:"esri-search__warning-header"},t.noResults),A("div",{class:"esri-search__warning-text"},s))}renderEmptySearchWarning(){const{messages:e}=this;return A("div",{key:"esri-search__empty-search"},A("span",{"aria-hidden":"true",class:"esri-icon-notice-triangle"}),A("span",{class:"esri-search__no-value-text"},e.emptyValue))}renderLocateWarning(){const{messages:e}=this;return A("div",{key:"esri-search__locate-error"},A("span",{"aria-hidden":"true",class:"esri-icon-notice-triangle"}),A("span",{class:"esri-search__no-value-text"},e.locateError))}renderWarning(){var e;const{displayedSearchTerm:t,_locateFailed:s}=this,{viewModel:i}=this;return s?this.renderLocateWarning():null!=(e=i.selectedSuggestion)&&e.location||t?this.renderNoResultsWarning(t):this.renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(e,t){return`${this.id}-${e}${void 0===t?"":`-${t}`}`}_watchSourceChanges(){const{_handles:e,viewModel:{allSources:t}}=this,s="sources";e.remove(s),t.forEach((t=>e.add(O(t,"name",(()=>this.scheduleRender())),s)))}_handleSourcesMenuToggleClick(){var e;this.activeMenu="source"===this.activeMenu?"none":"source",this.renderNow(),"source"===this.activeMenu&&(null==(e=this._sourceListNode)||e.focus())}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(e){const t=e.currentTarget["data-suggestion"];t&&(this._focus(),this.search(t))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const e=new AbortController,{signal:t}=e;this._searchController=e,this.viewModel.searchNearby({signal:t}).catch((()=>{this._locateFailed=!0,this.activeMenu="warning"})).then((()=>{this._searchController=null}))}_handleSourceClick(e){this._setSourceFromMenuItem(e.currentTarget)}_setSourceFromMenuItem(e){var t;e&&(this.viewModel.activeSourceIndex=e["data-source-index"],this._clearActiveMenu(),null==(t=this._sourceMenuButtonNode)||t.focus())}_cancelSuggest(){this._suggestController&&(this._suggestController.abort(),this._suggestController=null)}_cancelSearch(){this._searchController&&(this._searchController.abort(),this._searchController=null),this._locateFailed=!1}_handleInputKeyup(e){var t;const s=K(e);if(e.ctrlKey||e.metaKey||"Copy"===s||"ArrowLeft"===s||"ArrowRight"===s||"Shift"===s)return;if("Tab"===s||"Escape"===s||e.shiftKey&&"Tab"===s)return this._cancelSuggest(),void("Escape"===s&&this._clearActiveMenu());const i="Home"===s||"End"===s||"ArrowUp"===s||"ArrowDown"===s;if("Enter"===s&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const r=null==(t=this._suggestionListNode)?void 0:t.getElementsByTagName("li");if(null!=r&&r.length){if("suggestion"!==this.activeMenu&&this._openSuggestionMenu(),i)return e.preventDefault(),this._cancelSuggest(),void this.handleItemNavigation(s,r,this._suggestionListNode);const t=r[this._activeMenuItemIndex];if("Enter"===s&&t){const e=t["data-suggestion"];return void(e?(this._focus(),this.search(e)):t["data-current-location-item"]&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}handleItemNavigation(e,t,s){const i=this._activeMenuItemIndex;"Home"===e&&(this._activeMenuItemIndex=0),"End"===e&&(this._activeMenuItemIndex=t.length-1),"ArrowUp"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?t.length-1:this._activeMenuItemIndex-1),"ArrowDown"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex===t.length-1?0:this._activeMenuItemIndex+1),i!==this._activeMenuItemIndex&&B(t[this._activeMenuItemIndex],s)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(e){const t=e.target;this.viewModel.searchTerm!==t.value&&(this.viewModel.searchTerm=t.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(e){const t=K(e);if(z(t)){e.preventDefault();const t=this._sourceListNode.getElementsByTagName("li")[this._activeMenuItemIndex];this._setSourceFromMenuItem(t)}else"ArrowUp"!==t&&"ArrowDown"!==t&&"End"!==t&&"Home"!==t||e.preventDefault()}_handleSourceMenuKeyup(e){var t;const s=K(e),i="ArrowUp"===s||"ArrowDown"===s||"End"===s||"Home"===s;var r;if(i&&e.preventDefault(),"Escape"===s)return this._clearActiveMenu(),void(null==(r=this._sourceMenuButtonNode)||r.focus());const n=null==(t=this._sourceListNode)?void 0:t.getElementsByTagName("li");return n&&0!==n.length&&i?("source"!==this.activeMenu&&(this.activeMenu="source"),void this.handleItemNavigation(s,n,this._sourceListNode.parentElement)):void 0}_focus(e){this.focus(),e&&(this.activeMenu=e)}_formSubmit(e){e.preventDefault(),-1===this._activeMenuItemIndex&&this.search()}_getSourceName(e){const{messages:t}=this,s=this.viewModel,{allSources:i}=s,r=i.getItemAt(e);return e===Tt.ALL_INDEX?t.all:r&&r.name||t.untitledSource}_splitResult(e,t){const s=D(t);return e.replace(new RegExp(`(^|)(${s})(|$)`,"ig"),"$1|$2|$3").split("|")}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};r([n()],Lt.prototype,"_activeMenuItemIndex",void 0),r([n()],Lt.prototype,"displayedSearchTerm",null),r([n({readOnly:!0})],Lt.prototype,"inputId",null),r([n({readOnly:!0})],Lt.prototype,"suggestionsMenuId",null),r([n({readOnly:!0})],Lt.prototype,"sourceMenuId",null),r([n({readOnly:!0})],Lt.prototype,"sourceMenuButtonId",null),r([n()],Lt.prototype,"activeMenu",void 0),r([N("viewModel.activeSource")],Lt.prototype,"activeSource",void 0),r([N("viewModel.activeSourceIndex")],Lt.prototype,"activeSourceIndex",void 0),r([N("viewModel.allPlaceholder")],Lt.prototype,"allPlaceholder",void 0),r([N("viewModel.allSources")],Lt.prototype,"allSources",void 0),r([N("viewModel.autoNavigate")],Lt.prototype,"autoNavigate",void 0),r([N("viewModel.autoSelect")],Lt.prototype,"autoSelect",void 0),r([N("viewModel.defaultSources")],Lt.prototype,"defaultSources",void 0),r([n()],Lt.prototype,"disabled",void 0),r([N("viewModel.goToOverride")],Lt.prototype,"goToOverride",void 0),r([n()],Lt.prototype,"iconClass",void 0),r([N("viewModel.includeDefaultSources")],Lt.prototype,"includeDefaultSources",void 0),r([n({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Lt.prototype,"label",void 0),r([N("viewModel.locationEnabled")],Lt.prototype,"locationEnabled",void 0),r([N("viewModel.maxResults")],Lt.prototype,"maxResults",void 0),r([N("viewModel.maxSuggestions")],Lt.prototype,"maxSuggestions",void 0),r([n(),P("esri/widgets/Search/t9n/Search")],Lt.prototype,"messages",void 0),r([n(),P("esri/t9n/common")],Lt.prototype,"messagesCommon",void 0),r([N("viewModel.minSuggestCharacters")],Lt.prototype,"minSuggestCharacters",void 0),r([N("viewModel.popupEnabled")],Lt.prototype,"popupEnabled",void 0),r([N("viewModel.popupTemplate")],Lt.prototype,"popupTemplate",void 0),r([N("viewModel.portal")],Lt.prototype,"portal",void 0),r([N("viewModel.resultGraphic")],Lt.prototype,"resultGraphic",void 0),r([N("viewModel.resultGraphicEnabled")],Lt.prototype,"resultGraphicEnabled",void 0),r([N("viewModel.results")],Lt.prototype,"results",void 0),r([N("viewModel.searchAllEnabled")],Lt.prototype,"searchAllEnabled",void 0),r([N("viewModel.searchTerm")],Lt.prototype,"searchTerm",void 0),r([N("viewModel.selectedResult")],Lt.prototype,"selectedResult",void 0),r([N("viewModel.sources")],Lt.prototype,"sources",void 0),r([N("viewModel.suggestions")],Lt.prototype,"suggestions",void 0),r([N("viewModel.suggestionsEnabled")],Lt.prototype,"suggestionsEnabled",void 0),r([N("viewModel.view")],Lt.prototype,"view",void 0),r([oe(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),n({type:Tt})],Lt.prototype,"viewModel",void 0),r([N("viewModel.clear")],Lt.prototype,"clear",null),Lt=r([o("esri.widgets.Search")],Lt);const At=Lt;let Nt=class{constructor(s){e(this,s),this.searchBlur=t(this,"searchBlur",7),this.searchClear=t(this,"searchClear",7),this.searchComplete=t(this,"searchComplete",7),this.searchFocus=t(this,"searchFocus",7),this.searchStart=t(this,"searchStart",7),this.selectResult=t(this,"selectResult",7),this.suggestComplete=t(this,"suggestComplete",7),this.suggestStart=t(this,"suggestStart",7)}validateView(e){e&&(this.widget.view=e,"arcgis-expand"!==this.el.parentElement.tagName.toLowerCase()&&this.widget.view.ui.add(this.widget,this.position))}componentWillLoad(){const e=new At({container:this.el});e.on("search-blur",(e=>this.searchBlur.emit(e))),e.on("search-clear",(e=>this.searchClear.emit(e))),e.on("search-complete",(e=>this.searchComplete.emit(e))),e.on("search-focus",(e=>this.searchFocus.emit(e))),e.on("search-start",(e=>this.searchStart.emit(e))),e.on("select-result",(e=>this.selectResult.emit(e))),e.on("suggest-complete",(e=>this.suggestComplete.emit(e))),e.on("suggest-start",(e=>this.suggestStart.emit(e))),this.widget=e}render(){return s("div",{class:"search-container"})}get el(){return i(this)}static get watchers(){return{view:["validateView"]}}};Nt.style="@import url('https://js.arcgis.com/next/esri/themes/light/main.css');";export{Nt as arcgis_search}