import{da as n,db as t,bt as s,br as i,aJ as r,ci as e,A as o}from"./p-e58503d5.js";import{Q as u,r as a}from"./p-c93d2280.js";import{t as c}from"./p-50ff864e.js";const l=[0,0];function f(n,t){if(!t)return null;if("x"in t){const s={x:0,y:0};return[s.x,s.y]=n(t.x,t.y,l),null!=t.z&&(s.z=t.z),null!=t.m&&(s.m=t.m),s}if("xmin"in t){const s={xmin:0,ymin:0,xmax:0,ymax:0};return[s.xmin,s.ymin]=n(t.xmin,t.ymin,l),[s.xmax,s.ymax]=n(t.xmax,t.ymax,l),t.hasZ&&(s.zmin=t.zmin,s.zmax=t.zmax,s.hasZ=!0),t.hasM&&(s.mmin=t.mmin,s.mmax=t.mmax,s.hasM=!0),s}return"rings"in t?{rings:h(t.rings,n),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:h(t.paths,n),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:p(t.points,n),hasM:t.hasM,hasZ:t.hasZ}:void 0}function h(n,t){const s=[];for(const i of n)s.push(p(i,t));return s}function p(n,t){const s=[];for(const i of n){const n=t(i[0],i[1],[0,0]);s.push(n),i.length>2&&n.push(i[2]),i.length>3&&n.push(i[3])}return s}async function m(n,t){if(!t)return;const s=Array.isArray(n)?n.map((n=>o(n.geometry)&&n.geometry.spatialReference)):[n];await a(s.map((n=>({source:n,dest:t}))))}const x=f.bind(null,n),d=f.bind(null,t);function y(n,t,o){return n?(o||(o=t,t=n.spatialReference),s(t)&&s(o)&&!i(t,o)?r(t,o)?e(o)?x(n):d(n):u(c,[n],t,o,null)[0]:n):n}const g=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(n,t,s){if(!n||!n.length||!t||!s||i(t,s))return n;const r={geometries:n,inSpatialReference:t,outSpatialReference:s,resolve:null};return this._jobs.push(r),new Promise((n=>{r.resolve=n,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const n=this._jobs.shift();if(!n)return;const{geometries:t,inSpatialReference:s,outSpatialReference:i,resolve:o}=n;r(s,i)?e(i)?o(t.map(x)):o(t.map(d)):o(u(c,t,s,i,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function R(n,t,s){return g.push(n,t,s)}export{R as M,m as f,y as g}