import{t}from"./p-9ae46e68.js";import{aq as e,bi as n}from"./p-566b0715.js";import{w as r}from"./p-b392deaf.js";import{c as s}from"./p-47e1bd73.js";import{A as o}from"./p-16def889.js";import{o as i}from"./p-9739c166.js";function u(t,e=0,n=!1){const r=t[e+3];return t[e+0]*=r,t[e+1]*=r,t[e+2]*=r,n||(t[e+3]*=255),t}function a(t){if(!t)return 0;const{r:e,g:n,b:s,a:o}=t;return r(e*o,n*o,s*o,255*o)}function l(t){if(!t)return 0;const[e,n,s,o]=t;return r(e*(o/255),n*(o/255),s*(o/255),o)}const c=(t,e)=>t&&((...t)=>e.warn("DEBUG:",...t))||(()=>null),f=!1;function p(t,e){if(!t||!e)return t;switch(e){case"radius":case"distance":return 2*t;case"diameter":case"width":return t;case"area":return Math.sqrt(t)}return t}function m(t){return t.map((t=>function(t){return{value:t.value,size:e(t.size)}}(t)))}function v(t){return"string"==typeof t||"number"==typeof t?e(t):{type:"size",expression:t.expression,stops:m(t.stops)}}const d=t=>{const e=[],r=[],o=m(t),i=o.length;for(let t=0;t<6;t++){const u=o[Math.min(t,i-1)];e.push(u.value),r.push(null==u.size?s:n(u.size))}return{values:new Float32Array(e),sizes:new Float32Array(r)}};function y(t){const e=t&&t.length>0?{}:null,n=e?{}:null;if(!e)return{vvFields:e,vvRanges:n};for(const r of t)if(r.field&&(e[r.type]=r.field),"size"===r.type){n.size||(n.size={});const t=r;switch(i(t)){case o.SIZE_MINMAX_VALUE:n.size.minMaxValue={minDataValue:t.minDataValue,maxDataValue:t.maxDataValue,minSize:v(t.minSize),maxSize:v(t.maxSize)};break;case o.SIZE_SCALE_STOPS:n.size.scaleStops={stops:m(t.stops)};break;case o.SIZE_FIELD_STOPS:if(t.levels){const e={};for(const n in t.levels)e[n]=d(t.levels[n]);n.size.fieldStops={type:"level-dependent",levels:e}}else n.size.fieldStops={type:"static",...d(t.stops)};break;case o.SIZE_UNIT_VALUE:n.size.unitValue={unit:t.valueUnit,valueRepresentation:t.valueRepresentation}}}else"color"===r.type?n.color=g(r):"opacity"===r.type?n.opacity=b(r):"rotation"===r.type&&(n.rotation={type:r.rotationType});return{vvFields:e,vvRanges:n}}function b(t){const e={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof t.field){if(!t.stops)return null;{if(t.stops.length>8)return null;const n=t.stops;for(let t=0;t<8;++t){const r=n[Math.min(t,n.length-1)];e.values[t]=r.value,e.opacities[t]=r.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return null;{const n=t.stops&&t.stops.length>=0&&t.stops[0].opacity;for(let t=0;t<8;t++)e.values[t]=1/0,e.opacities[t]=n}}return e}function h(t,e,n){t[4*e+0]=n.r/255,t[4*e+1]=n.g/255,t[4*e+2]=n.b/255,t[4*e+3]=n.a}function g(e){if(t(e))return null;if(e.normalizationField)return null;const n={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;n.field=e.field;const t=e.stops;for(let e=0;e<8;++e){const r=t[Math.min(e,t.length-1)];n.values[e]=r.value,h(n.colors,e,r.color)}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const t=e.stops&&e.stops.length>=0&&e.stops[0].color;for(let e=0;e<8;e++)n.values[e]=1/0,h(n.colors,e,t)}}for(let t=0;t<32;t+=4)u(n.colors,t,!0);return n}export{l as f,a as i,f as l,y as m,c as n,p as r}