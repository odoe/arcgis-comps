import{e as p,d as t,i as s,n as i,p as r,A as o,s as e}from"./p-e58503d5.js";import{a as m}from"./p-b79fcce3.js";import{h as j}from"./p-54330161.js";import{a}from"./p-7731c620.js";import{t as c,h as d}from"./p-bdb15d78.js";import{s as n,E as b}from"./p-d7e4c9b1.js";import{b as f}from"./p-5e833dfc.js";import{p as h}from"./p-cbbdb7db.js";import{u as l}from"./p-a63f7978.js";import{y as u}from"./p-6a92ecb9.js";import"./p-53bb6ab4.js";import"./p-93765525.js";import"./p-765e6c28.js";import"./p-a9a30646.js";import"./p-8747982c.js";import"./p-8bc9b36a.js";import"./p-7a658388.js";import"./p-e273719b.js";import"./p-74de0937.js";import"./p-2f398ed1.js";import"./p-d3105731.js";import"./p-fb38a9d0.js";import"./p-f94762ac.js";import"./p-ea916a39.js";import"./p-8a919d07.js";import"./p-efbca0ca.js";import"./p-c048b814.js";import"./p-5d962998.js";import"./p-7ec84656.js";import"./p-bba8b671.js";import"./p-01e5a461.js";import"./p-9087b4d3.js";import"./p-c1cd5521.js";import"./p-ca4492df.js";import"./p-9d34911e.js";import"./p-182bb5be.js";import"./p-db87794e.js";import"./p-2db4840f.js";import"./p-340cd100.js";import"./p-2c84c65f.js";import"./p-95909347.js";import"./p-ccdb8e80.js";import"./p-4d38e149.js";import"./p-3c70d22f.js";import"./p-8f986f60.js";import"./p-746a9d8f.js";import"./p-728dcbb0.js";import"./p-ea0c022e.js";import"./p-1c99992b.js";import"./p-dcdb33cf.js";import"./p-6ded4c02.js";import"./p-0d1e969a.js";import"./p-7f47b970.js";import"./p-e6fe5d89.js";import"./p-5763113b.js";import"./p-eb48bb01.js";import"./p-b9aa4901.js";import"./p-a3955219.js";import"./p-c2152437.js";import"./p-0bb84768.js";import"./p-19bc1e3d.js";import"./p-a24f7752.js";import"./p-37f005a2.js";import"./p-f06611ed.js";import"./p-bdf9e611.js";import"./p-a72732f2.js";import"./p-a8d1cf30.js";import"./p-a6c8fb32.js";import"./p-6b2eb7a7.js";import"./p-c93d2280.js";import"./p-fea9512d.js";import"./p-3bcc4805.js";import"./p-3721667d.js";import"./p-4019eec3.js";import"./p-a131049b.js";import"./p-a2324023.js";import"./p-025c0c8e.js";import"./p-e72a43d7.js";import"./p-97ec6ae5.js";import"./p-382f7028.js";import"./p-56ed1c7a.js";import"./p-04a0cfca.js";import"./p-b0565d49.js";import"./p-ca295674.js";import"./p-41f2b2dd.js";import"./p-e654504b.js";import"./p-da33e926.js";import"./p-42bb6c1e.js";import"./p-2e37d910.js";import"./p-7ca40eac.js";import"./p-e1b62a0c.js";import"./p-7de54cd0.js";import"./p-6484267b.js";import"./p-400ca3dc.js";import"./p-9b7a2176.js";import"./p-0eb619a6.js";import"./p-4d17d2cd.js";import"./p-b5b00e38.js";import"./p-e94b450b.js";import"./p-1189fa83.js";import"./p-37058f88.js";import"./p-3e39c093.js";import"./p-7a5bfd29.js";import"./p-7d081d01.js";import"./p-afac6fb2.js";import"./p-612a2c14.js";import"./p-d443df87.js";import"./p-dc852195.js";import"./p-ff2962f5.js";import"./p-da9e7ba9.js";import"./p-a8f0aa27.js";import"./p-4a96de15.js";import"./p-5032dfbd.js";import"./p-a87cccba.js";import"./p-dae095dd.js";import"./p-0e784e4d.js";import"./p-dbdf15fc.js";import"./p-e0d9ff4c.js";import"./p-08e5f531.js";import"./p-dfc6337f.js";import"./p-9f1c2d50.js";import"./p-889f7a78.js";import"./p-1f81b35d.js";import"./p-81b9df84.js";import"./p-5ce39624.js";import"./p-e9bae5e9.js";import"./p-51a17e75.js";import"./p-d208934e.js";import"./p-480e5606.js";import"./p-22c9f19c.js";import"./p-c096b5df.js";import"./p-4a6dc5e4.js";import"./p-1ab449fc.js";import"./p-e3270d48.js";import"./p-e44bd0a6.js";import"./p-fe68aab5.js";import"./p-c6970847.js";import"./p-de86b3c9.js";import"./p-37d3434c.js";import"./p-120b7410.js";import"./p-b1eff69d.js";import"./p-612de336.js";import"./p-0edb3309.js";import"./p-e8160b60.js";import"./p-2e8ad983.js";import"./p-91fe06d4.js";import"./p-ab0e9273.js";import"./p-15a9486c.js";import"./p-2ae44317.js";import"./p-9f58a277.js";import"./p-9e860e7b.js";import"./p-f3659a34.js";import"./p-ca657fcf.js";import"./p-b312c1fd.js";import"./p-b8beb0d3.js";import"./p-2a99994a.js";import"./p-76f37e40.js";import"./p-eee9ef50.js";import"./p-1e473dab.js";import"./p-d1d9dbe4.js";import"./p-d57f9971.js";import"./p-db4d63dc.js";import"./p-389c5380.js";import"./p-5f8e8f6c.js";import"./p-d2d87566.js";import"./p-db63fa0e.js";import"./p-21bd46cc.js";import"./p-4f86c37f.js";import"./p-fd584619.js";import"./p-31225789.js";import"./p-a4587ab0.js";import"./p-954786fa.js";import"./p-d87e82bf.js";import"./p-b05e75b2.js";import"./p-2f5c7e83.js";import"./p-58c16730.js";import"./p-70787875.js";import"./p-1f1360f9.js";import"./p-1a2ab148.js";import"./p-09dd2137.js";import"./p-24d8fcee.js";import"./p-e9596294.js";import"./p-fbb06b4d.js";import"./p-4414d64f.js";import"./p-1ccb0bf6.js";import"./p-1c2ff3a7.js";import"./p-77b9a0fc.js";import"./p-6fe4db61.js";import"./p-f6a340f9.js";import"./p-9fe35ea1.js";import"./p-de5b11d6.js";import"./p-f70b836b.js";import"./p-62b5bdb3.js";import"./p-e31c89bd.js";import"./p-cc2794db.js";import"./p-f8414adc.js";import"./p-8925cd73.js";import"./p-58386239.js";import"./p-285c6a34.js";import"./p-7392987e.js";import"./p-bfea9714.js";import"./p-61f47d2b.js";import"./p-e49308c6.js";import"./p-50ff864e.js";import"./p-06d309e6.js";import"./p-292d2320.js";import"./p-8bcb4bb3.js";import"./p-85a6d41b.js";import"./p-03d6250d.js";import"./p-0b395493.js";import"./p-8fa44ebc.js";import"./p-6f439939.js";import"./p-0923eebd.js";import"./p-568eb6e8.js";import"./p-c7a58085.js";var y;let v=y=class extends j{getObjectId(){return this.objectId}clone(){return new y({objectId:this.objectId,...this.cloneProperties()})}};p([t({type:Number,json:{read:!0}})],v.prototype,"objectId",void 0),v=y=p([s("esri.layers.graphics.controllers.StreamGraphic")],v);class g{constructor(p){this.onUpdate=p,this._idToGraphic=new Map}destroy(){this._idToGraphic.clear()}add(p){this._idToGraphic.set(p.objectId,p)}get(p){return this._idToGraphic.get(p)}forEach(p){this._idToGraphic.forEach(p)}removeById(p){const t=this._idToGraphic.get(p);return t?(t.sourceLayer=t.layer=null,this._idToGraphic.delete(p),t):null}update(p,t){this.onUpdate(p,t)}get size(){return this._idToGraphic.size}}let w=class extends(a(i(r))){constructor(){super(...arguments),this._updateInfo={websocket:0,client:0},this.graphics=new n}initialize(){this.addResolvingPromise(this.layer.when((()=>this._startup())))}destroy(){this.clear()}clear(){this._updateIntervalId&&(clearInterval(this._updateIntervalId),this._updateIntervalId=0),this.connection&&(this.connection.destroy(),this.connection=null),this.store&&(this.store.destroy(),this.store=null),this.graphics.clear(),this.handles.removeAll()}get updating(){return!this.connection||"connected"===this.connection.connectionStatus}_startup(){const{parsedUrl:p,spatialReference:t,definitionExpression:s,geometryDefinition:i,objectIdField:r,timeInfo:o,purgeOptions:e,maxReconnectionAttempts:j,maxReconnectionInterval:a,updateInterval:n}=this.layer,b=m.toJSON(this.layer.geometryType),f=t,h=this.layerView.view.spatialReference,l={geometry:i,where:s};this.clear(),this._set("connection",c(p,f,h,b,l,j,a)),this._outSpatialReference=h.toJSON(),this.store=new g(this._onUpdate.bind(this)),this.featuresManager=new d(this.store,r,o.toJSON(),e),this.handles.add([this.connection.on("feature",(p=>this._onFeature(p))),this.layer.watch("definitionExpression",(()=>this._startup())),this.layer.watch("geometryDefinition",(()=>this._startup())),this.layer.watch("purgeOptions",(()=>this._startup()))]);let u=performance.now();this._updateIntervalId=setInterval((()=>{const p=performance.now(),t=p-u;if(t>2500){u=p;const s=Math.round(this._updateInfo.client/(t/1e3)),i=Math.round(this._updateInfo.websocket/(t/1e3));this._updateInfo.client=0,this._updateInfo.websocket=0,this.layerView.emit("update-rate",{client:s,websocket:i})}this.featuresManager.checkForUpdates()}),n)}_onFeature(p){this._updateInfo.websocket++,this.layerView.hasEventListener("data-received")&&this.layerView.emit("data-received",{attributes:p.attributes,centroid:p.centroid,geometry:p.geometry});try{o(p.geometry)&&!p.geometry.spatialReference&&(p.geometry.spatialReference=this._outSpatialReference);const t=v.fromJSON(p);t.sourceLayer=t.layer=this.layer,this.featuresManager.add(t)}catch{}}_onUpdate(p,t){o(t)&&this.graphics.removeMany(t),o(p)&&(this._updateInfo.client+=p.length,this.graphics.addMany(p))}};p([t()],w.prototype,"connection",void 0),p([t()],w.prototype,"layer",void 0),p([t()],w.prototype,"layerView",void 0),p([t({readOnly:!0})],w.prototype,"updating",null),w=p([s("esri.layers.graphics.controllers.StreamController")],w);const O=w,x=i=>{let r=class extends i{constructor(...p){super(...p),this.connectionError=null,this.connectionStatus="disconnected",this.filter=null}};return p([t({readOnly:!0})],r.prototype,"connectionError",void 0),p([t({aliasOf:"controller.connection.connectionStatus",readOnly:!0})],r.prototype,"connectionStatus",void 0),p([t({type:u})],r.prototype,"filter",void 0),r=p([s("esri.layers.mixins.StreamLayerView")],r),r};let I=class extends(x(b(h(l)))){constructor(){super(...arguments),this.type="stream-3d",this.updatePolicy=0,this.hasZ=!0,this.hasM=!1}get connectionError(){const p=this.get("controller.connection.errorString");if(p)return new e("stream-controller",p)}createQuery(){return new f({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryLatestObservations(p,t){return this.queryEngine.executeQueryForLatestObservations(this._ensureQuery(p),null==t?void 0:t.signal)}createController(){return new O({layer:this.layer,layerView:this})}beforeSetController(){}};p([t({readOnly:!0})],I.prototype,"updatePolicy",void 0),p([t({readOnly:!0})],I.prototype,"connectionError",null),p([t()],I.prototype,"controller",void 0),p([t({readOnly:!0})],I.prototype,"hasZ",void 0),p([t({readOnly:!0})],I.prototype,"hasM",void 0),I=p([s("esri.views.3d.layers.StreamLayerView3D")],I);const S=I;export default S;