import{fq as n,fx as t,fA as r,e as o,d as a,i as e,a6 as s,cf as i,b$ as u,fB as l,fC as f,fD as c,fE as p,fF as h,fG as m,fH as y,fI as g,fJ as F,ac as v,W as A,fK as w,fL as b,fM as j,fN as d,fO as P,s as x,fP as N,fQ as C,fR as M,fS as z,fT as I,fU as q,fV as B,fW as L,fn as O,g as R,fX as T,fY as U,fZ as W,f_ as $,f$ as D}from"./p-7b6f6c18.js";import{e as E,a as G}from"./p-2794293b.js";import{e as H,a as J}from"./p-01158f1c.js";import{I as K,v as Q,P as S}from"./p-40add4eb.js";import{T as V,i as X}from"./p-1aa417b4.js";import{e as Y,a as Z,f as _,o as k}from"./p-52d1e8f5.js";function nn(n=en){return[n[0],n[1],n[2],n[3]]}function tn(t,r,o=nn()){return n(o,t),o[3]=r,o}function rn(n,t,o=nn()){return K(sn,n,an(n)),K(un,t,an(t)),Q(sn,un,sn),function(n,t){return n[3]=t,n}(o,r(S(o,sn)))}function on(n){return n}function an(n){return t(n[3])}const en=[0,0,1,0],sn=E(),un=E();var ln;let fn=ln=class extends s{constructor(n){super(n),this.origin=i(),this.translation=i(),this.rotation=nn(),this.scale=u(1,1,1),this.geographic=!0}get localMatrix(){const n=H();return l(n,n,this.scale),f(n,n,an(this.rotation),this.rotation),c(n,n,this.translation),n}get localMatrixInverse(){return p(H(),this.localMatrix)}applyLocal(n,t){return h(t,n,this.localMatrix)}applyLocalInverse(n,t){return h(t,n,this.localMatrixInverse)}project(n,t){const r=new Float64Array(n.length),o=V.fromTypedArray(r),a=V.fromTypedArray(n);if(this.geographic){const n=j(P(t)),e=H();return m(t,this.origin,e,n),y(e,e,this.localMatrix),Y(o,a,e),g(r,n,0,r,t,0,r.length/3),r}const{localMatrix:e,origin:s}=this;F(e,J)?Z(o,a):Y(o,a,e);for(let n=0;n<r.length;n+=3)r[n+0]+=s[0],r[n+1]+=s[1],r[n+2]+=s[2];return r}getOriginPoint(n){const[t,r,o]=this.origin;return new v({x:t,y:r,z:o,spatialReference:n})}equals(n){return A(n)&&this.geographic===n.geographic&&w(this.origin,n.origin)&&b(this.localMatrix,n.localMatrix)}clone(){const n={origin:d(this.origin),translation:d(this.translation),rotation:nn(this.rotation),scale:d(this.scale),geographic:this.geographic};return new ln(n)}};o([a({type:[Number],nonNullable:!0,json:{write:!0}})],fn.prototype,"origin",void 0),o([a({type:[Number],nonNullable:!0,json:{write:!0}})],fn.prototype,"translation",void 0),o([a({type:[Number],nonNullable:!0,json:{write:!0}})],fn.prototype,"rotation",void 0),o([a({type:[Number],nonNullable:!0,json:{write:!0}})],fn.prototype,"scale",void 0),o([a({type:Boolean,nonNullable:!0,json:{write:!0}})],fn.prototype,"geographic",void 0),o([a()],fn.prototype,"localMatrix",null),o([a()],fn.prototype,"localMatrixInverse",null),fn=ln=o([e("esri.geometry.support.MeshTransform")],fn);const cn=fn;function pn(n,t){var r;return n.isGeographic||n.isWebMercator&&(null==(r=null==t?void 0:t.geographic)||r)}const hn=x.getLogger("esri.geometry.support.meshUtils.normalProjection");function mn(n,t,r,o,a){return Pn(o)?(dn(0,X.fromTypedArray(n),V.fromTypedArray(t),V.fromTypedArray(r),o,X.fromTypedArray(a)),a):(hn.error("Cannot convert spatial reference to PCPF"),a)}function yn(n,t,r,o,a){return Pn(o)?(dn(1,X.fromTypedArray(n),V.fromTypedArray(t),V.fromTypedArray(r),o,X.fromTypedArray(a)),a):(hn.error("Cannot convert to spatial reference from PCPF"),a)}function gn(n,t,r){return g(n,t,0,r,N(t),0,n.length/3),r}function Fn(n,t,r){return g(n,N(r),0,t,r,0,n.length/3),t}function vn(n,t,r){if(R(n))return t;const o=V.fromTypedArray(n),a=V.fromTypedArray(t);return Y(a,o,r),t}function An(n,t,r){if(R(n))return t;T(zn,r);const o=X.fromTypedArray(n),a=X.fromTypedArray(t);return _(a,o,zn),U(zn)||k(a,a),t}function wn(n,t,r){if(R(n))return t;T(zn,r);const o=X.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT),a=X.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(_(a,o,zn),U(zn)||k(a,a),n!==t)for(let r=3;r<n.length;r+=4)t[r]=n[r];return t}function bn(n,t,r,o,a){if(!Pn(o))return hn.error("Cannot convert spatial reference to PCPF"),a;dn(0,X.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT),V.fromTypedArray(t),V.fromTypedArray(r),o,X.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT));for(let t=3;t<n.length;t+=4)a[t]=n[t];return a}function jn(n,t,r,o,a){if(!Pn(o))return hn.error("Cannot convert to spatial reference from PCPF"),a;dn(1,X.fromTypedArray(n,16),V.fromTypedArray(t),V.fromTypedArray(r),o,X.fromTypedArray(a,16));for(let t=3;t<n.length;t+=4)a[t]=n[t];return a}function dn(n,t,r,o,a,e){if(!t)return;const s=r.count,i=N(a);if(xn(a))for(let r=0;r<s;r++)o.getVec(r,Nn),t.getVec(r,Cn),m(i,Nn,Mn,i),I(zn,Mn),1===n&&q(zn,zn),B(Cn,Cn,zn),e.setVec(r,Cn);else for(let a=0;a<s;a++){o.getVec(a,Nn),t.getVec(a,Cn),m(i,Nn,Mn,i),I(zn,Mn);const s=L(r.get(a,1));let u=Math.cos(s);0===n&&(u=1/u),zn[0]*=u,zn[1]*=u,zn[2]*=u,zn[3]*=u,zn[4]*=u,zn[5]*=u,1===n&&q(zn,zn),B(Cn,Cn,zn),O(Cn,Cn),e.setVec(a,Cn)}return e}function Pn(n){return xn(n)||function(n){return n.isWebMercator}(n)}function xn(n){return n.isWGS84||C(n)||M(n)||z(n)}const Nn=i(),Cn=i(),Mn=H(),zn=G();function In(n,t,r){return pn(t.spatialReference,r)?function(n,t,r){const o=t.spatialReference,a=$n(t,r,Hn),e=new Float64Array(n.position.length),s=function(n,t,r,o){Y(V.fromTypedArray(o),V.fromTypedArray(n),t);return Fn(o,new Float64Array(n.length),r)}(n.position,a,o,e),i=T(Kn,a);return{position:s,normal:Rn(s,e,n.normal,i,o),tangent:Tn(s,e,n.tangent,i,o)}}(n,t,r):function(n,t,r){const o=new Float64Array(n.position.length),a=n.position,e=t.x,s=t.y,i=t.z||0,{horizontal:u,vertical:l}=Gn(r?r.unit:null,t.spatialReference);for(let n=0;n<a.length;n+=3)o[n+0]=a[n+0]*u+e,o[n+1]=a[n+1]*u+s,o[n+2]=a[n+2]*l+i;return{position:o,normal:n.normal,tangent:n.tangent}}(n,t,r)}function qn(n,t,r){const{position:o,normal:a,tangent:e}=n;if(R(t))return{position:o,normal:a,tangent:e};const s=t.localMatrix;return In({position:vn(o,new Float64Array(o.length),s),normal:A(a)?An(a,new Float32Array(a.length),s):null,tangent:A(e)?wn(e,new Float32Array(e.length),s):null},t.getOriginPoint(r),{geographic:t.geographic})}function Bn(n,t,r){if(null!=r&&r.useTransform){var o;const{position:a,normal:e,tangent:s}=n;return{vertexAttributes:{position:a,normal:e,tangent:s},transform:new cn({origin:[t.x,t.y,null!=(o=t.z)?o:0],geographic:pn(t.spatialReference,r)})}}return{vertexAttributes:In(n,t,r),transform:null}}function Ln(n,t,r){return pn(t.spatialReference,r)?Wn(n,t,r):Un(n,t,r)}function On(n,t,r,o){if(R(t))return Ln(n,r,o);const a=qn(n,t,r.spatialReference);return r.equals(t.getOriginPoint(r.spatialReference))?Un(a,r,o):pn(r.spatialReference,o)?Wn(a,r,o):Un(a,r,o)}function Rn(n,t,r,o,a){if(R(r))return null;const e=new Float32Array(r.length);return _(X.fromTypedArray(e),X.fromTypedArray(r),o),yn(e,n,t,a,e),e}function Tn(n,t,r,o,a){if(R(r))return null;const e=new Float32Array(r.length);_(X.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),X.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),o);for(let n=3;n<e.length;n+=4)e[n]=r[n];return jn(e,n,t,a,e),e}function Un(n,t,r){const o=new Float64Array(n.position.length),a=n.position,e=t.x,s=t.y,i=t.z||0,{horizontal:u,vertical:l}=Gn(r?r.unit:null,t.spatialReference);for(let n=0;n<a.length;n+=3)o[n+0]=(a[n+0]-e)/u,o[n+1]=(a[n+1]-s)/u,o[n+2]=(a[n+2]-i)/l;return{position:o,normal:n.normal,tangent:n.tangent}}function Wn(n,t,r){const o=t.spatialReference;$n(t,r,Hn);const a=p(Jn,Hn),e=new Float64Array(n.position.length),s=function(n,t,r,o){const a=gn(n,t,o),e=V.fromTypedArray(a),s=new Float64Array(a.length),i=V.fromTypedArray(s);return Y(i,e,r),s}(n.position,o,a,e),i=T(Kn,a);return{position:s,normal:Dn(n.normal,n.position,e,o,i),tangent:En(n.tangent,n.position,e,o,i)}}function $n(n,t,r){m(n.spatialReference,[n.x,n.y,n.z||0],r,N(n.spatialReference));const{horizontal:o,vertical:a}=Gn(t?t.unit:null,n.spatialReference);return l(r,r,[o,o,a]),r}function Dn(n,t,r,o,a){if(R(n))return null;const e=mn(n,t,r,o,new Float32Array(n.length)),s=X.fromTypedArray(e);return _(s,s,a),e}function En(n,t,r,o,a){if(R(n))return null;const e=bn(n,t,r,o,new Float32Array(n.length)),s=X.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT);return _(s,s,a),e}function Gn(n,t){if(R(n))return Qn;const r=t.isGeographic?1:W(t),o=t.isGeographic?1:$(t),a=D(1,n,"meters");return{horizontal:a*r,vertical:a*o}}const Hn=H(),Jn=H(),Kn=G(),Qn={horizontal:1,vertical:1};export{bn as B,mn as F,Fn as M,cn as O,jn as R,qn as _,yn as a,Bn as b,nn as c,an as d,tn as e,On as f,Ln as k,on as l,rn as q,pn as r,gn as v,In as x}