import{dl as s,dR as t,d2 as e,al as r}from"./p-7b6f6c18.js";import{a as i}from"./p-a4a5967b.js";import{I as h}from"./p-804725e3.js";import{a,b as n,m as o}from"./p-e53f77c2.js";class c extends i{constructor(t,e,r,i,h,a=i,n=h){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new s(t),this.x=e,this.y=r,this.width=i,this.height=h,this.rangeX=a,this.rangeY=n}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(s,r){const i=r/(s.resolution*s.pixelRatio),h=this.transforms.tileMat3,[a,n]=s.toScreenNoRotation([0,0],[this.x,this.y]);t(h,this.width/this.rangeX*i,0,0,0,this.height/this.rangeY*i,0,a,n,1),e(this.transforms.dvs,s.displayViewMat3,h)}}const u=(s,t)=>s.key.level-t.key.level!=0?s.key.level-t.key.level:s.key.row-t.key.row!=0?s.key.row-t.key.row:s.key.col-t.key.col;class p extends a{constructor(s){super(),this._tileInfoView=s}get requiresDedicatedFBO(){return!1}renderChildren(s){this.sortChildren(u),this.setStencilReference(),super.renderChildren(s)}createRenderParams(s){const{state:t}=s,e=super.createRenderParams(s);return e.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,e.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),e}prepareRenderPasses(s){const t=super.prepareRenderPasses(s);return t.push(s.registerRenderPass({name:"stencil",brushes:[n],drawPhase:h.DEBUG|h.MAP|h.HIGHLIGHT,target:()=>this.getStencilTarget()})),r("esri-tiles-debug")&&t.push(s.registerRenderPass({name:"tileInfo",brushes:[o],drawPhase:h.DEBUG,target:()=>this.children})),t}getStencilTarget(){return this.children}updateTransforms(s){for(const t of this.children){const e=this._tileInfoView.getTileResolution(t.key);t.setTransform(s,e)}}setStencilReference(){let s=1;for(const t of this.children)t.stencilRef=s++}}export{p as o,c as r}