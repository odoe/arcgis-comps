import{ad as e,e as t,d as s,i,v as n,P as l,W as r,bb as a,H as o,t as u,bc as h,c as d,ah as c,_ as f,m as y,bd as p}from"./p-9ae46e68.js";import{y as m,ae as b,af as g,w as v,ag as w,ah as S,P as j,ai as V,aj as I,o as q,d as O,f as N,j as k,ak as F,al as x,am as B}from"./p-566b0715.js";import{v as U,p as $}from"./p-bb07d873.js";import{a as M}from"./p-fe01b82b.js";import{c as P}from"./p-a0a931f0.js";import{m as R}from"./p-30ddb3a0.js";import{m as z}from"./p-74fc1b7f.js";import{m as C}from"./p-b3024dec.js";const T={types:m,json:{write:{writer:z},origins:{"web-scene":{types:b,write:{writer:z},read:{reader:e({types:b})}}}}},E={types:{base:g,key:"type",typeMap:{"simple-fill":v.typeMap["simple-fill"],"picture-fill":v.typeMap["picture-fill"],"polygon-3d":v.typeMap["polygon-3d"]}},json:{write:{writer:z},origins:{"web-scene":{type:w,write:{writer:z}}}}};var _;let A=_=class extends M{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new _({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};t([s({type:String,json:{write:!0}})],A.prototype,"description",void 0),t([s({type:String,json:{write:!0}})],A.prototype,"label",void 0),t([s({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],A.prototype,"minValue",void 0),t([s({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],A.prototype,"maxValue",void 0),t([s(T)],A.prototype,"symbol",void 0),A=_=t([i("esri.renderers.support.ClassBreakInfo")],A);const J=A;var H;const L=n.getLogger("esri.renderers.ClassBreaksRenderer"),D="percent-of-total",W="field",G=new l({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:D,esriNormalizeByField:W}),K=r(J);let Q=H=class extends(U($)){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,s){if(!Array.isArray(e))return;let i=t.minValue;return e.map((e=>{const t=new J;return t.read(e,s),null==t.minValue&&(t.minValue=i),null==t.maxValue&&(t.maxValue=t.minValue),i=t.maxValue,t}))}writeClassBreakInfos(e,t,s,i){const n=e.map((e=>e.write({},i)));this._areClassBreaksConsecutive()&&n.forEach((e=>delete e.classMinValue)),t[s]=n}castField(e){return null==e?e:"function"==typeof e?(L.error(".field: field must be a string value"),null):a(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,s=null!=this.normalizationTotal;return t||s?(e=(t?W:s&&D)||null,t&&s&&L.warn("warning: both normalizationField and normalizationTotal are set!")):e!==W&&e!==D||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,s){let i=null;i="number"==typeof e?new J({minValue:e,maxValue:t,symbol:S(s)}):K(o(e)),this.classBreakInfos.push(i),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const s=this.classBreakInfos.length;for(let i=0;i<s;i++){const s=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(s[0]===e&&s[1]===t){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(u(t)||u(t.arcade))&&L.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let s=t;this.valueExpression&&(u(t)||u(t.arcade))&&(s={...s,arcade:await j()});const i=this.getBreakIndex(e,s);return-1!==i?this.classBreakInfos[i]:null}getSymbol(e,t){if(this.valueExpression&&(u(t)||u(t.arcade)))return void L.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const s=this.getBreakIndex(e,t);return s>-1?this.classBreakInfos[s].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let s=t;if(this.valueExpression&&(u(t)||u(t.arcade))){const e=await j(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),s={...s,arcade:e}}const i=this.getBreakIndex(e,s);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach((t=>{t.symbol&&e.push(t.symbol)})),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),s=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${s}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new H({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:o(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:o(this.visualVariables),legendOptions:o(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const s=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(s)}async collectSymbolFields(e,t){const s=[...this.getSymbols().map((s=>s.collectRequiredFields(e,t))),V(e,t,this.valueExpression)];I(e,t,this.field),I(e,t,this.normalizationField),await Promise.all(s)}_getBreakIndexForExpression(e,t){const{viewingMode:s,scale:i,spatialReference:n,arcade:l}=h(t,{});let r=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const a=f(l).arcadeUtils;if(!r){const e=a.createSyntaxTree(this.valueExpression);r=a.createFunction(e),this._compiledValueExpression.compiledFunction=r}this._compiledValueExpression.valueExpression=this.valueExpression;const o=a.executeFunction(r,a.createExecContext(e,a.getViewInfo({viewingMode:s,scale:i,spatialReference:n})));return this._getBreakIndexfromInfos(o)}_getBreakIndexForField(e){const t=e.attributes,s=this.normalizationType;let i=parseFloat(t[this.field]);if(s){const e=this.normalizationTotal,n=parseFloat(t[this.normalizationField]);if("log"===s)i=Math.log(i)*Math.LOG10E;else if(s!==D||isNaN(e)){if(s===W&&!isNaN(n)){if(isNaN(i)||isNaN(n))return-1;i/=n}}else i=i/e*100}return this._getBreakIndexfromInfos(i)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(null!=e&&"number"==typeof e&&!isNaN(e))for(let s=0;s<this.classBreakInfos.length;s++){const i=[this.classBreakInfos[s].minValue,this.classBreakInfos[s].maxValue];if(i[0]<=e&&(t?e<=i[1]:e<i[1]))return s}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let s=1;s<t;s++)if(e[s-1].maxValue!==e[s].minValue)return!1;return!0}};t([s(E)],Q.prototype,"backgroundFillSymbol",void 0),t([s({type:[J]})],Q.prototype,"classBreakInfos",void 0),t([q("classBreakInfos")],Q.prototype,"readClassBreakInfos",null),t([O("classBreakInfos")],Q.prototype,"writeClassBreakInfos",null),t([s({type:String,json:{write:!0}})],Q.prototype,"defaultLabel",void 0),t([s(T)],Q.prototype,"defaultSymbol",void 0),t([s({type:String,json:{write:!0}})],Q.prototype,"field",void 0),t([d("field")],Q.prototype,"castField",null),t([s({type:Boolean})],Q.prototype,"isMaxInclusive",void 0),t([s({type:P,json:{write:!0}})],Q.prototype,"legendOptions",void 0),t([s({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],Q.prototype,"minValue",null),t([s({type:String,json:{write:!0}})],Q.prototype,"normalizationField",void 0),t([s({type:Number,cast:e=>c(e),json:{write:!0}})],Q.prototype,"normalizationTotal",void 0),t([s({type:G.apiValues,value:null,json:{type:G.jsonValues,read:G.read,write:G.write}})],Q.prototype,"normalizationType",null),t([N({classBreaks:"class-breaks"})],Q.prototype,"type",void 0),t([s({type:String,json:{write:!0}})],Q.prototype,"valueExpression",void 0),t([s({type:String,json:{write:!0}})],Q.prototype,"valueExpressionTitle",void 0),Q=H=t([i("esri.renderers.ClassBreaksRenderer")],Q);const X=Q;var Y;let Z=Y=class extends M{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new Y({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};t([s({type:String,json:{write:!0}})],Z.prototype,"description",void 0),t([s({type:String,json:{write:!0}})],Z.prototype,"label",void 0),t([s(T)],Z.prototype,"symbol",void 0),t([s({type:[String,Number],json:{type:String,write:{writer:(e,t)=>{t.value=null==e?void 0:e.toString()}}}})],Z.prototype,"value",void 0),Z=Y=t([i("esri.renderers.support.UniqueValueInfo")],Z);const ee=Z;var te;const se=n.getLogger("esri.renderers.UniqueValueRenderer"),ie=r(ee);let ne=te=class extends(U($)){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,t){if(!e&&!t)return;if(!e||!t)return{type:"complete",oldValue:e,newValue:t};let s=!1;const i={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<t.length;n++){const l=e.find((e=>e.value===t[n].value));l?R(l,t[n])?(i.changed.push({type:"complete",oldValue:l,newValue:t[n]}),s=!0):i.unchanged.push({oldValue:l,newValue:t[n]}):(i.added.push(t[n]),s=!0)}for(let n=0;n<e.length;n++)t.find((t=>t.value===e[n].value))||(i.removed.push(e[n]),s=!0);return s?i:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return null==e||"function"==typeof e?e:a(e)}writeField(e,t,s,i){"string"==typeof e?t[s]=e:i&&i.messages?i.messages.push(new y("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):se.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,s){return s.portal||k.getDefault()}readStyleOrigin(e,t,s){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const e=F(t.styleUrl,s);return Object.freeze({styleUrl:e})}}writeStyleOrigin(e,t,s,i){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=x(e.styleUrl,i))}set uniqueValueInfos(e){this.styleOrigin?se.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void se.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let s;s="object"==typeof e?ie(e):new ee({value:e,symbol:S(t)}),this.uniqueValueInfos.push(s),this._valueInfoMap[s.value]=s}removeUniqueValueInfo(e){if(this.styleOrigin)se.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let s=t;return this.valueExpression&&(u(t)||u(t.arcade))&&(s={...s,arcade:await j()}),this._getUniqueValueInfo(e,s)}getSymbol(e,t){if(this.valueExpression&&(u(t)||u(t.arcade)))return void se.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const s=this._getUniqueValueInfo(e,t);return s&&s.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let s=t;if(this.valueExpression&&(u(s)||u(s.arcade))){const e=await j(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),s={...s,arcade:e}}const i=this._getUniqueValueInfo(e,s);return i&&i.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const e=new te({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:o(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:o(this.visualVariables),legendOptions:o(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:o(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=o(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(o(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const s=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(s)}async collectSymbolFields(e,t){const s=[...this.getSymbols().map((s=>s.collectRequiredFields(e,t))),V(e,t,this.valueExpression)];I(e,t,this.field),I(e,t,this.field2),I(e,t,this.field3),await Promise.all(s)}populateFromStyle(){return C(this.styleOrigin,{portal:this.portal}).then((e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach((s=>{const i=new B({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:s.name});this.defaultSymbol||s.name!==e.data.defaultItem||(this.defaultSymbol=i,this._isDefaultSymbolDerived=!0);const n=new ee({value:s.name,symbol:i});t.push(n),this._valueInfoMap[s.name]=n})),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this}))}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach((e=>this._valueInfoMap[e.value+""]=e))}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:s,scale:i,spatialReference:n,arcade:l}=h(t,{});let r=this._cache.compiledFunc;const a=f(l).arcadeUtils;if(!r){const e=a.createSyntaxTree(this.valueExpression);r=a.createFunction(e),this._cache.compiledFunc=r}const o=a.executeFunction(r,a.createExecContext(e,a.getViewInfo({viewingMode:s,scale:i,spatialReference:n})));return this._valueInfoMap[o+""]}_getUnqiueValueInfoForFields(e){const t=this.field,s=e.attributes;let i;if("function"!=typeof t&&this.field2){const e=this.field2,n=this.field3,l=[];t&&l.push(s[t]),e&&l.push(s[e]),n&&l.push(s[n]),i=l.join(this.fieldDelimiter||"")}else"function"==typeof t?i=t(e):t&&(i=s[t]);return this._valueInfoMap[i+""]}static fromPortalStyle(e,t){const s=new te(t&&t.properties);s._set("styleOrigin",Object.freeze({styleName:e})),s._set("portal",t&&t.portal||k.getDefault());const i=s.populateFromStyle();return i.catch((t=>{se.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",t)})),i}static fromStyleUrl(e,t){const s=new te(t&&t.properties);s._set("styleOrigin",Object.freeze({styleUrl:e}));const i=s.populateFromStyle();return i.catch((t=>{se.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",t)})),i}};t([s({readOnly:!0})],ne.prototype,"_cache",null),t([N({uniqueValue:"unique-value"})],ne.prototype,"type",void 0),t([s(E)],ne.prototype,"backgroundFillSymbol",void 0),t([s({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],ne.prototype,"field",void 0),t([d("field")],ne.prototype,"castField",null),t([O("field")],ne.prototype,"writeField",null),t([s({type:String,json:{write:!0}})],ne.prototype,"field2",void 0),t([s({type:String,json:{write:!0}})],ne.prototype,"field3",void 0),t([s({type:String,json:{write:!0}})],ne.prototype,"valueExpression",void 0),t([s({type:String,json:{write:!0}})],ne.prototype,"valueExpressionTitle",void 0),t([s({type:P,json:{write:!0}})],ne.prototype,"legendOptions",void 0),t([s({type:String,json:{write:!0}})],ne.prototype,"defaultLabel",void 0),t([s(p({...T},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],ne.prototype,"defaultSymbol",null),t([s({type:String,json:{write:!0}})],ne.prototype,"fieldDelimiter",void 0),t([s({type:k,readOnly:!0})],ne.prototype,"portal",void 0),t([q("portal",["styleName"])],ne.prototype,"readPortal",null),t([s({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],ne.prototype,"styleOrigin",void 0),t([q("styleOrigin",["styleName","styleUrl"])],ne.prototype,"readStyleOrigin",null),t([O("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],ne.prototype,"writeStyleOrigin",null),t([s({type:[ee],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],ne.prototype,"uniqueValueInfos",null),ne=te=t([i("esri.renderers.UniqueValueRenderer")],ne);const le=ne;export{X as N,le as P,J as a,T as l,ee as p}