import{e as t,d as i,i as s,a1 as e,D as n,p as h,aE as r,aI as o,A as a,s as l,c,af as u,aJ as d,ar as p,aK as m,aL as w,_ as f,r as v,q as g,h as y,a0 as b,u as M,a as x,aM as O,aN as S,aO as _,aP as V,S as z,K as j}from"./p-e58503d5.js";import{h as k}from"./p-54330161.js";import{p as R}from"./p-e94b450b.js";import{c as T}from"./p-480e5606.js";import{Z as D,n as P,U as N,b as E,a as Z,w as C,t as L,k as G,R as q,h as $,G as A,J as U,P as I,c as K,d as B,e as F,i as J,s as W,F as H,S as Y,l as Q,f as X,u as tt,g as it,o as st,m as et,p as nt,q as ht,r as rt,v as ot,x as at}from"./p-6484267b.js";import{i as lt,d as ct,u as ut,_ as dt,a as pt,c as mt}from"./p-612a2c14.js";import{o as wt,v as ft}from"./p-b79fcce3.js";import{u as vt}from"./p-eee9ef50.js";import{c as gt}from"./p-fb38a9d0.js";import{p as yt,j as bt}from"./p-db63fa0e.js";import{t as Mt,r as xt}from"./p-9658240e.js";import{H as Ot,O as St}from"./p-c93d2280.js";import{d as _t,r as Vt,o as zt,a as jt}from"./p-e6fe5d89.js";import{n as kt}from"./p-746a9d8f.js";import"./p-6448f4dc.js";import{l as Rt,h as Tt}from"./p-75cd09f2.js";import"./p-77b9a0fc.js";import{h as Dt}from"./p-e273719b.js";import{g as Pt,l as Nt}from"./p-de5b11d6.js";var Et;let Zt=Et=class extends e{constructor(t){super(t),this.color=new Dt([0,0,0,1])}clone(){return new Et(n({color:this.color}))}};t([i({type:Dt,json:{write:!0}})],Zt.prototype,"color",void 0),Zt=Et=t([s("esri.webmap.background.ColorBackground")],Zt);const Ct=Zt;class Lt{constructor(t,i,s,e){const n=t.targetGeometry,h=i.targetGeometry;e?"string"==typeof e&&(e=xt(e)||Mt.ease):e=Mt.ease,this.easing=e,this.duration=s,this.sCenterX=n.x,this.sCenterY=n.y,this.sScale=t.scale,this.sRotation=t.rotation,this.tCenterX=h.x,this.tCenterY=h.y,this.tScale=i.scale,this.tRotation=i.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}applyRatio(t,i){const s=this.easing(i);let e,n,h,r;i>=1?(e=this.tCenterX,n=this.tCenterY,h=this.tRotation,r=this.tScale):(e=this.sCenterX+s*this.dCenterX,n=this.sCenterY+s*this.dCenterY,h=this.sRotation+s*this.dRotation,r=this.sScale+s*this.dScale),t.targetGeometry.x=e,t.targetGeometry.y=n,t.scale=r,t.rotation=h}}let Gt=class extends h{constructor(t){super(t),this.duration=200,this.transition=null,this.easing=Mt.ease,this.view=null,this.viewpoint=null,this.viewpoint=new vt({targetGeometry:new r,scale:0,rotation:0}),this._updateTask=o({postRender:this._postRender.bind(this)}),this._updateTask.pause()}destroy(){this._updateTask.remove(),this._updateTask=null}animate(t,i,s){this.stop(),D(this.viewpoint,i),this.transition=new Lt(this.viewpoint,t.target,s&&s.duration||this.duration,s&&s.easing||this.easing);const e=()=>{this.animation===t&&this._updateTask&&("finished"===t.state&&(this.transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return t.when(e,e),this._startTime=performance.now(),this._updateTask.resume(),this.animation=t,t}animateContinous(t,i){this.stop(),this.updateFunction=i,this.viewpoint=t;const s=new P({target:t.clone()}),e=()=>{this.animation===s&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return s.when(e,e),this._startTime=performance.now(),this._updateTask.resume(),this.animation=s,s}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(t){const i=this.animation;if(i&&i.state!==P.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,t.deltaTime);else{const t=(performance.now()-this._startTime)/this.transition.duration,i=t>=1;this.transition.applyRatio(this.viewpoint,t),i&&this.animation.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};t([i()],Gt.prototype,"animation",void 0),t([i()],Gt.prototype,"duration",void 0),t([i()],Gt.prototype,"transition",void 0),t([i()],Gt.prototype,"easing",void 0),t([i()],Gt.prototype,"view",void 0),t([i()],Gt.prototype,"viewpoint",void 0),Gt=t([s("esri.views.2d.AnimationManager")],Gt);const qt=Gt;class $t{constructor(t){this.view=t,this._frameTaskHandle=null,this._updateRequested=!1,this.stationary=!0,this.updateEnabled=!0,this.animationInProgress=!1,this.prepare=()=>{this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions},this.update=()=>{if(this._updateRequested=!1,!this.updateEnabled)return;const{basemapView:t,graphicsView:i,labelManager:s,layerViews:e,state:{id:n}}=this.view;t.baseLayerViews.forEach(this._updateLayerView,this),e.forEach(this._updateLayerView,this),t.referenceLayerViews.forEach(this._updateLayerView,this),a(s)&&(s.lastUpdateId!==n&&(s.viewChange(),s.lastUpdateId=n),s.updateRequested&&s.processUpdate(this._updateParameters)),a(i)&&(i.lastUpdateId!==n&&(i.viewChange(),i.lastUpdateId=n),i.updateRequested&&i.processUpdate(this._updateParameters)),this.view.graphicsTileStore.setViewState(this._updateParameters.state),this.animationInProgress||this._updateRequested||this._frameTaskHandle.pause()}}destroy(){this.stop()}start(){this.stationary=this.view.stationary,this._updateParameters={state:this.view.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:this.view.renderingOptions},this._stationaryHandle=this.view.watch("stationary",(t=>{this.stationary=t,this.requestFrame()})),this._frameTaskHandle=o(this)}stop(){this._frameTaskHandle&&(this._stationaryHandle.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(t){const i=this.view.state,s=t.lastUpdateId;null!=s&&(this.stationary||t.moving)||(t.moving=!0,t.moveStart()),s!==i.id&&t.viewChange(),this.stationary&&t.moving&&(t.moving=!1,t.moveEnd()),t.lastUpdateId=i.id,t.updateRequested&&t.processUpdate(this._updateParameters),"layerViews"in t&&t.layerViews.forEach(this._updateLayerView,this)}}function At(){return Promise.all([import("./p-02b51787.js"),import("./p-4dca50db.js")])}const Ut=()=>At().then((()=>import("./p-a6d6ba64.js"))),It=()=>At().then((()=>import("./p-8ccfab47.js"))),Kt={"base-dynamic":()=>At().then((()=>import("./p-61c3b64d.js"))),"base-tile":Ut,"bing-maps":Ut,csv:It,"geo-rss":()=>At().then((()=>import("./p-80a4746e.js"))),feature:It,geojson:It,graphics:()=>At().then((()=>import("./p-a7982156.js"))),group:()=>At().then((()=>import("./p-07d64fa4.js"))),imagery:()=>At().then((()=>import("./p-0581454b.js"))),"imagery-tile":()=>At().then((()=>import("./p-17439a2e.js"))),kml:()=>At().then((()=>import("./p-f6a2bd57.js"))),"map-image":()=>At().then((()=>import("./p-bbc805db.js"))),"map-notes":()=>At().then((()=>import("./p-3a797647.js"))),"ogc-feature":()=>At().then((()=>import("./p-31ccc8e9.js"))),"open-street-map":Ut,route:()=>At().then((()=>import("./p-b53f6fa8.js"))),stream:()=>At().then((()=>import("./p-2fbd0012.js"))),"subtype-group":()=>At().then((()=>import("./p-a7fed4fb.js"))),tile:Ut,"vector-tile":()=>At().then((()=>import("./p-cb7e561d.js"))),wcs:()=>At().then((()=>import("./p-17439a2e.js"))),"web-tile":Ut,wfs:It,wms:()=>At().then((()=>import("./p-74797260.js"))),wmts:()=>At().then((()=>import("./p-d21e6164.js"))),analysis:null,"base-elevation":null,"building-scene":null,elevation:null,"integrated-mesh":null,"point-cloud":null,voxel:null,scene:null,unknown:null,unsupported:null};var Bt;const Ft=c.getLogger("esri.views.MapView");let Jt=Bt=class extends h{constructor(t){super(t),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){return u(this.geometry)||!this.spatialReference?null:this.spatialReference.equals(this.geometry.spatialReference)?this.geometry:d(this.geometry,this.spatialReference)?p(this.geometry,this.spatialReference):Ot()?St(this.geometry,this.spatialReference):(Ft.error("#constraints.geometry","unsupported coordinate system. The source geometry cannot be projected to the view's coordinate system. The projection engine cannot be loaded.",{geometry:this.geometry}),null)}constrain(t,i){if(u(this.normalizedGeometry))return t;const s=t.targetGeometry;if("extent"===this.normalizedGeometry.type?m(this.normalizedGeometry,s):w(this.normalizedGeometry,s))return t;const{coordinate:e}=function(t,i){const{spatialReference:s}=i,e=[i.x,i.y];let n=Number.POSITIVE_INFINITY,h=0,o=0;const a=[0,0],l="extent"===t.type?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:t.rings;for(const t of l)for(let i=0;i<t.length-1;i++){wt(a,e,t,i);const s=_t(e,a);s<n&&(n=s,h=a[0],o=a[1])}return{coordinate:new r({x:h,y:o,spatialReference:s}),distance:n}}(this.normalizedGeometry,s);return e?(t.targetGeometry=e,t):t}clone(){var t,i;return new Bt({geometry:null==(t=this.geometry)?void 0:t.clone(),spatialReference:null==(i=this.spatialReference)?void 0:i.clone()})}};var Wt;t([i({constructOnly:!0})],Jt.prototype,"geometry",void 0),t([i({readOnly:!0})],Jt.prototype,"normalizedGeometry",null),t([i({constructOnly:!0})],Jt.prototype,"spatialReference",void 0),Jt=Bt=t([s("esri.views.2d.constraints.GeometryConstraint")],Jt);let Ht=Wt=class extends h{constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(t,i){return this.enabled&&i?(this.rotationEnabled||(t.rotation=i.rotation),t):t}clone(){return new Wt({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};t([i()],Ht.prototype,"enabled",void 0),t([i()],Ht.prototype,"rotationEnabled",void 0),Ht=Wt=t([s("esri.views.2d.constraints.RotationConstraint")],Ht);const Yt=Ht;var Qt;let Xt=Qt=class extends h{constructor(t){super(t),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let t,{lods:i,minScale:s,maxScale:e,minZoom:n,maxZoom:h}=this,r=-1,o=-1,a=!1,l=!1;if(0!==s&&0!==e&&s<e&&([s,e]=[e,s]),!i||!i.length)return this._set("effectiveMinScale",s),void this._set("effectiveMaxScale",e);i=i.map((t=>t.clone())),i.sort(((t,i)=>i.scale-t.scale)),i.forEach(((t,i)=>t.level=i));for(const n of i)!a&&s>0&&s>=n.scale&&(r=n.level,a=!0),!l&&e>0&&e>=n.scale&&(o=t?t.level:-1,l=!0),t=n;-1===n&&(n=0===s?0:r),-1===h&&(h=0===e?i.length-1:o),n=Math.max(n,0),n=Math.min(n,i.length-1),h=Math.max(h,0),h=Math.min(h,i.length-1),n>h&&([n,h]=[h,n]),s=i[n].scale,e=i[h].scale,i.splice(0,n),i.splice(h-n+1,i.length),i.forEach(((t,i)=>{this._lodByScale[t.scale]=t,this._scales[i]=t.scale})),this._set("effectiveLODs",i),this._set("effectiveMinZoom",n),this._set("effectiveMaxZoom",h),this._set("effectiveMinScale",s),this._set("effectiveMaxScale",e)}constrain(t,i){if(i&&t.scale===i.scale)return t;const s=this.effectiveMinScale,e=this.effectiveMaxScale,n=t.targetGeometry,h=i&&i.targetGeometry,r=0!==s&&t.scale>s;if(0!==e&&t.scale<e||r){const o=r?s:e;if(h){const s=(o-i.scale)/(t.scale-i.scale);n.x=h.x+(n.x-h.x)*s,n.y=h.y+(n.y-h.y)*s}t.scale=o}return this.snapToZoom&&this.effectiveLODs&&(t.scale=this._getClosestScale(t.scale)),t}fit(t){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(t,null);const i=this.scaleToZoom(t.scale),s=Math.abs(i-Math.floor(i));return t.scale=this.zoomToScale(s>.99?Math.round(i):Math.floor(i)),t}zoomToScale(t){if(!this.effectiveLODs)return 0;t-=this.effectiveMinZoom,t=Math.max(0,t);const i=this._scales;if(t<=0)return i[0];if(t>=i.length)return i[i.length-1];const s=Math.round(t-.5),e=Math.round(t);return i[e]+(e-t)*(i[s]-i[e])}scaleToZoom(t){if(!this.effectiveLODs)return-1;const i=this._scales;let s,e;if(t>=i[0])return this.effectiveMinZoom;if(t<=i[i.length-1])return this.effectiveMaxZoom;for(let n=0;n<i.length-1;n++){if(s=i[n],e=i[n+1],e===t)return n+this.effectiveMinZoom+1;if(s>t&&e<t)return n+this.effectiveMinZoom+1-(t-e)/(s-e)}}snapToClosestScale(t){if(!this.effectiveLODs)return t;const i=this.scaleToZoom(t);return this.zoomToScale(Math.round(i))}snapToNextScale(t,i=.5){if(!this.effectiveLODs)return t*i;const s=Math.round(this.scaleToZoom(t));return this.zoomToScale(s+1)}snapToPreviousScale(t,i=2){if(!this.effectiveLODs)return t*i;const s=Math.round(this.scaleToZoom(t));return this.zoomToScale(s-1)}clone(){return new Qt({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(t){return this._lodByScale[t]||(t=this._scales.reduce(((i,s)=>Math.abs(s-t)<=Math.abs(i-t)?s:i),this._scales[0])),this._lodByScale[t].scale}};t([i({readOnly:!0})],Xt.prototype,"effectiveLODs",void 0),t([i({readOnly:!0})],Xt.prototype,"effectiveMinZoom",void 0),t([i({readOnly:!0})],Xt.prototype,"effectiveMaxZoom",void 0),t([i({readOnly:!0})],Xt.prototype,"effectiveMinScale",void 0),t([i({readOnly:!0})],Xt.prototype,"effectiveMaxScale",void 0),t([i({type:[yt]})],Xt.prototype,"lods",void 0),t([i()],Xt.prototype,"minZoom",void 0),t([i()],Xt.prototype,"maxZoom",void 0),t([i()],Xt.prototype,"minScale",void 0),t([i()],Xt.prototype,"maxScale",void 0),t([i()],Xt.prototype,"snapToZoom",void 0),Xt=Qt=t([s("esri.views.2d.constraints.ZoomConstraint")],Xt);const ti=Xt,ii={base:null,key:"type",typeMap:{extent:f,polygon:ft}};let si=class extends v.EventedAccessor{constructor(){super(...arguments),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0}initialize(){this.watch(["_zoom","_rotation"],this.emit.bind(this,"update"),!0)}destroy(){this.view=null,this._set("_zoom",null),this._set("_rotation",null)}set geometry(t){this._set("geometry",t||null)}get _defaultLODs(){const t=this.get("view.defaultsFromMap.tileInfo"),i=this.get("view.spatialReference");return t&&i&&t.spatialReference.equals(i)?t.lods:null}get _geometry(){return new Jt({geometry:this.geometry,spatialReference:this.view.spatialReference})}get _rotation(){return new Yt({rotationEnabled:this.rotationEnabled})}get _zoom(){return new ti({lods:this.lods||this._defaultLODs,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale,snapToZoom:this.snapToZoom})}canZoomInTo(t){const i=this.effectiveMaxScale;return 0===i||t>=i}canZoomOutTo(t){const i=this.effectiveMinScale;return 0===i||t<=i}constrain(t,i){return this._zoom.constrain(t,i),this._rotation.constrain(t,i),this._geometry.constrain(t,i),t}constrainByGeometry(t){return this._geometry.constrain(t)}fit(t){return this._zoom.fit(t)}zoomToScale(t){return this._zoom.zoomToScale(t)}scaleToZoom(t){return this._zoom.scaleToZoom(t)}snapScale(t){return this._zoom.snapToClosestScale(t)}snapToNextScale(t){return this._zoom.snapToNextScale(t)}snapToPreviousScale(t){return this._zoom.snapToPreviousScale(t)}};t([i({readOnly:!0,aliasOf:"_zoom.effectiveLODs"})],si.prototype,"effectiveLODs",void 0),t([i({readOnly:!0,aliasOf:"_zoom.effectiveMinScale"})],si.prototype,"effectiveMinScale",void 0),t([i({readOnly:!0,aliasOf:"_zoom.effectiveMaxScale"})],si.prototype,"effectiveMaxScale",void 0),t([i({readOnly:!0,aliasOf:"_zoom.effectiveMinZoom"})],si.prototype,"effectiveMinZoom",void 0),t([i({readOnly:!0,aliasOf:"_zoom.effectiveMaxZoom"})],si.prototype,"effectiveMaxZoom",void 0),t([i({types:ii,value:null})],si.prototype,"geometry",null),t([i({type:[yt]})],si.prototype,"lods",void 0),t([i()],si.prototype,"minScale",void 0),t([i()],si.prototype,"maxScale",void 0),t([i()],si.prototype,"minZoom",void 0),t([i()],si.prototype,"maxZoom",void 0),t([i()],si.prototype,"rotationEnabled",void 0),t([i()],si.prototype,"snapToZoom",void 0),t([i()],si.prototype,"view",void 0),t([i()],si.prototype,"_defaultLODs",null),t([i({type:Jt})],si.prototype,"_geometry",null),t([i({type:Yt})],si.prototype,"_rotation",null),t([i({readOnly:!0,type:ti})],si.prototype,"_zoom",null),si=t([s("esri.views.2d.MapViewConstraints")],si);const ei=si;let ni=class extends h{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}};t([i()],ni.prototype,"left",void 0),t([i()],ni.prototype,"top",void 0),t([i()],ni.prototype,"right",void 0),t([i()],ni.prototype,"bottom",void 0),ni=t([s("esri.views.2d.PaddedViewState.Padding")],ni);let hi=class extends N{constructor(...t){super(...t),this.paddedViewState=new N,this._updateContent=(()=>{const t=kt();return()=>{const i=this._get("size"),s=this._get("padding");if(!i||!s)return;const e=this.paddedViewState;Vt(t,s.left+s.right,s.top+s.bottom),zt(t,i,t),jt(e.size,t);const n=e.viewpoint;n&&(this.viewpoint=n)}})(),this.watch(["size","padding"],this._updateContent,!0),this.padding=new ni,this.size=[0,0]}set padding(t){this._set("padding",t||new ni)}set viewpoint(t){if(t){const i=t.clone();this.paddedViewState.viewpoint=t,E(i,t,this._get("size"),this._get("padding"));const s=this._viewpoint2D,e=i.targetGeometry;s.center[0]=e.x,s.center[1]=e.y,s.rotation=i.rotation,s.scale=i.scale,s.spatialReference=e.spatialReference,this._update()}}};t([i()],hi.prototype,"paddedViewState",void 0),t([i({type:ni})],hi.prototype,"padding",null),t([i()],hi.prototype,"viewpoint",null),hi=t([s("esri.views.2d.PaddedViewState")],hi);const ri=hi;class oi{constructor(){this._names=new Map}begin(t){this._names.has(t)||(this._names.set(t,!1),(t=>-1!==t.indexOf("Brush"))(t)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${t}.Start`))}end(t){this._names.has(t)&&!this._names.get(t)&&(this._names.set(t,!0),performance.mark(`Esri.${t}.End`))}record(t){this._names.has(t)||(this._names.set(t,!0),performance.mark(`Esri.${t}`))}}const ai=c.getLogger("esri.views.MapView");let li=class extends(Z(I)){constructor(t){super(t),this._stationaryTimer=null,this.frameTask=new $t(this),this.featuresTilingScheme=null,this.fullOpacity=1,this.graphicsView=null,this.initialExtent=null,this.labelManager=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.resizeAlign="center",this.supportsGround=!1,this.timeline=new oi,this.type="2d",this.constraints=new ei,this.padding={top:0,right:0,bottom:0,left:0};const i=this.handles,s=()=>this.notifyChange("updating");i.add([this.watch("viewpoint",(()=>{this._lastStationaryEventTimestamp=performance.now(),this._flipStationary(160)}),!0),this.on("resize",(t=>this._resizeHandler(t))),this.watch("animationManager.animation",(t=>{this.animation=t})),this.allLayerViews.on("change",(()=>{s(),i.remove("map-view-base-layerViewsUpdating"),i.add(this.allLayerViews.map((t=>t.watch("updating",s))),"map-view-base-layerViewsUpdating")}))],"map-view-base")}destroy(){this.destroyed||(this._set("preconditionsReady",!1),this._gotoTask=this.frameTask=null)}set animation(t){const i=this._get("animation");if(t===i)return;if(i&&i.stop(),!t||t.isFulfilled())return void this._set("animation",null);this._set("animation",t),this.frameTask.animationInProgress=!0;const s=()=>{t===this._get("animation")&&(this._set("animation",null),this.frameTask.requestFrame()),this.frameTask.animationInProgress=!1};t.when(s,s)}get center(){if(!this.ready)return this._get("center");const{center:t,spatialReference:i}=this.state.paddedViewState;return new r({x:t[0],y:t[1],spatialReference:i})}set center(t){if(null==t)return;if(!this._normalizeInput(t))return void ai.error("#center",`incompatible spatialReference ${JSON.stringify(t.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`);if(!this.ready)return this._set("center",t),void this.notifyChange("initialExtentRequired");const i=this.viewpoint;C(i,i,t),this.viewpoint=i}set constraints(t){const i=this._get("constraints");i&&(this.handles.remove("map-view-base-constraints"),i.destroy()),this._set("constraints",t),t&&(t.view=this,this.ready&&(this.state.viewpoint=t.fit(this.state.paddedViewState.viewpoint)),this.handles.add(t.on("update",(()=>{this.ready&&this.state&&(this.state.viewpoint=t.fit(this.state.paddedViewState.viewpoint))})),"map-view-base-constraints"))}get extent(){return this.ready?this.state.paddedViewState.extent.clone():this._get("extent")}set extent(t){if(null==t)return;const i=this._normalizeInput(t);if(!i)return void ai.error("#center",`incompatible spatialReference ${JSON.stringify(t.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`);if(!i.width||!i.height)return void ai.error("#extent","invalid extent size");if(!this.ready)return this._set("extent",i),this._set("center",null),this._set("viewpoint",null),this._set("scale",0),this._set("zoom",-1),void this.notifyChange("initialExtentRequired");const s=this.viewpoint;L(s,s,i,this.size,{constraints:this.constraints}),this.viewpoint=s}get graphicsTileStore(){return new Rt(this.featuresTilingScheme)}get initialExtentRequired(){const{extent:t,center:i,scale:s,viewpoint:e,zoom:n}=this;return!(this.get("map.initialViewProperties.viewpoint")||t||i&&(0!==s||-1!==n)||e)}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(t){this.ready?(this.state.padding=t,this._set("padding",this.state.padding)):this._set("padding",t)}get resolution(){return this.state?this.state.resolution:0}get rotation(){return this.ready?this.state.rotation:this._get("rotation")}set rotation(t){if(isNaN(t))return;if(!this.ready)return void this._set("rotation",t);const i=this.viewpoint;G(i,i,t),this.viewpoint=i}get scale(){return this.ready?this.state.scale:this._get("scale")}set scale(t){if(!t||isNaN(t))return;if(!this.ready){this._set("scale",t),this._set("zoom",-1);const i=this._get("extent");return i&&(this._set("extent",null),this._set("center",i.center)),void this.notifyChange("initialExtentRequired")}const i=this.viewpoint;q(i,i,t),this.viewpoint=i}get stationary(){return!(this.animation||this.navigating||this._get("resizing")||this._stationaryTimer)}get updating(){return!this.destroyed&&(!0===this.get("layerViewManager.updating")||!0===this.get("labelManager.updating")||!0===this.get("graphicsView.updating")||this.allLayerViews.some((t=>!t.destroyed&&!("layerViews"in t)&&!0===t.updating)))}get viewpoint(){if(!this.ready)return this._get("viewpoint");const t=this.state.paddedViewState;return t&&t.viewpoint.clone()}set viewpoint(t){if(null==t)return;const i=this._normalizeInput(t);if(!i)return void(!t.scale||isNaN(t.scale)?ai.error("#viewpoint",`invalid scale value of ${t.scale}`):u(t.targetGeometry)?ai.error("#viewpoint","geometry not defined"):ai.error("#viewpoint",`incompatible spatialReference ${JSON.stringify(t.targetGeometry.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`));if(!this.ready)return this._set("viewpoint",i),this._set("extent",null),this._set("center",null),this._set("zoom",-1),this._set("scale",0),void this.notifyChange("initialExtentRequired");const s=new vt({targetGeometry:new r,scale:0,rotation:0});D(s,i),this.constraints.constrain(s,this.state.paddedViewState.viewpoint),this.state.viewpoint=s,this.frameTask.requestFrame(),this._set("viewpoint",s)}get zoom(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")}set zoom(t){if(null==t)return;if(!this.ready){this.notifyChange("initialExtentRequired"),this._set("zoom",t),this._set("scale",0);const i=this._get("extent");i&&(this._set("extent",null),this._set("center",i.center))}if(!this.constraints.effectiveLODs)return;const i=this.viewpoint;q(i,i,this.constraints.zoomToScale(t)),this.viewpoint=i,this._set("zoom",this.constraints.scaleToZoom(this.scale))}goTo(t,i){if(t)return this.animation&&(this.animation=null),this._createAnimation(),g(this,"ready",i&&i.signal).then((()=>{const s={animate:!0,...i},e=$(t,this);return this.animation.update(e),this._gotoTask={},s.animate?this._gotoAnimated(e,s):this._gotoImmediate(e,s)}));ai.error("#goTo()","target cannot be null or undefined")}hitTest(t){return Promise.reject("Should be implemented by subclasses")}popupHitTest(t){return this.hitTest(t).then((i=>({...i,mapPoint:this.toMap(t)})))}toMap(t){if(!this.ready)return null;const[i,s]=this.state.toMap([0,0],[t.x,t.y]);return new r({x:i,y:s,spatialReference:this.spatialReference})}isTileInfoRequired(){return!0}toScreen(t){if(!this.ready)return null;const i=this._normalizeInput(t),s=[i.x,i.y];return this.state.toScreen(s,s),gt(s[0],s[1])}pixelSizeAt(){return this.ready?this.state.resolution:(ai.error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}getDefaultSpatialReference(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||null}isSpatialReferenceSupported(t,i){return!(!i&&!this._get("ready"))||null!==this._getDefaultViewpoint()}importLayerView(t){return(t=>{const i=Kt[t.type];if(!a(i))throw function(t){const i=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",s=i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new l(`${s}:view-not-supported`,`${i} is not supported in 2D`)}(t);return i(t)})(t)}hasLayerViewModule(t){return(t=>a(Kt[t.type]))(t)}_createAnimation(){return this.animation&&!this.animation.done||(this.animation=new P),this.animation}_cancellableGoTo(t,i,s){const e=()=>t===this._gotoTask,n=s.then((()=>{e()&&(this.animation=null)})).catch((t=>{throw e()&&(this.animation=null,i.done||(i.stop(),this.frameTask.animationInProgress=!1)),t})),h=new Promise((t=>t(n)));return i.when().catch((()=>{e()&&h.cancel&&h.cancel()})),h}_gotoImmediate(t,i){const s=this._gotoTask,e=this.animation,n=t.then((t=>{if(y(i),s!==this._gotoTask)throw new l("view:goto-interrupted","Goto was interrupted");this.viewpoint=e.target=t,e.finish()}));return this._cancellableGoTo(s,e,n)}_gotoAnimated(t,i){const s=this._gotoTask,e=this.animation,n=t.then((t=>{if(y(i),s!==this._gotoTask)throw new l("view:goto-interrupted","Goto was interrupted");return e.update(t),this.animationManager.animate(e,this.viewpoint,i),e.when().then((()=>{}),(()=>{}))}));return this._cancellableGoTo(s,e,n)}_resizeHandler(t){const i=this.state;if(!i)return;let s=this.state.paddedViewState.viewpoint;const e=this.state.paddedViewState.size.concat();i.size=[t.width,t.height],A(s,s,e,this.state.paddedViewState.size,this.resizeAlign),s=this.constraints.constrain(s,null),this.state.viewpoint=s}_startup(){const t=this._getDefaultViewpoint();this.constraints.view=this,this.constraints.fit(t),this._set("animationManager",new qt({view:this})),this._set("state",new ri({padding:this._get("padding"),size:this.size,viewpoint:t})),this._set("featuresTilingScheme",new Tt(bt.create({spatialReference:this.spatialReference,size:512,numLODs:36}))),this._set("ready",!0),this.frameTask&&this.frameTask.start()}_teardown(){this.frameTask&&this.frameTask.stop(),this._set("ready",!1),this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null);const{center:[t,i],spatialReference:s,rotation:e,scale:n}=this.state.paddedViewState,h=new r({x:t,y:i,spatialReference:s});this._set("viewpoint",null),this._set("extent",null),this._set("center",h),this._set("zoom",-1),this._set("rotation",e),this._set("scale",n),this._set("spatialReference",s),this.constraints.view=null,this.animationManager.destroy(),this._set("animationManager",null),this._set("state",null),this.animation=null}_flipStationary(t){return null!==this._stationaryTimer||(this._stationaryTimer=setTimeout((()=>{this._stationaryTimer=null;const t=performance.now()-this._lastStationaryEventTimestamp;t<160&&(this._stationaryTimer=this._flipStationary(t))}),t)),this._stationaryTimer}_normalizeInput(t,i=this.spatialReference){const s=t&&t.targetGeometry||t;return i?s?i.equals(s.spatialReference)?t:d(s,i)?function(t){return t&&"esri.Viewpoint"===t.declaredClass}(t)?(t.targetGeometry=p(s,i),t):p(s,i):null:null:t}_getDefaultViewpoint(){const t=this.constraints,i={zoom:this._get("zoom"),scale:this._get("scale"),center:this._normalizeInput(this._get("center")),extent:this._normalizeInput(this._get("extent")),rotation:this._get("rotation"),viewpoint:this._normalizeInput(this._get("viewpoint")),spatialReference:this._userSpatialReference};t.effectiveLODs?-1!==i.zoom&&(i.scale=t.zoomToScale(i.zoom)):i.zoom=-1;let s=null,e=null,n=0;const h=i.viewpoint&&i.viewpoint.rotation,r=i.viewpoint&&i.viewpoint.targetGeometry;a(r)&&("extent"===r.type?s=r:"point"===r.type&&(e=r,n=i.viewpoint.scale));const o=this._normalizeInput(this.get("map.initialViewProperties.viewpoint.targetGeometry.extent")),l=this._normalizeInput(this.initialExtent),c=i.extent||s||o||l,u=i.center||e||c&&c.center,d=this.get("map.initialViewProperties.viewpoint.scale"),p=i.scale||n||d||c&&U(c,this.size),m=this.get("map.initialViewProperties.viewpoint.rotation");return u&&p?new vt({targetGeometry:u,scale:p,rotation:i.rotation||h||m||0}):null}};t([i()],li.prototype,"_stationaryTimer",void 0),t([i()],li.prototype,"animation",null),t([i({readOnly:!0})],li.prototype,"animationManager",void 0),t([i({value:null,type:r,dependsOn:["state.id","ready"]})],li.prototype,"center",null),t([i({type:ei})],li.prototype,"constraints",null),t([i({value:null,type:f,dependsOn:["state.id","ready"]})],li.prototype,"extent",null),t([i({readOnly:!0})],li.prototype,"featuresTilingScheme",void 0),t([i()],li.prototype,"fullOpacity",void 0),t([i({readOnly:!0})],li.prototype,"graphicsTileStore",null),t([i()],li.prototype,"graphicsView",void 0),t([i({type:f})],li.prototype,"initialExtent",void 0),t([i({dependsOn:["map.initialViewProperties?.viewpoint"]})],li.prototype,"initialExtentRequired",null),t([i()],li.prototype,"labelManager",void 0),t([i({value:{top:0,right:0,bottom:0,left:0},cast:t=>({top:0,right:0,bottom:0,left:0,...t})})],li.prototype,"padding",null),t([i({type:Object})],li.prototype,"renderingOptions",void 0),t([i()],li.prototype,"resizeAlign",void 0),t([i({readOnly:!0,dependsOn:["state.id"]})],li.prototype,"resolution",null),t([i({value:0,type:Number,dependsOn:["state.id","ready"]})],li.prototype,"rotation",null),t([i({value:0,type:Number,dependsOn:["state.id","ready"]})],li.prototype,"scale",null),t([i({type:b,dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],li.prototype,"spatialReference",void 0),t([i({readOnly:!0})],li.prototype,"state",void 0),t([i({dependsOn:["animation","navigating","resizing","_stationaryTimer"]})],li.prototype,"stationary",null),t([i({readOnly:!0})],li.prototype,"supportsGround",void 0),t([i({type:oi,readOnly:!0})],li.prototype,"timeline",void 0),t([i({readOnly:!0})],li.prototype,"type",void 0),t([i({readOnly:!0,dependsOn:["layerViewManager.updating","labelManager.updating","graphicsView?.updating"]})],li.prototype,"updating",null),t([i({value:null,type:vt,dependsOn:["state.id","ready"]})],li.prototype,"viewpoint",null),t([i({value:-1,dependsOn:["state.id"]})],li.prototype,"zoom",null),li=t([s("esri.views.MapViewBase")],li);const ci=li;class ui extends lt{constructor(t,i){super(!0),this.view=t,this.registerIncoming("double-click",i,(t=>this._handleDoubleClick(t,i)))}_handleDoubleClick(t,i){K(t.data,"primary")&&(t.stopPropagation(),i?this.view.mapViewNavigation.zoomOut([t.data.x,t.data.y]):this.view.mapViewNavigation.zoomIn([t.data.x,t.data.y]))}}class di extends lt{constructor(t,i,s){super(!0),this.view=t,this.pointerType=i,this.registerIncoming("double-tap-drag",s,(t=>this._handleDoubleTapDrag(t)))}_handleDoubleTapDrag(t){const{data:i}=t,{pointerType:s}=i;if(s!==this.pointerType)return;t.stopPropagation();const{action:e,delta:n}=i,{view:h}=this,{mapViewNavigation:r}=h;switch(e){case"begin":{const{scale:t}=h;this._startScale=t,this._currentScale=t,this._previousDelta=n,r.begin();break}case"update":{if(this._previousDelta.y===n.y)return;this._previousDelta=n;const t=this._startScale*1.015**n.y;r.setViewpointImmediate(t/this._currentScale),this._currentScale=t;break}case"end":{const{constraints:t}=h,{effectiveLODs:i,snapToZoom:s}=t;if(!s||!i)return void r.end();const e=t.snapScale(this._currentScale),o=(n.y>0?Math.max(e,t.snapToPreviousScale(this._startScale)):Math.min(e,t.snapToNextScale(this._startScale)))/this._currentScale;r.zoom(o);break}}}}class pi extends lt{constructor(t,i,s){super(!0),this.view=t,this.pointerAction=i,this.registerIncoming("drag",s,(t=>this._handleDrag(t))),this.registerIncoming("pointer-down",(()=>this.stopMomentumNavigation()));const e=this.view.mapViewNavigation;this.dragEventSeparator=new B({start:(t,i)=>{e.pan.begin(this.view,i.data),i.stopPropagation()},update:(t,i)=>{e.pan.update(this.view,i.data),i.stopPropagation()},end:(t,i)=>{e.pan.end(this.view,i.data),i.stopPropagation()},condition:(t,i)=>1===t&&K(i.data,this.pointerAction)})}_handleDrag(t){const i=this.view.mapViewNavigation;i.pinch.zoomMomentum||i.pinch.rotateMomentum?this.stopMomentumNavigation():this.dragEventSeparator.handle(t)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}}class mi extends lt{constructor(t,i,s){super(!0),this.view=t,this.pointerAction=i;const e=this.view.mapViewNavigation;this.dragEventSeparator=new B({start:(t,i)=>{e.rotate.begin(this.view,i.data),i.stopPropagation()},update:(t,i)=>{e.rotate.update(this.view,i.data),i.stopPropagation()},end:(t,i)=>{e.rotate.end(),i.stopPropagation()},condition:(t,i)=>1===t&&K(i.data,this.pointerAction)}),this.registerIncoming("drag",s,(t=>this.dragEventSeparator.handle(t)))}}class wi extends lt{constructor(t){super(!0),this.view=t,this.frameTask=null,this.watchHandles=new M,this.currentDevice=null,this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.handle=this.registerIncoming("gamepad",(t=>this.handleEvent(t))),this.handle.pause()}onInstall(t){super.onInstall(t),this.watchHandles.add([x(this.view.navigation.gamepad,"enabled",(t=>{t?(this.handle.resume(),this.frameTask||(this.frameTask=o({update:t=>this.frameUpdate(t.deltaTime)}))):(this.handle.pause(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null))}))])}onUninstall(){this.watchHandles.removeAll(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null),super.onUninstall()}handleEvent(t){const i=this.view.navigation.gamepad.device;i&&t.data.device!==i||this.currentDevice&&this.currentDevice!==t.data.device||("end"===t.data.action?(this.currentDevice=null,F(this.transformation)):(this.currentDevice=t.data.device,J(t.data,this.view.navigation.gamepad,this.transformation)))}frameUpdate(t){const i=this.transformation;if(W(i))return;const s=this.view.viewpoint.clone(),e=vi*this.view.navigation.gamepad.velocityFactor*t;H(s,s,[i.translation[0]*e,-i.translation[1]*e]);const n=this.view.size;Y(s,s,1+i.translation[2]*gi*t,this.view.constraints.rotationEnabled?-i.heading*fi*t:0,[n[0]/2,n[1]],n);const h=this.view.constraints.constrain(s,this.view.viewpoint);this.view.viewpoint=h}}const fi=.06,vi=.7,gi=6e-4;class yi extends lt{constructor(t,i,s){super(!0),this.view=t,this.keys=i,this._pressed=!1,this._keyMap={[i.left]:"left",[i.right]:"right",[i.up]:"up",[i.down]:"down"},this.registerIncoming("key-down",s,(t=>this._handleKeyDown(t))),this.registerIncoming("key-up",s,(t=>this._handleKeyUp(t))),this.registerIncoming("blur",s,(()=>this._handleBlur()))}_handleKeyDown(t){t.data.repeat||this._handleKey(t,!0)}_handleKeyUp(t){this._handleKey(t,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(t,i){const s=this._keyMap[t.data.key];if(this._pressed=null!=s,this._pressed){if(i)switch(this.view.mapViewNavigation.begin(),s){case"left":this.view.mapViewNavigation.continousPanLeft();break;case"right":this.view.mapViewNavigation.continousPanRight();break;case"up":this.view.mapViewNavigation.continousPanUp();break;case"down":this.view.mapViewNavigation.continousPanDown()}else this._pressed=!1,this.view.mapViewNavigation.stop();t.stopPropagation()}}}class bi extends lt{constructor(t,i,s){super(!0),this.view=t,this.keys=i,this._pressed=!1,this._keyToDirection={[i.clockwiseOption1]:"clockwise",[i.clockwiseOption2]:"clockwise",[i.counterClockwiseOption1]:"counterClockwise",[i.counterClockwiseOption2]:"counterClockwise",[i.resetOption1]:"reset",[i.resetOption2]:"reset"},this.registerIncoming("key-down",s,(t=>this._handleKeyDown(t))),this.registerIncoming("key-up",s,(t=>this._handleKeyUp(t))),this.registerIncoming("blur",s,(()=>this._handleBlur()))}_handleKeyDown(t){t.data.repeat||this._handleKey(t,!0)}_handleKeyUp(t){this._handleKey(t,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(t,i){const s=t.modifiers;if(s.size>0&&!s.has("Shift")||!this.view.constraints.rotationEnabled)return;const e=this._keyToDirection[t.data.key];if(this._pressed=null!=e,this._pressed){if(i)switch(this.view.mapViewNavigation.begin(),e){case"clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();t.stopPropagation()}}}class Mi extends lt{constructor(t,i,s){super(!0),this.view=t,this.keys=i,this._keysToZoomAction={},this.registerIncoming("key-down",s,(t=>this._handleKeyDown(t))),i.zoomIn.forEach((t=>this._keysToZoomAction[t]=0)),i.zoomOut.forEach((t=>this._keysToZoomAction[t]=1))}_handleKeyDown(t){this._handleKey(t)}_handleKey(t){const i=t.modifiers;if(i.size>0&&!i.has("Shift"))return;const{key:s}=t.data;if(!(s in this._keysToZoomAction))return;const e=this._keysToZoomAction[s],{mapViewNavigation:n}=this.view;let h=null;switch(e){case 0:h=n.zoomIn();break;case 1:h=n.zoomOut();break;default:return}n.begin(),h.then((()=>n.end())),t.stopPropagation()}}class xi extends lt{constructor(t,i){super(!0),this.view=t,this._canZoom=!0,this.registerIncoming("mouse-wheel",i,(t=>this._handleMouseWheel(t)))}_handleMouseWheel(t){if(!this.view.navigation.mouseWheelZoomEnabled)return;if(t.preventDefault(),t.stopPropagation(),!this._canZoom)return;const i=this.view.mapViewNavigation,{x:s,y:e,deltaY:n}=t.data,h=i.zoom(1/.6**(1/60*n),[s,e]);h&&(this._canZoom=!1,h.catch((()=>{})).then((()=>{this._canZoom=!0,i.end()})))}}class Oi extends lt{constructor(t){super(!0),this.view=t,this.registerIncoming("drag",(t=>this._handleDrag(t))),this.registerIncoming("pointer-down",(()=>this.stopMomentumNavigation()));const i=this.view.mapViewNavigation;this.dragEventSeparator=new B({start:(t,s)=>{i.pinch.begin(this.view,s.data),s.stopPropagation()},update:(t,s)=>{i.pinch.update(this.view,s.data),s.stopPropagation()},end:(t,s)=>{i.pinch.end(this.view),s.stopPropagation()},condition:t=>t>=2})}_handleDrag(t){this.dragEventSeparator.handle(t)}stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}}class Si extends lt{constructor(t=Q.maximumDoubleClickDelay,i=Q.maximumDoubleClickDistance,s=Q.maximumDoubleTouchDelay,e=Q.maximumDoubleTouchDistance,n=O){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=s,this.maximumDoubleTouchDistance=e,this._clock=n,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=gt(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new B({start:(t,i)=>this._dragStart(t,i),update:(t,i)=>this._dragUpdate(i),end:(t,i)=>this._dragEnd(i)}),this.registerIncoming("drag",(t=>this._dragEventSeparator.handle(t))),this.registerIncoming("pointer-down",(t=>this._handlePointerDown(t))),this.registerIncoming("pointer-up",(()=>this._handlePointerUp()))}onUninstall(){this._pointerState.forEach((t=>{null!=t.doubleTapTimeout&&(t.doubleTapTimeout.remove(),t.doubleTapTimeout=null)}))}get hasPendingInputs(){return S(this._pointerState,(t=>null!=t.doubleTapTimeout))}_clearPointerDown(t){const i=this._pointerState.get(t);i&&(i.doubleTapTimeout.remove(),i.doubleTapTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs())}_createDoubleTapDragData(t,i,s){const{button:e,buttons:n,pointer:h,pointers:r,pointerType:o,timestamp:a}=s;return{action:t,delta:i,button:e,buttons:n,pointer:h,pointers:r,pointerType:o,timestamp:a}}_dragStart(t,i){if(!this._doubleTapDragReady||1!==t)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:s,modifiers:e}=i,{center:n}=s;this._dragStartCenter=n;const h=this._createDoubleTapDragData("begin",gt(0,0),s);this._doubleTapDrag.emit(h,void 0,e),i.stopPropagation()}_dragUpdate(t){if(!this._doubleTapDragActive)return;const{data:i,modifiers:s}=t,{center:e}=i,n=gt(e.x-this._dragStartCenter.x,e.y-this._dragStartCenter.y),h=this._createDoubleTapDragData("update",n,i);this._doubleTapDrag.emit(h,void 0,s),t.stopPropagation()}_dragEnd(t){if(!this._doubleTapDragActive)return;const{data:i,modifiers:s}=t,{center:e}=i,n=gt(e.x-this._dragStartCenter.x,e.y-this._dragStartCenter.y),h=this._createDoubleTapDragData("end",n,i);this._doubleTapDrag.emit(h,void 0,s),this._doubleTapDragActive=!1,t.stopPropagation()}_handlePointerDown(t){const{data:i}=t,s=this._pointerId(i),e=this._pointerState.get(s),{pointerType:n}=i.native;if(e){const h="touch"===n?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;this._clearPointerDown(s),X(e.event.data,i)>h?this._storePointerDown(t):this._doubleTapDragReady=!0}else this._storePointerDown(t)}_handlePointerUp(){this._doubleTapDragReady=!1}_pointerId(t){const{native:i}=t,{pointerId:s,button:e,pointerType:n}=i;return"mouse"===n?`${s}:${e}`:`${n}`}_storePointerDown(t){const{data:i}=t,{pointerType:s}=i.native,e=this._pointerId(i),n=this._clock.setTimeout((()=>this._clearPointerDown(e)),"touch"===s?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay);this._pointerState.set(e,{event:t,doubleTapTimeout:n}),this.refreshHasPendingInputs()}}const _i={left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},Vi={zoomIn:["=","+"],zoomOut:["-","_"]},zi={clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"};let ji=class extends h{constructor(){super(...arguments),this._handles=new M}initialize(){this._handles.add([_(this.view,"ready",(()=>this._disconnect())),V(this.view,"ready",(()=>this._connect()))])}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this._disconnect()}_disconnect(){this._inputManager&&(this.view.viewEvents.disconnect(),this._inputManager.destroy(),this._inputManager=null,this._source.destroy(),this._source=null)}_connect(){const t=new tt(this.view.surface,this.view.input),i=[new it,new st,new et,new nt(this.view.navigation),new Si],s=new ct({eventSource:t,recognizers:i});s.installHandlers("prevent-context-menu",[new ht],ut.INTERNAL),s.installHandlers("navigation",[new Oi(this.view),new wi(this.view),new xi(this.view),new ui(this.view),new ui(this.view,["Ctrl"]),new pi(this.view,"primary"),new yi(this.view,_i),new Mi(this.view,Vi),new bi(this.view,zi),new mi(this.view,"secondary"),new di(this.view,"touch")],ut.INTERNAL),this.view.viewEvents.connect(s),this._source=t,this._inputManager=s,x(this.view.navigation,"browserTouchPanEnabled",(t=>{this._source.browserTouchPanningEnabled=!t}))}get test(){return{inputManager:this._inputManager}}};t([i()],ji.prototype,"view",void 0),ji=t([s("esri.views.2d.input.MapViewInputManager")],ji);const ki=ji;let Ri=0,Ti=class extends h{constructor(){super(...arguments),this.color=new Dt([0,255,255]),this.haloOpacity=1,this.fillOpacity=.25}get version(){return Ri++}};t([i({readOnly:!0})],Ti.prototype,"version",null),t([i({type:Dt})],Ti.prototype,"color",void 0),t([i({type:Dt})],Ti.prototype,"haloColor",void 0),t([i()],Ti.prototype,"haloOpacity",void 0),t([i()],Ti.prototype,"fillOpacity",void 0),Ti=t([s("esri.views.2d.support.HighlightOptions")],Ti);const Di=Ti;let Pi=class extends rt{constructor(t){super(t),this.components=["attribution","zoom"]}};t([i()],Pi.prototype,"components",void 0),Pi=t([s("esri.views.ui.2d.DefaultUI2D")],Pi);const Ni=Pi,Ei=c.getLogger("esri.views.MapView");let Zi,Ci,Li,Gi,qi,$i;function Ai(t,i,s){if(t)if(Array.isArray(t)||z.isCollection(t)){if(0===t.length)return;t.forEach((t=>Ai(t,i,s)))}else!function(t){return t instanceof k}(t)?s.add(t):i.add(t)}let Ui=class extends(ot(dt(ci))){constructor(t){super(t),this._magnifierView=null,this._stage=null,this._resolveWhenReady=[],this.rootLayerViews=new R({getCollections:()=>{var t,i;return[null==(t=this.basemapView)?void 0:t.baseLayerViews,this.layerViews,null==(i=this.basemapView)?void 0:i.referenceLayerViews]},getChildrenFunction:()=>null}),this.floors=new z,this.graphicsView=null,this.highlightOptions=new Di,this.inputManager=new ki({view:this}),this.mapViewNavigation=null,this.supersampleScreenshotsEnabled=!1,this.ui=new Ni,this.rendering=!1,T()}destroy(){this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get background(){return this.get("map.initialViewProperties.background")||null}set background(t){void 0===t?this._clearOverride("background"):this._override("background",t)}get textureManager(){return this._stage.painter.textureManager}get navigating(){return!(!this.mapViewNavigation||!this.mapViewNavigation.interacting)}toMap(t){if(pt(t)){const i=mt(this,t);return super.toMap(i)}return super.toMap(t)}hitTest(t,i){const s=pt(t)?mt(this,t):t;if(!this.ready||isNaN(s.x)||isNaN(s.y))return Promise.resolve({screenPoint:s,results:[]});const e=this.toMap(s),n=[this.graphicsView];n.push.apply(n,this.allLayerViews.toArray().reverse());const h=new Set,r=new Set,o=new Set,a=new Set;return i&&(Ai(i&&i.include,h,o),Ai(i&&i.exclude,r,a)),Promise.all(n.map((t=>!t||!t.hitTest||o.size>0&&!t.layer||o.size>0&&t.layer&&!o.has(t.layer)||a.size>0&&t.layer&&a.has(t.layer)?null:t.hitTest(s.x,s.y)))).then((t=>({screenPoint:s,results:t.filter((t=>null!=t&&(!(h.size>0)||h.has(t))&&(!(r.size>0)||!r.has(t)))).map((t=>({mapPoint:e,graphic:t})))})))}takeScreenshot(t){if(t=t||{},!this.ready)return Promise.reject("Map view cannot be used before it is ready");const i=this.supersampleScreenshotsEnabled?Math.min(4,Pt(this.size,Math.min(4096,this._stage.context.parameters.maxTextureSize))):1;let s;t.layers?(s=[],t.layers.forEach((t=>{const i=this.allLayerViews.find((i=>i.layer.id===t.id));i&&"container"in i&&i.container&&s.push(i.container)}))):s=this._stage.children;const{format:e,quality:n}=Nt(t.format,t.quality),h=function(t,i,s,e,n,h,r,o){let a;t.ignorePadding&&(e={left:0,right:0,top:0,bottom:0}),null!=t.width&&null!=t.height?a=[t.width,t.height]:null==t.width&&null!=t.height?a=[t.height,t.height]:null!=t.width&&null==t.height?a=[t.width,t.width]:null==t.width&&null==t.height&&(a=null);const l=s[0]-(e.left+e.right),c=s[1]-(e.top+e.bottom);let u,d,p=t.area||{x:0,y:0,width:l,height:c};if(a){const t=a[0]/a[1];if(t>l/c){const i=p.width/t;p={x:p.x,y:Math.round(p.y+(p.height-i)/2),width:p.width,height:Math.round(i)}}else{const i=p.height*t;p={x:Math.round(p.x+(p.width-i)/2),y:p.y,width:Math.round(i),height:p.height}}}else a=[p.width,p.height];return a[0]>p.width?(u=Math.min(a[0]/p.width,i),d=a[0]/p.width/u):(u=1,d=a[0]/p.width),{resolutionScale:u,cropArea:{x:Math.round((p.x+e.left)*u),y:Math.round((p.y+e.top)*u),width:Math.round(p.width*u),height:Math.round(p.height*u)},outputScale:d,format:n,quality:h,children:r,rotation:o}}(t,i,this.size,this.padding,e,n,s,t.rotation);return this._stage.takeScreenshot(h)}on(t,i,s,e){return this.inputManager&&this.viewEvents.on(t,i,s,e)||super.on(t,i)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}whenLayerView(t){return super.whenLayerView(t)}graphicChanged(t){this.graphicsView&&this.graphicsView.graphicUpdateHandler(t)}whenReady(){return new Promise((t=>{this.ready?t(this):this._resolveWhenReady.push(t)}))}forceDOMReadyCycle(){this.forceReadyCycle()}validate(){let t=at({checkMajorWebPerformanceCaveat:!1});return j("safari")&&j("safari")<9&&(t=new l("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:j("safari")})),a(t)?(Ei.warn("#validate()",t.message),Promise.reject(t)):async function(){const[,{GraphicsView2D:t,GraphicContainer:i,LabelManager:s,MapViewNavigation:e,MagnifierView2D:n,Stage:h}]=await Promise.all([import("./p-02b51787.js"),import("./p-4dca50db.js")]);Ci=t,Li=i,Gi=s,qi=e,$i=n,Zi=h}()}_startup(){this.timeline.begin("MapView Startup"),super._startup(),this.graphics.owner=this;const t=new Zi(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenshotsEnabled,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline}),i=new Ci({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new Li(this.featuresTilingScheme)}),s=new qi({view:this,animationManager:this.animationManager}),e=new Gi({view:this});this._magnifierView=new $i,this._magnifierView.magnifier=this.magnifier,this._stage=t,this.frameTask.graphicsView=i,this._set("graphicsView",i),this._set("mapViewNavigation",s),this._set("labelManager",e),this.handles.add([this.rootLayerViews.on("change",(()=>this._updateStageChildren())),t.on("post-render",(()=>this._set("rendering",t.renderRequested))),t.on("will-render",(()=>this._set("rendering",t.renderRequested))),t.on("webgl-error",(t=>this.fatalError=t.error)),x(this,"stationary",(i=>t.stationary=i),!0),x(this,"state.id",(()=>t.state=this.state),!0),x(this,"background",(i=>{t.background=i,this._magnifierView.background=i}),!0),x(this,"magnifier",(t=>this._magnifierView.magnifier=t),!0),x(this,"renderingOptions",(i=>t.renderingOptions=i),!0),x(this,"highlightOptions",(()=>t.highlightOptions=this.highlightOptions),!0)],"map-view"),t.state=this.state,this._updateStageChildren();const n=this._resolveWhenReady;this._resolveWhenReady=[],n.forEach((t=>t(this))),this.timeline.end("MapView Startup")}_teardown(){this.handles.remove("map-view"),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._stage.destroy(),this.graphicsView.destroy(),this.mapViewNavigation.destroy(),this._stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,super._teardown()}_updateStageChildren(){this._stage.removeAllChildren(),this.rootLayerViews.forEach((t=>{this._stage.addChild(t.container)})),this._stage.addChild(this.graphicsView.container),this._stage.addChild(this._magnifierView)}};t([i({type:Ct})],Ui.prototype,"background",null),t([i()],Ui.prototype,"floors",void 0),t([i()],Ui.prototype,"graphicsView",void 0),t([i({type:Di})],Ui.prototype,"highlightOptions",void 0),t([i({readOnly:!0})],Ui.prototype,"inputManager",void 0),t([i({readOnly:!0})],Ui.prototype,"textureManager",null),t([i({readOnly:!0})],Ui.prototype,"mapViewNavigation",void 0),t([i({type:Boolean})],Ui.prototype,"navigating",null),t([i({type:Boolean,constructOnly:!0})],Ui.prototype,"supersampleScreenshotsEnabled",void 0),t([i({type:Ni})],Ui.prototype,"ui",void 0),t([i({readOnly:!0})],Ui.prototype,"rendering",void 0),t([i({constructOnly:!0})],Ui.prototype,"renderCanvas",void 0),t([i({constructOnly:!0})],Ui.prototype,"deactivatedWebGLExtensions",void 0),t([i({constructOnly:!0})],Ui.prototype,"debugWebGLExtensions",void 0),Ui=t([s("esri.views.MapView")],Ui);const Ii=Ui;export{Ii as G,oi as e,Ct as m}