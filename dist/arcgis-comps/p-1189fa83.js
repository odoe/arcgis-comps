import{s as e,x as n}from"./p-400ca3dc.js";import{c as t,ad as r,ah as u,bg as l,bh as a,a$ as i,S as s}from"./p-e58503d5.js";const o=t.getLogger("esri.support.basemapUtils");function c(){return{}}function f(e){for(const n in e){const t=e[n];!1===(null==t?void 0:t.destroyed)&&t.destroy(),delete e[n]}}function p(t,l){var a;let i;if("string"==typeof t){if(!(t in e)){const n=Object.entries(e).filter((([e,n])=>r.apiKey&&!n.classic||!r.apiKey&&n.classic&&!n.deprecated)).map((([e])=>`"${e}"`)).join(", ");return o.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${n}`),null}l&&(i=l[t]),i||(i=n.fromId(t),l&&(l[t]=i))}else i=u(n,t);return null!=(a=i)&&a.destroyed&&(o.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function b(e,t=null){const r=p(e);if(!r)return null;const u=new n({id:r.id,title:r.title,baseLayers:r.baseLayers.slice(),referenceLayers:r.referenceLayers.slice()});return t&&(u.baseLayers=d(u.baseLayers,t.baseLayers),u.referenceLayers=d(u.referenceLayers,t.referenceLayers)),u.load().catch((()=>{})),u.portalItem=r.portalItem,u}function m(n){let t=null;const r=L(n),u=!r.baseLayers.length;for(const n in e){const l=k(r,T(e[n]),{mustMatchReferences:u});if("equal"===l){t=n;break}"base-layers-equal"===l&&(t=n)}return t}function y(e,n){return e===n||"equal"===k(L(e),L(n),{mustMatchReferences:!0})}function d(e,n){const t=new s;return e.forEach((e=>{const r=n.find((n=>j(x(e),x(n))))||e;t.some((e=>e===r))?t.push(e):t.push(r)})),t}function q(e){return!(null==e||!e.baseLayers.concat(e.referenceLayers).some(v))}function v(e){if(h(e.url))return!0;if("vector-tile"===e.type)for(const n in e.sourceNameToSource){const t=e.sourceNameToSource[n];if(h(null==t?void 0:t.sourceUrl))return!0}return!1}const S=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function h(e){if(!e)return!1;const n=new l(a(e));return S.test(n.authority)}function L(e){return e?!e.loaded&&e.resourceInfo?T(e.resourceInfo.data):{baseLayers:w(e.baseLayers),referenceLayers:w(e.referenceLayers)}:null}function w(e){return(s.isCollection(e)?e.toArray():e).map(x)}function x(e){return{type:e.type,url:M("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible}}function T(e){return e?{baseLayers:$(e.baseMapLayers.filter((e=>!e.isReference))),referenceLayers:$(e.baseMapLayers.filter((e=>e.isReference)))}:null}function $(e){return e.map((e=>function(e){let n;switch(e.layerType){case"VectorTileLayer":n="vector-tile";break;case"ArcGISTiledMapServiceLayer":n="tile";break;default:n="unknown"}return{type:n,url:M(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:null!=e.minScale?e.minScale:0,maxScale:null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visibility||!!e.visibility}}(e)))}function k(e,n,t){return null!=e!=(null!=n)?"not-equal":e?g(e.baseLayers,n.baseLayers)?g(e.referenceLayers,n.referenceLayers)?"equal":t.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function g(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(!j(e[t],n[t]))return!1;return!0}function j(e,n){return e.type===n.type&&e.url===n.url&&e.minScale===n.minScale&&e.maxScale===n.maxScale&&e.visible===n.visible&&e.opacity===n.opacity}function M(e){return e?i(e).replace(/^\s*https?:/i,"").toLowerCase():""}export{v as S,y as b,q as d,f,m,b as p,c as u,p as y}