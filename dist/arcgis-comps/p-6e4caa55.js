import{C as t}from"./p-6c45ae96.js";import{E as e}from"./p-16def889.js";import{M as n}from"./p-ffe0d3ad.js";import{a as r,t as s}from"./p-d30fd87a.js";import{m as a,ae as i,U as o}from"./p-9ae46e68.js";import{j as l,ak as c}from"./p-566b0715.js";import{m,j as u,b as f,c as y,p}from"./p-b3024dec.js";const h={marker:e.MARKER,fill:e.FILL,line:e.LINE,text:e.TEXT};class d{constructor(t,e,r,s){const a={minScale:null==e?void 0:e.minScale,maxScale:null==e?void 0:e.maxScale},i=function(t){return t.minScale||t.maxScale?t.minScale+"-"+t.maxScale:""}(a);this.layers=t,this.data=e,this.hash=this._createHash()+i,this.rendererKey=r;for(const e of t)e.materialKey=n(h[e.type],this.rendererKey),e.maxVVSize=s,e.scaleInfo=a,e.templateHash+=i}get type(){return"expanded-cim"}_createHash(){let t="";for(const e of this.layers)t+=e.templateHash;return t}}async function b(t,e,n){if(!t.name)return Promise.reject(new a("style-symbol-reference-name-missing","Missing name in style symbol reference"));if(t.styleName&&"Esri2DPointSymbolsStyle"===t.styleName)return async function(t,e){const n=u.replace(/\{SymbolName\}/gi,t.name);try{const t=await f(n,e);return y(t.data)}catch(t){return i(t),null}}(t,n);try{return w(await m(t,e,n),t.name,e,n)}catch(t){return i(t),null}}async function w(t,e,n,m){const u=t.data,h={portal:n&&n.portal||l.getDefault(),url:o(t.baseUrl),origin:"portal-item"},d=u.items.find((t=>t.name===e));if(!d)throw new a("symbolstyleutils:symbol-name-not-found",`The symbol name '${e}' could not be found`,{symbolName:e});let b=c(p(d,"cimRef"),h);r()&&(b=s(b));try{const t=await f(b,m);return y(t.data)}catch(t){return i(t),null}}const j=async(e,n,r)=>new d(await t(e.data,n,r),e.data,e.rendererKey,e.maxVVSize),x=async(t,e,n,r)=>{if(!t)return null;if("cim"===t.type)return j(t,e,n);if("web-style"===t.type){const s={type:"cim",data:await b(t,null,r),rendererKey:t.rendererKey,maxVVSize:t.maxVVSize};return j(s,e,n)}return t};function S(t){if(!t)return null;const{type:e,cim:n,url:r,materialHash:s}=t,a={cim:n,type:e,mosaicHash:s,url:r,size:null,dashTemplate:null,path:null,text:null,fontName:null};switch(e){case"marker":a.size=t.size,a.path=t.path;break;case"line":a.dashTemplate=t.dashTemplate;break;case"text":a.text=t.text,a.fontName=t.fontName}return a}export{S as i,x as l}