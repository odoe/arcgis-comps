import{h as e}from"./p-e273719b.js";import{s as a}from"./p-e58503d5.js";import{u as t,e as l}from"./p-fb38a9d0.js";import{b as s,j as o,c as n}from"./p-2ae44317.js";import{f as r,h as m,t as p}from"./p-56a9f461.js";import"./p-74de0937.js";import"./p-2f398ed1.js";import"./p-d3105731.js";import"./p-53bb6ab4.js";import"./p-8bc9b36a.js";import"./p-a9a30646.js";import"./p-765e6c28.js";import"./p-b79fcce3.js";import"./p-7a658388.js";import"./p-f94762ac.js";import"./p-ea916a39.js";import"./p-8a919d07.js";import"./p-efbca0ca.js";import"./p-e654504b.js";import"./p-9f58a277.js";import"./p-b0565d49.js";import"./p-9e860e7b.js";import"./p-81049b2d.js";import"./p-d1d9dbe4.js";import"./p-1e473dab.js";const c="picture-fill",i=120,u=document.createElement("canvas");function d(e,a){const t=u.getContext("2d"),l=[];return a&&(a.weight&&l.push(a.weight),a.size&&l.push(a.size+"px"),a.family&&l.push(a.family)),t.font=l.join(" "),t.measureText(e).width}function f(e){if(0===e.length)return 0;if(e.length>2){const a=l(1),t=parseFloat(e);switch(e.slice(-2)){case"px":return t;case"pt":return t*a;case"in":return 72*t*a;case"pc":return 12*t*a;case"mm":return 2.8346456692913384*t*a;case"cm":return 28.346456692913385*t*a}}return parseFloat(e)}function h(l,u){var h,v;const b=null!=(null==u?void 0:u.size)?t(u.size):null,j=null!=(null==u?void 0:u.maxSize)?t(u.maxSize):null,y=null!=(null==u?void 0:u.opacity)?u.opacity:null,M=null!=(null==u?void 0:u.rotation)?u.rotation:"angle"in l?l.angle:null,k=s(l);let L=o(l);if(k&&!L){const a="type"in k?null:new e(k);"#ffffff"===(a?a.toHex():null)&&(L={color:"#bdc3c7",width:.75})}const w={shape:null,fill:null,stroke:L,offset:[0,0]};null!=(h=L)&&h.width&&(L.width=Math.min(L.width,80));const x=(null==(v=L)?void 0:v.width)||0;let g=null!=b&&(null==(null==u?void 0:u.scale)||(null==u?void 0:u.scale)),F=0,P=0,z=!1;switch(l.type){case"simple-marker":{const e=l.style,a=Math.min(null!=b?b:t(l.size),j||i);switch(F=a,P=a,e){case"circle":w.shape={type:"circle",cx:0,cy:0,r:.5*a},g||(F+=x,P+=x);break;case"cross":w.shape={type:"path",path:[{command:"M",values:[0,.5*P]},{command:"L",values:[F,.5*P]},{command:"M",values:[.5*F,0]},{command:"L",values:[.5*F,P]}]};break;case"diamond":w.shape={type:"path",path:[{command:"M",values:[0,.5*P]},{command:"L",values:[.5*F,0]},{command:"L",values:[F,.5*P]},{command:"L",values:[.5*F,P]},{command:"Z",values:[]}]},g||(F+=x,P+=x);break;case"square":w.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[F,0]},{command:"L",values:[F,P]},{command:"L",values:[0,P]},{command:"Z",values:[]}]},g||(F+=x,P+=x),M&&(z=!0);break;case"triangle":w.shape={type:"path",path:[{command:"M",values:[.5*F,0]},{command:"L",values:[F,P]},{command:"L",values:[0,P]},{command:"Z",values:[]}]},g||(F+=x,P+=x),M&&(z=!0);break;case"x":w.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[F,P]},{command:"M",values:[F,0]},{command:"L",values:[0,P]}]},M&&(z=!0);break;case"path":w.shape={type:"path",path:l.path||""},g||(F+=x,P+=x),M&&(z=!0),g=!0}break}case"simple-line":{const e=Math.min(null!=b?b:x,j||80),a=e>22?2*e:40;L.width=e,F=a,P=e,w.shape={type:"path",path:[{command:"M",values:[0,P]},{command:"L",values:[F,P]}]};break}case c:case"simple-fill":F=Math.min(null!=b?b:22,j||i)+x,P=F,g=!0,w.shape="object"==typeof(null==u?void 0:u.symbolConfig)&&null!=u&&u.symbolConfig.isSquareFill?p.squareFill[0]:p.fill[0];break;case"picture-marker":{let e=t(l.width),a=t(l.height);const s=null!=b?b:Math.max(e,a),o=e/a;e=o<=1?Math.ceil(s*o):s,a=o<=1?s:Math.ceil(s/o),F=Math.min(e,j||i),P=Math.min(a,j||i),w.shape={type:"image",x:-Math.round(F/2),y:-Math.round(P/2),width:F,height:P,src:l.url||""},M&&(z=!0);break}case"text":{const e=l,a=e.text||"Aa",s=e.font,o=Math.min(null!=b?b:t(s.size),j||i),n=d(a,{weight:s.weight,size:o,family:s.family}),r=/[\uE600-\uE6FF]/.test(a);F=r?o:n,P=o;let m=.25*f((s?o:0).toString());r&&(m+=5),w.shape={type:"text",text:a,x:0,y:m,align:"middle",decoration:s&&s.decoration,rotated:e.rotated,kerning:e.kerning},w.font=s&&{size:o,style:s.style,decoration:s.decoration,weight:s.weight,family:s.family};break}}if(!w.shape)return Promise.reject(new a("symbolPreview: renderPreviewHTML2D","symbol not supported."));const Z=k,D=l.color;let E=null;return Z&&"pattern"===Z.type&&D&&l.type!==c?E=n(Z.src,D.toCss(!0)).then((e=>(Z.src=e,w.fill=Z,w))):(w.fill=k,E=Promise.resolve(w)),E.then((e=>{const a=[[e]];if("object"==typeof(null==u?void 0:u.symbolConfig)&&null!=u&&u.symbolConfig.applyColorModulation){const t=.6*F;a.unshift([{...e,offset:[-t,0],fill:r(k,-.3)}]),a.push([{...e,offset:[t,0],fill:r(k,.3)}]),F+=2*t}return m(a,[F,P],{node:u&&u.node,scale:g,opacity:y,rotation:M,useRotationSize:z,effect:null==u?void 0:u.effect})}))}export{h as previewSymbol2D}