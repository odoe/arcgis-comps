import{e as t,i as e,a1 as i,c as s,as as n,S as r,s as o,h as a,D as h,T as l,d as u,a3 as c,aT as d,ah as p,r as f,p as v,af as m,f as w,u as y,a as g,bl as b,bm as x,a7 as k,A as _,bn as M,aR as T,$ as P,aN as I,b as O,ap as C,bo as V,bp as D,V as S,g as A,ai as N,aP as R,bq as L,aJ as E,ar as j,n as F,k as z,P as G,br as $,o as q,_ as B,a0 as W,aF as U,aq as Z,aU as H,bs as K,bt as J,aE as Y,bu as Q,bv as X,bw as tt,aI as et,K as it,aM as st,bx as nt,by as rt,bz as ot,bA as at,y as ht,bB as lt,W as ut,a8 as ct,aK as dt,j as pt,z as ft,l as vt,bd as mt}from"./p-e58503d5.js";import{x as wt}from"./p-400ca3dc.js";import{h as yt}from"./p-e273719b.js";import{n as gt,m as bt}from"./p-efbca0ca.js";import{o as xt}from"./p-b5b00e38.js";import{n as kt}from"./p-9b7a2176.js";import{r as _t}from"./p-a9a30646.js";import{r as Mt,c as Tt}from"./p-765e6c28.js";import{p as Pt}from"./p-e94b450b.js";import{u as It,f as Ot,y as Ct}from"./p-1189fa83.js";import{c as Vt,p as Dt}from"./p-37058f88.js";import{y as St}from"./p-7a5bfd29.js";import{d as At,l as Nt,a as Rt}from"./p-7731c620.js";import{c as Lt,a as Et}from"./p-7d081d01.js";import{v as jt}from"./p-afac6fb2.js";import{c as Ft}from"./p-fb38a9d0.js";import{f as zt,D as Gt}from"./p-ca295674.js";import{i as $t,u as qt,t as Bt,n as Wt,b as Ut}from"./p-612a2c14.js";import{m as Zt,e as Ht,d as Kt}from"./p-2f398ed1.js";import{g as Jt,l as Yt}from"./p-76f37e40.js";import"./p-b79fcce3.js";import{u as Qt}from"./p-eee9ef50.js";import{s as Xt,o as te}from"./p-d3105731.js";import{h as ee,e as ie,n as se,i as ne,c as re,M as oe,r as ae}from"./p-1e473dab.js";import{n as he}from"./p-d1d9dbe4.js";import{e as le}from"./p-d57f9971.js";import{s as ue,r as ce,M as de,h as pe,i as fe}from"./p-b9aa4901.js";import{r as ve,a as me,D as we,F as ye,l as ge,x as be,s as xe,o as ke,v as _e,A as Me,j as Te,b as Pe}from"./p-e6fe5d89.js";import{t as Ie}from"./p-56ed1c7a.js";import{n as Oe,t as Ce}from"./p-746a9d8f.js";import{H as Ve}from"./p-01e5a461.js";import{o as De}from"./p-db4d63dc.js";import{a as Se}from"./p-e654504b.js";import{t as Ae}from"./p-b8beb0d3.js";import{e as Ne}from"./p-b312c1fd.js";var Re;let Le=Re=class extends i{constructor(t){super(t),this.type="none"}clone(){return new Re({type:this.type})}};var Ee;t([_t({none:"none",stayAbove:"stay-above"})],Le.prototype,"type",void 0),Le=Re=t([e("esri.ground.NavigationConstraint")],Le);const je=s.getLogger("esri.Ground");let Fe=Ee=class extends(n(bt)){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new r;const e=t=>{t.parent&&t.parent!==this&&"remove"in t.parent&&t.parent.remove(t),t.parent=this,"elevation"!==t.type&&"base-elevation"!==t.type&&je.error(`Layer '${t.title}, id:${t.id}' of type '${t.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)};this.layers.on("after-add",(t=>e(t.item))),this.layers.on("after-remove",(t=>(t=>{t.parent=null})(t.item)))}initialize(){this.when().catch((t=>{je.error("#load()","Failed to load ground",t)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",gt(t,this._get("layers")))}writeLayers(t,e,i,s){const n=[];t?(s={...s,layerContainerType:"ground"},t.forEach((t=>{if("write"in t){const e={};xt(t)().write(e,s)&&n.push(e)}else s&&s.messages&&s.messages.push(new o("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted in the ground`,{layer:t}))})),e.layers=n):e.layers=n}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return kt(this,(t=>{t(this.layers)}))}async queryElevation(t,e){await this.load({signal:null==e?void 0:e.signal});const{ElevationQuery:i}=await import("./p-4c8c8560.js");a(e);const s=new i,n=this.layers.filter(ze).toArray();return s.queryAll(n,t,e)}async createElevationSampler(t,e){await this.load({signal:null==e?void 0:e.signal});const{ElevationQuery:i}=await import("./p-4c8c8560.js");a(e);const s=new i,n=this.layers.filter(ze).toArray();return s.createSamplerAll(n,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:h(this.surfaceColor),navigationConstraint:h(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new Ee({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve(null)}_loadLayersFromJSON(t,e,i){const s=e&&e.origin||"web-scene",n=e&&e.portal||null,r=e&&e.url||null;return import("./p-c39ae740.js").then((({populateOperationalLayers:e})=>{a(i);const o=[];return t.layers&&Array.isArray(t.layers)&&o.push(e(this.layers,t.layers,{context:{origin:s,url:r,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"})),l(o)})).then((()=>{}))}};function ze(t){return"elevation"===t.type||function(t){return t&&"createElevationSampler"in t}(t)}t([u({json:{read:!1}})],Fe.prototype,"layers",null),t([c("layers")],Fe.prototype,"writeLayers",null),t([u({readOnly:!0})],Fe.prototype,"resourceInfo",void 0),t([u({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:d,read:{reader:Mt,source:"transparency"},write:{writer:(t,e)=>{e.transparency=Tt(t)},target:"transparency"}}})],Fe.prototype,"opacity",void 0),t([u({type:yt,json:{type:[d],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],Fe.prototype,"surfaceColor",void 0),t([u({type:Le,json:{write:!0}})],Fe.prototype,"navigationConstraint",void 0),Fe=Ee=t([e("esri.Ground")],Fe);const Ge=Fe;function $e(t){var e;return!(!(t&&t.loaded&&"capabilities"in t&&null!=t&&null!=(e=t.capabilities)&&e.operations&&"supportsEditing"in t.capabilities.operations&&!0===t.capabilities.operations.supportsEditing)||"editingEnabled"in t&&!t.editingEnabled)}const qe=s.getLogger("esri.support.groundUtils"),Be={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};let We=class extends(Vt(Dt(f.EventedMixin(v)))){constructor(t){super(t),this.allLayers=new Pt({getCollections:()=>{var t,e,i;return[null==(t=this.basemap)?void 0:t.baseLayers,null==(e=this.ground)?void 0:e.layers,this.layers,null==(i=this.basemap)?void 0:i.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=new Pt({getCollections:()=>[this.tables,this.layers],getChildrenFunction:t=>{const e=[];return"tables"in t&&e.push(t.tables),"layers"in t&&e.push(t.layers),e},itemFilterFunction:t=>{const e=t.parent;return e&&"tables"in e&&e.tables.includes(t)}}),this.basemap=null,this.editableLayers=new Pt({getCollections:()=>[this.allLayers],itemFilterFunction:$e}),this.ground=new Ge,this._basemapCache=It()}destroy(){var t,e;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),null==(t=this.ground)||t.destroy(),null==(e=this.basemap)||e.destroy(),Ot(this._basemapCache),this._basemapCache=null}castBasemap(t){return Ct(t,this._basemapCache)}castGround(t){const e=function(t){let e=null;return"string"==typeof t?t in Be?e=new Ge({resourceInfo:{data:{layers:[Be[t]]}}}):qe.warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`):e=p(Ge,t),e}(t);return m(e)?this._get("ground"):e}findLayerById(t){return this.allLayers.find((e=>e.id===t))}findTableById(t){return this.allTables.find((e=>e.id===t))}};t([u({readOnly:!0,dependsOn:[]})],We.prototype,"allLayers",void 0),t([u({readOnly:!0})],We.prototype,"allTables",void 0),t([u({type:wt})],We.prototype,"basemap",void 0),t([w("basemap")],We.prototype,"castBasemap",null),t([u({readOnly:!0})],We.prototype,"editableLayers",void 0),t([u({type:Ge,nonNullable:!0})],We.prototype,"ground",void 0),t([w("ground")],We.prototype,"castGround",null),We=t([e("esri.Map")],We);const Ue=We,Ze={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,s=this.values;return e<=i.xsmall?s.xsmall:e<=i.small?s.small:e<=i.medium?s.medium:e<=i.large?s.large:s.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,s=this.values;return e<=i.xsmall?s.xsmall:e<=i.small?s.small:e<=i.medium?s.medium:e<=i.large?s.large:s.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=this.values;return e[1]>=e[0]?i.portrait:i.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},He={xsmall:544,small:768,medium:992,large:1200};function Ke(t,e){return e?Ze[t].valueToClassName[e].split(" "):[]}const Je=i=>{let s=class extends i{constructor(...t){super(...t),this._breakpointsHandles=new y,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=He}initialize(){this._breakpointsHandles.add(g(this,["breakpoints","size"],this._updateClassNames))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)}set breakpoints(t){if(t===this._get("breakpoints"))return;const e=function(t){return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}(t);if(!e){const t=JSON.stringify(He,null,2);console.warn("provided breakpoints are not valid, using defaults:"+t)}t=e?t:He,this._set("breakpoints",{...t})}_updateClassNames(){if(!this.container)return;const t=b.acquire(),e=b.acquire();let i,s=!1;for(i in Ze){const n=this[i],r=Ze[i].getValue({viewSize:this.size,breakpoints:this.breakpoints});n!==r&&(s=!0,this[i]=r,Ke(i,n).forEach((t=>e.push(t))),Ke(i,r).forEach((e=>t.push(e))))}s&&(this._applyClassNameChanges(t,e),b.release(t),b.release(e))}_applyClassNameChanges(t,e){const i=this.container;i&&(e.forEach((t=>i.classList.remove(t))),t.forEach((t=>i.classList.add(t))))}_removeActiveClassNames(){const t=this.container;if(!t)return;let e;for(e in Ze)Ke(e,this[e]).forEach((e=>t.classList.remove(e)))}};return t([u()],s.prototype,"breakpoints",null),t([u()],s.prototype,"orientation",void 0),t([u()],s.prototype,"widthBreakpoint",void 0),t([u()],s.prototype,"heightBreakpoint",void 0),s=t([e("esri.views.BreakpointsOwner")],s),s},Ye=i=>{let s=class extends i{async fetchPopupFeatures(t,e){await this.when();const{location:i,queryArea:s,layerViewsAndGraphics:n,clientOnlyGraphics:r}=await this._prepareFetchPopupFeatures(t,e),o=Promise.resolve(r),a=this._queryLayerPopupFeatures(s,n,e),h=a.map((t=>t.promise));return{location:i,clientOnlyGraphics:r,allGraphicsPromise:x([o,...h]).then(k),promisesPerLayerView:a}}_queryLayerPopupFeatures(t,e,i){return e.map((({layerView:e,graphics:s})=>{const n={clientGraphics:s,event:_(i)?i.event:null,signal:_(i)?i.signal:null,defaultPopupTemplateEnabled:!!_(i)&&!!i.defaultPopupTemplateEnabled},r=e.fetchPopupFeatures(t,n);return{layerView:e,promise:r}}))}_isValidPopupGraphic(t,e){return t&&!!t.getEffectivePopupTemplate(_(e)&&e.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(t,e){const{clientGraphics:i,queryArea:s,location:n}=await this._popupHitTestGraphics(t,e),r=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:o,clientOnlyGraphics:a}=this._graphicsPerFetchPopupLayerView(i,r);return{clientOnlyGraphics:a,layerViewsAndGraphics:o,queryArea:s,location:n}}async _popupHitTestGraphics(t,e){const{results:i,mapPoint:s}=await this.popupHitTest(t),n=i.filter((t=>this._isValidPopupGraphic(t.graphic,e))),r=n.length?n[0].mapPoint:null;return{clientGraphics:n.map((t=>t.graphic)),queryArea:s,location:s||r}}_getFetchPopupLayerViews(){const t=[];return this.allLayerViews.forEach((e=>{this._isValidPopupLayerView(e)&&t.push(e)})),_(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&t.push(this.graphicsView),t.reverse()}_isValidPopupLayerView(t){return _(t)&&(!("layer"in t)||!t.suspended)&&"fetchPopupFeatures"in t}_graphicsPerFetchPopupLayerView(t,e){const i=[],s=new Map,n=e.map((t=>{const e=[];return s.set("layer"in t?t.layer:t.graphics,e),{layerView:t,graphics:e}}));for(const e of t){const t=s.get(e.layer)||s.get(e.sourceLayer)||null;t?t.push(e):i.push(e)}return{layerViewsAndGraphics:n,clientOnlyGraphics:i}}};return s=t([e("esri.views.PopupView")],s),s};let Qe=class extends v{constructor(t){super(t),this.view=null,this.baseLayerViews=new r,this.referenceLayerViews=new r,this._loadingHandle=g(this,"view.map.basemap",(t=>{t&&t.load().catch((()=>{}))}))}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){return!(this.view&&this.view.suspended||!(this.view&&this.view.map&&this.view.map.basemap)||this.view.map.basemap.loaded)}};t([u({constructOnly:!0})],Qe.prototype,"view",void 0),t([u({readOnly:!0})],Qe.prototype,"baseLayerViews",void 0),t([u({readOnly:!0})],Qe.prototype,"referenceLayerViews",void 0),t([u({readOnly:!0})],Qe.prototype,"suspended",null),t([u({type:Boolean,readOnly:!0})],Qe.prototype,"updating",null),Qe=t([e("esri.views.BasemapView")],Qe);const Xe=s.getLogger("esri.views.LayerViewManager");class ti{constructor(t,e,i){this.layer=t,this.view=e,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=M(),this._started=!1,this.done=!1,C(this._controller.signal,(()=>{const e=new o("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(e)}))}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:e,view:i}=this;e.emit("layerview-destroy",{view:i,layerView:t}),i.emit("layerview-destroy",{layer:e,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:e,view:i}=this;this._map=i.map;try{var s,n;let r,h;if(await e.load({signal:t}),"prefetchResources"in e&&await e.prefetchResources({signal:t}),e.createLayerView)r=await e.createLayerView(i,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(e))throw new o("layer:view-not-supported","No layerview implementation was found");const s=await this.layerViewImporter.importLayerView(e);a(t),r="default"in s?new s.default({layer:e,view:i}):new s({layer:e,view:i})}const l=()=>{h=V(h),r.destroyed||r.destroy(),r.layer=null,r.parent=null,r.view=null,this.done=!0};h=C(t,l),a(t);try{await r.when()}catch(t){throw l(),t}if(!(null==(s=this._map)||null==(n=s.allLayers)?void 0:n.includes(e)))return l(),void this._deferred.reject(new o("view:no-layerview-for-layer","The layer has been removed from the map",{layer:e}));this.layerView=r,e.emit("layerview-create",{view:i,layerView:r}),i.emit("layerview-create",{layer:e,layerView:r}),this.done=!0,this._deferred.resolve(r)}catch(t){e.emit("layerview-create-error",{view:i,error:t}),i.emit("layerview-create-error",{layer:e,error:t}),this.done=!0,this._deferred.reject(new o("layerview:create-error","layerview creation failed",{layer:e,error:t}))}}}let ei=class extends At{constructor(t){super(t),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new Nt,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var t;const e=null==(t=this.view.map)?void 0:t.allLayers;if(e)for(const t of e)this.layerViewImporter.hasLayerViewModule(t)&&this.layerViewImporter.importLayerView(t)},this._reschedule=()=>(m(this._workPromise)&&(this._workPromise=M()),this.handles.remove("reschedule"),this.handles.add(T(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var t,e,i;const s=this.view.map;if(this._map!==s&&(this.clear(),this._map=s),m(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const n=new Pt({getCollections:()=>this._rootCollectionNames.map((t=>this.get(t))),getChildrenFunction:t=>t&&"layers"in t?t.layers:null});if(!n)return this._workPromise.resolve(),void(this._workPromise=null);for(const t of n)this._createLayerView(t);this._refreshCollections();for(const[t,e]of this._layerLayerViewInfoMap)n.includes(t)||(this._layerLayerViewInfoMap.delete(e.layer),e.destroy());const r=n.filter((t=>"group"===t.type)).map((t=>t.layers)),o=[null==s||null==(t=s.ground)?void 0:t.layers,null==s||null==(e=s.basemap)?void 0:e.baseLayers,null==s||null==(i=s.basemap)?void 0:i.referenceLayers,null==s?void 0:s.layers,...r].filter((t=>!!t));this.handles.add(o.map((t=>this._watchUpdatingTracking.addOnCollectionChange(t,this._reschedule))),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([P(this,"view.map.allLayers","change",this._preloadLayerViewModules,this._preloadLayerViewModules),g(this.view,["map.basemap","map.ground","map.layers","ready"],this._reschedule,!0)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const t=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&t.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(t)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return _(this._workPromise)||this._watchUpdatingTracking.updating||I(this._layerLayerViewInfoMap,(t=>!t.done))}get updatingRemaining(){let t=0;for(const e of this._layerLayerViewInfoMap.values())e.done||++t;return t}clear(){if(!this.destroyed){for(const t of this._layerLayerViewInfoMap.values())t.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(t){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(t))throw new o("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:t});return this._layerLayerViewInfoMap.get(t).promise}_refreshCollections(){for(const[t,e]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(t),this.get(e),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(t,e,i){if(!t||!e)return void(e&&e.removeAll());let s=0;for(const n of t){const t=this._layerLayerViewInfoMap.get(n);if(!t||!t.layerView)continue;const r=t.layerView;r.layer=n,r.parent=i,e.getItemAt(s)!==r&&e.splice(s,0,r),n.layers&&this._populateLayerViewsOwners(n.layers,r.layerViews,r),s+=1}s<e.length&&e.splice(s,e.length)}_createLayerView(t){if(this._layerLayerViewInfoMap.has(t))return this.view.ready&&this._layerLayerViewInfoMap.get(t).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");t.load().catch((()=>{})),this.layerViewImporter.hasLayerViewModule(t)&&this.layerViewImporter.importLayerView(t);const e=new ti(t,this.view,this.layerViewImporter);e.promise.then((()=>this._refreshCollections()),(e=>{var i,s;e&&(O(e)||"cancelled:layerview-create"===e.name)||Xe.error(`Failed to create layerview for layer title:'${null!=(i=t.title)?i:"no title"}', id:'${null!=(s=t.id)?s:"no id"}' of type '${t.type}'.`,{layer:t,error:e}),this._refreshCollections()})),this._layerLayerViewInfoMap.set(t,e),this.view.ready&&e.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};t([u()],ei.prototype,"_workPromise",void 0),t([u({readOnly:!0})],ei.prototype,"_watchUpdatingTracking",void 0),t([u({readOnly:!0})],ei.prototype,"_layersToLayerViews",null),t([u({readOnly:!0})],ei.prototype,"_rootCollectionNames",null),t([u()],ei.prototype,"layerViewImporter",void 0),t([u()],ei.prototype,"supportsGround",void 0),t([u({readOnly:!0})],ei.prototype,"updating",null),t([u({readOnly:!0})],ei.prototype,"updatingRemaining",null),t([u({constructOnly:!0})],ei.prototype,"view",void 0),ei=t([e("esri.views.LayerViewManager")],ei);const ii=ei;let si=class extends v{constructor(t){super(t),this.factor=1.5,this.offset=Ft(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};t([u({type:Number})],si.prototype,"factor",void 0),t([u({nonNullable:!0})],si.prototype,"offset",void 0),t([u()],si.prototype,"position",void 0),t([u({type:Number,range:{min:0}})],si.prototype,"size",void 0),t([u()],si.prototype,"maskUrl",void 0),t([u()],si.prototype,"maskEnabled",void 0),t([u()],si.prototype,"overlayUrl",void 0),t([u()],si.prototype,"overlayEnabled",void 0),t([u({readOnly:!0})],si.prototype,"version",null),t([u({type:Boolean})],si.prototype,"visible",void 0),si=t([e("esri.views.Magnifier")],si);const ni=si;class ri{constructor(t,e){this._stage=t,this._textureRequests=new Map,this._frameTask=_(e)?e.registerTask(zt.TEXTURE_UNLOAD):Gt}destroy(){this._frameTask.remove(),this._textureRequests.forEach((t=>this._releaseTextureRequest(t))),this._textureRequests.clear()}fromData(t,e){const i=this.makeUid(t);let s=this._textureRequests.get(i);return s||(s={referenceCount:0,texture:e(),textureAsync:null,abortController:null},this._stage&&(this._stage.add(s.texture),this._stage.loadSynchronous(s.texture)),this._textureRequests.set(i,s)),s.referenceCount++,{uid:i,texture:s.texture,release:()=>this._release(i)}}_release(t){if(!this._textureRequests)return;const e=this._textureRequests.get(t);e?(e.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+t),e.referenceCount--,e.referenceCount<1&&this._frameTask.schedule((()=>this._releaseNow(t)))):console.warn(`TextureCollection: texture doesn't exist: '${t}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(t){if(!this._textureRequests)return;const e=this._textureRequests.get(t);!e||e.referenceCount>0||(this._releaseTextureRequest(e),this._textureRequests.delete(t))}_releaseTextureRequest(t){var e;t.texture?null==(e=this._stage)||e.remove(t.texture):t.abortController&&(t.abortController.abort(),t.abortController=null)}makeUid(t,e=null){return _(e)?`${t}.${e}px`:t}}const oi=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],ai={};function hi(t){return!!ai[t]}oi.forEach((t=>{ai[t]=!0}));class li{constructor(t){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this.handlers.forEach((({handler:t,priority:e},i)=>this.inputManager.installHandlers(i,[t],e)))}disconnect(){this.inputManager&&this.handlers.forEach(((t,e)=>this.inputManager.uninstallHandlers(e))),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(t,e,i,s){const n=Array.isArray(t)?t:t.split(",");if(!function(t){for(const e of t)if(!hi(e))return!1;return!0}(n))return n.some(hi)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let r,o;Array.isArray(e)?o=e:(r=e,o=[]),"function"==typeof i?r=i:s=i,s=null!=s?s:qt.DEFAULT;const a=this.createUniqueGroupName(),h=new ui(this.view,n,o,r);this.handlers.set(a,{handler:h,priority:s});for(const t of n){const e=this.handlerCounts.get(t)||0;this.handlerCounts.set(t,e+1)}return this.inputManager&&this.inputManager.installHandlers(a,[h],s),{remove:()=>this.removeHandler(a,n)}}hasHandler(t){return!!this.handlerCounts.get(t)}removeHandler(t,e){if(this.handlers.has(t)){this.handlers.delete(t);for(const t of e){const e=this.handlerCounts.get(t);void 0===e?console.error("Trying to remove handler for event that has no handlers registered: ",t):1===e?this.handlerCounts.delete(t):this.handlerCounts.set(t,e-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class ui extends $t{constructor(t,e,i,s){super(!0),this.view=t;for(const t of e)switch(t){case"click":this.registerIncoming("click",i,(t=>s(this.wrapClick(t))));break;case"double-click":this.registerIncoming("double-click",i,(t=>s(this.wrapDoubleClick(t))));break;case"immediate-click":this.registerIncoming("immediate-click",i,(t=>s(this.wrapImmediateClick(t))));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,(t=>s(this.wrapImmediateDoubleClick(t))));break;case"hold":this.registerIncoming("hold",i,(t=>s(this.wrapHold(t))));break;case"drag":this.registerIncoming("drag",i,(t=>{const e=this.wrapDrag(t);e&&s(e)}));break;case"key-down":this.registerIncoming("key-down",i,(t=>s(this.wrapKeyDown(t))));break;case"key-up":this.registerIncoming("key-up",i,(t=>s(this.wrapKeyUp(t))));break;case"pointer-down":this.registerIncoming("pointer-down",i,(t=>s(this.wrapPointer(t,"pointer-down"))));break;case"pointer-move":this.registerIncoming("pointer-move",i,(t=>s(this.wrapPointer(t,"pointer-move"))));break;case"pointer-up":this.registerIncoming("pointer-up",i,(t=>s(this.wrapPointer(t,"pointer-up"))));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,(t=>s(this.wrapPointerDrag(t))));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,(t=>s(this.wrapMouseWheel(t))));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,(t=>s(this.wrapPointer(t,"pointer-enter"))));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,(t=>s(this.wrapPointer(t,"pointer-leave"))));break;case"gamepad":this.registerIncoming("gamepad",i,(t=>{s(this.wrapGamepad(t))}));break;case"focus":this.registerIncoming("focus",i,(t=>{s(this.wrapFocus(t))}));break;case"blur":this.registerIncoming("blur",i,(t=>{s(this.wrapBlur(t))}))}}wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapClick(t){const{pointerType:e,button:i,buttons:s,x:n,y:r,native:o,eventId:a}=t.data,{cancelable:h,timestamp:l}=t;return{type:"click",pointerType:e,button:i,buttons:s,x:n,y:r,native:o,timestamp:l,screenPoint:Ft(n,r),mapPoint:this.getMapPoint(n,r),eventId:a,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapDoubleClick(t){const{pointerType:e,button:i,buttons:s,x:n,y:r,native:o,eventId:a}=t.data,{cancelable:h,timestamp:l}=t;return{type:"double-click",pointerType:e,button:i,buttons:s,x:n,y:r,native:o,timestamp:l,mapPoint:this.getMapPoint(n,r),eventId:a,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapImmediateClick(t){const{pointerType:e,button:i,buttons:s,x:n,y:r,native:o,eventId:a}=t.data,h=o.pointerId,{cancelable:l,timestamp:u}=t;return{type:"immediate-click",pointerId:h,pointerType:e,button:i,buttons:s,x:n,y:r,native:o,timestamp:u,mapPoint:this.getMapPoint(n,r),eventId:a,cancelable:l,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapImmediateDoubleClick(t){const{pointerType:e,button:i,buttons:s,x:n,y:r,native:o,eventId:a}=t.data,h=o.pointerId,{cancelable:l,timestamp:u}=t;return{type:"immediate-double-click",pointerId:h,pointerType:e,button:i,buttons:s,x:n,y:r,native:o,timestamp:u,mapPoint:this.getMapPoint(n,r),eventId:a,cancelable:l,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapHold(t){const{pointerType:e,button:i,buttons:s,x:n,y:r,native:o}=t.data,{cancelable:a,timestamp:h}=t;return{type:"hold",pointerType:e,button:i,buttons:s,x:n,y:r,native:o,timestamp:h,mapPoint:this.getMapPoint(n,r),cancelable:a,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}getMapPoint(t,e){return this.view.toMap(Ft(t,e),{exclude:[]})}wrapDrag(t){const e=t.data,{x:i,y:s}=e.center,{action:n,pointerType:r,button:o}=e;if("start"===n&&(this.latestDragStart=e),!this.latestDragStart)return;const a=e.pointer.native,h=e.buttons,{cancelable:l,timestamp:u}=t,c={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===n&&(this.latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:c,pointerType:r,button:o,buttons:h,radius:e.radius,angle:Zt(e.angle),native:a,timestamp:u,cancelable:l,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapKeyDown(t){const{key:e,repeat:i,native:s}=t.data,{cancelable:n,timestamp:r}=t;return{type:"key-down",key:e,repeat:i,native:s,timestamp:r,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapKeyUp(t){const{key:e,native:i}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:e,native:i,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapPointer(t,e){const{x:i,y:s,button:n,buttons:r,native:o,eventId:a}=t.data,h=o.pointerId,l=o.pointerType,{cancelable:u,timestamp:c}=t;return{type:e,x:i,y:s,pointerId:h,pointerType:l,button:n,buttons:r,native:o,timestamp:c,eventId:a,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapPointerDrag(t){const{x:e,y:i,buttons:s,native:n,eventId:r}=t.data.currentEvent,{button:o}=t.data.startEvent,a=t.data.startEvent.native.pointerId,h=t.data.startEvent.native.pointerType,l=t.data.action,u={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:c,timestamp:d}=t;return{type:"pointer-drag",x:e,y:i,pointerId:a,pointerType:h,button:o,buttons:s,action:l,origin:u,native:n,timestamp:d,eventId:r,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapMouseWheel(t){const{cancelable:e,data:i,timestamp:s}=t,{x:n,y:r,deltaY:o,native:a}=i;return{type:"mouse-wheel",x:n,y:r,deltaY:o,native:a,timestamp:s,cancelable:e,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapGamepad(t){const{action:e,state:i,device:s}=t.data,{cancelable:n,timestamp:r}=t,{buttons:o,axes:a}=i;return{type:"gamepad",device:s,timestamp:r,action:e,buttons:o,axes:a,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}}function ci(t){return[t.on("after-add",(t=>{const e=t.item;e.view&&e.view.ready&&!e.attached&&e.attach()})),t.on("after-remove",(t=>{const e=t.item;e.active&&(e.view.activeTool=null),e.attached&&e.detach()}))]}function di(t){return t.visible&&t.getEditableFlag(0)&&t.getEditableFlag(1)}class pi{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,e){const i=()=>t.stopPropagation();switch(t.type){case"pointer-move":fi(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),"end"===t.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!vi(t))break;const s=Bt(t),n=this._intersect(s,t.pointerType,e.forEachTool);if(m(n))break;const r=this._findToolAndManipulatorByKey(n,e.forEachTool,mi),o=D(r,(t=>t.manipulator)),a=D(r,(t=>t.tool));!(_(o)&&_(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(t)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,a,t),_(o)&&o.interactive&&o.grabbable&&o.grabbableForEvent(t)&&!o.grabbing&&(this._grabbedManipulators.set(t.pointerId,{key:n,start:s,pointerType:t.pointerType}),1===this._grabbedManipulators.size&&e.activeTool!==n.tool&&(this._currentlyActiveTool=e.activeTool,this._revertToActiveTool=!0,e.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),i());break}case"pointer-up":this._handlePointerEnd(t,e);break;case"pointer-drag":{if(!vi(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=this._draggedManipulators.get(t.pointerId),r=D(s||n,(({key:t})=>t)),o=this._findManipulatorByKey(r,e.forEachTool);if(m(o))break;const a=Bt(t);a.x=Ht(a.x,0,e.view.width),a.y=Ht(a.y,0,e.view.height);const h=S(s||n).start;switch(t.action){case"start":case"update":"update"!==t.action&&1!==this._grabbedManipulators.size||(o.dragging=!0,o.events.emit("drag",n?{action:"update",start:h,screenPoint:a}:{action:"start",start:h,screenPoint:a,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{key:S(r),start:h}));break;case"end":o.dragging=!1,n&&o.events.emit("drag",{action:"end",start:h,screenPoint:a}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,e)}i();break}case"immediate-click":{const s=Bt(t),n=this._intersect(s,t.pointerType,e.forEachTool),r=this._findToolAndManipulatorByKey(n,e.forEachTool,mi);if(function(t){return!!t.native.shiftKey}(t)||e.forEachTool((t=>{if((!_(r)||r.tool!==t||t.automaticManipulatorSelection)&&t.manipulators){let e=!1;t.manipulators.forEach((({manipulator:t})=>{t.selected&&(t.selected=!1,e=!0)})),e&&t.manipulatorSelectionChanged&&t.manipulatorSelectionChanged()}})),m(r))break;const{manipulator:o,tool:a}=r;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.manipulatorSelectionChanged&&a.manipulatorSelectionChanged()),o.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:t.native.shiftKey,stopPropagation:i});break}case"click":{const s=Bt(t),n=this._intersect(s,t.pointerType,e.forEachTool),r=this._findManipulatorByKey(n,e.forEachTool);if(m(r)||!r.interactive)break;r.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:t.native.shiftKey}),i();break}case"double-click":{const s=Bt(t),n=this._intersect(s,t.pointerType,e.forEachTool),r=this._findManipulatorByKey(n,e.forEachTool);if(m(r)||!r.interactive)break;r.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:t.native.shiftKey,stopPropagation:i});break}case"immediate-double-click":{const s=Bt(t),n=this._intersect(s,t.pointerType,e.forEachTool),r=this._findManipulatorByKey(n,e.forEachTool);if(m(r)||!r.interactive)break;r.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:t.native.shiftKey,stopPropagation:i});break}}this._updateCursor(e.forEachTool)}_ungrabManipulatorBeforeDragging(t,e,i){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:Bt(i)}),this._grabbedManipulators.forEach((({key:i},s)=>{i.tool===e&&e.manipulators.findById(i.manipulatorId)===t&&this._grabbedManipulators.delete(s)}))}_handlePointerEnd(t,e){const i=D(this._grabbedManipulators.get(t.pointerId),(({key:t})=>t)),s=this._findManipulatorByKey(i,e.forEachTool);_(s)&&!s.dragging&&(1===this._grabbedManipulators.size&&0===this._draggedManipulators.size&&this._revertToActiveTool&&(e.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),s.grabbing&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:Bt(t)})),this._grabbedManipulators.delete(t.pointerId))}_cursorFromMap(t,e){let i=null;return I(t,(({key:t})=>{const s=this._findManipulatorByKey(t,e);return!!(_(s)&&s.interactive&&"cursor"in s&&s.cursor)&&(i=s.cursor,!0)})),i}_updateCursor(t){this._cursor=this._grabbedManipulators.size>0?this._cursorFromMap(this._grabbedManipulators,t)||"grabbing":this._hoveredManipulators.size>0?this._cursorFromMap(this._hoveredManipulators,t)||"pointer":null}clearPointers(t,e,i=!0,s){const n=e=>e.tool===t&&(m(s)||e.manipulatorId===s);this._grabbedManipulators.forEach((({key:t,pointerType:i},s)=>{if(n(t)){this._grabbedManipulators.delete(s);const n=this._findManipulatorByKey(t,e);_(n)&&(n.grabbing=!1,n.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:i}))}})),this._draggedManipulators.forEach((({key:t},i)=>{if(n(t)){this._draggedManipulators.delete(i);const s=this._findManipulatorByKey(t,e);_(s)&&(s.dragging=!1,s.events.emit("drag",{action:"cancel"}))}})),i&&this._hoveredManipulators.forEach((({key:t},i)=>{if(n(t)){this._hoveredManipulators.delete(i);const s=this._findManipulatorByKey(t,e);_(s)&&(s.hovering=!1)}})),this._updateCursor(e)}_intersect(t,e,i){let s=null;return i((i=>{if(null==i.manipulators||!di(i))return!1;const n=i.manipulators.intersect(t,e);return!m(n)&&(s={manipulatorId:n.id,tool:i},!0)})),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach(((e,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Ft(e.x,e.y),i,e.pointerType,t)}))}handleHoverEvent(t,e){"pointer-up"!==t.type&&"immediate-click"!==t.type&&"pointer-move"!==t.type||!fi(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Bt(t),t.pointerId,t.pointerType,e)}_updateHoveredStateForPointerAtScreenPosition(t,e,i,s){const n=this._intersect(t,i,s);let r=this._findManipulatorByKey(n,s);const o=D(this._hoveredManipulators.get(e),(({key:t})=>t)),a=this._findManipulatorByKey(o,s);_(r)&&!r.interactive&&(r=null),a!==r&&(_(a)&&(a.hovering=!1),_(r)?(r.hovering=!0,this._hoveredManipulators.set(e,{key:S(n)})):this._hoveredManipulators.delete(e),this._updateCursor(s))}_findManipulatorByKey(t,e){return this._findToolAndManipulatorByKey(t,e,mi)?mi.manipulator:null}_findToolAndManipulatorByKey(t,e,i){return m(t)?null:(i.tool=null,i.manipulator=null,e((e=>{if(e!==t.tool||null==e.manipulators||!di(e))return!1;const s=e.manipulators.findById(t.manipulatorId);return!!_(s)&&(i.manipulator=s,i.tool=e,!0)})),i.manipulator?i:null)}}function fi(t){return"mouse"===t}function vi(t){return"mouse"!==t.pointerType||0===t.button}const mi={manipulator:null,tool:null},wi=s.getLogger("esri.views.ToolViewManager"),yi="manipulators";let gi=class extends At{constructor(t){super(t),this._manipulatorState=new pi,this.tools=new r,this.cursor=null,this._forEachTool=t=>{for(const e of this.tools.items)if(t(e))return}}initialize(){this.handles.add([this.view.on(oi,(t=>{this._handleInputEvent(t)}),qt.TOOL),...ci(this.tools),this.tools.on("before-add",(t=>{const e=t.item;if(null==e||this.tools.includes(e))return wi.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault()})),this.tools.on("before-remove",(({item:t})=>{this._manipulatorState.clearPointers(t,this._forEachTool)})),this.tools.on("change",(()=>{this._refreshToolWatchers()}))])}destroy(){this._forEachTool((t=>t.destroy()))}set activeTool(t){if(_(t)&&!this.view.ready)return void wi.error("Cannot set active tool while view is not ready.");if(t===this.activeTool)return void(_(t)&&wi.warn("Tool is already active - ignoring activation request."));_(this.activeTool)&&this.activeTool.deactivate(),_(t)&&t.activate(),this._set("activeTool",t),this._removeIncompleteTools(t);const e=m(this.activeTool);for(const t of this.tools){t.setEditableFlag(1,e||t===this.activeTool);const i=di(t);!e&&i||this._manipulatorState.clearPointers(t,this._forEachTool,!i)}this._updateCursor()}get updating(){return this.updatingHandles.updating||this.tools.some((t=>t.updating))}attach(){this._forEachTool((t=>t.attach())),"3d"===this.view.type?(this._set("textures",new ri(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([this.view.state.watch("camera",(()=>{this._forEachManipulator((t=>{null!=t.onViewChange&&t.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(t=>{this._forEachManipulator((e=>{null!=e.onElevationChange&&e.onElevationChange(t)}))}))],yi)):this.handles.add(this.view.watch("extent",(()=>{this._forEachManipulator((t=>{null!=t.onViewChange&&t.onViewChange()}))})))}detach(){_(this.activeTool)&&(this.activeTool=null),this._forEachTool((t=>{t.detach(),t.destroy()})),this.tools.removeAll(),this.handles.remove(yi)}_forEachManipulator(t){this._forEachTool((e=>{e.manipulators&&e.manipulators.forEach((({manipulator:i})=>t(i,e)))}))}_handleInputEvent(t){let e=!1;const i={...t,stopPropagation:()=>{e=!0,t.stopPropagation()}};_(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool((t=>{!e&&t.attached&&t.visible&&t.handleInputEvent(i)})),!e&&"key-down"===t.type&&"Escape"===t.key&&this.activeTool&&(t.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:t=>{this.activeTool=t},view:this.view}),!e&&_(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove("tools"),this._forEachTool((t=>{if(t instanceof v){const e=A(t,["cursor","visible","editable"],(()=>{di(t)||this._manipulatorState.clearPointers(t,this._forEachTool),this._updateCursor()}));this.handles.add(e,"tools")}t.manipulators&&this.handles.add(t.manipulators.on("change",(e=>{e.removed.forEach((({id:e})=>{this._manipulatorState.clearPointers(t,this._forEachTool,!0,e)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})),"tools")})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){let t=this._manipulatorState.cursor;this._forEachTool((e=>!(!_(e.cursor)||!e.visible||(t=e.cursor,0)))),this._get("cursor")!==t&&this._set("cursor",t)}_removeIncompleteTools(t){this.tools.filter((e=>(m(t)||e!==t)&&!e.completed)).forEach((t=>{this.tools.remove(t),t.destroy()}))}};t([u({constructOnly:!0,nonNullable:!0})],gi.prototype,"view",void 0),t([u({readOnly:!0,nonNullable:!0})],gi.prototype,"textures",void 0),t([u({value:null})],gi.prototype,"activeTool",null),t([u({readOnly:!0,type:r})],gi.prototype,"tools",void 0),t([u({readOnly:!0})],gi.prototype,"cursor",void 0),t([u({readOnly:!0})],gi.prototype,"updating",null),gi=t([e("esri.views.ToolViewManager")],gi);const bi=gi;let xi=class extends v{constructor(t){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",this._detectedDeviceType="standard"===t.mapping?"standard":ki.test(t.id)?"spacemouse":"unknown",this.nativeIndex=t.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return _i[this.deviceType]}};t([u({nonNullable:!0,readOnly:!0})],xi.prototype,"nativeIndex",void 0),t([u({type:String,readOnly:!0})],xi.prototype,"deviceType",null),t([u({type:Number,readOnly:!0})],xi.prototype,"axisThreshold",null),xi=t([e("esri.views.input.gamepad.GamepadInputDevice")],xi);const ki=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),_i={standard:.15,spacemouse:.025,unknown:0},Mi=xi;let Ti=class extends v{constructor(...t){super(...t),this.devices=new r,this.enabledFocusMode="document"}};t([u({type:r.ofType(Mi),readOnly:!0})],Ti.prototype,"devices",void 0),t([u({type:["document","view","none"]})],Ti.prototype,"enabledFocusMode",void 0),Ti=t([e("esri.views.input.gamepad.GamepadSettings")],Ti);const Pi=Ti;let Ii=class extends v{constructor(){super(...arguments),this.gamepad=new Pi}};t([u({readOnly:!0})],Ii.prototype,"gamepad",void 0),Ii=t([e("esri.views.input.Input")],Ii);const Oi=Ii;let Ci=class extends v{constructor(t){super(t),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};t([u({type:Boolean,nonNullable:!0})],Ci.prototype,"enabled",void 0),t([u({type:Mi})],Ci.prototype,"device",void 0),t([u({type:["pan","zoom"],nonNullable:!0})],Ci.prototype,"mode",void 0),t([u({type:["forward-down","forward-up"],nonNullable:!0})],Ci.prototype,"tiltDirection",void 0),t([u({type:Number,nonNullable:!0})],Ci.prototype,"velocityFactor",void 0),Ci=t([e("esri.views.navigation.gamepad.GamepadSettings")],Ci);const Vi=Ci;let Di=class extends v{constructor(t){super(t),this.browserTouchPanEnabled=!0,this.gamepad=new Vi,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};t([u({type:Boolean})],Di.prototype,"browserTouchPanEnabled",void 0),t([u({type:Vi,nonNullable:!0})],Di.prototype,"gamepad",void 0),t([u({type:Boolean})],Di.prototype,"momentumEnabled",void 0),t([u({type:Boolean})],Di.prototype,"mouseWheelZoomEnabled",void 0),Di=t([e("esri.views.navigation.Navigation")],Di);const Si=Di;var Ai;const Ni=s.getLogger("esri.views.support.DefaultsFromMap");let Ri=Ai=class extends v{constructor(){super(...arguments),this._handles=new y,this._waitTask=null,this._extentProjectController=null,this._spatialReferenceCandidates=null,this._extentCandidates=null,this.logDebugInformation=!1,this.isSpatialReferenceDone=!1,this.isTileInfoDone=!1,this.isHeightModelInfoSearching=!1,this.spatialReference=null,this.extent=null,this.heightModelInfo=null,this.vcsWkid=null,this.latestVcsWkid=null,this.mapCollectionPaths=Ai.DefaultMapCollectionPaths.slice(),this.tileInfo=null}initialize(){this.watch("mapCollectionPaths",(()=>{this._running&&(this.reset(),this.start())}))}destroy(){this._set("view",null),this._handles=N(this._handles),this._cancelLoading()}get _running(){return!!(this._handles&&this._handles.size>0)}reset(){this._handles.removeAll(),this._set("isSpatialReferenceDone",!1),this._set("isTileInfoDone",!1),this._set("isHeightModelInfoSearching",!1),this._set("spatialReference",null),this._set("extent",null),this._set("heightModelInfo",null),this._set("vcsWkid",null),this._set("latestVcsWkid",null),this._set("tileInfo",null),this._spatialReferenceCandidates=null,this._extentCandidates=null}start(){this._handles.removeAll();const t=this._updateLayerChange.bind(this);for(const e of this.mapCollectionPaths)this._handles.add(P(this.view,`map.${e}`,"change",t,t,t,!0));this._handles.add(R(this,"isSpatialReferenceDone",(()=>this._updateTileInfo()),!0))}_ownerNameFromCollectionName(t){const e=t.lastIndexOf(".");return-1===e?"view":"view."+t.slice(0,e)}_ensureLoadedOwnersFromCollectionName(t){const e=this._ownerNameFromCollectionName(t).split(".");let i;for(let s=0;s<e.length&&(i=this.get(e.slice(0,s+1).join(".")),i);s++)if(i.load&&!i.isFulfilled())return{collectionName:t,owner:null,loading:i.load().catch((()=>{}))};return{collectionName:t,owner:i}}_cancelLoading(){this._waitTask=null,this._extentProjectController&&(this._extentProjectController.abort(),this._extentProjectController=null)}_updateWhen(t){let e=!0,i=!1;const s=t.catch((()=>{})).then((()=>{e?i=!0:s===this._waitTask&&this._update()}));return e=!1,i||(this._waitTask=s),i}_updateLayerChange(){this.isSpatialReferenceDone&&!this.spatialReference&&this._set("isSpatialReferenceDone",!1),this._update()}_update(){if(this._cancelLoading(),this.view){if(!this.isSpatialReferenceDone){this._debugLog("Starting search for spatial reference...");const t=this._processMapCollections((t=>this._processSpatialReferenceSource(t)));if(this._debugLog(`Search ended with status '${Ei(t)}'`),0!==t){let t=null,e=this._spatialReferenceCandidates;if(!e||e.length<1?(t=this.defaultSpatialReference,this._debugLog(`No spatial reference found, locking to default (${Li(t)})`)):(this.defaultSpatialReference&&e.length>1&&e.findIndex((t=>t.equals(this.defaultSpatialReference)))>-1&&(e=[this.defaultSpatialReference]),t=e[0],this._debugLog(`Locking to ${Li(t)}`)),this._set("spatialReference",t),t)if(this.extent)this._set("isSpatialReferenceDone",!0);else{const e=this.logDebugInformation;this.logDebugInformation=!1,this._processMapCollections((e=>this._findExtent(e,t))),this.logDebugInformation=e,this._projectExtentCandidate().catch((()=>{})).then((()=>this._set("isSpatialReferenceDone",!0)))}else this._set("isSpatialReferenceDone",!0)}}if(null==this.heightModelInfo&&this.view.isHeightModelInfoRequired){this._debugLog("Starting search for height model info...");const t=this._processMapCollections((t=>this._processHeightModelInfoSource(t)),(t=>Jt(t)));this._debugLog(`Search ended with status ${Ei(t)}`),this._set("isHeightModelInfoSearching",0===t)}this._updateTileInfo()}}_processMapCollections(t,e){this._preloadMapCollections(e);let i=2;return this._forAllMapCollectionSources((t=>{if(2!==i)return!1;const{collectionName:e}=t;return this._debugLog(`Processing collection ${e}...`),!(t.loading&&!this._updateWhen(t.loading)&&(this._debugLog(`Collection ${t.collectionName} owner is loading -> wait`),i=0,1))}),(s=>!(2!==i||(null==e||e(s)?!s.load||s.isFulfilled()||this._updateWhen(s.load())?(!s.load||s.isResolved())&&t(s)&&(i=1,1):(this._debugLog(`Source ${s.id} is loading -> wait`),i=0,1):(this._debugLog(`Source ${s.id} is skipped due to predicate`),1))))),i}_preloadMapCollections(t){let e=10;const i=this.logDebugInformation;this.logDebugInformation=!1,this._forAllMapCollectionSources((()=>!0),(s=>0!==e&&!(null!=t&&!t(s)||(s.load&&!s.isFulfilled()&&(this.logDebugInformation=i,this._debugLog(`Pre-loading source ${s.id}`),this.logDebugInformation=!1,s.load().catch((()=>{})),e--),0)))),this.logDebugInformation=i}_forAllMapCollectionSources(t,e){for(const i of this.mapCollectionPaths){const s=`map.${i}`,n=this._ensureLoadedOwnersFromCollectionName(s);if(!1===t(n))continue;const r=n.owner;if(!r||r.isRejected&&r.isRejected()){this._debugLog(`Collection ${s} owner is invalid or rejected -> skip`);continue}const o=this.view.get(s);o?this._forEachSource(o,e):this._debugLog(`Collection ${s} does not exist -> skip`)}}_forEachSource(t,e){for(const i of t.items)!1!==e(i)&&"layers"in i&&i.layers&&this._forEachSource(i.layers,e)}_processSpatialReferenceSource(t){let e=this._getSupportedSpatialReferences(t);return 0!==e.length&&(this._spatialReferenceCandidates?(e=L(e,this._spatialReferenceCandidates,((t,e)=>t.equals(e))),e.length>0?this._spatialReferenceCandidates=e:this._debugLog(`Layer ${t.id} is ignored because its supported spatial\n          references are not compatible with the previous candidates`)):this._spatialReferenceCandidates=e,1===this._spatialReferenceCandidates.length)}_findExtent(t,e){const i="fullExtents"in t&&t.fullExtents||(_(t.fullExtent)?[t.fullExtent]:[]),s=i.find((t=>t.spatialReference.equals(e)));if(s)return this._set("extent",s),!0;if(this._getSupportedSpatialReferences(t).length>0){const e=i.map((e=>({extent:e,layer:t})));this._extentCandidates=(this._extentCandidates||[]).concat(e)}return!1}async _projectExtentCandidate(){if(!this._extentCandidates||!this._extentCandidates.length)return;const t=this.spatialReference,e=this._extentCandidates.find((e=>E(e.extent.spatialReference,t)));if(_(e))this._set("extent",S(j(e.extent,t)));else{const e=this._extentCandidates[0];this._extentProjectController=new AbortController;const i=await import("./p-42bb6c1e.js");try{const s=await i.projectGeometry(e.extent,t,e.layer.portalItem,this._extentProjectController.signal);this._set("extent",s)}catch{}this._extentProjectController=null}}_getSupportedSpatialReferences(t){const e="supportedSpatialReferences"in t&&t.supportedSpatialReferences||(t.spatialReference?[t.spatialReference]:[]);if(0===e.length)return this._debugLog(`Layer ${t.id} is ignored because it does not have any spatial references`),[];const i=e.filter((e=>this.view.isSpatialReferenceSupported(e,t,(t=>this._debugLog(t)))));return this._debugLog(0===i.length?`Layer ${t.id} has spatial references but none of them are supported (or layer doesn't require locking)`:`Layer ${t.id} has spatial references. Resulting candidate set: ${i.map(Li).join(", ")}`),i}_processHeightModelInfoSource(t){const e=Yt(t);return!!e&&(this._set("heightModelInfo",e),this._set("isHeightModelInfoSearching",!1),t.spatialReference&&(this._set("vcsWkid",t.spatialReference.vcsWkid),this._set("latestVcsWkid",t.spatialReference.latestVcsWkid)),!0)}_updateTileInfo(){if(null!=this.tileInfo)return;if(!this.view.isTileInfoRequired())return void this._set("isTileInfoDone",!0);if(!this.isSpatialReferenceDone)return;const t=this.get("view.map");if(!t)return void this._debugLog("updateTileInfo: no map");const e=t.basemap,i=t.get("layers.0");let s=null;if(e&&"failed"!==e.loadStatus){if(!e.loaded)return this._updateWhen(e.load()),void this._debugLog("updateTileInfo: basemap still loading");const t=e&&e.get("baseLayers.0");if(t&&"failed"!==t.loadStatus){if(!t.loaded)return this._updateWhen(t.load()),void this._debugLog("updateTileInfo: first basemap layer still loading");s="tileInfo"in t&&t.tileInfo}else{if(!i||"failed"===i.loadStatus)return this._debugLog("updateTileInfo: no tileInfo"),void this._set("isTileInfoDone",!0);if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first operational layer still loading");s="tileInfo"in i&&i.tileInfo}}else if(i&&"failed"!==i.loadStatus){if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first operational layer still loading");s="tileInfo"in i&&i.tileInfo}s&&!s.spatialReference.equals(this.spatialReference)&&(s=null),this._debugLog(`updateTileInfo: setting ${s}`),this._set("tileInfo",s),this._set("isTileInfoDone",!0)}_debugLog(t){this.logDebugInformation&&Ni.info(t)}};function Li(t){return t?JSON.stringify(t.toJSON()):"undefined"}function Ei(t){switch(t){case 0:return"Waiting";case 1:return"Found";case 2:return"Exhausted"}}Ri.DefaultMapCollectionPaths=["basemap.baseLayers","layers","ground.layers","basemap.referenceLayers"],t([u()],Ri.prototype,"logDebugInformation",void 0),t([u({readOnly:!0})],Ri.prototype,"isSpatialReferenceDone",void 0),t([u({readOnly:!0})],Ri.prototype,"isTileInfoDone",void 0),t([u({readOnly:!0})],Ri.prototype,"isHeightModelInfoSearching",void 0),t([u({constructOnly:!0})],Ri.prototype,"view",void 0),t([u({readOnly:!0})],Ri.prototype,"spatialReference",void 0),t([u({readOnly:!0})],Ri.prototype,"extent",void 0),t([u({readOnly:!0})],Ri.prototype,"heightModelInfo",void 0),t([u({readOnly:!0})],Ri.prototype,"vcsWkid",void 0),t([u({readOnly:!0})],Ri.prototype,"latestVcsWkid",void 0),t([u()],Ri.prototype,"mapCollectionPaths",void 0),t([u()],Ri.prototype,"defaultSpatialReference",void 0),t([u({readOnly:!0})],Ri.prototype,"tileInfo",void 0),Ri=Ai=t([e("esri.views.support.DefaultsFromMap")],Ri);const ji=Ri;var Fi;const zi=s.getLogger("esri.views.View");let Gi=Fi=class extends(Rt(f.EventedMixin(F(v)))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new Pt({getCollections:()=>{var t,e,i;return[null==(t=this.basemapView)?void 0:t.baseLayerViews,null==(e=this.groundView)?void 0:e.layerViews,this.layerViews,null==(i=this.basemapView)?void 0:i.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.defaultsFromMap=new ji({view:this}),this.fatalError=null,this.extent=null,this.graphics=new Lt,this.navigating=!1,this.layerViews=new r,this.magnifier=new ni,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Oi,this.navigation=new Si,this.layerViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new li(this),this.persistableViewModels=new r,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(this.watch("preconditionsReady",(t=>{t?(this._currentSpatialReference=this.spatialReference,Fi.views.add(this)):(this._currentSpatialReference=null,Fi.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?(this.layerViewManager.clear(),this.toolViewManager.detach(),this._teardown()):t&&!this.ready&&(this._startup(),this.toolViewManager.attach())}),!0))}initialize(){let t;this.addResolvingPromise(this.validate().then((()=>(this._isValid=!0,z(this,"ready"))))),this.basemapView=new Qe({view:this}),this.layerViewManager=new ii({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new bi({view:this}),this._resetInitialViewPropertiesFromContent(),g(this.defaultsFromMap,"isSpatialReferenceDone",(e=>{const i=!!(this.map&&this.map.allLayers.length>0);if(e&&!this.spatialReference&&i||!t){if(e&&!this.spatialReference&&i&&!t){const e=t=U(this.spatialReferenceWarningDelay);t.then((()=>{e===t&&zi.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})).catch((()=>{}))}}else t=null}),!0)}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=N(this.graphics),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.toolViewManager=N(this.toolViewManager),this.layerViewManager=N(this.layerViewManager),this.basemapView=N(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const t=this.map;this.map=null,null==t||t.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return zi.error("#toMap()","Not implemented on this instance of View"),null}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){return!!(!this.fatalError&&this._isValid&&!this._readyCycleForced&&this.map&&(!bt.isLoadable(this.map)||this.map.loaded)&&0!==this.width&&0!==this.height&&this.spatialReference&&this.isSpatialReferenceSupported(this.spatialReference)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone)}set map(t){var e;t!==this._get("map")&&(null!=(e=t)&&e.destroyed&&(zi.warn("#map","The provided map is already destroyed",{map:t}),t=null),bt.isLoadable(t)&&t.load().catch((()=>{})),this.initialized&&(this.forceReadyCycle(),this._resetInitialViewPropertiesFromContent()),this._set("map",t))}get spatialReference(){let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&this.isHeightModelInfoRequired&&this.defaultsFromMap&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){this._userSpatialReference=t,this._set("spatialReference",t)}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){return this.defaultsFromMap&&this.defaultsFromMap.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return _(t)?t:this._cursor||"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){return this.layerViewManager.whenLayerView(t)}getDefaultSpatialReference(){return this.get("defaultsFromMap.spatialReference")}getDefaultHeightModelInfo(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null}importLayerView(t){throw new o("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}isSpatialReferenceSupported(t,e,i){return!0}isTileInfoRequired(){return!1}when(t,e){return this.isResolved()&&!this.ready&&zi.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.'),super.when(t,e)}forceReadyCycle(){this.ready&&(this._readyCycleForced=!0,G(this,"preconditionsReady",(()=>this._readyCycleForced=!1)))}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}_resetInitialViewPropertiesFromContent(){if(!this.defaultsFromMap)return;const t=()=>this.defaultsFromMap&&this.defaultsFromMap.start();this.defaultsFromMap.reset(),this._currentSpatialReference=null,this.notifyChange("spatialReference"),this.handles.remove("defaultsFromMap"),this.handles.add([A(this,"spatialReference",((e,i)=>{$(e,i)||t()})),A(this,"initialExtentRequired",t),T(t)],"defaultsFromMap")}};Gi.views=new r,t([q("toolViewManager.activeTool")],Gi.prototype,"activeTool",void 0),t([u({readOnly:!0})],Gi.prototype,"allLayerViews",void 0),t([u()],Gi.prototype,"groundView",void 0),t([u()],Gi.prototype,"animation",void 0),t([u()],Gi.prototype,"basemapView",void 0),t([u()],Gi.prototype,"defaultsFromMap",void 0),t([u()],Gi.prototype,"fatalError",void 0),t([u({type:B})],Gi.prototype,"extent",void 0),t([u(Et(Lt,"graphics"))],Gi.prototype,"graphics",void 0),t([u({readOnly:!0,type:jt,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"]})],Gi.prototype,"heightModelInfo",null),t([u({readOnly:!0})],Gi.prototype,"interacting",null),t([u({readOnly:!0})],Gi.prototype,"navigating",void 0),t([u({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","initialExtentRequired","initialExtent","defaultsFromMap.isSpatialReferenceDone","defaultsFromMap.isTileInfoDone"]})],Gi.prototype,"preconditionsReady",null),t([u({type:r,readOnly:!0})],Gi.prototype,"layerViews",void 0),t([u({type:ni})],Gi.prototype,"magnifier",void 0),t([u({value:null,type:Ue})],Gi.prototype,"map",null),t([u()],Gi.prototype,"padding",void 0),t([u({readOnly:!0})],Gi.prototype,"ready",void 0),t([u({type:W})],Gi.prototype,"spatialReference",null),t([u()],Gi.prototype,"spatialReferenceWarningDelay",void 0),t([u()],Gi.prototype,"stationary",null),t([u({readOnly:!0})],Gi.prototype,"supportsGround",void 0),t([u({type:St})],Gi.prototype,"timeExtent",void 0),t([q("toolViewManager.tools")],Gi.prototype,"tools",void 0),t([u()],Gi.prototype,"toolViewManager",void 0),t([u({readOnly:!0})],Gi.prototype,"type",void 0),t([u({type:Number})],Gi.prototype,"scale",void 0),t([u({readOnly:!0})],Gi.prototype,"updating",void 0),t([u({readOnly:!0})],Gi.prototype,"initialExtentRequired",void 0),t([u({readOnly:!0,type:B})],Gi.prototype,"initialExtent",null),t([u()],Gi.prototype,"cursor",null),t([u({readOnly:!0})],Gi.prototype,"input",void 0),t([u({type:Si,nonNullable:!0})],Gi.prototype,"navigation",void 0),t([u()],Gi.prototype,"layerViewManager",void 0),t([u()],Gi.prototype,"width",void 0),t([u()],Gi.prototype,"height",void 0),t([u({readOnly:!0})],Gi.prototype,"resizing",void 0),t([u({value:null,readOnly:!0})],Gi.prototype,"size",null),t([u({readOnly:!0})],Gi.prototype,"suspended",void 0),t([u({readOnly:!0})],Gi.prototype,"viewEvents",void 0),t([u({readOnly:!0})],Gi.prototype,"persistableViewModels",void 0),t([u()],Gi.prototype,"_isValid",void 0),t([u()],Gi.prototype,"_readyCycleForced",void 0),t([u()],Gi.prototype,"_currentSpatialReference",void 0),Gi=Fi=t([e("esri.views.View")],Gi);const $i=Gi;let qi=class extends Z{constructor(t){super(t),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise(((t,e)=>this._dfd={resolve:t,reject:e})))}get done(){return"finished"===this.state||"stopped"===this.state}stop(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),this._dfd.reject(new o("ViewAnimation stopped")))}finish(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),this._dfd.resolve())}update(t,e){e||(e=H(t)?"waiting-for-target":"running"),this._set("target",t),this._set("state",e)}};t([u({readOnly:!0})],qi.prototype,"done",null),t([u({readOnly:!0,type:String})],qi.prototype,"state",void 0),t([u()],qi.prototype,"target",void 0),qi=t([e("esri.views.ViewAnimation")],qi),(qi||(qi={})).State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"};const Bi=qi,Wi=180/Math.PI;function Ui(t,e,i,s){return s&&i&&!s.equals(i)&&E(s,i)&&s.isWebMercator?s.isWebMercator?function(t,e){let i=e[1];return i>89.99999?i=89.99999:i<-89.99999&&(i=-89.99999),i=Math.sin(Xt(i)),ve(t,Xt(e[0])*K.radius,.5*K.radius*Math.log((1+i)/(1-i)))}(t,e):function(t,e){const i=te(e[0]/K.radius);return ve(t,i-360*Math.floor((i+180)/360),te(.5*Math.PI-2*Math.atan(Math.exp(-e[1]/K.radius))))}(t,e):me(t,e)}function Zi(t){return t.wkid?t:t.spatialReference||W.WGS84}function Hi(t,e){return e.type?ve(t,e.x,e.y):me(t,e)}function Ki(t){return Ve(t)}function Ji(t,e){return Math.max(t.width/e[0],t.height/e[1])*function(t){return J(t)?39.37*Ki(t)*96:1}(t.spatialReference)}async function Yi(t,e,i,s){let n,o;if(!t)return null;if(Array.isArray(t)&&!t.length)return null;if(r.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&"object"==typeof t[0]){const n=t.every((t=>"attributes"in t)),r=t.some((t=>!t.geometry));let o=t;if(n&&r&&e&&e.allLayerViews){const i=new Map;for(const e of t){const t=e.layer,s=i.get(t)||[],n=e.attributes[t.objectIdField];null!=n&&s.push(n),i.set(t,s)}const s=[];i.forEach(((t,i)=>{const n=e.allLayerViews.find((t=>t.layer.id===i.id));if("queryFeatures"in n){const e=i.createQuery();e.objectIds=t,e.returnGeometry=!0,s.push(n.queryFeatures(e))}}));const n=await Promise.all(s),r=[];for(const t of n)if(t&&t.features&&t.features.length)for(const e of t.features)_(e.geometry)&&r.push(e.geometry);o=r}for(const t of o)s=await Yi(t,e,i,s);return s}if(Array.isArray(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1])n=new Y(t);else if(t instanceof Q)n=t;else if("geometry"in t)if(t.geometry)n=t.geometry;else if(t.layer){const i=t.layer,s=e.allLayerViews.find((t=>t.layer.id===i.id));if("queryFeatures"in s){const e=i.createQuery();e.objectIds=[t.attributes[i.objectIdField]],e.returnGeometry=!0;const r=await s.queryFeatures(e);n=X(r,"features",0,"geometry")}}if(m(n))return null;if(o="point"===n.type?new B({xmin:n.x,ymin:n.y,xmax:n.x,ymax:n.y,spatialReference:n.spatialReference}):n.extent,!o)return null;const a=j(o,i);return m(a)?null:s=s?s.union(a):a}function Qi(t,e){const i=t.targetGeometry,s=e.targetGeometry;return i.x=s.x,i.y=s.y,i.spatialReference=s.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function Xi(t,e,i){return i?ve(t,.5*(e[0]-i.right+i.left),.5*(e[1]-i.bottom+i.top)):ge(t,e,.5)}const ts=function(){const t=Oe();return function(e,i,s){const n=i.targetGeometry;Hi(t,n);const r=.5*ns(i);return e.xmin=t[0]-r*s[0],e.ymin=t[1]-r*s[1],e.xmax=t[0]+r*s[0],e.ymax=t[1]+r*s[1],e.spatialReference=n.spatialReference,e}}();function es(t,e,i,s,n){return ps(t,e,i.center),t.scale=Ji(i,s),n&&n.constraints&&n.constraints.constrain(t),t}const is=function(){const t=Oe();return function(e,i,s){return ye(e,function(t,e){return ge(t,e,.5)}(e,i),Xi(t,i,s))}}(),ss=function(){const t=le(),e=Oe();return function(i,s,n,r){const o=ns(s),a=rs(s);return ve(e,o,o),oe(t,e),re(t,t,a),ne(t,t,is(e,n,r)),ne(t,t,[0,r.top-r.bottom]),ve(i,t[4],t[5])}}();function ns(t){return t.scale*function(t){return _(t)&&J(t.spatialReference)?1/(39.37*Ki(t.spatialReference)*96):1}(t.targetGeometry)}function rs(t){return Xt(t.rotation)||0}const os=function(){const t=Oe(),e=Oe(),i=Oe();return function(s,n,r,o,a,h){return be(t,n),ge(e,r,.5*h),ve(i,1/o*h,-1/o*h),se(s),ne(s,s,e),a&&re(s,s,a),ie(s,s,i),ne(s,s,t),s}}(),as=function(){const t=Oe();return function(e,i,s,n){const r=ns(i),o=rs(i);return Hi(t,i.targetGeometry),os(e,t,s,r,o,n)}}(),hs=function(){const t=Oe();return function(e,i,s,n){const r=ns(i);return Hi(t,i.targetGeometry),os(e,t,s,r,0,n)}}();function ls(t){if(t.isWrappable){const e=tt(t);return e.valid[1]-e.valid[0]}return 0}function us(t,e){return async function(t,e){if(!t||!e)return new Qt({targetGeometry:new Y,scale:0,rotation:0});let i=e.spatialReference;const{constraints:s,padding:n,viewpoint:r,size:o}=e,a=[n?o[0]-n.left-n.right:o[0],n?o[1]-n.top-n.bottom:o[1]];let h=null;t instanceof Qt?h=t:t.viewpoint?h=t.viewpoint:t.target&&"esri.Viewpoint"===t.target.declaredClass&&(h=t.target);let l=null;h&&h.targetGeometry?l=h.targetGeometry:t instanceof B?l=t:(t||t&&("center"in t||"extent"in t||"target"in t))&&(l=await Yi(t.center,e,i)||await Yi(t.extent,e,i)||await Yi(t.target,e,i)||await Yi(t,e,i)),!l&&r&&r.targetGeometry?l=r.targetGeometry:!l&&e.extent&&(l=e.extent);const u=Zi(l);if(i||(i=Zi(e.spatialReference||e.extent||l)),!E(l,i)&&u&&!u.equals(i))return null;const c=Hi(Oe(),l.center?l.center:l),d=new Y(Ui(c,c,u,i),i);let p=null;if(h&&_(h.targetGeometry)&&"point"===h.targetGeometry.type)p=h.scale;else if(t.hasOwnProperty("scale")&&t.scale)p=t.scale;else if(t.hasOwnProperty("zoom")&&-1!==t.zoom&&s&&s.effectiveLODs)p=s.zoomToScale(t.zoom);else if(Array.isArray(l)||"point"===l.type||"extent"===l.type&&0===l.width&&0===l.height){const t=j(e.extent,i);p=_(t)?Ji(t,a):e.extent?Ji(e.extent,a):r.scale}else p=E(l.extent,i)?Ji(j(l.extent,i),a):Ji(l.extent,a);const f=function(t){if(t&&(!Array.isArray(t)||"number"!=typeof t[0])&&("object"==typeof t||Array.isArray(t)&&"object"==typeof t[0])){if("layer"in t&&t.layer&&t.layer.minScale&&t.layer.maxScale){const e=t.layer;return{min:e.minScale,max:e.maxScale}}if(Array.isArray(t)&&t.length&&t.every((t=>"layer"in t))){let e=0,i=0;for(const s of t){const t=s.layer;t&&t.minScale&&t.maxScale&&(e=t.minScale<e?t.minScale:e,i=t.maxScale>i?t.maxScale:i)}return e&&i?{min:e,max:i}:null}}}(t);f&&(f.min&&f.min>p?p=f.min:f.max&&f.max<p&&(p=f.max));let v=0;h?v=h.rotation:t.hasOwnProperty("rotation")?v=t.rotation:r&&(v=r.rotation);let m=new Qt({targetGeometry:d,scale:p,rotation:v});return s&&(m=s.fit(m),s.constrainByGeometry(m),s.rotationEnabled||(m.rotation=v)),m}(t,e)}const cs=function(){const t=Oe(),e=Oe(),i=[0,0,0];return function(s,n,r){ke(t,s,n),_e(t,t),ke(e,s,r),_e(e,e),Me(i,t,e);let o=Math.acos(Te(t,e)/(Pe(t)*Pe(e)))*Wi;return i[2]<0&&(o=-o),isNaN(o)&&(o=0),o}}(),ds=function(){const t=Oe();return function(e,i,s,n){const r=e.targetGeometry;return Qi(e,i),ss(t,i,s,n),r.x+=t[0],r.y+=t[1],e}}(),ps=function(){const t=Oe();return function(e,i,s){Qi(e,i);const n=e.targetGeometry,r=Zi(s),o=Zi(n);return Hi(t,s),Ui(t,t,r,o),n.x=t[0],n.y=t[1],e}}(),fs=function(){const t=Oe();return function(e,i,s,n,r){r||(r="center"),ye(t,s,n),ge(t,t,.5);const o=t[0],a=t[1];switch(r){case"center":ve(t,0,0);break;case"left":ve(t,-o,0);break;case"top":ve(t,0,a);break;case"right":ve(t,o,0);break;case"bottom":ve(t,0,-a);break;case"top-left":ve(t,-o,a);break;case"bottom-left":ve(t,-o,-a);break;case"top-right":ve(t,o,a);break;case"bottom-right":ve(t,o,-a)}return _s(e,i,t),e}}();function vs(t,e,i){return Qi(t,e),t.rotation+=i,t}function ms(t,e,i){return Qi(t,e),t.rotation=i,t}const ws=function(){const t=Oe();return function(e,i,s,n,r){return Qi(e,i),isNaN(s)||0===s||(xs(t,n,i,r),e.scale=i.scale*s,ks(t,t,e,r),_s(e,e,ve(t,t[0]-n[0],n[1]-t[1]))),e}}();function ys(t,e,i){return Qi(t,e),t.scale=i,t}const gs=function(){const t=Oe();return function(e,i,s,n,r,o){return Qi(e,i),isNaN(s)||0===s||(xs(t,r,i,o),e.scale=i.scale*s,e.rotation+=n,ks(t,t,e,o),_s(e,e,ve(t,t[0]-r[0],r[1]-t[1]))),e}}(),bs=function(){const t=Oe(),e=Oe();return function(i,s,n,r,o,a,h){return is(e,a,h),xe(t,o,e),r?gs(i,s,n,r,t,a):ws(i,s,n,t,a)}}(),xs=function(){const t=le();return function(e,i,s,n){return we(e,i,function(t,e,i){return as(t,e,i,1),ae(t,t)}(t,s,n))}}(),ks=function(){const t=le();return function(e,i,s,n){return we(e,i,as(t,s,n,1))}}(),_s=function(){const t=Oe(),e=le();return function(i,s,n){Qi(i,s);const r=ns(s),o=i.targetGeometry;return ee(e,rs(s)),ie(e,e,Ce(r,r)),we(t,n,e),o.x+=t[0],o.y+=t[1],i}}();function Ms(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function Ts(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Ps(t,e,i,s,n,r,o,a,h){const l=new Float32Array(9);return l[0]=t,l[1]=e,l[2]=i,l[3]=s,l[4]=n,l[5]=r,l[6]=o,l[7]=a,l[8]=h,l}function Is(t){return function(t){return t instanceof Float32Array&&t.length>=2}(t)||function(t){return Array.isArray(t)&&t.length>=2}(t)}var Os;Object.freeze({__proto__:null,create:Ms,clone:Ts,fromValues:Ps,createView:function(t,e){return new Float32Array(t,e,9)}});const Cs=[0,0];let Vs=Os=class extends i{constructor(t){super(t),this._viewpoint2D={center:Oe(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new B,this.id=0,this.inverseTransform=le(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=le(),this.transformNoRotation=le(),this.displayMat3=Ms(),this.displayViewMat3=Ms(),this.viewMat3=Ms(),this.viewMat2d=he(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,i=t.targetGeometry;e.center[0]=i.x,e.center[1]=i.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=i.spatialReference}this._update()}copy(t){const e=this.size,i=this.viewpoint;return i&&e?(this.viewpoint=Qi(i,t.viewpoint),this._set("size",me(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new Os({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,i){return Is(e)?we(t,e,this.inverseTransform):(Cs[0]=e,Cs[1]=i,we(t,Cs,this.inverseTransform))}toScreen(t,e,i){return Is(e)?we(t,e,this.transform):(Cs[0]=e,Cs[1]=i,we(t,Cs,this.transform))}toScreenNoRotation(t,e,i){return Is(e)?we(t,e,this.transformNoRotation):(Cs[0]=e,Cs[1]=i,we(t,Cs,this.transformNoRotation))}getScreenTransform(t,e){const{center:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size");return os(t,i,n,e,0,s),t}_update(){const{center:t,spatialReference:e,scale:i,rotation:s}=this._viewpoint2D,n=this._get("pixelRatio")||1,r=this._get("size"),o=new Qt({targetGeometry:new Y(t[0],t[1],e),scale:i,rotation:s});if(this._set("viewpoint",o),!r||!e||!i)return;this.resolution=ns(o),this.rotation=s,this.scale=i,this.spatialReference=e,me(this.center,t),ue(this.displayMat3,0!==r[0]?2/r[0]:0,0,0,0,0!==r[1]?-2/r[1]:0,0,-1,1,1);const a=ce(this.viewMat3),h=Ie(r[0]/2,r[1]/2),l=Ie(-r[0]/2,-r[1]/2),u=Xt(s);de(a,a,h),pe(a,a,u),de(a,a,l),fe(this.displayViewMat3,this.displayMat3,a);const c=se(this.viewMat2d);return ne(c,c,h),re(c,c,u),ne(c,c,l),ts(this.extent,o,r),as(this.transform,o,r,n),ae(this.inverseTransform,this.transform),hs(this.transformNoRotation,o,r,n),this.worldScreenWidth=function(t,e){return Math.round(ls(t)/e)}(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};t([u({readOnly:!0})],Vs.prototype,"id",void 0),t([u({value:1,json:{write:!0}})],Vs.prototype,"pixelRatio",null),t([u({json:{write:!0}})],Vs.prototype,"size",null),t([u({type:Qt,json:{write:!0}})],Vs.prototype,"viewpoint",null),Vs=Os=t([e("esri.views.2d.ViewState")],Vs);const Ds=Vs;function Ss(t,e){switch(e){case"primary":return"touch"===t.pointerType||0===t.button;case"secondary":return"touch"!==t.pointerType&&2===t.button;case"tertiary":return"touch"!==t.pointerType&&1===t.button}}function As(t,e){if("touch"===t.pointerType)return!1;switch(e){case"primary":return 0===t.button;case"secondary":return 2===t.button;case"tertiary":return 1===t.button}}class Ns{constructor(t){this.callbacks=t,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(t){const e=t.data,i=e.pointers.size;switch(e.action){case"start":this.currentCount=i,this.emitStart(t);break;case"added":this.emitEnd(this.previousEvent),this.currentCount=i,this.emitStart(t);break;case"update":this.emitUpdate(t);break;case"removed":this.startEvent&&this.emitEnd(this.previousEvent),this.currentCount=i,this.emitStart(t);break;case"end":this.emitEnd(t),this.currentCount=0}this.previousEvent=t}emitStart(t){this.startEvent=t,this.callbacks.condition(this.currentCount,t)&&this.callbacks.start(this.currentCount,t,this.startEvent)}emitUpdate(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.update(this.currentCount,t,this.startEvent)}emitEnd(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.end(this.currentCount,t,this.startEvent),this.startEvent=null}}function Rs(t){let e=t*t;return t<0&&(e*=-1),e}function Ls(t){return t.translation[0]=0,t.translation[1]=0,t.translation[2]=0,t.heading=0,t.tilt=0,t}function Es(t,e,i){const s=i,n=t.state,r=t.device,o="forward-down"===e.tiltDirection?1:-1;return"standard"===r.deviceType?(s.translation[0]=Rs(n.axes[0]),s.translation[1]=Rs(n.axes[1]),s.translation[2]=Rs(n.buttons[7])-Rs(n.buttons[6]),s.heading=Rs(n.axes[2]),s.tilt=Rs(n.axes[3])):"spacemouse"===r.deviceType&&(s.translation[0]=1.2*Rs(n.axes[0]),s.translation[1]=1.2*Rs(n.axes[1]),s.translation[2]=2*-Rs(n.axes[2]),s.heading=1.2*Rs(n.axes[5]),s.tilt=1.2*Rs(n.axes[3])),s.tilt*=o,Kt(s.translation,s.translation,1),s}function js(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function Fs(t){return 0===t.translation[0]&&0===t.translation[1]&&0===t.translation[2]&&0===t.heading&&0===t.tilt&&0===t.zoom}function zs(t){const e=t.native;return e?{buttons:e.buttons.map((t=>t.pressed?t.value?t.value:1:0)),axes:e.axes.map((e=>function(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}(e,t.axisThreshold)))}:{buttons:[],axes:[]}}class Gs{constructor(t,e){this.element=t,this.input=e,this._hasEventListeners=!1,this.onConnectGamepad=t=>{this.connectGamepad(t.gamepad)},this.onDisconnectGamepad=t=>{const e=t.gamepad,i=e.index,s=this.inputDevices[i];s&&(this.emitGamepadEvent(e,zs(s),!1),this.inputDevices.splice(i,1),this.latestUpdate.splice(i,1),this.input.gamepad.devices.remove(s),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this.forEachGamepad((t=>this.connectGamepad(t))),window.addEventListener("gamepadconnected",this.onConnectGamepad),window.addEventListener("gamepaddisconnected",this.onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this.onConnectGamepad),window.removeEventListener("gamepaddisconnected",this.onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this.callback=t}connectGamepad(t){const e=new Mi(t);"unknown"!==e.deviceType&&(this.inputDevices[t.index]=e,this.input.gamepad.devices.add(e)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this.startPolling():this.stopPolling()}startPolling(){null==this.frameTask&&(this.frameTask=et({update:()=>this.readGamepadState()}))}stopPolling(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}readGamepadState(){const t=document.hasFocus(),e=this.element.contains(document.activeElement),i="document"===this.input.gamepad.enabledFocusMode&&!t||"view"===this.input.gamepad.enabledFocusMode&&!e;this.forEachGamepad((t=>{const e=this.inputDevices[t.index];if(!e)return;const s=this.latestUpdate[t.index],n=zs(e),r=i||function(t){for(let e=0;e<t.axes.length;e++)if(0!==t.axes[e])return!1;for(let e=0;e<t.buttons.length;e++)if(0!==t.buttons[e])return!1;return!0}(n);if(s){if(s.timestamp===t.timestamp)return;if(!s.active&&r)return;if(function(t,e){if(t.axes.length!==e.axes.length)return!1;if(t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}(s.state,n))return}this.emitGamepadEvent(t,n,!r)}))}forEachGamepad(t){const e=window.navigator.getGamepads();for(let i=0;i<e.length;i++){const s=e[i];this.validate(s)&&t(s)}}emitGamepadEvent(t,e,i){const s=this.latestUpdate[t.index],n=s&&s.active;if(!n&&!i)return;const r=!n&&i?"start":n&&i?"update":"end";this.latestUpdate[t.index]={timestamp:t.timestamp,state:e,active:i},this.callback&&this.callback({device:this.inputDevices[t.index],state:e,action:r})}validate(t){if(!t)return!1;if(!t.connected)return!1;for(let e=0;e<t.axes.length;e++)if(isNaN(t.axes[e]))return!1;return!0}}const $s=it("trident"),qs=it("edge"),Bs=it("chrome"),Ws=it("ff"),Us=it("safari"),Zs="esri-view-surface--touch-none",Hs="esri-view-surface--touch-pan";class Ks{constructor(t,e){this.input=e,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Gs(t,this.input),this._gamepadSource.onEvent=t=>this._callback("gamepad",t)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach((t=>{this._releasePointerCaptureSafe(t)})),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const e in this._active)t&&t.has(e)||(this._element.removeEventListener(Js[e],this._active[e]),delete this._active[e]);t&&t.forEach((t=>{if(!this._active[t]&&Js[t]){const e=(this._eventHandlers[t]||this._handleDefault).bind(this,t);this._element.addEventListener(Js[t],e),this._active[t]=e}})),this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}setPointerCapture(t,e){e?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Zs:Hs),this._element.classList.add(this._browserTouchPanningEnabled?Hs:Zs)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Zs),this._element.classList.remove(Hs),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch(t){}}_updateNormalizedPointerLikeEvent(t,e){const i=Wt(this._element,t);return Ks.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),e.x=i.x,e.y=i.y,e}_handleKey(t,e){const i=Ut(e);i&&"key-up"===t&&this._keyDownState.delete(i);const s={native:e,key:i,repeat:i&&this._keyDownState.has(i)};i&&"key-down"===t&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,e){const i=this._updateNormalizedPointerLikeEvent(e,{native:e,x:0,y:0,pointerType:e.pointerType,button:e.button,buttons:e.buttons,eventId:this._eventId++});this._callback(t,i)}_handlePointerPreventDefault(t,e){const i=this._updateNormalizedPointerLikeEvent(e,{native:e,x:0,y:0,pointerType:e.pointerType,button:e.button,buttons:e.buttons,eventId:this._eventId++});e.preventDefault(),this._callback(t,i)}_handleMouseWheel(t,e){let i=e.deltaY;switch(e.deltaMode){case 0:($s||qs)&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}$s||qs?i*=.7:Bs||Us?i*=.6:Ws&&(i*=1.375);const s=Math.abs(i);s>100&&(i=i/s*200/(1+Math.exp(-.02*(s-100))));const n=this._updateNormalizedPointerLikeEvent(e,{native:e,x:0,y:0,deltaY:i});this._callback(t,n)}_handlePointerCaptureLost(t,e){this._activePointerCaptures.delete(e.pointerId),this._handleDefault(t,e)}_handleDefault(t,e){const i={native:e};e.preventDefault(),this._callback(t,i)}_preventAltKeyDefault(t){"Alt"===t.key&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}Ks.test={disableSubpixelCoordinates:!1};const Js={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class Ys extends $t{constructor(){super(!0),this.registerIncoming("context-menu",(t=>{t.data.native.preventDefault()}))}}function Qs(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}const Xs={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class tn extends $t{constructor(t=Xs.maximumDoubleClickDelay,e=Xs.maximumDoubleClickDistance,i=Xs.maximumDoubleTouchDelay,s=Xs.maximumDoubleTouchDistance,n=st){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=e,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach((t=>{null!=t.doubleClickTimeout&&(t.doubleClickTimeout.remove(),t.doubleClickTimeout=null)}))}get hasPendingInputs(){return I(this._pointerState,(t=>null!=t.doubleClickTimeout))}_pointerId(t){const e=t.native;return"mouse"===e.pointerType?`${e.pointerId}:${e.button}`:`${e.pointerType}`}_handleImmediateClick(t){const e=t.data,i=this._pointerId(e),s=this._pointerState.get(i);if(s){const n="touch"===e.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;Qs(s.event.data,e)>n?(this._clearDoubleClickTimeout(i,!0),this._startClick(t)):(this._clearDoubleClickTimeout(i,!1),this._doubleClick.emit(s.event.data,void 0,s.event.modifiers))}else this._startClick(t)}_startClick(t){const e=this._pointerId(t.data);this._pointerState.set(e,{event:t,doubleClickTimeout:this._clock.setTimeout((()=>this._doubleClickTimeoutExceeded(e)),"touch"===t.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}),this.refreshHasPendingInputs()}_handlePointerDrag(t){const e=this._pointerId(t.data.currentEvent);this._clearDoubleClickTimeout(e,!0)}_handleDrag(t){const e=this._pointerId(t.data.pointer);this._clearDoubleClickTimeout(e,!0)}_clearDoubleClickTimeout(t,e){const i=this._pointerState.get(t);i&&(i.doubleClickTimeout.remove(),i.doubleClickTimeout=null,e&&this._doubleClickTimeoutExceeded(t),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const e=this._pointerState.get(t);this._click.emit(e.event.data,void 0,e.event.modifiers),e.doubleClickTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}}class en extends $t{constructor(t){super(!1),this.navigationTouch=t,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this.handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this.handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this.handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this.handlePointerUpAndPointerLost.bind(this))}createPayload(t,e,i,s){return{action:t,pointerType:this.pointerType,button:this.mouseButton,buttons:e.buttons,timestamp:s,pointers:rn(this.activePointerMap),pointer:e,angle:i.angle,radius:i.radius,center:i.center}}addPointer(t){const e=t.native.pointerId,i=nn(this.activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this.activePointerMap.set(e,s);const n=on(s,sn(this.activePointerMap));s.initialAngle=n,s.lastAngle=n,this.updatePointerAngles(i)}updatePointer(t){if(t&&null==t.x&&null==t.y)return;const e=this.activePointerMap.get(t.native.pointerId);e?e.event=t:this.addPointer(t)}removePointer(t){const e=nn(this.activePointerMap).angle;this.activePointerMap.delete(t),this.updatePointerAngles(e)}updatePointerAngles(t){const e=nn(this.activePointerMap);this.activePointerMap.forEach((i=>{i.initialAngle=on(i,e)-t,i.lastAngle=on(i,e)-t}))}emitEvent(t,e,i){const s=nn(this.activePointerMap);this.drag.emit(this.createPayload(t,e,s,i),void 0,this.startStateModifiers)}handlePointerUpAndPointerLost(t){const e=t.data.native.pointerId,i=nt(t.timestamp);this.activePointerMap.get(e)&&(1===this.activePointerMap.size?(this.updatePointer(t.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",t.data,i),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.removePointer(e)):(this.removePointer(e),this.emitEvent("removed",t.data,nt(t.timestamp))))}handlePointerDrag(t){const e=t.data,i=e.currentEvent,s=nt(t.timestamp);switch(e.action){case"start":case"update":this.isDragging?this.activePointerMap.has(i.native.pointerId)?(this.updatePointer(i),!this.isCurrentDragSuppressed&&this.emitEvent("update",i,s)):(this.addPointer(i),this.emitEvent("added",i,s),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(i),this.pointerType=t.data.startEvent.pointerType,this.mouseButton=t.data.startEvent.button,this.startStateModifiers=t.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",i,s))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}function sn(t){const e=[];return t.forEach((t=>{e.push(Ft(t.event.x,t.event.y))})),function(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Ft()},0===t.length)return e;if(1===t.length)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(2===t.length){const[i,s]=t,[n,r]=[s.x-i.x,s.y-i.y];return e.radius=Math.sqrt(n*n+r*r)/2,e.center.x=(i.x+s.x)/2,e.center.y=(i.y+s.y)/2,e}let i=0,s=0;for(let e=0;e<t.length;e++)i+=t[e].x,s+=t[e].y;i/=t.length,s/=t.length;const n=t.map((t=>t.x-i)),r=t.map((t=>t.y-s));let o=0,a=0,h=0,l=0,u=0,c=0,d=0;for(let t=0;t<n.length;t++){const e=n[t],i=r[t],s=e*e,p=i*i;o+=s,a+=p,h+=e*i,l+=s*e,u+=p*i,c+=e*p,d+=i*s}const p=.5*(l+c),f=.5*(u+d),v=o*a-h*h,m=(p*a-f*h)/v,w=(o*f-h*p)/v,y=Ft(m+i,w+s);return{radius:Math.sqrt(m*m+w*w+(o+a)/t.length),center:y}}(e)}function nn(t){const e=sn(t);let i=0;return t.forEach((t=>{let s=on(t,e),n=s-t.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=t.lastAngle+n,t.lastAngle=s,i+=s-t.initialAngle})),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function rn(t){const e=new Map;return t.forEach(((t,i)=>e.set(i,t.event))),e}function on(t,e){const i=t.event;return Math.atan2(i.y-e.center.y,i.x-e.center.x)}var an;!function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"}(an||(an={}));class hn extends $t{constructor(t=Xs.maximumDoubleClickDelay,e=Xs.maximumDoubleClickDistance,i=Xs.maximumDoubleTouchDelay,s=Xs.maximumDoubleTouchDistance,n=st){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=e,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(t=>{this._handlePointerLoss(t,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(t=>{this._handlePointerLoss(t,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(t=>{this._handlePointerLoss(t,"pointer-cancel")}))}onUninstall(){this._pointerState.forEach((t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()})),super.onUninstall()}_handlePointerDown(t){const e=t.data,i=this._pointerId(e);this._pointerState.has(i)||(this._pointerState.set(i,{downButton:e.native.button,immediateDoubleClick:null}),this.startCapturingPointer(e.native))}_handlePointerLoss(t,e){const i=t.data,s=this._pointerId(i),n=this._pointerState.get(s);if(n&&"pointer-up"===e&&n.downButton===i.native.button){const e=n.immediateDoubleClick;if(e){e.timeoutHandle.remove();const s="touch"===t.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;Qs(e,t.data)>s?this._startImmediateDoubleClick(t,n):(this._immediateDoubleClick.emit(t.data,void 0,e.modifiers),this._removeState(i))}else this._startImmediateDoubleClick(t,n)}}_startImmediateDoubleClick(t,e){e.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout((()=>this._removeState(t.data)),"touch"===t.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}}_pointerId(t){const e=t.native;return"mouse"===e.pointerType?`${e.pointerId}:${e.button}`:`${e.pointerType}`}_removeState(t){const e=this._pointerId(t);this._pointerState.delete(e),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}class ln extends $t{constructor(t=300,e=1.5,i=6,s=6,n=500,r=st){super(!1),this.maximumClickDelay=t,this.movementUntilMouseDrag=e,this.movementUntilPenDrag=i,this.movementUntilTouchDrag=s,this.holdDelay=n,this._clock=r,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(t=>{this._handlePointerLoss(t,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(t=>{this._handlePointerLoss(t,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(t=>{this._handlePointerLoss(t,"pointer-cancel")})),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach((t=>{null!=t.holdTimeout&&(t.holdTimeout.remove(),t.holdTimeout=null)})),super.onUninstall()}_handlePointerDown(t){const e=t.data,i=e.native.pointerId;let s=null;0===this._pointerState.size&&(s=this._clock.setTimeout((()=>{const e=this._pointerState.get(i);e&&(e.isDragging||(this._pointerHold.emit(e.previousEvent,void 0,t.modifiers),e.holdEmitted=!0),e.holdTimeout=null)}),this.holdDelay));const n={startEvent:e,previousEvent:e,startTimestamp:t.timestamp,isDragging:!1,downButton:e.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(e.native),this._moveHandle.resume(),this._pointerState.size>1&&this.startDragging(t)}_createPointerDragData(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}_handlePointerMove(t){const e=t.data,i=this._pointerState.get(e.native.pointerId);i&&(i.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",i,e),void 0,i.modifiers):function(t,e){const i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)}(e,i.startEvent)>this._getDragThreshold(e.native.pointerType)&&this.startDragging(t),i.previousEvent=e)}_getDragThreshold(t){switch(t){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}startDragging(t){const e=t.data,i=e.native.pointerId;this._pointerState.forEach((s=>{null!=s.holdTimeout&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,e)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))}))}_handlePointerLoss(t,e){const i=t.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(null!=n.holdTimeout&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,"pointer-up"===e?i:n.previousEvent),void 0,n.modifiers):"pointer-up"===e&&n.downButton===i.native.button&&t.timestamp-n.startTimestamp<=this.maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),0===this._pointerState.size&&this._moveHandle.pause())}}const un={checkMajorWebPerformanceCaveat:!0};function cn(t){t={...un,...t};const e=De();return e.available?t.checkMajorWebPerformanceCaveat&&e.majorPerformanceCaveat?new o("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?e.supportsElementIndexUint?e.supportsStandardDerivatives?e.supportsInstancedArrays?null:new o("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new o("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new o("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new o("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new o("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new o("webgl:required","WebGL is required but not supported.")}let dn=class extends v{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(t){const e=this._get("node");t!==e&&(t&&t.classList.add("esri-component"),e&&e.classList.remove("esri-component"),this._set("node",t))}castNode(t){return t?"string"==typeof t||function(t){return t&&"nodeType"in t}(t)?(this._set("widget",null),rt(t)):(function(t){return t&&"function"==typeof t.render}(t)&&!t.domNode&&(t.domNode=document.createElement("div")),this._set("widget",t),t.domNode):(this._set("widget",null),null)}};t([u({dependsOn:[]})],dn.prototype,"id",null),t([u()],dn.prototype,"node",null),t([w("node")],dn.prototype,"castNode",null),t([u({readOnly:!0})],dn.prototype,"widget",void 0),dn=t([e("esri.views.ui.Component")],dn);const pn=dn,fn={left:0,top:0,bottom:0,right:0},vn={bottom:30,top:15,right:15,left:15},mn="manual",wn="esri-ui-corner";function yn(t){const e=t,i="object"==typeof e&&null!==e&&Object.getPrototypeOf(e);return null!==i&&i!==Object.prototype||!("component"in e||"index"in e||"position"in e)?null:t}function gn(t,{top:e,bottom:i,left:s,right:n}){t.style.top=e,t.style.bottom=i,t.style.left=s,t.style.right=n}let bn=class extends f.EventedAccessor{constructor(t){super(t),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new y,this.view=null,this._initContainers()}initialize(){this._handles.add([g(this,"view.padding, container",this._applyViewPadding.bind(this)),g(this,"padding",this._applyUIPadding.bind(this))])}destroy(){this.container=null;for(const t of this._components)t.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(t){const e=this._get("container");t!==e&&(t&&(t.classList.add("esri-ui"),t.classList.add(ot()),this._attachContainers(t)),e&&(e.classList.remove("esri-ui"),gn(e,{top:"",bottom:"",left:"",right:""}),at(e)),this._set("container",t))}get height(){const t=this.get("view.height")||0;if(0===t)return t;const e=this._getViewPadding();return Math.max(t-(e.top+e.bottom),0)}get padding(){return this._get("padding")}set padding(t){t?this._override("padding",t):this._clearOverride("padding")}castPadding(t){return"number"==typeof t?{bottom:t,top:t,right:t,left:t}:{...vn,...t}}get width(){const t=this.get("view.width")||0;if(0===t)return t;const e=this._getViewPadding();return Math.max(t-(e.left+e.right),0)}add(t,e){let i,s;if(Array.isArray(t))return void t.forEach((t=>this.add(t,e)));const n=yn(t);n&&({index:i,position:e,component:t,key:s}=n),e&&"object"==typeof e&&({index:i,key:s,position:e}=e),!t||e&&!this._isValidPosition(e)||this._add(t,e,i,s)}remove(t,e){if(!t)return;if(Array.isArray(t))return t.map((t=>this.remove(t,e)));const i=this._find(t);if(i){const s=this._componentToKey;if(s.has(t)&&s.get(t)!==e)return;const n=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(t),this._components.splice(n,1)[0]}}empty(t){return Array.isArray(t)?t.map((t=>this.empty(t))).reduce(((t,e)=>t.concat(e))):(t=t||mn)===mn?Array.prototype.slice.call(this._manualContainer.children).filter((t=>!t.classList.contains(wn))).map((t=>this.remove(t))):this._isValidPosition(t)?Array.prototype.slice.call(this._cornerNameToContainerLookup[t].children).map(this.remove,this):null}move(t,e){if(Array.isArray(t)&&t.forEach((t=>this.move(t,e))),!t)return;let i;const s=yn(t)||yn(e);if(s&&(i=s.index,e=s.position,t=s.component||t),e&&!this._isValidPosition(e))return;const n=this.remove(t);n&&this.add(n,{position:e,index:i})}find(t){if(!t)return null;const e=this._findById(t);return e&&(e.widget||e.node)}getPosition(t){for(const e in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[e].contains(t))return e;return null}_add(t,e,i,s){t instanceof pn||(t=new pn({node:t})),this._place({component:t,position:e,index:i}),this._components.push(t),s&&this._componentToKey.set(t,s)}_find(t){return t?t instanceof pn?this._findByComponent(t):"string"==typeof t?this._findById(t):this._findByNode(t.domNode||t):null}_getViewPadding(){return this.get("view.padding")||fn}_attachContainers(t){t.appendChild(this._innerContainer),t.appendChild(this._manualContainer)}_initContainers(){const t=document.createElement("div");t.classList.add("esri-ui-inner-container"),t.classList.add("esri-ui-corner-container");const e=document.createElement("div");e.classList.add("esri-ui-inner-container"),e.classList.add("esri-ui-manual-container");const i=document.createElement("div");i.classList.add("esri-ui-top-left"),i.classList.add(wn),t.appendChild(i);const s=document.createElement("div");s.classList.add("esri-ui-top-right"),s.classList.add(wn),t.appendChild(s);const n=document.createElement("div");n.classList.add("esri-ui-bottom-left"),n.classList.add(wn),t.appendChild(n);const r=document.createElement("div");r.classList.add("esri-ui-bottom-right"),r.classList.add(wn),t.appendChild(r),this._innerContainer=t,this._manualContainer=e;const o=ht();this._cornerNameToContainerLookup={"top-left":i,"top-right":s,"bottom-left":n,"bottom-right":r,"top-leading":o?s:i,"top-trailing":o?i:s,"bottom-leading":o?r:n,"bottom-trailing":o?n:r},this._positionNameToContainerLookup={manual:e,...this._cornerNameToContainerLookup}}_isValidPosition(t){return!!this._positionNameToContainerLookup[t]}_place(t){const e=t.component,i=t.index,s=this._positionNameToContainerLookup[t.position||mn],n=i>-1;if(function(t){return t&&!t._started&&"function"==typeof t.postMixInProperties&&"function"==typeof t.buildRendering&&"function"==typeof t.postCreate&&"function"==typeof t.startup}(e.widget)&&e.widget.startup(),!n)return void s.appendChild(e.node);const r=Array.prototype.slice.call(s.children);0!==i?i>=r.length?s.appendChild(e.node):lt(e.node,r[i]):s.firstChild?lt(e.node,s.firstChild):s.appendChild(e.node)}_applyViewPadding(){const t=this.container;t&&gn(t,this._toPxPosition(this._getViewPadding()))}_applyUIPadding(){const t=this._innerContainer;t&&gn(t,this._toPxPosition(this.padding))}_toPxPosition(t){return{top:this._toPxUnit(t.top),left:this._toPxUnit(t.left),right:this._toPxUnit(t.right),bottom:this._toPxUnit(t.bottom)}}_toPxUnit(t){return 0===t?"0":t+"px"}_findByComponent(t){let e,i=null;return this._components.some((s=>(e=s===t,e&&(i=s),e))),i}_findById(t){let e,i=null;return this._components.some((s=>(e=s.id===t,e&&(i=s),e))),i}_findByNode(t){let e,i=null;return this._components.some((s=>(e=s.node===t,e&&(i=s),e))),i}};t([u()],bn.prototype,"container",null),t([u()],bn.prototype,"height",null),t([u({value:vn})],bn.prototype,"padding",null),t([w("padding")],bn.prototype,"castPadding",null),t([u()],bn.prototype,"view",void 0),t([u()],bn.prototype,"width",null),bn=t([e("esri.views.ui.UI")],bn);const xn=bn;function kn(t,e){return t&&"copyright"in t&&(!e||"function"==typeof t.originOf&&"user"===t.originOf("copyright"))}function _n(t,e,i){i&&e&&(t.find((t=>t.layerView===e&&t.text===i))||t.push({text:i,layerView:e}))}const Mn=[];let Tn=class extends At{constructor(t){super(t),this.clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new r,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const e=this.get("view.allLayerViews");e&&this.handles.add(e.map((t=>t.watch(["suspended","attributionVisible"],this._updateAttributionItems))),"suspension"),t&&t.removed&&t.removed.forEach((t=>{this._pendingAttributions.delete(t),this._fetchedAttributionData.delete(t)})),this._updateAttributionItems()},this._updateAttributionItems=()=>{const t=this.get("view.allLayerViews");Mn.length=0,t?(t.forEach((t=>{if(t.suspended||!t.get("layer.attributionVisible"))return;const e=t.layer;if(kn(e,"user"))return void _n(Mn,t,e.copyright);if(e.hasAttributionData){if(this._fetchedAttributionData.has(t)){const i=this._fetchedAttributionData.get(t);return void(i?_n(Mn,t,this._getDynamicAttribution(i,this.view,e)):kn(e)&&_n(Mn,t,e.copyright))}return void this._fetchAttributionData(t)}const i=e.get("portalItem.accessInformation");_n(Mn,t,i||e.copyright)})),function(t,e){return t.length!==e.length||t.some(((t,i)=>t.text!==e[i].text))}(this.items,Mn)&&(this.items.removeAll(),this.items.addMany(Mn)),Mn.length=0,this.notifyChange("state")):this.clear()},this.handles.add([P(this,"view.allLayerViews","change",this._allLayerViewsChange,this._allLayerViewsChange,this.clear),ut(this,"view.stationary",(()=>this._updateAttributionItems()))])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const e=await Se(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const i=e.ok?this._createContributionIndex(e.value,function(t){return"bing-maps"===t.type}(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,i)}this._updateAttributionItems()}_createContributionIndex(t,e){const i=t.contributors,s={};if(!i)return s;for(let t=0;t<i.length;t++){const n=i[t],r=n.coverageAreas;if(!r)return;for(const i of r){const r=i.bbox,o=i.zoomMin-(e&&i.zoomMin?1:0),a=i.zoomMax-(e&&i.zoomMax?1:0),h={extent:ct({xmin:r[1],ymin:r[0],xmax:r[3],ymax:r[2],spatialReference:W.WGS84}),attribution:n.attribution||"",score:null!=i.score?i.score:100,id:t};for(let t=o;t<=a;t++)s[t]=s[t]||[],s[t].push(h)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(t,e,i){const{extent:s,scale:n}=e;let r=i.tileInfo.scaleToZoom(n);if(r=Math.min(t.maxKey,Math.round(r)),!s||null==r||r<=-1)return"";const o=t[r],a=j(s.center.clone().normalize(),e.spatialReference),h={};return o?o.filter((t=>{const e=!h[t.id]&&a&&dt(t.extent,a);return e&&(h[t.id]=!0),e})).sort(((t,e)=>e.score-t.score||t.objectId-e.objectId)).map((t=>t.attribution)).join(", "):""}};t([u({readOnly:!0,type:r})],Tn.prototype,"items",void 0),t([u({readOnly:!0})],Tn.prototype,"state",null),t([u()],Tn.prototype,"view",void 0),Tn=t([e("esri.widgets.Attribution.AttributionViewModel")],Tn);const Pn=Tn;let In=class extends ft{constructor(t,e){super(t,e),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this.iconClass="esri-icon-description",this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new Pn}initialize(){this.own(P(this,"viewModel.items","change",(()=>this.scheduleRender())))}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce(((t,e)=>(-1===t.indexOf(e.text)&&t.push(e.text),t)),[]).join(this.itemDelimiter)}render(){return vt("div",{bind:this,class:this.classes("esri-attribution esri-widget",{"esri-attribution--open":this._isOpen}),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return vt("div",{class:"esri-attribution__powered-by"},"Powered by"," ",vt("a",{class:"esri-attribution__link",href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const t=this._isOpen,e=this._isInteractive,i=e?0:-1,{attributionText:s}=this,n=e?"button":void 0;return vt("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",{"esri-attribution__sources--open":t,"esri-interactive":e}),innerHTML:s,role:n,tabIndex:i})}_afterSourcesNodeCreate(t){this._prevSourceNodeHeight=t.clientWidth}_afterSourcesNodeUpdate(t){let e=!1;const{clientHeight:i,clientWidth:s,scrollWidth:n}=t,r=n>=s,o=this._attributionTextOverflowed!==r;if(this._attributionTextOverflowed=r,o&&(e=!0),this._isOpen){const t=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,t&&(this._isOpen=!1,e=!0)}e&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};t([u()],In.prototype,"_isOpen",void 0),t([u()],In.prototype,"_isInteractive",null),t([u()],In.prototype,"_attributionTextOverflowed",void 0),t([u()],In.prototype,"_prevSourceNodeHeight",void 0),t([u({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],In.prototype,"attributionText",null),t([u()],In.prototype,"iconClass",void 0),t([u()],In.prototype,"itemDelimiter",void 0),t([u({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],In.prototype,"label",void 0),t([u(),pt("esri/widgets/Attribution/t9n/Attribution")],In.prototype,"messages",void 0),t([q("viewModel.view")],In.prototype,"view",void 0),t([u({type:Pn})],In.prototype,"viewModel",void 0),t([Ae()],In.prototype,"_toggleState",null),In=t([e("esri.widgets.Attribution")],In);const On=In;let Cn=class extends(Ne(v)){constructor(t){super(t),this._handles=new y,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(g(this,"view",this._updateRotationWatcher))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get canShowNorth(){const t=this.get("view.spatialReference");return!(!t||!t.isWebMercator&&!t.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const t={};"2d"===this.view.type?t.rotation=0:t.heading=0,this.callGoTo({target:t})}_updateForRotation(t){null!=t&&(this.orientation={z:t})}_updateForCamera(t){t&&(this.orientation={x:0,y:0,z:-t.heading})}_updateRotationWatcher(t){this._handles.removeAll(),t&&this._handles.add("2d"===t.type?g(this,"view.rotation",this._updateForRotation):g(this,"view.camera",this._updateForCamera))}};t([u({readOnly:!0})],Cn.prototype,"canShowNorth",null),t([u()],Cn.prototype,"orientation",void 0),t([u({readOnly:!0})],Cn.prototype,"state",null),t([u()],Cn.prototype,"view",void 0),Cn=t([e("esri.widgets.CompassViewModel")],Cn);const Vn=Cn;let Dn=class extends ft{constructor(t,e){super(t,e),this.goToOverride=null,this.iconClass="esri-icon-locate-circled",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new Vn}reset(){return this.viewModel.reset()}render(){const{orientation:t,state:e}=this.viewModel,i="disabled"===e,s="compass"==("rotation"===e?"rotation":"compass"),n=i?-1:0,r={"esri-disabled":i,"esri-interactive":!i},o={"esri-icon-compass":s,"esri-icon-dial":!s},{messages:a}=this;return vt("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",r),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:n,"aria-label":a.reset,title:a.reset},vt("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",o),styles:this._toRotationTransform(t)}),vt("span",{class:"esri-icon-font-fallback-text"},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(t){return{transform:`rotateZ(${t.z}deg)`}}};t([q("viewModel.goToOverride")],Dn.prototype,"goToOverride",void 0),t([u()],Dn.prototype,"iconClass",void 0),t([u({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Dn.prototype,"label",void 0),t([u(),pt("esri/widgets/Compass/t9n/Compass")],Dn.prototype,"messages",void 0),t([q("viewModel.view")],Dn.prototype,"view",void 0),t([u({type:Vn})],Dn.prototype,"viewModel",void 0),t([Ae()],Dn.prototype,"_reset",null),Dn=t([e("esri.widgets.Compass")],Dn);const Sn=Dn;let An=class extends v{constructor(t){super(t),this._handles=new y,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(R(this,"view.inputManager",this._setNavigationMode.bind(this)))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"}};t([u({readOnly:!0})],An.prototype,"state",null),t([u()],An.prototype,"navigationMode",void 0),t([u()],An.prototype,"view",void 0),An=t([e("esri.widgets.NavigationToggleViewModel")],An);const Nn=An,Rn="esri-navigation-toggle__button esri-widget--button";let Ln=class extends ft{constructor(t,e){super(t,e),this.iconClass="esri-icon-pan2",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new Nn}set layout(t){"horizontal"!==t&&(t="vertical"),this._set("layout",t)}toggle(){return this.viewModel.toggle()}render(){const t="disabled"===this.get("viewModel.state"),e="pan"===this.get("viewModel.navigationMode"),i={"esri-navigation-toggle__button--active":e},s={"esri-navigation-toggle__button--active":!e},n=t?-1:0,r=this.messages.toggle;return vt("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",{"esri-disabled":t,"esri-navigation-toggle--horizontal":"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":r,title:r},vt("div",{class:this.classes(Rn,"esri-navigation-toggle__button--pan",i)},vt("span",{class:"esri-icon-pan"})),vt("div",{class:this.classes(Rn,"esri-navigation-toggle__button--rotate",s)},vt("span",{class:"esri-icon-rotate"})))}_toggle(){this.toggle()}};t([u()],Ln.prototype,"iconClass",void 0),t([u({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ln.prototype,"label",void 0),t([u({value:"vertical"})],Ln.prototype,"layout",null),t([u(),pt("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Ln.prototype,"messages",void 0),t([q("viewModel.view")],Ln.prototype,"view",void 0),t([u({type:Nn})],Ln.prototype,"viewModel",void 0),t([Ae()],Ln.prototype,"_toggle",null),Ln=t([e("esri.widgets.NavigationToggle")],Ln);const En=Ln;let jn=class extends ft{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const t=this.enabled?0:-1,e={[this.iconClass]:!!this.iconClass};return vt("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{"esri-disabled":!this.enabled,"esri-interactive":this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:t,title:this.title},vt("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",e)}),vt("span",{class:"esri-icon-font-fallback-text"},this.title))}_triggerAction(){this.action.call(this)}};t([u()],jn.prototype,"action",void 0),t([u()],jn.prototype,"enabled",void 0),t([u()],jn.prototype,"iconClass",void 0),t([u()],jn.prototype,"title",void 0),t([Ae()],jn.prototype,"_triggerAction",null),jn=t([e("esri.widgets.IconButton")],jn);const Fn=jn;let zn=class extends v{get canZoomIn(){if(!this.get("view.ready"))return!1;const t=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMaxScale");return 0===e||t>e}get canZoomOut(){if(!this.get("view.ready"))return!1;const t=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMinScale");return 0===e||t<e}};t([u({readOnly:!0})],zn.prototype,"canZoomIn",null),t([u({readOnly:!0})],zn.prototype,"canZoomOut",null),t([u()],zn.prototype,"view",void 0),zn=t([e("esri.widgets.Zoom.ZoomConditions2D")],zn);const Gn=zn;let $n=class extends v{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};t([u({readOnly:!0})],$n.prototype,"canZoomIn",null),t([u({readOnly:!0})],$n.prototype,"canZoomOut",null),t([u()],$n.prototype,"view",void 0),$n=t([e("esri.widgets.Zoom.ZoomConditions3D")],$n);const qn=$n;let Bn=class extends v{constructor(t){super(t),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(t){t?"2d"===t.type?this._zoomConditions=new Gn({view:t}):"3d"===t.type&&(this._zoomConditions=new qn({view:t})):this._zoomConditions=null,this._set("view",t)}zoomIn(){if(!this.canZoomIn)return;const t=this.view;"2d"===t.type?t.mapViewNavigation.zoomIn():mt(t.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const t=this.view;"2d"===t.type?t.mapViewNavigation.zoomOut():mt(t.goTo({zoomFactor:.5}))}};t([u()],Bn.prototype,"_zoomConditions",void 0),t([u({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],Bn.prototype,"canZoomIn",void 0),t([u({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],Bn.prototype,"canZoomOut",void 0),t([u({readOnly:!0})],Bn.prototype,"state",null),t([u()],Bn.prototype,"view",null),Bn=t([e("esri.widgets.Zoom.ZoomViewModel")],Bn);const Wn=Bn;let Un=class extends ft{constructor(t,e){super(t,e),this.iconClass="esri-icon-zoom-in-magnifying-glass",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new Wn}initialize(){this._zoomInButton=new Fn({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"}),this._zoomOutButton=new Fn({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(t){"horizontal"!==t&&(t="vertical"),this._set("layout",t)}render(){const t=this.viewModel,e={"esri-zoom--horizontal":"horizontal"===this.layout};return this._zoomInButton.enabled="ready"===t.state&&t.canZoomIn,this._zoomOutButton.enabled="ready"===t.state&&t.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,vt("div",{class:this.classes("esri-zoom esri-widget",e)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};t([u()],Un.prototype,"iconClass",void 0),t([u({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Un.prototype,"label",void 0),t([u({value:"vertical"})],Un.prototype,"layout",null),t([u(),pt("esri/widgets/Zoom/t9n/Zoom")],Un.prototype,"messages",void 0),t([q("viewModel.view")],Un.prototype,"view",void 0),t([u({type:Wn})],Un.prototype,"viewModel",void 0),Un=t([e("esri.widgets.Zoom")],Un);const Zn=Un,Hn="esri.views.ui.DefaultUI";s.getLogger(Hn);let Kn=class extends xn{constructor(t){super(t),this._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"},this.components=[]}initialize(){this._handles.add([g(this,"components",this._componentsWatcher.bind(this)),g(this,"view",this._updateViewAwareWidgets.bind(this))])}_add(t,e,i,s){if("string"==typeof t&&this._defaultPositionLookup[t]){if(this._find(t))return;t=this._createComponent(t)}super._add(t,e,i,s)}_removeComponents(t){t.forEach((t=>{const e=this._find(t);e&&(this.remove(e),e.destroy())}))}_updateViewAwareWidgets(t){this.components.forEach((e=>{const i=this._find(e),s=i&&i.widget;(function(t){return t&&void 0!==t.view})(s)&&(s.view=t)}))}_componentsWatcher(t,e){this._removeComponents(e),this._addComponents(t),this._adjustPadding(t)}_adjustPadding(t){if(-1===t.indexOf("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(t){this.initialized&&t.forEach((t=>this.add(this._createComponent(t),this._defaultPositionLookup[t])))}_createComponent(t){const e=this._createWidget(t);if(e)return new pn({id:t,node:e})}_createWidget(t){return"attribution"===t?this._createAttribution():"compass"===t?this._createCompass():"navigation-toggle"===t?this._createNavigationToggle():"zoom"===t?this._createZoom():void 0}_createAttribution(){return new On({view:this.view})}_createCompass(){return new Sn({view:this.view})}_createNavigationToggle(){return new En({view:this.view})}_createZoom(){return new Zn({view:this.view})}};t([u()],Kn.prototype,"components",void 0),Kn=t([e(Hn)],Kn);const Jn=Kn;export{Xi as $,Ge as A,ri as B,Ms as C,Ts as D,os as E,_s as F,fs as G,is as H,cs as I,Ji as J,bs as K,ls as L,vs as M,Ps as N,$i as P,ys as R,gs as S,Ds as U,Qi as Z,Ye as a,ds as b,Ss as c,Ns as d,Ls as e,Qs as f,hn as g,us as h,Es as i,Ue as j,ms as k,Xs as l,tn as m,Bi as n,ln as o,en as p,Ys as q,Jn as r,Fs as s,es as t,Ks as u,Je as v,ps as w,cn as x,As as y,js as z}