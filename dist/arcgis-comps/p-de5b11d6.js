import"./p-e58503d5.js";import{e as t}from"./p-2f398ed1.js";function n(n,e){const a=function(n,e){const{format:a,quality:i,rotation:r,disableDecorations:h}=n||{},o=s(n,e.padding),u=function(t,n){const e={x:0,y:0,width:n.width,height:n.height};if(t&&t.area){null!=t.area.x&&(e.x=Math.floor(t.area.x)),null!=t.area.y&&(e.y=Math.floor(t.area.y));const a=null!=t.area.width?Math.floor(t.area.width):null,i=null!=t.area.height?Math.floor(t.area.height):null;if(e.width=n.width-e.x,e.height=n.height-e.y,null!=a&&null!=i)e.width=Math.min(e.width,a),e.height=Math.min(e.height,i);else if(null==a&&null!=i){const t=Math.min(e.width,a);e.height=t/e.width*e.height,e.width=t}else if(null!=a&&null==i){const t=Math.min(e.height,i);e.width=t/e.height*e.width,e.height=t}}return function(t,n){const e=Math.floor(Math.max(t.x,0)),a=Math.floor(Math.max(t.y,0)),i={x:e,y:a,width:Math.floor(Math.min(t.width,n.width-e)),height:Math.floor(Math.min(t.height,n.height-a))},r=i.width/i.height,h=t.width/t.height;if(h===r)return i;if(h>r){const t=Math.floor(i.width/h);return{x:i.x,y:Math.floor(i.y+(i.height-t)/2),width:i.width,height:t}}const o=Math.floor(i.height*h);return{x:Math.floor(i.x+(i.width-o)/2),y:i.y,width:o,height:i.height}}(function(t,n){if(!n||null==n.width||null==n.height)return t;const e=n.width/n.height,a=t.width/t.height;if(a===e)return t;if(a<e){const n=Math.floor(t.height*e);return t.x-=(n-t.width)/2,t.width=n,t}const i=Math.floor(t.width/e);return t.y-=(i-t.height)/2,t.height=i,t}(e,t),n)}(n,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:c,height:f}=function(t,n){if(!t)return n;const e=t.width,a=t.height;if(null!=e&&null!=a)return{width:Math.floor(e),height:Math.floor(a)};if(null==e&&null==a)return n;const i=n.width/n.height;return null==a?{width:Math.floor(e),height:Math.floor(e/i)}:{width:Math.floor(a*i),height:Math.floor(a)}}(n,u),l=g(a);return{format:l,quality:t(null!=i?i:m[l],0,100),area:u,width:c,height:f,rotation:r,disableDecorations:!!h,ignoreBackground:!(!n||!n.ignoreBackground),ignorePadding:!(!n||!n.ignorePadding)}}(n,e),i=a.area,r=a.width/i.width,h=s(a,e.padding),o=h.left+h.right,u=h.top+h.bottom,c=e.height-u,f=Math.floor((e.width-o)*r+o),l=Math.floor(c*r+u),M=n&&n.layers?n.layers:[],d=a.ignoreBackground,p=a.ignorePadding;return{framebufferWidth:f,framebufferHeight:l,region:{x:Math.floor(i.x*r)+h.left,y:Math.floor(i.y*r)+h.top,width:a.width,height:a.height},format:a.format,quality:a.quality,rotation:a.rotation,pixelRatio:r,layers:M,disableDecorations:a.disableDecorations,ignoreBackground:d,ignorePadding:p}}function e(t,n,e,a){a.premultipliedAlpha&&function(t){const n=t.data,e=n.length;for(let t=0;t<e;t+=4){const e=n[t+3];if(e>0){const a=e/255;n[t+0]=n[t+0]/a,n[t+1]=n[t+1]/a,n[t+2]=n[t+2]/a}}}(t),e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.putImageData(t,0,0),a.flipY&&function(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}(i);const r=i.getImageData(0,0,t.width,t.height),h=function(t,n){return t.toDataURL(M[n.format],n.quality/100)}(e,n);return e.width=0,e.height=0,{dataUrl:h,data:r}}function a(n,e){const a=g(n);return{format:a,quality:t(null!=e?e:m[a],0,100)}}function i(t,n){return n/Math.max(t[0],t[1])}function r(t,n,e){if(!t||!n)throw new Error("Cannot construct image data without dimensions");if(l)try{return new ImageData(t,n)}catch(t){l=!1}return c(t,n,e)}function h(t,n,e,a){if(!n||!e)throw new Error("Cannot construct image data without dimensions");if(l)try{return new ImageData(t,n,e)}catch(t){l=!1}const i=c(n,e,a);return i.data.set(t,0),i}function o(t,n,e,a=0,i=0,r=t.width-a,h=t.height-i,o=!1){const{data:u}=t,{width:c,height:f,data:l}=n,s=r/c,g=h/f,M=Math.ceil(s/2),d=Math.ceil(g/2),m=t.width;for(let t=0;t<f;t++)for(let n=0;n<c;n++){const r=4*(n+(o?f-t-1:t)*c);let h=0,p=0,w=0,y=0,b=0,j=0;const x=(t+.5)*g;for(let r=Math.floor(t*g);r<(t+1)*g;r++){const t=Math.abs(x-(r+.5))/d,o=(n+.5)*s,c=t*t;for(let t=Math.floor(n*s);t<(n+1)*s;t++){const n=Math.abs(o-(t+.5))/M,f=Math.sqrt(c+n*n);if(f>=1)continue;let l=2*f*f*f-3*f*f+1;const s=4*(a+t+(i+r)*m);j+=l*u[s+3],p+=l,!e&&u[s+3]<255&&(l=l*u[s+3]/255),w+=l*u[s],y+=l*u[s+1],b+=l*u[s+2],h+=l}}l[r]=w/h,l[r+1]=y/h,l[r+2]=b/h,l[r+3]=j/p}return n}function u(t,n,e){if(!n)return t;const{framebufferWidth:a,framebufferHeight:i,pixelRatio:r,region:h}=t,o=s(t,e),u=o.left+o.right,c=o.top+o.bottom,f=a-u,l=i-c,g=Math.min(8,Math.min((2048-u)/f,(2048-c)/l));return g<1.5?t:{...t,framebufferWidth:Math.round(f*g)+u,framebufferHeight:Math.round(l*g)+c,pixelRatio:r*g,resample:{region:{x:Math.round((h.x-o.left)*g)+o.left,y:Math.round((h.y-o.top)*g)+o.top,width:Math.round(h.width*g),height:Math.round(h.height*g)},width:a,height:i}}}function c(t,n,e){return e||(f||(f=document.createElement("canvas"),f.width=1,f.height=1),e=f),e.getContext("2d").createImageData(t,n)}let f=null,l=!0;function s(t,n){return!n||t&&t.ignorePadding?p:n}function g(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return d}}const M={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},d="png",m={png:100,jpg:98,jpeg:98},p={top:0,right:0,bottom:0,left:0};export{e as a,u as c,o as d,r as f,i as g,a as l,n as o,h as u}