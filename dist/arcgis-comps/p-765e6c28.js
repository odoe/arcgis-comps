import{a0 as e,A as n,bi as t,a4 as i,af as r,s,bj as a}from"./p-e58503d5.js";import"./p-b79fcce3.js";var o;function l(e,n){switch(e.type){case"range":{const t="range"in e?e.range[1]:e.maxValue;if(+n<("range"in e?e.range[0]:e.minValue)||+n>t)return o.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(null==e.codedValues||e.codedValues.every((e=>null==e||e.code!==n)))return o.INVALID_CODED_VALUE}return null}function u(e){if(e&&"range"===e.type)return{min:"range"in e?e.range[0]:e.minValue,max:"range"in e?e.range[1]:e.maxValue}}let c;function f(){return c||(c=(async()=>{const e=await import("./p-1ce5adcc.js").then((function(e){return e.ar}));return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),c}!function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"}(o||(o={}));const d=(e,n,t)=>m.create(e,n,t,null,["$feature"]),y=(e,n,t)=>m.create(e,n,t,null,["$feature","$view"]),p=(e,n,t,i)=>m.create(e,n,t,i,["$feature","$view"]);class m{constructor(e,n,t,i,r,s,a,o){this.script=e,this.evaluate=r;const l=Array.isArray(a)?a:a.fields;this.fields=l,this._syntaxTree=i,this._arcade=n,this._arcadeDictionary=t,this._arcadeFeature=s,this._spatialReference=o,this._referencesGeometry=n.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,i,r,s,a,o){const{arcade:l,Feature:u,Dictionary:c}=await f(),d=e.fromJSON(i),y=l.parseScript(t,o),p=a.reduce(((e,n)=>({...e,[n]:null})),{});let g=null;n(s)&&(g=new c(s),g.immutable=!0,p.$config=null);const h=l.scriptUsesGeometryEngine(y)&&l.enableGeometrySupport(),v=l.scriptUsesFeatureSet(y)&&l.enableFeatureSetSupport(),F=l.scriptIsAsync(y)&&l.enableAsyncSupport(),b={vars:p,spatialReference:d,useAsync:!!F},w=new c;w.immutable=!1,w.setField("scale",0);const I=l.compileScript(y,b);return await Promise.all([h,v,F]),new m(t,l,c,y,(e=>("$view"in e&&e.$view&&(w.setField("scale",e.$view.scale),e.$view=w),g&&(e.$config=g),I({vars:e,spatialReference:d}))),new u,r,d)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}repurposeAdapter(e){return this._arcadeFeature.repurposeFromAdapter(e,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(e){return this._arcade.referencesMember(this._syntaxTree,e)}referencesFunction(e){return this._arcade.referencesFunction(this._syntaxTree,e)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}const g=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],h=["field","normalizationField"];function v(e,n){if(null!=e&&null!=n)for(const t of Array.isArray(e)?e:[e])if(F(g,t,n),"visualVariables"in t&&t.visualVariables)for(const e of t.visualVariables)F(h,e,n)}function F(e,n,r){if(e)for(const s of e){const e=t(s,n),a=e&&"function"!=typeof e&&r.get(e);a&&i(s,a.name,n)}}function b(e,n){if(null!=e&&null!=n&&n.fields.length)if("startField"in e){const t=n.get(e.startField),i=n.get(e.endField);e.startField=t&&t.name||null,e.endField=i&&i.name||null}else{const t=n.get(e.startTimeField),i=n.get(e.endTimeField);e.startTimeField=t&&t.name||null,e.endTimeField=i&&i.name||null}}const w=new Set;function I(e,n){return e&&n?(w.clear(),$(w,e,n),Array.from(w).sort()):[]}function $(e,n,t){var i;if(t)if(null!=n&&null!=(i=n.fields)&&i.length)if(t.includes("*"))for(const{name:t}of n.fields)e.add(t);else for(const i of t)T(e,n,i);else{if(t.includes("*"))return e.clear(),void e.add("*");for(const n of t)e.add(n)}}function T(e,n,t){if("string"==typeof t)if(n){const i=n.get(t);i&&e.add(i.name)}else e.add(t)}function S(e,n){return r(n)||r(e)?[]:n.includes("*")?e.fields.map((e=>e.name)):n}async function N(e,n,t){var i;if(!t)return;const{arcadeUtils:r}=await f(),s=r.extractFieldNames(t,null==n||null==(i=n.fields)?void 0:i.map((e=>e.name)));for(const t of s)T(e,n,t)}async function x(e,n,t){if(t&&"1=1"!==t){const i=(await import("./p-61f47d2b.js")).WhereClause.create(t,n);if(!i.isStandardized)throw new s("fieldUtils:collectFilterFields","Where clause is not standardized");$(e,n,i.fieldNames)}}function D({displayField:e,fields:n}){return e||(n&&n.length?j(n,"name-or-title")||j(n,"unique-identifier")||j(n,"type-or-category")||function(e){for(const n of e){if(!n||!n.name)continue;const e=n.name.toLowerCase();if(e.indexOf("name")>-1||e.indexOf("title")>-1)return n.name}return null}(n):null)}function j(e,n){for(const t of e)if(t&&t.valueType&&t.valueType===n)return t.name;return null}async function k(e,n){if(!n)return;const i=t("elevationInfo.featureExpressionInfo",n);return i?i.collectRequiredFields(e,n.fieldsIndex):void 0}async function A(e,n,t){var i;if(!n||!t||"cluster"!==t.type)return;const r=[];null!=(i=t.popupTemplate)&&i.expressionInfos&&r.push(...t.popupTemplate.expressionInfos.map((t=>N(e,n.fieldsIndex,t.expression)))),t.fields&&r.push(...t.fields.map((t=>async function(e,n,t){t.outStatistic.onStatisticValueExpression?N(e,n,t.outStatistic.onStatisticValueExpression):e.add(t.outStatistic.onStatisticField)}(e,n.fieldsIndex,t)))),await Promise.all(r)}async function M(e,t,i){t&&(t.timeInfo&&n(i)&&i.timeExtent&&$(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&$(e,t.fieldsIndex,[t.floorInfo.floorField]),n(i)&&n(i.where)&&await x(e,t.fieldsIndex,i.where))}async function V(e,n,t){n&&t&&await Promise.all(t.map((t=>async function(e,n,t){n&&t&&(t.valueExpression?await N(e,n.fieldsIndex,t.valueExpression):t.field&&T(e,n.fieldsIndex,t.field))}(e,n,t))))}function z(e){if(!e)return[];const n="editFieldsInfo"in e&&e.editFieldsInfo;return n?I(e.fieldsIndex,[n&&n.creatorField,n&&n.creationDateField,n&&n.editorField,n&&n.editDateField]):[]}function P(e){if(!e)return[];const n=e.geometryFieldsInfo;return n?I(e.fieldsIndex,[n.shapeAreaField,n.shapeLengthField]):[]}async function U(e,n){const{labelingInfo:t,fieldsIndex:i}=n;t&&t.length&&await Promise.all(t.map((n=>async function(e,n,t){if(!t)return;const i=t.getLabelExpression(),r=t.where;if("arcade"===i.type)await N(e,n,i.expression);else{const t=i.expression.match(/{[^}]*}/g);t&&t.forEach((t=>{T(e,n,t.slice(1,-1))}))}await x(e,n,r)}(e,i,n))))}function q(e){const n=e.defaultValue;return void 0!==n&&B(e,n)?n:e.nullable?null:void 0}function J(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function L(e){return null===e||J(e)}const O="isInteger"in Number?Number.isInteger:e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e;function R(e){return null===e||O(e)}function E(e){return null!=e&&"string"==typeof e}function G(e){return null===e||E(e)}function W(){return!0}function B(e,n){let t;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":t=e.nullable?R:O;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":t=e.nullable?L:J;break;case"string":case"esriFieldTypeString":t=e.nullable?G:E;break;default:t=W}return 1===arguments.length?t:t(n)}const C=new Set(["integer","small-integer","single","double","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function H(e){return null!=e&&C.has(e.type)}function K(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}function Q(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)}var X,Y;function Z(e){return null==e||"number"==typeof e&&isNaN(e)?null:e}function _(e,n){return e.nullable&&null===n?null:H(e)&&!function(e,n){const t="string"==typeof e?ne(e):e;return!!t&&(t.isInteger?O(n)&&n>=t.min&&n<=t.max:n>=t.min&&n<=t.max)}(e.type,Number(n))?X.OUT_OF_RANGE:B(e,n)?e.domain?l(e.domain,n):null:Y.INVALID_TYPE}function ee(e){return u(e.domain)||(H(e)?ne(e.type):void 0)}function ne(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return te;case"esriFieldTypeInteger":case"integer":return ie;case"esriFieldTypeSingle":case"single":return re;case"esriFieldTypeDouble":case"double":return se}}(X||(X={})).OUT_OF_RANGE="numeric-range-validation-error::out-of-range",(Y||(Y={})).INVALID_TYPE="type-validation-error::invalid-type";const te={min:-32768,max:32767,isInteger:!0},ie={min:-2147483648,max:2147483647,isInteger:!0},re={min:-34e37,max:12e37,isInteger:!1},se={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function ae(e,n,t){switch(e){case o.INVALID_CODED_VALUE:return`Value ${t} is not in the coded domain - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case o.VALUE_OUT_OF_RANGE:return`Value ${t} is out of the range of valid values - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case Y.INVALID_TYPE:return`Value ${t} is not a valid value for the field type - field: ${n.name}, type: ${n.type}, nullable: ${n.nullable}`;case X.OUT_OF_RANGE:{const{min:e,max:i}=ne(n.type);return`Value ${t} is out of range for the number type - field: ${n.name}, type: ${n.type}, value range is ${e} to ${i}`}}}function oe(e,n){return!le(e,n,null)}function le(e,t,i){if(!t||!t.attributes||!e){if(n(i))for(const n of e)i.add(n);return!0}const r=t.attributes;let s=!1;for(const t of e)if(!(t in r)){if(s=!0,!n(i))break;i.add(t)}return s}function ue(e){const n=a(100*(1-e));return Math.max(0,Math.min(n,100))}function ce(e){return Math.max(0,Math.min(1-e/100,1))}export{k as A,H as B,T as F,K as H,S as I,Q as K,P as L,A as N,z as O,q as P,M as V,X as Z,V as _,f as a,N as b,ue as c,v as d,oe as e,l as f,$ as g,D as h,Y as i,_ as j,o as k,u as l,b as m,p as n,ee as o,y as p,m as q,ce as r,d as s,Z as t,ae as u,U as v,le as w,I as y}