import"./p-b79fcce3.js";import{c as t,aE as e,aK as s,af as i,ar as n,aW as r}from"./p-e58503d5.js";import{H as o}from"./p-01e5a461.js";import{m as a,u as c}from"./p-ea916a39.js";const l=t.getLogger("esri.layers.support.ElevationSampler");class h{queryElevation(t){return p(t.clone(),this)}on(){return v}projectIfRequired(t,e){return m(t,e)}}class u extends h{constructor(t,e,s){super(),this.tile=t,this.noDataValue=s,this.extent=a(t.tile.extent,e.spatialReference);const i=o(e.spatialReference),n=e.lodAt(t.tile.level).resolution*i;this.demResolution={min:n,max:n}}get spatialReference(){return this.extent.spatialReference}contains(t){const e=this.projectIfRequired(t,this.spatialReference);return s(this.extent,e)}elevationAt(t){const e=this.projectIfRequired(t,this.spatialReference);if(i(e))return null;if(!this.contains(t)){const e=this.extent;return l.warn("#elevationAt()",`Point used to sample elevation (${t.x}, ${t.y}) is outside of the sampler extent (${e.xmin}, ${e.ymin}, ${e.xmax}, ${e.ymax})`),this.noDataValue}return this.tile.sample(e.x,e.y)}}class f extends h{constructor(t,e,s){let i;super(),"number"==typeof e?(this.noDataValue=e,i=null):(i=e,this.noDataValue=s),this.samplers=i?t.map((t=>new u(t,i,this.noDataValue))):t;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:t,max:e}=n.demResolution;this.demResolution={min:t,max:e};for(let t=1;t<this.samplers.length;t++){const e=this.samplers[t];this.extent.union(e.extent),this.demResolution.min=Math.min(this.demResolution.min,e.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,e.demResolution.max)}}else this.extent=a(c(),i.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(t){const e=this.projectIfRequired(t,this.spatialReference);if(!e)return null;for(const t of this.samplers)if(t.contains(e))return t.elevationAt(e);return l.warn("#elevationAt()",`Point used to sample elevation (${t.x}, ${t.y}) is outside of the sampler`),this.noDataValue}}function p(t,e){const s=m(t,e.spatialReference);if(!s)return null;switch(t.type){case"point":!function(t,e,s){t.z=r(s.elevationAt(e),0)}(t,s,e);break;case"polyline":!function(t,e,s){d.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let n=0;n<t.paths.length;n++){const o=t.paths[n],a=e.paths[n];for(let t=0;t<o.length;t++){const e=o[t],n=a[t];d.x=n[0],d.y=n[1],i&&(e[3]=e[2]),e[2]=r(s.elevationAt(d),0)}}t.hasZ=!0}(t,s,e);break;case"multipoint":!function(t,e,s){d.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let n=0;n<t.points.length;n++){const o=t.points[n],a=e.points[n];d.x=a[0],d.y=a[1],i&&(o[3]=o[2]),o[2]=r(s.elevationAt(d),0)}t.hasZ=!0}(t,s,e)}return t}function m(t,e){if(i(t))return null;const s=t.spatialReference;if(s.equals(e))return t;const r=n(t,e);return r||l.error(`Cannot project geometry spatial reference (wkid:${s.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}const d=new e,v={remove(){}};export{p as h,f as u}