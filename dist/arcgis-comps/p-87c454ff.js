import{r as t,aL as s,S as i,Q as r,Z as e,t as p,e as o,i as a}from"./p-5420851c.js";import{l as h,u as n}from"./p-e4db8bd2.js";import{i as c}from"./p-2eec0ad8.js";import{r as m}from"./p-95c8b60a.js";import"./p-53bb6ab4.js";import"./p-e2fe661c.js";import"./p-4c6040da.js";import"./p-54db165f.js";import"./p-4d140ee3.js";import"./p-ba8c567b.js";import"./p-2d0c34e5.js";import"./p-47e1bd73.js";import"./p-b392deaf.js";import"./p-9790d1b4.js";import"./p-6df976c7.js";import"./p-50ff864e.js";import"./p-def8d692.js";import"./p-297addf1.js";import"./p-27418da2.js";import"./p-81f41410.js";import"./p-4b2b4a33.js";import"./p-4414d64f.js";import"./p-a617738c.js";import"./p-13d3a443.js";import"./p-8d730a3d.js";import"./p-97ec6ae5.js";import"./p-ad5a0ac5.js";import"./p-6189adb6.js";import"./p-78327456.js";import"./p-9315e4d7.js";import"./p-dcac8868.js";import"./p-c3fd4463.js";import"./p-97540775.js";import"./p-6e6d0422.js";import"./p-9047f753.js";import"./p-8bf8e457.js";import"./p-7e5e535f.js";import"./p-4d0ba4c4.js";import"./p-baad017f.js";import"./p-e991a11e.js";import"./p-b1c9647c.js";const d="sublayers",f="layerView",j=Object.freeze({remove(){},pause(){},resume(){}});let u=class extends(h(n)){async fetchPopupFeatures(t){return(await Promise.all(Array.from(this.graphicsViews(),(s=>s.searchFeatures(t).then((t=>t.filter((t=>!!t.popupTemplate)))))))).flat()}*graphicsViews(){t(this._graphicsViewsFeatureCollectionMap)?yield*this._graphicsViewsFeatureCollectionMap.keys():t(this._graphicsViews)?yield*this._graphicsViews:yield*[]}async hitTest(s,i){if(this.suspended)return null;const r=Array.from(this.graphicsViews(),(async r=>{const e=await r.hitTest(s,i);if(e){if(t(this._graphicsViewsFeatureCollectionMap)){const t=this._graphicsViewsFeatureCollectionMap.get(r);!e.popupTemplate&&t.popupTemplate&&(e.popupTemplate=t.popupTemplate)}return e}return null}));return(await Promise.all(r)).filter((t=>!!t))[0]||null}highlight(t){let r;if("number"==typeof t?r=[t]:t instanceof s?r=[t.uid]:Array.isArray(t)&&t.length>0?r="number"==typeof t[0]?t:t.map((t=>t&&t.uid)):i.isCollection(t)&&(r=t.map((t=>t&&t.uid)).toArray()),r=r.filter((t=>null!=t)),!r.length)return j;for(const t of this.graphicsViews())t.addHighlight(r);return{remove:()=>{for(const t of this.graphicsViews())t.removeHighlight(r)}}}update(t){for(const s of this.graphicsViews())s.processUpdate(t)}attach(){const s=this.view,i=()=>this.requestUpdate(),p=this.layer.featureCollections;if(t(p)&&p.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const t of p){const e=new c(this.view.featuresTilingScheme);e.fadeTransitionEnabled=!0;const p=new m({view:s,graphics:t.source,renderer:t.renderer,requestUpdateCallback:i,container:e});this._graphicsViewsFeatureCollectionMap.set(p,t),this.container.addChild(p.container),this.handles.add([r(t,"visible",(t=>p.container.visible=t)),r(p,"updating",(()=>this.notifyChange("updating")))],f)}}else t(this.layer.sublayers)&&this.handles.add(e(this.layer,"sublayers","change",(()=>this._createGraphicsViews()),(()=>this._createGraphicsViews()),(()=>this._destroyGraphicsViews())),d)}detach(){this._destroyGraphicsViews(),this.handles.remove(d)}moveStart(){}moveEnd(){}viewChange(){for(const t of this.graphicsViews())t.viewChange()}isUpdating(){for(const t of this.graphicsViews())if(t.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.handles.remove(f);for(const t of this.graphicsViews())t.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),p(this.layer.sublayers))return;const t=[],s=this.view,i=()=>this.requestUpdate();for(const e of this.layer.sublayers){const p=new c(this.view.featuresTilingScheme);p.fadeTransitionEnabled=!0;const o=new m({view:s,graphics:e.graphics,requestUpdateCallback:i,container:p});this.handles.add([e.on("graphic-update",o.graphicUpdateHandler),r(e,"visible",(t=>o.container.visible=t)),r(o,"updating",(()=>this.notifyChange("updating")))],f),this.container.addChild(o.container),t.push(o)}this._graphicsViews=t}};u=o([a("esri.views.2d.layers.MapNotesLayerView2D")],u);const l=u;export default l;