import{s as t,al as e,a7 as s,W as i,bN as n}from"./p-c8bc3433.js";const a=t.getLogger("esri/views/webgl"),r=!!e("enable-feature:webgl-debug");function o(){return r}function h(){return r}function l(t){if(o()){const e=t.getError();if(e){const i=function(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(t,e),n=(new Error).stack;a.error(new s("webgl-error","WebGL error occured",{message:i,stack:n}))}}}const u=33984;var c;!function(t){t[t.Texture=0]="Texture",t[t.Buffer=1]="Buffer",t[t.VAO=2]="VAO",t[t.VertexShader=3]="VertexShader",t[t.FragmentShader=4]="FragmentShader",t[t.Program=5]="Program",t[t.Framebuffer=6]="Framebuffer",t[t.Renderbuffer=7]="Renderbuffer",t[t.COUNT=8]="COUNT"}(c||(c={}));const f=33306;function m(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}class p{constructor(t,e,s=null){this._context=t,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,t.instanceCounter.increment(c.Texture,this),this._descriptor={target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,...e},34067===this._descriptor.target?this.setDataCubeMap(s):this.setData(s)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTextureAllUnits(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(c.Texture,this))}release(){this.dispose()}resize(t,e){const s=this._descriptor;s.width===t&&s.height===e||(s.width=t,s.height=e,34067===this._descriptor.target?this.setDataCubeMap(null):this.setData(null))}setDataCubeMap(t=null){for(let e=34069;e<=34074;e++)this.setData(t,e)}setData(t,e=3553){if(!this._context||!this._context.gl)return;const s=this._context.gl;this._glName||(this._glName=s.createTexture()),void 0===t&&(t=null),null===t&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);const n=this._context.bindTexture(this,p.TEXTURE_UNIT_FOR_UPDATES),a=this._descriptor;p._validateTexture(this._context,a),s.pixelStorei(s.UNPACK_ALIGNMENT,a.unpackAlignment),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,a.flipped?1:0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.preMultiplyAlpha?1:0);const r=a.pixelFormat;let o=a.internalFormat?a.internalFormat:this._deriveInternalFormat(r,a.dataType);if(t instanceof ImageData||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement){let i=t.width,n=t.height;t instanceof HTMLVideoElement&&(i=t.videoWidth,n=t.videoHeight),s.texImage2D(e,0,o,r,a.dataType,t),l(s),a.hasMipmap&&this.generateMipmap(),void 0===a.width&&(a.width=i),void 0===a.height&&(a.height=n)}else{null!=a.width&&null!=a.height||console.error("Width and height must be specified!"),s.DEPTH24_STENCIL8&&o===s.DEPTH_STENCIL&&(o=s.DEPTH24_STENCIL8);let n=a.width,h=a.height;if(function(t){return i(t)&&"type"in t&&"compressed"===t.type}(t)){const i=Math.round(Math.log(Math.max(n,h))/Math.LN2)+1;a.hasMipmap=a.hasMipmap&&i===t.levels.length;for(let i=0;;++i){const r=t.levels[Math.min(i,t.levels.length-1)];if(s.compressedTexImage2D(e,i,o,n,h,0,r),1===n&&1===h||!a.hasMipmap)break;n=Math.max(1,n>>1),h=Math.max(1,h>>1)}}else if(i(t))s.texImage2D(e,0,o,n,h,0,r,a.dataType,t),l(s),a.hasMipmap&&this.generateMipmap();else for(let t=0;s.texImage2D(e,t,o,n,h,0,r,a.dataType,null),l(s),(1!==n||1!==h)&&a.hasMipmap;++t)n=Math.max(1,n>>1),h=Math.max(1,h>>1)}p._applySamplingMode(s,this._descriptor),p._applyWrapMode(s,this._descriptor),p._applyAnisotropicFilteringParameters(this._context,this._descriptor),l(s),this._context.bindTexture(n,p.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,e,s,i,n,a,r=3553){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const o=this._context.gl,h=this._descriptor,l=this._context.bindTexture(this,p.TEXTURE_UNIT_FOR_UPDATES);(e<0||s<0||i>h.width||n>h.height||e+i>h.width||s+n>h.height)&&console.error("An attempt to update out of bounds of the texture!"),o.pixelStorei(o.UNPACK_ALIGNMENT,h.unpackAlignment),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,h.flipped?1:0),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h.preMultiplyAlpha?1:0),a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?o.texSubImage2D(r,t,e,s,h.pixelFormat,h.dataType,a):o.texSubImage2D(r,t,e,s,i,n,h.pixelFormat,h.dataType,a),this._context.bindTexture(l,p.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;t.hasMipmap||(t.hasMipmap=!0,this._samplingModeDirty=!0,p._validateTexture(this._context,t)),9729===t.samplingMode?(this._samplingModeDirty=!0,t.samplingMode=9985):9728===t.samplingMode&&(this._samplingModeDirty=!0,t.samplingMode=9984);const e=this._context.bindTexture(this,p.TEXTURE_UNIT_FOR_UPDATES);this._context.gl.generateMipmap(t.target),this._context.bindTexture(e,p.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)}setWrapMode(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,p._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const t=this._context.gl,e=this._descriptor;this._samplingModeDirty&&(p._applySamplingMode(t,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(p._applyWrapMode(t,e),this._wrapModeDirty=!1)}_deriveInternalFormat(t,e){if("webgl"===this._context.webglVersion)return t;if(5126===e)switch(t){case 6408:return 34836;case 6407:return 34837;default:throw new Error("Unable to derive format")}return t}static _validateTexture(t,e){(e.width<0||e.height<0)&&console.error("Negative dimension parameters are not allowed!");const s=n(e.width)&&n(e.height);m(t.gl)||s||("number"==typeof e.wrapMode?33071!==e.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===e.wrapMode.s&&33071===e.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(t,e){let s=e.samplingMode,i=e.samplingMode;9985===s||9987===s?(s=9729,e.hasMipmap||(i=9729)):9984!==s&&9986!==s||(s=9728,e.hasMipmap||(i=9728)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,s),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}static _applyWrapMode(t,e){"number"==typeof e.wrapMode?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}static _applyAnisotropicFilteringParameters(t,e){var s;const i=t.capabilities.textureFilterAnisotropic;i&&t.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,null!=(s=e.maxAnisotropy)?s:1)}}p.TEXTURE_UNIT_FOR_UPDATES=0;export{h as c,u as e,f,m as n,p as o,c as r,l as s,o as u}