import{e as i,d as s,i as t,p as e,c as r,u as p,k as a,af as o,A as h,ai as d}from"./p-e58503d5.js";import{e as n}from"./p-e06536a7.js";import{i as c,p as l}from"./p-5d962998.js";import{G as m}from"./p-ea0c022e.js";import{b as j}from"./p-3e39c093.js";import{U as f}from"./p-f9fa1010.js";import{f as b,h as u,V as y,g as w,k as v,n as g,l as S,W as V,S as x,C as z,x as _,U as P,m as C}from"./p-4d748bd1.js";import{q as E,e as G}from"./p-ccdb8e80.js";import{o as L,s as k}from"./p-2f398ed1.js";import{c as O,f as A}from"./p-3c70d22f.js";import{aS as B}from"./p-340cd100.js";import"./p-53bb6ab4.js";import"./p-2c84c65f.js";import"./p-d3105731.js";import"./p-1c99992b.js";import"./p-dcdb33cf.js";import"./p-95909347.js";import"./p-4d38e149.js";import"./p-b79fcce3.js";import"./p-8747982c.js";import"./p-efbca0ca.js";import"./p-93765525.js";import"./p-765e6c28.js";import"./p-a9a30646.js";import"./p-0e784e4d.js";import"./p-8bc9b36a.js";import"./p-7a658388.js";import"./p-e273719b.js";import"./p-74de0937.js";import"./p-fb38a9d0.js";import"./p-f94762ac.js";import"./p-ea916a39.js";import"./p-8a919d07.js";import"./p-dbdf15fc.js";import"./p-e0d9ff4c.js";import"./p-08e5f531.js";import"./p-dfc6337f.js";import"./p-9f1c2d50.js";import"./p-54330161.js";import"./p-c048b814.js";import"./p-6b2eb7a7.js";import"./p-01e5a461.js";import"./p-889f7a78.js";import"./p-1f81b35d.js";import"./p-81b9df84.js";import"./p-5ce39624.js";import"./p-e9bae5e9.js";import"./p-b0565d49.js";import"./p-51a17e75.js";import"./p-dae095dd.js";import"./p-d208934e.js";import"./p-a131049b.js";import"./p-a2324023.js";import"./p-afac6fb2.js";import"./p-7731c620.js";import"./p-480e5606.js";import"./p-2db4840f.js";import"./p-bba8b671.js";import"./p-dc852195.js";import"./p-22c9f19c.js";import"./p-c096b5df.js";import"./p-da33e926.js";import"./p-a24f7752.js";import"./p-4a6dc5e4.js";import"./p-6a92ecb9.js";import"./p-7a5bfd29.js";import"./p-5e833dfc.js";import"./p-1ab449fc.js";import"./p-a6c8fb32.js";import"./p-0edb3309.js";import"./p-e8160b60.js";import"./p-2e8ad983.js";import"./p-e3270d48.js";import"./p-e44bd0a6.js";import"./p-e654504b.js";import"./p-0eb619a6.js";import"./p-fe68aab5.js";import"./p-c6970847.js";import"./p-de86b3c9.js";import"./p-37d3434c.js";import"./p-120b7410.js";import"./p-b1eff69d.js";import"./p-612de336.js";import"./p-91fe06d4.js";import"./p-ab0e9273.js";import"./p-ff2962f5.js";import"./p-15a9486c.js";import"./p-dfff2877.js";import"./p-cbc915be.js";import"./p-21349208.js";import"./p-a3955219.js";import"./p-8f986f60.js";import"./p-b9aa4901.js";import"./p-e6fe5d89.js";import"./p-c93d2280.js";import"./p-fea9512d.js";import"./p-70787875.js";import"./p-eb48bb01.js";import"./p-c2152437.js";import"./p-0bb84768.js";import"./p-19bc1e3d.js";import"./p-7f47b970.js";import"./p-746a9d8f.js";import"./p-0d1e969a.js";import"./p-5763113b.js";import"./p-37f005a2.js";import"./p-f06611ed.js";import"./p-bdf9e611.js";import"./p-728dcbb0.js";import"./p-6ded4c02.js";import"./p-a72732f2.js";import"./p-a8d1cf30.js";import"./p-c96ccdbf.js";import"./p-09dd2137.js";import"./p-86bdfe14.js";import"./p-1907e0bc.js";import"./p-5f8e8f6c.js";import"./p-3bcc4805.js";import"./p-3721667d.js";import"./p-4019eec3.js";import"./p-025c0c8e.js";import"./p-e72a43d7.js";import"./p-97ec6ae5.js";import"./p-382f7028.js";import"./p-56ed1c7a.js";import"./p-04a0cfca.js";import"./p-ca295674.js";import"./p-41f2b2dd.js";let D=class extends e{constructor(){super(...arguments),this.plane=null}};i([s()],D.prototype,"plane",void 0),D=i([t("esri.views.3d.analysis.Slice.SliceAnalysisViewData")],D);const F=r.getLogger("esri.views.3d.interactive.graphics.Slice.SliceController");let $=class extends e{constructor(i){super(i),this._handles=new p,this._internalChange=!1,this._currentSlicePlane=null,this.state="pending"}get ready(){return"ready"===this.state}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",(i=>{const s=i.item;null!=s&&(s instanceof j||s instanceof f)?s instanceof j&&b(s)?(F.error("excludedLayers",`Layer '${s.title}, id:${s.id}' of type '${s.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),i.preventDefault()):this.analysis.excludedLayers.includes(s)&&i.preventDefault():(F.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),i.preventDefault())}))),this._handles.add(a(this.view,"ready",(()=>this._initialize()),!0))}_initialize(){switch(this.state){case"pending":break;case"destroyed":return;case"ready":throw new Error("state error")}(function(i,s){M.has(i)||M.set(i,{all:[],activeController:null}),M.get(i).all.push(s)})(this.view,this),this._handles.add([c((()=>this.analysisView.analysisViewData.plane),(()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()}),{sync:!0}),c((()=>this.analysis.excludeGroundSurface),(()=>this._updateLayerViews()),{sync:!0}),this.analysis.excludedLayers.on("change",(()=>this._updateLayerViews())),c((()=>[this.analysisView.active,this.analysisView.visible]),(()=>{this._updateActiveController(),this._updateViewSlicePlane()}),{sync:!0}),this.view.allLayerViews.on("change",(()=>this._updateLayerViews()))]),this._handles.add([c((()=>this.analysis.shape),(()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())}),{sync:!0})],"analysis"),this._set("state","ready"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}destroy(){switch(this.state){case"destroyed":case"pending":return}this.analysisView.active=!1,function(i,s){if(!M.has(i))throw new Error("view expected in global slice register");const t=M.get(i),e=t.all.lastIndexOf(s);if(-1===e)throw new Error("controller expected in global slice register");t.all.splice(e,1),0===t.all.length&&M.delete(i)}(this.view,this),this._handles.destroy(),this.view.slicePlane=null,this.set("view",null),this._set("state","destroyed")}async whenReady(){return await a(this,"ready"),this}_updateBoundedPlaneFromSlicePlane(){const i=this.analysis.shape,s=this._currentSlicePlane;if(o(s)&&o(i)||h(s)&&h(i)&&i.equals(s))return;let t=null,e=null;h(i)&&(t=u(i,this.view,m()),h(t)?e={heading:i.heading,tilt:i.tilt,position:i.position,width:i.width,height:i.height}:console.warn("Failed slice plane conversion.")),this._currentSlicePlane=e,h(t)&&!this.analysis.tiltEnabled&&y(t,this.view.renderCoordsHelper,t),this._internalChange=!0,this.analysisView.analysisViewData.plane=t,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const i=w(this.analysisView.analysisViewData.plane,this.view.renderCoordsHelper,this.view.spatialReference,new v);let s=null;h(i)&&(s={heading:i.heading,tilt:i.tilt,position:i.position,width:i.width,height:i.height}),this._currentSlicePlane=s,this._internalChange=!0,this.analysis.shape=i,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(R)return;const i=U(this.view);if(this.analysisView.active)h(i.activeController)&&i.activeController!==this?(R=!0,i.activeController.analysisView.active=!1,R=!1):h(i.activeController),this._updateLayerViews(),i.activeController=this;else{if(h(i.activeController)&&i.activeController!==this)return;h(i.activeController)&&i.activeController===this&&(i.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){"ready"===this.state&&function(i){const s=U(i).activeController;i.slicePlane=h(s)&&h(s.analysisView.analysisViewData.plane)&&s.analysisView.visible?s.analysisView.analysisViewData.plane:null}(this.view)}_updateLayerViews(){const i=h(this.analysisView.analysisViewData.plane)&&this.analysisView.visible&&this.analysisView.active,s=[],t=i=>{"layers"in i?i.layers.forEach(t):s.push(i)};this.analysis.excludedLayers.forEach(t),this.view.allLayerViews.forEach((t=>{"slicePlaneEnabled"in t&&(t.slicePlaneEnabled=i&&s.indexOf(t.layer)<0),"sublayerViews"in t&&t.sublayerViews.forEach((t=>{t.slicePlaneEnabled=i&&s.indexOf(t.sublayer)<0}))})),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=i&&!this.analysis.excludeGroundSurface)}};i([s({readOnly:!0})],$.prototype,"state",void 0),i([s()],$.prototype,"view",void 0),i([s()],$.prototype,"analysis",void 0),i([s()],$.prototype,"analysisView",void 0),i([s()],$.prototype,"ready",null),$=i([t("esri.views.3d.interactive.graphics.Slice.SliceController")],$);const M=new Map;let R=!1;function U(i){return M.get(i)}let I=class extends e{constructor(i){super(i),this._handles=new p,this._gridVisualElement=null,this._outlineVisualElement=null,this.state="pending",this.showGrid=!1,this.editable=!0}get ready(){return"ready"===this.state}initialize(){this._initialize()}async _initialize(){switch(this.state){case"pending":break;case"destroyed":return;case"ready":throw new Error("state error")}if(await a(this.view,"ready",!0),o(this.analysisView.analysisViewData))throw new Error("expected internal object to be valid");this._gridVisualElement=g(this.view),this._outlineVisualElement=S(this.view),this._handles.add([c((()=>({visible:h(this.analysisView.analysisViewData.plane)&&this.analysisView.visible,active:this.analysisView.active,editable:this.editable,showGrid:this.showGrid})),(i=>this._updateMaterials(i)),l),c((()=>this.analysisView.analysisViewData.plane),(i=>this._updatePlane(i)),l)],"internal"),this._set("state","ready")}destroy(){switch(this.state){case"destroyed":case"pending":return}this._handles.destroy(),this._gridVisualElement=d(this._gridVisualElement),this._outlineVisualElement=d(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed")}async whenReady(){return await a(this,"ready"),this}_updatePlane(i){if(o(i))return;const s=L(O.get(),k(i.basis1),k(i.basis2),1),t=E(A.get(),s),e=V(i,A.get()),r=G(t,e,t);this._outlineVisualElement.transform=r,this._gridVisualElement.transform=r}_updateMaterials({visible:i,active:s,editable:t,showGrid:e}){this._outlineVisualElement.color=x,this._outlineVisualElement.width=t?z:_,this._outlineVisualElement.stipplePattern=s?null:B(5);const r=e?C:[0,0,0,0];this._gridVisualElement.backgroundColor=P,this._gridVisualElement.gridColor=r,this._gridVisualElement.visible=i,this._outlineVisualElement.visible=i}};i([s({readOnly:!0})],I.prototype,"state",void 0),i([s()],I.prototype,"view",void 0),i([s()],I.prototype,"analysis",void 0),i([s()],I.prototype,"analysisView",void 0),i([s()],I.prototype,"ready",null),i([s()],I.prototype,"showGrid",void 0),i([s()],I.prototype,"editable",void 0),I=i([t("esri.views.3d.interactive.graphics.Slice.SliceVisualization")],I);let W=class extends(n(e)){constructor(i){super(i),this.type="slice-view",this.analysisVisualization=null,this.analysisController=null,this.analysisViewData=new D,this.active=!0,this.showGrid=!1,this.editable=!1}initialize(){this.analysisVisualization=new I({view:this.view,analysis:this.analysis,analysisView:this}),this.analysisController=new $({view:this.view,analysis:this.analysis,analysisView:this})}destroy(){this.analysisVisualization=d(this.analysisVisualization),this.analysisController=d(this.analysisController)}async when(){return await this.analysisVisualization.whenReady(),await this.analysisController.whenReady(),this}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController}}};i([s()],W.prototype,"type",void 0),i([s()],W.prototype,"analysis",void 0),i([s()],W.prototype,"analysisViewData",void 0),i([s()],W.prototype,"active",void 0),i([s({aliasOf:"analysisVisualization.showGrid"})],W.prototype,"showGrid",void 0),i([s({aliasOf:"analysisVisualization.editable"})],W.prototype,"editable",void 0),W=i([t("esri.views.3d.analysis.Slice.SliceView")],W);const q=W;export default q;