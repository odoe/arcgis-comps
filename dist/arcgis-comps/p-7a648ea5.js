import{e as t,i as e,v as i,E as s,m as n,ae as r,H as o,a0 as a,d as l,R as h,a5 as u,W as c,af as d,ag as p,k as f,p as m,t as v,c as g,ah as w,r as y,J as b,a as _,ai as M,aj as x,ak as I,C as k,D as A,q as C,S as O,al as T,o as F,w as P,z as E,$ as V,n as S,A as R,am as N,g as L,O as z,l as $,an as j,j as D,ao as U,N as q,s as B,h as G,ap as H,aq as W,a7 as Z,ar as K,_ as J,as as Y,x as Q,f as X,at as tt,au as et,av as it,aw as st,Z as nt,ax as rt,ay as ot,az as at,aA as lt,aB as ht,aC as ut,a9 as ct,aD as dt,aE as pt,X as ft,aF as mt,aG as vt,aH as gt,aI as wt,aJ as yt,a1 as bt,aK as _t,aL as Mt,aM as xt,aN as It,aO as kt,aP as At,aQ as Ct}from"./p-9ae46e68.js";import{f as Ot,z as Tt,d as Ft,A as Pt,C as Et,D as Vt,m as St,E as Rt,o as Nt,F as Lt,G as zt,I as $t,J as jt,N as Dt,P as Ut,h as qt,Q as Bt,S as Gt,B as Ht,T as Wt,U as Zt,V as Kt,W as Jt,X as Yt,Y as Qt,R as Xt,_ as te,$ as ee,a0 as ie,a1 as se,a2 as ne,M as re,k as oe,a3 as ae,a4 as le,a5 as he,a6 as ue,a7 as ce,a8 as de,a9 as pe,aa as fe,ab as me,ac as ve,v as ge,ad as we}from"./p-566b0715.js";import{p as ye}from"./p-b2a0fae5.js";import{c as be}from"./p-4681e856.js";import{l as _e,d as Me,a as xe}from"./p-6ebb24ba.js";import{l as Ie}from"./p-a0e42f29.js";import{u as ke,l as Ae}from"./p-32824614.js";import{s as Ce,f as Oe}from"./p-40d3b500.js";import{e as Te,t as Fe}from"./p-ada83011.js";import{b as Pe,m as Ee}from"./p-f42060e0.js";import{Q as Ve}from"./p-98ce0cca.js";import Se from"./p-7e9d2371.js";import{b as Re}from"./p-8e6daf54.js";import{e as Ne,l as Le,h as ze}from"./p-1f10277d.js";import{a as $e,e as je,t as De}from"./p-1d6f3ddb.js";import{a as Ue,i as qe}from"./p-fe01b82b.js";import{U as Be}from"./p-789e71c1.js";import{p as Ge,j as He}from"./p-523f37cd.js";import{s as We,x as Ze}from"./p-a198d6d0.js";import{o as Ke}from"./p-c431b12a.js";import{n as Je}from"./p-15515b8a.js";import{c as Ye,p as Qe}from"./p-b0f556d6.js";import{y as Xe}from"./p-79553c8d.js";import{c as ti,a as ei}from"./p-8b767e6c.js";import{v as ii}from"./p-c0757461.js";import{f as si,D as ni}from"./p-8d03d70f.js";import{d as ri}from"./p-844dad6c.js";import{t as oi,r as ai}from"./p-9658240e.js";import{h as li,e as hi,n as ui,i as ci,c as di,M as pi,r as fi,a as mi}from"./p-d6725707.js";import{r as vi,a as gi,D as wi,F as yi,l as bi,x as _i,s as Mi,o as xi,v as Ii,A as ki,j as Ai,b as Ci,d as Oi}from"./p-d925341f.js";import{n as Ti,t as Fi}from"./p-c3efb223.js";import{H as Pi,O as Ei}from"./p-bae36c84.js";import{s as Vi,r as Si,M as Ri,h as Ni,i as Li}from"./p-39da60a5.js";import{t as zi}from"./p-56ed1c7a.js";import"./p-d18723b0.js";import"./p-2b250922.js";import{g as $i,l as ji}from"./p-b62a8a4f.js";import{o as Di}from"./p-f614dce4.js";import{a as Ui}from"./p-57ae469d.js";var qi;let Bi=qi=class extends Ue{constructor(t){super(t),this.type="none"}clone(){return new qi({type:this.type})}};var Gi;t([Ot({none:"none",stayAbove:"stay-above"})],Bi.prototype,"type",void 0),Bi=qi=t([e("esri.ground.NavigationConstraint")],Bi);const Hi=i.getLogger("esri.Ground");let Wi=Gi=class extends(qe(St)){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new s;const e=t=>{t.parent&&t.parent!==this&&"remove"in t.parent&&t.parent.remove(t),t.parent=this,"elevation"!==t.type&&"base-elevation"!==t.type&&Hi.error(`Layer '${t.title}, id:${t.id}' of type '${t.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)};this.layers.on("after-add",(t=>e(t.item))),this.layers.on("after-remove",(t=>(t=>{t.parent=null})(t.item)))}initialize(){this.when().catch((t=>{Hi.error("#load()","Failed to load ground",t)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",Tt(t,this._get("layers")))}writeLayers(t,e,i,s){const r=[];t?(s={...s,layerContainerType:"ground"},t.forEach((t=>{if("write"in t){const e={};Ke(t)().write(e,s)&&r.push(e)}else s&&s.messages&&s.messages.push(new n("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted in the ground`,{layer:t}))})),e.layers=r):e.layers=r}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Je(this,(t=>{t(this.layers)}))}async queryElevation(t,e){await this.load({signal:null==e?void 0:e.signal});const{ElevationQuery:i}=await import("./p-f2cde0db.js");r(e);const s=new i,n=this.layers.filter(Zi).toArray();return s.queryAll(n,t,e)}async createElevationSampler(t,e){await this.load({signal:null==e?void 0:e.signal});const{ElevationQuery:i}=await import("./p-f2cde0db.js");r(e);const s=new i,n=this.layers.filter(Zi).toArray();return s.createSamplerAll(n,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:o(this.surfaceColor),navigationConstraint:o(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new Gi({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve(null)}_loadLayersFromJSON(t,e,i){const s=e&&e.origin||"web-scene",n=e&&e.portal||null,o=e&&e.url||null;return import("./p-ed0926e2.js").then((({populateOperationalLayers:e})=>{r(i);const l=[];return t.layers&&Array.isArray(t.layers)&&l.push(e(this.layers,t.layers,{context:{origin:s,url:o,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"})),a(l)})).then((()=>{}))}};function Zi(t){return"elevation"===t.type||function(t){return t&&"createElevationSampler"in t}(t)}t([l({json:{read:!1}})],Wi.prototype,"layers",null),t([Ft("layers")],Wi.prototype,"writeLayers",null),t([l({readOnly:!0})],Wi.prototype,"resourceInfo",void 0),t([l({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:h,read:{reader:Pt,source:"transparency"},write:{writer:(t,e)=>{e.transparency=Et(t)},target:"transparency"}}})],Wi.prototype,"opacity",void 0),t([l({type:Vt,json:{type:[h],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],Wi.prototype,"surfaceColor",void 0),t([l({type:Bi,json:{write:!0}})],Wi.prototype,"navigationConstraint",void 0),Wi=Gi=t([e("esri.Ground")],Wi);const Ki=Wi;function Ji(t){var e;return!(!(t&&t.loaded&&"capabilities"in t&&null!=t&&null!=(e=t.capabilities)&&e.operations&&"supportsEditing"in t.capabilities.operations&&!0===t.capabilities.operations.supportsEditing)||"editingEnabled"in t&&!t.editingEnabled)}const Yi=i.getLogger("esri.support.basemapUtils");function Qi(t){return!(null==t||!t.baseLayers.concat(t.referenceLayers).some(Xi))}function Xi(t){if(es(t.url))return!0;if("vector-tile"===t.type)for(const e in t.sourceNameToSource){const i=t.sourceNameToSource[e];if(es(null==i?void 0:i.sourceUrl))return!0}return!1}const ts=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function es(t){if(!t)return!1;const e=new d(p(t));return ts.test(e.authority)}const is=i.getLogger("esri.support.groundUtils"),ss={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};let ns=class extends(Ye(Qe(f.EventedMixin(m)))){constructor(t){super(t),this.allLayers=new ye({getCollections:()=>{var t,e,i;return[null==(t=this.basemap)?void 0:t.baseLayers,null==(e=this.ground)?void 0:e.layers,this.layers,null==(i=this.basemap)?void 0:i.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=new ye({getCollections:()=>[this.tables,this.layers],getChildrenFunction:t=>{const e=[];return"tables"in t&&e.push(t.tables),"layers"in t&&e.push(t.layers),e},itemFilterFunction:t=>{const e=t.parent;return e&&"tables"in e&&e.tables.includes(t)}}),this.basemap=null,this.editableLayers=new ye({getCollections:()=>[this.allLayers],itemFilterFunction:Ji}),this.ground=new Ki,this._basemapCache={}}destroy(){var t,e;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),null==(t=this.ground)||t.destroy(),null==(e=this.basemap)||e.destroy(),function(t){for(const e in t){const i=t[e];!1===(null==i?void 0:i.destroyed)&&i.destroy(),delete t[e]}}(this._basemapCache),this._basemapCache=null}castBasemap(t){return function(t,e){var i;let s;if("string"==typeof t){if(!(t in We)){const e=Object.entries(We).filter((([t,e])=>u.apiKey&&!e.classic||!u.apiKey&&e.classic&&!e.deprecated)).map((([t])=>`"${t}"`)).join(", ");return Yi.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${e}`),null}e&&(s=e[t]),s||(s=Ze.fromId(t),e&&(e[t]=s))}else s=c(Ze,t);return null!=(i=s)&&i.destroyed&&(Yi.warn("The provided basemap is already destroyed",{basemap:s}),s=null),s}(t,this._basemapCache)}castGround(t){const e=function(t){let e=null;return"string"==typeof t?t in ss?e=new Ki({resourceInfo:{data:{layers:[ss[t]]}}}):is.warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`):e=c(Ki,t),e}(t);return v(e)?this._get("ground"):e}findLayerById(t){return this.allLayers.find((e=>e.id===t))}findTableById(t){return this.allTables.find((e=>e.id===t))}};t([l({readOnly:!0,dependsOn:[]})],ns.prototype,"allLayers",void 0),t([l({readOnly:!0})],ns.prototype,"allTables",void 0),t([l({type:Ze})],ns.prototype,"basemap",void 0),t([g("basemap")],ns.prototype,"castBasemap",null),t([l({readOnly:!0})],ns.prototype,"editableLayers",void 0),t([l({type:Ki,nonNullable:!0})],ns.prototype,"ground",void 0),t([g("ground")],ns.prototype,"castGround",null),ns=t([e("esri.Map")],ns);const rs=ns;var os;let as=os=class extends Ue{constructor(...t){super(...t),this.position=new Rt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(t,e,i,s){if(t&&"object"==typeof t&&("x"in t||Array.isArray(t))){const n={position:t};return null!=e&&(n.heading=e),null!=i&&(n.tilt=i),null!=s&&(n.fov=s),n}return t}writePosition(t,e,i,s){const n=t.clone();n.x=w(t.x||0),n.y=w(t.y||0),n.z=t.hasZ?w(t.z||0):t.z,e[i]=n.write({},s)}readPosition(t,e){const i=new Rt;return i.read(t,e),i.x=w(i.x||0),i.y=w(i.y||0),i.z=i.hasZ?w(i.z||0):i.z,i}equals(t){return!!t&&this.tilt===t.tilt&&this.heading===t.heading&&this.fov===t.fov&&this.position.equals(t.position)}clone(){return new os({position:this.position.clone(),heading:this.heading,tilt:this.tilt,fov:this.fov})}};t([l({type:Rt,json:{write:{isRequired:!0}}})],as.prototype,"position",void 0),t([Ft("position")],as.prototype,"writePosition",null),t([Nt("position")],as.prototype,"readPosition",null),t([l({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),g((t=>Be.normalize(w(t))))],as.prototype,"heading",void 0),t([l({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),g((t=>Lt(w(t),-180,180)))],as.prototype,"tilt",void 0),t([l({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],as.prototype,"fov",void 0),as=os=t([e("esri.Camera")],as);const ls=as;var hs;let us=hs=class extends Ue{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new hs({rotation:this.rotation,scale:this.scale,targetGeometry:y(this.targetGeometry)?this.targetGeometry.clone():null,camera:y(this.camera)?this.camera.clone():null})}};function cs(){return{enabled:!this.camera}}t([l({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:cs}}}}})],us.prototype,"rotation",void 0),t([g("rotation")],us.prototype,"castRotation",null),t([l({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:cs}}}}})],us.prototype,"scale",void 0),t([l({types:zt,json:{read:$t,write:!0,origins:{"web-scene":{read:$t,write:{overridePolicy:cs}}}}})],us.prototype,"targetGeometry",void 0),t([l({type:ls,json:{write:!0}})],us.prototype,"camera",void 0),us=hs=t([e("esri.Viewpoint")],us);const ds=us;var ps;let fs=ps=class extends Ue{constructor(t){super(t),this.color=new Vt([0,0,0,1])}clone(){return new ps(o({color:this.color}))}};t([l({type:Vt,json:{write:!0}})],fs.prototype,"color",void 0),fs=ps=t([e("esri.webmap.background.ColorBackground")],fs);const ms=fs,vs={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,s=this.values;return e<=i.xsmall?s.xsmall:e<=i.small?s.small:e<=i.medium?s.medium:e<=i.large?s.large:s.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,s=this.values;return e<=i.xsmall?s.xsmall:e<=i.small?s.small:e<=i.medium?s.medium:e<=i.large?s.large:s.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=this.values;return e[1]>=e[0]?i.portrait:i.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},gs={xsmall:544,small:768,medium:992,large:1200};function ws(t,e){return e?vs[t].valueToClassName[e].split(" "):[]}const ys=i=>{let s=class extends i{constructor(...t){super(...t),this._breakpointsHandles=new b,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=gs}initialize(){this._breakpointsHandles.add(_(this,["breakpoints","size"],this._updateClassNames))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)}set breakpoints(t){if(t===this._get("breakpoints"))return;const e=function(t){return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}(t);if(!e){const t=JSON.stringify(gs,null,2);console.warn("provided breakpoints are not valid, using defaults:"+t)}t=e?t:gs,this._set("breakpoints",{...t})}_updateClassNames(){if(!this.container)return;const t=M.acquire(),e=M.acquire();let i,s=!1;for(i in vs){const n=this[i],r=vs[i].getValue({viewSize:this.size,breakpoints:this.breakpoints});n!==r&&(s=!0,this[i]=r,ws(i,n).forEach((t=>e.push(t))),ws(i,r).forEach((e=>t.push(e))))}s&&(this._applyClassNameChanges(t,e),M.release(t),M.release(e))}_applyClassNameChanges(t,e){const i=this.container;i&&(e.forEach((t=>i.classList.remove(t))),t.forEach((t=>i.classList.add(t))))}_removeActiveClassNames(){const t=this.container;if(!t)return;let e;for(e in vs)ws(e,this[e]).forEach((e=>t.classList.remove(e)))}};return t([l()],s.prototype,"breakpoints",null),t([l()],s.prototype,"orientation",void 0),t([l()],s.prototype,"widthBreakpoint",void 0),t([l()],s.prototype,"heightBreakpoint",void 0),s=t([e("esri.views.BreakpointsOwner")],s),s};let bs=class extends m{constructor(){super(...arguments),this.items=new s,this._watchUpdatingTracking=new _e,this._callbacks=new Map,this._projector=x(),this._hiddenProjector=x()}get needsRender(){return this.items.length>0}initialize(){const t=document.createElement("div");t.className="esri-overlay-surface",this._set("surface",t),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),t.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(this.items,(t=>{for(const e of t.added){const t=()=>e.render();this._callbacks.set(e,t),this._projector.append(this.surface,t)}for(const e of t.removed){const t=this._projector.detach(this._callbacks.get(e));this.surface.removeChild(t.domNode),this._callbacks.delete(e)}}))}addItem(t){this.items.add(t)}removeItem(t){this.items.remove(t)}destroy(){this.items.removeAll(),this._callbacks.forEach((t=>this._projector.detach(t))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(t){const e=this._hiddenSurface,i=this._hiddenProjector;let s=null;const n=()=>(s=t.render(),s);i.append(e,n),i.renderNow();const r={left:0,top:0,right:0,bottom:0};if(s&&s.domNode){const t=s.domNode.getBoundingClientRect();r.left=t.left,r.top=t.top,r.right=t.right,r.bottom=t.bottom}for(i.detach(n);e.firstChild;)e.removeChild(e.firstChild);return r}overlaps(t,e){const i=this.computeBoundingRect(t),s=this.computeBoundingRect(e);return Math.max(i.left,s.left)<=Math.min(i.right,s.right)&&Math.max(i.top,s.top)<=Math.min(i.bottom,s.bottom)}get hasVisibleItems(){return this.items.some((t=>t.visible))}renderCanvas(t){if(!this.items.some((t=>t.visible)))return;const e=t.getContext("2d");e.save(),e.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach((t=>{e.save(),t.renderCanvas(e),e.restore()})),e.restore()}};t([l({readOnly:!0})],bs.prototype,"surface",void 0),t([l({readOnly:!0})],bs.prototype,"items",void 0),t([l({readOnly:!0})],bs.prototype,"needsRender",null),t([l({readOnly:!0})],bs.prototype,"_watchUpdatingTracking",void 0),t([l({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],bs.prototype,"updating",void 0),bs=t([e("esri.views.overlay.ViewOverlay")],bs);const _s=bs;function Ms(t,e,i,s){let n=null,r=1e3;"number"==typeof e?(r=e,s=i):(n=null!=e?e:null,r=i);let o,a=0;const l=()=>{a=0,t.apply(s,o)},h=(...t)=>{n&&n.apply(s,t),o=t,r?a||(a=setTimeout(l,r)):l()};return h.remove=()=>{a&&(clearTimeout(a),a=0)},h.forceUpdate=()=>{a&&(clearTimeout(a),l())},h.hasPendingUpdates=()=>!!a,h}const xs=["B","kB","MB","GB","TB"],Is=i.getLogger("esri.widgets.Feature.support.featureUtils"),ks=/href=(""|'')/gi,As=/(\{([^\{\r\n]+)\})/g,Cs=/\'/g,Os=/^\s*expression\//i,Ts=/(\n)/gi,Fs=/[\u00A0-\u9999<>\&]/gim,Ps=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,Es=/^(?:mailto:|tel:)/,Vs="relationships/",Ss=O("short-date-short-time");function Rs(t){if(!v(t))return t.get("sourceLayer")||t.get("layer")}async function Ns(t,e){return"function"==typeof t?t.call(null,e):t}function Ls(t=""){if(t)return!Es.test(t.trim().toLowerCase())}function zs(t){return!!t&&Os.test(t)}function $s(t,e){const i=function(t,e){if(!zs(e)||!t)return null;const i=e.replace(Os,"").toLowerCase();let s;return t.some((t=>t.name.toLowerCase()===i&&(s=t,!0))),s}(e,null==t?void 0:t.fieldName);return i?i.title||null:t?t.label||t.fieldName:null}function js(t,e){const i=Ds(e,t);return i?i.name:t}function Ds(t,e){return t&&"function"==typeof t.getField?t.getField(e):null}function Us(t){return`${t}`.trim()}function qs({attributes:t,globalAttributes:e,layer:i,text:s,expressionAttributes:n,fieldInfoMap:r}){return s?Bs({formattedAttributes:e,template:Hs(s,{...e,...n,...t},i),fieldInfoMap:r}):""}function Bs({formattedAttributes:t,template:e,fieldInfoMap:i}){return Us(function(t){return t.replace(ks,"")}(I(I(e,(t=>function(t,e){const i=e.get(t.toLowerCase());return`{${i&&i.fieldName||t}}`}(t,i))),t)))}function Gs(t,e){return t.replace(As,((t,i,s)=>{const n=Ds(e,s);return n?`{${n.name}}`:i}))}function Hs(t,e,i){const s=Gs(t,i);return s?s.replace(Ps,((t,i,s)=>function(t,e,i){const s=(e=Us(e))&&"{"!==e[0];return I(t,function(t,e=!1){const i={...t};return Object.keys(i).forEach((t=>function(t,e,i=!1){const s=e[t];if("string"==typeof s){const n="%27",r=(i?encodeURIComponent(s):s).replace(Cs,n);e[t]=r}}(t,i,e))),i}(i,s))}(t,i||s,e))):s}function Ws(t,e){const i=e.fieldName,s=Zs(e.fieldInfos,i),n=null==s?void 0:s.clone(),r=e.preventPlacesFormatting,o=e.layer,a=Ds(o,i);if(n&&"date"===(null==a?void 0:a.type)){const t=n.format||new jt;t.dateFormat=t.dateFormat||"short-date-short-time",t.dateTimeFormatOptions=function(t){return"feature"===(null==t?void 0:t.type)}(o)&&o.datesInUnknownTimezone||function(t){return!(null==t||!t.layer)}(o)&&function(t){return"map-image"===(null==t?void 0:t.type)}(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,n.format=t}const l=n&&n.format;return"string"==typeof(t=function(t,e){if("string"==typeof t&&e&&null==e.dateFormat&&(null!=e.places||null!=e.digitSeparator)){const e=Number(t);if(!isNaN(e))return e}return t}(t,l))||null==t||null==l?t:r?k(t,{...A(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(t)}function Zs(t,e){if(!t||!t.length||!e)return;const i=e.toLowerCase();let s;return t.some((t=>!(!t.fieldName||t.fieldName.toLowerCase()!==i||(s=t,0)))),s}function Ks(t){const e=[];if(!t)return e;const{fieldInfos:i,content:s}=t;return i&&e.push(...i),s&&Array.isArray(s)?(s.forEach((t=>{if("fields"===t.type){const i=t&&t.fieldInfos;i&&e.push(...i)}})),e):e}function Js(t){return t.replace(Fs,(t=>`&#${t.charCodeAt(0)};`))}function Ys(t){return"string"==typeof t?t.replace(Ts,'<br class="esri-text-new-line" />'):t}function Qs({fieldInfos:t,attributes:e,layer:i,graphic:s,fieldInfoMap:n,relatedInfos:r}){const o={};return null==r||r.forEach((t=>function(t,e){t&&e&&(e.relatedFeatures&&e.relatedFeatures&&e.relatedFeatures.forEach((i=>tn({attributes:t,graphic:i,relatedInfo:e}))),e.relatedStatsFeatures&&e.relatedStatsFeatures&&e.relatedStatsFeatures.forEach((i=>tn({attributes:t,graphic:i,relatedInfo:e}))))}(o,t))),Object.keys(e).forEach((r=>{o[r]=function(t){const{value:e,fieldName:i,fieldInfos:s,fieldInfoMap:n,layer:r,graphic:o}=t;if(null==e)return"";const a=function({fieldName:t,value:e,graphic:i,layer:s}){if(Xs(t))return null;if(!s||"function"!=typeof s.getFieldDomain)return null;const n=s.getFieldDomain(t,{feature:i});return n&&"coded-value"===n.type?n.getName(e):null}({fieldName:i,value:e,graphic:o,layer:r});if(a)return a;const l=function({fieldName:t,graphic:e,layer:i}){if(Xs(t))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:s}=i;if(!s||t!==s)return null;const n=i.getFeatureType(e);return n?n.name:null}({fieldName:i,graphic:o,layer:r});if(l)return l;if(n.get(i.toLowerCase()))return Ws(e,{fieldInfos:s,fieldName:i,layer:r});const h=r&&r.fieldsIndex;return h&&h.isDateField(i)?C(e,Ss):Ys(e)}({fieldName:r,fieldInfos:t,fieldInfoMap:n,layer:i,value:e[r],graphic:s})})),o}function Xs(t=""){return!!t&&-1!==t.indexOf(Vs)}function tn({attributes:t,graphic:e,relatedInfo:i}){t&&e&&i&&Object.keys(e.attributes).forEach((s=>{const n=function(t){return t?`${Vs}${t.layerId}/${t.fieldName}`:""}({layerId:i.relation.id.toString(),fieldName:s});t[n]=e.attributes[s]}))}const en=t=>{if(!t)return!1;const e=t.toUpperCase();return e.indexOf("CURRENT_TIMESTAMP")>-1||e.indexOf("CURRENT_DATE")>-1||e.indexOf("CURRENT_TIME")>-1},sn=({layer:t,method:e,query:i,definitionExpression:s})=>{var n,r;if(null==(n=t.capabilities)||null==(r=n.query)||!r.supportsCacheHint||"attachments"===e)return;const o=y(i.where)&&i.where,a=y(i.geometry)&&i.geometry;en(s)||en(o)||"extent"===(null==a?void 0:a.type)||"tile"===i.resultType||(i.cacheHint=!0)},nn={editing:!1,operations:{add:!0,update:!0,delete:!0}},rn=s.ofType(Ie);let on=class extends Me{constructor(t){super(t),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...nn},this.activeAttachmentInfo=null,this.attachmentInfos=new rn,this.graphic=null,this.mode="view",this.handles.add([_(this,"graphic",(()=>this._graphicChanged()))])}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(t){return{...nn,...t}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}async getAttachments(){const{_attachmentLayer:t,attachmentInfos:e}=this;if(!t||"function"!=typeof t.queryAttachments)throw new n("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),s=new ke({objectIds:[i],returnMetadata:!0}),r=[],o=t.queryAttachments(s).then((t=>t[i]||r)).catch((()=>r));this._getAttachmentsPromise=o,this.notifyChange("state");const a=await o;return e.removeAll(),a.length&&e.addMany(a),this._getAttachmentsPromise=null,this.notifyChange("state"),a}async addAttachment(t){const{_attachmentLayer:e,attachmentInfos:i,graphic:s,abilities:r}=this;if(!t)throw new n("invalid-attachment","addAttachment(): An attachment is required.",{attachment:t});if(!r.operations.add)throw new n("invalid-abilities","addAttachment(): add abilities are required.");if(!e||"function"!=typeof e.addAttachment)throw new n("invalid-layer","addAttachment(): A valid layer is required.");const o=e.addAttachment(s,t).then((t=>this._queryAttachment(t.objectId))),a=await o;return i.add(a),a}async deleteAttachment(t){const{_attachmentLayer:e,attachmentInfos:i,graphic:s,abilities:r}=this;if(!t)throw new n("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!r.operations.delete)throw new n("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!e||"function"!=typeof e.deleteAttachments)throw new n("invalid-layer","deleteAttachment(): A valid layer is required.");const o=e.deleteAttachments(s,[t.id]).then((()=>t)),a=await o;return i.remove(a),a}async updateAttachment(t,e=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:s,graphic:r,abilities:o}=this;if(!t)throw new n("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:t});if(!e)throw new n("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!o.operations.update)throw new n("invalid-abilities","updateAttachment(): Update abilities are required.");const a=s.findIndex((t=>t===e));if(!i||"function"!=typeof i.updateAttachment)throw new n("invalid-layer","updateAttachment(): A valid layer is required.");const l=i.updateAttachment(r,e.id,t).then((t=>this._queryAttachment(t.objectId))),h=await l;return s.splice(a,1,h),h}async _queryAttachment(t){if(!t)throw new n("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:e}=this,i=this._getFeatureId(),s=new ke({objectIds:[i],attachmentsWhere:`AttachmentId=${t}`,returnMetadata:!0});return e.queryAttachments(s).then((t=>t[i][0]))}_getFeatureId(){const{_attachmentLayer:t,graphic:e}=this;if(!t||!e)return null;const{objectIdField:i}=t,{attributes:s}=e;return s&&s[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>{})))}_setAttachmentLayer(){const{graphic:t}=this,e=Rs(t);this._attachmentLayer=e?"scene"===e.type&&y(e.associatedLayer)?e.associatedLayer:e:null}};t([l()],on.prototype,"abilities",void 0),t([g("abilities")],on.prototype,"castAbilities",null),t([l()],on.prototype,"activeAttachmentInfo",void 0),t([l({readOnly:!0,type:rn})],on.prototype,"attachmentInfos",void 0),t([l({type:qt})],on.prototype,"graphic",void 0),t([l()],on.prototype,"mode",void 0),t([l({readOnly:!0})],on.prototype,"state",null),t([l({readOnly:!0})],on.prototype,"supportsResizeAttachments",null),on=t([e("esri.widgets.Attachments.AttachmentsViewModel")],on);const an=on,ln={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},hn=window.CSS;let un=class extends E{constructor(t,e){super(t,e),this.abilities=null,this.displayType="auto",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new an,this.visibleElements={...ln},this._supportsImageOrientation=hn&&hn.supports&&hn.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own(V(this,"viewModel.attachmentInfos","change",(()=>this.scheduleRender())),_(this,"viewModel.mode",(()=>this._modeChanged())))}get effectiveDisplayType(){return"auto"===this.displayType?this.viewModel.supportsResizeAttachments?"preview":"list":this.displayType}castVisibleElements(t){return{...ln,...t}}addAttachment(){const{_addAttachmentForm:t,viewModel:e}=this;return this._set("submitting",!0),this._set("error",null),e.addAttachment(t).then((t=>(this._set("submitting",!1),this._set("error",null),e.mode="view",t))).catch((t=>{throw this._set("submitting",!1),this._set("error",new n("attachments:add-attachment",this.messages.addErrorMessage,t)),t}))}deleteAttachment(t){const{viewModel:e}=this;return this._set("submitting",!0),this._set("error",null),e.deleteAttachment(t).then((t=>(this._set("submitting",!1),this._set("error",null),e.mode="view",t))).catch((t=>{throw this._set("submitting",!1),this._set("error",new n("attachments:delete-attachment",this.messages.deleteErrorMessage,t)),t}))}updateAttachment(){const{viewModel:t}=this,{_updateAttachmentForm:e}=this;return this._set("submitting",!0),this._set("error",null),t.updateAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((t=>{throw this._set("submitting",!1),this._set("error",new n("attachments:update-attachment",this.messages.updateErrorMessage,t)),t}))}render(){const{submitting:t,viewModel:e}=this,{state:i}=e;return S("div",{class:this.classes("esri-attachments","esri-widget")},t?this.renderProgressBar():null,"loading"===i?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:t,visibleElements:e}=this;return t&&e.errorMessage?S("div",{key:"error-message",class:"esri-attachments__error-message"},t.message):null}renderAttachments(){const{mode:t,activeAttachmentInfo:e}=this.viewModel;return"add"===t?this.renderAddForm():"edit"===t?this.renderDetailsForm(e):this.renderAttachmentContainer()}renderLoading(){return S("div",{class:"esri-attachments__loader-container",key:"loader"},S("div",{class:"esri-attachments__loader"}))}renderProgressBar(){return this.visibleElements.progressBar?S("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null}renderAddForm(){const{submitting:t,selectedFile:e}=this,i=t||!e,s=this.visibleElements.cancelAddButton?S("button",{type:"button",bind:this,disabled:t,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",t&&"esri-button--disabled")},this.messages.cancel):null,n=this.visibleElements.addSubmitButton?S("button",{type:"submit",disabled:i,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",{"esri-button--disabled":i})},this.messages.add):null,r=e?S("span",{key:"file-name",class:"esri-attachments__file-name"},e.name):null,o=S("form",{bind:this,afterCreate:R,afterRemoved:N,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},S("fieldset",{class:"esri-attachments__file-fieldset"},r,S("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},e?this.messages.changeFile:this.messages.selectFile,S("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),n,s);return S("div",{key:"add-form-container",class:"esri-attachments__form-node"},o)}renderDetailsForm(t){const{visibleElements:e,viewModel:i,selectedFile:s,submitting:n}=this,{contentType:r,size:o,url:a}=t,{abilities:l}=i,h=n||!s,u=l.editing&&l.operations.delete&&e.deleteButton?S("button",{key:"delete-button",type:"button",disabled:n,bind:this,onclick:e=>this._submitDeleteAttachment(e,t),class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-attachments__delete-button",{"esri-button--disabled":n})},this.messages.delete):null,c=l.editing&&l.operations.update&&e.updateButton?S("button",{disabled:h,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",{"esri-button--disabled":h})},this.messages.update):null,d=this.visibleElements.cancelUpdateButton?S("button",{disabled:n,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-button--third",{"esri-button--disabled":n})},this.messages.cancel):null,p=s?S("span",{key:"file-name",class:"esri-attachments__file-name"},s.name):null,f=l.editing&&l.operations.update?S("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},p,S("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,S("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,m=S("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},S("label",null,function(t,e){let i=0===e?0:Math.floor(Math.log(e)/Math.log(1024));i=Lt(i,0,xs.length-1);const s=k(e/1024**i,{maximumFractionDigits:2});return I(t.units.bytes[xs[i]],{fileSize:s})}(this.messagesUnits,o))),v=S("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},S("label",null,r)),g=S("form",{bind:this,afterCreate:R,afterRemoved:N,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},S("div",{class:"esri-attachments__metadata"},m,v),f,S("div",{class:"esri-attachments__actions"},u,d,c));return S("div",{key:"edit-form-container",class:"esri-attachments__form-node"},S("a",{class:"esri-attachments__item-link",href:a,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:t,size:400}),S("div",{class:"esri-attachments__item-link-overlay"},S("span",{class:"esri-attachments__item-link-overlay-icon"},S("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},S("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),S("path",{fill:"none",d:"M0 0h32v32H0z"}))))),g)}renderImageMask({attachmentInfo:t,size:e}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:s,name:n,url:r}=t,o=i&&function(t){const e=t.toLowerCase();return"image/bmp"===e||"image/emf"===e||"image/exif"===e||"image/gif"===e||"image/x-icon"===e||"image/jpeg"===e||"image/png"===e||"image/tiff"===e||"image/x-wmf"===e}(s),a=this._getCSSTransform(t,o),l=a?{transform:a,"image-orientation":"none"}:{},h=-1===r.indexOf("?")?"?":"&",u=o?`${r}${h}w=${e}`:function(t){const e=T("esri/themes/base/images/files/");return t?"text/plain"===t?`${e}text-32.svg`:"application/pdf"===t?`${e}pdf-32.svg`:"text/csv"===t?`${e}csv-32.svg`:"application/gpx+xml"===t?`${e}gpx-32.svg`:"application/x-dwf"===t?`${e}cad-32.svg`:"application/postscript"===t||"application/json"===t||"text/xml"===t||"model/vrml"===t?`${e}code-32.svg`:"application/x-zip-compressed"===t||"application/x-7z-compressed"===t||"application/x-gzip"===t||"application/x-tar"===t||"application/x-gtar"===t||"application/x-bzip2"===t||"application/gzip"===t||"application/x-compress"===t||"application/x-apple-diskimage"===t||"application/x-rar-compressed"===t||"application/zip"===t?`${e}zip-32.svg`:-1!==t.indexOf("image/")?`${e}image-32.svg`:-1!==t.indexOf("audio/")?`${e}sound-32.svg`:-1!==t.indexOf("video/")?`${e}video-32.svg`:-1!==t.indexOf("msexcel")||-1!==t.indexOf("ms-excel")||-1!==t.indexOf("spreadsheetml")?`${e}excel-32.svg`:-1!==t.indexOf("msword")||-1!==t.indexOf("ms-word")||-1!==t.indexOf("wordprocessingml")?`${e}word-32.svg`:-1!==t.indexOf("powerpoint")||-1!==t.indexOf("presentationml")?`${e}report-32.svg`:`${e}generic-32.svg`:`${e}generic-32.svg`}(s),c={"esri-attachments__image--resizable":i};return S("div",{class:this.classes({"esri-attachments__item-mask--icon":!o},"esri-attachments__item-mask")},S("img",{styles:l,alt:n,src:u,class:this.classes(c,"esri-attachments__image")}))}renderAttachmentInfo({attachmentInfo:t,displayType:e}){const{viewModel:i}=this,{abilities:s}=i,{name:n,url:r}=t,o=this.renderImageMask({attachmentInfo:t,size:"list"===e?48:400}),a=s.editing?S("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",L(this.container)?"esri-icon-left":"esri-icon-right")}):null,l=[o,S("label",{class:"esri-attachments__label"},S("span",{class:"esri-attachments__filename"},n||this.messages.noTitle),a)],h=s.editing?S("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":t.id,onclick:()=>this._startEditAttachment(t),type:"button"},l):S("a",{key:"details-link",class:"esri-attachments__item-button",href:r,target:"_blank"},l);return S("li",{class:"esri-attachments__item",key:t},h)}renderAttachmentContainer(){const{effectiveDisplayType:t,viewModel:e,visibleElements:i}=this,{attachmentInfos:s,abilities:n}=e,r=s&&s.length,o={"esri-attachments__container--list":"preview"!==t,"esri-attachments__container--preview":"preview"===t},a=n.editing&&n.operations.add&&i.addButton?S("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes("esri-button","esri-button--tertiary","esri-attachments__add-attachment-button"),type:"button"},S("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null,l=r?S("ul",{class:"esri-attachments__items"},s.toArray().map((e=>this.renderAttachmentInfo({attachmentInfo:e,displayType:t})))):S("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return S("div",{key:"attachments-container",class:this.classes("esri-attachments__container",o)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(t){const e=t.target,i=e&&e.files&&e.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(t,e){t.preventDefault(),this.deleteAttachment(e)}_submitAddAttachment(t){t.preventDefault(),this.addAttachment()}_submitUpdateAttachment(t){t.preventDefault(),this.updateAttachment()}_startEditAttachment(t){const{viewModel:e}=this;e.activeAttachmentInfo=t,e.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(t){t.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(t,e){const{orientationInfo:i}=t;return!this._supportsImageOrientation&&e&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};t([F("viewModel.abilities")],un.prototype,"abilities",void 0),t([l()],un.prototype,"displayType",void 0),t([l({readOnly:!0})],un.prototype,"effectiveDisplayType",null),t([F("viewModel.graphic")],un.prototype,"graphic",void 0),t([l({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],un.prototype,"label",void 0),t([l(),P("esri/widgets/Attachments/t9n/Attachments")],un.prototype,"messages",void 0),t([l(),P("esri/core/t9n/Units")],un.prototype,"messagesUnits",void 0),t([l({readOnly:!0})],un.prototype,"selectedFile",void 0),t([l({readOnly:!0})],un.prototype,"submitting",void 0),t([l({readOnly:!0})],un.prototype,"error",void 0),t([l({type:an})],un.prototype,"viewModel",void 0),t([l()],un.prototype,"visibleElements",void 0),t([g("visibleElements")],un.prototype,"castVisibleElements",null),un=t([e("esri.widgets.Attachments")],un);const cn=un;let dn=class extends an{constructor(t){super(t),this.description=null,this.title=null}};t([l()],dn.prototype,"description",void 0),t([l()],dn.prototype,"title",void 0),dn=t([e("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],dn);const pn=dn;let fn=class extends E{constructor(t,e){super(t,e),this.description=null,this.headingLevel=2,this.title=null}render(){return S("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:t}=this;return t?S(Ce,{level:this.headingLevel,class:"esri-feature-element-info__title"},t):null}renderDescription(){const{description:t}=this;return t?S("div",{key:"description",class:"esri-feature-element-info__description"},t):null}};t([l()],fn.prototype,"description",void 0),t([l()],fn.prototype,"headingLevel",void 0),t([l()],fn.prototype,"title",void 0),fn=t([e("esri.widgets.Feature.support.FeatureElementInfo")],fn);const mn=fn;let vn=class extends E{constructor(t,e){super(t,e),this._featureElementInfo=null,this.attachmentsWidget=new cn,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new pn}initialize(){this._featureElementInfo=new mn,_(this,["viewModel.description","viewModel.title","headingLevel"],(()=>this._setupFeatureElementInfo())),_(this,"viewModel.graphic",(t=>this.attachmentsWidget.graphic=t))}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var t;const{attachmentsWidget:e}=this;return S("div",{class:"esri-feature-attachments"},null==(t=this._featureElementInfo)?void 0:t.render(),null==e?void 0:e.render())}_setupFeatureElementInfo(){const{description:t,title:e,headingLevel:i}=this;this._featureElementInfo.set({description:t,title:e,headingLevel:i})}};t([l({readOnly:!0})],vn.prototype,"attachmentsWidget",void 0),t([F("viewModel.description")],vn.prototype,"description",void 0),t([F("attachmentsWidget.displayType")],vn.prototype,"displayType",void 0),t([F("viewModel.graphic")],vn.prototype,"graphic",void 0),t([l()],vn.prototype,"headingLevel",void 0),t([F("viewModel.title")],vn.prototype,"title",void 0),t([l({type:pn})],vn.prototype,"viewModel",void 0),vn=t([e("esri.widgets.Feature.FeatureAttachments")],vn);const gn=vn;let wn=class extends(xe(m)){constructor(t){super(t),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(_(this,"creator",(t=>{this._destroyContent(),this._createContent(t)})))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:t,graphic:e,destroyer:i}=this;t&&(Ns(i,{graphic:e}).catch((()=>null)),this._set("created",null))}async _createContent(t){const{graphic:e}=this,i=Ns(t,{graphic:e}).catch((()=>null));this._loadingPromise=i,this.notifyChange("state");const s=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",s))}};t([l({readOnly:!0})],wn.prototype,"created",void 0),t([l()],wn.prototype,"creator",void 0),t([l()],wn.prototype,"destroyer",void 0),t([l({type:qt})],wn.prototype,"graphic",void 0),t([l({readOnly:!0})],wn.prototype,"state",null),wn=t([e("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],wn);const yn=wn;let bn=class extends E{constructor(t,e){super(t,e),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=t=>{Array.from(t.querySelectorAll("a")).forEach((t=>{Ls(t.href)&&!t.hasAttribute("target")&&t.setAttribute("target","_blank")}))}}renderLoading(){return S("div",{class:"esri-feature-content__loader-container",key:"loader"},S("div",{class:"esri-feature-content__loader"}))}renderCreated(){var t;const e=null==(t=this.viewModel)?void 0:t.created;return e?e instanceof HTMLElement?S("div",{key:e,bind:e,afterCreate:this._attachToNode}):Te(e)?S("div",{key:e},!e.destroyed&&e.render()):S("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var t;const e=null==(t=this.viewModel)?void 0:t.state;return S("div",{class:"esri-feature-content"},"loading"===e?this.renderLoading():this.renderCreated())}_attachToNode(t){t.appendChild(this)}};t([F("viewModel.creator")],bn.prototype,"creator",void 0),t([F("viewModel.graphic")],bn.prototype,"graphic",void 0),t([l({type:yn})],bn.prototype,"viewModel",void 0),bn=t([e("esri.widgets.Feature.FeatureContent")],bn);const _n=bn;let Mn=class extends m{constructor(t){super(t),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:t,fieldInfos:e}=this,i=[];return null==e||e.forEach((e=>{if(e.hasOwnProperty("visible")&&!e.visible)return;const s=e.clone();s.label=$s(s,t),i.push(s)})),i}};t([l()],Mn.prototype,"attributes",void 0),t([l({type:[Bt]})],Mn.prototype,"expressionInfos",void 0),t([l()],Mn.prototype,"description",void 0),t([l({type:[Gt]})],Mn.prototype,"fieldInfos",void 0),t([l({readOnly:!0})],Mn.prototype,"formattedFieldInfos",null),t([l()],Mn.prototype,"title",void 0),Mn=t([e("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Mn);const xn=Mn,In=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];let kn=class extends E{constructor(t,e){super(t,e),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new xn,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new mn,_(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo()))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(t,e){const{attributes:i}=this.viewModel,s=t.fieldName,n=t.label||s,r=i?null==i[s]?"":i[s]:"",o=!(!t.format||!t.format.dateFormat),a="number"!=typeof r||o?function(t,e){if("string"!=typeof e||!e)return e;const i=function(t){let e=null;return In.some((i=>(i.pattern.test(t)&&(e=i),!!e))),e}(e);if(!i)return e;const s=e.match(i.pattern),n=I(I(i.label,{messages:t,hierPart:s&&s[2]}),{appName:i.appName});return e.replace(i.pattern,`<a${i.target?` target="${i.target}"`:""} href="$1"${"_blank"===i.target?' rel="noreferrer"':""}>${n}</a>`)}(this.messagesURIUtils,r):this._forceLTR(r),l={"esri-feature-fields__field-data--date":o};return S("tr",{key:`fields-element-info-row-${s}-${e}`},S("th",{key:`fields-element-info-row-header-${s}-${e}`,class:"esri-feature-fields__field-header",innerHTML:n}),S("td",{key:`fields-element-info-row-data-${s}-${e}`,class:this.classes("esri-feature-fields__field-data",l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:t}=this.viewModel;return null!=t&&t.length?S("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},S("tbody",null,t.map(((t,e)=>this.renderFieldInfo(t,e))))):null}render(){var t;return S("div",{class:"esri-feature-fields"},null==(t=this._featureElementInfo)?void 0:t.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:t,title:e}=this;this._featureElementInfo.set({description:t,title:e})}_forceLTR(t){return`&lrm;${t}`}};t([F("viewModel.attributes")],kn.prototype,"attributes",void 0),t([F("viewModel.description")],kn.prototype,"description",void 0),t([F("viewModel.expressionInfos")],kn.prototype,"expressionInfos",void 0),t([F("viewModel.fieldInfos")],kn.prototype,"fieldInfos",void 0),t([F("viewModel.title")],kn.prototype,"title",void 0),t([l({type:xn})],kn.prototype,"viewModel",void 0),t([l(),P("esri/widgets/Feature/t9n/Feature")],kn.prototype,"messages",void 0),t([l(),P("esri/widgets/support/t9n/uriUtils")],kn.prototype,"messagesURIUtils",void 0),kn=t([e("esri.widgets.Feature.FeatureFields")],kn);const An=kn,Cn=i.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),On=new Map;function Tn(t){if(!Xs(t))return null;const[e,i]=t.split("/").slice(1);return{layerId:e,fieldName:i}}let Fn=class extends m{constructor(t){super(t),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(t){this._setContentElementMedia(t)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(t){const{formattedMediaInfoCount:e}=this;this.activeMediaInfoIndex=(t+e)%e}_pageContentElementMedia(t){const{activeMediaInfoIndex:e}=this;this._setContentElementMedia(e+t)}_formatMediaInfos(){const{attributes:t,mediaInfos:e,formattedAttributes:i,expressionAttributes:s,fieldInfoMap:n,layer:r}=this;return null==e?void 0:e.map((e=>{if(!e)return null;if(e.title=qs({attributes:t,fieldInfoMap:n,globalAttributes:i,expressionAttributes:s,layer:r,text:e.title}),e.caption=qs({attributes:t,fieldInfoMap:n,globalAttributes:i,expressionAttributes:s,layer:r,text:e.caption}),e.altText=qs({attributes:t,fieldInfoMap:n,globalAttributes:i,expressionAttributes:s,layer:r,text:e.altText}),"image"===e.type){const{value:t}=e;return this._setImageValue({value:t,formattedAttributes:i,layer:r}),e.value.sourceURL?e:void 0}if("pie-chart"===e.type||"line-chart"===e.type||"column-chart"===e.type||"bar-chart"===e.type){const{value:s}=e;return this._setChartValue({value:s,chartType:e.type,attributes:t,formattedAttributes:i,layer:r}),e}return null})).filter(Boolean)}_setImageValue(t){const{fieldInfoMap:e}=this,{value:i,formattedAttributes:s,layer:n}=t,{linkURL:r,sourceURL:o}=i;if(o){const t=Gs(o,n);i.sourceURL=Bs({formattedAttributes:s,template:t,fieldInfoMap:e})}if(r){const t=Gs(r,n);i.linkURL=Bs({formattedAttributes:s,template:t,fieldInfoMap:e})}}_setChartValue(t){const{value:e,attributes:i,formattedAttributes:s,chartType:n,layer:r}=t,{popupTemplate:o,relatedInfos:a}=this,{fields:l,normalizeField:h}=e;if(e.fields=function(t,e){return t&&t.map((t=>js(t,e)))}(l,r),h&&(e.normalizeField=js(h,r)),!l.some((t=>!!(null!=s[t]||Xs(t)&&a.size))))return;const u=null==o?void 0:o.fieldInfos;l.forEach((t=>{if(Xs(t))return void(e.series=[...e.series,...this._getRelatedChartInfos({fieldInfos:u,fieldName:t,formattedAttributes:s,chartType:n,value:e})]);const r=this._getChartOption({value:e,attributes:i,chartType:n,formattedAttributes:s,fieldName:t,fieldInfos:u});e.series.push(r)}))}_getRelatedChartInfos(t){var e;const{fieldInfos:i,fieldName:s,formattedAttributes:n,chartType:r,value:o}=t,a=[],l=Tn(s),{layerId:h,fieldName:u}=l,c=null==(e=this.relatedInfos)?void 0:e.get(h.toString());if(!c)return a;const{relatedFeatures:d,relation:p}=c;if(!p||!d)return a;const{cardinality:f}=p;return d.forEach((t=>{const{attributes:e}=t;e&&Object.keys(e).forEach((t=>{t===u&&a.push(this._getChartOption({value:o,attributes:e,formattedAttributes:n,fieldName:s,chartType:r,relatedFieldName:t,fieldInfos:i}))}))})),"one-to-many"===f||"many-to-many"===f?a:[a[0]]}_getTooltip({label:t,value:e,chartType:i}){return"pie-chart"===i?t:`${t}: ${e}`}_getChartOption(t){var e;const{value:i,attributes:s,formattedAttributes:n,fieldName:r,relatedFieldName:o,fieldInfos:a,chartType:l}=t,{layer:h}=this,{normalizeField:u,tooltipField:c}=i,d=u?Xs(u)?s[Tn(u).fieldName]:s[u]:null,p=o&&void 0!==s[o]?s[o]:void 0!==s[r]?s[r]:n[r],f=void 0===p?null:p&&d?p/d:p,m=new Wt({value:f});if(Xs(r)){const t=Tn(r),e=Tn(c),i=e?e.fieldName:null,n=Ws(f,{fieldInfos:a,fieldName:o,layer:h,preventPlacesFormatting:!!d}),u=t?t.label||t.fieldName:o;return m.tooltip=this._getTooltip({label:i&&void 0!==s[i]?s[i]:u,value:n,chartType:l}),m}const v=Zs(a,r),g=js(r,h),w=c&&void 0!==n[c]?n[c]:$s(v||new Gt({fieldName:g}),null==(e=this.popupTemplate)?void 0:e.expressionInfos);return m.tooltip=this._getTooltip({label:w,value:n[g],chartType:l}),m}};t([l()],Fn.prototype,"activeMediaInfoIndex",void 0),t([l({readOnly:!0})],Fn.prototype,"activeMediaInfo",null),t([l()],Fn.prototype,"attributes",void 0),t([l()],Fn.prototype,"description",void 0),t([l()],Fn.prototype,"fieldInfoMap",void 0),t([l()],Fn.prototype,"formattedAttributes",void 0),t([l()],Fn.prototype,"expressionAttributes",void 0),t([l({readOnly:!0})],Fn.prototype,"formattedMediaInfos",null),t([l()],Fn.prototype,"layer",void 0),t([l({readOnly:!0})],Fn.prototype,"formattedMediaInfoCount",null),t([l()],Fn.prototype,"mediaInfos",void 0),t([l()],Fn.prototype,"popupTemplate",void 0),t([l()],Fn.prototype,"relatedInfos",void 0),t([l()],Fn.prototype,"title",void 0),Fn=t([e("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Fn);const Pn=Fn;var En=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],Vn=[{name:"default",colors:[].concat(En.slice(30,39),En.slice(28,30).reverse())},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const Sn=new Map([["ar",()=>import("./p-d24e109e.js").then((t=>t.a))],["bs-ba",()=>import("./p-165f141e.js").then((t=>t.b))],["ca-es",()=>import("./p-36445a12.js").then((t=>t.c))],["cs-cz",()=>import("./p-b138a877.js").then((t=>t.c))],["da-dk",()=>import("./p-28b53674.js").then((t=>t.d))],["de-de",()=>import("./p-295fbc0e.js").then((t=>t.d))],["de-ch",()=>import("./p-a872b03a.js").then((t=>t.d))],["el-gr",()=>import("./p-1ec951ac.js").then((t=>t.e))],["en-us",()=>import("./p-0f564f5d.js").then((t=>t.e))],["en-ca",()=>import("./p-1e21fbd5.js").then((t=>t.e))],["es-es",()=>import("./p-01fac15a.js").then((t=>t.e))],["et-ee",()=>import("./p-27e13221.js").then((t=>t.e))],["fi-fi",()=>import("./p-16a12fde.js").then((t=>t.f))],["fr-fr",()=>import("./p-f03e863b.js").then((t=>t.f))],["he-il",()=>import("./p-1ceae54f.js").then((t=>t.h))],["hr-hr",()=>import("./p-1fc325c7.js").then((t=>t.h))],["hu-hu",()=>import("./p-47772cf1.js").then((t=>t.h))],["id-id",()=>import("./p-c7fb14dd.js").then((t=>t.i))],["it-it",()=>import("./p-0019b2e1.js").then((t=>t.i))],["ja-jp",()=>import("./p-b44094da.js").then((t=>t.j))],["ko-kr",()=>import("./p-6cbe357e.js").then((t=>t.k))],["lt-lt",()=>import("./p-466f16d6.js").then((t=>t.l))],["lv-lv",()=>import("./p-411892f7.js").then((t=>t.l))],["nb-no",()=>import("./p-9531c1b9.js").then((t=>t.n))],["nl-nl",()=>import("./p-c58e407e.js").then((t=>t.n))],["pl-pl",()=>import("./p-5b2248a8.js").then((t=>t.p))],["pt-br",()=>import("./p-009f491a.js").then((t=>t.p))],["pt-pt",()=>import("./p-dcf3890e.js").then((t=>t.p))],["ro-ro",()=>import("./p-bcd2c290.js").then((t=>t.r))],["ru-ru",()=>import("./p-8943a0da.js").then((t=>t.r))],["sk-sk",()=>import("./p-e82931a9.js").then((t=>t.s))],["sl-sl",()=>import("./p-1c2ca123.js").then((t=>t.s))],["sr-rs",()=>import("./p-a9f696ad.js").then((t=>t.s))],["sv-se",()=>import("./p-4ca6902f.js").then((t=>t.s))],["th-th",()=>import("./p-2055e35f.js").then((t=>t.t))],["tr-tr",()=>import("./p-c0b0c346.js").then((t=>t.t))],["uk-ua",()=>import("./p-a7184375.js").then((t=>t.u))],["vi-vn",()=>import("./p-f06c242c.js").then((t=>t.v))],["zh-cn",()=>import("./p-3f123fdb.js").then((t=>t.z))],["zh-hk",()=>import("./p-5cd40670.js").then((t=>t.z))],["zh-tw",()=>import("./p-5cd40670.js").then((t=>t.z))]]);let Rn,Nn;const Ln="esri-feature-media__icon";let zn=class extends E{constructor(t,e){super(t,e),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new Pn,this.messages=null}initialize(){this._featureElementInfo=new mn,this.own(_(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],(()=>this._setupMediaRefreshTimer())),_(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo())))}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var t;return S("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},null==(t=this._featureElementInfo)?void 0:t.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:t}=this.viewModel;return t?S("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(t){const{_refreshIntervalInfo:e}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:s}=this.viewModel,{value:n,refreshInterval:r,altText:o,title:a,type:l}=t,{sourceURL:h,linkURL:u}=n,c=Ls(u)?"_blank":"_self",d="_blank"===c?"noreferrer":"",p=r?e:null,f=S("img",{alt:o||a,key:`media-${l}-${i}-${s}-${p?p.timestamp:0}`,src:p?p.sourceURL:h});return(u?S("a",{title:a,href:u,rel:d,target:c},f):null)||f}renderChartMediaInfo(t){const{activeMediaInfoIndex:e,formattedMediaInfoCount:i}=this.viewModel;return S("div",{key:`media-${t.type}-${e}-${i}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:t}=this.viewModel;return t?"image"===t.type?this.renderImageMediaInfo(t):-1!==t.type.indexOf("chart")?this.renderChartMediaInfo(t):null:null}renderMediaInfo(){const{activeMediaInfo:t}=this.viewModel;if(!t)return null;const e=t.title?S("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:t.title}):null,i=t.caption?S("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:t.caption}):null;return S("div",{key:"media-container",class:"esri-feature-media__item-container"},S("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),e,i)}renderMediaPageButton(t){if(this.viewModel.formattedMediaInfoCount<2)return null;const e="previous"===t,i=e?this.messages.previous:this.messages.next,s=this.classes("esri-feature-media__button",e?"esri-feature-media__previous":"esri-feature-media__next"),n=e?this.classes(Ln,"esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):this.classes(Ln,"esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),r=e?this.classes(Ln,"esri-feature-media__previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes(Ln,"esri-feature-media__next-icon--rtl","esri-icon-left-triangle-arrow");return S("button",{type:"button",key:e?"media-previous":"media-next",title:i,"aria-label":i,tabIndex:0,class:s,bind:this,onclick:e?this._previous:this._next},S("span",{"aria-hidden":"true",class:n}),S("span",{"aria-hidden":"true",class:r}))}_setupFeatureElementInfo(){const{description:t,title:e}=this;this._featureElementInfo.set({description:t,title:e})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getChartDependencies(t){const e=await async function(t=$()){if(t=function(t){return t?Sn.has(t.toLowerCase())?t.toLowerCase():function(t){const e=t.split("-")[0].toLowerCase();let i=null;for(const t of Sn.keys())if(t.startsWith(e)){i=t;break}return i}(t)||"en-us":"en-us"}(t),Rn&&t===Nn)return Rn;Rn=import("./p-8574655c.js").then((t=>t.i)),Nn=t;try{const[e,i]=await Promise.all([Rn,Sn.get(Nn)()]);Nn===t&&(e.am4core.options.defaultLocale=i.default),e.am4core.options.suppressWarnings=!0,e.am4core.options.autoDispose=!0}catch{return Rn=null,Nn=null,null}return Rn}(),{activeMediaInfo:i}=this.viewModel;this._renderChart({chartDiv:t,mediaInfo:i,chartsModule:e})}_handleMediaKeyup(t){const e=D(t);"ArrowLeft"===e&&(t.stopPropagation(),this.viewModel.previous()),"ArrowRight"===e&&(t.stopPropagation(),this.viewModel.next())}_renderChart(t){const{chartsModule:e,chartDiv:i,mediaInfo:s}=t,{value:n,type:r}=s,{am4core:o}=e,a=function(t,e="default"){const i=Vn.find((t=>t.name===e));return i?i.colors.map((e=>t.color(e))):null}(o);j()&&o.useTheme(e.am4themes_dark),o.useTheme(e.am4themes_animated),o.useTheme((function(t){t instanceof o.ColorSet&&a&&(t.list=a)}));const l="pie-chart"===r?this._createPieChart(t):this._createXYChart(t);i.setAttribute("aria-label",s.altText||s.title),l.data=n.series.map((t=>({tooltip:t.tooltip,value:t.value}))).filter((t=>"pie-chart"!==r||t.value>0))}_customizeChartTooltip(t,e){t.label.wrap=!0,t.label.maxWidth=200,t.autoTextColor=!1,t.getFillFromObject=!1,t.label.fill=e.color("#ffffff"),t.background.fill=e.color({r:0,g:0,b:0,a:.7})}_createPieChart(t){const{chartDiv:e,chartsModule:i}=t,{am4core:s,am4charts:n}=i,r=s.create(e,n.PieChart);r.rtl=L(this.container);const o=r.series.push(new n.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value="value",o.dataFields.category="tooltip",this._customizeChartTooltip(o.tooltip,s),r}_getMinSeriesValue(t){let e=0;return t.forEach((t=>e=Math.min(t.value,e))),e}_createColumnChart(t,e){const{chartsModule:i,mediaInfo:s}=e,{value:n}=s,{am4core:r,am4charts:o}=i,a=t.xAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,r),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dy=-a.tooltip.contentHeight}));const l=t.yAxes.push(new o.ValueAxis),h=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=.95,l.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(l.tooltip,r),h.wrap=!0;const u=t.series.push(new o.ColumnSeries);u.dataFields.valueY="value",u.dataFields.categoryX="tooltip",t.cursor=new o.XYCursor,n.series.length>15&&(t.scrollbarX=new r.Scrollbar)}_createBarChart(t,e){const{chartsModule:i,mediaInfo:s}=e,{value:n}=s,{am4core:r,am4charts:o}=i,a=t.yAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,r),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dx=a.tooltip.contentWidth}));const l=t.xAxes.push(new o.ValueAxis),h=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=.95,l.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(l.tooltip,r),h.wrap=!0;const u=t.series.push(new o.ColumnSeries);u.dataFields.valueX="value",u.dataFields.categoryY="tooltip",t.cursor=new o.XYCursor,n.series.length>15&&(t.scrollbarY=new r.Scrollbar)}_createLineChart(t,e){const{chartsModule:i,mediaInfo:s}=e,{value:n}=s,{am4core:r,am4charts:o}=i,a=t.xAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,r),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dy=-a.tooltip.contentHeight}));const l=t.yAxes.push(new o.ValueAxis),h=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=.95,l.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(l.tooltip,r),h.wrap=!0;const u=t.series.push(new o.LineSeries);u.dataFields.categoryX="tooltip",u.dataFields.valueY="value",t.cursor=new o.XYCursor,n.series.length>15&&(t.scrollbarX=new r.Scrollbar)}_createXYChart(t){const{chartDiv:e,chartsModule:i,mediaInfo:s}=t,{type:n}=s,{am4core:r,am4charts:o}=i,a=r.create(e,o.XYChart);return a.rtl=L(this.container),"column-chart"===n&&this._createColumnChart(a,t),"bar-chart"===n&&this._createBarChart(a,t),"line-chart"===n&&this._createLineChart(a,t),a}_clearMediaRefreshTimer(){const{_refreshTimer:t}=this;t&&(clearTimeout(t),this._refreshTimer=null)}_updateMediaInfoTimestamp(t){const e=Date.now();this._refreshIntervalInfo={timestamp:e,sourceURL:this._getImageSource(t,e)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:t}=this.viewModel;t&&"image"===t.type&&t.refreshInterval&&this._setRefreshTimeout(t)}_setRefreshTimeout(t){const{refreshInterval:e,value:i}=t;if(!e)return;const s=6e4*e;this._updateMediaInfoTimestamp(i.sourceURL);const n=setInterval((()=>{this._updateMediaInfoTimestamp(i.sourceURL)}),s);this._refreshTimer=n}_getImageSource(t,e){const i=-1!==t.indexOf("?")?"&":"?",[s,n=""]=t.split("#");return`${s}${i}timestamp=${e}${n?"#":""}${n}`}};t([F("viewModel.attributes")],zn.prototype,"attributes",void 0),t([F("viewModel.activeMediaInfoIndex")],zn.prototype,"activeMediaInfoIndex",void 0),t([F("viewModel.description")],zn.prototype,"description",void 0),t([F("viewModel.fieldInfoMap")],zn.prototype,"fieldInfoMap",void 0),t([F("viewModel.layer")],zn.prototype,"layer",void 0),t([F("viewModel.mediaInfos")],zn.prototype,"mediaInfos",void 0),t([F("viewModel.popupTemplate")],zn.prototype,"popupTemplate",void 0),t([F("viewModel.relatedInfos")],zn.prototype,"relatedInfos",void 0),t([F("viewModel.title")],zn.prototype,"title",void 0),t([l({type:Pn})],zn.prototype,"viewModel",void 0),t([l(),P("esri/widgets/Feature/t9n/Feature")],zn.prototype,"messages",void 0),zn=t([e("esri.widgets.Feature.FeatureMedia")],zn);const $n=zn,jn=["$datastore","$map","$layer","$aggregatedfeatures"],Dn=i.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");async function Un({graphic:t,view:e}){const{isAggregate:i,layer:s}=t;if(!i||!s||"2d"!==(null==e?void 0:e.type))return[];const n=await e.whenLayerView(s);if(!n.createQuery||!n.queryFeatures)return[];const r=n.createQuery();r.aggregateIds=[t.getObjectId()];const{features:o}=await n.queryFeatures(r);return o}async function qn({expressionAttributes:t,info:e,arcadeUtils:i,interceptor:s,spatialReference:n,map:r,graphic:o,view:a}){const l=`expression/${e.name}`,h=i.createSyntaxTree(e.expression),u=jn.filter((t=>i.hasVariable(h,t))),[c]=await U([Un({graphic:o,view:a}),i.loadScriptDependencies(h,!0,u)]),d=i.getViewInfo({spatialReference:n}),p=i.createExecContext(o,d);p.interceptor=s,p.useAsync=!0,function({aggregatedFeatures:t,arcadeUtils:e,featureSetVars:i,context:s,viewInfo:n,map:r,graphic:o,interceptor:a}){i.forEach((i=>{const l=i.toLowerCase();if("$map"===l&&(s.vars[l]=e.convertMapToFeatureSetCollection({map:r,spatialReference:n.sr,interceptor:a})),"$layer"===l&&(s.vars[l]=e.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:n.sr,interceptor:a})),"$datastore"===l&&(s.vars[l]=e.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:n.sr,interceptor:a})),"$aggregatedfeatures"===l){const i=o.layer,{fields:r,objectIdField:h,geometryType:u,spatialReference:c,displayField:d}=i,p=new Se({fields:r,objectIdField:h,geometryType:u,spatialReference:c,displayField:d,..."feature"===i.type?{templates:i.templates,typeIdField:i.typeIdField,types:i.types}:null,source:t});s.vars[l]=e.convertFeatureLayerToFeatureSet({layer:p,spatialReference:n.sr,interceptor:a})}}))}({aggregatedFeatures:c,arcadeUtils:i,featureSetVars:u,context:p,viewInfo:d,map:r,graphic:o,interceptor:s});const f=i.createFunction(h,p),m=await i.executeAsyncFunction(f,p).catch((t=>Dn.error("arcade-execution-error",{error:t,graphic:o,expressionInfo:e})));t[l]="string"==typeof m?Ys(Js(m)):Array.isArray(m)?function(t){return`<ul class="esri-widget__list">${t.map((t=>`<li>${"string"==typeof t?Ys(Js(t)):t}</li>`)).join("")}</ul>`}(m):m&&"esri.arcade.Dictionary"===m.declaredClass?function(t){return`<table class="esri-widget__table">${t.keys().map((e=>{const i=t.field(e);return`<tr><th>${e}</th><td>${"string"==typeof i?Ys(Js(i)):i}</td></tr>`})).join("")}</table>`}(m):m}async function Bn({popupTemplate:t,spatialReference:e,graphic:i,interceptor:s,map:n,view:r}){const o=t.expressionInfos,l=[],h={};if(!o||!o.length)return h;const u=await import("./p-4ddfade5.js").then((function(t){return t.as}));for(const t of o)l.push(qn({expressionAttributes:h,info:t,arcadeUtils:u,interceptor:s,spatialReference:e,map:n,graphic:i,view:r}));return await a(l),h}var Gn;const Hn="esri.widgets.FeatureViewModel",Wn=i.getLogger(Hn),Zn={attachmentsContent:!0,customContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};let Kn=Gn=class extends m{constructor(t){super(t),this._handles=new b,this._error=null,this._featureAbortController=null,this.graphicChangedThrottled=Ms(this.graphicChanged,1,this),this._expressionAttributes=null,this.abilities={...Zn},this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:e}=this;return"attachments"===t.type&&e.attachmentsContent||"custom"===t.type&&e.customContent||"fields"===t.type&&e.fieldsContent||"media"===t.type&&e.mediaContent||"text"===t.type&&e.textContent},this._handles.add(_(this,["graphic","_effectivePopupTemplate","abilities"],(()=>this.graphicChangedThrottled())))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return y(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function(t,e){const i=new Map;return t&&t.forEach((t=>{const s=js(t.fieldName,e);t.fieldName=s,i.set(s.toLowerCase(),t)})),i}(Ks(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Rs(this.graphic)}castAbilities(t){return{...Zn,...t}}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(t){this._set("graphic",t?t.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(t){void 0!==t?this._override("spatialReference",t):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(t){void 0!==t?this._override("map",t):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(t,e){const i=this.contentViewModels[t];i instanceof Pn&&i.setActiveMedia(e)}nextMedia(t){const e=this.contentViewModels[t];e instanceof Pn&&e.next()}previousMedia(t){const e=this.contentViewModels[t];e instanceof Pn&&e.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:t}=this;if(!t)return;const e=new AbortController;this._featureAbortController=e;try{await this._queryFeature({signal:e.signal})}catch(e){q(e)||(this._error=e,Wn.error("error","The popupTemplate could not be displayed for this feature.",{error:e,graphic:t,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===e&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:t}=this;t&&t.abort(),this._featureAbortController=null}_compileContent(t){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(t)?t.filter(this._isAllowedContentType).map(((t,e)=>"attachments"===t.type?this._compileAttachments(t,e):"custom"===t.type?this._compileCustom(t,e):"fields"===t.type?this._compileFields(t,e):"media"===t.type?this._compileMedia(t,e):"text"===t.type?this._compileText(t,e):void 0)):"string"==typeof t?this._compileText(new Zt({text:t}),0).text:t}_destroyContentViewModels(){this.contentViewModels.forEach((t=>t&&!t.destroyed&&t.destroy())),this._set("contentViewModels",[])}_compileAttachments(t,e){const{graphic:i}=this,{description:s,title:n}=t;return this.contentViewModels[e]=new pn({graphic:i,...this._compileTitleAndDesc({title:n,description:s})}),t}_compileCustom(t,e){const{graphic:i}=this,{creator:s,destroyer:n}=t;return this.contentViewModels[e]=new yn({graphic:i,creator:s,destroyer:n}),t}_compileTitleAndDesc({title:t,description:e}){const{_fieldInfoMap:i,_sourceLayer:s,graphic:n,formattedAttributes:r,_expressionAttributes:o}=this,{attributes:a}=n,l=r.global;return{title:qs({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:s,text:t}),description:qs({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:s,text:e})}}_compileFields(t,e){const{_effectivePopupTemplate:i,formattedAttributes:s}=this,n=t.clone(),r={...s.global,...s.content[e]},o=(null==t?void 0:t.fieldInfos)||(null==i?void 0:i.fieldInfos),a=null==o?void 0:o.filter((({fieldName:t})=>zs(t)||Xs(t)||r.hasOwnProperty(t))),l=null==i?void 0:i.expressionInfos,{description:h,title:u}=n,c=new xn({attributes:r,expressionInfos:l,fieldInfos:a,...this._compileTitleAndDesc({title:u,description:h})});return this.contentViewModels[e]=c,n.fieldInfos=c.formattedFieldInfos.slice(0),n}_compileMedia(t,e){const{graphic:i,_fieldInfoMap:s,_effectivePopupTemplate:n,relatedInfos:r,_sourceLayer:o,_expressionAttributes:a}=this,{attributes:l}=i,h=this.formattedAttributes.global,u=t.clone(),{description:c,mediaInfos:d,title:p}=u,f=new Pn({activeMediaInfoIndex:u.activeMediaInfoIndex||0,attributes:l,layer:o,fieldInfoMap:s,formattedAttributes:h,expressionAttributes:a,mediaInfos:d,popupTemplate:n,relatedInfos:r,...this._compileTitleAndDesc({title:p,description:c})});return u.mediaInfos=f.formattedMediaInfos.slice(0),this.contentViewModels[e]=f,u}_compileText(t,e){const i=t.clone(),{graphic:s,_fieldInfoMap:n,_sourceLayer:r,_expressionAttributes:o}=this;if(i&&i.text){const{attributes:t}=s;i.text=qs({attributes:t,fieldInfoMap:n,globalAttributes:this.formattedAttributes.global,expressionAttributes:o,layer:r,text:i.text})}return this.contentViewModels[e]=new yn({graphic:s,creator:i.text}),i}_compileLastEditInfo(){const{_effectivePopupTemplate:t,_sourceLayer:e,graphic:i}=this;if(!t)return;const{lastEditInfoEnabled:s}=t,n=null==e?void 0:e.editFieldsInfo;return s&&n?function(t,e){const{creatorField:i,creationDateField:s,editorField:n,editDateField:r}=t;if(!e)return;const o=e[r];if("number"==typeof o){const t=e[n];return{type:"edit",date:C(o,Ss),user:t}}const a=e[s];if("number"==typeof a){const t=e[i];return{type:"create",date:C(a,Ss),user:t}}return null}(n,i.attributes):void 0}_compileTitle(t){const{_fieldInfoMap:e,_sourceLayer:i,graphic:s,_expressionAttributes:n}=this,{attributes:r}=s;return qs({attributes:r,fieldInfoMap:e,globalAttributes:this.formattedAttributes.global,expressionAttributes:n,layer:i,text:t})}async _getTitle(){const{_effectivePopupTemplate:t,graphic:e}=this;return Ns(null==t?void 0:t.title,{graphic:e})}async _getContent(){const{_effectivePopupTemplate:t,graphic:e}=this;return Ns(null==t?void 0:t.content,{graphic:e})}async _queryFeature(t){const{_featureAbortController:e,_sourceLayer:i,graphic:s,_effectivePopupTemplate:n,spatialReference:r,map:o,view:l}=this,{content:{value:h},title:{value:u}}=await a({content:this._getContent(),title:this._getTitle()});if(e!==this._featureAbortController||!s)return;await async function({graphic:t,popupTemplate:e,layer:i,spatialReference:s},n){if(!i||!e)return;if("function"==typeof i.load&&await i.load(n),!t.attributes)return;const r=t.attributes[i.objectIdField];if(null==r)return;const o=[r],a=await e.getRequiredFields(i.fieldsIndex),l=Dt(a,t),h=l?[]:a,u=e.returnGeometry||await async function(t){var e;if(null==(e=t.expressionInfos)||!e.length)return!1;const i=await Ut(),{arcadeUtils:{hasGeometryFunctions:s}}=i;return s(t)}(e);if(l&&!u)return;const c=await async function(t,e){var i,s;const{layer:n,graphic:r,outFields:o,objectIds:a,returnGeometry:l,spatialReference:h}=t,u=a[0];if("number"!=typeof u&&"string"!=typeof u)return Is.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:n,graphic:r,objectId:u,requiredFields:o}),null;if(null==(i=n.capabilities)||null==(s=i.operations)||!s.supportsQuery)return Is.warn("The specified layer cannot be queried. The following fields will not be available.",{layer:n,graphic:r,requiredFields:o,returnGeometry:l}),null;const c=n.createQuery();return c.objectIds=a,c.outFields=null!=o&&o.length?o:[n.objectIdField],c.returnGeometry=!!l,c.returnZ=!!l,c.returnM=!!l,c.outSpatialReference=h,(await n.queryFeatures(c,e)).features[0]}({layer:i,graphic:t,outFields:h,objectIds:o,returnGeometry:u,spatialReference:s},n);c&&(c.geometry&&(t.geometry=c.geometry),c.attributes&&(t.attributes={...t.attributes,...c.attributes}))}({graphic:s,popupTemplate:n,layer:i,spatialReference:r},t);const{expressionAttributes:{value:c}}=await a({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:Bn({popupTemplate:this._effectivePopupTemplate,spatialReference:r,graphic:s,map:o,interceptor:Gn.interceptor,view:l})});e===this._featureAbortController&&s&&(this._expressionAttributes=c,this._set("formattedAttributes",this._createFormattedAttributes(h,c)),this._set("title",this._compileTitle(u)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(h)||null))}_createFormattedAttributes(t,e){const{_effectivePopupTemplate:i,graphic:s,relatedInfos:n,_sourceLayer:r,_fieldInfoMap:o}=this,a={...s.attributes,...e},l={global:Qs({fieldInfos:null==i?void 0:i.fieldInfos,graphic:s,attributes:a,layer:r,fieldInfoMap:o,relatedInfos:n}),content:[]};return Array.isArray(t)&&t.forEach(((t,e)=>{"fields"===t.type&&t.fieldInfos&&(l.content[e]=Qs({fieldInfos:t.fieldInfos,graphic:s,attributes:a,layer:r,fieldInfoMap:o,relatedInfos:n}))})),l}_checkForRelatedFeatures(t){const{graphic:e,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(e,Ks(i),t)}async _queryRelatedInfos(t,e,i){const{relatedInfos:s,_sourceLayer:r}=this;s.clear();const o=y(r.associatedLayer)?await r.associatedLayer.load(i):r;if(!o)return;const l=e.filter((t=>t&&Xs(t.fieldName)));if(!l||!l.length)return;e.forEach((t=>this._configureRelatedInfo(t,o)));const h=await function({relatedInfos:t,layer:e},i){const s={};return t.forEach(((t,r)=>{const{relation:o}=t;if(!o){const t=new n("relation-required","A relation is required on a layer to retrieve related records.");throw Cn.error(t),t}const{relatedTableId:a}=o;if("number"!=typeof a){const t=new n("A related table ID is required on a layer to retrieve related records.");throw Cn.error(t),t}const l=`${e.url}/${a}`,h=On.get(l),u=h||function(t,e){return z(t,{query:{f:"json"},signal:e&&e.signal})}(l,i);h||On.set(l,u),s[r]=u})),a(s)}({relatedInfos:s,layer:o},i);Object.keys(h).forEach((t=>{var e;const i=s.get(t.toString()),n=null==(e=h[t])?void 0:e.value;i&&n&&(i.layerInfo=n.data)}));const u=await function({graphic:t,relatedInfos:e,layer:i},s){const n={};return e.forEach(((e,r)=>{e.layerInfo&&(n[r]=async function(t,e,i,s){const n=i.layerId.toString(),{layerInfo:r,queryTask:o,relation:l,relatedFields:h,outStatistics:u}=e,c=function({originRelationship:t,relationships:e,layerId:i}){let s;return e&&e.some((e=>(`${e.relatedTableId}`===i&&e.id===t.id&&(s=e),!!s))),s}({originRelationship:l,relationships:r.relationships,layerId:n});if(c.relationshipTableId&&c.keyFieldInRelationshipTable){const e=(await function(t,e,i,s){const n=new Ae;return n.outFields=["*"],n.relationshipId="number"==typeof e.id?e.id:parseInt(e.id,10),n.objectIds=[t.attributes[i.objectIdField]],i.queryRelatedFeatures(n,s)}(t,c,i,s))[t.attributes[i.objectIdField]];if(!e)return null;const n=e.features.map((t=>t.attributes[r.objectIdField]));if((null==u?void 0:u.length)>0&&r.supportsStatistics){const t=new Pe;t.where=function(t,e){let i=0;const s=[];for(;i<e.length;)s.push(`${t} IN (${e.slice(i,1e3+i)})`),i+=1e3;return s.join(" OR ")}(r.objectIdField,n),t.outFields=h,t.outStatistics=u;const i={features:Promise.resolve(e),statsFeatures:o.execute(t)};return a(i)}}const d=null==c?void 0:c.keyField;if(d){const i=Ht(function(t,e){if(null!=t){e=e.toLowerCase();for(const i of t)if(i&&i.name.toLowerCase()===e)return i}return null}(r.fields,d)),n=function(t,e){const i=e.toLowerCase();for(const e in t)if(e.toLowerCase()===i)return t[e];return null}(t.attributes,l.keyField),h=i?`${d}=${n}`:`${d}='${n}'`,u=o.execute(new Pe({where:h,outFields:e.relatedFields}),s),c=e.outStatistics&&e.outStatistics.length>0&&r.supportsStatistics?o.execute(new Pe({where:h,outFields:e.relatedFields,outStatistics:e.outStatistics}),s):null,p={features:u};return c&&(p.statsFeatures=c),a(p)}return null}(t,e,i,s))})),a(n)}({graphic:t,relatedInfos:s,layer:o},i);Object.keys(u).forEach((t=>{var e;!function(t,e){if(!e)return;if(!t)return;const{features:i,statsFeatures:s}=t,n=i&&i.value;e.relatedFeatures=n?n.features:[];const r=s&&s.value;e.relatedStatsFeatures=r?r.features:[]}(null==(e=u[t])?void 0:e.value,s.get(t.toString()))}))}_configureRelatedInfo(t,e){const{relatedInfos:i}=this,s=Tn(t.fieldName);if(!s)return;const{layerId:n,fieldName:r}=s;if(!n)return;const o=i.get(n.toString())||function(t,e){const i=function(t,e){if(!e.relationships)return null;let i=null;const{relationships:s}=e;return s.some((e=>e.id===parseInt(t,10)&&(i=e,!0))),i}(t,e);if(!i)return;const s=`${e.url}/${i.relatedTableId}`;return{url:s,queryTask:new Ve({url:s,sourceSpatialReference:e.spatialReference}),relation:i,relatedFields:[],outStatistics:[]}}(n,e);o&&(function({relatedInfo:t,fieldName:e,fieldInfo:i}){if(t.relatedFields.push(e),i.statisticType){const s=new Ee({statisticType:i.statisticType,onStatisticField:e,outStatisticFieldName:e});t.outStatistics.push(s)}}({relatedInfo:o,fieldName:r,fieldInfo:t}),this.relatedInfos.set(n,o))}};Kn.interceptor=new class{constructor(t,e){this.preLayerQueryCallback=t,this.preRequestCallback=e,this.preLayerQueryCallback||(this.preLayerQueryCallback=()=>{}),this.preRequestCallback||(this.preLayerQueryCallback=()=>{})}}((({query:t,layer:e,method:i})=>{sn({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})}),(({queryPayload:t,layer:e,method:i})=>{sn({layer:e,method:i,query:t,definitionExpression:`${e.definitionExpression} ${e.serviceDefinitionExpression}`})})),t([l()],Kn.prototype,"_error",void 0),t([l()],Kn.prototype,"_featureAbortController",void 0),t([l({readOnly:!0})],Kn.prototype,"_effectivePopupTemplate",null),t([l({readOnly:!0})],Kn.prototype,"_fieldInfoMap",null),t([l({readOnly:!0})],Kn.prototype,"_sourceLayer",null),t([l()],Kn.prototype,"abilities",void 0),t([g("abilities")],Kn.prototype,"castAbilities",null),t([l({readOnly:!0})],Kn.prototype,"content",void 0),t([l({readOnly:!0})],Kn.prototype,"contentViewModels",void 0),t([l({type:Boolean})],Kn.prototype,"defaultPopupTemplateEnabled",void 0),t([l({readOnly:!0})],Kn.prototype,"state",null),t([l({readOnly:!0})],Kn.prototype,"formattedAttributes",void 0),t([l({type:qt,value:null})],Kn.prototype,"graphic",null),t([l({readOnly:!0})],Kn.prototype,"lastEditInfo",void 0),t([l()],Kn.prototype,"relatedInfos",void 0),t([l()],Kn.prototype,"spatialReference",null),t([l({readOnly:!0})],Kn.prototype,"title",void 0),t([l()],Kn.prototype,"map",null),t([l({readOnly:!0})],Kn.prototype,"waitingForContent",null),t([l()],Kn.prototype,"view",void 0),Kn=Gn=t([e(Hn)],Kn);const Jn=Kn,Yn=i=>{let s=class extends i{constructor(){super(...arguments),this.renderNodeContent=t=>Te(t)&&!t.destroyed?S("div",{key:t},t.render()):t instanceof HTMLElement?S("div",{key:t,bind:t,afterCreate:this._attachToNode}):Fe(t)?S("div",{key:t,bind:t.domNode,afterCreate:this._attachToNode}):null}_attachToNode(t){t.appendChild(this)}};return s=t([e("esri.widgets.Feature.ContentMixin")],s),s},Qn="esri-feature__content-element",Xn={title:!0,content:!0,lastEditedInfo:!0};let tr=class extends(Yn(E)){constructor(t,e){super(t,e),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements={...Xn},this.map=null,this.view=null,this.viewModel=new Jn}initialize(){this.own(_(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))}loadDependencies(){return import("./p-4bfc732a.js")}destroy(){this._destroyContentWidgets()}castVisibleElements(t){return{...Xn,...t}}render(){const{state:t}=this.viewModel,e=S("div",{class:"esri-feature__size-container",key:"container"},this.renderTitle(),"error"===t?this.renderError():"loading"===t?this.renderLoading():this.renderContentContainer());return S("div",{class:this.classes("esri-feature","esri-widget")},e)}setActiveMedia(t,e){this.viewModel.setActiveMedia(t,e)}nextMedia(t){this.viewModel.nextMedia(t)}previousMedia(t){this.viewModel.previousMedia(t)}renderError(){const{messagesCommon:t,messages:e,visibleElements:i}=this;return S("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},i.title?S("div",{key:"error-title",slot:"title"},t.errorMessage):null,S("div",{key:"error-message",slot:"message"},e.loadingError))}renderLoading(){return S("div",{key:"loading-container",class:"esri-feature__loading-container"},S("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))}renderContentContainer(){const{visibleElements:t}=this;return t.content?S("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:t,title:e}=this;return t.title?S(Ce,{level:this.headingLevel,class:"esri-feature__title",innerHTML:e}):null}renderContent(){const t=this.viewModel.content,e="content";if(!t)return null;if(Array.isArray(t))return t.length?S("div",{key:`${e}-content-elements`},t.map(this.renderContentElement,this)):null;if("string"==typeof t){const t=this._contentWidgets[0];return!t||t.destroyed?null:S("div",{key:`${e}-content`},t.render())}return this.renderNodeContent(t)}renderContentElement(t,e){const{visibleElements:i}=this;if("boolean"!=typeof i.content&&!i.content[t.type])return null;switch(t.type){case"attachments":return this.renderAttachments(e);case"custom":return this.renderCustom(t,e);case"fields":return this.renderFields(e);case"media":return this.renderMedia(e);case"text":return this.renderText(t,e);default:return null}}renderAttachments(t){const e=this._contentWidgets[t];if(!e||e.destroyed)return null;const{state:i,attachmentInfos:s}=e.viewModel;return"loading"===i||s.length>0?S("div",{key:this._buildKey("attachments-element",t),class:this.classes(Qn)},e.render()):null}renderCustom(t,e){const{creator:i}=t,s=this._contentWidgets[e];return!s||s.destroyed?null:i?S("div",{key:this._buildKey("custom-element",e),class:Qn},s.render()):null}renderFields(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:S("div",{key:this._buildKey("fields-element",t),class:Qn},e.render())}renderMedia(t){const e=this._contentWidgets[t];return!e||e.destroyed?null:S("div",{key:this._buildKey("media-element",t),class:Qn},e.render())}renderLastEditInfo(){const{visibleElements:t,messages:e}=this,{lastEditInfo:i}=this.viewModel;if(!i||!t.lastEditedInfo)return null;const{date:s,user:n}=i,r=B("edit"===i.type?n?e.lastEditedByUser:e.lastEdited:n?e.lastCreatedByUser:e.lastCreated,{date:s,user:n});return S("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info",Qn)},r)}renderText(t,e){const i=this._contentWidgets[e];return!i||i.destroyed?null:t.text?S("div",{key:this._buildKey("text-element",e),class:this.classes(Qn,"esri-feature__text")},i.render()):null}_buildKey(t,...e){return`${t}__${this.get("viewModel.graphic.uid")||"0"}-${e.join("-")}`}_destroyContentWidgets(){this._contentWidgets.forEach((t=>{t.viewModel=null,t&&!t.destroyed&&t.destroy()})),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:t,visibleElements:e}=this,i=this.get("viewModel.content"),{contentViewModels:s}=this.viewModel;if(Array.isArray(i))i.forEach(((i,n)=>{"attachments"===i.type&&(this._contentWidgets[n]=new gn({displayType:i.displayType,headingLevel:e.title?t+1:t,viewModel:s[n]})),"fields"===i.type&&(this._contentWidgets[n]=new An({viewModel:s[n]})),"media"===i.type&&(this._contentWidgets[n]=new $n({viewModel:s[n]})),"text"===i.type&&(this._contentWidgets[n]=new _n({viewModel:s[n]})),"custom"===i.type&&(this._contentWidgets[n]=new _n({viewModel:s[n]}))}),this);else{const t=s[0];t&&!t.destroyed&&(this._contentWidgets[0]=new _n({viewModel:t}))}this.scheduleRender()}};t([F("viewModel.graphic")],tr.prototype,"graphic",void 0),t([F("viewModel.defaultPopupTemplateEnabled")],tr.prototype,"defaultPopupTemplateEnabled",void 0),t([l()],tr.prototype,"headingLevel",void 0),t([l({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],tr.prototype,"label",void 0),t([l(),P("esri/widgets/Feature/t9n/Feature")],tr.prototype,"messages",void 0),t([l(),P("esri/t9n/common")],tr.prototype,"messagesCommon",void 0),t([l(),P("esri/widgets/support/t9n/uriUtils")],tr.prototype,"messagesURIUtils",void 0),t([F("viewModel.spatialReference")],tr.prototype,"spatialReference",void 0),t([F("viewModel.title")],tr.prototype,"title",void 0),t([l()],tr.prototype,"visibleElements",void 0),t([g("visibleElements")],tr.prototype,"castVisibleElements",null),t([F("viewModel.map")],tr.prototype,"map",void 0),t([F("viewModel.view")],tr.prototype,"view",void 0),t([l({type:Jn})],tr.prototype,"viewModel",void 0),tr=t([e("esri.widgets.Feature")],tr);const er=tr;let ir=class extends f.EventedAccessor{constructor(t){super(t),this._anchorHandles=new b,this.location=null,this.screenLocation=null,this.screenLocationEnabled=!1,this.view=null,this._anchorHandles.add([G(this,["screenLocationEnabled","location","view.size","view.stationary"],(()=>this._updateScreenPointAndHandle())),G(this,["view","view.ready"],(()=>this._wireUpView()))])}destroy(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null}_wireUpView(){const t="view";if(this._anchorHandles.remove(t),this._viewpointHandle=null,!this.get("view.ready"))return;this._setScreenLocation();const{view:e}=this,i=H(e,"3d"===e.type?"camera":"viewpoint",(()=>this._viewpointChange()));this._anchorHandles.add(i,t),this._viewpointHandle=i,this._toggleWatchingViewpoint()}_viewpointChange(){this._setScreenLocation(),this.emit("view-change")}_updateScreenPointAndHandle(){this._setScreenLocation(),this._toggleWatchingViewpoint()}_toggleWatchingViewpoint(){const{_viewpointHandle:t,location:e,screenLocationEnabled:i}=this;t&&(e&&i?t.resume():t.pause())}_setScreenLocation(){const{location:t,view:e,screenLocationEnabled:i}=this,s=this.get("view.ready"),n=i&&s&&y(t)?e.toScreen(t):null;this._set("screenLocation",n)}};t([l()],ir.prototype,"location",void 0),t([l({readOnly:!0})],ir.prototype,"screenLocation",void 0),t([l()],ir.prototype,"screenLocationEnabled",void 0),t([l()],ir.prototype,"view",void 0),ir=t([e("esri.widgets.support.AnchorElementViewModel")],ir);const sr=ir;let nr=class extends sr{constructor(t){super(t),this.visible=!1}};t([l()],nr.prototype,"visible",void 0),nr=t([e("esri.widgets.CompassViewModel")],nr);const rr=nr;let or=class extends E{constructor(t,e){super(t,e),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new rr,this.visible=!1}initialize(){this.own([G(this,"visible",(t=>this._visibleChange(t)))])}destroy(){this._animationPromise=null}show(t){const{location:e,promise:i}=t;e&&(this.viewModel.location=e),this.visible=!0,i&&i.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:t}=this,{screenLocation:e}=this.viewModel,i=!!e,s={"esri-spinner--start":t&&i,"esri-spinner--finish":!t&&i},n=this._getPositionStyles();return S("div",{class:this.classes("esri-spinner",s),styles:n})}_visibleChange(t){if(t)return void(this.viewModel.screenLocationEnabled=!0);const e=W(this._animationDelay);this._animationPromise=e,e.catch((()=>{})).then((()=>{this._animationPromise===e&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:t,view:e}=this.viewModel;if(!e||v(t))return{};const{padding:i}=e;return{left:t.x-i.left+"px",top:t.y-i.top+"px"}}};t([F("viewModel.location")],or.prototype,"location",void 0),t([F("viewModel.view")],or.prototype,"view",void 0),t([l({type:rr})],or.prototype,"viewModel",void 0),t([F("viewModel.visible")],or.prototype,"visible",void 0),or=t([e("esri.widgets.Spinner")],or);const ar=or,lr=Z("mac")?"Meta":"Ctrl",hr={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)hr[t]=String.fromCharCode(t);for(let t=1;t<25;t++)hr[111+t]=`F${t}`;for(let t=65;t<91;t++)hr[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function ur(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class cr{constructor(t,e=[]){this.eventType=t,this.keyModifiers=e}matches(t){if(t.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const e=t.modifiers;for(const t of this.keyModifiers)if(!e.has(t))return!1;return!0}}const dr=i.getLogger("esri.views.input.InputHandler");class pr{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const e=this._incoming[t];for(const t of e)this._incomingEventMatches.push(t.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((t=>t.eventType))),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?dr.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback((t=>this._handleEvent(t))),t.setUninstallCallback((()=>this._onUninstall())),this._manager=t)}onUninstall(){}registerIncoming(t,e,i){let s;"function"==typeof e?(i=e,s=[]):s=e||[];const n="string"==typeof t?new cr(t,s):t,r=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},o=t=>{const e=this._incoming[t.match.eventType];if(e){const i=e.indexOf(t);e.splice(i,1),r(),this._manager&&this._manager.updateDependencies()}},a=new fr(n,i,{onPause:o,onRemove:o,onResume:t=>{const e=this._incoming[t.match.eventType];e&&-1===e.indexOf(t)&&(e.push(t),r(),this._manager&&this._manager.updateDependencies())}});let l=this._incoming[n.eventType];return l||(l=[],this._incoming[n.eventType]=l),l.push(a),r(),this._manager&&this._manager.updateDependencies(),a}registerOutgoing(t){if(this._outgoing[t])throw Error("There is already a callback registered for this outgoing InputEvent: "+t);const e=new mr(t,{onEmit:(t,e,i,s)=>{this._manager.emit(t.eventType,e,i,s)},onRemove:t=>{delete this._outgoing[t.eventType],this._manager.updateDependencies()}});return this._outgoing[t]=e,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),e}startCapturingPointer(t){this._manager.setPointerCapture(t,!0)}stopCapturingPointer(t){this._manager.setPointerCapture(t,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):dr.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){const e=this._incoming[t.type];if(e)for(const i of e)if(i.match.matches(t)&&(i.callback(t),t.shouldStopPropagation()))break}}class fr{constructor(t,e,i){this.match=t,this._callback=e,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class mr{constructor(t,e){this.eventType=t,this._removed=!1,this._handler=e}emit(t,e,i){this._removed||this._handler.onEmit(this,t,e,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}class vr extends pr{constructor(t){super(!0),this._onChange=t,this._value="mouse",this.registerIncoming("pointer-down",(t=>{this._setValue("touch"===t.data.native.pointerType?"touch":"mouse")})),this._moveHandler=this.registerIncoming("pointer-move",(t=>{this._setValue("touch"===t.data.native.pointerType?"touch":"mouse")})),this._moveHandler.pause()}_setValue(t){t!==this._value&&("touch"===t?this._moveHandler.resume():this._moveHandler.pause(),this._value=t,this._onChange(t))}}const gr=i.getLogger("esri.views.input.InputManager");let wr=class extends m{constructor(t){super(t),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=lr,this.latestPointerType="mouse",this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const t=Object.keys(this._nameToGroup);for(const e of t)this.uninstallHandlers(e);this.eventSource=null,this._currentPropagation=null}get hasPendingInputs(){return this._handlers.some((t=>t.handler.hasPendingInputs))}installHandlers(t,e,i=br.INTERNAL){if(this._nameToGroup[t])return void gr.error("There is already an InputHandler group registered under the name `"+t+"`");if(0===e.length)return void gr.error("Can't register a group of zero handlers");const s={name:t,handlers:e.map((t=>({handler:t,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null})))};this._nameToGroup[t]=s;for(let t=s.handlers.length-1;t>=0;t--){const e=s.handlers[t];this._handlers.push(e),e.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(t,i,s,n,r)=>{this._emitInputEvent(e.priorityIndex+1,t,i,s,r,n)},setPointerCapture:(t,i)=>{this._setPointerCapture(s,e,t,i)},setEventCallback:t=>{e.eventCallback=t},setUninstallCallback:t=>{e.uninstallCallback=t},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(t){const e=this._nameToGroup[t];e?(e.handlers.forEach((t=>{t.removed=!0,t.uninstallCallback()})),delete this._nameToGroup[t],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):gr.error("There is no InputHandler group registered under the name `"+t+"`")}hasHandlers(t){return void 0!==this._nameToGroup[t]}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const t=new Set,e=new Set;this._handlersPriority=[];for(let t=this._handlers.length-1;t>=0;t--){const e=this._handlers[t];e.priorityIndex=t,this._handlersPriority.push(e)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const s=this._handlersPriority[i];s.priorityIndex=i;let n=s.handler.hasSideEffects;if(!n)for(const e of s.handler.outgoingEventTypes)if(t.has(e)){n=!0;break}if(n)for(const i of s.handler.incomingEventMatches){t.add(i.eventType);for(const t of i.keyModifiers)ur(t)||e.add(t)}s.active=n}this._sourceEvents=t,this._keyModifiers=e,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointerType(t){this._set("latestPointerType",t)}_onEventReceived(t,e){"pointer-capture-lost"===t&&this._pointerCaptures.delete(e.native.pointerId),this._updateKeyModifiers(t,e),this._emitInputEventFromSource(t,e,null!=this.test.timestamp?this.test.timestamp:e.native?e.native.timestamp:void 0,e.native?e.native.cancelable:void 0)}_updateKeyModifiers(t,e){if(!e)return;let i=!1;const s=()=>{if(!i){const t=new Set;this._activeKeyModifiers.forEach((e=>{t.add(e)})),this._activeKeyModifiers=t,i=!0}},n=(t,e)=>{e&&!this._activeKeyModifiers.has(t)?(s(),this._activeKeyModifiers.add(t)):!e&&this._activeKeyModifiers.has(t)&&(s(),this._activeKeyModifiers.delete(t))};if("key-down"===t||"key-up"===t){const i=e.key;this._keyModifiers.has(i)&&n(i,"key-down"===t)}const r=e.native;n("Alt",!(!r||!r.altKey)),n("Ctrl",!(!r||!r.ctrlKey)),n("Shift",!(!r||!r.shiftKey)),n("Meta",!(!r||!r.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerTypeHandler=new vr((t=>this._setLatestPointerType(t))),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,br.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],br.INTERNAL)}_setPointerCapture(t,e,i,s){const n=t.name+"-"+e.priorityIndex,r=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,r),s?(r.add(n),1===r.size&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):r.has(n)&&(r.delete(n),0===r.size&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter((t=>!t.removed)),this.updateDependencies()}_emitInputEventFromSource(t,e,i,s){this._emitInputEvent(0,t,e,i,s)}_emitInputEvent(t,e,i,s,n,r){const o=void 0!==s?s:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a={event:new yr(e,i,o,r||this._activeKeyModifiers,void 0!==n&&n),priorityIndex:t};this._currentPropagation?this._currentPropagation.events.push(a):this._doNewPropagation(a)}_doNewPropagation(t){this._currentPropagation={events:new Ne,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:t.event.timestamp},this._currentPropagation.events.push(t),this._continuePropagation()}_continuePropagation(){const t=this._currentPropagation;if(t){for(;this._currentPropagation.events.length>0;){const{event:e,priorityIndex:i}=this._currentPropagation.events.pop(),s=e.data&&e.data.eventId;if(null==s||!this._stoppedPropagationEventIds.has(s))for(t.currentHandler=this._handlersPriority[i];t.currentHandler;){if(t.currentHandler.removed)t.needsHandlerGarbageCollect=!0;else{if(t.currentHandler.active&&!e.shouldStopPropagation()&&t.currentHandler.eventCallback(e),e.shouldStopPropagation()){null!=s&&this._stoppedPropagationEventIds.add(s);break}if(e.shouldPausePropagation((()=>this._continuePropagation())))return void this._pausePropagation({event:e,priorityIndex:t.currentHandler.priorityIndex+1})}t.currentHandler=this._handlersPriority[t.currentHandler.priorityIndex+1]}}t.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(t){const e=new Ne;for(e.push(t);this._currentPropagation.events.length;)e.push(this._currentPropagation.events.pop());this._currentPropagation.events=e,this._currentPropagation.currentHandler=null}_compareHandlerPriority(t,e){if(t.handler.hasSideEffects!==e.handler.hasSideEffects)return t.handler.hasSideEffects?1:-1;if(t.groupPriority!==e.groupPriority)return t.groupPriority>e.groupPriority?-1:1;for(const i of t.handler.incomingEventMatches)for(const t of e.handler.incomingEventMatches){if(i.eventType!==t.eventType)continue;const e=i.keyModifiers.filter((e=>-1!==t.keyModifiers.indexOf(e)));if(e.length===i.keyModifiers.length!=(e.length===t.keyModifiers.length))return i.keyModifiers.length>t.keyModifiers.length?-1:1}return t.priorityIndex>e.priorityIndex?-1:1}_sortHandlersPriority(t){const e=[];for(const i of t){let t=0;for(;t<e.length&&this._compareHandlerPriority(i,e[t])>=0;)t++;e.splice(t,0,i)}return e}get debug(){const t=t=>{const e=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=e};return{injectEvent:(e,i)=>{t((()=>{this._onEventReceived(e,i)}))},disablePointerCapture:t}}};t([l({readOnly:!0})],wr.prototype,"hasPendingInputs",null),t([l()],wr.prototype,"eventSource",void 0),t([l()],wr.prototype,"recognizers",void 0),t([l({readOnly:!0})],wr.prototype,"latestPointerType",void 0),wr=t([e("esri.views.input.InputManager")],wr);class yr{constructor(t,e,i,s,n){this.type=t,this.data=e,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=0,this._resumeCallback=null}stopPropagation(){this._propagationState|=1}shouldStopPropagation(){return 0!=(1&this._propagationState)}async(t){this._propagationState|=2;const e=(t,e)=>{this._propagationState&=-3;const i=this._resumeCallback;if(this._resumeCallback=null,i&&i(),e)throw t;return t};return("function"==typeof t?t():t).then((t=>e(t,!1)),(t=>e(t,!0)))}shouldPausePropagation(t){return!!(2&this._propagationState)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}const br={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3},_r=new Kt({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),Mr=new Kt({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),xr=new Kt({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),Ir=new Kt({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:"esri-icon-table"}),kr=i.getLogger("esri.widgets.Popup.PopupViewModel");function Ar(t){const{selectedFeature:e,location:i,view:s}=t;return s?"3d"===s.type?e||i:t.get("selectedFeature.geometry")||i:null}const Cr=s.ofType({key:"type",defaultKeyValue:"button",base:Jt,typeMap:{button:Kt,toggle:Yt}}),Or="esri.widgets.Popup.PopupViewModel",Tr=i.getLogger(Or);let Fr=class extends($e(sr)){constructor(t){super(t),this._handles=new b,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new Cr,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new qt({symbol:new Qt({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some((t=>t.waitingForContent))}initialize(){this._handles.add([_(this,["autoOpenEnabled","view"],(()=>this._autoOpenEnabledChange())),this.on("view-change",(()=>this._autoClose())),G(this,["highlightEnabled","selectedFeature","visible","view"],(()=>this._highlightFeature())),G(this,"view.animation.state",(t=>this._animationStateChange(t))),G(this,"location",(t=>this._locationChange(t))),G(this,"selectedFeature",(t=>this._selectedFeatureChange(t))),G(this,["selectedFeatureIndex","featureCount","featuresPerPage"],(()=>this._selectedFeatureIndexChange())),G(this,["featurePage","selectedFeatureIndex","featureCount","featuresPerPage, featureViewModels"],(()=>this._setGraphicOnFeatureViewModels())),G(this,"featureViewModels",(()=>this._featureViewModelsChange())),this.on("trigger-action",(t=>function(t){const{event:e,view:i}=t,{action:s}=e,r=i&&i.popup;if(!s)return Promise.reject(new n("trigger-action:missing-arguments","Event has no action"));if(!r)return Promise.reject(new n("trigger-action:missing-arguments","view.popup is missing"));const{disabled:o,id:a}=s;if(!a)return Promise.reject(new n("trigger-action:invalid-action","action.id is missing"));if(o)return Promise.reject(new n("trigger-action:invalid-action","Action is disabled"));if(a===_r.id)return async function(t){const{location:e,selectedFeature:i,view:s,zoomFactor:r}=t,o=Ar(t);if(!o){const t=new n("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:o,view:s});return kr.error(t),Promise.reject(t)}const a=s.scale/r,l=t.get("selectedFeature.geometry")||e,h=l&&"point"===l.type&&function(t,e){if("3d"!==(null==e?void 0:e.type)||!t||"esri.Graphic"!==t.declaredClass)return!0;const i=e.getViewForGraphic(t);if(i&&"whenGraphicBounds"in i){let e=!1;return i.whenGraphicBounds(t,{useViewElevation:!0}).then((t=>{e=!t||!t.boundingBox||t.boundingBox[0]===t.boundingBox[3]&&t.boundingBox[1]===t.boundingBox[4]&&t.boundingBox[2]===t.boundingBox[5]})).catch((()=>{const e=new n("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:t});kr.error(e)})),e}return!0}(i,s);_r.active=!0,_r.disabled=!0,await t.view.goTo({target:o,scale:h?a:void 0}),_r.active=!1,_r.disabled=!1,t.zoomToLocation=null,h&&(t.location=l)}(r.viewModel);if(a===xr.id)return async function(t){const{selectedFeature:e,view:i}=t;if("2d"!==(null==i?void 0:i.type)){const t=new n("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw kr.error(t),t}if(!e.isAggregate){const t=new n("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw kr.error(t),t}const s=e.sourceLayer,r=await i.whenLayerView(s),o=r.createQuery();o.aggregateIds=[e.getObjectId()],xr.active=!0,xr.disabled=!0;const{extent:a}=await r.queryExtent(o);await i.goTo({target:a}),xr.active=!1,xr.disabled=!1}(r.viewModel);if(a===Ir.id)return r.featureMenuOpen=!r.featureMenuOpen,r.viewModel.browseClusterEnabled=!r.viewModel.browseClusterEnabled,Promise.resolve();if(r.viewModel.browseClusterEnabled=!1,a===Mr.id){r.close();const{selectedFeature:t}=r;if(!t)return Promise.reject(new n(`trigger-action:${Mr.id}`,"selectedFeature is required",{selectedFeature:t}));const{sourceLayer:e}=t;return e?e.remove(t):i.graphics.remove(t),Promise.resolve()}return Promise.resolve()}({event:t,view:this.view}))),K(this,"waitingForResult",(()=>this._waitingForResultChange()),!0),G(this,["features","view","view.map","view.spatialReference"],(()=>this._updateFeatureVMs())),G(this,["view.scale"],this._viewScaleChange),K(this,"visible",(()=>this.browseClusterEnabled=!1)),G(this,"browseClusterEnabled",(t=>t?this.enableClusterBrowsing():this.disableClusterBrowsing()))])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const t=this._get("allActions")||new Cr;t.removeAll();const{actions:e,defaultActions:i,defaultPopupTemplateEnabled:s,includeDefaultActions:n,selectedFeature:r}=this,o=n?i.concat(e):e,a=r&&("function"==typeof r.getEffectivePopupTemplate&&r.getEffectivePopupTemplate(s)||r.popupTemplate),l=a&&a.actions,h=a&&a.overwriteActions?l:l?l.concat(o):o;return h&&h.filter(Boolean).forEach((e=>t.add(e))),t}get defaultActions(){var t;const e=this._get("defaultActions")||new Cr;return e.removeAll(),e.addMany(null!=(t=this.selectedFeature)&&t.isAggregate?[xr.clone(),Ir.clone()]:[_r.clone()]),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(t){const e=t||[];this._set("features",e);const{pendingPromisesCount:i,promiseCount:s,selectedFeatureIndex:n}=this,r=s&&e.length;r&&i&&-1===n?this.selectedFeatureIndex=0:r&&-1!==n||(this.selectedFeatureIndex=e.length?0:-1)}get location(){return this._get("location")||null}set location(t){const e=this.get("view.spatialReference.isWebMercator");t&&t.get("spatialReference.isWGS84")&&e&&(t=Xt(t)),this._set("location",t)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(t){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(t)||!t.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",t),(t=t.slice(0)).forEach((t=>{this._pendingPromises.add(t),t.then((e=>{this._pendingPromises.has(t)&&this._updateFeatures(e),this._updatePendingPromises(t)}),(()=>this._updatePendingPromises(t)))})),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:t,selectedFeatureIndex:e}=this;return-1===e?null:t[e]||null}get selectedFeatureIndex(){const t=this._get("selectedFeatureIndex");return"number"==typeof t?t:-1}set selectedFeatureIndex(t){const{featureCount:e}=this;t=isNaN(t)||t<-1||!e?-1:(t+e)%e,this._set("selectedFeatureIndex",t)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:t}=this,e=Ar(this);if(!e){const i=new n("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:e,view:t});return Tr.error(i),Promise.reject(i)}return this.callGoTo({target:{target:e,scale:t.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null})}fetchFeatures(t,e){const{view:i}=this;if(!i||!t){const e=new n("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:t,view:i});return Tr.error(e),Promise.reject(e)}return i.fetchPopupFeatures(t,{event:e&&e.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:e&&e.signal})}open(t){const e={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...t,visible:!0},{fetchFeatures:i}=e;delete e.fetchFeatures,i&&this._setFetchFeaturesPromises(e.location),this.set(e)}triggerAction(t){const e=this.allActions.getItemAt(t);e&&!e.disabled&&this.emit("trigger-action",{action:e})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){(function(t){t.features=t.features.filter((t=>t.isAggregate))})(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){await async function(t){const{selectedFeature:e,view:i}=t;if("2d"!==(null==i?void 0:i.type)){const t=new n("displayClusterExtent:invalid-view","View must be 2d MapView.",{view:i});throw kr.error(t),t}if(!e.isAggregate){const t=new n("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw kr.error(t),t}const s=e.sourceLayer,r=await i.whenLayerView(s),o=r.createQuery();o.aggregateIds=[e.getObjectId()];const{extent:a}=await r.queryExtent(o);t.selectedClusterBoundaryFeature.geometry=a,i.graphics.add(t.selectedClusterBoundaryFeature)}(this),await async function(t){const{selectedFeature:e,view:i}=t;if("2d"!==(null==i?void 0:i.type)){const t=new n("browseAggregateFeatures:invalid-view","View must be 2d MapView.",{view:i});throw kr.error(t),t}if(!e.isAggregate){const t=new n("browseAggregateFeatures:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:e});throw kr.error(t),t}const s=e.sourceLayer,r=await i.whenLayerView(s),o=r.createQuery();o.aggregateIds=[e.getObjectId()],Ir.active=!0,Ir.disabled=!0;const{features:a}=await r.queryFeatures(o);Ir.active=!1,Ir.disabled=!1,i.popup.open({features:[e].concat(a),featureMenuOpen:!0})}(this)}_animationStateChange(t){this.zoomToLocation||(_r.disabled="waiting-for-target"===t)}_clearBrowsedClusterGraphics(){var t;const e=null==(t=this.view)?void 0:t.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){var t;(null!=(t=this.selectedFeature)&&t.isAggregate||this.browseClusterEnabled)&&(this.browseClusterEnabled=!1,this.visible=!1)}_locationChange(t){const{selectedFeature:e,updateLocationEnabled:i}=this;i&&t&&(!e||e.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:t,featureCount:e,featurePage:i,featuresPerPage:s,featureViewModels:n}=this;if(null===i)return;const r=((i-1)*s+e)%e;n.slice(r,r+s).forEach(((e,i)=>{e&&!e.graphic&&(e.graphic=t[r+i])}))}async _selectedFeatureChange(t){if(!t)return;const{location:e,updateLocationEnabled:i,view:s}=this;if(this.browseClusterEnabled){if(this._selectedClusterFeature&&(s.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),t.isAggregate)return;return t.symbol=await Oe(t),this._selectedClusterFeature=t,void s.graphics.add(this._selectedClusterFeature)}!i&&e||!t.geometry?i&&!t.geometry&&this.centerAtLocation().then((()=>{this.location=s.center.clone()})):this.location=J(this._getPointFromGeometry(t.geometry))}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(t){return this._fetchFeaturesWithController(this._getScreenPoint(t||this.location)).then((t=>{const{clientOnlyGraphics:e,promisesPerLayerView:i}=t,s=Promise.resolve(e),n=i.map((t=>t.promise));this.promises=[s,...n]}))}_destroyFeatureVMs(){this.featureViewModels.forEach((t=>t&&!t.destroyed&&t.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:t,features:e,featureViewModels:i}=this;if(null!=t&&t.isAggregate||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!e||!e.length)return;const s=i.slice(0),n=[];e.forEach(((e,i)=>{if(!e)return;let r=null;if(s.some(((t,i)=>(t&&t.graphic===e&&(r=t,s.splice(i,1)),!!r))),r)n[i]=r;else{var o,a;const s=new Jn({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:null==(o=this.view)?void 0:o.spatialReference,graphic:e===t?e:null,map:null==(a=this.view)?void 0:a.map,view:this.view});n[i]=s}})),s.forEach((t=>t&&!t.destroyed&&t.destroy())),this._set("featureViewModels",n)}_getScreenPoint(t){const{view:e}=this;return e&&t&&"function"==typeof e.toScreen?e.toScreen(t):null}_autoOpenEnabledChange(){const t="auto-fetch-features",{_handles:e,autoOpenEnabled:i}=this;if(e.remove(t),i&&this.view){const i=this.view.on("click",(t=>{"mouse"===t.pointerType&&0!==t.button||this._fetchFeaturesAndOpen(t)}),br.WIDGET);e.add(i,t)}}_cancelFetchingFeatures(){const t=this._fetchFeaturesController;t&&t.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(t,e){this._cancelFetchingFeatures();const i=new AbortController,{signal:s}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const n=this.fetchFeatures(t,{signal:s,event:e});return n.catch((()=>{})).then((()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")})),n}_fetchFeaturesAndOpen(t){const{screenPoint:e,mapPoint:i}=t,{view:s}=this;this._fetchFeaturesWithController(e,t).then((t=>{const{clientOnlyGraphics:e,promisesPerLayerView:n,location:r}=t,o=[Promise.resolve(e),...n.map((t=>t.promise))];return s.popup.open({location:r||i,promises:o}),t}))}_updatePendingPromises(t){t&&this._pendingPromises.has(t)&&(this._pendingPromises.delete(t),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(t){return v(t)?null:"point"===t.type?t:"extent"===t.type?t.center:"polygon"===t.type?t.centroid:"multipoint"===t.type||"polyline"===t.type?t.extent.center:null}async _getLayerView(t,e){return await t.when(),t.whenLayerView(e)}async _highlightFeature(){const t="highlight";this._handles.remove(t);const{selectedFeature:e,highlightEnabled:i,view:s,visible:n}=this;if(!(e&&s&&i&&n))return;let{layer:r,sourceLayer:o}=e;if("map-notes"!==(null==o?void 0:o.type)&&"subtype-group"!==(null==o?void 0:o.type)||(r=o),!(r&&r instanceof Re))return;const a=this._getLayerView(s,r);this._highlightPromise=a;const l=await a;if(!(l&&je(l)&&this._highlightPromise===a&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const h="objectIdField"in r&&r.objectIdField,u=e.attributes,c=l.highlight(u&&h&&u[h]||e);this._handles.add(c,t)}_updateFeatures(t){const{features:e}=this;if(!t||!t.length)return;if(!e.length)return void(this.features=t);const i=t.filter((t=>-1===e.indexOf(t)));this.features=e.concat(i)}};t([l()],Fr.prototype,"featurePage",void 0),t([l()],Fr.prototype,"isLoadingFeature",null),t([l({type:Cr})],Fr.prototype,"actions",void 0),t([l({readOnly:!0})],Fr.prototype,"active",null),t([l({readOnly:!0})],Fr.prototype,"allActions",null),t([l({type:Boolean})],Fr.prototype,"defaultPopupTemplateEnabled",void 0),t([l()],Fr.prototype,"autoCloseEnabled",void 0),t([l()],Fr.prototype,"autoOpenEnabled",void 0),t([l()],Fr.prototype,"browseClusterEnabled",void 0),t([l()],Fr.prototype,"content",void 0),t([l({type:Cr,readOnly:!0})],Fr.prototype,"defaultActions",null),t([l({readOnly:!0})],Fr.prototype,"featureCount",null),t([l()],Fr.prototype,"features",null),t([l()],Fr.prototype,"featuresPerPage",void 0),t([l()],Fr.prototype,"featureViewModelAbilities",void 0),t([l({readOnly:!0})],Fr.prototype,"featureViewModels",void 0),t([l()],Fr.prototype,"highlightEnabled",void 0),t([l()],Fr.prototype,"includeDefaultActions",void 0),t([l({type:Rt})],Fr.prototype,"location",null),t([l({readOnly:!0})],Fr.prototype,"pendingPromisesCount",null),t([l({readOnly:!0})],Fr.prototype,"selectedClusterBoundaryFeature",void 0),t([l({readOnly:!0})],Fr.prototype,"waitingForResult",null),t([l({readOnly:!0})],Fr.prototype,"promiseCount",null),t([l()],Fr.prototype,"promises",null),t([l({value:null,readOnly:!0})],Fr.prototype,"selectedFeature",null),t([l({value:-1})],Fr.prototype,"selectedFeatureIndex",null),t([l({readOnly:!0})],Fr.prototype,"selectedFeatureViewModel",null),t([l({readOnly:!0})],Fr.prototype,"state",null),t([l()],Fr.prototype,"title",void 0),t([l()],Fr.prototype,"updateLocationEnabled",void 0),t([l()],Fr.prototype,"view",void 0),t([l()],Fr.prototype,"visible",void 0),t([l()],Fr.prototype,"zoomFactor",void 0),t([l()],Fr.prototype,"zoomToLocation",void 0),t([l()],Fr.prototype,"centerAtLocation",null),Fr=t([e(Or)],Fr);const Pr=Fr,Er="selected-index",Vr="popup-spinner",Sr="esri-popup__button",Rr="esri-popup__icon",Nr={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Lr="esri-popup";function zr(t,e){return void 0===e?`${Lr}__${t}`:`${Lr}__${t}-${e}`}const $r="esri.widgets.Popup",jr=i.getLogger($r),Dr={closeButton:!0,featureNavigation:!0};let Ur=class extends(Yn(E)){constructor(t,e){super(t,e),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new b,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([t])=>{null!=t&&t.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback),this._displaySpinnerThrottled=Ms((()=>this._displaySpinner()),0),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new Pr,this.visible=null,this.visibleElements={...Dr},this._addSelectedFeatureIndexHandle(),this.own([G(this,"viewModel.screenLocation",(()=>this._positionContainer())),G(this,["viewModel.active","dockEnabled"],(()=>this._toggleScreenLocationEnabled())),G(this,"viewModel.screenLocation",((t,e)=>{!!t!=!!e&&this.reposition()})),G(this,["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],(()=>this.reposition())),G(this,"spinnerEnabled",(t=>this._spinnerEnabledChange(t))),G(this,"viewModel.view.size",((t,e)=>this._updateDockEnabledForViewSize(t,e))),G(this,"viewModel.view",((t,e)=>this._viewChange(t,e))),G(this,"viewModel.view.ready",((t,e)=>this._viewReadyChange(t,e))),G(this,["viewModel.waitingForResult","viewModel.location"],(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),G(this,["selectedFeatureWidget.viewModel.title","selectedFeatureWidget.viewModel.state"],(()=>this._setTitleFromFeatureWidget())),G(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.state"],(()=>this._setContentFromFeatureWidget())),K(this,"collapsed",(()=>{var t,e;"xsmall"===(null==(t=this.viewModel)||null==(e=t.view)?void 0:e.widthBreakpoint)&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()})),V(this,"viewModel.allActions","change",(()=>this._watchActions())),_(this,"viewModel.allActions",(()=>this._watchActions())),G(this,"viewModel.featureViewModels",(()=>this._featureMenuViewportScrollTop()))])}destroy(){var t,e;this._destroySelectedFeatureWidget(),this._destroySpinner(),null==(t=this._handles)||t.destroy(),this._unobserveFeatureMenuObserver(),null==(e=this._featureMenuIntersectionObserver)||e.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var t,e,i,s,n,r,o;return!!(this.selectedFeatureWidget?(null==(t=this.selectedFeatureWidget)||null==(e=t.viewModel)?void 0:e.waitingForContent)||"error"===(null==(i=this.selectedFeatureWidget)||null==(s=i.viewModel)?void 0:s.state)||(null==(n=this.selectedFeatureWidget)||null==(r=n.viewModel)?void 0:r.content):null==(o=this.viewModel)?void 0:o.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(t){this._set("actionsMenuOpen",!!t)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Nr}set dockOptions(t){const e={...Nr},i=this.get("viewModel.view.breakpoints"),s={};i&&(s.width=i.xsmall,s.height=i.xsmall);const n={...e,...t},r={...e.breakpoint,...s},{breakpoint:o}=n;!0===o?n.breakpoint=r:"object"==typeof o&&(n.breakpoint={...r,...o}),this._set("dockOptions",n),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:t,visibleElements:e,headingLevel:i}=this,{selectedFeatureViewModel:s}=this.viewModel,n={...e,title:!1};return s?(t?(t.viewModel=s,t.visibleElements=n):this._feature=new er({headingLevel:i+1,viewModel:s,visibleElements:n}),this._feature):null}castVisibleElements(t){return{...Dr,...t}}blur(){const{active:t}=this.viewModel;t||jr.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(t,e){return this.viewModel.fetchFeatures(t,e)}focus(){const{active:t}=this.viewModel;t||jr.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(t){var e,i;this._handles.remove(Er);const s={collapsed:!!t&&!!t.collapsed,actionsMenuOpen:!!t&&!!t.actionsMenuOpen,featureMenuOpen:!!t&&!!t.featureMenuOpen};"xsmall"===(null==(e=this.viewModel)||null==(i=e.view)?void 0:i.widthBreakpoint)&&(s.collapsed=!0),this.set(s),this.viewModel.open(t),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(t){this.viewModel.triggerAction(t)}render(){var t,e,i,s;const{actionsMenuOpen:n,dockEnabled:r,featureMenuVisible:o,dividedActions:a,currentAlignment:l,currentDockPosition:h}=this,{active:u}=this.viewModel,{menuActions:c}=a,d=null==(t=this.selectedFeature)||null==(e=t.layer)?void 0:e.title,p=null==(i=this.selectedFeature)||null==(s=i.layer)?void 0:s.id;return S("div",{class:this.classes("esri-popup",{"esri-popup--aligned-top-center":"top-center"===l,"esri-popup--aligned-bottom-center":"bottom-center"===l,"esri-popup--aligned-top-left":"top-left"===l,"esri-popup--aligned-bottom-left":"bottom-left"===l,"esri-popup--aligned-top-right":"top-right"===l,"esri-popup--aligned-bottom-right":"bottom-right"===l,"esri-popup--is-docked":u&&r,"esri-popup--shadow":u&&!r,"esri-popup--is-docked-top-left":"top-left"===h,"esri-popup--is-docked-top-center":"top-center"===h,"esri-popup--is-docked-top-right":"top-right"===h,"esri-popup--is-docked-bottom-left":"bottom-left"===h,"esri-popup--is-docked-bottom-center":"bottom-center"===h,"esri-popup--is-docked-bottom-right":"bottom-right"===h,"esri-popup--feature-menu-open":o,"esri-popup--actions-menu-open":u&&c.length>1&&n}),role:"presentation","data-layer-title":d,"data-layer-id":p,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},u?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return S("span",{"aria-hidden":"true",class:this.classes(Rr,"esri-icon-loading-indicator","esri-rotating")})}renderNavigationLoading(){const{messagesCommon:t}=this;return this.viewModel.pendingPromisesCount?S("div",{key:zr("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":t.loading,title:t.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const t=L(this.container);return S("span",{"aria-hidden":"true",class:this.classes(Rr,{"esri-icon-right-triangle-arrow":t,"esri-popup__pagination-previous-icon--rtl":t,"esri-icon-left-triangle-arrow":!t,"esri-popup__pagination-previous-icon":!t})})}renderPreviousButton(){const{messages:t}=this;return S("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Sr,"esri-popup__pagination-previous"),"aria-label":t.previous,title:t.previous},this.renderPreviousIcon())}renderNextIcon(){const t=L(this.container);return S("span",{"aria-hidden":"true",class:this.classes(Rr,{"esri-icon-left-triangle-arrow":t,"esri-popup__pagination-next-icon--rtl":t,"esri-icon-right-triangle-arrow":!t,"esri-popup__pagination-next-icon":!t})})}renderNextButton(){const{messages:t}=this;return S("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Sr,"esri-popup__pagination-next"),"aria-label":t.next,title:t.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:t,featureMenuId:e,messagesCommon:i}=this,{featureCount:s,selectedFeatureIndex:n}=this.viewModel;return S("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Sr,"esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":e,"aria-expanded":t.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(s,n))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:t}=this,e=this._wouldDockTo();return S("span",{"aria-hidden":"true",class:this.classes({"esri-icon-minimize":t,"esri-popup__icon--dock-icon":!t,"esri-icon-dock-right":!t&&("top-right"===e||"bottom-right"===e),"esri-icon-dock-left":!t&&("top-left"===e||"bottom-left"===e),"esri-icon-maximize":!t&&"top-center"===e,"esri-icon-dock-bottom":!t&&"bottom-center"===e},Rr)})}renderDockButton(){var t,e,i;const{dockEnabled:s,messages:n}=this,r=null==(t=this.viewModel)||null==(e=t.view)?void 0:e.widthBreakpoint,o=s?n.undock:n.dock;return"xsmall"!==r&&null!=(i=this.dockOptions)&&i.buttonEnabled?S("div",{role:"button","aria-label":o,title:o,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Sr,"esri-popup__button--dock")},this.renderDockIcon()):null}renderTitle(){const{title:t}=this.viewModel,{titleId:e,collapsible:i,contentCollapsed:s,messagesCommon:n}=this,r={"esri-popup__header-container--button":i},o=S(Ce,{level:this.headingLevel,class:"esri-popup__header-title",innerHTML:t}),a=i?S("button",{key:`${t}--collapsible`,id:e,title:s?n.expand:n.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",r),"aria-expanded":s?"false":"true",onclick:this._toggleCollapsed},o):S("div",{key:t,id:e,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",r)},o);return t?a:null}renderCloseIcon(){return S("span",{"aria-hidden":"true",class:this.classes(Rr,"esri-icon-close")})}renderCloseButton(){const{visibleElements:t,messagesCommon:e}=this;return t.closeButton?S("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Sr,"aria-label":e.close,title:e.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return S("header",{class:"esri-popup__header"},this.renderTitle(),S("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:t,hasContent:e,contentCollapsed:i}=this,{content:s}=this.viewModel;return e&&!i?S("article",{key:s,enterAnimation:this._createFeatureUpdatedAnimation(),id:t,class:"esri-popup__content"},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:t,actionsMenuButtonId:e,actionsMenuOpen:i,dividedActions:s,messagesCommon:n}=this,r=i?n.close:n.open,{menuActions:o}=s;return o.length?S("div",{key:zr("actions-menu-button"),class:this.classes(Sr,"esri-popup__actions-menu-button"),role:"button",id:e,"aria-haspopup":"true","aria-controls":i?t:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":r,title:r},S("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null}renderMenuActions(){const{actionsMenuId:t,actionsMenuButtonId:e,actionsMenuOpen:i,dividedActions:s}=this,{menuActions:n,inlineActions:r}=s;return n.length&&i?S("ul",{id:t,role:"menu","aria-labelledby":e,key:zr("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},n.toArray().map(((t,e)=>this.renderAction({action:t,index:e+r.length,type:"menu-item"})))):null}renderInlineActions(){const{inlineActions:t}=this.dividedActions;return!!t.length&&t.toArray().map(((t,e)=>this.renderAction({action:t,index:e,type:"inline"})))}renderInlineActionsContainer(){const{inlineActions:t,menuActions:e}=this.dividedActions,i=!!t.length,s=!!e.length;return i||s?S("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":s.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?S("section",{key:zr("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:t,dividedActions:e}=this,{inlineActions:i,menuActions:s}=e,n=!!i.length,r={"esri-popup__footer--has-pagination":t,"esri-popup__footer--has-actions":n,"esri-popup__footer--has-actions-menu":!!s.length};return t||n?S("div",{key:zr("feature-buttons"),class:this.classes("esri-popup__footer",r)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:t}=this,{featureViewModels:e,isLoadingFeature:i}=this.viewModel,s=B(t.selectedFeatures,{total:e.length});return S("section",{key:zr("menu"),class:"esri-popup__feature-menu"},S("strong",{class:"esri-popup__feature-menu-header"},s),S("nav",{bind:this,class:"esri-popup__feature-menu-viewport","data-node-ref":"_featureMenuViewportNode",afterCreate:R},this.renderFeatureMenu(),S("div",{class:"esri-popup__feature-menu-observer",bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?S("div",{class:"esri-popup__feature-menu-loader"},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:S("div",{key:zr("pointer"),class:"esri-popup__pointer",role:"presentation"},S("div",{class:this.classes("esri-popup__pointer-direction","esri-popup--shadow")}))}renderMainContainer(){const{dockEnabled:t,currentAlignment:e,currentDockPosition:i,titleId:s,contentId:n,collapsible:r,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:h}=this.viewModel,u="bottom-left"===e||"bottom-center"===e||"bottom-right"===e||"top-left"===i||"top-center"===i||"top-right"===i,c="top-left"===e||"top-center"===e||"top-right"===e||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i;return S("div",{class:this.classes("esri-popup__main-container","esri-widget",{"esri-popup--shadow":t,"esri-popup--is-collapsible":r,"esri-popup--is-collapsed":a}),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":h?s:"","aria-describedby":o&&!a?n:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},u?this.renderFooter():null,u?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),c?this.renderFooter():null,c?this.renderFeatureMenuContainer():null)}renderContent(){var t;const e=null==(t=this.viewModel)?void 0:t.content;return e?"string"==typeof e?S("div",{key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(t){return S("span",{key:"text",class:"esri-popup__action-text"},t)}renderActionIcon(t){const e=this._getActionClass(t),i=this._getActionImage(t),s={"esri-icon-loading-indicator":t.active,"esri-rotating":t.active,[Rr]:!!e,"esri-popup__action-image":!t.active&&!!i};return e&&(s[e]=!t.active),S("span",{key:"icon","aria-hidden":"true",class:this.classes(Rr,s),styles:this._getIconStyles(i)})}renderAction(t){const{action:e,index:i,type:s}=t,n=this._getActionTitle(e),r={"esri-popup__action":"toggle"!==e.type,"esri-popup__action-toggle":"toggle"===e.type,"esri-popup__action-toggle--on":"toggle"===e.type&&e.value,"esri-popup__button--disabled":e.disabled},o=[this.renderActionIcon(e),this.renderActionText(n)],a="menu-item"===s?S("li",{key:e.uid,role:"menuitem",tabIndex:0,title:n,"aria-label":n,class:this.classes(Sr,r),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},o):S("div",{key:e.uid,role:"button",tabIndex:0,title:n,"aria-label":n,class:this.classes(Sr,r),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},o);return e.visible?a:null}renderFeatureMenuItem(t,e){const{messages:i,messagesCommon:s}=this,{selectedFeatureIndex:n,selectedFeatureViewModel:r}=this.viewModel,o=t===r,a={"esri-popup__feature-menu-item--selected":o},l=o?S("span",{key:zr(`feature-menu-selected-feature-${n}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:"esri-icon-check-mark"}):null,h=S("span",{innerHTML:t.title||s.untitled});return S("li",{role:"menuitem",tabIndex:-1,key:zr(`feature-menu-feature-${n}`),class:this.classes(a,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":e,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},S("span",{class:"esri-popup__feature-menu-title"},h,l))}renderFeatureMenu(){const{featureMenuId:t}=this,{featureViewModels:e}=this.viewModel;return e.length>1?S("ol",{class:"esri-popup__feature-menu-list",id:t,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},e.filter((t=>!!t.graphic)).map(((t,e)=>this.renderFeatureMenuItem(t,e)))):null}_getActionTitle(t){const{messages:e,selectedFeature:i,messagesCommon:s}=this,{id:n}=t,r=null==i?void 0:i.attributes,o="zoom-to-feature"===n?B(t.title,{messages:e}):"remove-selected-feature"===n?B(t.title,{messages:s}):"zoom-to-clustered-features"===n||"browse-clustered-features"===n?B(t.title,{messages:e}):t.title;return o&&r?B(o,r):o}_getActionClass(t){const{selectedFeature:e}=this,i=null==e?void 0:e.attributes,{className:s,image:n}=t,r=n||s?s:"esri-icon-default-action";return r&&i?B(r,i):r}_getActionImage(t){const{selectedFeature:e}=this,i=null==e?void 0:e.attributes,{image:s}=t;return s&&i?B(s,i):s}_createFeatureUpdatedAnimation(){return Y("enter","esri-popup--feature-updated")}_getInlineActionCount(){const{maxInlineActions:t,featureNavigationVisible:e}=this;if("number"!=typeof t)return null;const i=Math.round(t);return Math.max(e?i-1:i,0)}_watchActions(){const{allActions:t}=this.viewModel;this.notifyChange("dividedActions");const e="actions";this._handles.remove(e),t&&t.forEach((t=>{this._handles.add(G(t,["active","className","disabled","id","title","image","visible"],(()=>this.scheduleRender())),e)}))}_divideActions(){const{allActions:t}=this.viewModel,e=this._getInlineActionCount(),i=null===e,n=0===e;return{inlineActions:i?t.slice(0):n?new s:t.slice(0,e),menuActions:i?new s:t.slice(n?0:e)}}_featureMenuOpenChanged(t){t?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(t){t?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:t,messagesCommon:e}=this;var i,s;t&&(this.viewModel.title="error"===(null==(i=t.viewModel)?void 0:i.state)?e.errorMessage:(null==(s=t.viewModel)?void 0:s.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:t}=this;t&&(this.viewModel.content=t)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(t){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(t),this._featureMenuIntersectionObserverNode=t}_handleFeatureMenuKeyup(t){"Escape"===D(t)&&(t.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(t){"Escape"===D(t)&&(t.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_handleFeatureMenuItemKeyup(t){const e=D(t),{_featureMenuNode:i}=this,s=t.currentTarget["data-feature-index"];if(!i)return;const n=i.querySelectorAll("li"),r=n.length;"ArrowUp"!==e?"ArrowDown"!==e?"Home"!==e?"End"!==e||(t.stopPropagation(),n[n.length-1].focus()):(t.stopPropagation(),n[0].focus()):(t.stopPropagation(),n[(s+1+r)%r].focus()):(t.stopPropagation(),n[(s-1+r)%r].focus())}_handleActionMenuItemKeyup(t){const e=D(t),{_actionsMenuNode:i}=this,s=t.currentTarget["data-action-index"];if(!i)return;const n=i.querySelectorAll("li"),r=n.length;"ArrowUp"!==e?"ArrowDown"!==e?"Home"!==e?"End"!==e||(t.stopPropagation(),n[n.length-1].focus()):(t.stopPropagation(),n[0].focus()):(t.stopPropagation(),n[(s+1+r)%r].focus()):(t.stopPropagation(),n[(s-1+r)%r].focus())}_handleMainKeyup(t){const e=D(t);"ArrowLeft"===e&&(t.stopPropagation(),this.previous()),"ArrowRight"===e&&(t.stopPropagation(),this.next())}_spinnerEnabledChange(t){if(this._destroySpinner(),!t)return;const e=this.get("viewModel.view");this._createSpinner(e)}_hideSpinner(){const{_spinner:t}=this;t&&(t.location=null,t.hide())}_displaySpinner(){const{_spinner:t}=this;if(!t)return;const{location:e,waitingForResult:i}=this.viewModel;i?t.show({location:e}):t.hide()}_getIconStyles(t){return{"background-image":t?`url(${t})`:""}}_addSelectedFeatureIndexHandle(){const t=G(this,"viewModel.selectedFeatureIndex",((t,e)=>this._selectedFeatureIndexUpdated(t,e)));this._handles.add(t,Er)}_selectedFeatureIndexUpdated(t,e){const{featureCount:i}=this;i&&t!==e&&-1!==t&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:t}=this;t&&(t.viewModel=null,t&&!t.destroyed&&t.destroy()),this._feature=null}_isScreenLocationWithinView(t,e){return t.x>-1&&t.y>-1&&t.x<=e.width&&t.y<=e.height}_isOutsideView(t){const{popupHeight:e,popupWidth:i,screenLocation:s,side:n,view:r}=t;if(isNaN(i)||isNaN(e)||!r||!s)return!1;const o=r.padding;return"right"===n&&s.x+i/2>r.width-o.right||"left"===n&&s.x-i/2<o.left||"top"===n&&s.y-e<o.top||"bottom"===n&&s.y+e>r.height-o.bottom}_calculateAutoAlignment(t){if("auto"!==t)return t;const{_pointerOffsetInPx:e,_containerNode:i,_mainContainerNode:s,viewModel:n}=this,{screenLocation:r,view:o}=n;if(v(r)||!o||!i)return"top-center";if(!this._isScreenLocationWithinView(r,o))return this._get("currentAlignment")||"top-center";function a(t){return parseInt(t.replace(/[^-\d\.]/g,""),10)}const l=s?window.getComputedStyle(s,null):null,h=l?a(l.getPropertyValue("max-height")):0,u=l?a(l.getPropertyValue("height")):0,{height:c,width:d}=i.getBoundingClientRect(),p=d+e,f=Math.max(c,h,u)+e,m=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:r,side:"right",view:o}),g=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:r,side:"left",view:o}),w=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:r,side:"top",view:o}),y=this._isOutsideView({popupHeight:f,popupWidth:p,screenLocation:r,side:"bottom",view:o});return g?w?"bottom-right":"top-right":m?w?"bottom-left":"top-left":w?y?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(t){return"function"==typeof t?t.call(this):t}_getCurrentAlignment(){const{alignment:t,dockEnabled:e}=this;return e||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(t)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(t){const e=["left","right"];return L(this.container)&&e.reverse(),t.replace(/leading/gi,e[0]).replace(/trailing/gi,e[1])}_callDockPosition(t){return"function"==typeof t?t.call(this):t}_getDockPosition(){var t;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(t=this.dockOptions)?void 0:t.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(t){var e;if("auto"!==t)return t;const i=null==(e=this.viewModel)?void 0:e.view,s=L(this.container)?"top-left":"top-right";if(!i)return s;const n=i.padding||{left:0,right:0,top:0,bottom:0},r=i.width-n.left-n.right,{breakpoints:o}=i;return o&&r<=o.xsmall?"bottom-center":s}_positionContainer(t=this._containerNode){if(t&&(this._containerNode=t),!t)return;const{screenLocation:e}=this.viewModel,{width:i}=t.getBoundingClientRect(),s=this._calculatePositionStyle(e,i);s&&(t.style.top=s.top,t.style.left=s.left,t.style.bottom=s.bottom,t.style.right=s.right)}_calculateFullWidth(t){const{currentAlignment:e,_pointerOffsetInPx:i}=this;return"top-left"===e||"bottom-left"===e||"top-right"===e||"bottom-right"===e?t+i:t}_calculateAlignmentPosition(t,e,i,s){const{currentAlignment:n,_pointerOffsetInPx:r}=this,o=s/2,a=i.height-e,l=i.width-t,{padding:h}=this.view;return"bottom-center"===n?{top:e+r-h.top,left:t-o-h.left}:"top-left"===n?{bottom:a+r-h.bottom,right:l+r-h.right}:"bottom-left"===n?{top:e+r-h.top,right:l+r-h.right}:"top-right"===n?{bottom:a+r-h.bottom,left:t+r-h.left}:"bottom-right"===n?{top:e+r-h.top,left:t+r-h.left}:"top-center"===n?{bottom:a+r-h.bottom,left:t-o-h.left}:void 0}_calculatePositionStyle(t,e){const{dockEnabled:i,view:s}=this;if(!s)return;if(i)return{left:"",top:"",right:"",bottom:""};if(v(t)||!e)return;const n=this._calculateFullWidth(e),r=this._calculateAlignmentPosition(t.x,t.y,s,n);return r?{top:void 0!==r.top?`${r.top}px`:"auto",left:void 0!==r.left?`${r.left}px`:"auto",bottom:void 0!==r.bottom?`${r.bottom}px`:"auto",right:void 0!==r.right?`${r.right}px`:"auto"}:void 0}_viewChange(t,e){t&&e&&(this.close(),this.clear())}_viewReadyChange(t,e){if(t){const t=this.get("viewModel.view");this._wireUpView(t)}else e&&(this.close(),this.clear())}_wireUpView(t){if(this._destroySpinner(),!t)return;const{spinnerEnabled:e}=this;e&&this._createSpinner(t),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(t,e,i){const[s,n]=t,[r,o]=e,{width:a,height:l}=i;return s<=a&&r>a||s>a&&r<=a||n<=l&&o>l||n>l&&o<=l}_updateDockEnabledForViewSize(t,e){if(!t||!e)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},s=i.left+i.right,n=i.top+i.bottom,r=[],o=[];r[0]=t[0]-s,r[1]=t[1]-n,o[0]=e[0]-s,o[1]=e[1]-n;const{dockOptions:a}=this;this._dockingThresholdCrossed(r,o,a.breakpoint)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(t){this._focusDockButton&&(this._focusDockButton=!1,t.focus())}_closeButtonNodeUpdated(t){return this._focusClose?(this._focusClose=!1,void t.focus()):this._blurClose?(this._blurClose=!1,void t.blur()):void 0}_mainContainerNodeUpdated(t){return this._mainContainerNode=t,this._focusContainer?(this._focusContainer=!1,void t.focus()):this._blurContainer?(this._blurContainer=!1,void t.blur()):void 0}_featureMenuNodeUpdated(t){if(this._featureMenuNode=t,!t||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const e=t.querySelectorAll("li");e.length&&e[0].focus()}_actionsMenuNodeUpdated(t){if(this._actionsMenuNode=t,!t||!this._focusFirstAction)return;this._focusFirstAction=!1;const e=t.querySelectorAll("li");e.length&&e[0].focus()}_focusFeatureMenuButtonNode(t){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,t.focus())}_focusActionsMenuButtonNode(t){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,t.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:t,viewModel:e}=this;e&&(e.screenLocationEnabled=e.active&&!t)}_shouldDockAtCurrentViewSize(t){var e,i;const s=t.breakpoint,n=null==(e=this.viewModel)||null==(i=e.view)?void 0:i.ui;if(!n)return!1;const{width:r,height:o}=n;if(isNaN(r)||isNaN(o))return!1;const a=s.hasOwnProperty("width")&&r<=s.width,l=s.hasOwnProperty("height")&&o<=s.height;return a||l}_setDockEnabledForViewSize(t){t.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(t))}_getPageText(t,e){return this.featureNavigationVisible?B(this.messages.pageText,{index:e+1,total:t}):null}_destroySpinner(){const{_spinner:t,view:e}=this;t&&(e&&e.ui&&e.ui.remove(this._spinner,Vr),t.destroy(),this._spinner=null)}_createSpinner(t){t&&(this._spinner=new ar({view:t}),t.ui.add(this._spinner,{key:Vr,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const t=!this.featureMenuOpen;this._featureMenuOpenChanged(t),this.actionsMenuOpen=!1,this.featureMenuOpen=t}_toggleActionsMenu(){const t=!this.actionsMenuOpen;this._actionsMenuOpenChanged(t),this.featureMenuOpen=!1,this.actionsMenuOpen=t}_triggerAction(t){const e=t.currentTarget["data-action-index"],i=this.viewModel.allActions.getItemAt(e);i&&"toggle"===i.type&&(i.value=!i.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(e)}_selectFeature(t){const e=t.currentTarget["data-feature-index"];isNaN(e)||(this.viewModel.selectedFeatureIndex=e),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};t([l({readOnly:!0})],Ur.prototype,"actionsMenuId",null),t([l({readOnly:!0})],Ur.prototype,"actionsMenuButtonId",null),t([l({readOnly:!0})],Ur.prototype,"featureMenuId",null),t([l({readOnly:!0})],Ur.prototype,"titleId",null),t([l({readOnly:!0})],Ur.prototype,"contentId",null),t([l({readOnly:!0})],Ur.prototype,"hasContent",null),t([l({readOnly:!0})],Ur.prototype,"featureNavigationVisible",null),t([l({readOnly:!0})],Ur.prototype,"collapsible",null),t([l({readOnly:!0})],Ur.prototype,"featureMenuVisible",null),t([l({readOnly:!0})],Ur.prototype,"contentCollapsed",null),t([l({readOnly:!0})],Ur.prototype,"dividedActions",null),t([F("viewModel.actions")],Ur.prototype,"actions",void 0),t([l()],Ur.prototype,"actionsMenuOpen",null),t([l()],Ur.prototype,"alignment",void 0),t([F("viewModel.autoCloseEnabled")],Ur.prototype,"autoCloseEnabled",void 0),t([F("viewModel.autoOpenEnabled")],Ur.prototype,"autoOpenEnabled",void 0),t([F("viewModel.defaultPopupTemplateEnabled")],Ur.prototype,"defaultPopupTemplateEnabled",void 0),t([F("viewModel.content")],Ur.prototype,"content",void 0),t([l()],Ur.prototype,"collapsed",void 0),t([l()],Ur.prototype,"collapseEnabled",void 0),t([l({readOnly:!0})],Ur.prototype,"currentAlignment",null),t([l({readOnly:!0})],Ur.prototype,"currentDockPosition",null),t([l()],Ur.prototype,"dockOptions",null),t([l()],Ur.prototype,"dockEnabled",void 0),t([F("viewModel.featureCount")],Ur.prototype,"featureCount",void 0),t([l()],Ur.prototype,"featureMenuOpen",void 0),t([F("viewModel.features")],Ur.prototype,"features",void 0),t([F("viewModel.goToOverride")],Ur.prototype,"goToOverride",void 0),t([l()],Ur.prototype,"headingLevel",void 0),t([F("viewModel.highlightEnabled")],Ur.prototype,"highlightEnabled",void 0),t([F("viewModel.location")],Ur.prototype,"location",void 0),t([l({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ur.prototype,"label",void 0),t([l()],Ur.prototype,"maxInlineActions",void 0),t([l(),P("esri/widgets/Popup/t9n/Popup")],Ur.prototype,"messages",void 0),t([l(),P("esri/t9n/common")],Ur.prototype,"messagesCommon",void 0),t([F("viewModel.promises")],Ur.prototype,"promises",void 0),t([F("viewModel.selectedFeature")],Ur.prototype,"selectedFeature",void 0),t([F("viewModel.selectedFeatureIndex")],Ur.prototype,"selectedFeatureIndex",void 0),t([l({readOnly:!0})],Ur.prototype,"selectedFeatureWidget",null),t([l()],Ur.prototype,"spinnerEnabled",void 0),t([F("viewModel.title")],Ur.prototype,"title",void 0),t([F("viewModel.updateLocationEnabled")],Ur.prototype,"updateLocationEnabled",void 0),t([F("viewModel.view")],Ur.prototype,"view",void 0),t([l({type:Pr}),De(["triggerAction","trigger-action"])],Ur.prototype,"viewModel",void 0),t([F("viewModel.visible")],Ur.prototype,"visible",void 0),t([l()],Ur.prototype,"visibleElements",void 0),t([g("visibleElements")],Ur.prototype,"castVisibleElements",null),t([Q()],Ur.prototype,"_close",null),t([Q()],Ur.prototype,"_toggleDockEnabled",null),t([Q()],Ur.prototype,"_toggleFeatureMenu",null),t([Q()],Ur.prototype,"_toggleActionsMenu",null),t([Q()],Ur.prototype,"_triggerAction",null),t([Q()],Ur.prototype,"_selectFeature",null),t([Q()],Ur.prototype,"_next",null),t([Q()],Ur.prototype,"_previous",null),Ur=t([e($r)],Ur);const qr=Ur,Br=[0,0];function Gr(t){t&&(it(t),t.parentNode&&t.parentNode.removeChild(t))}const Hr=i=>{let s=class extends i{constructor(...t){super(...t),this._freqInfo={freq:16,time:750},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([this.watch("cursor",(t=>{const e=this.surface;e&&e.setAttribute("data-cursor",t)})),this.watch("interacting",(t=>{const e=this.surface;e&&e.setAttribute("data-interacting",t.toString())}))])}initialize(){this.handles.add(this.watch("ui",((t,e)=>this._handleUIChange(t,e)))),this._wireUI(this.ui),this.handles.add([this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(t){const e=this._get("container");if(e===t)return;const i="dom-size";if(this.handles.remove(i),this._stopMeasuring(),e&&(e.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),Gr(this.root),this._set("root",null),tt(this.userContent,e),Gr(this.userContent),this._set("userContent",null)),t){t.classList.add("esri-view");const e=document.createElement("div");e.className="esri-view-user-storage",tt(t,e),t.appendChild(e),this._set("userContent",e);const s=document.createElement("div");s.className="esri-view-root",t.insertBefore(s,t.firstChild),this._set("root",s);const n=document.createElement("div");n.className="esri-view-surface",n.setAttribute("role","application"),n.tabIndex=0,s.appendChild(n),this._set("surface",n);const r=new _s;s.appendChild(r.surface),this._set("overlay",r),r.watch("needsRender",(t=>{t&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=et({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)})),this.forceDOMReadyCycle(),this.handles.add(_(this,"size",(t=>{const[e,i]=t,s="esri-view-surface--inset-outline";e>=document.body.clientWidth||i>=document.body.clientHeight?n.classList.add(s):n.classList.remove(s)})),i),this._set("container",t),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const t=document.activeElement===this.surface;return document.hasFocus()&&t}get popup(){return this._get("popup")||new qr({view:this})}set popup(t){const e=this._get("popup");e&&e!==t&&e.destroy(),this._set("popup",t)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(t,e,i){const s=this.position;return t-=s[0],e-=s[1],i?(i[0]=t,i[1]=e):i=[t,e],i}containerToPage(t,e,i){const s=this.position;return t+=s[0],e+=s[1],i?(i[0]=t,i[1]=e):i=[t,e],i}_handleUIChange(t,e){e&&(this.handles.remove("ui"),e.destroy()),t&&this._wireUI(t),this._set("ui",t)}_wireUI(t){this.handles.remove("ui"),t&&(t.view=this,this.handles.add([_(this,"root",(e=>{t.container=e?function(t){const e=document.createElement("div");return t.appendChild(e),e}(e):null})),_(this,"popup",((e,i)=>{const s="popup";i&&t.remove(i,s),e&&(e.view=t.view,t.add(e,{key:s,position:"manual"}))}))],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const t=this._freqInfo;t.freq=16,t.time=750,this.handles.add([(()=>{const e=()=>{t.freq=16,t.time=750};return window.addEventListener("resize",e),{remove(){window.removeEventListener("resize",e)}}})(),et({prepare:t=>{const e=this._measure(),i=this._freqInfo;if(i.time+=t.deltaTime,e&&(i.freq=16,this._get("resizing")||this._set("resizing",!0)),i.time<i.freq)return;i.time=0;const s=this._position();i.freq=s||e?16:Math.min(750,2*i.freq),!e&&i.freq>=512&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const t=this.container,e=t?t.clientWidth:0,i=t?t.clientHeight:0;if(0===e||0===i)return this.suspended||this._set("suspended",!0),!1;const s=this.width,n=this.height;return e===s&&i===n?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",e),this._set("height",i),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:n,width:e,height:i}),!0)}_position(){const t=this.position,e=function(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return Br[0]=i.left+e.pageXOffset,Br[1]=i.top+e.pageYOffset,Br}(this.container);return!(t&&e[0]===t[0]&&e[1]===t[1]||(this._set("position",[e[0],e[1]]),0))}forceDOMReadyCycle(){}};return t([l({value:null,cast:t=>X(t)})],s.prototype,"container",null),t([l({readOnly:!0})],s.prototype,"focused",null),t([l({readOnly:!0})],s.prototype,"height",void 0),t([l({type:qr})],s.prototype,"popup",null),t([l({type:_s})],s.prototype,"overlay",void 0),t([l({readOnly:!0})],s.prototype,"position",void 0),t([l({readOnly:!0})],s.prototype,"resizing",void 0),t([l({readOnly:!0})],s.prototype,"root",void 0),t([l({value:null,readOnly:!0})],s.prototype,"size",null),t([l({readOnly:!0})],s.prototype,"surface",void 0),t([l({readOnly:!0})],s.prototype,"suspended",void 0),t([l()],s.prototype,"ui",void 0),t([l({readOnly:!0})],s.prototype,"userContent",void 0),t([l({readOnly:!0})],s.prototype,"width",void 0),t([l()],s.prototype,"widthBreakpoint",void 0),s=t([e("esri.views.DOMContainer")],s),s},Wr=i=>{let s=class extends i{async fetchPopupFeatures(t,e){await this.when();const{location:i,queryArea:s,layerViewsAndGraphics:n,clientOnlyGraphics:r}=await this._prepareFetchPopupFeatures(t,e),o=Promise.resolve(r),a=this._queryLayerPopupFeatures(s,n,e),l=a.map((t=>t.promise));return{location:i,clientOnlyGraphics:r,allGraphicsPromise:st([o,...l]).then(nt),promisesPerLayerView:a}}_queryLayerPopupFeatures(t,e,i){return e.map((({layerView:e,graphics:s})=>{const n={clientGraphics:s,event:y(i)?i.event:null,signal:y(i)?i.signal:null,defaultPopupTemplateEnabled:!!y(i)&&!!i.defaultPopupTemplateEnabled},r=e.fetchPopupFeatures(t,n);return{layerView:e,promise:r}}))}_isValidPopupGraphic(t,e){return t&&!!t.getEffectivePopupTemplate(y(e)&&e.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(t,e){const{clientGraphics:i,queryArea:s,location:n}=await this._popupHitTestGraphics(t,e),r=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:o,clientOnlyGraphics:a}=this._graphicsPerFetchPopupLayerView(i,r);return{clientOnlyGraphics:a,layerViewsAndGraphics:o,queryArea:s,location:n}}async _popupHitTestGraphics(t,e){const{results:i,mapPoint:s}=await this.popupHitTest(t),n=i.filter((t=>this._isValidPopupGraphic(t.graphic,e))),r=n.length?n[0].mapPoint:null;return{clientGraphics:n.map((t=>t.graphic)),queryArea:s,location:s||r}}_getFetchPopupLayerViews(){const t=[];return this.allLayerViews.forEach((e=>{this._isValidPopupLayerView(e)&&t.push(e)})),y(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&t.push(this.graphicsView),t.reverse()}_isValidPopupLayerView(t){return y(t)&&(!("layer"in t)||!t.suspended)&&"fetchPopupFeatures"in t}_graphicsPerFetchPopupLayerView(t,e){const i=[],s=new Map,n=e.map((t=>{const e=[];return s.set("layer"in t?t.layer:t.graphics,e),{layerView:t,graphics:e}}));for(const e of t){const t=s.get(e.layer)||s.get(e.sourceLayer)||null;t?t.push(e):i.push(e)}return{layerViewsAndGraphics:n,clientOnlyGraphics:i}}};return s=t([e("esri.views.PopupView")],s),s};let Zr=class extends m{constructor(t){super(t),this.view=null,this.baseLayerViews=new s,this.referenceLayerViews=new s,this._loadingHandle=_(this,"view.map.basemap",(t=>{t&&t.load().catch((()=>{}))}))}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){return!(this.view&&this.view.suspended||!(this.view&&this.view.map&&this.view.map.basemap)||this.view.map.basemap.loaded)}};t([l({constructOnly:!0})],Zr.prototype,"view",void 0),t([l({readOnly:!0})],Zr.prototype,"baseLayerViews",void 0),t([l({readOnly:!0})],Zr.prototype,"referenceLayerViews",void 0),t([l({readOnly:!0})],Zr.prototype,"suspended",null),t([l({type:Boolean,readOnly:!0})],Zr.prototype,"updating",null),Zr=t([e("esri.views.BasemapView")],Zr);const Kr=i.getLogger("esri.views.LayerViewManager");class Jr{constructor(t,e,i){this.layer=t,this.view=e,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=rt(),this._started=!1,this.done=!1,lt(this._controller.signal,(()=>{const e=new n("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(e)}))}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:e,view:i}=this;e.emit("layerview-destroy",{view:i,layerView:t}),i.emit("layerview-destroy",{layer:e,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:e,view:i}=this;this._map=i.map;try{var s,o;let a,l;if(await e.load({signal:t}),"prefetchResources"in e&&await e.prefetchResources({signal:t}),e.createLayerView)a=await e.createLayerView(i,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(e))throw new n("layer:view-not-supported","No layerview implementation was found");const s=await this.layerViewImporter.importLayerView(e);r(t),a="default"in s?new s.default({layer:e,view:i}):new s({layer:e,view:i})}const h=()=>{l=ht(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=lt(t,h),r(t);try{await a.when()}catch(t){throw h(),t}if(!(null==(s=this._map)||null==(o=s.allLayers)?void 0:o.includes(e)))return h(),void this._deferred.reject(new n("view:no-layerview-for-layer","The layer has been removed from the map",{layer:e}));this.layerView=a,e.emit("layerview-create",{view:i,layerView:a}),i.emit("layerview-create",{layer:e,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(t){e.emit("layerview-create-error",{view:i,error:t}),i.emit("layerview-create-error",{layer:e,error:t}),this.done=!0,this._deferred.reject(new n("layerview:create-error","layerview creation failed",{layer:e,error:t}))}}}let Yr=class extends Me{constructor(t){super(t),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new _e,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var t;const e=null==(t=this.view.map)?void 0:t.allLayers;if(e)for(const t of e)this.layerViewImporter.hasLayerViewModule(t)&&this.layerViewImporter.importLayerView(t)},this._reschedule=()=>(v(this._workPromise)&&(this._workPromise=rt()),this.handles.remove("reschedule"),this.handles.add(ot(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var t,e,i;const s=this.view.map;if(this._map!==s&&(this.clear(),this._map=s),v(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const n=new ye({getCollections:()=>this._rootCollectionNames.map((t=>this.get(t))),getChildrenFunction:t=>t&&"layers"in t?t.layers:null});if(!n)return this._workPromise.resolve(),void(this._workPromise=null);for(const t of n)this._createLayerView(t);this._refreshCollections();for(const[t,e]of this._layerLayerViewInfoMap)n.includes(t)||(this._layerLayerViewInfoMap.delete(e.layer),e.destroy());const r=n.filter((t=>"group"===t.type)).map((t=>t.layers)),o=[null==s||null==(t=s.ground)?void 0:t.layers,null==s||null==(e=s.basemap)?void 0:e.baseLayers,null==s||null==(i=s.basemap)?void 0:i.referenceLayers,null==s?void 0:s.layers,...r].filter((t=>!!t));this.handles.add(o.map((t=>this._watchUpdatingTracking.addOnCollectionChange(t,this._reschedule))),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([V(this,"view.map.allLayers","change",this._preloadLayerViewModules,this._preloadLayerViewModules),_(this.view,["map.basemap","map.ground","map.layers","ready"],this._reschedule,!0)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const t=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&t.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(t)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return y(this._workPromise)||this._watchUpdatingTracking.updating||at(this._layerLayerViewInfoMap,(t=>!t.done))}get updatingRemaining(){let t=0;for(const e of this._layerLayerViewInfoMap.values())e.done||++t;return t}clear(){if(!this.destroyed){for(const t of this._layerLayerViewInfoMap.values())t.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(t){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(t))throw new n("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:t});return this._layerLayerViewInfoMap.get(t).promise}_refreshCollections(){for(const[t,e]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(t),this.get(e),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(t,e,i){if(!t||!e)return void(e&&e.removeAll());let s=0;for(const n of t){const t=this._layerLayerViewInfoMap.get(n);if(!t||!t.layerView)continue;const r=t.layerView;r.layer=n,r.parent=i,e.getItemAt(s)!==r&&e.splice(s,0,r),n.layers&&this._populateLayerViewsOwners(n.layers,r.layerViews,r),s+=1}s<e.length&&e.splice(s,e.length)}_createLayerView(t){if(this._layerLayerViewInfoMap.has(t))return this.view.ready&&this._layerLayerViewInfoMap.get(t).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");t.load().catch((()=>{})),this.layerViewImporter.hasLayerViewModule(t)&&this.layerViewImporter.importLayerView(t);const e=new Jr(t,this.view,this.layerViewImporter);e.promise.then((()=>this._refreshCollections()),(e=>{var i,s;e&&(q(e)||"cancelled:layerview-create"===e.name)||Kr.error(`Failed to create layerview for layer title:'${null!=(i=t.title)?i:"no title"}', id:'${null!=(s=t.id)?s:"no id"}' of type '${t.type}'.`,{layer:t,error:e}),this._refreshCollections()})),this._layerLayerViewInfoMap.set(t,e),this.view.ready&&e.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};t([l()],Yr.prototype,"_workPromise",void 0),t([l({readOnly:!0})],Yr.prototype,"_watchUpdatingTracking",void 0),t([l({readOnly:!0})],Yr.prototype,"_layersToLayerViews",null),t([l({readOnly:!0})],Yr.prototype,"_rootCollectionNames",null),t([l()],Yr.prototype,"layerViewImporter",void 0),t([l()],Yr.prototype,"supportsGround",void 0),t([l({readOnly:!0})],Yr.prototype,"updating",null),t([l({readOnly:!0})],Yr.prototype,"updatingRemaining",null),t([l({constructOnly:!0})],Yr.prototype,"view",void 0),Yr=t([e("esri.views.LayerViewManager")],Yr);const Qr=Yr;let Xr=class extends m{constructor(t){super(t),this.factor=1.5,this.offset=te(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};t([l({type:Number})],Xr.prototype,"factor",void 0),t([l({nonNullable:!0})],Xr.prototype,"offset",void 0),t([l()],Xr.prototype,"position",void 0),t([l({type:Number,range:{min:0}})],Xr.prototype,"size",void 0),t([l()],Xr.prototype,"maskUrl",void 0),t([l()],Xr.prototype,"maskEnabled",void 0),t([l()],Xr.prototype,"overlayUrl",void 0),t([l()],Xr.prototype,"overlayEnabled",void 0),t([l({readOnly:!0})],Xr.prototype,"version",null),t([l({type:Boolean})],Xr.prototype,"visible",void 0),Xr=t([e("esri.views.Magnifier")],Xr);const to=Xr;class eo{constructor(t,e){this._stage=t,this._textureRequests=new Map,this._frameTask=y(e)?e.registerTask(si.TEXTURE_UNLOAD):ni}destroy(){this._frameTask.remove(),this._textureRequests.forEach((t=>this._releaseTextureRequest(t))),this._textureRequests.clear()}fromData(t,e){const i=this.makeUid(t);let s=this._textureRequests.get(i);return s||(s={referenceCount:0,texture:e(),textureAsync:null,abortController:null},this._stage&&(this._stage.add(s.texture),this._stage.loadSynchronous(s.texture)),this._textureRequests.set(i,s)),s.referenceCount++,{uid:i,texture:s.texture,release:()=>this._release(i)}}_release(t){if(!this._textureRequests)return;const e=this._textureRequests.get(t);e?(e.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+t),e.referenceCount--,e.referenceCount<1&&this._frameTask.schedule((()=>this._releaseNow(t)))):console.warn(`TextureCollection: texture doesn't exist: '${t}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(t){if(!this._textureRequests)return;const e=this._textureRequests.get(t);!e||e.referenceCount>0||(this._releaseTextureRequest(e),this._textureRequests.delete(t))}_releaseTextureRequest(t){var e;t.texture?null==(e=this._stage)||e.remove(t.texture):t.abortController&&(t.abortController.abort(),t.abortController=null)}makeUid(t,e=null){return y(e)?`${t}.${e}px`:t}}const io=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],so={};function no(t){return!!so[t]}io.forEach((t=>{so[t]=!0}));class ro{constructor(t){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this.handlers.forEach((({handler:t,priority:e},i)=>this.inputManager.installHandlers(i,[t],e)))}disconnect(){this.inputManager&&this.handlers.forEach(((t,e)=>this.inputManager.uninstallHandlers(e))),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(t,e,i,s){const n=Array.isArray(t)?t:t.split(",");if(!function(t){for(const e of t)if(!no(e))return!1;return!0}(n))return n.some(no)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let r,o;Array.isArray(e)?o=e:(r=e,o=[]),"function"==typeof i?r=i:s=i,s=null!=s?s:br.DEFAULT;const a=this.createUniqueGroupName(),l=new oo(this.view,n,o,r);this.handlers.set(a,{handler:l,priority:s});for(const t of n){const e=this.handlerCounts.get(t)||0;this.handlerCounts.set(t,e+1)}return this.inputManager&&this.inputManager.installHandlers(a,[l],s),{remove:()=>this.removeHandler(a,n)}}hasHandler(t){return!!this.handlerCounts.get(t)}removeHandler(t,e){if(this.handlers.has(t)){this.handlers.delete(t);for(const t of e){const e=this.handlerCounts.get(t);void 0===e?console.error("Trying to remove handler for event that has no handlers registered: ",t):1===e?this.handlerCounts.delete(t):this.handlerCounts.set(t,e-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class oo extends pr{constructor(t,e,i,s){super(!0),this.view=t;for(const t of e)switch(t){case"click":this.registerIncoming("click",i,(t=>s(this.wrapClick(t))));break;case"double-click":this.registerIncoming("double-click",i,(t=>s(this.wrapDoubleClick(t))));break;case"immediate-click":this.registerIncoming("immediate-click",i,(t=>s(this.wrapImmediateClick(t))));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,(t=>s(this.wrapImmediateDoubleClick(t))));break;case"hold":this.registerIncoming("hold",i,(t=>s(this.wrapHold(t))));break;case"drag":this.registerIncoming("drag",i,(t=>{const e=this.wrapDrag(t);e&&s(e)}));break;case"key-down":this.registerIncoming("key-down",i,(t=>s(this.wrapKeyDown(t))));break;case"key-up":this.registerIncoming("key-up",i,(t=>s(this.wrapKeyUp(t))));break;case"pointer-down":this.registerIncoming("pointer-down",i,(t=>s(this.wrapPointer(t,"pointer-down"))));break;case"pointer-move":this.registerIncoming("pointer-move",i,(t=>s(this.wrapPointer(t,"pointer-move"))));break;case"pointer-up":this.registerIncoming("pointer-up",i,(t=>s(this.wrapPointer(t,"pointer-up"))));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,(t=>s(this.wrapPointerDrag(t))));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,(t=>s(this.wrapMouseWheel(t))));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,(t=>s(this.wrapPointer(t,"pointer-enter"))));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,(t=>s(this.wrapPointer(t,"pointer-leave"))));break;case"gamepad":this.registerIncoming("gamepad",i,(t=>{s(this.wrapGamepad(t))}));break;case"focus":this.registerIncoming("focus",i,(t=>{s(this.wrapFocus(t))}));break;case"blur":this.registerIncoming("blur",i,(t=>{s(this.wrapBlur(t))}))}}wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapClick(t){const{pointerType:e,button:i,buttons:s,x:n,y:r,native:o,eventId:a}=t.data,{cancelable:l,timestamp:h}=t;return{type:"click",pointerType:e,button:i,buttons:s,x:n,y:r,native:o,timestamp:h,screenPoint:te(n,r),mapPoint:this.getMapPoint(n,r),eventId:a,cancelable:l,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapDoubleClick(t){const{pointerType:e,button:i,buttons:s,x:n,y:r,native:o,eventId:a}=t.data,{cancelable:l,timestamp:h}=t;return{type:"double-click",pointerType:e,button:i,buttons:s,x:n,y:r,native:o,timestamp:h,mapPoint:this.getMapPoint(n,r),eventId:a,cancelable:l,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapImmediateClick(t){const{pointerType:e,button:i,buttons:s,x:n,y:r,native:o,eventId:a}=t.data,l=o.pointerId,{cancelable:h,timestamp:u}=t;return{type:"immediate-click",pointerId:l,pointerType:e,button:i,buttons:s,x:n,y:r,native:o,timestamp:u,mapPoint:this.getMapPoint(n,r),eventId:a,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapImmediateDoubleClick(t){const{pointerType:e,button:i,buttons:s,x:n,y:r,native:o,eventId:a}=t.data,l=o.pointerId,{cancelable:h,timestamp:u}=t;return{type:"immediate-double-click",pointerId:l,pointerType:e,button:i,buttons:s,x:n,y:r,native:o,timestamp:u,mapPoint:this.getMapPoint(n,r),eventId:a,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapHold(t){const{pointerType:e,button:i,buttons:s,x:n,y:r,native:o}=t.data,{cancelable:a,timestamp:l}=t;return{type:"hold",pointerType:e,button:i,buttons:s,x:n,y:r,native:o,timestamp:l,mapPoint:this.getMapPoint(n,r),cancelable:a,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}getMapPoint(t,e){return this.view.toMap(te(t,e),{exclude:[]})}wrapDrag(t){const e=t.data,{x:i,y:s}=e.center,{action:n,pointerType:r,button:o}=e;if("start"===n&&(this.latestDragStart=e),!this.latestDragStart)return;const a=e.pointer.native,l=e.buttons,{cancelable:h,timestamp:u}=t,c={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===n&&(this.latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:c,pointerType:r,button:o,buttons:l,radius:e.radius,angle:ee(e.angle),native:a,timestamp:u,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapKeyDown(t){const{key:e,repeat:i,native:s}=t.data,{cancelable:n,timestamp:r}=t;return{type:"key-down",key:e,repeat:i,native:s,timestamp:r,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapKeyUp(t){const{key:e,native:i}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:e,native:i,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapPointer(t,e){const{x:i,y:s,button:n,buttons:r,native:o,eventId:a}=t.data,l=o.pointerId,h=o.pointerType,{cancelable:u,timestamp:c}=t;return{type:e,x:i,y:s,pointerId:l,pointerType:h,button:n,buttons:r,native:o,timestamp:c,eventId:a,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapPointerDrag(t){const{x:e,y:i,buttons:s,native:n,eventId:r}=t.data.currentEvent,{button:o}=t.data.startEvent,a=t.data.startEvent.native.pointerId,l=t.data.startEvent.native.pointerType,h=t.data.action,u={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:c,timestamp:d}=t;return{type:"pointer-drag",x:e,y:i,pointerId:a,pointerType:l,button:o,buttons:s,action:h,origin:u,native:n,timestamp:d,eventId:r,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapMouseWheel(t){const{cancelable:e,data:i,timestamp:s}=t,{x:n,y:r,deltaY:o,native:a}=i;return{type:"mouse-wheel",x:n,y:r,deltaY:o,native:a,timestamp:s,cancelable:e,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}wrapGamepad(t){const{action:e,state:i,device:s}=t.data,{cancelable:n,timestamp:r}=t,{buttons:o,axes:a}=i;return{type:"gamepad",device:s,timestamp:r,action:e,buttons:o,axes:a,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:e=>t.async(e),preventDefault:()=>t.preventDefault()}}}function ao(t){return[t.on("after-add",(t=>{const e=t.item;e.view&&e.view.ready&&!e.attached&&e.attach()})),t.on("after-remove",(t=>{const e=t.item;e.active&&(e.view.activeTool=null),e.attached&&e.detach()}))]}function lo(t){return t.visible&&t.getEditableFlag(0)&&t.getEditableFlag(1)}function ho(t){return te(t.x,t.y)}function uo(t,e){const i=(t instanceof HTMLElement?t:t.surface).getBoundingClientRect();return te(e.clientX-i.left,e.clientY-i.top)}function co(t,e){return e instanceof Event?uo(t,e):ho(e)}function po(t){if(t instanceof Event)return!0;if("object"==typeof t&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class fo{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,e){const i=()=>t.stopPropagation();switch(t.type){case"pointer-move":mo(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),"end"===t.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!vo(t))break;const s=ho(t),n=this._intersect(s,t.pointerType,e.forEachTool);if(v(n))break;const r=this._findToolAndManipulatorByKey(n,e.forEachTool,go),o=ut(r,(t=>t.manipulator)),a=ut(r,(t=>t.tool));!(y(o)&&y(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(t)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,a,t),y(o)&&o.interactive&&o.grabbable&&o.grabbableForEvent(t)&&!o.grabbing&&(this._grabbedManipulators.set(t.pointerId,{key:n,start:s,pointerType:t.pointerType}),1===this._grabbedManipulators.size&&e.activeTool!==n.tool&&(this._currentlyActiveTool=e.activeTool,this._revertToActiveTool=!0,e.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),i());break}case"pointer-up":this._handlePointerEnd(t,e);break;case"pointer-drag":{if(!vo(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=this._draggedManipulators.get(t.pointerId),r=ut(s||n,(({key:t})=>t)),o=this._findManipulatorByKey(r,e.forEachTool);if(v(o))break;const a=ho(t);a.x=Lt(a.x,0,e.view.width),a.y=Lt(a.y,0,e.view.height);const l=J(s||n).start;switch(t.action){case"start":case"update":"update"!==t.action&&1!==this._grabbedManipulators.size||(o.dragging=!0,o.events.emit("drag",n?{action:"update",start:l,screenPoint:a}:{action:"start",start:l,screenPoint:a,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{key:J(r),start:l}));break;case"end":o.dragging=!1,n&&o.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,e)}i();break}case"immediate-click":{const s=ho(t),n=this._intersect(s,t.pointerType,e.forEachTool),r=this._findToolAndManipulatorByKey(n,e.forEachTool,go);if(function(t){return!!t.native.shiftKey}(t)||e.forEachTool((t=>{if((!y(r)||r.tool!==t||t.automaticManipulatorSelection)&&t.manipulators){let e=!1;t.manipulators.forEach((({manipulator:t})=>{t.selected&&(t.selected=!1,e=!0)})),e&&t.manipulatorSelectionChanged&&t.manipulatorSelectionChanged()}})),v(r))break;const{manipulator:o,tool:a}=r;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.manipulatorSelectionChanged&&a.manipulatorSelectionChanged()),o.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:t.native.shiftKey,stopPropagation:i});break}case"click":{const s=ho(t),n=this._intersect(s,t.pointerType,e.forEachTool),r=this._findManipulatorByKey(n,e.forEachTool);if(v(r)||!r.interactive)break;r.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:t.native.shiftKey}),i();break}case"double-click":{const s=ho(t),n=this._intersect(s,t.pointerType,e.forEachTool),r=this._findManipulatorByKey(n,e.forEachTool);if(v(r)||!r.interactive)break;r.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:t.native.shiftKey,stopPropagation:i});break}case"immediate-double-click":{const s=ho(t),n=this._intersect(s,t.pointerType,e.forEachTool),r=this._findManipulatorByKey(n,e.forEachTool);if(v(r)||!r.interactive)break;r.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:t.native.shiftKey,stopPropagation:i});break}}this._updateCursor(e.forEachTool)}_ungrabManipulatorBeforeDragging(t,e,i){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:ho(i)}),this._grabbedManipulators.forEach((({key:i},s)=>{i.tool===e&&e.manipulators.findById(i.manipulatorId)===t&&this._grabbedManipulators.delete(s)}))}_handlePointerEnd(t,e){const i=ut(this._grabbedManipulators.get(t.pointerId),(({key:t})=>t)),s=this._findManipulatorByKey(i,e.forEachTool);y(s)&&!s.dragging&&(1===this._grabbedManipulators.size&&0===this._draggedManipulators.size&&this._revertToActiveTool&&(e.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),s.grabbing&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:ho(t)})),this._grabbedManipulators.delete(t.pointerId))}_cursorFromMap(t,e){let i=null;return at(t,(({key:t})=>{const s=this._findManipulatorByKey(t,e);return!!(y(s)&&s.interactive&&"cursor"in s&&s.cursor)&&(i=s.cursor,!0)})),i}_updateCursor(t){this._cursor=this._grabbedManipulators.size>0?this._cursorFromMap(this._grabbedManipulators,t)||"grabbing":this._hoveredManipulators.size>0?this._cursorFromMap(this._hoveredManipulators,t)||"pointer":null}clearPointers(t,e,i=!0,s){const n=e=>e.tool===t&&(v(s)||e.manipulatorId===s);this._grabbedManipulators.forEach((({key:t,pointerType:i},s)=>{if(n(t)){this._grabbedManipulators.delete(s);const n=this._findManipulatorByKey(t,e);y(n)&&(n.grabbing=!1,n.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:i}))}})),this._draggedManipulators.forEach((({key:t},i)=>{if(n(t)){this._draggedManipulators.delete(i);const s=this._findManipulatorByKey(t,e);y(s)&&(s.dragging=!1,s.events.emit("drag",{action:"cancel"}))}})),i&&this._hoveredManipulators.forEach((({key:t},i)=>{if(n(t)){this._hoveredManipulators.delete(i);const s=this._findManipulatorByKey(t,e);y(s)&&(s.hovering=!1)}})),this._updateCursor(e)}_intersect(t,e,i){let s=null;return i((i=>{if(null==i.manipulators||!lo(i))return!1;const n=i.manipulators.intersect(t,e);return!v(n)&&(s={manipulatorId:n.id,tool:i},!0)})),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach(((e,i)=>{this._updateHoveredStateForPointerAtScreenPosition(te(e.x,e.y),i,e.pointerType,t)}))}handleHoverEvent(t,e){"pointer-up"!==t.type&&"immediate-click"!==t.type&&"pointer-move"!==t.type||!mo(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(ho(t),t.pointerId,t.pointerType,e)}_updateHoveredStateForPointerAtScreenPosition(t,e,i,s){const n=this._intersect(t,i,s);let r=this._findManipulatorByKey(n,s);const o=ut(this._hoveredManipulators.get(e),(({key:t})=>t)),a=this._findManipulatorByKey(o,s);y(r)&&!r.interactive&&(r=null),a!==r&&(y(a)&&(a.hovering=!1),y(r)?(r.hovering=!0,this._hoveredManipulators.set(e,{key:J(n)})):this._hoveredManipulators.delete(e),this._updateCursor(s))}_findManipulatorByKey(t,e){return this._findToolAndManipulatorByKey(t,e,go)?go.manipulator:null}_findToolAndManipulatorByKey(t,e,i){return v(t)?null:(i.tool=null,i.manipulator=null,e((e=>{if(e!==t.tool||null==e.manipulators||!lo(e))return!1;const s=e.manipulators.findById(t.manipulatorId);return!!y(s)&&(i.manipulator=s,i.tool=e,!0)})),i.manipulator?i:null)}}function mo(t){return"mouse"===t}function vo(t){return"mouse"!==t.pointerType||0===t.button}const go={manipulator:null,tool:null},wo=i.getLogger("esri.views.ToolViewManager"),yo="manipulators";let bo=class extends Me{constructor(t){super(t),this._manipulatorState=new fo,this.tools=new s,this.cursor=null,this._forEachTool=t=>{for(const e of this.tools.items)if(t(e))return}}initialize(){this.handles.add([this.view.on(io,(t=>{this._handleInputEvent(t)}),br.TOOL),...ao(this.tools),this.tools.on("before-add",(t=>{const e=t.item;if(null==e||this.tools.includes(e))return wo.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault()})),this.tools.on("before-remove",(({item:t})=>{this._manipulatorState.clearPointers(t,this._forEachTool)})),this.tools.on("change",(()=>{this._refreshToolWatchers()}))])}destroy(){this._forEachTool((t=>t.destroy()))}set activeTool(t){if(y(t)&&!this.view.ready)return void wo.error("Cannot set active tool while view is not ready.");if(t===this.activeTool)return void(y(t)&&wo.warn("Tool is already active - ignoring activation request."));y(this.activeTool)&&this.activeTool.deactivate(),y(t)&&t.activate(),this._set("activeTool",t),this._removeIncompleteTools(t);const e=v(this.activeTool);for(const t of this.tools){t.setEditableFlag(1,e||t===this.activeTool);const i=lo(t);!e&&i||this._manipulatorState.clearPointers(t,this._forEachTool,!i)}this._updateCursor()}get updating(){return this.updatingHandles.updating||this.tools.some((t=>t.updating))}attach(){this._forEachTool((t=>t.attach())),"3d"===this.view.type?(this._set("textures",new eo(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([this.view.state.watch("camera",(()=>{this._forEachManipulator((t=>{null!=t.onViewChange&&t.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(t=>{this._forEachManipulator((e=>{null!=e.onElevationChange&&e.onElevationChange(t)}))}))],yo)):this.handles.add(this.view.watch("extent",(()=>{this._forEachManipulator((t=>{null!=t.onViewChange&&t.onViewChange()}))})))}detach(){y(this.activeTool)&&(this.activeTool=null),this._forEachTool((t=>{t.detach(),t.destroy()})),this.tools.removeAll(),this.handles.remove(yo)}_forEachManipulator(t){this._forEachTool((e=>{e.manipulators&&e.manipulators.forEach((({manipulator:i})=>t(i,e)))}))}_handleInputEvent(t){let e=!1;const i={...t,stopPropagation:()=>{e=!0,t.stopPropagation()}};y(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool((t=>{!e&&t.attached&&t.visible&&t.handleInputEvent(i)})),!e&&"key-down"===t.type&&"Escape"===t.key&&this.activeTool&&(t.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:t=>{this.activeTool=t},view:this.view}),!e&&y(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove("tools"),this._forEachTool((t=>{if(t instanceof m){const e=G(t,["cursor","visible","editable"],(()=>{lo(t)||this._manipulatorState.clearPointers(t,this._forEachTool),this._updateCursor()}));this.handles.add(e,"tools")}t.manipulators&&this.handles.add(t.manipulators.on("change",(e=>{e.removed.forEach((({id:e})=>{this._manipulatorState.clearPointers(t,this._forEachTool,!0,e)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})),"tools")})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){let t=this._manipulatorState.cursor;this._forEachTool((e=>!(!y(e.cursor)||!e.visible||(t=e.cursor,0)))),this._get("cursor")!==t&&this._set("cursor",t)}_removeIncompleteTools(t){this.tools.filter((e=>(v(t)||e!==t)&&!e.completed)).forEach((t=>{this.tools.remove(t),t.destroy()}))}};t([l({constructOnly:!0,nonNullable:!0})],bo.prototype,"view",void 0),t([l({readOnly:!0,nonNullable:!0})],bo.prototype,"textures",void 0),t([l({value:null})],bo.prototype,"activeTool",null),t([l({readOnly:!0,type:s})],bo.prototype,"tools",void 0),t([l({readOnly:!0})],bo.prototype,"cursor",void 0),t([l({readOnly:!0})],bo.prototype,"updating",null),bo=t([e("esri.views.ToolViewManager")],bo);const _o=bo;let Mo=class extends m{constructor(t){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",this._detectedDeviceType="standard"===t.mapping?"standard":xo.test(t.id)?"spacemouse":"unknown",this.nativeIndex=t.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Io[this.deviceType]}};t([l({nonNullable:!0,readOnly:!0})],Mo.prototype,"nativeIndex",void 0),t([l({type:String,readOnly:!0})],Mo.prototype,"deviceType",null),t([l({type:Number,readOnly:!0})],Mo.prototype,"axisThreshold",null),Mo=t([e("esri.views.input.gamepad.GamepadInputDevice")],Mo);const xo=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Io={standard:.15,spacemouse:.025,unknown:0},ko=Mo;let Ao=class extends m{constructor(...t){super(...t),this.devices=new s,this.enabledFocusMode="document"}};t([l({type:s.ofType(ko),readOnly:!0})],Ao.prototype,"devices",void 0),t([l({type:["document","view","none"]})],Ao.prototype,"enabledFocusMode",void 0),Ao=t([e("esri.views.input.gamepad.GamepadSettings")],Ao);const Co=Ao;let Oo=class extends m{constructor(){super(...arguments),this.gamepad=new Co}};t([l({readOnly:!0})],Oo.prototype,"gamepad",void 0),Oo=t([e("esri.views.input.Input")],Oo);const To=Oo;let Fo=class extends m{constructor(t){super(t),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};t([l({type:Boolean,nonNullable:!0})],Fo.prototype,"enabled",void 0),t([l({type:ko})],Fo.prototype,"device",void 0),t([l({type:["pan","zoom"],nonNullable:!0})],Fo.prototype,"mode",void 0),t([l({type:["forward-down","forward-up"],nonNullable:!0})],Fo.prototype,"tiltDirection",void 0),t([l({type:Number,nonNullable:!0})],Fo.prototype,"velocityFactor",void 0),Fo=t([e("esri.views.navigation.gamepad.GamepadSettings")],Fo);const Po=Fo;let Eo=class extends m{constructor(t){super(t),this.browserTouchPanEnabled=!0,this.gamepad=new Po,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};t([l({type:Boolean})],Eo.prototype,"browserTouchPanEnabled",void 0),t([l({type:Po,nonNullable:!0})],Eo.prototype,"gamepad",void 0),t([l({type:Boolean})],Eo.prototype,"momentumEnabled",void 0),t([l({type:Boolean})],Eo.prototype,"mouseWheelZoomEnabled",void 0),Eo=t([e("esri.views.navigation.Navigation")],Eo);const Vo=Eo;function So(t){return"heightModelInfo"in t}function Ro(t){if("unknown"===t.type||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function No(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"analysis":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}const Lo=new ii({heightModel:"gravity-related-height"});var zo;const $o=i.getLogger("esri.views.support.DefaultsFromMap");let jo=zo=class extends m{constructor(){super(...arguments),this._handles=new b,this._waitTask=null,this._extentProjectController=null,this._spatialReferenceCandidates=null,this._extentCandidates=null,this.logDebugInformation=!1,this.isSpatialReferenceDone=!1,this.isTileInfoDone=!1,this.isHeightModelInfoSearching=!1,this.spatialReference=null,this.extent=null,this.heightModelInfo=null,this.vcsWkid=null,this.latestVcsWkid=null,this.mapCollectionPaths=zo.DefaultMapCollectionPaths.slice(),this.tileInfo=null}initialize(){this.watch("mapCollectionPaths",(()=>{this._running&&(this.reset(),this.start())}))}destroy(){this._set("view",null),this._handles=ct(this._handles),this._cancelLoading()}get _running(){return!!(this._handles&&this._handles.size>0)}reset(){this._handles.removeAll(),this._set("isSpatialReferenceDone",!1),this._set("isTileInfoDone",!1),this._set("isHeightModelInfoSearching",!1),this._set("spatialReference",null),this._set("extent",null),this._set("heightModelInfo",null),this._set("vcsWkid",null),this._set("latestVcsWkid",null),this._set("tileInfo",null),this._spatialReferenceCandidates=null,this._extentCandidates=null}start(){this._handles.removeAll();const t=this._updateLayerChange.bind(this);for(const e of this.mapCollectionPaths)this._handles.add(V(this.view,`map.${e}`,"change",t,t,t,!0));this._handles.add(dt(this,"isSpatialReferenceDone",(()=>this._updateTileInfo()),!0))}_ownerNameFromCollectionName(t){const e=t.lastIndexOf(".");return-1===e?"view":"view."+t.slice(0,e)}_ensureLoadedOwnersFromCollectionName(t){const e=this._ownerNameFromCollectionName(t).split(".");let i;for(let s=0;s<e.length&&(i=this.get(e.slice(0,s+1).join(".")),i);s++)if(i.load&&!i.isFulfilled())return{collectionName:t,owner:null,loading:i.load().catch((()=>{}))};return{collectionName:t,owner:i}}_cancelLoading(){this._waitTask=null,this._extentProjectController&&(this._extentProjectController.abort(),this._extentProjectController=null)}_updateWhen(t){let e=!0,i=!1;const s=t.catch((()=>{})).then((()=>{e?i=!0:s===this._waitTask&&this._update()}));return e=!1,i||(this._waitTask=s),i}_updateLayerChange(){this.isSpatialReferenceDone&&!this.spatialReference&&this._set("isSpatialReferenceDone",!1),this._update()}_update(){if(this._cancelLoading(),this.view){if(!this.isSpatialReferenceDone){this._debugLog("Starting search for spatial reference...");const t=this._processMapCollections((t=>this._processSpatialReferenceSource(t)));if(this._debugLog(`Search ended with status '${Uo(t)}'`),0!==t){let t=null,e=this._spatialReferenceCandidates;if(!e||e.length<1?(t=this.defaultSpatialReference,this._debugLog(`No spatial reference found, locking to default (${Do(t)})`)):(this.defaultSpatialReference&&e.length>1&&e.findIndex((t=>t.equals(this.defaultSpatialReference)))>-1&&(e=[this.defaultSpatialReference]),t=e[0],this._debugLog(`Locking to ${Do(t)}`)),this._set("spatialReference",t),t)if(this.extent)this._set("isSpatialReferenceDone",!0);else{const e=this.logDebugInformation;this.logDebugInformation=!1,this._processMapCollections((e=>this._findExtent(e,t))),this.logDebugInformation=e,this._projectExtentCandidate().catch((()=>{})).then((()=>this._set("isSpatialReferenceDone",!0)))}else this._set("isSpatialReferenceDone",!0)}}if(null==this.heightModelInfo&&this.view.isHeightModelInfoRequired){this._debugLog("Starting search for height model info...");const t=this._processMapCollections((t=>this._processHeightModelInfoSource(t)),(t=>function(t){return null!=t.layers||No(t)||Ro(t)||So(t)}(t)));this._debugLog(`Search ended with status ${Uo(t)}`),this._set("isHeightModelInfoSearching",0===t)}this._updateTileInfo()}}_processMapCollections(t,e){this._preloadMapCollections(e);let i=2;return this._forAllMapCollectionSources((t=>{if(2!==i)return!1;const{collectionName:e}=t;return this._debugLog(`Processing collection ${e}...`),!(t.loading&&!this._updateWhen(t.loading)&&(this._debugLog(`Collection ${t.collectionName} owner is loading -> wait`),i=0,1))}),(s=>!(2!==i||(null==e||e(s)?!s.load||s.isFulfilled()||this._updateWhen(s.load())?(!s.load||s.isResolved())&&t(s)&&(i=1,1):(this._debugLog(`Source ${s.id} is loading -> wait`),i=0,1):(this._debugLog(`Source ${s.id} is skipped due to predicate`),1))))),i}_preloadMapCollections(t){let e=10;const i=this.logDebugInformation;this.logDebugInformation=!1,this._forAllMapCollectionSources((()=>!0),(s=>0!==e&&!(null!=t&&!t(s)||(s.load&&!s.isFulfilled()&&(this.logDebugInformation=i,this._debugLog(`Pre-loading source ${s.id}`),this.logDebugInformation=!1,s.load().catch((()=>{})),e--),0)))),this.logDebugInformation=i}_forAllMapCollectionSources(t,e){for(const i of this.mapCollectionPaths){const s=`map.${i}`,n=this._ensureLoadedOwnersFromCollectionName(s);if(!1===t(n))continue;const r=n.owner;if(!r||r.isRejected&&r.isRejected()){this._debugLog(`Collection ${s} owner is invalid or rejected -> skip`);continue}const o=this.view.get(s);o?this._forEachSource(o,e):this._debugLog(`Collection ${s} does not exist -> skip`)}}_forEachSource(t,e){for(const i of t.items)!1!==e(i)&&"layers"in i&&i.layers&&this._forEachSource(i.layers,e)}_processSpatialReferenceSource(t){let e=this._getSupportedSpatialReferences(t);return 0!==e.length&&(this._spatialReferenceCandidates?(e=pt(e,this._spatialReferenceCandidates,((t,e)=>t.equals(e))),e.length>0?this._spatialReferenceCandidates=e:this._debugLog(`Layer ${t.id} is ignored because its supported spatial\n          references are not compatible with the previous candidates`)):this._spatialReferenceCandidates=e,1===this._spatialReferenceCandidates.length)}_findExtent(t,e){const i="fullExtents"in t&&t.fullExtents||(y(t.fullExtent)?[t.fullExtent]:[]),s=i.find((t=>t.spatialReference.equals(e)));if(s)return this._set("extent",s),!0;if(this._getSupportedSpatialReferences(t).length>0){const e=i.map((e=>({extent:e,layer:t})));this._extentCandidates=(this._extentCandidates||[]).concat(e)}return!1}async _projectExtentCandidate(){if(!this._extentCandidates||!this._extentCandidates.length)return;const t=this.spatialReference,e=this._extentCandidates.find((e=>ie(e.extent.spatialReference,t)));if(y(e))this._set("extent",J(se(e.extent,t)));else{const e=this._extentCandidates[0];this._extentProjectController=new AbortController;const i=await import("./p-24070760.js");try{const s=await i.projectGeometry(e.extent,t,e.layer.portalItem,this._extentProjectController.signal);this._set("extent",s)}catch{}this._extentProjectController=null}}_getSupportedSpatialReferences(t){const e="supportedSpatialReferences"in t&&t.supportedSpatialReferences||(t.spatialReference?[t.spatialReference]:[]);if(0===e.length)return this._debugLog(`Layer ${t.id} is ignored because it does not have any spatial references`),[];const i=e.filter((e=>this.view.isSpatialReferenceSupported(e,t,(t=>this._debugLog(t)))));return this._debugLog(0===i.length?`Layer ${t.id} has spatial references but none of them are supported (or layer doesn't require locking)`:`Layer ${t.id} has spatial references. Resulting candidate set: ${i.map(Do).join(", ")}`),i}_processHeightModelInfoSource(t){const e=function(t){const e=t.url&&ri(t.url);return null==(t.spatialReference&&t.spatialReference.vcsWkid)&&y(e)&&"ImageServer"===e.serverType||!So(t)||!t.heightModelInfo?function(t){return Ro(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):No(t)}(t)?ii.deriveUnitFromSR(Lo,t.spatialReference):null:t.heightModelInfo}(t);return!!e&&(this._set("heightModelInfo",e),this._set("isHeightModelInfoSearching",!1),t.spatialReference&&(this._set("vcsWkid",t.spatialReference.vcsWkid),this._set("latestVcsWkid",t.spatialReference.latestVcsWkid)),!0)}_updateTileInfo(){if(null!=this.tileInfo)return;if(!this.view.isTileInfoRequired())return void this._set("isTileInfoDone",!0);if(!this.isSpatialReferenceDone)return;const t=this.get("view.map");if(!t)return void this._debugLog("updateTileInfo: no map");const e=t.basemap,i=t.get("layers.0");let s=null;if(e&&"failed"!==e.loadStatus){if(!e.loaded)return this._updateWhen(e.load()),void this._debugLog("updateTileInfo: basemap still loading");const t=e&&e.get("baseLayers.0");if(t&&"failed"!==t.loadStatus){if(!t.loaded)return this._updateWhen(t.load()),void this._debugLog("updateTileInfo: first basemap layer still loading");s="tileInfo"in t&&t.tileInfo}else{if(!i||"failed"===i.loadStatus)return this._debugLog("updateTileInfo: no tileInfo"),void this._set("isTileInfoDone",!0);if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first operational layer still loading");s="tileInfo"in i&&i.tileInfo}}else if(i&&"failed"!==i.loadStatus){if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first operational layer still loading");s="tileInfo"in i&&i.tileInfo}s&&!s.spatialReference.equals(this.spatialReference)&&(s=null),this._debugLog(`updateTileInfo: setting ${s}`),this._set("tileInfo",s),this._set("isTileInfoDone",!0)}_debugLog(t){this.logDebugInformation&&$o.info(t)}};function Do(t){return t?JSON.stringify(t.toJSON()):"undefined"}function Uo(t){switch(t){case 0:return"Waiting";case 1:return"Found";case 2:return"Exhausted"}}jo.DefaultMapCollectionPaths=["basemap.baseLayers","layers","ground.layers","basemap.referenceLayers"],t([l()],jo.prototype,"logDebugInformation",void 0),t([l({readOnly:!0})],jo.prototype,"isSpatialReferenceDone",void 0),t([l({readOnly:!0})],jo.prototype,"isTileInfoDone",void 0),t([l({readOnly:!0})],jo.prototype,"isHeightModelInfoSearching",void 0),t([l({constructOnly:!0})],jo.prototype,"view",void 0),t([l({readOnly:!0})],jo.prototype,"spatialReference",void 0),t([l({readOnly:!0})],jo.prototype,"extent",void 0),t([l({readOnly:!0})],jo.prototype,"heightModelInfo",void 0),t([l({readOnly:!0})],jo.prototype,"vcsWkid",void 0),t([l({readOnly:!0})],jo.prototype,"latestVcsWkid",void 0),t([l()],jo.prototype,"mapCollectionPaths",void 0),t([l()],jo.prototype,"defaultSpatialReference",void 0),t([l({readOnly:!0})],jo.prototype,"tileInfo",void 0),jo=zo=t([e("esri.views.support.DefaultsFromMap")],jo);const qo=jo;var Bo;const Go=i.getLogger("esri.views.View");let Ho=Bo=class extends(xe(f.EventedMixin(ft(m)))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new ye({getCollections:()=>{var t,e,i;return[null==(t=this.basemapView)?void 0:t.baseLayerViews,null==(e=this.groundView)?void 0:e.layerViews,this.layerViews,null==(i=this.basemapView)?void 0:i.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.defaultsFromMap=new qo({view:this}),this.fatalError=null,this.extent=null,this.graphics=new ti,this.navigating=!1,this.layerViews=new s,this.magnifier=new to,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new To,this.navigation=new Vo,this.layerViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new ro(this),this.persistableViewModels=new s,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(this.watch("preconditionsReady",(t=>{t?(this._currentSpatialReference=this.spatialReference,Bo.views.add(this)):(this._currentSpatialReference=null,Bo.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?(this.layerViewManager.clear(),this.toolViewManager.detach(),this._teardown()):t&&!this.ready&&(this._startup(),this.toolViewManager.attach())}),!0))}initialize(){let t;this.addResolvingPromise(this.validate().then((()=>(this._isValid=!0,mt(this,"ready"))))),this.basemapView=new Zr({view:this}),this.layerViewManager=new Qr({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new _o({view:this}),this._resetInitialViewPropertiesFromContent(),_(this.defaultsFromMap,"isSpatialReferenceDone",(e=>{const i=!!(this.map&&this.map.allLayers.length>0);if(e&&!this.spatialReference&&i||!t){if(e&&!this.spatialReference&&i&&!t){const e=t=W(this.spatialReferenceWarningDelay);t.then((()=>{e===t&&Go.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})).catch((()=>{}))}}else t=null}),!0)}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=ct(this.graphics),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.toolViewManager=ct(this.toolViewManager),this.layerViewManager=ct(this.layerViewManager),this.basemapView=ct(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const t=this.map;this.map=null,null==t||t.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return Go.error("#toMap()","Not implemented on this instance of View"),null}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){return!!(!this.fatalError&&this._isValid&&!this._readyCycleForced&&this.map&&(!St.isLoadable(this.map)||this.map.loaded)&&0!==this.width&&0!==this.height&&this.spatialReference&&this.isSpatialReferenceSupported(this.spatialReference)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone)}set map(t){var e;t!==this._get("map")&&(null!=(e=t)&&e.destroyed&&(Go.warn("#map","The provided map is already destroyed",{map:t}),t=null),St.isLoadable(t)&&t.load().catch((()=>{})),this.initialized&&(this.forceReadyCycle(),this._resetInitialViewPropertiesFromContent()),this._set("map",t))}get spatialReference(){let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&this.isHeightModelInfoRequired&&this.defaultsFromMap&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){this._userSpatialReference=t,this._set("spatialReference",t)}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){return this.defaultsFromMap&&this.defaultsFromMap.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return y(t)?t:this._cursor||"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){return this.layerViewManager.whenLayerView(t)}getDefaultSpatialReference(){return this.get("defaultsFromMap.spatialReference")}getDefaultHeightModelInfo(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null}importLayerView(t){throw new n("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}isSpatialReferenceSupported(t,e,i){return!0}isTileInfoRequired(){return!1}when(t,e){return this.isResolved()&&!this.ready&&Go.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.'),super.when(t,e)}forceReadyCycle(){this.ready&&(this._readyCycleForced=!0,vt(this,"preconditionsReady",(()=>this._readyCycleForced=!1)))}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}_resetInitialViewPropertiesFromContent(){if(!this.defaultsFromMap)return;const t=()=>this.defaultsFromMap&&this.defaultsFromMap.start();this.defaultsFromMap.reset(),this._currentSpatialReference=null,this.notifyChange("spatialReference"),this.handles.remove("defaultsFromMap"),this.handles.add([G(this,"spatialReference",((e,i)=>{ne(e,i)||t()})),G(this,"initialExtentRequired",t),ot(t)],"defaultsFromMap")}};Ho.views=new s,t([F("toolViewManager.activeTool")],Ho.prototype,"activeTool",void 0),t([l({readOnly:!0})],Ho.prototype,"allLayerViews",void 0),t([l()],Ho.prototype,"groundView",void 0),t([l()],Ho.prototype,"animation",void 0),t([l()],Ho.prototype,"basemapView",void 0),t([l()],Ho.prototype,"defaultsFromMap",void 0),t([l()],Ho.prototype,"fatalError",void 0),t([l({type:re})],Ho.prototype,"extent",void 0),t([l(ei(ti,"graphics"))],Ho.prototype,"graphics",void 0),t([l({readOnly:!0,type:ii,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"]})],Ho.prototype,"heightModelInfo",null),t([l({readOnly:!0})],Ho.prototype,"interacting",null),t([l({readOnly:!0})],Ho.prototype,"navigating",void 0),t([l({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","initialExtentRequired","initialExtent","defaultsFromMap.isSpatialReferenceDone","defaultsFromMap.isTileInfoDone"]})],Ho.prototype,"preconditionsReady",null),t([l({type:s,readOnly:!0})],Ho.prototype,"layerViews",void 0),t([l({type:to})],Ho.prototype,"magnifier",void 0),t([l({value:null,type:rs})],Ho.prototype,"map",null),t([l()],Ho.prototype,"padding",void 0),t([l({readOnly:!0})],Ho.prototype,"ready",void 0),t([l({type:oe})],Ho.prototype,"spatialReference",null),t([l()],Ho.prototype,"spatialReferenceWarningDelay",void 0),t([l()],Ho.prototype,"stationary",null),t([l({readOnly:!0})],Ho.prototype,"supportsGround",void 0),t([l({type:Xe})],Ho.prototype,"timeExtent",void 0),t([F("toolViewManager.tools")],Ho.prototype,"tools",void 0),t([l()],Ho.prototype,"toolViewManager",void 0),t([l({readOnly:!0})],Ho.prototype,"type",void 0),t([l({type:Number})],Ho.prototype,"scale",void 0),t([l({readOnly:!0})],Ho.prototype,"updating",void 0),t([l({readOnly:!0})],Ho.prototype,"initialExtentRequired",void 0),t([l({readOnly:!0,type:re})],Ho.prototype,"initialExtent",null),t([l()],Ho.prototype,"cursor",null),t([l({readOnly:!0})],Ho.prototype,"input",void 0),t([l({type:Vo,nonNullable:!0})],Ho.prototype,"navigation",void 0),t([l()],Ho.prototype,"layerViewManager",void 0),t([l()],Ho.prototype,"width",void 0),t([l()],Ho.prototype,"height",void 0),t([l({readOnly:!0})],Ho.prototype,"resizing",void 0),t([l({value:null,readOnly:!0})],Ho.prototype,"size",null),t([l({readOnly:!0})],Ho.prototype,"suspended",void 0),t([l({readOnly:!0})],Ho.prototype,"viewEvents",void 0),t([l({readOnly:!0})],Ho.prototype,"persistableViewModels",void 0),t([l()],Ho.prototype,"_isValid",void 0),t([l()],Ho.prototype,"_readyCycleForced",void 0),t([l()],Ho.prototype,"_currentSpatialReference",void 0),Ho=Bo=t([e("esri.views.View")],Ho);const Wo=Ho;let Zo=class extends gt{constructor(t){super(t),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise(((t,e)=>this._dfd={resolve:t,reject:e})))}get done(){return"finished"===this.state||"stopped"===this.state}stop(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),this._dfd.reject(new n("ViewAnimation stopped")))}finish(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),this._dfd.resolve())}update(t,e){e||(e=wt(t)?"waiting-for-target":"running"),this._set("target",t),this._set("state",e)}};t([l({readOnly:!0})],Zo.prototype,"done",null),t([l({readOnly:!0,type:String})],Zo.prototype,"state",void 0),t([l()],Zo.prototype,"target",void 0),Zo=t([e("esri.views.ViewAnimation")],Zo),(Zo||(Zo={})).State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"};const Ko=Zo;function Jo(){return[1,0,0,1,0,0]}Object.freeze({__proto__:null,create:Jo,clone:function(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]},fromValues:function(t,e,i,s,n,r){return[t,e,i,s,n,r]},createView:function(t,e){return new Float64Array(t,e,6)}});const Yo=180/Math.PI;function Qo(t,e,i,s){return s&&i&&!s.equals(i)&&ie(s,i)&&s.isWebMercator?s.isWebMercator?function(t,e){let i=e[1];return i>89.99999?i=89.99999:i<-89.99999&&(i=-89.99999),i=Math.sin(le(i)),vi(t,le(e[0])*ae.radius,.5*ae.radius*Math.log((1+i)/(1-i)))}(t,e):function(t,e){const i=he(e[0]/ae.radius);return vi(t,i-360*Math.floor((i+180)/360),he(.5*Math.PI-2*Math.atan(Math.exp(-e[1]/ae.radius))))}(t,e):gi(t,e)}function Xo(t){return t.wkid?t:t.spatialReference||oe.WGS84}function ta(t,e){return e.type?vi(t,e.x,e.y):gi(t,e)}function ea(t){return ce(t)}function ia(t,e){return Math.max(t.width/e[0],t.height/e[1])*function(t){return ue(t)?39.37*ea(t)*96:1}(t.spatialReference)}async function sa(t,e,i,n){let r,o;if(!t)return null;if(Array.isArray(t)&&!t.length)return null;if(s.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&"object"==typeof t[0]){const s=t.every((t=>"attributes"in t)),r=t.some((t=>!t.geometry));let o=t;if(s&&r&&e&&e.allLayerViews){const i=new Map;for(const e of t){const t=e.layer,s=i.get(t)||[],n=e.attributes[t.objectIdField];null!=n&&s.push(n),i.set(t,s)}const s=[];i.forEach(((t,i)=>{const n=e.allLayerViews.find((t=>t.layer.id===i.id));if("queryFeatures"in n){const e=i.createQuery();e.objectIds=t,e.returnGeometry=!0,s.push(n.queryFeatures(e))}}));const n=await Promise.all(s),r=[];for(const t of n)if(t&&t.features&&t.features.length)for(const e of t.features)y(e.geometry)&&r.push(e.geometry);o=r}for(const t of o)n=await sa(t,e,i,n);return n}if(Array.isArray(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1])r=new Rt(t);else if(t instanceof de)r=t;else if("geometry"in t)if(t.geometry)r=t.geometry;else if(t.layer){const i=t.layer,s=e.allLayerViews.find((t=>t.layer.id===i.id));if("queryFeatures"in s){const e=i.createQuery();e.objectIds=[t.attributes[i.objectIdField]],e.returnGeometry=!0;const n=await s.queryFeatures(e);r=yt(n,"features",0,"geometry")}}if(v(r))return null;if(o="point"===r.type?new re({xmin:r.x,ymin:r.y,xmax:r.x,ymax:r.y,spatialReference:r.spatialReference}):r.extent,!o)return null;const a=se(o,i);return v(a)?null:n=n?n.union(a):a}function na(t,e){const i=t.targetGeometry,s=e.targetGeometry;return i.x=s.x,i.y=s.y,i.spatialReference=s.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function ra(t,e,i){return i?vi(t,.5*(e[0]-i.right+i.left),.5*(e[1]-i.bottom+i.top)):bi(t,e,.5)}const oa=function(){const t=Ti();return function(e,i,s){const n=i.targetGeometry;ta(t,n);const r=.5*ha(i);return e.xmin=t[0]-r*s[0],e.ymin=t[1]-r*s[1],e.xmax=t[0]+r*s[0],e.ymax=t[1]+r*s[1],e.spatialReference=n.spatialReference,e}}(),aa=function(){const t=Ti();return function(e,i,s){return yi(e,function(t,e){return bi(t,e,.5)}(e,i),ra(t,i,s))}}(),la=function(){const t=[1,0,0,1,0,0],e=Ti();return function(i,s,n,r){const o=ha(s),a=ua(s);return vi(e,o,o),pi(t,e),di(t,t,a),ci(t,t,aa(e,n,r)),ci(t,t,[0,r.top-r.bottom]),vi(i,t[4],t[5])}}();function ha(t){return t.scale*function(t){return y(t)&&ue(t.spatialReference)?1/(39.37*ea(t.spatialReference)*96):1}(t.targetGeometry)}function ua(t){return le(t.rotation)||0}const ca=function(){const t=Ti(),e=Ti(),i=Ti();return function(s,n,r,o,a,l){return _i(t,n),bi(e,r,.5*l),vi(i,1/o*l,-1/o*l),ui(s),ci(s,s,e),a&&di(s,s,a),hi(s,s,i),ci(s,s,t),s}}(),da=function(){const t=Ti();return function(e,i,s,n){const r=ha(i),o=ua(i);return ta(t,i.targetGeometry),ca(e,t,s,r,o,n)}}(),pa=function(){const t=Ti();return function(e,i,s,n){const r=ha(i);return ta(t,i.targetGeometry),ca(e,t,s,r,0,n)}}();function fa(t){if(t.isWrappable){const e=pe(t);return e.valid[1]-e.valid[0]}return 0}const ma=function(){const t=Ti(),e=Ti(),i=[0,0,0];return function(s,n,r){xi(t,s,n),Ii(t,t),xi(e,s,r),Ii(e,e),ki(i,t,e);let o=Math.acos(Ai(t,e)/(Ci(t)*Ci(e)))*Yo;return i[2]<0&&(o=-o),isNaN(o)&&(o=0),o}}(),va=function(){const t=Ti();return function(e,i,s,n){const r=e.targetGeometry;return na(e,i),la(t,i,s,n),r.x+=t[0],r.y+=t[1],e}}(),ga=function(){const t=Ti();return function(e,i,s){na(e,i);const n=e.targetGeometry,r=Xo(s),o=Xo(n);return ta(t,s),Qo(t,t,r,o),n.x=t[0],n.y=t[1],e}}(),wa=function(){const t=Ti();return function(e,i,s,n,r){r||(r="center"),yi(t,s,n),bi(t,t,.5);const o=t[0],a=t[1];switch(r){case"center":vi(t,0,0);break;case"left":vi(t,-o,0);break;case"top":vi(t,0,a);break;case"right":vi(t,o,0);break;case"bottom":vi(t,0,-a);break;case"top-left":vi(t,-o,a);break;case"bottom-left":vi(t,-o,-a);break;case"top-right":vi(t,o,a);break;case"bottom-right":vi(t,o,-a)}return Aa(e,i,t),e}}();function ya(t,e,i){return na(t,e),t.rotation+=i,t}const ba=function(){const t=Ti();return function(e,i,s,n,r){return na(e,i),isNaN(s)||0===s||(Ia(t,n,i,r),e.scale=i.scale*s,ka(t,t,e,r),Aa(e,e,vi(t,t[0]-n[0],n[1]-t[1]))),e}}();function _a(t,e,i){return na(t,e),t.scale=i,t}const Ma=function(){const t=Ti();return function(e,i,s,n,r,o){return na(e,i),isNaN(s)||0===s||(Ia(t,r,i,o),e.scale=i.scale*s,e.rotation+=n,ka(t,t,e,o),Aa(e,e,vi(t,t[0]-r[0],r[1]-t[1]))),e}}(),xa=function(){const t=Ti(),e=Ti();return function(i,s,n,r,o,a,l){return aa(e,a,l),Mi(t,o,e),r?Ma(i,s,n,r,t,a):ba(i,s,n,t,a)}}(),Ia=function(){const t=[1,0,0,1,0,0];return function(e,i,s,n){return wi(e,i,function(t,e,i){return da(t,e,i,1),fi(t,t)}(t,s,n))}}(),ka=function(){const t=[1,0,0,1,0,0];return function(e,i,s,n){return wi(e,i,da(t,s,n,1))}}(),Aa=function(){const t=Ti(),e=[1,0,0,1,0,0];return function(i,s,n){na(i,s);const r=ha(s),o=i.targetGeometry;return li(e,ua(s)),hi(e,e,Fi(r,r)),wi(t,n,e),o.x+=t[0],o.y+=t[1],i}}();class Ca{constructor(t,e,i,s){const n=t.targetGeometry,r=e.targetGeometry;s?"string"==typeof s&&(s=ai(s)||oi.ease):s=oi.ease,this.easing=s,this.duration=i,this.sCenterX=n.x,this.sCenterY=n.y,this.sScale=t.scale,this.sRotation=t.rotation,this.tCenterX=r.x,this.tCenterY=r.y,this.tScale=e.scale,this.tRotation=e.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}applyRatio(t,e){const i=this.easing(e);let s,n,r,o;e>=1?(s=this.tCenterX,n=this.tCenterY,r=this.tRotation,o=this.tScale):(s=this.sCenterX+i*this.dCenterX,n=this.sCenterY+i*this.dCenterY,r=this.sRotation+i*this.dRotation,o=this.sScale+i*this.dScale),t.targetGeometry.x=s,t.targetGeometry.y=n,t.scale=o,t.rotation=r}}let Oa=class extends m{constructor(t){super(t),this.duration=200,this.transition=null,this.easing=oi.ease,this.view=null,this.viewpoint=null,this.viewpoint=new ds({targetGeometry:new Rt,scale:0,rotation:0}),this._updateTask=et({postRender:this._postRender.bind(this)}),this._updateTask.pause()}destroy(){this._updateTask.remove(),this._updateTask=null}animate(t,e,i){this.stop(),na(this.viewpoint,e),this.transition=new Ca(this.viewpoint,t.target,i&&i.duration||this.duration,i&&i.easing||this.easing);const s=()=>{this.animation===t&&this._updateTask&&("finished"===t.state&&(this.transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return t.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=t,t}animateContinous(t,e){this.stop(),this.updateFunction=e,this.viewpoint=t;const i=new Ko({target:t.clone()}),s=()=>{this.animation===i&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return i.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=i,i}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(t){const e=this.animation;if(e&&e.state!==Ko.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,t.deltaTime);else{const t=(performance.now()-this._startTime)/this.transition.duration,e=t>=1;this.transition.applyRatio(this.viewpoint,t),e&&this.animation.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};t([l()],Oa.prototype,"animation",void 0),t([l()],Oa.prototype,"duration",void 0),t([l()],Oa.prototype,"transition",void 0),t([l()],Oa.prototype,"easing",void 0),t([l()],Oa.prototype,"view",void 0),t([l()],Oa.prototype,"viewpoint",void 0),Oa=t([e("esri.views.2d.AnimationManager")],Oa);const Ta=Oa;class Fa{constructor(t){this.view=t,this._frameTaskHandle=null,this._updateRequested=!1,this.stationary=!0,this.updateEnabled=!0,this.animationInProgress=!1,this.prepare=()=>{this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions},this.update=()=>{if(this._updateRequested=!1,!this.updateEnabled)return;const{basemapView:t,graphicsView:e,labelManager:i,layerViews:s,state:{id:n}}=this.view;t.baseLayerViews.forEach(this._updateLayerView,this),s.forEach(this._updateLayerView,this),t.referenceLayerViews.forEach(this._updateLayerView,this),y(i)&&(i.lastUpdateId!==n&&(i.viewChange(),i.lastUpdateId=n),i.updateRequested&&i.processUpdate(this._updateParameters)),y(e)&&(e.lastUpdateId!==n&&(e.viewChange(),e.lastUpdateId=n),e.updateRequested&&e.processUpdate(this._updateParameters)),this.view.graphicsTileStore.setViewState(this._updateParameters.state),this.animationInProgress||this._updateRequested||this._frameTaskHandle.pause()}}destroy(){this.stop()}start(){this.stationary=this.view.stationary,this._updateParameters={state:this.view.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:this.view.renderingOptions},this._stationaryHandle=this.view.watch("stationary",(t=>{this.stationary=t,this.requestFrame()})),this._frameTaskHandle=et(this)}stop(){this._frameTaskHandle&&(this._stationaryHandle.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(t){const e=this.view.state,i=t.lastUpdateId;null!=i&&(this.stationary||t.moving)||(t.moving=!0,t.moveStart()),i!==e.id&&t.viewChange(),this.stationary&&t.moving&&(t.moving=!1,t.moveEnd()),t.lastUpdateId=e.id,t.updateRequested&&t.processUpdate(this._updateParameters),"layerViews"in t&&t.layerViews.forEach(this._updateLayerView,this)}}function Pa(){return Promise.all([import("./p-3392c85e.js"),import("./p-339711c7.js")])}const Ea=()=>Pa().then((()=>import("./p-9deec170.js"))),Va=()=>Pa().then((()=>import("./p-5c2ecfaf.js"))),Sa={"base-dynamic":()=>Pa().then((()=>import("./p-a165a3e0.js"))),"base-tile":Ea,"bing-maps":Ea,csv:Va,"geo-rss":()=>Pa().then((()=>import("./p-ee524776.js"))),feature:Va,geojson:Va,graphics:()=>Pa().then((()=>import("./p-a8a34bf5.js"))),group:()=>Pa().then((()=>import("./p-29142309.js"))),imagery:()=>Pa().then((()=>import("./p-9f3c817d.js"))),"imagery-tile":()=>Pa().then((()=>import("./p-7f6e061c.js"))),kml:()=>Pa().then((()=>import("./p-975957f8.js"))),"map-image":()=>Pa().then((()=>import("./p-1979aff6.js"))),"map-notes":()=>Pa().then((()=>import("./p-2bd78fd7.js"))),"ogc-feature":()=>Pa().then((()=>import("./p-f4689437.js"))),"open-street-map":Ea,route:()=>Pa().then((()=>import("./p-0f6703b4.js"))),stream:()=>Pa().then((()=>import("./p-43fc4003.js"))),"subtype-group":()=>Pa().then((()=>import("./p-7db89fdf.js"))),tile:Ea,"vector-tile":()=>Pa().then((()=>import("./p-c2055936.js"))),wcs:()=>Pa().then((()=>import("./p-7f6e061c.js"))),"web-tile":Ea,wfs:Va,wms:()=>Pa().then((()=>import("./p-ba5df29b.js"))),wmts:()=>Pa().then((()=>import("./p-d5e87ad1.js"))),analysis:null,"base-elevation":null,"building-scene":null,elevation:null,"integrated-mesh":null,"point-cloud":null,voxel:null,scene:null,unknown:null,unsupported:null};var Ra;const Na=i.getLogger("esri.views.MapView");let La=Ra=class extends m{constructor(t){super(t),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){return v(this.geometry)||!this.spatialReference?null:this.spatialReference.equals(this.geometry.spatialReference)?this.geometry:ie(this.geometry,this.spatialReference)?se(this.geometry,this.spatialReference):Pi()?Ei(this.geometry,this.spatialReference):(Na.error("#constraints.geometry","unsupported coordinate system. The source geometry cannot be projected to the view's coordinate system. The projection engine cannot be loaded.",{geometry:this.geometry}),null)}constrain(t,e){if(v(this.normalizedGeometry))return t;const i=t.targetGeometry;if("extent"===this.normalizedGeometry.type?me(this.normalizedGeometry,i):ve(this.normalizedGeometry,i))return t;const{coordinate:s}=function(t,e){const{spatialReference:i}=e,s=[e.x,e.y];let n=Number.POSITIVE_INFINITY,r=0,o=0;const a=[0,0],l="extent"===t.type?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:t.rings;for(const t of l)for(let e=0;e<t.length-1;e++){fe(a,s,t,e);const i=Oi(s,a);i<n&&(n=i,r=a[0],o=a[1])}return{coordinate:new Rt({x:r,y:o,spatialReference:i}),distance:n}}(this.normalizedGeometry,i);return s?(t.targetGeometry=s,t):t}clone(){var t,e;return new Ra({geometry:null==(t=this.geometry)?void 0:t.clone(),spatialReference:null==(e=this.spatialReference)?void 0:e.clone()})}};var za;t([l({constructOnly:!0})],La.prototype,"geometry",void 0),t([l({readOnly:!0})],La.prototype,"normalizedGeometry",null),t([l({constructOnly:!0})],La.prototype,"spatialReference",void 0),La=Ra=t([e("esri.views.2d.constraints.GeometryConstraint")],La);let $a=za=class extends m{constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(t,e){return this.enabled&&e?(this.rotationEnabled||(t.rotation=e.rotation),t):t}clone(){return new za({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};t([l()],$a.prototype,"enabled",void 0),t([l()],$a.prototype,"rotationEnabled",void 0),$a=za=t([e("esri.views.2d.constraints.RotationConstraint")],$a);const ja=$a;var Da;let Ua=Da=class extends m{constructor(t){super(t),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let t,{lods:e,minScale:i,maxScale:s,minZoom:n,maxZoom:r}=this,o=-1,a=-1,l=!1,h=!1;if(0!==i&&0!==s&&i<s&&([i,s]=[s,i]),!e||!e.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",s);e=e.map((t=>t.clone())),e.sort(((t,e)=>e.scale-t.scale)),e.forEach(((t,e)=>t.level=e));for(const n of e)!l&&i>0&&i>=n.scale&&(o=n.level,l=!0),!h&&s>0&&s>=n.scale&&(a=t?t.level:-1,h=!0),t=n;-1===n&&(n=0===i?0:o),-1===r&&(r=0===s?e.length-1:a),n=Math.max(n,0),n=Math.min(n,e.length-1),r=Math.max(r,0),r=Math.min(r,e.length-1),n>r&&([n,r]=[r,n]),i=e[n].scale,s=e[r].scale,e.splice(0,n),e.splice(r-n+1,e.length),e.forEach(((t,e)=>{this._lodByScale[t.scale]=t,this._scales[e]=t.scale})),this._set("effectiveLODs",e),this._set("effectiveMinZoom",n),this._set("effectiveMaxZoom",r),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",s)}constrain(t,e){if(e&&t.scale===e.scale)return t;const i=this.effectiveMinScale,s=this.effectiveMaxScale,n=t.targetGeometry,r=e&&e.targetGeometry,o=0!==i&&t.scale>i;if(0!==s&&t.scale<s||o){const a=o?i:s;if(r){const i=(a-e.scale)/(t.scale-e.scale);n.x=r.x+(n.x-r.x)*i,n.y=r.y+(n.y-r.y)*i}t.scale=a}return this.snapToZoom&&this.effectiveLODs&&(t.scale=this._getClosestScale(t.scale)),t}fit(t){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(t,null);const e=this.scaleToZoom(t.scale),i=Math.abs(e-Math.floor(e));return t.scale=this.zoomToScale(i>.99?Math.round(e):Math.floor(e)),t}zoomToScale(t){if(!this.effectiveLODs)return 0;t-=this.effectiveMinZoom,t=Math.max(0,t);const e=this._scales;if(t<=0)return e[0];if(t>=e.length)return e[e.length-1];const i=Math.round(t-.5),s=Math.round(t);return e[s]+(s-t)*(e[i]-e[s])}scaleToZoom(t){if(!this.effectiveLODs)return-1;const e=this._scales;let i,s;if(t>=e[0])return this.effectiveMinZoom;if(t<=e[e.length-1])return this.effectiveMaxZoom;for(let n=0;n<e.length-1;n++){if(i=e[n],s=e[n+1],s===t)return n+this.effectiveMinZoom+1;if(i>t&&s<t)return n+this.effectiveMinZoom+1-(t-s)/(i-s)}}snapToClosestScale(t){if(!this.effectiveLODs)return t;const e=this.scaleToZoom(t);return this.zoomToScale(Math.round(e))}snapToNextScale(t,e=.5){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i+1)}snapToPreviousScale(t,e=2){if(!this.effectiveLODs)return t*e;const i=Math.round(this.scaleToZoom(t));return this.zoomToScale(i-1)}clone(){return new Da({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(t){return this._lodByScale[t]||(t=this._scales.reduce(((e,i)=>Math.abs(i-t)<=Math.abs(e-t)?i:e),this._scales[0])),this._lodByScale[t].scale}};t([l({readOnly:!0})],Ua.prototype,"effectiveLODs",void 0),t([l({readOnly:!0})],Ua.prototype,"effectiveMinZoom",void 0),t([l({readOnly:!0})],Ua.prototype,"effectiveMaxZoom",void 0),t([l({readOnly:!0})],Ua.prototype,"effectiveMinScale",void 0),t([l({readOnly:!0})],Ua.prototype,"effectiveMaxScale",void 0),t([l({type:[Ge]})],Ua.prototype,"lods",void 0),t([l()],Ua.prototype,"minZoom",void 0),t([l()],Ua.prototype,"maxZoom",void 0),t([l()],Ua.prototype,"minScale",void 0),t([l()],Ua.prototype,"maxScale",void 0),t([l()],Ua.prototype,"snapToZoom",void 0),Ua=Da=t([e("esri.views.2d.constraints.ZoomConstraint")],Ua);const qa=Ua,Ba={base:null,key:"type",typeMap:{extent:re,polygon:ge}};let Ga=class extends f.EventedAccessor{constructor(){super(...arguments),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0}initialize(){this.watch(["_zoom","_rotation"],this.emit.bind(this,"update"),!0)}destroy(){this.view=null,this._set("_zoom",null),this._set("_rotation",null)}set geometry(t){this._set("geometry",t||null)}get _defaultLODs(){const t=this.get("view.defaultsFromMap.tileInfo"),e=this.get("view.spatialReference");return t&&e&&t.spatialReference.equals(e)?t.lods:null}get _geometry(){return new La({geometry:this.geometry,spatialReference:this.view.spatialReference})}get _rotation(){return new ja({rotationEnabled:this.rotationEnabled})}get _zoom(){return new qa({lods:this.lods||this._defaultLODs,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale,snapToZoom:this.snapToZoom})}canZoomInTo(t){const e=this.effectiveMaxScale;return 0===e||t>=e}canZoomOutTo(t){const e=this.effectiveMinScale;return 0===e||t<=e}constrain(t,e){return this._zoom.constrain(t,e),this._rotation.constrain(t,e),this._geometry.constrain(t,e),t}constrainByGeometry(t){return this._geometry.constrain(t)}fit(t){return this._zoom.fit(t)}zoomToScale(t){return this._zoom.zoomToScale(t)}scaleToZoom(t){return this._zoom.scaleToZoom(t)}snapScale(t){return this._zoom.snapToClosestScale(t)}snapToNextScale(t){return this._zoom.snapToNextScale(t)}snapToPreviousScale(t){return this._zoom.snapToPreviousScale(t)}};t([l({readOnly:!0,aliasOf:"_zoom.effectiveLODs"})],Ga.prototype,"effectiveLODs",void 0),t([l({readOnly:!0,aliasOf:"_zoom.effectiveMinScale"})],Ga.prototype,"effectiveMinScale",void 0),t([l({readOnly:!0,aliasOf:"_zoom.effectiveMaxScale"})],Ga.prototype,"effectiveMaxScale",void 0),t([l({readOnly:!0,aliasOf:"_zoom.effectiveMinZoom"})],Ga.prototype,"effectiveMinZoom",void 0),t([l({readOnly:!0,aliasOf:"_zoom.effectiveMaxZoom"})],Ga.prototype,"effectiveMaxZoom",void 0),t([l({types:Ba,value:null})],Ga.prototype,"geometry",null),t([l({type:[Ge]})],Ga.prototype,"lods",void 0),t([l()],Ga.prototype,"minScale",void 0),t([l()],Ga.prototype,"maxScale",void 0),t([l()],Ga.prototype,"minZoom",void 0),t([l()],Ga.prototype,"maxZoom",void 0),t([l()],Ga.prototype,"rotationEnabled",void 0),t([l()],Ga.prototype,"snapToZoom",void 0),t([l()],Ga.prototype,"view",void 0),t([l()],Ga.prototype,"_defaultLODs",null),t([l({type:La})],Ga.prototype,"_geometry",null),t([l({type:ja})],Ga.prototype,"_rotation",null),t([l({readOnly:!0,type:qa})],Ga.prototype,"_zoom",null),Ga=t([e("esri.views.2d.MapViewConstraints")],Ga);const Ha=Ga;function Wa(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function Za(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Ka(t){return function(t){return t instanceof Float32Array&&t.length>=2}(t)||function(t){return Array.isArray(t)&&t.length>=2}(t)}var Ja;Object.freeze({__proto__:null,create:Wa,clone:Za,fromValues:function(t,e,i,s,n,r,o,a,l){const h=new Float32Array(9);return h[0]=t,h[1]=e,h[2]=i,h[3]=s,h[4]=n,h[5]=r,h[6]=o,h[7]=a,h[8]=l,h},createView:function(t,e){return new Float32Array(t,e,9)}});const Ya=[0,0];let Qa=Ja=class extends Ue{constructor(t){super(t),this._viewpoint2D={center:Ti(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new re,this.id=0,this.inverseTransform=[1,0,0,1,0,0],this.resolution=0,this.rotation=0,this.scale=0,this.transform=[1,0,0,1,0,0],this.transformNoRotation=[1,0,0,1,0,0],this.displayMat3=Wa(),this.displayViewMat3=Wa(),this.viewMat3=Wa(),this.viewMat2d=mi(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,i=t.targetGeometry;e.center[0]=i.x,e.center[1]=i.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=i.spatialReference}this._update()}copy(t){const e=this.size,i=this.viewpoint;return i&&e?(this.viewpoint=na(i,t.viewpoint),this._set("size",gi(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new Ja({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,i){return Ka(e)?wi(t,e,this.inverseTransform):(Ya[0]=e,Ya[1]=i,wi(t,Ya,this.inverseTransform))}toScreen(t,e,i){return Ka(e)?wi(t,e,this.transform):(Ya[0]=e,Ya[1]=i,wi(t,Ya,this.transform))}toScreenNoRotation(t,e,i){return Ka(e)?wi(t,e,this.transformNoRotation):(Ya[0]=e,Ya[1]=i,wi(t,Ya,this.transformNoRotation))}getScreenTransform(t,e){const{center:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size");return ca(t,i,n,e,0,s),t}_update(){const{center:t,spatialReference:e,scale:i,rotation:s}=this._viewpoint2D,n=this._get("pixelRatio")||1,r=this._get("size"),o=new ds({targetGeometry:new Rt(t[0],t[1],e),scale:i,rotation:s});if(this._set("viewpoint",o),!r||!e||!i)return;this.resolution=ha(o),this.rotation=s,this.scale=i,this.spatialReference=e,gi(this.center,t),Vi(this.displayMat3,0!==r[0]?2/r[0]:0,0,0,0,0!==r[1]?-2/r[1]:0,0,-1,1,1);const a=Si(this.viewMat3),l=zi(r[0]/2,r[1]/2),h=zi(-r[0]/2,-r[1]/2),u=le(s);Ri(a,a,l),Ni(a,a,u),Ri(a,a,h),Li(this.displayViewMat3,this.displayMat3,a);const c=ui(this.viewMat2d);return ci(c,c,l),di(c,c,u),ci(c,c,h),oa(this.extent,o,r),da(this.transform,o,r,n),fi(this.inverseTransform,this.transform),pa(this.transformNoRotation,o,r,n),this.worldScreenWidth=function(t,e){return Math.round(fa(t)/e)}(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};t([l({readOnly:!0})],Qa.prototype,"id",void 0),t([l({value:1,json:{write:!0}})],Qa.prototype,"pixelRatio",null),t([l({json:{write:!0}})],Qa.prototype,"size",null),t([l({type:ds,json:{write:!0}})],Qa.prototype,"viewpoint",null),Qa=Ja=t([e("esri.views.2d.ViewState")],Qa);const Xa=Qa;let tl=class extends m{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}};t([l()],tl.prototype,"left",void 0),t([l()],tl.prototype,"top",void 0),t([l()],tl.prototype,"right",void 0),t([l()],tl.prototype,"bottom",void 0),tl=t([e("esri.views.2d.PaddedViewState.Padding")],tl);let el=class extends Xa{constructor(...t){super(...t),this.paddedViewState=new Xa,this._updateContent=(()=>{const t=Ti();return()=>{const e=this._get("size"),i=this._get("padding");if(!e||!i)return;const s=this.paddedViewState;vi(t,i.left+i.right,i.top+i.bottom),xi(t,e,t),gi(s.size,t);const n=s.viewpoint;n&&(this.viewpoint=n)}})(),this.watch(["size","padding"],this._updateContent,!0),this.padding=new tl,this.size=[0,0]}set padding(t){this._set("padding",t||new tl)}set viewpoint(t){if(t){const e=t.clone();this.paddedViewState.viewpoint=t,va(e,t,this._get("size"),this._get("padding"));const i=this._viewpoint2D,s=e.targetGeometry;i.center[0]=s.x,i.center[1]=s.y,i.rotation=e.rotation,i.scale=e.scale,i.spatialReference=s.spatialReference,this._update()}}};t([l()],el.prototype,"paddedViewState",void 0),t([l({type:tl})],el.prototype,"padding",null),t([l()],el.prototype,"viewpoint",null),el=t([e("esri.views.2d.PaddedViewState")],el);const il=el;class sl{constructor(){this._names=new Map}begin(t){this._names.has(t)||(this._names.set(t,!1),(t=>-1!==t.indexOf("Brush"))(t)&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${t}.Start`))}end(t){this._names.has(t)&&!this._names.get(t)&&(this._names.set(t,!0),performance.mark(`Esri.${t}.End`))}record(t){this._names.has(t)||(this._names.set(t,!0),performance.mark(`Esri.${t}`))}}const nl=i.getLogger("esri.views.MapView");let rl=class extends(Wr(Wo)){constructor(t){super(t),this._stationaryTimer=null,this.frameTask=new Fa(this),this.featuresTilingScheme=null,this.fullOpacity=1,this.graphicsView=null,this.initialExtent=null,this.labelManager=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.resizeAlign="center",this.supportsGround=!1,this.timeline=new sl,this.type="2d",this.constraints=new Ha,this.padding={top:0,right:0,bottom:0,left:0};const e=this.handles,i=()=>this.notifyChange("updating");e.add([this.watch("viewpoint",(()=>{this._lastStationaryEventTimestamp=performance.now(),this._flipStationary(160)}),!0),this.on("resize",(t=>this._resizeHandler(t))),this.watch("animationManager.animation",(t=>{this.animation=t})),this.allLayerViews.on("change",(()=>{i(),e.remove("map-view-base-layerViewsUpdating"),e.add(this.allLayerViews.map((t=>t.watch("updating",i))),"map-view-base-layerViewsUpdating")}))],"map-view-base")}destroy(){this.destroyed||(this._set("preconditionsReady",!1),this._gotoTask=this.frameTask=null)}set animation(t){const e=this._get("animation");if(t===e)return;if(e&&e.stop(),!t||t.isFulfilled())return void this._set("animation",null);this._set("animation",t),this.frameTask.animationInProgress=!0;const i=()=>{t===this._get("animation")&&(this._set("animation",null),this.frameTask.requestFrame()),this.frameTask.animationInProgress=!1};t.when(i,i)}get center(){if(!this.ready)return this._get("center");const{center:t,spatialReference:e}=this.state.paddedViewState;return new Rt({x:t[0],y:t[1],spatialReference:e})}set center(t){if(null==t)return;if(!this._normalizeInput(t))return void nl.error("#center",`incompatible spatialReference ${JSON.stringify(t.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`);if(!this.ready)return this._set("center",t),void this.notifyChange("initialExtentRequired");const e=this.viewpoint;ga(e,e,t),this.viewpoint=e}set constraints(t){const e=this._get("constraints");e&&(this.handles.remove("map-view-base-constraints"),e.destroy()),this._set("constraints",t),t&&(t.view=this,this.ready&&(this.state.viewpoint=t.fit(this.state.paddedViewState.viewpoint)),this.handles.add(t.on("update",(()=>{this.ready&&this.state&&(this.state.viewpoint=t.fit(this.state.paddedViewState.viewpoint))})),"map-view-base-constraints"))}get extent(){return this.ready?this.state.paddedViewState.extent.clone():this._get("extent")}set extent(t){if(null==t)return;const e=this._normalizeInput(t);if(!e)return void nl.error("#center",`incompatible spatialReference ${JSON.stringify(t.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`);if(!e.width||!e.height)return void nl.error("#extent","invalid extent size");if(!this.ready)return this._set("extent",e),this._set("center",null),this._set("viewpoint",null),this._set("scale",0),this._set("zoom",-1),void this.notifyChange("initialExtentRequired");const i=this.viewpoint;(function(t,e,i,s,n){ga(t,e,i.center),t.scale=ia(i,s),n&&n.constraints&&n.constraints.constrain(t)})(i,i,e,this.size,{constraints:this.constraints}),this.viewpoint=i}get graphicsTileStore(){return new Le(this.featuresTilingScheme)}get initialExtentRequired(){const{extent:t,center:e,scale:i,viewpoint:s,zoom:n}=this;return!(this.get("map.initialViewProperties.viewpoint")||t||e&&(0!==i||-1!==n)||s)}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(t){this.ready?(this.state.padding=t,this._set("padding",this.state.padding)):this._set("padding",t)}get resolution(){return this.state?this.state.resolution:0}get rotation(){return this.ready?this.state.rotation:this._get("rotation")}set rotation(t){if(isNaN(t))return;if(!this.ready)return void this._set("rotation",t);const e=this.viewpoint;(function(t,e,i){na(t,e),t.rotation=i})(e,e,t),this.viewpoint=e}get scale(){return this.ready?this.state.scale:this._get("scale")}set scale(t){if(!t||isNaN(t))return;if(!this.ready){this._set("scale",t),this._set("zoom",-1);const e=this._get("extent");return e&&(this._set("extent",null),this._set("center",e.center)),void this.notifyChange("initialExtentRequired")}const e=this.viewpoint;_a(e,e,t),this.viewpoint=e}get stationary(){return!(this.animation||this.navigating||this._get("resizing")||this._stationaryTimer)}get updating(){return!this.destroyed&&(!0===this.get("layerViewManager.updating")||!0===this.get("labelManager.updating")||!0===this.get("graphicsView.updating")||this.allLayerViews.some((t=>!t.destroyed&&!("layerViews"in t)&&!0===t.updating)))}get viewpoint(){if(!this.ready)return this._get("viewpoint");const t=this.state.paddedViewState;return t&&t.viewpoint.clone()}set viewpoint(t){if(null==t)return;const e=this._normalizeInput(t);if(!e)return void(!t.scale||isNaN(t.scale)?nl.error("#viewpoint",`invalid scale value of ${t.scale}`):v(t.targetGeometry)?nl.error("#viewpoint","geometry not defined"):nl.error("#viewpoint",`incompatible spatialReference ${JSON.stringify(t.targetGeometry.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`));if(!this.ready)return this._set("viewpoint",e),this._set("extent",null),this._set("center",null),this._set("zoom",-1),this._set("scale",0),void this.notifyChange("initialExtentRequired");const i=new ds({targetGeometry:new Rt,scale:0,rotation:0});na(i,e),this.constraints.constrain(i,this.state.paddedViewState.viewpoint),this.state.viewpoint=i,this.frameTask.requestFrame(),this._set("viewpoint",i)}get zoom(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")}set zoom(t){if(null==t)return;if(!this.ready){this.notifyChange("initialExtentRequired"),this._set("zoom",t),this._set("scale",0);const e=this._get("extent");e&&(this._set("extent",null),this._set("center",e.center))}if(!this.constraints.effectiveLODs)return;const e=this.viewpoint;_a(e,e,this.constraints.zoomToScale(t)),this.viewpoint=e,this._set("zoom",this.constraints.scaleToZoom(this.scale))}goTo(t,e){if(t)return this.animation&&(this.animation=null),this._createAnimation(),bt(this,"ready",e&&e.signal).then((()=>{const i={animate:!0,...e},s=function(t,e){return async function(t,e){if(!t||!e)return new ds({targetGeometry:new Rt,scale:0,rotation:0});let i=e.spatialReference;const{constraints:s,padding:n,viewpoint:r,size:o}=e,a=[n?o[0]-n.left-n.right:o[0],n?o[1]-n.top-n.bottom:o[1]];let l=null;t instanceof ds?l=t:t.viewpoint?l=t.viewpoint:t.target&&"esri.Viewpoint"===t.target.declaredClass&&(l=t.target);let h=null;l&&l.targetGeometry?h=l.targetGeometry:t instanceof re?h=t:(t||t&&("center"in t||"extent"in t||"target"in t))&&(h=await sa(t.center,e,i)||await sa(t.extent,e,i)||await sa(t.target,e,i)||await sa(t,e,i)),!h&&r&&r.targetGeometry?h=r.targetGeometry:!h&&e.extent&&(h=e.extent);const u=Xo(h);if(i||(i=Xo(e.spatialReference||e.extent||h)),!ie(h,i)&&u&&!u.equals(i))return null;const c=ta(Ti(),h.center?h.center:h),d=new Rt(Qo(c,c,u,i),i);let p=null;if(l&&y(l.targetGeometry)&&"point"===l.targetGeometry.type)p=l.scale;else if(t.hasOwnProperty("scale")&&t.scale)p=t.scale;else if(t.hasOwnProperty("zoom")&&-1!==t.zoom&&s&&s.effectiveLODs)p=s.zoomToScale(t.zoom);else if(Array.isArray(h)||"point"===h.type||"extent"===h.type&&0===h.width&&0===h.height){const t=se(e.extent,i);p=y(t)?ia(t,a):e.extent?ia(e.extent,a):r.scale}else p=ie(h.extent,i)?ia(se(h.extent,i),a):ia(h.extent,a);const f=function(t){if(t&&(!Array.isArray(t)||"number"!=typeof t[0])&&("object"==typeof t||Array.isArray(t)&&"object"==typeof t[0])){if("layer"in t&&t.layer&&t.layer.minScale&&t.layer.maxScale){const e=t.layer;return{min:e.minScale,max:e.maxScale}}if(Array.isArray(t)&&t.length&&t.every((t=>"layer"in t))){let e=0,i=0;for(const s of t){const t=s.layer;t&&t.minScale&&t.maxScale&&(e=t.minScale<e?t.minScale:e,i=t.maxScale>i?t.maxScale:i)}return e&&i?{min:e,max:i}:null}}}(t);f&&(f.min&&f.min>p?p=f.min:f.max&&f.max<p&&(p=f.max));let m=0;l?m=l.rotation:t.hasOwnProperty("rotation")?m=t.rotation:r&&(m=r.rotation);let v=new ds({targetGeometry:d,scale:p,rotation:m});return s&&(v=s.fit(v),s.constrainByGeometry(v),s.rotationEnabled||(v.rotation=m)),v}(t,e)}(t,this);return this.animation.update(s),this._gotoTask={},i.animate?this._gotoAnimated(s,i):this._gotoImmediate(s,i)}));nl.error("#goTo()","target cannot be null or undefined")}hitTest(t){return Promise.reject("Should be implemented by subclasses")}popupHitTest(t){return this.hitTest(t).then((e=>({...e,mapPoint:this.toMap(t)})))}toMap(t){if(!this.ready)return null;const[e,i]=this.state.toMap([0,0],[t.x,t.y]);return new Rt({x:e,y:i,spatialReference:this.spatialReference})}isTileInfoRequired(){return!0}toScreen(t){if(!this.ready)return null;const e=this._normalizeInput(t),i=[e.x,e.y];return this.state.toScreen(i,i),te(i[0],i[1])}pixelSizeAt(){return this.ready?this.state.resolution:(nl.error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}getDefaultSpatialReference(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||null}isSpatialReferenceSupported(t,e){return!(!e&&!this._get("ready"))||null!==this._getDefaultViewpoint()}importLayerView(t){return(t=>{const e=Sa[t.type];if(!y(e))throw function(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new n(`${i}:view-not-supported`,`${e} is not supported in 2D`)}(t);return e(t)})(t)}hasLayerViewModule(t){return(t=>y(Sa[t.type]))(t)}_createAnimation(){return this.animation&&!this.animation.done||(this.animation=new Ko),this.animation}_cancellableGoTo(t,e,i){const s=()=>t===this._gotoTask,n=i.then((()=>{s()&&(this.animation=null)})).catch((t=>{throw s()&&(this.animation=null,e.done||(e.stop(),this.frameTask.animationInProgress=!1)),t})),r=new Promise((t=>t(n)));return e.when().catch((()=>{s()&&r.cancel&&r.cancel()})),r}_gotoImmediate(t,e){const i=this._gotoTask,s=this.animation,o=t.then((t=>{if(r(e),i!==this._gotoTask)throw new n("view:goto-interrupted","Goto was interrupted");this.viewpoint=s.target=t,s.finish()}));return this._cancellableGoTo(i,s,o)}_gotoAnimated(t,e){const i=this._gotoTask,s=this.animation,o=t.then((t=>{if(r(e),i!==this._gotoTask)throw new n("view:goto-interrupted","Goto was interrupted");return s.update(t),this.animationManager.animate(s,this.viewpoint,e),s.when().then((()=>{}),(()=>{}))}));return this._cancellableGoTo(i,s,o)}_resizeHandler(t){const e=this.state;if(!e)return;let i=this.state.paddedViewState.viewpoint;const s=this.state.paddedViewState.size.concat();e.size=[t.width,t.height],wa(i,i,s,this.state.paddedViewState.size,this.resizeAlign),i=this.constraints.constrain(i,null),this.state.viewpoint=i}_startup(){const t=this._getDefaultViewpoint();this.constraints.view=this,this.constraints.fit(t),this._set("animationManager",new Ta({view:this})),this._set("state",new il({padding:this._get("padding"),size:this.size,viewpoint:t})),this._set("featuresTilingScheme",new ze(He.create({spatialReference:this.spatialReference,size:512,numLODs:36}))),this._set("ready",!0),this.frameTask&&this.frameTask.start()}_teardown(){this.frameTask&&this.frameTask.stop(),this._set("ready",!1),this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null);const{center:[t,e],spatialReference:i,rotation:s,scale:n}=this.state.paddedViewState,r=new Rt({x:t,y:e,spatialReference:i});this._set("viewpoint",null),this._set("extent",null),this._set("center",r),this._set("zoom",-1),this._set("rotation",s),this._set("scale",n),this._set("spatialReference",i),this.constraints.view=null,this.animationManager.destroy(),this._set("animationManager",null),this._set("state",null),this.animation=null}_flipStationary(t){return null!==this._stationaryTimer||(this._stationaryTimer=setTimeout((()=>{this._stationaryTimer=null;const t=performance.now()-this._lastStationaryEventTimestamp;t<160&&(this._stationaryTimer=this._flipStationary(t))}),t)),this._stationaryTimer}_normalizeInput(t,e=this.spatialReference){const i=t&&t.targetGeometry||t;return e?i?e.equals(i.spatialReference)?t:ie(i,e)?function(t){return t&&"esri.Viewpoint"===t.declaredClass}(t)?(t.targetGeometry=se(i,e),t):se(i,e):null:null:t}_getDefaultViewpoint(){const t=this.constraints,e={zoom:this._get("zoom"),scale:this._get("scale"),center:this._normalizeInput(this._get("center")),extent:this._normalizeInput(this._get("extent")),rotation:this._get("rotation"),viewpoint:this._normalizeInput(this._get("viewpoint")),spatialReference:this._userSpatialReference};t.effectiveLODs?-1!==e.zoom&&(e.scale=t.zoomToScale(e.zoom)):e.zoom=-1;let i=null,s=null,n=0;const r=e.viewpoint&&e.viewpoint.rotation,o=e.viewpoint&&e.viewpoint.targetGeometry;y(o)&&("extent"===o.type?i=o:"point"===o.type&&(s=o,n=e.viewpoint.scale));const a=this._normalizeInput(this.get("map.initialViewProperties.viewpoint.targetGeometry.extent")),l=this._normalizeInput(this.initialExtent),h=e.extent||i||a||l,u=e.center||s||h&&h.center,c=this.get("map.initialViewProperties.viewpoint.scale"),d=e.scale||n||c||h&&ia(h,this.size),p=this.get("map.initialViewProperties.viewpoint.rotation");return u&&d?new ds({targetGeometry:u,scale:d,rotation:e.rotation||r||p||0}):null}};t([l()],rl.prototype,"_stationaryTimer",void 0),t([l()],rl.prototype,"animation",null),t([l({readOnly:!0})],rl.prototype,"animationManager",void 0),t([l({value:null,type:Rt,dependsOn:["state.id","ready"]})],rl.prototype,"center",null),t([l({type:Ha})],rl.prototype,"constraints",null),t([l({value:null,type:re,dependsOn:["state.id","ready"]})],rl.prototype,"extent",null),t([l({readOnly:!0})],rl.prototype,"featuresTilingScheme",void 0),t([l()],rl.prototype,"fullOpacity",void 0),t([l({readOnly:!0})],rl.prototype,"graphicsTileStore",null),t([l()],rl.prototype,"graphicsView",void 0),t([l({type:re})],rl.prototype,"initialExtent",void 0),t([l({dependsOn:["map.initialViewProperties?.viewpoint"]})],rl.prototype,"initialExtentRequired",null),t([l()],rl.prototype,"labelManager",void 0),t([l({value:{top:0,right:0,bottom:0,left:0},cast:t=>({top:0,right:0,bottom:0,left:0,...t})})],rl.prototype,"padding",null),t([l({type:Object})],rl.prototype,"renderingOptions",void 0),t([l()],rl.prototype,"resizeAlign",void 0),t([l({readOnly:!0,dependsOn:["state.id"]})],rl.prototype,"resolution",null),t([l({value:0,type:Number,dependsOn:["state.id","ready"]})],rl.prototype,"rotation",null),t([l({value:0,type:Number,dependsOn:["state.id","ready"]})],rl.prototype,"scale",null),t([l({type:oe,dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],rl.prototype,"spatialReference",void 0),t([l({readOnly:!0})],rl.prototype,"state",void 0),t([l({dependsOn:["animation","navigating","resizing","_stationaryTimer"]})],rl.prototype,"stationary",null),t([l({readOnly:!0})],rl.prototype,"supportsGround",void 0),t([l({type:sl,readOnly:!0})],rl.prototype,"timeline",void 0),t([l({readOnly:!0})],rl.prototype,"type",void 0),t([l({readOnly:!0,dependsOn:["layerViewManager.updating","labelManager.updating","graphicsView?.updating"]})],rl.prototype,"updating",null),t([l({value:null,type:ds,dependsOn:["state.id","ready"]})],rl.prototype,"viewpoint",null),t([l({value:-1,dependsOn:["state.id"]})],rl.prototype,"zoom",null),rl=t([e("esri.views.MapViewBase")],rl);const ol=rl;function al(t,e){switch(e){case"primary":return"touch"===t.pointerType||0===t.button;case"secondary":return"touch"!==t.pointerType&&2===t.button;case"tertiary":return"touch"!==t.pointerType&&1===t.button}}class ll extends pr{constructor(t,e){super(!0),this.view=t,this.registerIncoming("double-click",e,(t=>this._handleDoubleClick(t,e)))}_handleDoubleClick(t,e){al(t.data,"primary")&&(t.stopPropagation(),e?this.view.mapViewNavigation.zoomOut([t.data.x,t.data.y]):this.view.mapViewNavigation.zoomIn([t.data.x,t.data.y]))}}class hl extends pr{constructor(t,e,i){super(!0),this.view=t,this.pointerType=e,this.registerIncoming("double-tap-drag",i,(t=>this._handleDoubleTapDrag(t)))}_handleDoubleTapDrag(t){const{data:e}=t,{pointerType:i}=e;if(i!==this.pointerType)return;t.stopPropagation();const{action:s,delta:n}=e,{view:r}=this,{mapViewNavigation:o}=r;switch(s){case"begin":{const{scale:t}=r;this._startScale=t,this._currentScale=t,this._previousDelta=n,o.begin();break}case"update":{if(this._previousDelta.y===n.y)return;this._previousDelta=n;const t=this._startScale*1.015**n.y;o.setViewpointImmediate(t/this._currentScale),this._currentScale=t;break}case"end":{const{constraints:t}=r,{effectiveLODs:e,snapToZoom:i}=t;if(!i||!e)return void o.end();const s=t.snapScale(this._currentScale),a=(n.y>0?Math.max(s,t.snapToPreviousScale(this._startScale)):Math.min(s,t.snapToNextScale(this._startScale)))/this._currentScale;o.zoom(a);break}}}}class ul{constructor(t){this.callbacks=t,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(t){const e=t.data,i=e.pointers.size;switch(e.action){case"start":this.currentCount=i,this.emitStart(t);break;case"added":this.emitEnd(this.previousEvent),this.currentCount=i,this.emitStart(t);break;case"update":this.emitUpdate(t);break;case"removed":this.startEvent&&this.emitEnd(this.previousEvent),this.currentCount=i,this.emitStart(t);break;case"end":this.emitEnd(t),this.currentCount=0}this.previousEvent=t}emitStart(t){this.startEvent=t,this.callbacks.condition(this.currentCount,t)&&this.callbacks.start(this.currentCount,t,this.startEvent)}emitUpdate(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.update(this.currentCount,t,this.startEvent)}emitEnd(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.end(this.currentCount,t,this.startEvent),this.startEvent=null}}class cl extends pr{constructor(t,e,i){super(!0),this.view=t,this.pointerAction=e,this.registerIncoming("drag",i,(t=>this._handleDrag(t))),this.registerIncoming("pointer-down",(()=>this.stopMomentumNavigation()));const s=this.view.mapViewNavigation;this.dragEventSeparator=new ul({start:(t,e)=>{s.pan.begin(this.view,e.data),e.stopPropagation()},update:(t,e)=>{s.pan.update(this.view,e.data),e.stopPropagation()},end:(t,e)=>{s.pan.end(this.view,e.data),e.stopPropagation()},condition:(t,e)=>1===t&&al(e.data,this.pointerAction)})}_handleDrag(t){const e=this.view.mapViewNavigation;e.pinch.zoomMomentum||e.pinch.rotateMomentum?this.stopMomentumNavigation():this.dragEventSeparator.handle(t)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}}class dl extends pr{constructor(t,e,i){super(!0),this.view=t,this.pointerAction=e;const s=this.view.mapViewNavigation;this.dragEventSeparator=new ul({start:(t,e)=>{s.rotate.begin(this.view,e.data),e.stopPropagation()},update:(t,e)=>{s.rotate.update(this.view,e.data),e.stopPropagation()},end:(t,e)=>{s.rotate.end(),e.stopPropagation()},condition:(t,e)=>1===t&&al(e.data,this.pointerAction)}),this.registerIncoming("drag",i,(t=>this.dragEventSeparator.handle(t)))}}function pl(t){let e=t*t;return t<0&&(e*=-1),e}class fl extends pr{constructor(t){super(!0),this.view=t,this.frameTask=null,this.watchHandles=new b,this.currentDevice=null,this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.handle=this.registerIncoming("gamepad",(t=>this.handleEvent(t))),this.handle.pause()}onInstall(t){super.onInstall(t),this.watchHandles.add([_(this.view.navigation.gamepad,"enabled",(t=>{t?(this.handle.resume(),this.frameTask||(this.frameTask=et({update:t=>this.frameUpdate(t.deltaTime)}))):(this.handle.pause(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null))}))])}onUninstall(){this.watchHandles.removeAll(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null),super.onUninstall()}handleEvent(t){const e=this.view.navigation.gamepad.device;e&&t.data.device!==e||this.currentDevice&&this.currentDevice!==t.data.device||("end"===t.data.action?(this.currentDevice=null,function(t){t.translation[0]=0,t.translation[1]=0,t.translation[2]=0,t.heading=0,t.tilt=0}(this.transformation)):(this.currentDevice=t.data.device,function(t,e,i){const s=i,n=t.state,r=t.device,o="forward-down"===e.tiltDirection?1:-1;"standard"===r.deviceType?(s.translation[0]=pl(n.axes[0]),s.translation[1]=pl(n.axes[1]),s.translation[2]=pl(n.buttons[7])-pl(n.buttons[6]),s.heading=pl(n.axes[2]),s.tilt=pl(n.axes[3])):"spacemouse"===r.deviceType&&(s.translation[0]=1.2*pl(n.axes[0]),s.translation[1]=1.2*pl(n.axes[1]),s.translation[2]=2*-pl(n.axes[2]),s.heading=1.2*pl(n.axes[5]),s.tilt=1.2*pl(n.axes[3])),s.tilt*=o,we(s.translation,s.translation,1)}(t.data,this.view.navigation.gamepad,this.transformation)))}frameUpdate(t){const e=this.transformation;if(function(t){return 0===t.translation[0]&&0===t.translation[1]&&0===t.translation[2]&&0===t.heading&&0===t.tilt&&0===t.zoom}(e))return;const i=this.view.viewpoint.clone(),s=vl*this.view.navigation.gamepad.velocityFactor*t;Aa(i,i,[e.translation[0]*s,-e.translation[1]*s]);const n=this.view.size;Ma(i,i,1+e.translation[2]*gl*t,this.view.constraints.rotationEnabled?-e.heading*ml*t:0,[n[0]/2,n[1]],n);const r=this.view.constraints.constrain(i,this.view.viewpoint);this.view.viewpoint=r}}const ml=.06,vl=.7,gl=6e-4;class wl extends pr{constructor(t,e,i){super(!0),this.view=t,this.keys=e,this._pressed=!1,this._keyMap={[e.left]:"left",[e.right]:"right",[e.up]:"up",[e.down]:"down"},this.registerIncoming("key-down",i,(t=>this._handleKeyDown(t))),this.registerIncoming("key-up",i,(t=>this._handleKeyUp(t))),this.registerIncoming("blur",i,(()=>this._handleBlur()))}_handleKeyDown(t){t.data.repeat||this._handleKey(t,!0)}_handleKeyUp(t){this._handleKey(t,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(t,e){const i=this._keyMap[t.data.key];if(this._pressed=null!=i,this._pressed){if(e)switch(this.view.mapViewNavigation.begin(),i){case"left":this.view.mapViewNavigation.continousPanLeft();break;case"right":this.view.mapViewNavigation.continousPanRight();break;case"up":this.view.mapViewNavigation.continousPanUp();break;case"down":this.view.mapViewNavigation.continousPanDown()}else this._pressed=!1,this.view.mapViewNavigation.stop();t.stopPropagation()}}}class yl extends pr{constructor(t,e,i){super(!0),this.view=t,this.keys=e,this._pressed=!1,this._keyToDirection={[e.clockwiseOption1]:"clockwise",[e.clockwiseOption2]:"clockwise",[e.counterClockwiseOption1]:"counterClockwise",[e.counterClockwiseOption2]:"counterClockwise",[e.resetOption1]:"reset",[e.resetOption2]:"reset"},this.registerIncoming("key-down",i,(t=>this._handleKeyDown(t))),this.registerIncoming("key-up",i,(t=>this._handleKeyUp(t))),this.registerIncoming("blur",i,(()=>this._handleBlur()))}_handleKeyDown(t){t.data.repeat||this._handleKey(t,!0)}_handleKeyUp(t){this._handleKey(t,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(t,e){const i=t.modifiers;if(i.size>0&&!i.has("Shift")||!this.view.constraints.rotationEnabled)return;const s=this._keyToDirection[t.data.key];if(this._pressed=null!=s,this._pressed){if(e)switch(this.view.mapViewNavigation.begin(),s){case"clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();t.stopPropagation()}}}class bl extends pr{constructor(t,e,i){super(!0),this.view=t,this.keys=e,this._keysToZoomAction={},this.registerIncoming("key-down",i,(t=>this._handleKeyDown(t))),e.zoomIn.forEach((t=>this._keysToZoomAction[t]=0)),e.zoomOut.forEach((t=>this._keysToZoomAction[t]=1))}_handleKeyDown(t){this._handleKey(t)}_handleKey(t){const e=t.modifiers;if(e.size>0&&!e.has("Shift"))return;const{key:i}=t.data;if(!(i in this._keysToZoomAction))return;const s=this._keysToZoomAction[i],{mapViewNavigation:n}=this.view;let r=null;switch(s){case 0:r=n.zoomIn();break;case 1:r=n.zoomOut();break;default:return}n.begin(),r.then((()=>n.end())),t.stopPropagation()}}class _l extends pr{constructor(t,e){super(!0),this.view=t,this._canZoom=!0,this.registerIncoming("mouse-wheel",e,(t=>this._handleMouseWheel(t)))}_handleMouseWheel(t){if(!this.view.navigation.mouseWheelZoomEnabled)return;if(t.preventDefault(),t.stopPropagation(),!this._canZoom)return;const e=this.view.mapViewNavigation,{x:i,y:s,deltaY:n}=t.data,r=e.zoom(1/.6**(1/60*n),[i,s]);r&&(this._canZoom=!1,r.catch((()=>{})).then((()=>{this._canZoom=!0,e.end()})))}}class Ml extends pr{constructor(t){super(!0),this.view=t,this.registerIncoming("drag",(t=>this._handleDrag(t))),this.registerIncoming("pointer-down",(()=>this.stopMomentumNavigation()));const e=this.view.mapViewNavigation;this.dragEventSeparator=new ul({start:(t,i)=>{e.pinch.begin(this.view,i.data),i.stopPropagation()},update:(t,i)=>{e.pinch.update(this.view,i.data),i.stopPropagation()},end:(t,i)=>{e.pinch.end(this.view),i.stopPropagation()},condition:t=>t>=2})}_handleDrag(t){this.dragEventSeparator.handle(t)}stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}}function xl(t){const e=t.native;return e?{buttons:e.buttons.map((t=>t.pressed?t.value?t.value:1:0)),axes:e.axes.map((e=>function(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}(e,t.axisThreshold)))}:{buttons:[],axes:[]}}class Il{constructor(t,e){this.element=t,this.input=e,this._hasEventListeners=!1,this.onConnectGamepad=t=>{this.connectGamepad(t.gamepad)},this.onDisconnectGamepad=t=>{const e=t.gamepad,i=e.index,s=this.inputDevices[i];s&&(this.emitGamepadEvent(e,xl(s),!1),this.inputDevices.splice(i,1),this.latestUpdate.splice(i,1),this.input.gamepad.devices.remove(s),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this.forEachGamepad((t=>this.connectGamepad(t))),window.addEventListener("gamepadconnected",this.onConnectGamepad),window.addEventListener("gamepaddisconnected",this.onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this.onConnectGamepad),window.removeEventListener("gamepaddisconnected",this.onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this.callback=t}connectGamepad(t){const e=new ko(t);"unknown"!==e.deviceType&&(this.inputDevices[t.index]=e,this.input.gamepad.devices.add(e)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this.startPolling():this.stopPolling()}startPolling(){null==this.frameTask&&(this.frameTask=et({update:()=>this.readGamepadState()}))}stopPolling(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}readGamepadState(){const t=document.hasFocus(),e=this.element.contains(document.activeElement),i="document"===this.input.gamepad.enabledFocusMode&&!t||"view"===this.input.gamepad.enabledFocusMode&&!e;this.forEachGamepad((t=>{const e=this.inputDevices[t.index];if(!e)return;const s=this.latestUpdate[t.index],n=xl(e),r=i||function(t){for(let e=0;e<t.axes.length;e++)if(0!==t.axes[e])return!1;for(let e=0;e<t.buttons.length;e++)if(0!==t.buttons[e])return!1;return!0}(n);if(s){if(s.timestamp===t.timestamp)return;if(!s.active&&r)return;if(function(t,e){if(t.axes.length!==e.axes.length)return!1;if(t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}(s.state,n))return}this.emitGamepadEvent(t,n,!r)}))}forEachGamepad(t){const e=window.navigator.getGamepads();for(let i=0;i<e.length;i++){const s=e[i];this.validate(s)&&t(s)}}emitGamepadEvent(t,e,i){const s=this.latestUpdate[t.index],n=s&&s.active;if(!n&&!i)return;const r=!n&&i?"start":n&&i?"update":"end";this.latestUpdate[t.index]={timestamp:t.timestamp,state:e,active:i},this.callback&&this.callback({device:this.inputDevices[t.index],state:e,action:r})}validate(t){if(!t)return!1;if(!t.connected)return!1;for(let e=0;e<t.axes.length;e++)if(isNaN(t.axes[e]))return!1;return!0}}const kl=Z("trident"),Al=Z("edge"),Cl=Z("chrome"),Ol=Z("ff"),Tl=Z("safari"),Fl="esri-view-surface--touch-none",Pl="esri-view-surface--touch-pan";class El{constructor(t,e){this.input=e,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Il(t,this.input),this._gamepadSource.onEvent=t=>this._callback("gamepad",t)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach((t=>{this._releasePointerCaptureSafe(t)})),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const e in this._active)t&&t.has(e)||(this._element.removeEventListener(Vl[e],this._active[e]),delete this._active[e]);t&&t.forEach((t=>{if(!this._active[t]&&Vl[t]){const e=(this._eventHandlers[t]||this._handleDefault).bind(this,t);this._element.addEventListener(Vl[t],e),this._active[t]=e}})),this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}setPointerCapture(t,e){e?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Fl:Pl),this._element.classList.add(this._browserTouchPanningEnabled?Pl:Fl)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Fl),this._element.classList.remove(Pl),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch(t){}}_updateNormalizedPointerLikeEvent(t,e){const i=uo(this._element,t);return El.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),e.x=i.x,e.y=i.y,e}_handleKey(t,e){const i=function(t){if(void 0!==t.key)return D(t);const e=hr[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}(e);i&&"key-up"===t&&this._keyDownState.delete(i);const s={native:e,key:i,repeat:i&&this._keyDownState.has(i)};i&&"key-down"===t&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,e){const i=this._updateNormalizedPointerLikeEvent(e,{native:e,x:0,y:0,pointerType:e.pointerType,button:e.button,buttons:e.buttons,eventId:this._eventId++});this._callback(t,i)}_handlePointerPreventDefault(t,e){const i=this._updateNormalizedPointerLikeEvent(e,{native:e,x:0,y:0,pointerType:e.pointerType,button:e.button,buttons:e.buttons,eventId:this._eventId++});e.preventDefault(),this._callback(t,i)}_handleMouseWheel(t,e){let i=e.deltaY;switch(e.deltaMode){case 0:(kl||Al)&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}kl||Al?i*=.7:Cl||Tl?i*=.6:Ol&&(i*=1.375);const s=Math.abs(i);s>100&&(i=i/s*200/(1+Math.exp(-.02*(s-100))));const n=this._updateNormalizedPointerLikeEvent(e,{native:e,x:0,y:0,deltaY:i});this._callback(t,n)}_handlePointerCaptureLost(t,e){this._activePointerCaptures.delete(e.pointerId),this._handleDefault(t,e)}_handleDefault(t,e){const i={native:e};e.preventDefault(),this._callback(t,i)}_preventAltKeyDefault(t){"Alt"===t.key&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}El.test={disableSubpixelCoordinates:!1};const Vl={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class Sl extends pr{constructor(){super(!0),this.registerIncoming("context-menu",(t=>{t.data.native.preventDefault()}))}}function Rl(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}class Nl extends pr{constructor(t=250,e=10,i=350,s=35,n=_t){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=e,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach((t=>{null!=t.doubleClickTimeout&&(t.doubleClickTimeout.remove(),t.doubleClickTimeout=null)}))}get hasPendingInputs(){return at(this._pointerState,(t=>null!=t.doubleClickTimeout))}_pointerId(t){const e=t.native;return"mouse"===e.pointerType?`${e.pointerId}:${e.button}`:`${e.pointerType}`}_handleImmediateClick(t){const e=t.data,i=this._pointerId(e),s=this._pointerState.get(i);if(s){const n="touch"===e.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;Rl(s.event.data,e)>n?(this._clearDoubleClickTimeout(i,!0),this._startClick(t)):(this._clearDoubleClickTimeout(i,!1),this._doubleClick.emit(s.event.data,void 0,s.event.modifiers))}else this._startClick(t)}_startClick(t){const e=this._pointerId(t.data);this._pointerState.set(e,{event:t,doubleClickTimeout:this._clock.setTimeout((()=>this._doubleClickTimeoutExceeded(e)),"touch"===t.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}),this.refreshHasPendingInputs()}_handlePointerDrag(t){const e=this._pointerId(t.data.currentEvent);this._clearDoubleClickTimeout(e,!0)}_handleDrag(t){const e=this._pointerId(t.data.pointer);this._clearDoubleClickTimeout(e,!0)}_clearDoubleClickTimeout(t,e){const i=this._pointerState.get(t);i&&(i.doubleClickTimeout.remove(),i.doubleClickTimeout=null,e&&this._doubleClickTimeoutExceeded(t),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const e=this._pointerState.get(t);this._click.emit(e.event.data,void 0,e.event.modifiers),e.doubleClickTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}}class Ll extends pr{constructor(t=250,e=10,i=350,s=35,n=_t){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=e,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=s,this._clock=n,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=te(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new ul({start:(t,e)=>this._dragStart(t,e),update:(t,e)=>this._dragUpdate(e),end:(t,e)=>this._dragEnd(e)}),this.registerIncoming("drag",(t=>this._dragEventSeparator.handle(t))),this.registerIncoming("pointer-down",(t=>this._handlePointerDown(t))),this.registerIncoming("pointer-up",(()=>this._handlePointerUp()))}onUninstall(){this._pointerState.forEach((t=>{null!=t.doubleTapTimeout&&(t.doubleTapTimeout.remove(),t.doubleTapTimeout=null)}))}get hasPendingInputs(){return at(this._pointerState,(t=>null!=t.doubleTapTimeout))}_clearPointerDown(t){const e=this._pointerState.get(t);e&&(e.doubleTapTimeout.remove(),e.doubleTapTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs())}_createDoubleTapDragData(t,e,i){const{button:s,buttons:n,pointer:r,pointers:o,pointerType:a,timestamp:l}=i;return{action:t,delta:e,button:s,buttons:n,pointer:r,pointers:o,pointerType:a,timestamp:l}}_dragStart(t,e){if(!this._doubleTapDragReady||1!==t)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:i,modifiers:s}=e,{center:n}=i;this._dragStartCenter=n;const r=this._createDoubleTapDragData("begin",te(0,0),i);this._doubleTapDrag.emit(r,void 0,s),e.stopPropagation()}_dragUpdate(t){if(!this._doubleTapDragActive)return;const{data:e,modifiers:i}=t,{center:s}=e,n=te(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),r=this._createDoubleTapDragData("update",n,e);this._doubleTapDrag.emit(r,void 0,i),t.stopPropagation()}_dragEnd(t){if(!this._doubleTapDragActive)return;const{data:e,modifiers:i}=t,{center:s}=e,n=te(s.x-this._dragStartCenter.x,s.y-this._dragStartCenter.y),r=this._createDoubleTapDragData("end",n,e);this._doubleTapDrag.emit(r,void 0,i),this._doubleTapDragActive=!1,t.stopPropagation()}_handlePointerDown(t){const{data:e}=t,i=this._pointerId(e),s=this._pointerState.get(i),{pointerType:n}=e.native;if(s){const r="touch"===n?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;this._clearPointerDown(i),Rl(s.event.data,e)>r?this._storePointerDown(t):this._doubleTapDragReady=!0}else this._storePointerDown(t)}_handlePointerUp(){this._doubleTapDragReady=!1}_pointerId(t){const{native:e}=t,{pointerId:i,button:s,pointerType:n}=e;return"mouse"===n?`${i}:${s}`:`${n}`}_storePointerDown(t){const{data:e}=t,{pointerType:i}=e.native,s=this._pointerId(e),n=this._clock.setTimeout((()=>this._clearPointerDown(s)),"touch"===i?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay);this._pointerState.set(s,{event:t,doubleTapTimeout:n}),this.refreshHasPendingInputs()}}class zl extends pr{constructor(t){super(!1),this.navigationTouch=t,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this.handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this.handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this.handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this.handlePointerUpAndPointerLost.bind(this))}createPayload(t,e,i,s){return{action:t,pointerType:this.pointerType,button:this.mouseButton,buttons:e.buttons,timestamp:s,pointers:Dl(this.activePointerMap),pointer:e,angle:i.angle,radius:i.radius,center:i.center}}addPointer(t){const e=t.native.pointerId,i=jl(this.activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this.activePointerMap.set(e,s);const n=Ul(s,$l(this.activePointerMap));s.initialAngle=n,s.lastAngle=n,this.updatePointerAngles(i)}updatePointer(t){if(t&&null==t.x&&null==t.y)return;const e=this.activePointerMap.get(t.native.pointerId);e?e.event=t:this.addPointer(t)}removePointer(t){const e=jl(this.activePointerMap).angle;this.activePointerMap.delete(t),this.updatePointerAngles(e)}updatePointerAngles(t){const e=jl(this.activePointerMap);this.activePointerMap.forEach((i=>{i.initialAngle=Ul(i,e)-t,i.lastAngle=Ul(i,e)-t}))}emitEvent(t,e,i){const s=jl(this.activePointerMap);this.drag.emit(this.createPayload(t,e,s,i),void 0,this.startStateModifiers)}handlePointerUpAndPointerLost(t){const e=t.data.native.pointerId,i=Mt(t.timestamp);this.activePointerMap.get(e)&&(1===this.activePointerMap.size?(this.updatePointer(t.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",t.data,i),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.removePointer(e)):(this.removePointer(e),this.emitEvent("removed",t.data,Mt(t.timestamp))))}handlePointerDrag(t){const e=t.data,i=e.currentEvent,s=Mt(t.timestamp);switch(e.action){case"start":case"update":this.isDragging?this.activePointerMap.has(i.native.pointerId)?(this.updatePointer(i),!this.isCurrentDragSuppressed&&this.emitEvent("update",i,s)):(this.addPointer(i),this.emitEvent("added",i,s),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(i),this.pointerType=t.data.startEvent.pointerType,this.mouseButton=t.data.startEvent.button,this.startStateModifiers=t.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",i,s))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}function $l(t){const e=[];return t.forEach((t=>{e.push(te(t.event.x,t.event.y))})),function(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:te()},0===t.length)return e;if(1===t.length)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(2===t.length){const[i,s]=t,[n,r]=[s.x-i.x,s.y-i.y];return e.radius=Math.sqrt(n*n+r*r)/2,e.center.x=(i.x+s.x)/2,e.center.y=(i.y+s.y)/2,e}let i=0,s=0;for(let e=0;e<t.length;e++)i+=t[e].x,s+=t[e].y;i/=t.length,s/=t.length;const n=t.map((t=>t.x-i)),r=t.map((t=>t.y-s));let o=0,a=0,l=0,h=0,u=0,c=0,d=0;for(let t=0;t<n.length;t++){const e=n[t],i=r[t],s=e*e,p=i*i;o+=s,a+=p,l+=e*i,h+=s*e,u+=p*i,c+=e*p,d+=i*s}const p=.5*(h+c),f=.5*(u+d),m=o*a-l*l,v=(p*a-f*l)/m,g=(o*f-l*p)/m,w=te(v+i,g+s);return{radius:Math.sqrt(v*v+g*g+(o+a)/t.length),center:w}}(e)}function jl(t){const e=$l(t);let i=0;return t.forEach((t=>{let s=Ul(t,e),n=s-t.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=t.lastAngle+n,t.lastAngle=s,i+=s-t.initialAngle})),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function Dl(t){const e=new Map;return t.forEach(((t,i)=>e.set(i,t.event))),e}function Ul(t,e){const i=t.event;return Math.atan2(i.y-e.center.y,i.x-e.center.x)}var ql;!function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"}(ql||(ql={}));class Bl extends pr{constructor(t=250,e=10,i=350,s=35,n=_t){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=e,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(t=>{this._handlePointerLoss(t,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(t=>{this._handlePointerLoss(t,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(t=>{this._handlePointerLoss(t,"pointer-cancel")}))}onUninstall(){this._pointerState.forEach((t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()})),super.onUninstall()}_handlePointerDown(t){const e=t.data,i=this._pointerId(e);this._pointerState.has(i)||(this._pointerState.set(i,{downButton:e.native.button,immediateDoubleClick:null}),this.startCapturingPointer(e.native))}_handlePointerLoss(t,e){const i=t.data,s=this._pointerId(i),n=this._pointerState.get(s);if(n&&"pointer-up"===e&&n.downButton===i.native.button){const e=n.immediateDoubleClick;if(e){e.timeoutHandle.remove();const s="touch"===t.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;Rl(e,t.data)>s?this._startImmediateDoubleClick(t,n):(this._immediateDoubleClick.emit(t.data,void 0,e.modifiers),this._removeState(i))}else this._startImmediateDoubleClick(t,n)}}_startImmediateDoubleClick(t,e){e.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout((()=>this._removeState(t.data)),"touch"===t.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}}_pointerId(t){const e=t.native;return"mouse"===e.pointerType?`${e.pointerId}:${e.button}`:`${e.pointerType}`}_removeState(t){const e=this._pointerId(t);this._pointerState.delete(e),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}class Gl extends pr{constructor(t=300,e=1.5,i=6,s=6,n=500,r=_t){super(!1),this.maximumClickDelay=t,this.movementUntilMouseDrag=e,this.movementUntilPenDrag=i,this.movementUntilTouchDrag=s,this.holdDelay=n,this._clock=r,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(t=>{this._handlePointerLoss(t,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(t=>{this._handlePointerLoss(t,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(t=>{this._handlePointerLoss(t,"pointer-cancel")})),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach((t=>{null!=t.holdTimeout&&(t.holdTimeout.remove(),t.holdTimeout=null)})),super.onUninstall()}_handlePointerDown(t){const e=t.data,i=e.native.pointerId;let s=null;0===this._pointerState.size&&(s=this._clock.setTimeout((()=>{const e=this._pointerState.get(i);e&&(e.isDragging||(this._pointerHold.emit(e.previousEvent,void 0,t.modifiers),e.holdEmitted=!0),e.holdTimeout=null)}),this.holdDelay));const n={startEvent:e,previousEvent:e,startTimestamp:t.timestamp,isDragging:!1,downButton:e.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(e.native),this._moveHandle.resume(),this._pointerState.size>1&&this.startDragging(t)}_createPointerDragData(t,e,i){return{action:t,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:i}}_handlePointerMove(t){const e=t.data,i=this._pointerState.get(e.native.pointerId);i&&(i.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",i,e),void 0,i.modifiers):function(t,e){const i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)}(e,i.startEvent)>this._getDragThreshold(e.native.pointerType)&&this.startDragging(t),i.previousEvent=e)}_getDragThreshold(t){switch(t){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}startDragging(t){const e=t.data,i=e.native.pointerId;this._pointerState.forEach((s=>{null!=s.holdTimeout&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,e)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))}))}_handlePointerLoss(t,e){const i=t.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(null!=n.holdTimeout&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,"pointer-up"===e?i:n.previousEvent),void 0,n.modifiers):"pointer-up"===e&&n.downButton===i.native.button&&t.timestamp-n.startTimestamp<=this.maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),0===this._pointerState.size&&this._moveHandle.pause())}}const Hl={left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},Wl={zoomIn:["=","+"],zoomOut:["-","_"]},Zl={clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"};let Kl=class extends m{constructor(){super(...arguments),this._handles=new b}initialize(){this._handles.add([xt(this.view,"ready",(()=>this._disconnect())),dt(this.view,"ready",(()=>this._connect()))])}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this._disconnect()}_disconnect(){this._inputManager&&(this.view.viewEvents.disconnect(),this._inputManager.destroy(),this._inputManager=null,this._source.destroy(),this._source=null)}_connect(){const t=new El(this.view.surface,this.view.input),e=[new Bl,new Gl,new Nl,new zl(this.view.navigation),new Ll],i=new wr({eventSource:t,recognizers:e});i.installHandlers("prevent-context-menu",[new Sl],br.INTERNAL),i.installHandlers("navigation",[new Ml(this.view),new fl(this.view),new _l(this.view),new ll(this.view),new ll(this.view,["Ctrl"]),new cl(this.view,"primary"),new wl(this.view,Hl),new bl(this.view,Wl),new yl(this.view,Zl),new dl(this.view,"secondary"),new hl(this.view,"touch")],br.INTERNAL),this.view.viewEvents.connect(i),this._source=t,this._inputManager=i,_(this.view.navigation,"browserTouchPanEnabled",(t=>{this._source.browserTouchPanningEnabled=!t}))}get test(){return{inputManager:this._inputManager}}};t([l()],Kl.prototype,"view",void 0),Kl=t([e("esri.views.2d.input.MapViewInputManager")],Kl);const Jl=Kl;let Yl=0,Ql=class extends m{constructor(){super(...arguments),this.color=new Vt([0,255,255]),this.haloOpacity=1,this.fillOpacity=.25}get version(){return Yl++}};t([l({readOnly:!0})],Ql.prototype,"version",null),t([l({type:Vt})],Ql.prototype,"color",void 0),t([l({type:Vt})],Ql.prototype,"haloColor",void 0),t([l()],Ql.prototype,"haloOpacity",void 0),t([l()],Ql.prototype,"fillOpacity",void 0),Ql=t([e("esri.views.2d.support.HighlightOptions")],Ql);const Xl=Ql,th={checkMajorWebPerformanceCaveat:!0};let eh=class extends m{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(t){const e=this._get("node");t!==e&&(t&&t.classList.add("esri-component"),e&&e.classList.remove("esri-component"),this._set("node",t))}castNode(t){return t?"string"==typeof t||function(t){return t&&"nodeType"in t}(t)?(this._set("widget",null),X(t)):(function(t){return t&&"function"==typeof t.render}(t)&&!t.domNode&&(t.domNode=document.createElement("div")),this._set("widget",t),t.domNode):(this._set("widget",null),null)}};t([l({dependsOn:[]})],eh.prototype,"id",null),t([l()],eh.prototype,"node",null),t([g("node")],eh.prototype,"castNode",null),t([l({readOnly:!0})],eh.prototype,"widget",void 0),eh=t([e("esri.views.ui.Component")],eh);const ih=eh,sh={left:0,top:0,bottom:0,right:0},nh={bottom:30,top:15,right:15,left:15},rh="manual",oh="esri-ui-corner";function ah(t){const e=t,i="object"==typeof e&&null!==e&&Object.getPrototypeOf(e);return null!==i&&i!==Object.prototype||!("component"in e||"index"in e||"position"in e)?null:t}function lh(t,{top:e,bottom:i,left:s,right:n}){t.style.top=e,t.style.bottom=i,t.style.left=s,t.style.right=n}let hh=class extends f.EventedAccessor{constructor(t){super(t),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new b,this.view=null,this._initContainers()}initialize(){this._handles.add([_(this,"view.padding, container",this._applyViewPadding.bind(this)),_(this,"padding",this._applyUIPadding.bind(this))])}destroy(){this.container=null;for(const t of this._components)t.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(t){const e=this._get("container");t!==e&&(t&&(t.classList.add("esri-ui"),t.classList.add(It()),this._attachContainers(t)),e&&(e.classList.remove("esri-ui"),lh(e,{top:"",bottom:"",left:"",right:""}),it(e)),this._set("container",t))}get height(){const t=this.get("view.height")||0;if(0===t)return t;const e=this._getViewPadding();return Math.max(t-(e.top+e.bottom),0)}get padding(){return this._get("padding")}set padding(t){t?this._override("padding",t):this._clearOverride("padding")}castPadding(t){return"number"==typeof t?{bottom:t,top:t,right:t,left:t}:{...nh,...t}}get width(){const t=this.get("view.width")||0;if(0===t)return t;const e=this._getViewPadding();return Math.max(t-(e.left+e.right),0)}add(t,e){let i,s;if(Array.isArray(t))return void t.forEach((t=>this.add(t,e)));const n=ah(t);n&&({index:i,position:e,component:t,key:s}=n),e&&"object"==typeof e&&({index:i,key:s,position:e}=e),!t||e&&!this._isValidPosition(e)||this._add(t,e,i,s)}remove(t,e){if(!t)return;if(Array.isArray(t))return t.map((t=>this.remove(t,e)));const i=this._find(t);if(i){const s=this._componentToKey;if(s.has(t)&&s.get(t)!==e)return;const n=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(t),this._components.splice(n,1)[0]}}empty(t){return Array.isArray(t)?t.map((t=>this.empty(t))).reduce(((t,e)=>t.concat(e))):(t=t||rh)===rh?Array.prototype.slice.call(this._manualContainer.children).filter((t=>!t.classList.contains(oh))).map((t=>this.remove(t))):this._isValidPosition(t)?Array.prototype.slice.call(this._cornerNameToContainerLookup[t].children).map(this.remove,this):null}move(t,e){if(Array.isArray(t)&&t.forEach((t=>this.move(t,e))),!t)return;let i;const s=ah(t)||ah(e);if(s&&(i=s.index,e=s.position,t=s.component||t),e&&!this._isValidPosition(e))return;const n=this.remove(t);n&&this.add(n,{position:e,index:i})}find(t){if(!t)return null;const e=this._findById(t);return e&&(e.widget||e.node)}getPosition(t){for(const e in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[e].contains(t))return e;return null}_add(t,e,i,s){t instanceof ih||(t=new ih({node:t})),this._place({component:t,position:e,index:i}),this._components.push(t),s&&this._componentToKey.set(t,s)}_find(t){return t?t instanceof ih?this._findByComponent(t):"string"==typeof t?this._findById(t):this._findByNode(t.domNode||t):null}_getViewPadding(){return this.get("view.padding")||sh}_attachContainers(t){t.appendChild(this._innerContainer),t.appendChild(this._manualContainer)}_initContainers(){const t=document.createElement("div");t.classList.add("esri-ui-inner-container"),t.classList.add("esri-ui-corner-container");const e=document.createElement("div");e.classList.add("esri-ui-inner-container"),e.classList.add("esri-ui-manual-container");const i=document.createElement("div");i.classList.add("esri-ui-top-left"),i.classList.add(oh),t.appendChild(i);const s=document.createElement("div");s.classList.add("esri-ui-top-right"),s.classList.add(oh),t.appendChild(s);const n=document.createElement("div");n.classList.add("esri-ui-bottom-left"),n.classList.add(oh),t.appendChild(n);const r=document.createElement("div");r.classList.add("esri-ui-bottom-right"),r.classList.add(oh),t.appendChild(r),this._innerContainer=t,this._manualContainer=e;const o=L();this._cornerNameToContainerLookup={"top-left":i,"top-right":s,"bottom-left":n,"bottom-right":r,"top-leading":o?s:i,"top-trailing":o?i:s,"bottom-leading":o?r:n,"bottom-trailing":o?n:r},this._positionNameToContainerLookup={manual:e,...this._cornerNameToContainerLookup}}_isValidPosition(t){return!!this._positionNameToContainerLookup[t]}_place(t){const e=t.component,i=t.index,s=this._positionNameToContainerLookup[t.position||rh],n=i>-1;if(function(t){return t&&!t._started&&"function"==typeof t.postMixInProperties&&"function"==typeof t.buildRendering&&"function"==typeof t.postCreate&&"function"==typeof t.startup}(e.widget)&&e.widget.startup(),!n)return void s.appendChild(e.node);const r=Array.prototype.slice.call(s.children);0!==i?i>=r.length?s.appendChild(e.node):kt(e.node,r[i]):s.firstChild?kt(e.node,s.firstChild):s.appendChild(e.node)}_applyViewPadding(){const t=this.container;t&&lh(t,this._toPxPosition(this._getViewPadding()))}_applyUIPadding(){const t=this._innerContainer;t&&lh(t,this._toPxPosition(this.padding))}_toPxPosition(t){return{top:this._toPxUnit(t.top),left:this._toPxUnit(t.left),right:this._toPxUnit(t.right),bottom:this._toPxUnit(t.bottom)}}_toPxUnit(t){return 0===t?"0":t+"px"}_findByComponent(t){let e,i=null;return this._components.some((s=>(e=s===t,e&&(i=s),e))),i}_findById(t){let e,i=null;return this._components.some((s=>(e=s.id===t,e&&(i=s),e))),i}_findByNode(t){let e,i=null;return this._components.some((s=>(e=s.node===t,e&&(i=s),e))),i}};t([l()],hh.prototype,"container",null),t([l()],hh.prototype,"height",null),t([l({value:nh})],hh.prototype,"padding",null),t([g("padding")],hh.prototype,"castPadding",null),t([l()],hh.prototype,"view",void 0),t([l()],hh.prototype,"width",null),hh=t([e("esri.views.ui.UI")],hh);const uh=hh;function ch(t,e){return t&&"copyright"in t&&(!e||"function"==typeof t.originOf&&"user"===t.originOf("copyright"))}function dh(t,e,i){i&&e&&(t.find((t=>t.layerView===e&&t.text===i))||t.push({text:i,layerView:e}))}const ph=[];let fh=class extends Me{constructor(t){super(t),this.clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new s,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const e=this.get("view.allLayerViews");e&&this.handles.add(e.map((t=>t.watch(["suspended","attributionVisible"],this._updateAttributionItems))),"suspension"),t&&t.removed&&t.removed.forEach((t=>{this._pendingAttributions.delete(t),this._fetchedAttributionData.delete(t)})),this._updateAttributionItems()},this._updateAttributionItems=()=>{const t=this.get("view.allLayerViews");ph.length=0,t?(t.forEach((t=>{if(t.suspended||!t.get("layer.attributionVisible"))return;const e=t.layer;if(ch(e,"user"))return void dh(ph,t,e.copyright);if(e.hasAttributionData){if(this._fetchedAttributionData.has(t)){const i=this._fetchedAttributionData.get(t);return void(i?dh(ph,t,this._getDynamicAttribution(i,this.view,e)):ch(e)&&dh(ph,t,e.copyright))}return void this._fetchAttributionData(t)}const i=e.get("portalItem.accessInformation");dh(ph,t,i||e.copyright)})),function(t,e){return t.length!==e.length||t.some(((t,i)=>t.text!==e[i].text))}(this.items,ph)&&(this.items.removeAll(),this.items.addMany(ph)),ph.length=0,this.notifyChange("state")):this.clear()},this.handles.add([V(this,"view.allLayerViews","change",this._allLayerViewsChange,this._allLayerViewsChange,this.clear),At(this,"view.stationary",(()=>this._updateAttributionItems()))])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const e=await Ui(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const i=e.ok?this._createContributionIndex(e.value,function(t){return"bing-maps"===t.type}(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,i)}this._updateAttributionItems()}_createContributionIndex(t,e){const i=t.contributors,s={};if(!i)return s;for(let t=0;t<i.length;t++){const n=i[t],r=n.coverageAreas;if(!r)return;for(const i of r){const r=i.bbox,o=i.zoomMin-(e&&i.zoomMin?1:0),a=i.zoomMax-(e&&i.zoomMax?1:0),l={extent:Xt({xmin:r[1],ymin:r[0],xmax:r[3],ymax:r[2],spatialReference:oe.WGS84}),attribution:n.attribution||"",score:null!=i.score?i.score:100,id:t};for(let t=o;t<=a;t++)s[t]=s[t]||[],s[t].push(l)}}return s.maxKey=Math.max.apply(null,Object.keys(s)),s}_getDynamicAttribution(t,e,i){const{extent:s,scale:n}=e;let r=i.tileInfo.scaleToZoom(n);if(r=Math.min(t.maxKey,Math.round(r)),!s||null==r||r<=-1)return"";const o=t[r],a=se(s.center.clone().normalize(),e.spatialReference),l={};return o?o.filter((t=>{const e=!l[t.id]&&a&&me(t.extent,a);return e&&(l[t.id]=!0),e})).sort(((t,e)=>e.score-t.score||t.objectId-e.objectId)).map((t=>t.attribution)).join(", "):""}};t([l({readOnly:!0,type:s})],fh.prototype,"items",void 0),t([l({readOnly:!0})],fh.prototype,"state",null),t([l()],fh.prototype,"view",void 0),fh=t([e("esri.widgets.Attribution.AttributionViewModel")],fh);const mh=fh;let vh=class extends E{constructor(t,e){super(t,e),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this.iconClass="esri-icon-description",this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new mh}initialize(){this.own(V(this,"viewModel.items","change",(()=>this.scheduleRender())))}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce(((t,e)=>(-1===t.indexOf(e.text)&&t.push(e.text),t)),[]).join(this.itemDelimiter)}render(){return S("div",{bind:this,class:this.classes("esri-attribution esri-widget",{"esri-attribution--open":this._isOpen}),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return S("div",{class:"esri-attribution__powered-by"},"Powered by"," ",S("a",{class:"esri-attribution__link",href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const t=this._isOpen,e=this._isInteractive,i=e?0:-1,{attributionText:s}=this,n=e?"button":void 0;return S("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",{"esri-attribution__sources--open":t,"esri-interactive":e}),innerHTML:s,role:n,tabIndex:i})}_afterSourcesNodeCreate(t){this._prevSourceNodeHeight=t.clientWidth}_afterSourcesNodeUpdate(t){let e=!1;const{clientHeight:i,clientWidth:s,scrollWidth:n}=t,r=n>=s,o=this._attributionTextOverflowed!==r;if(this._attributionTextOverflowed=r,o&&(e=!0),this._isOpen){const t=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,t&&(this._isOpen=!1,e=!0)}e&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};t([l()],vh.prototype,"_isOpen",void 0),t([l()],vh.prototype,"_isInteractive",null),t([l()],vh.prototype,"_attributionTextOverflowed",void 0),t([l()],vh.prototype,"_prevSourceNodeHeight",void 0),t([l({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],vh.prototype,"attributionText",null),t([l()],vh.prototype,"iconClass",void 0),t([l()],vh.prototype,"itemDelimiter",void 0),t([l({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],vh.prototype,"label",void 0),t([l(),P("esri/widgets/Attribution/t9n/Attribution")],vh.prototype,"messages",void 0),t([F("viewModel.view")],vh.prototype,"view",void 0),t([l({type:mh})],vh.prototype,"viewModel",void 0),t([Q()],vh.prototype,"_toggleState",null),vh=t([e("esri.widgets.Attribution")],vh);const gh=vh;let wh=class extends($e(m)){constructor(t){super(t),this._handles=new b,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(_(this,"view",this._updateRotationWatcher))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get canShowNorth(){const t=this.get("view.spatialReference");return!(!t||!t.isWebMercator&&!t.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const t={};"2d"===this.view.type?t.rotation=0:t.heading=0,this.callGoTo({target:t})}_updateForRotation(t){null!=t&&(this.orientation={z:t})}_updateForCamera(t){t&&(this.orientation={x:0,y:0,z:-t.heading})}_updateRotationWatcher(t){this._handles.removeAll(),t&&this._handles.add("2d"===t.type?_(this,"view.rotation",this._updateForRotation):_(this,"view.camera",this._updateForCamera))}};t([l({readOnly:!0})],wh.prototype,"canShowNorth",null),t([l()],wh.prototype,"orientation",void 0),t([l({readOnly:!0})],wh.prototype,"state",null),t([l()],wh.prototype,"view",void 0),wh=t([e("esri.widgets.CompassViewModel")],wh);const yh=wh;let bh=class extends E{constructor(t,e){super(t,e),this.goToOverride=null,this.iconClass="esri-icon-locate-circled",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new yh}reset(){return this.viewModel.reset()}render(){const{orientation:t,state:e}=this.viewModel,i="disabled"===e,s="compass"==("rotation"===e?"rotation":"compass"),n=i?-1:0,r={"esri-disabled":i,"esri-interactive":!i},o={"esri-icon-compass":s,"esri-icon-dial":!s},{messages:a}=this;return S("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",r),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:n,"aria-label":a.reset,title:a.reset},S("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",o),styles:this._toRotationTransform(t)}),S("span",{class:"esri-icon-font-fallback-text"},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(t){return{transform:`rotateZ(${t.z}deg)`}}};t([F("viewModel.goToOverride")],bh.prototype,"goToOverride",void 0),t([l()],bh.prototype,"iconClass",void 0),t([l({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],bh.prototype,"label",void 0),t([l(),P("esri/widgets/Compass/t9n/Compass")],bh.prototype,"messages",void 0),t([F("viewModel.view")],bh.prototype,"view",void 0),t([l({type:yh})],bh.prototype,"viewModel",void 0),t([Q()],bh.prototype,"_reset",null),bh=t([e("esri.widgets.Compass")],bh);const _h=bh;let Mh=class extends m{constructor(t){super(t),this._handles=new b,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(dt(this,"view.inputManager",this._setNavigationMode.bind(this)))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"}};t([l({readOnly:!0})],Mh.prototype,"state",null),t([l()],Mh.prototype,"navigationMode",void 0),t([l()],Mh.prototype,"view",void 0),Mh=t([e("esri.widgets.NavigationToggleViewModel")],Mh);const xh=Mh,Ih="esri-navigation-toggle__button esri-widget--button";let kh=class extends E{constructor(t,e){super(t,e),this.iconClass="esri-icon-pan2",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new xh}set layout(t){"horizontal"!==t&&(t="vertical"),this._set("layout",t)}toggle(){return this.viewModel.toggle()}render(){const t="disabled"===this.get("viewModel.state"),e="pan"===this.get("viewModel.navigationMode"),i={"esri-navigation-toggle__button--active":e},s={"esri-navigation-toggle__button--active":!e},n=t?-1:0,r=this.messages.toggle;return S("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",{"esri-disabled":t,"esri-navigation-toggle--horizontal":"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":r,title:r},S("div",{class:this.classes(Ih,"esri-navigation-toggle__button--pan",i)},S("span",{class:"esri-icon-pan"})),S("div",{class:this.classes(Ih,"esri-navigation-toggle__button--rotate",s)},S("span",{class:"esri-icon-rotate"})))}_toggle(){this.toggle()}};t([l()],kh.prototype,"iconClass",void 0),t([l({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],kh.prototype,"label",void 0),t([l({value:"vertical"})],kh.prototype,"layout",null),t([l(),P("esri/widgets/NavigationToggle/t9n/NavigationToggle")],kh.prototype,"messages",void 0),t([F("viewModel.view")],kh.prototype,"view",void 0),t([l({type:xh})],kh.prototype,"viewModel",void 0),t([Q()],kh.prototype,"_toggle",null),kh=t([e("esri.widgets.NavigationToggle")],kh);const Ah=kh;let Ch=class extends E{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const t=this.enabled?0:-1,e={[this.iconClass]:!!this.iconClass};return S("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{"esri-disabled":!this.enabled,"esri-interactive":this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:t,title:this.title},S("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",e)}),S("span",{class:"esri-icon-font-fallback-text"},this.title))}_triggerAction(){this.action.call(this)}};t([l()],Ch.prototype,"action",void 0),t([l()],Ch.prototype,"enabled",void 0),t([l()],Ch.prototype,"iconClass",void 0),t([l()],Ch.prototype,"title",void 0),t([Q()],Ch.prototype,"_triggerAction",null),Ch=t([e("esri.widgets.IconButton")],Ch);const Oh=Ch;let Th=class extends m{get canZoomIn(){if(!this.get("view.ready"))return!1;const t=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMaxScale");return 0===e||t>e}get canZoomOut(){if(!this.get("view.ready"))return!1;const t=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMinScale");return 0===e||t<e}};t([l({readOnly:!0})],Th.prototype,"canZoomIn",null),t([l({readOnly:!0})],Th.prototype,"canZoomOut",null),t([l()],Th.prototype,"view",void 0),Th=t([e("esri.widgets.Zoom.ZoomConditions2D")],Th);const Fh=Th;let Ph=class extends m{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};t([l({readOnly:!0})],Ph.prototype,"canZoomIn",null),t([l({readOnly:!0})],Ph.prototype,"canZoomOut",null),t([l()],Ph.prototype,"view",void 0),Ph=t([e("esri.widgets.Zoom.ZoomConditions3D")],Ph);const Eh=Ph;let Vh=class extends m{constructor(t){super(t),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(t){t?"2d"===t.type?this._zoomConditions=new Fh({view:t}):"3d"===t.type&&(this._zoomConditions=new Eh({view:t})):this._zoomConditions=null,this._set("view",t)}zoomIn(){if(!this.canZoomIn)return;const t=this.view;"2d"===t.type?t.mapViewNavigation.zoomIn():Ct(t.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const t=this.view;"2d"===t.type?t.mapViewNavigation.zoomOut():Ct(t.goTo({zoomFactor:.5}))}};t([l()],Vh.prototype,"_zoomConditions",void 0),t([l({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],Vh.prototype,"canZoomIn",void 0),t([l({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],Vh.prototype,"canZoomOut",void 0),t([l({readOnly:!0})],Vh.prototype,"state",null),t([l()],Vh.prototype,"view",null),Vh=t([e("esri.widgets.Zoom.ZoomViewModel")],Vh);const Sh=Vh;let Rh=class extends E{constructor(t,e){super(t,e),this.iconClass="esri-icon-zoom-in-magnifying-glass",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new Sh}initialize(){this._zoomInButton=new Oh({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"}),this._zoomOutButton=new Oh({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(t){"horizontal"!==t&&(t="vertical"),this._set("layout",t)}render(){const t=this.viewModel,e={"esri-zoom--horizontal":"horizontal"===this.layout};return this._zoomInButton.enabled="ready"===t.state&&t.canZoomIn,this._zoomOutButton.enabled="ready"===t.state&&t.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,S("div",{class:this.classes("esri-zoom esri-widget",e)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};t([l()],Rh.prototype,"iconClass",void 0),t([l({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Rh.prototype,"label",void 0),t([l({value:"vertical"})],Rh.prototype,"layout",null),t([l(),P("esri/widgets/Zoom/t9n/Zoom")],Rh.prototype,"messages",void 0),t([F("viewModel.view")],Rh.prototype,"view",void 0),t([l({type:Sh})],Rh.prototype,"viewModel",void 0),Rh=t([e("esri.widgets.Zoom")],Rh);const Nh=Rh,Lh="esri.views.ui.DefaultUI";i.getLogger(Lh);let zh=class extends uh{constructor(t){super(t),this._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"},this.components=[]}initialize(){this._handles.add([_(this,"components",this._componentsWatcher.bind(this)),_(this,"view",this._updateViewAwareWidgets.bind(this))])}_add(t,e,i,s){if("string"==typeof t&&this._defaultPositionLookup[t]){if(this._find(t))return;t=this._createComponent(t)}super._add(t,e,i,s)}_removeComponents(t){t.forEach((t=>{const e=this._find(t);e&&(this.remove(e),e.destroy())}))}_updateViewAwareWidgets(t){this.components.forEach((e=>{const i=this._find(e),s=i&&i.widget;(function(t){return t&&void 0!==t.view})(s)&&(s.view=t)}))}_componentsWatcher(t,e){this._removeComponents(e),this._addComponents(t),this._adjustPadding(t)}_adjustPadding(t){if(-1===t.indexOf("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(t){this.initialized&&t.forEach((t=>this.add(this._createComponent(t),this._defaultPositionLookup[t])))}_createComponent(t){const e=this._createWidget(t);if(e)return new ih({id:t,node:e})}_createWidget(t){return"attribution"===t?this._createAttribution():"compass"===t?this._createCompass():"navigation-toggle"===t?this._createNavigationToggle():"zoom"===t?this._createZoom():void 0}_createAttribution(){return new gh({view:this.view})}_createCompass(){return new _h({view:this.view})}_createNavigationToggle(){return new Ah({view:this.view})}_createZoom(){return new Nh({view:this.view})}};t([l()],zh.prototype,"components",void 0),zh=t([e(Lh)],zh);const $h=zh;let jh=class extends $h{constructor(t){super(t),this.components=["attribution","zoom"]}};t([l()],jh.prototype,"components",void 0),jh=t([e("esri.views.ui.2d.DefaultUI2D")],jh);const Dh=jh,Uh=i.getLogger("esri.views.MapView");let qh,Bh,Gh,Hh,Wh,Zh;function Kh(t,e,i){if(t)if(Array.isArray(t)||s.isCollection(t)){if(0===t.length)return;t.forEach((t=>Kh(t,e,i)))}else!function(t){return t instanceof qt}(t)?i.add(t):e.add(t)}let Jh=class extends(ys(Hr(ol))){constructor(t){super(t),this._magnifierView=null,this._stage=null,this._resolveWhenReady=[],this.rootLayerViews=new ye({getCollections:()=>{var t,e;return[null==(t=this.basemapView)?void 0:t.baseLayerViews,this.layerViews,null==(e=this.basemapView)?void 0:e.referenceLayerViews]},getChildrenFunction:()=>null}),this.floors=new s,this.graphicsView=null,this.highlightOptions=new Xl,this.inputManager=new Jl({view:this}),this.mapViewNavigation=null,this.supersampleScreenshotsEnabled=!1,this.ui=new Dh,this.rendering=!1,be()}destroy(){this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get background(){return this.get("map.initialViewProperties.background")||null}set background(t){void 0===t?this._clearOverride("background"):this._override("background",t)}get textureManager(){return this._stage.painter.textureManager}get navigating(){return!(!this.mapViewNavigation||!this.mapViewNavigation.interacting)}toMap(t){if(po(t)){const e=co(this,t);return super.toMap(e)}return super.toMap(t)}hitTest(t,e){const i=po(t)?co(this,t):t;if(!this.ready||isNaN(i.x)||isNaN(i.y))return Promise.resolve({screenPoint:i,results:[]});const s=this.toMap(i),n=[this.graphicsView];n.push.apply(n,this.allLayerViews.toArray().reverse());const r=new Set,o=new Set,a=new Set,l=new Set;return e&&(Kh(e&&e.include,r,a),Kh(e&&e.exclude,o,l)),Promise.all(n.map((t=>!t||!t.hitTest||a.size>0&&!t.layer||a.size>0&&t.layer&&!a.has(t.layer)||l.size>0&&t.layer&&l.has(t.layer)?null:t.hitTest(i.x,i.y)))).then((t=>({screenPoint:i,results:t.filter((t=>null!=t&&(!(r.size>0)||r.has(t))&&(!(o.size>0)||!o.has(t)))).map((t=>({mapPoint:s,graphic:t})))})))}takeScreenshot(t){if(t=t||{},!this.ready)return Promise.reject("Map view cannot be used before it is ready");const e=this.supersampleScreenshotsEnabled?Math.min(4,$i(this.size,Math.min(4096,this._stage.context.parameters.maxTextureSize))):1;let i;t.layers?(i=[],t.layers.forEach((t=>{const e=this.allLayerViews.find((e=>e.layer.id===t.id));e&&"container"in e&&e.container&&i.push(e.container)}))):i=this._stage.children;const{format:s,quality:n}=ji(t.format,t.quality),r=function(t,e,i,s,n,r,o,a){let l;t.ignorePadding&&(s={left:0,right:0,top:0,bottom:0}),null!=t.width&&null!=t.height?l=[t.width,t.height]:null==t.width&&null!=t.height?l=[t.height,t.height]:null!=t.width&&null==t.height?l=[t.width,t.width]:null==t.width&&null==t.height&&(l=null);const h=i[0]-(s.left+s.right),u=i[1]-(s.top+s.bottom);let c,d,p=t.area||{x:0,y:0,width:h,height:u};if(l){const t=l[0]/l[1];if(t>h/u){const e=p.width/t;p={x:p.x,y:Math.round(p.y+(p.height-e)/2),width:p.width,height:Math.round(e)}}else{const e=p.height*t;p={x:Math.round(p.x+(p.width-e)/2),y:p.y,width:Math.round(e),height:p.height}}}else l=[p.width,p.height];return l[0]>p.width?(c=Math.min(l[0]/p.width,e),d=l[0]/p.width/c):(c=1,d=l[0]/p.width),{resolutionScale:c,cropArea:{x:Math.round((p.x+s.left)*c),y:Math.round((p.y+s.top)*c),width:Math.round(p.width*c),height:Math.round(p.height*c)},outputScale:d,format:n,quality:r,children:o,rotation:a}}(t,e,this.size,this.padding,s,n,i,t.rotation);return this._stage.takeScreenshot(r)}on(t,e,i,s){return this.inputManager&&this.viewEvents.on(t,e,i,s)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}whenLayerView(t){return super.whenLayerView(t)}graphicChanged(t){this.graphicsView&&this.graphicsView.graphicUpdateHandler(t)}whenReady(){return new Promise((t=>{this.ready?t(this):this._resolveWhenReady.push(t)}))}forceDOMReadyCycle(){this.forceReadyCycle()}validate(){let t=function(t){t={...th,...t};const e=Di();return e.available?t.checkMajorWebPerformanceCaveat&&e.majorPerformanceCaveat?new n("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?e.supportsElementIndexUint?e.supportsStandardDerivatives?e.supportsInstancedArrays?null:new n("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new n("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new n("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new n("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new n("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new n("webgl:required","WebGL is required but not supported.")}({checkMajorWebPerformanceCaveat:!1});return Z("safari")&&Z("safari")<9&&(t=new n("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:Z("safari")})),y(t)?(Uh.warn("#validate()",t.message),Promise.reject(t)):async function(){const[,{GraphicsView2D:t,GraphicContainer:e,LabelManager:i,MapViewNavigation:s,MagnifierView2D:n,Stage:r}]=await Promise.all([import("./p-3392c85e.js"),import("./p-339711c7.js")]);Bh=t,Gh=e,Hh=i,Wh=s,Zh=n,qh=r}()}_startup(){this.timeline.begin("MapView Startup"),super._startup(),this.graphics.owner=this;const t=new qh(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenshotsEnabled,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline}),e=new Bh({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new Gh(this.featuresTilingScheme)}),i=new Wh({view:this,animationManager:this.animationManager}),s=new Hh({view:this});this._magnifierView=new Zh,this._magnifierView.magnifier=this.magnifier,this._stage=t,this.frameTask.graphicsView=e,this._set("graphicsView",e),this._set("mapViewNavigation",i),this._set("labelManager",s),this.handles.add([this.rootLayerViews.on("change",(()=>this._updateStageChildren())),t.on("post-render",(()=>this._set("rendering",t.renderRequested))),t.on("will-render",(()=>this._set("rendering",t.renderRequested))),t.on("webgl-error",(t=>this.fatalError=t.error)),_(this,"stationary",(e=>t.stationary=e),!0),_(this,"state.id",(()=>t.state=this.state),!0),_(this,"background",(e=>{t.background=e,this._magnifierView.background=e}),!0),_(this,"magnifier",(t=>this._magnifierView.magnifier=t),!0),_(this,"renderingOptions",(e=>t.renderingOptions=e),!0),_(this,"highlightOptions",(()=>t.highlightOptions=this.highlightOptions),!0)],"map-view"),t.state=this.state,this._updateStageChildren();const n=this._resolveWhenReady;this._resolveWhenReady=[],n.forEach((t=>t(this))),this.timeline.end("MapView Startup")}_teardown(){this.handles.remove("map-view"),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._stage.destroy(),this.graphicsView.destroy(),this.mapViewNavigation.destroy(),this._stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,super._teardown()}_updateStageChildren(){this._stage.removeAllChildren(),this.rootLayerViews.forEach((t=>{this._stage.addChild(t.container)})),this._stage.addChild(this.graphicsView.container),this._stage.addChild(this._magnifierView)}};t([l({type:ms})],Jh.prototype,"background",null),t([l()],Jh.prototype,"floors",void 0),t([l()],Jh.prototype,"graphicsView",void 0),t([l({type:Xl})],Jh.prototype,"highlightOptions",void 0),t([l({readOnly:!0})],Jh.prototype,"inputManager",void 0),t([l({readOnly:!0})],Jh.prototype,"textureManager",null),t([l({readOnly:!0})],Jh.prototype,"mapViewNavigation",void 0),t([l({type:Boolean})],Jh.prototype,"navigating",null),t([l({type:Boolean,constructOnly:!0})],Jh.prototype,"supersampleScreenshotsEnabled",void 0),t([l({type:Dh})],Jh.prototype,"ui",void 0),t([l({readOnly:!0})],Jh.prototype,"rendering",void 0),t([l({constructOnly:!0})],Jh.prototype,"renderCanvas",void 0),t([l({constructOnly:!0})],Jh.prototype,"deactivatedWebGLExtensions",void 0),t([l({constructOnly:!0})],Jh.prototype,"debugWebGLExtensions",void 0),Jh=t([e("esri.views.MapView")],Jh);const Yh=Jh;export{ra as $,Aa as F,Yh as G,ya as M,Xi as S,sl as a,Ms as b,br as c,Qi as d,Jo as e,Ma as f,Za as g,rs as j,ca as l,ms as m,Wa as n,fa as p,aa as r,ds as u,xa as v,ma as x}