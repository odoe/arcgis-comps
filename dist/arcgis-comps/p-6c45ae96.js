import{bz as e,bH as t,bi as o,bI as r,D as n}from"./p-566b0715.js";import{v as i,m as l,aW as a}from"./p-9ae46e68.js";import{t as s,o as c,E as f,l as u}from"./p-128c292d.js";import{l as m,e as h,a as d}from"./p-9e860e7b.js";import{q as y,C as S,B as M,v as p}from"./p-685003b3.js";function b(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":{const t=e.symbolLayers;return t&&1===t.length?b(t[0]):null}case"CIMVectorMarker":{const t=e.markerGraphics;if(!t||1!==t.length)return null;const o=t[0];if(!o)return null;const r=o.geometry;if(!r)return null;const n=o.symbol;return!n||"CIMPolygonSymbol"!==n.type&&"CIMLineSymbol"!==n.type?null:{geom:r,asFill:"CIMPolygonSymbol"===n.type}}case"sdf":return{geom:e.geom,asFill:e.asFill}}return null}function C(e){let t=1/0,o=-1/0,r=1/0,n=-1/0;for(const i of e)for(const e of i)e[0]<t&&(t=e[0]),e[0]>o&&(o=e[0]),e[1]<r&&(r=e[1]),e[1]>n&&(n=e[1]);return new s(t,r,o-t,n-r)}function O(e){let t=1/0,o=-1/0,r=1/0,n=-1/0;for(const i of e)for(const e of i)e[0]<t&&(t=e[0]),e[0]>o&&(o=e[0]),e[1]<r&&(r=e[1]),e[1]>n&&(n=e[1]);return[t,r,o,n]}function g(t){return t?t.rings?O(t.rings):t.paths?O(t.paths):e(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function k(e,t,o,r,n){const[i,l,a,s]=e;if(a<i||s<l)return[0,0,0];const c=a-i,f=s-l,u=Math.floor(31.5),m=(128-2*(u+1))/Math.max(c,f),h=Math.round(c*m)+2*u,d=Math.round(f*m)+2*u;let y=1;t&&(y=d/m/(t.ymax-t.ymin));let S=0,M=0;return r&&(n?t&&o&&t.ymax-t.ymin>0&&(S=r.x/(o*((t.xmax-t.xmin)/(t.ymax-t.ymin))),M=r.y/o):(S=r.x,M=r.y)),S=.5*(t.xmax+t.xmin)+S*(t.xmax-t.xmin),M=.5*(t.ymax+t.ymin)+M*(t.ymax-t.ymin),S-=i,M-=l,S*=m,M*=m,S+=u,M+=u,[y,S/h-.5,-(M/d-.5)]}function I(e){const t=function(e){return e?e.rings?e.rings:e.paths?e.paths:void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:null}(e.geom),o=C(t),r=Math.floor(31.5),n=(128-2*(r+1))/Math.max(o.width,o.height),i=Math.round(o.width*n)+2*r,l=Math.round(o.height*n)+2*r,a=[];for(const i of t)if(i&&i.length>1){const t=[];for(const l of i){let[i,a]=l;i-=o.x,a-=o.y,i*=n,a*=n,i+=r-.5,a+=r-.5,t.push(e.asFill?[i,a]:[Math.round(i),Math.round(a)])}if(e.asFill){const e=t.length-1;t[0][0]===t[e][0]&&t[0][1]===t[e][1]||t.push(t[0])}a.push(t)}const s=function(e,t,o,r){const n=t*o,i=new Array(n),l=r*r+1;for(let e=0;e<n;++e)i[e]=l;for(const n of e){const e=n.length;for(let l=1;l<e;++l){const e=n[l-1],a=n[l];let s,c,f,u;e[0]<a[0]?(s=e[0],c=a[0]):(s=a[0],c=e[0]),e[1]<a[1]?(f=e[1],u=a[1]):(f=a[1],u=e[1]);let m=Math.floor(s)-r,h=Math.floor(c)+r,d=Math.floor(f)-r,y=Math.floor(u)+r;m<0&&(m=0),h>t&&(h=t),d<0&&(d=0),y>o&&(y=o);const S=a[0]-e[0],M=a[1]-e[1],p=S*S+M*M;for(let r=m;r<h;r++)for(let n=d;n<y;n++){let l,s,c=(r-e[0])*S+(n-e[1])*M;c<0?(l=e[0],s=e[1]):c>p?(l=a[0],s=a[1]):(c/=p,l=e[0]+c*S,s=e[1]+c*M);const f=(r-l)*(r-l)+(n-s)*(n-s),u=(o-n-1)*t+r;f<i[u]&&(i[u]=f)}}}for(let e=0;e<n;++e)i[e]=Math.sqrt(i[e]);return i}(a,i,l,r);return e.asFill&&function(e,t,o,r,n){for(const i of e){const e=i.length;for(let l=1;l<e;++l){const e=i[l-1],a=i[l];let s,c,f,u;e[0]<a[0]?(s=e[0],c=a[0]):(s=a[0],c=e[0]),e[1]<a[1]?(f=e[1],u=a[1]):(f=a[1],u=e[1]);let m=Math.floor(s),h=Math.floor(c)+1,d=Math.floor(f),y=Math.floor(u)+1;m<r&&(m=r),h>t-r&&(h=t-r),d<r&&(d=r),y>o-r&&(y=o-r);for(let i=d;i<y;++i){if(e[1]>i==a[1]>i)continue;const l=(o-i-1)*t;for(let t=m;t<h;++t)t<(a[0]-e[0])*(i-e[1])/(a[1]-e[1])+e[0]&&(n[l+t]=-n[l+t]);for(let e=r;e<m;++e)n[l+e]=-n[l+e]}}}}(a,i,l,r,s),[P(s,r),i,l]}function P(e,t){const o=2*t,r=e.length,n=new Uint8Array(4*r);for(let t=0;t<r;++t)c(.5-e[t]/o,n,4*t);return n}function v(e,t,o,r,n){const l=e.referencesGeometry()&&n?J(t,r,n):t,a=e.repurposeFeature(l);try{return e.evaluate({...o,$feature:a})}catch(e){return i.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}const N=new Map;function J(e,t,o){const{transform:r,hasZ:n,hasM:a}=o;N.has(t)||N.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,o,r,n)=>p(o,t,e,r,n);case"esriGeometryPolygon":return(e,o,r,n)=>M(o,t,e,r,n);case"esriGeometryPolyline":return(e,o,r,n)=>S(o,t,e,r,n);case"esriGeometryMultipoint":return(e,o,r,n)=>y(o,t,e,r,n);default:return i.getLogger("esri.views.2d.support.arcadeOnDemand").error(new l("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const s=N.get(t)(e.geometry,r,n,a);return{...e,geometry:s}}const w=i.getLogger("esri.symbols.cim.cimAnalyzer");function H(e){switch(e){case"Butt":return 0;case"Square":return 2;default:return 1}}function X(e){switch(e){case"Bevel":return 0;case"Miter":return 2;default:return 1}}function z(e){switch(e){default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function L(e){switch(e){default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function $(e,t,o,r){let n;e[t]?n=e[t]:(n={},e[t]=n),n[o]=r}function Y(e){const t=e.markerPlacement;return t&&t.angleToLine?1:0}async function R(e,o,r,n,i){const l=null!=n?n:[];if(!e)return l;let a,s;const c={};if("CIMSymbolReference"!==e.type)return w.error("Expect cim type to be 'CIMSymbolReference'"),l;if(a=e.symbol,s=e.primitiveOverrides,s){const e=[];for(const r of s){const n=r.valueExpressionInfo;if(n&&o){const i=t(n.expression,o.spatialReference,o.fields).then((e=>{e&&$(c,r.primitiveName,r.propertyName,e)}));e.push(i)}else null!=r.value&&$(c,r.primitiveName,r.propertyName,r.value)}e.length>0&&await Promise.all(e)}const m=[];switch(oe(a,r,m),m.length>0&&await Promise.all(m),a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":!function(e,t,o,r,n,i,l){if(!e)return;const a=e.symbolLayers;if(!a)return;const s=e.effects;let c;const m=f.getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(c=1);let h=a.length;for(;h--;){const f=a[h];if(!f||!1===f.enable)continue;let d;s&&s.length&&(d=[...s]);const y=f.effects;y&&y.length&&(s?d.push(...y):d=[...y]);const S=[];switch(u.findApplicableOverrides(f,t,S),f.type){case"CIMSolidFill":A(f,d,o,S,r,n);break;case"CIMPictureFill":F(f,d,o,S,r,n);break;case"CIMHatchFill":W(f,d,o,S,r,n);break;case"CIMGradientFill":x(f,d,o,S,r,n);break;case"CIMSolidStroke":G(f,d,o,S,r,n,"CIMPolygonSymbol"===e.type,m);break;case"CIMPictureStroke":j(f,d,o,S,r,n,"CIMPolygonSymbol"===e.type,m);break;case"CIMGradientStroke":D(f,d,o,S,r,n,"CIMPolygonSymbol"===e.type,m);break;case"CIMCharacterMarker":if(T(f,d,o,S,r,n))break;break;case"CIMPictureMarker":if(T(f,d,o,S,r,n))break;"CIMLineSymbol"===e.type&&(c=Y(f)),B(f,d,o,S,r,n,c,m);break;case"CIMVectorMarker":if(T(f,d,o,S,r,n))break;"CIMLineSymbol"===e.type&&(c=Y(f)),q(f,d,o,S,r,n,i,c,m,l);break;default:w.error("Cannot analyze CIM layer",f.type)}}}(a,s,c,o,l,r,i)}return l}function A(e,t,o,r,n,i){const l=e.primitiveName,s=m(e.color),[c,f]=te(r,l),u=a(JSON.stringify(e)+f).toString();i.push({type:"fill",templateHash:u,materialHash:c?()=>u:u,cim:e,materialOverrides:null,colorLocked:e.colorLocked,color:K(l,o,"Color",n,s,_),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:t})}function F(e,t,o,r,n,i){const l=e.primitiveName,s=e.tintColor?m(e.tintColor):{r:255,g:255,b:255,a:1},[c,f]=te(r,l),u=a(JSON.stringify(e)+f).toString(),h=a(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString();i.push({type:"fill",templateHash:u,materialHash:c?()=>h:h,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,color:K(l,o,"TintColor",n,s,_),height:K(l,o,"Height",n,e.height),scaleX:K(l,o,"ScaleX",n,e.scaleX),angle:K(l,o,"Rotation",n,e.rotation),offsetX:K(l,o,"OffsetX",n,e.offsetX),offsetY:K(l,o,"OffsetY",n,e.offsetY),url:e.url})}function W(e,t,o,r,n,i){const l=["Rotation","OffsetX","OffsetY"],s=r.filter((t=>t.primitiveName!==e.primitiveName&&-1===l.indexOf(t.propertyName))),c=e.primitiveName,[f,u]=te(r,c),m=a(JSON.stringify(e)+u).toString(),h=a(`${e.separation}${JSON.stringify(e.lineSymbol)}`).toString();i.push({type:"fill",templateHash:m,materialHash:f?Q(h,o,s,n):h,cim:e,materialOverrides:s,colorLocked:e.colorLocked,effects:t,color:{r:255,g:255,b:255,a:1},height:K(c,o,"Separation",n,e.separation),scaleX:1,angle:K(c,o,"Rotation",n,e.rotation),offsetX:K(c,o,"OffsetX",n,e.offsetX),offsetY:K(c,o,"OffsetY",n,e.offsetY)})}function x(e,t,o,r,n,i){const l=e.primitiveName,[s,c]=te(r,l),f=a(JSON.stringify(e)+c).toString();i.push({type:"fill",templateHash:f,materialHash:s?Q(f,o,r,n):f,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function G(e,t,o,r,n,i,l,s){const c=e.primitiveName,f=m(e.color),u=void 0!==e.width?e.width:4,h=H(e.capStyle),d=X(e.joinStyle),y=e.miterLimit,[S,M]=te(r,c),p=a(JSON.stringify(e)+M).toString();let b,C;if(t&&t.length>0){const o=t[t.length-1];if("CIMGeometricEffectDashes"===o.type&&"NoConstraint"===o.lineDashEnding){const o=(t=[...e.effects]).pop();b=o.dashTemplate,C=o.scaleDash}}i.push({type:"line",templateHash:p,materialHash:S?()=>p:p,cim:e,materialOverrides:null,isOutline:l,colorLocked:e.colorLocked,effects:t,color:K(c,o,"Color",n,f,_),width:K(c,o,"Width",n,u),cap:K(c,o,"CapStyle",n,h),join:K(c,o,"JoinStyle",n,d),miterLimit:K(c,o,"MiterLimit",n,y),referenceWidth:s,zOrder:Z(e.name),dashTemplate:b,scaleDash:C})}function j(e,t,o,r,n,i,l,s){const c=a(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),f=e.primitiveName,u=m(e.tintColor),h=void 0!==e.width?e.width:4,d=H(e.capStyle),y=X(e.joinStyle),S=e.miterLimit,[M,p]=te(r,f),b=a(JSON.stringify(e)+p).toString();i.push({type:"line",templateHash:b,materialHash:M?()=>c:c,cim:e,materialOverrides:null,isOutline:l,colorLocked:e.colorLocked,effects:t,color:K(f,o,"TintColor",n,u,_),width:K(f,o,"Width",n,h),cap:K(f,o,"CapStyle",n,d),join:K(f,o,"JoinStyle",n,y),miterLimit:K(f,o,"MiterLimit",n,S),referenceWidth:s,zOrder:Z(e.name),dashTemplate:null,scaleDash:!1,url:e.url})}function D(e,t,o,r,n,i,l,s){const c=e.primitiveName,f=void 0!==e.width?e.width:4,u=H(e.capStyle),m=X(e.joinStyle),h=e.miterLimit,[d,y]=te(r,c),S=a(JSON.stringify(e)+y).toString();i.push({type:"line",templateHash:S,materialHash:d?Q(S,o,r,n):S,cim:e,materialOverrides:null,isOutline:l,colorLocked:e.colorLocked,effects:t,color:{r:128,g:128,b:128,a:1},width:K(c,o,"Width",n,f),cap:K(c,o,"CapStyle",n,u),join:K(c,o,"JoinStyle",n,m),miterLimit:K(c,o,"MiterLimit",n,h),referenceWidth:s,zOrder:Z(e.name),dashTemplate:null,scaleDash:!1})}function T(e,t,o,r,n,i){const l=e.markerPlacement;if(!l||"CIMMarkerPlacementInsidePolygon"!==l.type)return!1;const s=l,c=["Rotation","OffsetX","OffsetY"],f=r.filter((t=>t.primitiveName!==e.primitiveName&&-1===c.indexOf(t.propertyName))),u="url"in e?e.url:null,[m,h]=te(r,s.primitiveName),d=a(JSON.stringify(e)+h).toString();let y=s.stepY,S=null,M=1;return l.shiftOddRows&&(y*=2,S=function(e){return e?2*e:0},M=.5),i.push({type:"fill",templateHash:d,materialHash:m?Q(d,o,f,n):d,cim:e,materialOverrides:f,colorLocked:e.colorLocked,effects:t,color:{r:255,g:255,b:255,a:1},height:K(s.primitiveName,o,"StepY",n,y,S),scaleX:M,angle:K(s.primitiveName,o,"GridAngle",n,s.gridAngle),offsetX:K(s.primitiveName,o,"OffsetX",n,s.offsetX),offsetY:K(s.primitiveName,o,"OffsetY",n,s.offsetY),url:u}),!0}function B(e,t,o,r,n,i,l,s){var c;const f=e.primitiveName,u=e.size,h=e.scaleX,d=e.rotation,y=e.offsetX,S=e.offsetY,M=e.tintColor?m(e.tintColor):{r:255,g:255,b:255,a:1},p=a(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),[b,C]=te(r,f),O=a(JSON.stringify(e)+C).toString(),g=null!=(c=e.anchorPoint)?c:{x:0,y:0};i.push({type:"marker",templateHash:O,materialHash:b?()=>p:p,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:!1,alignment:l,size:K(f,o,"Size",n,u),scaleX:K(f,o,"ScaleX",n,h),rotation:K(f,o,"Rotation",n,d),offsetX:K(f,o,"OffsetX",n,y),offsetY:K(f,o,"OffsetY",n,S),color:K(f,o,"TintColor",n,M,_),anchorPoint:{x:g.x,y:-g.y},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:e.rotateClockwise,referenceSize:s,sizeRatio:1,markerPlacement:e.markerPlacement,url:e.url})}function q(e,t,o,r,n,i,l,a,s,c){const f=e.markerGraphics;if(!f)return;let u=0;if(e.scaleSymbolsProportionally){const t=e.frame;t&&(u=t.ymax-t.ymin)}for(const m of f)if(m){const f=m.symbol;if(!f)continue;switch(f.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":U(e,t,m,r,o,n,i,l,a,s,u,c);break;case"CIMTextSymbol":E(e,t,m,o,r,n,i,a,s,u)}}}function E(e,t,o,r,n,i,l,s,c,y){u.findApplicableOverrides(o,n,[]);const S=o.geometry;if(!("x"in S)||!("y"in S))return;const M=o.symbol,p=function(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}(M),b=function(e){let t="normal",o="normal";if(e){const r=e.toLowerCase();-1!==r.indexOf("italic")?t="italic":-1!==r.indexOf("oblique")&&(t="oblique"),-1!==r.indexOf("bold")?o="bold":-1!==r.indexOf("light")&&(o="lighter")}return{style:t,weight:o}}(M.fontStyleName);M.font={family:M.fontFamilyName,decoration:p,...b};const C=e.frame,O=e.size/y,g=e.primitiveName,k=(M.height||0)*O,I=M.angle||0,P=((M.offsetX||0)+(S.x-.5*(C.xmin+C.xmax)))*O,v=((M.offsetY||0)+(S.y-.5*(C.ymin+C.ymax)))*O,N=m(f.getFillColor(M));let J=m(f.getStrokeColor(M)),w=f.getStrokeWidth(M);w||(J=m(f.getFillColor(M.haloSymbol)),w=M.haloSize*O);const[H,X]=te(n,g),$=JSON.stringify(e.effects)+Number(e.colorLocked)+JSON.stringify(e.anchorPoint)+e.anchorPointUnits+JSON.stringify(e.markerPlacement),Y=a(JSON.stringify(o)+$+X).toString(),R=a(JSON.stringify(M.font)).toString(),A=K(o.primitiveName,r,"TextString",i,o.textString,d,M.textCase),{fontFamilyName:F,fontStyleName:W}=M,x=F.toLowerCase()+(W&&W.length>0?"-"+W.toLowerCase():"-regular");l.push({type:"text",templateHash:Y,materialHash:H||"function"==typeof A||A.match(/\[([\w]+)\]/)?(e,t,o)=>R+"-"+h(A,e,t,o):R+"-"+a(A),cim:M,materialOverrides:null,colorLocked:e.colorLocked,effects:t,alignment:s,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:x,decoration:p,weight:K(g,r,"Weight",i,b.weight),style:K(g,r,"Size",i,b.style),size:K(g,r,"Size",i,k),angle:K(g,r,"Rotation",i,I),offsetX:K(g,r,"OffsetX",i,P),offsetY:K(g,r,"OffsetY",i,v),horizontalAlignment:z(M.horizontalAlignment),verticalAlignment:L(M.verticalAlignment),text:A,color:N,outlineColor:J,outlineSize:w,referenceSize:c,sizeRatio:1,markerPlacement:e.markerPlacement})}function U(e,t,o,r,n,i,l,s,c,u,h,d){const y=o.geometry;if(!y)return;const S=o.symbol.symbolLayers;if(!S)return;if(d)return void V(e,t,o,n,r,i,l,s,c,u,h);let M=S.length;if(2!==M||!S[0].enable||!S[1].enable||"CIMSolidStroke"!==S[0].type||"CIMSolidFill"!==S[1].type||S[0].effects||S[1].effects)for(;M--;){const d=S[M];if(d&&!1!==d.enable)switch(d.type){case"CIMSolidFill":case"CIMSolidStroke":{var p,b,C,O;const s=g(y);if(!s)continue;const[S,M,I]=k(s,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),P="CIMSolidFill"===d.type,v={type:"sdf",geom:y,asFill:P},N=e.primitiveName,J=null!=(p=e.size)?p:10,w=null!=(b=e.rotation)?b:0,H=null!=(C=e.offsetX)?C:0,X=null!=(O=e.offsetY)?O:0,z=d.path,L=d.primitiveName,$=m(P?f.getFillColor(d):f.getStrokeColor(d)),Y=P?{r:0,g:0,b:0,a:0}:m(f.getStrokeColor(d)),R=f.getStrokeWidth(d);if(!P&&!R)break;let A=!1,F="";for(const e of r)e.primitiveName!==L&&e.primitiveName!==N||(void 0!==e.value?F+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(A=!0));const W=JSON.stringify({...e,markerGraphics:null}),x=a(JSON.stringify(v)+z).toString(),G={type:"marker",templateHash:a(JSON.stringify(o)+JSON.stringify(d)+W+F).toString(),materialHash:A?()=>x:x,cim:v,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:c,anchorPoint:{x:M,y:I},isAbsoluteAnchorPoint:!1,size:K(e.primitiveName,n,"Size",i,J),rotation:K(e.primitiveName,n,"Rotation",i,w),offsetX:K(e.primitiveName,n,"OffsetX",i,H),offsetY:K(e.primitiveName,n,"OffsetY",i,X),scaleX:1,frameHeight:h,rotateClockwise:e.rotateClockwise,referenceSize:u,sizeRatio:S,color:K(L,n,"Color",i,$,_),outlineColor:K(L,n,"Color",i,Y,_),outlineWidth:K(L,n,"Width",i,R),markerPlacement:e.markerPlacement,path:z};l.push(G);break}default:V(e,t,o,n,r,i,l,s,c,u,h)}}else!function(e,t,o,r,n,i,l,s,c,u){const h=t.geometry,d=o[0],y=o[1],S=g(h);if(!S)return;const[M,p,b]=k(S,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),C={type:"sdf",geom:h,asFill:!0},O=e.primitiveName,I=e.size,P=e.rotation||0,v=e.offsetX,N=e.offsetY,J=y.path,w=y.primitiveName,H=d.primitiveName,X=m(f.getFillColor(y)),z=m(f.getStrokeColor(d)),L=f.getStrokeWidth(d);let $=!1,Y="";for(const e of r)e.primitiveName!==w&&e.primitiveName!==H&&e.primitiveName!==O||(void 0!==e.value?Y+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&($=!0));const R=JSON.stringify({...e,markerGraphics:null}),A=a(JSON.stringify(C)+J).toString(),F={type:"marker",templateHash:a(JSON.stringify(t)+JSON.stringify(y)+JSON.stringify(d)+R+Y).toString(),materialHash:$?()=>A:A,cim:C,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:p,y:b},isAbsoluteAnchorPoint:!1,size:K(e.primitiveName,n,"Size",i,I),rotation:K(e.primitiveName,n,"Rotation",i,P),offsetX:K(e.primitiveName,n,"OffsetX",i,v),offsetY:K(e.primitiveName,n,"OffsetY",i,N),scaleX:1,frameHeight:u,rotateClockwise:e.rotateClockwise,referenceSize:c,sizeRatio:M,color:K(w,n,"Color",i,X,_),outlineColor:K(H,n,"Color",i,z,_),outlineWidth:K(H,n,"Width",i,L),markerPlacement:e.markerPlacement,path:J};l.push(F)}(e,o,S,r,n,i,l,c,u,h)}function V(e,t,r,n,i,l,s,c,u,m,h){const d=function(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath,effects:e.effects}}(e,r);let y=[];const S=["Rotation","OffsetX","OffsetY"];y=i.filter((t=>t.primitiveName!==e.primitiveName||-1===S.indexOf(t.propertyName)));let M="";for(const e of i)void 0!==e.value&&(M+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`);const[p,b,C]=f.getTextureAnchor(d,c),O=e.primitiveName,g=e.rotation||0,k=e.offsetX||0,I=e.offsetY||0,P=a(JSON.stringify(d)+M).toString(),v={type:"marker",templateHash:P,materialHash:0===y.length?P:Q(P,n,y,l),cim:d,materialOverrides:y,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:u,anchorPoint:{x:p,y:b},isAbsoluteAnchorPoint:!1,size:e.size,rotation:K(O,n,"Rotation",l,g),offsetX:K(O,n,"OffsetX",l,k),offsetY:K(O,n,"OffsetY",l,I),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:h,rotateClockwise:e.rotateClockwise,referenceSize:m,sizeRatio:C/o(e.size),markerPlacement:e.markerPlacement};s.push(v)}function Z(e){if(e&&0===e.indexOf("Level_")){const t=parseInt(e.substr(6),10);if(NaN!==t)return t}return 0}function _(e){if(!e||0===e.length)return null;const t=new n(e).toRgba();return{r:t[0],g:t[1],b:t[2],a:t[3]}}function K(e,t,o,n,i,l,a){const s=t[e];if(s){const e=s[o];if("string"==typeof e||"number"==typeof e||e instanceof Array)return l?l.call(null,e,a):e;if(null!=e&&e instanceof r)return(t,o,r)=>{let s=v(e,t,{$view:r},n.geometryType,o);return null!==s&&l&&(s=l.call(null,s,a)),null!==s?s:i}}return i}function Q(e,t,o,n){for(const e of o)if(e.valueExpressionInfo){const o=t[e.primitiveName]&&t[e.primitiveName][e.propertyName];o instanceof r&&(e.fn=(e,t,r)=>v(o,e,{$view:r},n.geometryType,t))}return(t,r,n)=>{for(const e of o)e.fn&&(e.value=e.fn(t,r,n));return a(e+u.buildOverrideKey(o)).toString()}}function ee(e,t){if(!t||0===t.length)return e;const o=JSON.parse(JSON.stringify(e));return u.applyOverrides(o,t),o}function te(e,t){let o=!1,r="";for(const n of e)n.primitiveName===t&&(void 0!==n.value?r+=`-${n.primitiveName}-${n.propertyName}-${JSON.stringify(n.value)}`:n.valueExpressionInfo&&(o=!0));return[o,r]}function oe(e,t,o){if(e&&t)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=e.symbolLayers;if(!r)return;for(const e of r)switch(e.type){case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMCharacterMarker":case"CIMPictureMarker":"url"in e&&e.url&&o.push(t.fetchResource(e.url,null));break;case"CIMVectorMarker":{const r=e.markerGraphics;if(!r)continue;for(const e of r)if(e){const r=e.symbol;r&&oe(r,t,o)}}}}}}export{R as C,ee as G,I as m,b as r,v as s}