import{e,i as t,s,A as r}from"./p-e58503d5.js";import{I as o,w as p}from"./p-765e6c28.js";import{d as a,t as i}from"./p-e285e8f3.js";const n=n=>{let u=class extends n{_validateFetchPopupFeatures(e){const{layer:t}=this,{popupEnabled:r}=t;return r?a(t,e)?void 0:new s("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new s("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t})}async prepareFetchPopupFeatures(e){}async fetchPopupFeatures(e,t){const s=this._validateFetchPopupFeatures(t);if(s)return Promise.reject(s);const n=r(t)?t.clientGraphics:null;if(!n||0===n.length)return Promise.resolve([]);const u="scene"===this.layer.type&&r(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,c=o(this.layer.fieldsIndex,await i(u,a(this.layer,t)));await this.prepareFetchPopupFeatures(c);const h=new Set,l=[],d=[];for(const e of n)p(c,e,h)?d.push(e):l.push(e);return 0===d.length?Promise.resolve(l):this.whenGraphicAttributes(d,[...h]).catch((()=>d)).then((e=>l.concat(e)))}};return u=e([t("esri.views.3d.layers.support.PopupSceneLayerView")],u),u};export{n as c}