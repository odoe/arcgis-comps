import{i5 as o,k as e,E as n,l as s,cd as t,b7 as r,bu as i,f_ as c,fW as f,i6 as l,fX as a,cJ as y,b3 as m,bA as u}from"./p-5420851c.js";const G={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function p(o){const e=o.folders||[],n=e.slice(),t=new Map,r=new Map,i=new Map,c=new Map,f=new Map,l={esriGeometryPoint:r,esriGeometryPolyline:i,esriGeometryPolygon:c};(o.featureCollection&&o.featureCollection.layers||[]).forEach((o=>{const e=s(o);e.featureSet.features=[];const n=o.featureSet.geometryType;t.set(n,e);const f=o.layerDefinition.objectIdField;"esriGeometryPoint"===n?b(r,f,o.featureSet.features):"esriGeometryPolyline"===n?b(i,f,o.featureSet.features):"esriGeometryPolygon"===n&&b(c,f,o.featureSet.features)})),o.groundOverlays&&o.groundOverlays.forEach((o=>{f.set(o.id,o)})),e.forEach((e=>{e.networkLinkIds.forEach((s=>{const t=function(o,e,n){const s=function(o,e){let n;return e.some((e=>e.id===o&&(n=e,!0))),n}(o,n);return s&&(s.parentFolderId=e,s.networkLink=s),s}(s,e.id,o.networkLinks);t&&n.push(t)}))})),n.forEach((o=>{if(o.featureInfos){o.points=s(t.get("esriGeometryPoint")),o.polylines=s(t.get("esriGeometryPolyline")),o.polygons=s(t.get("esriGeometryPolygon")),o.mapImages=[];for(const e of o.featureInfos)switch(e.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const n=l[e.type].get(e.id);n&&o[G[e.type]].featureSet.features.push(n);break}case"GroundOverlay":{const n=f.get(e.id);n&&o.mapImages.push(n);break}}o.fullExtent=x([o])}}));const a=x(n);return{folders:e,sublayers:n,extent:a}}function P(o,e,s,c){const f=t&&t.findCredential(o);return o=r(o,{token:f&&f.token}),n(i.kmlServiceUrl,{query:{url:o,model:"simple",folders:"",refresh:0!==s||void 0,outSR:JSON.stringify(e)},responseType:"json",signal:c})}function w(o,e,n=null,s=[]){const t=[],r={},i=e.sublayers,c=e.folders.map((o=>o.id));return i.forEach((e=>{const i=new o;if(n?i.read(e,n):i.read(e),s.length&&c.indexOf(i.id)>-1&&(i.visible=-1!==s.indexOf(i.id)),r[e.id]=i,null!=e.parentFolderId&&-1!==e.parentFolderId){const o=r[e.parentFolderId];o.sublayers||(o.sublayers=[]),o.sublayers.unshift(i)}else t.unshift(i)})),t}function b(o,e,n){n.forEach((n=>{o.set(n.attributes[e],n)}))}async function g(o){const e=y.fromJSON(o.featureSet).features,n=m(o.layerDefinition.drawingInfo.renderer),s=u.fromJSON(o.popupInfo),t=[];for(const o of e){const e=await n.getSymbolAsync(o);o.symbol=e,o.popupTemplate=s,o.visible=!0,t.push(o)}return t}function x(n){const s=c(f),t=c(f);for(const o of n){if(o.polygons&&o.polygons.featureSet&&o.polygons.featureSet.features)for(const e of o.polygons.featureSet.features)l(s,e.geometry),a(t,s);if(o.polylines&&o.polylines.featureSet&&o.polylines.featureSet.features)for(const e of o.polylines.featureSet.features)l(s,e.geometry),a(t,s);if(o.points&&o.points.featureSet&&o.points.featureSet.features)for(const e of o.points.featureSet.features)l(s,e.geometry),a(t,s);if(o.mapImages)for(const e of o.mapImages)l(s,e.extent),a(t,s)}return o(t,f)?null:{xmin:t[0],ymin:t[1],zmin:t[2],xmax:t[3],ymax:t[4],zmax:t[5],spatialReference:e.WGS84}}export{w as S,g as b,p as d,P as g,x as j}