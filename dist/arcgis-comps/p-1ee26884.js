import{cT as t,A as r,a0 as o}from"./p-e58503d5.js";import{w as s}from"./p-a3955219.js";import{n as a}from"./p-f6a340f9.js";import{P as p}from"./p-2f398ed1.js";import{t as e,n as i}from"./p-c2152437.js";import{x as n}from"./p-c93d2280.js";import{c as f,a as m,u as c,m as j}from"./p-5cd91fe7.js";import"./p-53bb6ab4.js";import"./p-8f986f60.js";import"./p-d3105731.js";import"./p-01e5a461.js";import"./p-ccdb8e80.js";import"./p-b79fcce3.js";import"./p-ea916a39.js";import"./p-fea9512d.js";import"./p-97132756.js";import"./p-a9a30646.js";import"./p-08e5f531.js";import"./p-e273719b.js";import"./p-74de0937.js";import"./p-c45aa9e8.js";class u{transform(o){const s=this._transform(o),a=[s.points.buffer,s.rgb.buffer];r(s.pointIdFilterMap)&&a.push(s.pointIdFilterMap.buffer);for(const r of s.attributes)"buffer"in r.values&&t(r.values.buffer)&&r.values.buffer!==s.rgb.buffer&&a.push(r.values.buffer);return Promise.resolve({result:s,transferList:a})}_transform(t){const s=f(t.schema,t.geometryBuffer);let a=s.length/3,p=null;const e=[],i=m(t.primaryAttributeData,s,a);r(t.primaryAttributeData)&&i&&e.push({attributeInfo:t.primaryAttributeData.attributeInfo,values:i});const n=m(t.modulationAttributeData,s,a);r(t.modulationAttributeData)&&n&&e.push({attributeInfo:t.modulationAttributeData.attributeInfo,values:n});let u=c(t.rendererInfo,i,n,a);if(t.filterInfo&&t.filterInfo.length>0&&r(t.filterAttributesData)){const r=t.filterAttributesData.map((t=>{const r=m(t,s,a),o={attributeInfo:t.attributeInfo,values:r};return e.push(o),o}));p=new Uint32Array(a),a=j(s,u,p,t.filterInfo,r)}for(const r of t.userAttributesData){const t=m(r,s,a);e.push({attributeInfo:r.attributeInfo,values:t})}3*a<u.length&&(u=new Uint8Array(u.buffer.slice(0,3*a))),this._applyElevationOffsetInPlace(s,a,t.elevationOffset);const l=this._transformCoordinates(s,a,t.obb,o.fromJSON(t.inSR),o.fromJSON(t.outSR));return{obb:t.obb,points:l,rgb:u,attributes:e,pointIdFilterMap:p}}_transformCoordinates(t,r,o,a,f){if(!n(t,a,0,t,f,0,r))throw Error("Can't reproject");const m=e(o.center[0],o.center[1],o.center[2]),c=i(),j=i();s(l,o.quaternion);const u=new Float32Array(3*r);for(let s=0;s<r;s++)c[0]=t[3*s]-m[0],c[1]=t[3*s+1]-m[1],c[2]=t[3*s+2]-m[2],p(j,c,l),o.halfSize[0]=Math.max(o.halfSize[0],Math.abs(j[0])),o.halfSize[1]=Math.max(o.halfSize[1],Math.abs(j[1])),o.halfSize[2]=Math.max(o.halfSize[2],Math.abs(j[2])),u[3*s]=c[0],u[3*s+1]=c[1],u[3*s+2]=c[2];return u}_applyElevationOffsetInPlace(t,r,o){if(0!==o)for(let s=0;s<r;s++)t[3*s+2]+=o}}const l=a();function b(){return new u}export default b;