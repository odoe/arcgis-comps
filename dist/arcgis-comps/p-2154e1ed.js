import{h as e,y as r,L as n,N as t,P as o,o as a,z as c,v as i,W as s,T as u,r as l,j as f,D as E,t as d,f as w,S as N,p as h,u as I,I as m,b as p,O as v,R as y,a as T,Z as O,J as b,c as R,d as U,A,Y as M,M as g,C as D,e as S,$ as F,g as C,B as x,i as P,k as L,l as k,m as j,E as _,n as V,s as B,q as Y}from"./p-4ddfade5.js";import{registerFunctions as G}from"./p-b3cfba71.js";import{cf as H,ao as z,cg as q,bE as W}from"./p-9ae46e68.js";import{k as K,a8 as X,E as J,v as Q,b2 as Z,b3 as $,M as ee}from"./p-566b0715.js";import"./p-a184d75f.js";import"./p-023ccb69.js";import"./p-8e03c038.js";import"./p-fe01b82b.js";import"./p-32462343.js";import"./p-4003c7ae.js";import"./p-b2d0e2de.js";import"./p-db87794e.js";import"./p-9dcf03f7.js";import"./p-2a252a78.js";import"./p-dfc6337f.js";import"./p-0cc8e004.js";import"./p-4681e856.js";import"./p-84bf99cb.js";function re(e){return e instanceof Error?q(e):q(new Error(e))}function ne(e){return W(e)}function te(e,r){const n=[];for(let t=0;t<r.arguments.length;t++)n.push(ce(e,r.arguments[t]));return z(n)}function oe(e,r,n){return H(((t,o)=>{te(e,r).then((a=>{try{t(n(e,r,a))}catch(e){o(e)}}),o)}))}function ae(e,r,n){try{return te(e,r).then((t=>{try{const o=n(e,r,t);return function(e){return e&&"function"==typeof e.then}(o)?o:W(o)}catch(e){return re(e)}}))}catch(e){return re(e)}}function ce(e,r,n){try{if(r.breakpoint&&!0!==n)return r.breakpoint().then((()=>ce(e,r,!0)));switch(r.type){case"VariableDeclarator":return function(e,r){try{let n=null;return n=null===r.init?W(null):ce(e,r.init),n.then(null!==e.localScope?n=>H((t=>{if(n===y&&(n=null),"Identifier"!==r.id.type)throw new Error("Can only assign a regular variable");const o=r.id.name.toLowerCase();e.localScope[o]={value:n,valueset:!0,node:r.init},t(y)})):n=>H((t=>{if("Identifier"!==r.id.type)throw new Error("Can only assign a regular variable");const o=r.id.name.toLowerCase();n===y&&(n=null),e.globalScope[o]={value:n,valueset:!0,node:r.init},t(y)})))}catch(e){return re(e)}}(e,r);case"VariableDeclaration":return he(e,r,0);case"BlockStatement":return function(e,r){try{return we(e,r,0)}catch(e){return re(e)}}(e,r);case"FunctionDeclaration":return Ne(e,r);case"ReturnStatement":return function(e,r){return H(((n,t)=>{null===r.argument?n(new g(y)):ce(e,r.argument).then((e=>{try{n(new g(e))}catch(e){t(e)}}),t)}))}(e,r);case"IfStatement":return function(e,r){return H(((n,t)=>{"AssignmentExpression"!==r.test.type&&"UpdateExpression"!==r.test.type?ce(e,r.test).then((o=>{try{!0===o?ce(e,r.consequent).then(n,t):!1===o?null!==r.alternate?ce(e,r.alternate).then(n,t):n(y):t(new Error(p(r.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION")))}catch(e){t(e)}}),t):t(new Error(p(r.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")))}))}(e,r);case"ExpressionStatement":return function(e,r){try{return"AssignmentExpression"===r.expression.type?ce(e,r.expression):ce(e,r.expression).then((e=>H((r=>{r(e===y?y:new C(e))}))))}catch(e){return q(e)}}(e,r);case"UpdateExpression":return function(e,r){try{const n=r.argument;if("MemberExpression"===n.type){const t={t:null};return ce(e,n.object).then((r=>{let o=null;return t.t=r,!0===n.computed?o=ce(e,n.property):"Identifier"===n.property.type&&(o=W(n.property.name)),o})).then((e=>H((n=>{const o=t.t;let a;if(T(o)){if(!M(e))throw new Error("Invalid Parameter");if(e<0&&(e=o.length+e),e<0||e>=o.length)throw new Error("Assignment outside of array bounds");a=S(o[e]),o[e]="++"===r.operator?a+1:a-1}else if(o instanceof R){if(!1===O(e))throw new Error("Dictionary accessor must be a string");if(!0!==o.hasField(e))throw new Error("Invalid Parameter");a=S(o.field(e)),o.setField(e,"++"===r.operator?a+1:a-1)}else{if(!(o instanceof U))throw b(o)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===O(e))throw new Error("Feature accessor must be a string");if(!0!==o.hasField(e))throw new Error("Invalid Parameter");a=S(o.field(e)),o.setField(e,"++"===r.operator?a+1:a-1)}n(!1===r.prefix?a:"++"===r.operator?a+1:a-1)}))))}return H(((n,t)=>{const o="Identifier"===r.argument.type?r.argument.name.toLowerCase():"";if(!o)throw new Error("Invalid identifier");let a;return null!==e.localScope&&void 0!==e.localScope[o]?(a=S(e.localScope[o].value),e.localScope[o]={value:"++"===r.operator?a+1:a-1,valueset:!0,node:r},void n(!1===r.prefix?a:"++"===r.operator?a+1:a-1)):void 0!==e.globalScope[o]?(a=S(e.globalScope[o].value),e.globalScope[o]={value:"++"===r.operator?a+1:a-1,valueset:!0,node:r},void n(!1===r.prefix?a:"++"===r.operator?a+1:a-1)):void t(new Error("Variable not recognised"))}))}catch(e){return q(e)}}(e,r);case"AssignmentExpression":return function(e,r){return H(((n,t)=>{const o=r.left;if("MemberExpression"===o.type)ce(e,r.right).then((a=>{try{ce(e,o.object).then((c=>{try{let i=null;if(!0===o.computed)i=ce(e,o.property);else{if("Identifier"!==o.property.type)throw new Error("Expected computed or identifier for assignemnt target");i=W(o.property.name)}i.then((e=>{try{if(T(c)){if(!M(e))throw new Error("Invalid Parameter");if(e<0&&(e=c.length+e),e<0||e>c.length)throw new Error("Assignment outside of array bounds");if(e===c.length){if("="!==r.operator)throw new Error("Invalid Parameter");c[e]=de(a,r.operator,c[e],r)}else c[e]=de(a,r.operator,c[e],r)}else if(c instanceof R){if(!1===O(e))throw new Error("Dictionary accessor must be a string");if(!0===c.hasField(e))c.setField(e,de(a,r.operator,c.field(e),r));else{if("="!==r.operator)throw new Error("Invalid Parameter");c.setField(e,de(a,r.operator,null,r))}}else{if(!(c instanceof U))throw b(c)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===O(e))throw new Error("Feature accessor must be a string");if(!0===c.hasField(e))c.setField(e,de(a,r.operator,c.field(e),r));else{if("="!==r.operator)throw new Error("Invalid Parameter");c.setField(e,de(a,r.operator,null,r))}}n(y)}catch(e){t(e)}}),t)}catch(e){t(e)}}),t)}catch(e){t(e)}}),t);else{const a=o.name.toLowerCase();if(null!==e.localScope&&void 0!==e.localScope[a])return void ce(e,r.right).then((o=>{try{e.localScope[a]={value:de(o,r.operator,e.localScope[a].value,r),valueset:!0,node:r.right},n(y)}catch(e){t(e)}}),t);void 0!==e.globalScope[a]?ce(e,r.right).then((o=>{try{e.globalScope[a]={value:de(o,r.operator,e.globalScope[a].value,r),valueset:!0,node:r.right},n(y)}catch(e){t(e)}}),t):t(new Error("Cannot assign undeclared variable"))}}))}(e,r);case"ForStatement":return function(e,r){try{return null!==r.init?ce(e,r.init).then((()=>H(((n,t)=>{se(e,r,{testResult:!0,lastAction:y},(e=>{n(e)}),(e=>{t(e)}),0)})))):H(((n,t)=>{se(e,r,{testResult:!0,lastAction:y},(e=>{n(e)}),(e=>{t(e)}),0)}))}catch(e){return q(e)}}(e,r);case"ForInStatement":return function(e,r){return H(((n,t)=>{ce(e,r.right).then((o=>{try{let a=null;a="VariableDeclaration"===r.left.type?ce(e,r.left):W(),a.then((()=>{try{let a="";if("VariableDeclaration"===r.left.type){const e=r.left.declarations[0].id;"Identifier"===e.type&&(a=e.name)}else"Identifier"===r.left.type&&(a=r.left.name);if(!a)throw new Error(p(r,"RUNTIME","INVALIDVARIABLE"));a=a.toLowerCase();let c=null;if(null!==e.localScope&&void 0!==e.localScope[a]&&(c=e.localScope[a]),null===c&&void 0!==e.globalScope[a]&&(c=e.globalScope[a]),null===c)return void t(new Error(p(r,"RUNTIME","VARIABLENOTDECLARED")));T(o)||O(o)?fe(e,r,o,{reject:t,resolve:n},c):b(o)?function(e,r,n,t,o,a){try{if(void 0===a&&(a="i"),0===n.length)return void t.resolve(y);le(e,r,n,o,0,a,(e=>{t.resolve(e)}),(e=>{t.reject(e)}),0)}catch(e){t.reject(e)}}(e,r,o,{reject:t,resolve:n},c):o instanceof R||o instanceof U?function(e,r,n,t,o){try{fe(e,r,n.keys(),t,o,"k")}catch(e){t.reject(e)}}(e,r,o,{reject:t,resolve:n},c):A(o)?Ee(o.iterator(e.abortSignal),e,r,o,c,(e=>{n(e)}),(e=>{t(e)}),0):fe(e,r,[],{reject:t,resolve:n},c)}catch(e){t(e)}}),t)}catch(e){t(e)}}),t)}))}(e,r);case"BreakStatement":return W(f);case"EmptyStatement":return W(y);case"ContinueStatement":return W(E);case"TemplateElement":return function(e,r){return W(r.value?r.value.cooked:"")}(0,r);case"TemplateLiteral":return function(e,r){return H((n=>{const t=[];v(r.expressions,((r,n,o)=>ce(e,n).then((e=>{t[o]=F(e)})))).then((()=>{let e="",o=0;for(const n of r.quasis)e+=n.value?n.value.cooked:"",!1===n.tail&&(e+=t[o]?t[o]:"",o++);n(e)}))}))}(e,r);case"Identifier":return pe(e,r);case"MemberExpression":return function(e,r){try{return ce(e,r.object).then((n=>{try{return null===n?q(new Error(p(r,"RUNTIME","NOTFOUND"))):!1===r.computed?"Identifier"===r.property.type?n instanceof R||n instanceof U?W(n.field(r.property.name)):n instanceof X?W(me(n,r.property.name,0,r)):q(new Error(p(r,"RUNTIME","INVALIDTYPE"))):q(new Error(p(r,"RUNTIME","INVALIDTYPE"))):ce(e,r.property).then((e=>H(((t,o)=>{if(n instanceof R||n instanceof U)O(e)?t(n.field(e)):o(new Error(p(r,"RUNTIME","INVALIDTYPE")));else if(n instanceof X)O(e)?t(me(n,e,0,r)):o(new Error(p(r,"RUNTIME","INVALIDTYPE")));else if(T(n))if(M(e)&&isFinite(e)&&Math.floor(e)===e){if(e<0&&(e=n.length+e),e>=n.length||e<0)throw new Error(p(r,"RUNTIME","OUTOFBOUNDS"));t(n[e])}else o(new Error(p(r,"RUNTIME","INVALIDTYPE")));else if(b(n))if(M(e)&&isFinite(e)&&Math.floor(e)===e){if(e<0&&(e=n.length()+e),e>=n.length()||e<0)throw new Error(p(r,"RUNTIME","OUTOFBOUNDS"));t(n.get(e))}else o(new Error(p(r,"RUNTIME","INVALIDTYPE")));else if(O(n))if(M(e)&&isFinite(e)&&Math.floor(e)===e){if(e<0&&(e=n.length+e),e>=n.length||e<0)throw new Error(p(r,"RUNTIME","OUTOFBOUNDS"));t(n[e])}else o(new Error(p(r,"RUNTIME","INVALIDTYPE")));else o(new Error(p(r,"RUNTIME","INVALIDTYPE")))}))))}catch(e){return re(e)}}))}catch(e){return re(e)}}(e,r);case"Literal":return ne(r.value);case"CallExpression":return ve(e,r);case"UnaryExpression":return function(e,r){try{return ce(e,r.argument).then((e=>H(((n,t)=>{i(e)&&"!"===r.operator?n(!e):"-"===r.operator?n(-1*S(e)):"+"===r.operator?n(1*S(e)):"~"===r.operator?n(~S(e)):t(new Error(p(r,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR")))}))))}catch(e){return re(e)}}(e,r);case"BinaryExpression":return function(e,r){try{return z([ce(e,r.left),ce(e,r.right)]).then((e=>H(((n,t)=>{const o=e[0],a=e[1];switch(r.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":n(P(S(o),S(a),r.operator));case"==":n(s(o,a));break;case"!=":n(!s(o,a));break;case"<":case">":case"<=":case">=":n(x(o,a,r.operator));break;case"+":O(o)||O(a)?n(F(o)+F(a)):n(S(o)+S(a));break;case"-":n(S(o)-S(a));break;case"*":n(S(o)*S(a));break;case"/":n(S(o)/S(a));break;case"%":n(S(o)%S(a));break;default:t(new Error(p(r,"RUNTIME","OPERATORNOTRECOGNISED")))}}))))}catch(e){return re(e)}}(e,r);case"LogicalExpression":return function(e,r){return H(((n,t)=>{"AssignmentExpression"!==r.left.type&&"UpdateExpression"!==r.left.type?"AssignmentExpression"!==r.right.type&&"UpdateExpression"!==r.right.type?ce(e,r.left).then((o=>{try{if(!i(o))throw new Error(p(r,"RUNTIME","ONLYBOOLEAN"));switch(r.operator){case"||":!0===o?n(o):ce(e,r.right).then((e=>{try{if(!i(e))throw new Error(p(r,"RUNTIME","ONLYORORAND"));n(e)}catch(e){t(e)}}),t);break;case"&&":!1===o?n(o):ce(e,r.right).then((e=>{try{if(!i(e))throw new Error(p(r,"RUNTIME","ONLYORORAND"));n(e)}catch(e){t(e)}}),t);break;default:throw new Error(p(r,"RUNTIME","ONLYORORAND"))}}catch(e){t(e)}}),t):t(new Error(p(r.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):t(new Error(p(r.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")))}))}(e,r);case"ArrayExpression":return function(e,r){try{const n=[];for(let t=0;t<r.elements.length;t++)n.push(ce(e,r.elements[t]));return z(n).then((e=>H(((n,t)=>{for(let n=0;n<e.length;n++){if(D(e[n]))return void t(new Error(p(r,"RUNTIME","FUNCTIONCONTEXTILLEGAL")));e[n]===y&&(e[n]=null)}n(e)}))))}catch(e){return re(e)}}(e,r);case"ObjectExpression":return function(e,r){try{const n=[];for(let t=0;t<r.properties.length;t++)n.push(ce(e,r.properties[t]));return z(n).then((e=>H((r=>{const n={};for(let r=0;r<e.length;r++){const t=e[r];if(D(t.value))throw new Error("Illegal Argument");if(!1===O(t.key))throw new Error("Illegal Argument");n[t.key.toString()]=t.value===y?null:t.value}const t=new R(n);t.immutable=!1,r(t)}))))}catch(e){return re(e)}}(e,r);case"Property":return function(e,r){try{return ce(e,r.value).then((n=>H((t=>{"Identifier"===r.key.type?t({key:r.key.name,value:n}):ce(e,r.key).then((e=>{t({key:e,value:n})}))}))))}catch(e){return q(e)}}(e,r);default:return re(p(r,"RUNTIME","UNREOGNISED"))}}catch(e){return re(e)}}function ie(e,r,n){try{return ce(e,r.body).then((t=>{try{return n.lastAction=t,n.lastAction===f||n.lastAction instanceof g?(n.testResult=!1,W(n)):null!==r.update?ce(e,r.update).then((()=>W(n))):W(n)}catch(e){return q(e)}}))}catch(e){return q(e)}}function se(e,r,n,t,o,a){try{(function(e,r,n){try{return null!==r.test?ce(e,r.test).then((t=>{try{return!0===e.abortSignal.aborted?q(new Error("Cancelled")):(n.testResult=t,!1===n.testResult?W(n):!0!==n.testResult?q(new Error(p(r,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))):ie(e,r,n))}catch(e){return q(e)}})):ie(e,r,n)}catch(e){return q(e)}})(e,r,n).then((()=>{try{!0===n.testResult?++a>100?(a=0,setTimeout((()=>{se(e,r,n,t,o,a)}),0)):se(e,r,n,t,o,a):t(n.lastAction instanceof g?n.lastAction:y)}catch(e){o(e)}}),(e=>{o(e)}))}catch(e){o(e)}}function ue(e,r,n,t,o,a,c,i,s,u){try{if(t<=a)return void i(y);o.value="k"===c?n[a]:a,ce(e,r.body).then((l=>{try{l instanceof g?i(l):l===f?i(y):++u>100?(u=0,setTimeout((()=>{ue(e,r,n,t,o,a+1,c,i,s,u)}),0)):ue(e,r,n,t,o,a+1,c,i,s,u)}catch(e){s(e)}}),(e=>{s(e)}))}catch(e){s(e)}}function le(e,r,n,t,o,a,c,i,s){try{if(n.length()<=o)return void c(y);t.value="k"===a?n.get(o):o,ce(e,r.body).then((u=>{u instanceof g?c(u):u===f?c(y):++s>100?(s=0,setTimeout((()=>{le(e,r,n,t,o+1,a,c,i,s)}),0)):le(e,r,n,t,o+1,a,c,i,s)}),(e=>{i(e)}))}catch(e){i(e)}}function fe(e,r,n,t,o,a){try{if(void 0===a&&(a="i"),0===n.length)return void t.resolve(y);ue(e,r,n,n.length,o,0,a,(e=>{t.resolve(e)}),(e=>{t.reject(e)}),0)}catch(e){t.reject(e)}}function Ee(e,r,n,t,o,a,c,i){try{e.next().then((s=>{try{if(null===s)a(y);else{const u=U.createFromGraphicLikeObject(s.geometry,s.attributes,t);u._underlyingGraphic=s,o.value=u,ce(r,n.body).then((s=>{try{s===f?a(y):s instanceof g?a(s):++i>100?(i=0,setTimeout((()=>{Ee(e,r,n,t,o,a,c,i)}),0)):Ee(e,r,n,t,o,a,c,i)}catch(e){c(e)}}),(e=>{c(e)}))}}catch(e){c(e)}}),(e=>{c(e)}))}catch(e){c(e)}}function de(e,r,n,t){switch(r){case"=":return e===y?null:e;case"/=":return S(n)/S(e);case"*=":return S(n)*S(e);case"-=":return S(n)-S(e);case"+=":return O(n)||O(e)?F(n)+F(e):S(n)+S(e);case"%=":return S(n)%S(e);default:throw new Error(p(t,"RUNTIME","OPERATORNOTRECOGNISED"))}}function we(e,r,n){try{return n>=r.body.length?W(y):H(((t,o)=>{ce(e,r.body[n]).then((a=>{try{a instanceof g||a===f||a===E||n===r.body.length-1?t(a):we(e,r,n+1).then(t,o)}catch(e){o(e)}}),o)}))}catch(e){return re(e)}}function Ne(e,r){try{const n=r.id.name.toLowerCase();return e.globalScope[n]={valueset:!0,node:null,value:new d(r,e)},W(y)}catch(e){return re(e)}}function he(e,r,n){return H(((t,o)=>{n>=r.declarations.length?t(y):ce(e,r.declarations[n]).then((()=>{n===r.declarations.length-1?t(y):he(e,r,n+1).then((()=>{t(y)}),o)}),o)}))}let Ie=0;function me(e,r,n,t){let o;switch(r=r.toLowerCase()){case"hasz":{const r=e.hasZ;return void 0!==r&&r}case"hasm":{const r=e.hasM;return void 0!==r&&r}case"spatialreference":{let r=e.spatialReference._arcadeCacheId;if(void 0===r){let n=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(n=!1),n&&(Ie++,e.spatialReference._arcadeCacheId=Ie,r=Ie)}const n=new R({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==r&&(n._arcadeCacheId="SPREF"+r.toString()),n}}switch(e.type){case"extent":switch(r){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const n=e[r];return void 0!==n?n:null}case"type":return"Extent"}break;case"polygon":switch(r){case"rings":return o=e.cache._arcadeCacheId,void 0===o&&(Ie++,o=Ie,e.cache._arcadeCacheId=o),new j(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,o);case"type":return"Polygon"}break;case"point":switch(r){case"x":case"y":case"z":case"m":return void 0!==e[r]?e[r]:null;case"type":return"Point"}break;case"polyline":switch(r){case"paths":return o=e.cache._arcadeCacheId,void 0===o&&(Ie++,o=Ie,e.cache._arcadeCacheId=o),new j(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,o);case"type":return"Polyline"}break;case"multipoint":switch(r){case"points":return o=e.cache._arcadeCacheId,void 0===o&&(Ie++,o=Ie,e.cache._arcadeCacheId=o),new k(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,o,1);case"type":return"Multipoint"}}throw new Error(p(t,"RUNTIME","PROPERTYNOTFOUND"))}function pe(e,r){return H(((n,t)=>{const o=r.name.toLowerCase();if(null===e.localScope||void 0===e.localScope[o])if(void 0===e.globalScope[o])t(new Error(p(r,"RUNTIME","VARIABLENOTFOUND")));else{const r=e.globalScope[o];!0===r.valueset?n(r.value):null!==r.d?r.d.then(n,t):(r.d=ce(e,r.node),r.d.then((e=>{try{r.value=e,r.valueset=!0,n(e)}catch(e){t(e)}}),t))}else{const r=e.localScope[o];!0===r.valueset?n(r.value):null!==r.d?r.d.then(n,t):(r.d=ce(e,r.node),r.d.then((e=>{try{r.value=e,r.valueset=!0,n(e)}catch(e){t(e)}}),t))}}))}function ve(e,r){try{if("Identifier"!==r.callee.type)return re(p(r,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==e.localScope&&void 0!==e.localScope[r.callee.name.toLowerCase()]){const n=e.localScope[r.callee.name.toLowerCase()];return n.value instanceof u?n.value.fn(e,r):n.value instanceof d?ge(e,r,n.value.definition):re(p(r,"RUNTIME","NOTAFUNCTION"))}if(void 0!==e.globalScope[r.callee.name.toLowerCase()]){const n=e.globalScope[r.callee.name.toLowerCase()];return n.value instanceof u?n.value.fn(e,r):n.value instanceof d?ge(e,r,n.value.definition):re(p(r,"RUNTIME","NOTAFUNCTION"))}return re(p(r,"RUNTIME","NOTFOUND"))}catch(e){return re(e)}}const ye={};function Te(e){return null===e?"":T(e)||b(e)?"Array":_(e)?"Date":O(e)?"String":i(e)?"Boolean":M(e)?"Number":e instanceof V?"Attachment":e instanceof B?"Portal":e instanceof R?"Dictionary":e instanceof U?"Feature":e instanceof J?"Point":e instanceof Q?"Polygon":e instanceof Z?"Polyline":e instanceof $?"Multipoint":e instanceof ee?"Extent":D(e)?"Function":A(e)?"FeatureSet":Y(e)?"FeatureSetCollection":e===y?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognised Type"}function Oe(e,r,n,t){return H(((o,a)=>{ce(e,r.arguments[n]).then((c=>{try{if(s(c,t))return void ce(e,r.arguments[n+1]).then(o,a);{const c=r.arguments.length-n;return 1===c?void ce(e,r.arguments[n]).then(o,a):(2===c&&o(null),3===c?void ce(e,r.arguments[n+2]).then(o,a):void Oe(e,r,n+2,t).then(o,a))}}catch(e){a(e)}}),a)}))}function be(e,r,n,t){return H(((o,a)=>{!0===t?ce(e,r.arguments[n+1]).then(o,a):3==r.arguments.length-n?ce(e,r.arguments[n+2]).then(o,a):ce(e,r.arguments[n+2]).then((t=>{try{if(!1===i(t))return void a(new Error("WHEN needs boolean test conditions"));be(e,r,n+2,t).then(o,a)}catch(e){a(e)}}))}))}function Re(e,r){try{const n=e.length,t=Math.floor(n/2);return 0===n?W([]):1===n?W([e[0]]):H(((o,a)=>{const c=[Re(e.slice(0,t),r),Re(e.slice(t,n),r)];z(c).then((e=>{try{Ue(e[0],e[1],r,[]).then(o,a)}catch(e){a(e)}}),a)}))}catch(e){return re(e)}}function Ue(e,r,n,t){return H(((o,a)=>{const c=t;e.length>0||r.length>0?e.length>0&&r.length>0?n(e[0],r[0]).then((i=>{try{isNaN(i)&&(i=1),i<=0?(c.push(e[0]),e=e.slice(1)):(c.push(r[0]),r=r.slice(1)),Ue(e,r,n,t).then(o,a)}catch(e){a(e)}}),a):e.length>0?(c.push(e[0]),Ue(e=e.slice(1),r,n,t).then(o,a)):r.length>0&&(c.push(r[0]),r=r.slice(1),Ue(e,r,n,t).then(o,a)):o(t)}))}function Ae(e,r){const n=e.length,t=Math.floor(n/2);return r||(r=function(e,r){return e<r?-1:e===r?0:1}),0===n?[]:1===n?[e[0]]:function(e,r,n){const t=[];for(;e.length>0||r.length>0;)if(e.length>0&&r.length>0){let o=n(e[0],r[0]);isNaN(o)&&(o=1),o<=0?(t.push(e[0]),e=e.slice(1)):(t.push(r[0]),r=r.slice(1))}else e.length>0?(t.push(e[0]),e=e.slice(1)):r.length>0&&(t.push(r[0]),r=r.slice(1));return t}(Ae(e.slice(0,t),r),Ae(e.slice(t,n),r),r)}function Me(e,r,n){try{const t=e.body;if(n.length!==e.params.length)return re(new Error("Invalid Parameter calls to function."));for(let t=0;t<n.length;t++){const o=e.params[t];"Identifier"===o.type&&(r.localScope[o.name.toLowerCase()]={d:null,value:n[t],valueset:!0,node:null})}return ce(r,t).then((e=>H(((r,n)=>{e instanceof g?r(e.value):e!==f?e!==E?r(e instanceof C?e.value:e):n(new Error("Cannot Continue from a Function")):n(new Error("Cannot Break from a Function"))}))))}catch(e){return q(e)}}function ge(e,r,n){return ae(e,r,(function(r,t,o){const a={spatialReference:e.spatialReference,services:e.services,console:e.console,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:e.depthCounter+1};if(a.depthCounter>64)throw new Error("Exceeded maximum function depth");return Me(n,a,o)}))}function De(e){return function(){const r={abortSignal:e.context.abortSignal,spatialReference:e.context.spatialReference,console:e.context.console,lrucache:e.context.lrucache,interceptor:e.context.interceptor,services:e.context.services,localScope:{},globalScope:e.context.globalScope,depthCounter:e.context.depthCounter+1};if(r.depthCounter>64)throw new Error("Exceeded maximum function depth");return Me(e.definition,r,arguments)}}e(ye,oe),r(ye,oe),n(ye,oe),t(ye,oe),o(ye,oe),a(ye,oe),G({functions:ye,compiled:!1,signatures:null,failDefferred:null,evaluateIdentifier:null,arcadeCustomFunctionHandler:null,mode:"async",standardFunction:oe,standardFunctionAsync:ae}),ye.typeof=function(e,r){return oe(e,r,(function(e,r,n){c(n,1,1);const t=Te(n[0]);if("Unrecognised Type"===t)throw new Error("Unrecognised Type");return t}))},ye.iif=function(e,r){return H(((n,t)=>{c(null===r.arguments?[]:r.arguments,3,3),ce(e,r.arguments[0]).then((o=>{try{if(!1===i(o))return void t(new Error("IF Function must have a boolean test condition"));z([ce(e,r.arguments[1]),ce(e,r.arguments[2])]).then((e=>{n(o?e[0]:e[1])}),t)}catch(e){t(e)}}),t)}))},ye.decode=function(e,r){return H(((n,t)=>{r.arguments.length<2?t(new Error("Missing Parameters")):2!==r.arguments.length?(r.arguments.length-1)%2!=0?ce(e,r.arguments[0]).then((o=>{try{Oe(e,r,1,o).then(n,t)}catch(e){t(e)}}),t):t(new Error("Must have a default value result.")):ce(e,r.arguments[1]).then(n,t)}))},ye.when=function(e,r){try{return r.arguments.length<3?re("Missing Parameters"):r.arguments.length%2==0?re("Must have a default value result."):ce(e,r.arguments[0]).then((n=>H(((t,o)=>{!1!==i(n)?be(e,r,0,n).then(t,o):o(new Error("WHEN needs boolean test conditions"))}))))}catch(e){return re(e)}},ye.sort=function(e,r){return ae(e,r,(function(e,r,n){c(n,1,2);let t=n[0];if(b(t)&&(t=t.toArray()),!1===T(t))return re(Error("Illegal Argument"));if(n.length>1)return!1===D(n[1])?re(Error("Illegal Argument")):Re(t,De(n[1]));{let e=t;if(0===e.length)return W([]);const r={};for(let n=0;n<e.length;n++){const t=Te(e[n]);""!==t&&(r[t]=!0)}if(!0===r.Array||!0===r.Dictionary||!0===r.Feature||!0===r.Point||!0===r.Polygon||!0===r.Polyline||!0===r.Multipoint||!0===r.Extent||!0===r.Function)return W(e.slice(0));let n=0,o="";for(const e in r)n++,o=e;return n>1||"String"===o?e=Ae(e,(function(e,r){if(null==e||e===y)return null==r||r===y?0:1;if(null==r||r===y)return-1;const n=F(e),t=F(r);return n<t?-1:n===t?0:1})):"Number"===o?e=Ae(e,(function(e,r){return e-r})):"Boolean"===o?e=Ae(e,(function(e,r){return e===r?0:r?-1:1})):"Date"===o&&(e=Ae(e,(function(e,r){return r-e}))),W(e)}}))};const Se={failDefferred:re,resolveDeffered:ne,fixSpatialReference:L,parseArguments:te,standardFunction:oe,standardFunctionAsync:ae,evaluateIdentifier:pe,arcadeCustomFunction:De};for(const e in ye)ye[e]={value:new u(ye[e]),valueset:!0,node:null};const Fe=function(){};function Ce(e){console.log(e)}(Fe.prototype=ye).infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},Fe.prototype.pi={value:Math.PI,valueset:!0,node:null};const xe=Se;function Pe(e){const r={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:oe,standardFunctionAsync:ae,failDefferred:re,evaluateIdentifier:pe,arcadeCustomFunctionHandler:De};for(let n=0;n<e.length;n++)e[n].registerFunctions(r);for(const e in r.functions)ye[e]={value:new u(r.functions[e]),valueset:!0,node:null},Fe.prototype[e]=ye[e];for(let e=0;e<r.signatures.length;e++)l(r.signatures[e],"async")}function Le(e,r){let n=r.spatialReference;null==n&&(n=new K({wkid:102100}));const t=function(e,r){const n=new Fe;null==e&&(e={}),null==r&&(r={});const t=new R({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});t.immutable=!1,n.textformatting={value:t,valueset:!0,node:null};for(const e in r)n[e]={value:new u(r[e]),native:!0,valueset:!0,node:null};for(const r in e)n[r]=e[r]&&"esri.Graphic"===e[r].declaredClass?{value:U.createFromGraphic(e[r]),valueset:!0,node:null}:{value:e[r],valueset:!0,node:null};return n}(r.vars,r.customfunctions);return ce({spatialReference:n,services:r.services,abortSignal:null==r.abortSignal?{aborted:!1}:r.abortSignal,globalScope:t,console:r.console?r.console:Ce,lrucache:r.lrucache,interceptor:r.interceptor,localScope:null,depthCounter:1},e.body[0].body).then((e=>H(((r,n)=>{e instanceof g&&(e=e.value),e instanceof C&&(e=e.value),e===y&&(e=null),e!==f?e!==E?e instanceof u||e instanceof d?n(new Error("Cannot return FUNCTION")):r(e):n(new Error("Cannot return CONTINUE")):n(new Error("Cannot return BREAK"))}))))}function ke(e){return w(e)}function je(e,r){return N(e,r,"full")}function _e(e,r){return h(e,r)}function Ve(e,r){return I(e,r)}function Be(e){return m(e)}export{Le as executeScript,Pe as extend,ke as extractFieldLiterals,Be as findFunctionCalls,xe as functionHelper,Ve as referencesFunction,_e as referencesMember,je as validateScript}