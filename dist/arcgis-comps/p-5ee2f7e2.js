import{P as e,t,r,m as n}from"./p-9ae46e68.js";import{bR as i,I as s,bS as l,aY as o,b6 as a,bL as u,bT as c,bU as f,aC as p,bz as m,ab as y,bV as S,a6 as R,aH as d}from"./p-566b0715.js";import{f as w,i as h,y as G,G as P,U as b,C as v,_ as I,D as M}from"./p-4003c7ae.js";import{t as g}from"./p-b2d0e2de.js";import{f as j,g as N}from"./p-47f143cb.js";import{v as U}from"./p-8031c809.js";function C(e,t){if(!e)return null;const r=t.featureAdapter,{startTimeField:n,endTimeField:i}=e;let s=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(n&&i)t.forEach((e=>{const t=r.getAttribute(e,n),o=r.getAttribute(e,i);null==t||isNaN(t)||(s=Math.min(s,t)),null==o||isNaN(o)||(l=Math.max(l,o))}));else{const e=n||i;t.forEach((t=>{const n=r.getAttribute(t,e);null==n||isNaN(n)||(s=Math.min(s,n),l=Math.max(l,n))}))}return{start:s,end:l}}function F(e,t,r){if(!t||!e)return null;const{startTimeField:n,endTimeField:i}=e;if(!n&&!i)return null;const{start:s,end:l}=t;return null===s&&null===l?null:void 0===s&&void 0===l?()=>!1:n&&i?function(e,t,r,n,i){return null!=n&&null!=i?s=>{const l=e.getAttribute(s,t),o=e.getAttribute(s,r);return(null==l||l<=i)&&(null==o||o>=n)}:null!=n?t=>{const i=e.getAttribute(t,r);return null==i||i>=n}:null!=i?r=>{const n=e.getAttribute(r,t);return null==n||n<=i}:void 0}(r,n,i,s,l):function(e,t,r,n){return null!=r&&null!=n&&r===n?n=>e.getAttribute(n,t)===r:null!=r&&null!=n?i=>{const s=e.getAttribute(i,t);return s>=r&&s<=n}:null!=r?n=>e.getAttribute(n,t)>=r:null!=n?r=>e.getAttribute(r,t)<=n:void 0}(r,n||i,s,l)}const T=new e({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),_=Object.freeze({}),q=new g,E=new g,O=new g,x={esriGeometryPoint:P,esriGeometryPolyline:b,esriGeometryPolygon:v,esriGeometryMultipoint:I};function B(e,r,n,i=e.hasZ,s=e.hasM){if(t(r))return null;const l=e.hasZ&&i,o=e.hasM&&s;if(n){const t=h(O,r,e.hasZ,e.hasM,"esriGeometryPoint",n,i,s);return P(t,l,o)}return P(r,l,o)}function D(e,n,i,s,l,o,a=n,u=i){const c=n&&a,f=i&&u,p=r(s)?"coords"in s?s:s.geometry:null;if(t(p))return null;if(l){let t=w(E,p,n,i,e,l,a,u);return o&&(t=h(O,t,c,f,e,o)),x[e](t,c,f)}if(o){const t=h(O,p,n,i,e,o,a,u);return x[e](t,c,f)}return G(q,p,n,i,a,u),x[e](q,c,f)}async function J(e,t,r){const{outFields:n,orderByFields:i,groupByFieldsForStatistics:s,outStatistics:l}=e;if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(l)for(let e=0;e<l.length;e++)l[e].onStatisticField&&(l[e].onStatisticField=l[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),V(e,t,r)}async function V(e,r,n){if(!e)return null;let{where:c}=e;if(e.where=c=c&&c.trim(),(!c||/^1 *= *1$/.test(c)||r&&r===c)&&(e.where=null),!e.geometry)return e;let f=await async function(e){const{geometry:t,distance:r,units:n}=e;if(null==r||"vertexAttributes"in t)return t;const i=t.spatialReference,s=n?T.fromJSON(n):l(i),c=i&&(o(i)||a(i))?t:await j(i,u).then((()=>N(t,u)));return(await async function(){return(await import("./p-ce933f99.js")).geodesicBuffer}())(c.spatialReference,c,r,s)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;f=i(f),f.spatialReference=t}e.geometry=f,await j(f.spatialReference,n);const p=(await U(s(f)))[0];if(t(p))throw _;const m=p.toJSON(),y=await N(m,m.spatialReference,n);if(!y)throw _;return y.spatialReference=n,e.geometry=y,e}function W(e){return e&&k in e?JSON.parse(JSON.stringify(e,z)):e}const k="_geVersion",z=(e,t)=>e!==k?t:void 0;function A(e,t){return e?t?4:3:t?3:2}function H(e,t,r,n,i,s){const l=A(i,s),{coords:o,lengths:a}=n;if(!a)return!1;for(let n=0,i=0;n<a.length;n++,i+=l)if(!K(e,t,r,o[i],o[i+1]))return!1;return!0}function K(e,t,r,n,i){if(!e)return!1;const s=A(t,r),{coords:l,lengths:o}=e;let a=!1,u=0;for(const e of o)a=L(a,l,s,u,e,n,i),u+=e*s;return a}function L(e,t,r,n,i,s,l){let o=e,a=n;for(let e=n,u=n+i*r;e<u;e+=r){a=e+r,a===u&&(a=n);const i=t[e],c=t[e+1],f=t[a],p=t[a+1];(c<l&&p>=l||p<l&&c>=l)&&i+(l-c)/(p-c)*(f-i)<s&&(o=!o)}return o}const Y="feature-store:unsupported-query",$={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},Q={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},X={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},Z={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function ee(e,t,r,n,i){if(p(t)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=M(new g,t,!1,!1);return Promise.resolve((t=>function(e,t,r,n){return K(e,!1,!1,n.coords[0],n.coords[1])}(e,0,0,t)))}if(p(t)&&"esriGeometryMultipoint"===r){const r=M(new g,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((e=>H(r,!1,!1,e,n,i)))}if(m(t)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((e=>y(t,D(r,n,i,e))));if(m(t)&&"esriGeometryMultipoint"===r&&"esriSpatialRelContains"===e)return Promise.resolve((e=>S(t,D(r,n,i,e))));if(m(t)&&"esriSpatialRelIntersects"===e){const e=function(e){return"mesh"===e?c:f(e)}(r);return Promise.resolve((s=>e(t,D(r,n,i,s))))}return import("./p-ce933f99.js").then((s=>{const l=s[$[e]].bind(null,t.spatialReference,t);return e=>l(D(r,n,i,e))}))}async function te(e,t,r){const{spatialRel:i,geometry:s}=e;if(s){if(!function(e){return!0===Q[e]}(i))throw new n(Y,"Unsupported query spatial relationship",{query:e});if(R(s.spatialReference)&&R(r)){if(!function(e){return!0===X[d(e)]}(s))throw new n(Y,"Unsupported query geometry type",{query:e});if(!function(e){return!0===Z[e]}(t))throw new n(Y,"Unsupported layer geometry type",{query:e});if(e.outSR)return j(e.geometry&&e.geometry.spatialReference,e.outSR)}}}function re(e){if(m(e))return!0;if(p(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}export{re as I,D as J,B as O,J as P,_ as U,V as Z,te as a,F as n,C as t,ee as v,W as z}