import{a$ as t,r as e}from"./p-5420851c.js";import{i as r,u as n}from"./p-8d730a3d.js";const o=new Map;o.set("meter-per-second",1),o.set("kilometer-per-hour",.277778),o.set("knots",.514444),o.set("feet-per-second",.3048),o.set("mile-per-hour",.44704);const a=180/Math.PI,s=new t({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function i(t,e){return o.get(t)/o.get(e)||1}function c(t){return(450-t)%360}function h(t,e="geographic"){const[r,n]=t,o=Math.sqrt(r*r+n*n);let s=Math.atan2(n,r)*a;return s=(360+s)%360,"geographic"===e&&(s=c(s)),[o,s]}function l(t,e="geographic"){let r=t[1];"geographic"===e&&(r=c(r)),r%=360;const n=t[0];return[n*Math.cos(r/a),n*Math.sin(r/a)]}function f(t,e,o="geographic",a=1){if(!r(t))return t;const{pixels:s,width:i,height:c}=t,f=i*c,u=s[0],M=s[1],p=n.createEmptyBand(t.pixelType,f),d=n.createEmptyBand(t.pixelType,f);let k=0;for(let t=0;t<c;t++)for(let t=0;t<i;t++)"vector-uv"===e?([p[k],d[k]]=h([u[k],M[k]],o),p[k]*=a):([p[k],d[k]]=l([u[k],M[k]],o),p[k]*=a,d[k]*=a),k++;const w=new n({pixelType:t.pixelType,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[p,d]});return w.updateStatistics(),w}function u(t,e,n=1){if(1===n||!r(t))return t;const o=t.clone(),{pixels:a,width:s,height:i}=o,c=a[0],h=a[1];let l=0;for(let t=0;t<i;t++)for(let t=0;t<s;t++)"vector-uv"===e?(c[l]*=n,h[l]*=n):c[l]*=n,l++;return o.updateStatistics(),o}function M(t,r,n,o,a){if(!e(a)||!a.spatialReference.equals(t.spatialReference))return{extent:t,width:r,height:n,resolution:t.width/r};const s=a.xmin,i=a.ymax;o=Math.max(o||0,30);const c=Math.ceil(r*(1/o)),h=Math.ceil(n*(1/o)),l=((t.xmax-t.xmin)/c+(t.ymax-t.ymin)/h)/2;return t.xmin=s+Math.floor((t.xmin-s)/l)*l,t.xmax=s+Math.ceil((t.xmax-s)/l)*l,t.ymin=i+Math.floor((t.ymin-i)/l)*l,t.ymax=i+Math.ceil((t.ymax-i)/l)*l,{extent:t,width:Math.round(t.width/l),height:Math.round(t.height/l),resolution:l}}const p=function(t=0,e=0,r=Math.PI,n=!0){n&&(r=(2*Math.PI-r)%(2*Math.PI));const o=n?-1:1,a=13*o,s=-7*o,i=-2*o,c=-16*o,h=29,[l,f]=k(0,e+a,r,h),[u,M]=k(t-5.5,e+s,r,h),[p,d]=k(t+5.5,e+s,r,h),[w,m]=k(t-1.5,e+i,r,h),[g,b]=k(t+1.5,e+i,r,h),[x,v]=k(t-1.5,e+c,r,h),[_,y]=k(t+1.5,e+c,r,h);return[l,f,u,M,w,m,g,b,p,d,x,v,_,y]}(0,0,0);function d(t=0,e=Math.PI,r=!0){r&&(e=(2*Math.PI-e)%(2*Math.PI));const n=r?-1:1,o=5*n,a=20*n,s=25*n,i=45,c=2*n;let[h,l]=[5,0-a],[f,u]=[h+2,l],[M,p]=[f-0,u+c],[d,w]=[-5,0-s],[m,g]=[d+0,w-c],b=Math.ceil(t/5),x=Math.floor(b/10);b-=8*x;const v=[],_=[];for(let t=0;t<b/2;t++,x--){x<=0&&b%2==1&&t===(b-1)/2&&(d=0,m=d+0,w=(w+l)/2,g=w-c);const[r,n]=k(d,w,e,i);if(x>0){const[t,o]=k(f,w,e,i),[a,s]=k(h,l,e,i);v.push(t),v.push(o),v.push(r),v.push(n),v.push(a),v.push(s)}else{const[t,o]=k(f,u,e,i),[a,s]=k(M,p,e,i),[c,h]=k(m,g,e,i);_.push(r),_.push(n),_.push(c),_.push(h),_.push(a),_.push(s),_.push(t),_.push(o)}w+=o,l+=o,u+=o,p+=o,g+=o}const[y,A]=k(5,0+a,e,i),[D,F]=k(7,0+a,e,i),[U,P]=k(5,0-s,e,i),[j,H]=k(7,0-s,e,i);return{pennants:v,barbs:_,shaft:[y,A,D,F,U,P,j,H]}}function k(t,e,r,n=1){const o=Math.sqrt(t*t+e*e)/n,a=(2*Math.PI+Math.atan2(e,t))%(2*Math.PI);return[o,(2*Math.PI+a-r)%(2*Math.PI)]}const w=[0,1,3,6,10,16,21,27,33,40,47,55,63],m=[0,.5,1,1.5,2],g=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function b(t,e,r,n){const o=i(n||"knots",r);let a;for(a=1;a<e.length;a++)if(a===e.length-1){if(t<e[a]*o)break}else if(t<=e[a]*o)break;return Math.min(a-1,e.length-2)}function x(t,e,r,n,o){let a=0;switch(e){case"beaufort_kn":a=b(t,w,"knots",r);break;case"beaufort_km":a=b(t,w,"kilometer-per-hour",r);break;case"beaufort_ft":a=b(t,w,"feet-per-second",r);break;case"beaufort_m":a=b(t,w,"meter-per-second",r);break;case"classified_arrow":a=b(t,o,n,r);break;case"ocean_current_m":a=b(t,m,"meter-per-second",r);break;case"ocean_current_kn":a=b(t,g,"knots",r)}return a}const v=[];function _(t,e){let r=0,n=0;const{width:o,height:a,mask:s}=t,i=t.pixels[0],c=[],h=[],l="wind_speed"===e.style?5:Number.MAX_VALUE;for(let t=0;t<a;t++)for(let e=0;e<o;e++){const f=t*o+e;if((!s||s[t*o+e])&&i[f]<l){for(let n=0;n<4;n++)c[r++]=(e+.5)/o,c[r++]=(t+.5)/a,c[r++]=n<2?-.5:.5,c[r++]=n%2==0?-.5:.5,c[r++]=0,c[r++]=i[f];const s=4*(r/24-1);h[n++]=s,h[n++]=s+1,h[n++]=s+2,h[n++]=s+1,h[n++]=s+2,h[n++]=s+3}}return{vertexData:new Float32Array(c),indexData:new Uint32Array(h)}}function y(t,e){return"simple_scalar"===e.style?_(t,e):"wind_speed"===e.style?function(t,e){if(0===v.length)for(let t=0;t<30;t++)v.push(d(5*t,0));const r=i(s.fromJSON(e.inputUnit),"knots"),{width:n,height:o,mask:a}=t,c=t.pixels[0],h=t.pixels[1],l=[],f=[];let u=0,M=0;for(let t=0;t<o;t++)for(let e=0;e<n;e++){const s=t*n+e,i=c[s]*r;if((!a||a[t*n+e])&&i>=5){var p;const r=null!=(p=(h[s]+360)%360/180*Math.PI)?p:2*Math.PI*Math.random(),{pennants:a,barbs:c,shaft:d}=v[Math.min(Math.floor(i/5),29)];if(a.length+c.length===0)continue;let k=l.length/6;const w=(e+.5)/n,m=(t+.5)/o;for(let t=0;t<a.length;t+=2)l[u++]=w,l[u++]=m,l[u++]=a[t],l[u++]=a[t+1]+r,l[u++]=0,l[u++]=i;for(let t=0;t<c.length;t+=2)l[u++]=w,l[u++]=m,l[u++]=c[t],l[u++]=c[t+1]+r,l[u++]=0,l[u++]=i;for(let t=0;t<d.length;t+=2)l[u++]=w,l[u++]=m,l[u++]=d[t],l[u++]=d[t+1]+r,l[u++]=0,l[u++]=i;for(let t=0;t<a.length/6;t++)f[M++]=k,f[M++]=k+1,f[M++]=k+2,k+=3;for(let t=0;t<c.length/8;t++)f[M++]=k,f[M++]=k+1,f[M++]=k+2,f[M++]=k+1,f[M++]=k+2,f[M++]=k+3,k+=4;f[M++]=k+0,f[M++]=k+1,f[M++]=k+2,f[M++]=k+1,f[M++]=k+3,f[M++]=k+2,k+=4}}return{vertexData:new Float32Array(l),indexData:new Uint32Array(f)}}(t,e):function(t,e){const{style:r,inputUnit:n,outputUnit:o,breakValues:a}=e,i=s.fromJSON(n),c=s.fromJSON(o);let h=0,l=0;const{width:f,height:u,mask:M}=t,d=t.pixels[0],k=t.pixels[1],w=M?M.filter((t=>t>0)).length:f*u,m=new Float32Array(42*w),g=new Uint32Array(15*w);for(let t=0;t<u;t++)for(let e=0;e<f;e++){const n=t*f+e;if(!M||M[t*f+e]){var b;const o=null!=(b=(k[n]+360)%360/180*Math.PI)?b:2*Math.PI*Math.random(),s=x(d[n],r,i,c,a);for(let r=0;r<p.length;r+=2)m[h++]=(e+.5)/f,m[h++]=(t+.5)/u,m[h++]=p[r],m[h++]=p[r+1]+o,m[h++]=s,m[h++]=d[n];const M=7*(h/42-1);g[l++]=M,g[l++]=M+1,g[l++]=M+2,g[l++]=M+0,g[l++]=M+4,g[l++]=M+3,g[l++]=M+0,g[l++]=M+2,g[l++]=M+3,g[l++]=M+2,g[l++]=M+5,g[l++]=M+3,g[l++]=M+5,g[l++]=M+6,g[l++]=M+3}}return{vertexData:m,indexData:g}}(t,e)}function A(t,e,r,o=[0,0],a=.5){const{width:s,height:i,mask:c}=t,[f,u]=t.pixels,[M,p]=o,d=Math.round((s-M)/r),k=Math.round((i-p)/r),w=d*k,m=new Float32Array(w),g=new Float32Array(w),b=new Uint8Array(w),x="vector-uv"===e;for(let t=0;t<k;t++)for(let e=0;e<d;e++){let n=0;const o=t*d+e,k=Math.max(0,t*r+p),w=Math.max(0,e*r+M),v=Math.min(i,k+r),_=Math.min(s,w+r);for(let t=k;t<v;t++)for(let e=w;e<_;e++){const r=t*s+e;if(!c||c[r]){n++;const t=x?[f[r],u[r]]:[f[r],(360+u[r])%360],[e,a]=x?t:l(t);m[o]+=e,g[o]+=a}}if(n>=(v-k)*(_-w)*(1-a)){b[o]=1;const[t,e]=h([m[o]/n,g[o]/n]);m[o]=t,g[o]=e}else b[o]=0,m[o]=0,g[o]=0}const v=new n({width:d,height:k,pixels:[m,g],mask:b});return v.updateStatistics(),v}export{A as S,y as U,_,h as c,f,i as h,s as i,M as m,u as p}