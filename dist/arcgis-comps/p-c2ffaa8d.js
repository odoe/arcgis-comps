import{D as e,bi as a,aK as t}from"./p-566b0715.js";import{m as l}from"./p-9ae46e68.js";import{b as n,j as s,c as o}from"./p-c8f716a9.js";import{f as c,h as m,t as r}from"./p-5e1a4bde.js";import"./p-fe01b82b.js";import"./p-84bf99cb.js";import"./p-57ae469d.js";import"./p-27ef204b.js";import"./p-3a2e88bf.js";import"./p-9e860e7b.js";import"./p-e4802f24.js";import"./p-d6725707.js";const u="picture-fill",i=120,p=document.createElement("canvas");function d(e,a){const t=p.getContext("2d"),l=[];return a&&(a.weight&&l.push(a.weight),a.size&&l.push(a.size+"px"),a.family&&l.push(a.family)),t.font=l.join(" "),t.measureText(e).width}function f(e){if(0===e.length)return 0;if(e.length>2){const a=t(1),l=parseFloat(e);switch(e.slice(-2)){case"px":return l;case"pt":return l*a;case"in":return 72*l*a;case"pc":return 12*l*a;case"mm":return 2.8346456692913384*l*a;case"cm":return 28.346456692913385*l*a}}return parseFloat(e)}function v(t,p){var v,h;const b=null!=(null==p?void 0:p.size)?a(p.size):null,y=null!=(null==p?void 0:p.maxSize)?a(p.maxSize):null,M=null!=(null==p?void 0:p.opacity)?p.opacity:null,j=null!=(null==p?void 0:p.rotation)?p.rotation:"angle"in t?t.angle:null,k=n(t);let L=s(t);if(k&&!L){const a="type"in k?null:new e(k);"#ffffff"===(a?a.toHex():null)&&(L={color:"#bdc3c7",width:.75})}const w={shape:null,fill:null,stroke:L,offset:[0,0]};null!=(v=L)&&v.width&&(L.width=Math.min(L.width,80));const x=(null==(h=L)?void 0:h.width)||0;let g=null!=b&&(null==(null==p?void 0:p.scale)||(null==p?void 0:p.scale)),F=0,P=0,z=!1;switch(t.type){case"simple-marker":{const e=t.style,l=Math.min(null!=b?b:a(t.size),y||i);switch(F=l,P=l,e){case"circle":w.shape={type:"circle",cx:0,cy:0,r:.5*l},g||(F+=x,P+=x);break;case"cross":w.shape={type:"path",path:[{command:"M",values:[0,.5*P]},{command:"L",values:[F,.5*P]},{command:"M",values:[.5*F,0]},{command:"L",values:[.5*F,P]}]};break;case"diamond":w.shape={type:"path",path:[{command:"M",values:[0,.5*P]},{command:"L",values:[.5*F,0]},{command:"L",values:[F,.5*P]},{command:"L",values:[.5*F,P]},{command:"Z",values:[]}]},g||(F+=x,P+=x);break;case"square":w.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[F,0]},{command:"L",values:[F,P]},{command:"L",values:[0,P]},{command:"Z",values:[]}]},g||(F+=x,P+=x),j&&(z=!0);break;case"triangle":w.shape={type:"path",path:[{command:"M",values:[.5*F,0]},{command:"L",values:[F,P]},{command:"L",values:[0,P]},{command:"Z",values:[]}]},g||(F+=x,P+=x),j&&(z=!0);break;case"x":w.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[F,P]},{command:"M",values:[F,0]},{command:"L",values:[0,P]}]},j&&(z=!0);break;case"path":w.shape={type:"path",path:t.path||""},g||(F+=x,P+=x),j&&(z=!0),g=!0}break}case"simple-line":{const e=Math.min(null!=b?b:x,y||80),a=e>22?2*e:40;L.width=e,F=a,P=e,w.shape={type:"path",path:[{command:"M",values:[0,P]},{command:"L",values:[F,P]}]};break}case u:case"simple-fill":F=Math.min(null!=b?b:22,y||i)+x,P=F,g=!0,w.shape="object"==typeof(null==p?void 0:p.symbolConfig)&&null!=p&&p.symbolConfig.isSquareFill?r.squareFill[0]:r.fill[0];break;case"picture-marker":{let e=a(t.width),l=a(t.height);const n=null!=b?b:Math.max(e,l),s=e/l;e=s<=1?Math.ceil(n*s):n,l=s<=1?n:Math.ceil(n/s),F=Math.min(e,y||i),P=Math.min(l,y||i),w.shape={type:"image",x:-Math.round(F/2),y:-Math.round(P/2),width:F,height:P,src:t.url||""},j&&(z=!0);break}case"text":{const e=t,l=e.text||"Aa",n=e.font,s=Math.min(null!=b?b:a(n.size),y||i),o=d(l,{weight:n.weight,size:s,family:n.family}),c=/[\uE600-\uE6FF]/.test(l);F=c?s:o,P=s;let m=.25*f((n?s:0).toString());c&&(m+=5),w.shape={type:"text",text:l,x:0,y:m,align:"middle",decoration:n&&n.decoration,rotated:e.rotated,kerning:e.kerning},w.font=n&&{size:s,style:n.style,decoration:n.decoration,weight:n.weight,family:n.family};break}}if(!w.shape)return Promise.reject(new l("symbolPreview: renderPreviewHTML2D","symbol not supported."));const D=k,Z=t.color;let E=null;return D&&"pattern"===D.type&&Z&&t.type!==u?E=o(D.src,Z.toCss(!0)).then((e=>(D.src=e,w.fill=D,w))):(w.fill=k,E=Promise.resolve(w)),E.then((e=>{const a=[[e]];if("object"==typeof(null==p?void 0:p.symbolConfig)&&null!=p&&p.symbolConfig.applyColorModulation){const t=.6*F;a.unshift([{...e,offset:[-t,0],fill:c(k,-.3)}]),a.push([{...e,offset:[t,0],fill:c(k,.3)}]),F+=2*t}return m(a,[F,P],{node:p&&p.node,scale:g,opacity:M,rotation:j,useRotationSize:z,effect:null==p?void 0:p.effect})}))}export{v as previewSymbol2D}