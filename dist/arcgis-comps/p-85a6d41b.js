import{N as e,af as t,cd as r,ci as n,dl as i,A as s,dn as o,dp as l,aK as a,dq as u,s as c,bt as f}from"./p-e58503d5.js";import{d as p,c as m,s as y,v as S}from"./p-c048b814.js";import{i as R,G as d,f as w,y as h,U as G,C as P,_ as v,D as j}from"./p-5032dfbd.js";import{t as M}from"./p-182bb5be.js";import{f as N,g}from"./p-e49308c6.js";import{z as I}from"./p-01e5a461.js";import{h as b}from"./p-b79fcce3.js";import{v as U}from"./p-c1cd5521.js";function F(e,t){if(!e)return null;const r=t.featureAdapter,{startTimeField:n,endTimeField:i}=e;let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;if(n&&i)t.forEach((e=>{const t=r.getAttribute(e,n),l=r.getAttribute(e,i);null==t||isNaN(t)||(s=Math.min(s,t)),null==l||isNaN(l)||(o=Math.max(o,l))}));else{const e=n||i;t.forEach((t=>{const n=r.getAttribute(t,e);null==n||isNaN(n)||(s=Math.min(s,n),o=Math.max(o,n))}))}return{start:s,end:o}}function C(e,t,r){if(!t||!e)return null;const{startTimeField:n,endTimeField:i}=e;if(!n&&!i)return null;const{start:s,end:o}=t;return null===s&&null===o?null:void 0===s&&void 0===o?()=>!1:n&&i?function(e,t,r,n,i){return null!=n&&null!=i?s=>{const o=e.getAttribute(s,t),l=e.getAttribute(s,r);return(null==o||o<=i)&&(null==l||l>=n)}:null!=n?t=>{const i=e.getAttribute(t,r);return null==i||i>=n}:null!=i?r=>{const n=e.getAttribute(r,t);return null==n||n<=i}:void 0}(r,n,i,s,o):function(e,t,r,n){return null!=r&&null!=n&&r===n?n=>e.getAttribute(n,t)===r:null!=r&&null!=n?i=>{const s=e.getAttribute(i,t);return s>=r&&s<=n}:null!=r?n=>e.getAttribute(n,t)>=r:null!=n?r=>e.getAttribute(r,t)<=n:void 0}(r,n||i,s,o)}const q=new e({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),_=Object.freeze({}),T=new M,E=new M,O=new M,x={esriGeometryPoint:d,esriGeometryPolyline:G,esriGeometryPolygon:P,esriGeometryMultipoint:v};function A(e,r,n,i=e.hasZ,s=e.hasM){if(t(r))return null;const o=e.hasZ&&i,l=e.hasM&&s;if(n){const t=R(O,r,e.hasZ,e.hasM,"esriGeometryPoint",n,i,s);return d(t,o,l)}return d(r,o,l)}function B(e,r,n,i,o,l,a=r,u=n){const c=r&&a,f=n&&u,p=s(i)?"coords"in i?i:i.geometry:null;if(t(p))return null;if(o){let t=w(E,p,r,n,e,o,a,u);return l&&(t=R(O,t,c,f,e,l)),x[e](t,c,f)}if(l){const t=R(O,p,r,n,e,l,a,u);return x[e](t,c,f)}return h(T,p,r,n,a,u),x[e](T,c,f)}async function D(e,t,r){const{outFields:n,orderByFields:i,groupByFieldsForStatistics:s,outStatistics:o}=e;if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(o)for(let e=0;e<o.length;e++)o[e].onStatisticField&&(o[e].onStatisticField=o[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),J(e,t,r)}async function J(e,s,o){if(!e)return null;let{where:l}=e;if(e.where=l=l&&l.trim(),(!l||/^1 *= *1$/.test(l)||s&&s===l)&&(e.where=null),!e.geometry)return e;let a=await async function(e){const{geometry:t,distance:s,units:o}=e;if(null==s||"vertexAttributes"in t)return t;const l=t.spatialReference,a=o?q.fromJSON(o):I(l),u=l&&(r(l)||n(l))?t:await N(l,i).then((()=>g(t,i)));return(await async function(){return(await import("./p-ce933f99.js")).geodesicBuffer}())(u.spatialReference,u,s,a)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;a=b(a),a.spatialReference=t}e.geometry=a,await N(a.spatialReference,o);const u=(await U(p(a)))[0];if(t(u))throw _;const c=u.toJSON(),f=await g(c,c.spatialReference,o);if(!f)throw _;return f.spatialReference=o,e.geometry=f,e}function K(e){return e&&W in e?JSON.parse(JSON.stringify(e,k)):e}const W="_geVersion",k=(e,t)=>e!==W?t:void 0;function z(e,t){return e?t?4:3:t?3:2}function V(e,t,r,n,i,s){const o=z(i,s),{coords:l,lengths:a}=n;if(!a)return!1;for(let n=0,i=0;n<a.length;n++,i+=o)if(!$(e,t,r,l[i],l[i+1]))return!1;return!0}function $(e,t,r,n,i){if(!e)return!1;const s=z(t,r),{coords:o,lengths:l}=e;let a=!1,u=0;for(const e of l)a=H(a,o,s,u,e,n,i),u+=e*s;return a}function H(e,t,r,n,i,s,o){let l=e,a=n;for(let e=n,u=n+i*r;e<u;e+=r){a=e+r,a===u&&(a=n);const i=t[e],c=t[e+1],f=t[a],p=t[a+1];(c<o&&p>=o||p<o&&c>=o)&&i+(o-c)/(p-c)*(f-i)<s&&(l=!l)}return l}const L="feature-store:unsupported-query",Q={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},X={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},Y={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},Z={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function ee(e,t,r,n,i){if(m(t)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=j(new M,t,!1,!1);return Promise.resolve((t=>function(e,t,r,n){return $(e,!1,!1,n.coords[0],n.coords[1])}(e,0,0,t)))}if(m(t)&&"esriGeometryMultipoint"===r){const r=j(new M,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((e=>V(r,!1,!1,e,n,i)))}if(y(t)&&"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((e=>a(t,B(r,n,i,e))));if(y(t)&&"esriGeometryMultipoint"===r&&"esriSpatialRelContains"===e)return Promise.resolve((e=>u(t,B(r,n,i,e))));if(y(t)&&"esriSpatialRelIntersects"===e){const e=function(e){return"mesh"===e?o:l(e)}(r);return Promise.resolve((s=>e(t,B(r,n,i,s))))}return import("./p-ce933f99.js").then((s=>{const o=s[Q[e]].bind(null,t.spatialReference,t);return e=>o(B(r,n,i,e))}))}async function te(e,t,r){const{spatialRel:n,geometry:i}=e;if(i){if(!function(e){return!0===X[e]}(n))throw new c(L,"Unsupported query spatial relationship",{query:e});if(f(i.spatialReference)&&f(r)){if(!function(e){return!0===Y[S(e)]}(i))throw new c(L,"Unsupported query geometry type",{query:e});if(!function(e){return!0===Z[e]}(t))throw new c(L,"Unsupported layer geometry type",{query:e});if(e.outSR)return N(e.geometry&&e.geometry.spatialReference,e.outSR)}}}function re(e){if(y(e))return!0;if(m(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}export{re as I,B as J,A as O,D as P,_ as U,J as Z,te as a,C as n,F as t,ee as v,K as z}