import{h as e}from"./p-e273719b.js";import{c as t,aZ as o}from"./p-e58503d5.js";import{u as r}from"./p-fb38a9d0.js";import{p as n,q as i}from"./p-765e6c28.js";import{t as l,E as a,j as s}from"./p-1a7268a2.js";import{o as c}from"./p-025c0c8e.js";import{s as f}from"./p-c048b814.js";import{l as u,e as m,a as h}from"./p-9e860e7b.js";import{s as S}from"./p-0923eebd.js";function d(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":{const t=e.symbolLayers;return t&&1===t.length?d(t[0]):null}case"CIMVectorMarker":{const t=e.markerGraphics;if(!t||1!==t.length)return null;const o=t[0];if(!o)return null;const r=o.geometry;if(!r)return null;const n=o.symbol;return!n||"CIMPolygonSymbol"!==n.type&&"CIMLineSymbol"!==n.type?null:{geom:r,asFill:"CIMPolygonSymbol"===n.type}}case"sdf":return{geom:e.geom,asFill:e.asFill}}return null}function y(e){let t=1/0,o=-1/0,r=1/0,n=-1/0;for(const i of e)for(const e of i)e[0]<t&&(t=e[0]),e[0]>o&&(o=e[0]),e[1]<r&&(r=e[1]),e[1]>n&&(n=e[1]);return new l(t,r,o-t,n-r)}function p(e){let t=1/0,o=-1/0,r=1/0,n=-1/0;for(const i of e)for(const e of i)e[0]<t&&(t=e[0]),e[0]>o&&(o=e[0]),e[1]<r&&(r=e[1]),e[1]>n&&(n=e[1]);return[t,r,o,n]}function M(e){return e?e.rings?p(e.rings):e.paths?p(e.paths):f(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null}function b(e,t,o,r,n){const[i,l,a,s]=e;if(a<i||s<l)return[0,0,0];const c=a-i,f=s-l,u=Math.floor(31.5),m=(128-2*(u+1))/Math.max(c,f),h=Math.round(c*m)+2*u,S=Math.round(f*m)+2*u;let d=1;t&&(d=S/m/(t.ymax-t.ymin));let y=0,p=0;return r&&(n?t&&o&&t.ymax-t.ymin>0&&(y=r.x/(o*((t.xmax-t.xmin)/(t.ymax-t.ymin))),p=r.y/o):(y=r.x,p=r.y)),y=.5*(t.xmax+t.xmin)+y*(t.xmax-t.xmin),p=.5*(t.ymax+t.ymin)+p*(t.ymax-t.ymin),y-=i,p-=l,y*=m,p*=m,y+=u,p+=u,[d,y/h-.5,-(p/S-.5)]}function C(e){const t=function(e){return e?e.rings?e.rings:e.paths?e.paths:void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:null}(e.geom),o=y(t),r=Math.floor(31.5),n=(128-2*(r+1))/Math.max(o.width,o.height),i=Math.round(o.width*n)+2*r,l=Math.round(o.height*n)+2*r,a=[];for(const i of t)if(i&&i.length>1){const t=[];for(const l of i){let[i,a]=l;i-=o.x,a-=o.y,i*=n,a*=n,i+=r-.5,a+=r-.5,t.push(e.asFill?[i,a]:[Math.round(i),Math.round(a)])}if(e.asFill){const e=t.length-1;t[0][0]===t[e][0]&&t[0][1]===t[e][1]||t.push(t[0])}a.push(t)}const s=function(e,t,o,r){const n=t*o,i=new Array(n),l=r*r+1;for(let e=0;e<n;++e)i[e]=l;for(const n of e){const e=n.length;for(let l=1;l<e;++l){const e=n[l-1],a=n[l];let s,c,f,u;e[0]<a[0]?(s=e[0],c=a[0]):(s=a[0],c=e[0]),e[1]<a[1]?(f=e[1],u=a[1]):(f=a[1],u=e[1]);let m=Math.floor(s)-r,h=Math.floor(c)+r,S=Math.floor(f)-r,d=Math.floor(u)+r;m<0&&(m=0),h>t&&(h=t),S<0&&(S=0),d>o&&(d=o);const y=a[0]-e[0],p=a[1]-e[1],M=y*y+p*p;for(let r=m;r<h;r++)for(let n=S;n<d;n++){let l,s,c=(r-e[0])*y+(n-e[1])*p;c<0?(l=e[0],s=e[1]):c>M?(l=a[0],s=a[1]):(c/=M,l=e[0]+c*y,s=e[1]+c*p);const f=(r-l)*(r-l)+(n-s)*(n-s),u=(o-n-1)*t+r;f<i[u]&&(i[u]=f)}}}for(let e=0;e<n;++e)i[e]=Math.sqrt(i[e]);return i}(a,i,l,r);return e.asFill&&function(e,t,o,r,n){for(const i of e){const e=i.length;for(let l=1;l<e;++l){const e=i[l-1],a=i[l];let s,c,f,u;e[0]<a[0]?(s=e[0],c=a[0]):(s=a[0],c=e[0]),e[1]<a[1]?(f=e[1],u=a[1]):(f=a[1],u=e[1]);let m=Math.floor(s),h=Math.floor(c)+1,S=Math.floor(f),d=Math.floor(u)+1;m<r&&(m=r),h>t-r&&(h=t-r),S<r&&(S=r),d>o-r&&(d=o-r);for(let i=S;i<d;++i){if(e[1]>i==a[1]>i)continue;const l=(o-i-1)*t;for(let t=m;t<h;++t)t<(a[0]-e[0])*(i-e[1])/(a[1]-e[1])+e[0]&&(n[l+t]=-n[l+t]);for(let e=r;e<m;++e)n[l+e]=-n[l+e]}}}}(a,i,l,r,s),[O(s,r),i,l]}function O(e,t){const o=2*t,r=e.length,n=new Uint8Array(4*r);for(let t=0;t<r;++t)c(.5-e[t]/o,n,4*t);return n}const k=t.getLogger("esri.symbols.cim.cimAnalyzer");function g(e){switch(e){case"Butt":return 0;case"Square":return 2;default:return 1}}function I(e){switch(e){case"Bevel":return 0;case"Miter":return 2;default:return 1}}function P(e){switch(e){default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function N(e){switch(e){default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function J(e,t,o,r){let n;e[t]?n=e[t]:(n={},e[t]=n),n[o]=r}function v(e){const t=e.markerPlacement;return t&&t.angleToLine?1:0}async function H(e,t,o,r,i){const l=null!=r?r:[];if(!e)return l;let c,f;const u={};if("CIMSymbolReference"!==e.type)return k.error("Expect cim type to be 'CIMSymbolReference'"),l;if(c=e.symbol,f=e.primitiveOverrides,f){const e=[];for(const o of f){const r=o.valueExpressionInfo;if(r&&t){const i=n(r.expression,t.spatialReference,t.fields).then((e=>{e&&J(u,o.primitiveName,o.propertyName,e)}));e.push(i)}else null!=o.value&&J(u,o.primitiveName,o.propertyName,o.value)}e.length>0&&await Promise.all(e)}const m=[];switch(U(c,o,m),m.length>0&&await Promise.all(m),c.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":!function(e,t,o,r,n,i,l){if(!e)return;const c=e.symbolLayers;if(!c)return;const f=e.effects;let u;const m=a.getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(u=1);let h=c.length;for(;h--;){const a=c[h];if(!a||!1===a.enable)continue;let S;f&&f.length&&(S=[...f]);const d=a.effects;d&&d.length&&(f?S.push(...d):S=[...d]);const y=[];switch(s.findApplicableOverrides(a,t,y),a.type){case"CIMSolidFill":X(a,S,o,y,r,n);break;case"CIMPictureFill":w(a,S,o,y,r,n);break;case"CIMHatchFill":z(a,S,o,y,r,n);break;case"CIMGradientFill":L(a,S,o,y,r,n);break;case"CIMSolidStroke":Y(a,S,o,y,r,n,"CIMPolygonSymbol"===e.type,m);break;case"CIMPictureStroke":R(a,S,o,y,r,n,"CIMPolygonSymbol"===e.type,m);break;case"CIMGradientStroke":$(a,S,o,y,r,n,"CIMPolygonSymbol"===e.type,m);break;case"CIMCharacterMarker":if(A(a,S,o,y,r,n))break;break;case"CIMPictureMarker":if(A(a,S,o,y,r,n))break;"CIMLineSymbol"===e.type&&(u=v(a)),F(a,S,o,y,r,n,u,m);break;case"CIMVectorMarker":if(A(a,S,o,y,r,n))break;"CIMLineSymbol"===e.type&&(u=v(a)),j(a,S,o,y,r,n,i,u,m,l);break;default:k.error("Cannot analyze CIM layer",a.type)}}}(c,f,u,t,l,o,i)}return l}function X(e,t,r,n,i,l){const a=e.primitiveName,s=u(e.color),[c,f]=V(n,a),m=o(JSON.stringify(e)+f).toString();l.push({type:"fill",templateHash:m,materialHash:c?()=>m:m,cim:e,materialOverrides:null,colorLocked:e.colorLocked,color:q(a,r,"Color",i,s,D),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:t})}function w(e,t,r,n,i,l){const a=e.primitiveName,s=e.tintColor?u(e.tintColor):{r:255,g:255,b:255,a:1},[c,f]=V(n,a),m=o(JSON.stringify(e)+f).toString(),h=o(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString();l.push({type:"fill",templateHash:m,materialHash:c?()=>h:h,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,color:q(a,r,"TintColor",i,s,D),height:q(a,r,"Height",i,e.height),scaleX:q(a,r,"ScaleX",i,e.scaleX),angle:q(a,r,"Rotation",i,e.rotation),offsetX:q(a,r,"OffsetX",i,e.offsetX),offsetY:q(a,r,"OffsetY",i,e.offsetY),url:e.url})}function z(e,t,r,n,i,l){const a=["Rotation","OffsetX","OffsetY"],s=n.filter((t=>t.primitiveName!==e.primitiveName&&-1===a.indexOf(t.propertyName))),c=e.primitiveName,[f,u]=V(n,c),m=o(JSON.stringify(e)+u).toString(),h=o(`${e.separation}${JSON.stringify(e.lineSymbol)}`).toString();l.push({type:"fill",templateHash:m,materialHash:f?B(h,r,s,i):h,cim:e,materialOverrides:s,colorLocked:e.colorLocked,effects:t,color:{r:255,g:255,b:255,a:1},height:q(c,r,"Separation",i,e.separation),scaleX:1,angle:q(c,r,"Rotation",i,e.rotation),offsetX:q(c,r,"OffsetX",i,e.offsetX),offsetY:q(c,r,"OffsetY",i,e.offsetY)})}function L(e,t,r,n,i,l){const a=e.primitiveName,[s,c]=V(n,a),f=o(JSON.stringify(e)+c).toString();l.push({type:"fill",templateHash:f,materialHash:s?B(f,r,n,i):f,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function Y(e,t,r,n,i,l,a,s){const c=e.primitiveName,f=u(e.color),m=void 0!==e.width?e.width:4,h=g(e.capStyle),S=I(e.joinStyle),d=e.miterLimit,[y,p]=V(n,c),M=o(JSON.stringify(e)+p).toString();let b,C;if(t&&t.length>0){const o=t[t.length-1];if("CIMGeometricEffectDashes"===o.type&&"NoConstraint"===o.lineDashEnding){const o=(t=[...e.effects]).pop();b=o.dashTemplate,C=o.scaleDash}}l.push({type:"line",templateHash:M,materialHash:y?()=>M:M,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:t,color:q(c,r,"Color",i,f,D),width:q(c,r,"Width",i,m),cap:q(c,r,"CapStyle",i,h),join:q(c,r,"JoinStyle",i,S),miterLimit:q(c,r,"MiterLimit",i,d),referenceWidth:s,zOrder:T(e.name),dashTemplate:b,scaleDash:C})}function R(e,t,r,n,i,l,a,s){const c=o(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),f=e.primitiveName,m=u(e.tintColor),h=void 0!==e.width?e.width:4,S=g(e.capStyle),d=I(e.joinStyle),y=e.miterLimit,[p,M]=V(n,f),b=o(JSON.stringify(e)+M).toString();l.push({type:"line",templateHash:b,materialHash:p?()=>c:c,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:t,color:q(f,r,"TintColor",i,m,D),width:q(f,r,"Width",i,h),cap:q(f,r,"CapStyle",i,S),join:q(f,r,"JoinStyle",i,d),miterLimit:q(f,r,"MiterLimit",i,y),referenceWidth:s,zOrder:T(e.name),dashTemplate:null,scaleDash:!1,url:e.url})}function $(e,t,r,n,i,l,a,s){const c=e.primitiveName,f=void 0!==e.width?e.width:4,u=g(e.capStyle),m=I(e.joinStyle),h=e.miterLimit,[S,d]=V(n,c),y=o(JSON.stringify(e)+d).toString();l.push({type:"line",templateHash:y,materialHash:S?B(y,r,n,i):y,cim:e,materialOverrides:null,isOutline:a,colorLocked:e.colorLocked,effects:t,color:{r:128,g:128,b:128,a:1},width:q(c,r,"Width",i,f),cap:q(c,r,"CapStyle",i,u),join:q(c,r,"JoinStyle",i,m),miterLimit:q(c,r,"MiterLimit",i,h),referenceWidth:s,zOrder:T(e.name),dashTemplate:null,scaleDash:!1})}function A(e,t,r,n,i,l){const a=e.markerPlacement;if(!a||"CIMMarkerPlacementInsidePolygon"!==a.type)return!1;const s=a,c=["Rotation","OffsetX","OffsetY"],f=n.filter((t=>t.primitiveName!==e.primitiveName&&-1===c.indexOf(t.propertyName))),u="url"in e?e.url:null,[m,h]=V(n,s.primitiveName),S=o(JSON.stringify(e)+h).toString();let d=s.stepY,y=null,p=1;return a.shiftOddRows&&(d*=2,y=function(e){return e?2*e:0},p=.5),l.push({type:"fill",templateHash:S,materialHash:m?B(S,r,f,i):S,cim:e,materialOverrides:f,colorLocked:e.colorLocked,effects:t,color:{r:255,g:255,b:255,a:1},height:q(s.primitiveName,r,"StepY",i,d,y),scaleX:p,angle:q(s.primitiveName,r,"GridAngle",i,s.gridAngle),offsetX:q(s.primitiveName,r,"OffsetX",i,s.offsetX),offsetY:q(s.primitiveName,r,"OffsetY",i,s.offsetY),url:u}),!0}function F(e,t,r,n,i,l,a,s){var c;const f=e.primitiveName,m=e.size,h=e.scaleX,S=e.rotation,d=e.offsetX,y=e.offsetY,p=e.tintColor?u(e.tintColor):{r:255,g:255,b:255,a:1},M=o(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),[b,C]=V(n,f),O=o(JSON.stringify(e)+C).toString(),k=null!=(c=e.anchorPoint)?c:{x:0,y:0};l.push({type:"marker",templateHash:O,materialHash:b?()=>M:M,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:!1,alignment:a,size:q(f,r,"Size",i,m),scaleX:q(f,r,"ScaleX",i,h),rotation:q(f,r,"Rotation",i,S),offsetX:q(f,r,"OffsetX",i,d),offsetY:q(f,r,"OffsetY",i,y),color:q(f,r,"TintColor",i,p,D),anchorPoint:{x:k.x,y:-k.y},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:e.rotateClockwise,referenceSize:s,sizeRatio:1,markerPlacement:e.markerPlacement,url:e.url})}function j(e,t,o,r,n,i,l,a,s,c){const f=e.markerGraphics;if(!f)return;let u=0;if(e.scaleSymbolsProportionally){const t=e.frame;t&&(u=t.ymax-t.ymin)}for(const m of f)if(m){const f=m.symbol;if(!f)continue;switch(f.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":W(e,t,m,r,o,n,i,l,a,s,u,c);break;case"CIMTextSymbol":x(e,t,m,o,r,n,i,a,s,u)}}}function x(e,t,r,n,i,l,c,f,S,d){s.findApplicableOverrides(r,i,[]);const y=r.geometry;if(!("x"in y)||!("y"in y))return;const p=r.symbol,M=function(e){return e.underline?"underline":e.strikethrough?"line-through":"none"}(p),b=function(e){let t="normal",o="normal";if(e){const r=e.toLowerCase();-1!==r.indexOf("italic")?t="italic":-1!==r.indexOf("oblique")&&(t="oblique"),-1!==r.indexOf("bold")?o="bold":-1!==r.indexOf("light")&&(o="lighter")}return{style:t,weight:o}}(p.fontStyleName);p.font={family:p.fontFamilyName,decoration:M,...b};const C=e.frame,O=e.size/d,k=e.primitiveName,g=(p.height||0)*O,I=p.angle||0,J=((p.offsetX||0)+(y.x-.5*(C.xmin+C.xmax)))*O,v=((p.offsetY||0)+(y.y-.5*(C.ymin+C.ymax)))*O,H=u(a.getFillColor(p));let X=u(a.getStrokeColor(p)),w=a.getStrokeWidth(p);w||(X=u(a.getFillColor(p.haloSymbol)),w=p.haloSize*O);const[z,L]=V(i,k),Y=JSON.stringify(e.effects)+Number(e.colorLocked)+JSON.stringify(e.anchorPoint)+e.anchorPointUnits+JSON.stringify(e.markerPlacement),R=o(JSON.stringify(r)+Y+L).toString(),$=o(JSON.stringify(p.font)).toString(),A=q(r.primitiveName,n,"TextString",l,r.textString,h,p.textCase),{fontFamilyName:F,fontStyleName:j}=p,x=F.toLowerCase()+(j&&j.length>0?"-"+j.toLowerCase():"-regular");c.push({type:"text",templateHash:R,materialHash:z||"function"==typeof A||A.match(/\[([\w]+)\]/)?(e,t,o)=>$+"-"+m(A,e,t,o):$+"-"+o(A),cim:p,materialOverrides:null,colorLocked:e.colorLocked,effects:t,alignment:f,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:x,decoration:M,weight:q(k,n,"Weight",l,b.weight),style:q(k,n,"Size",l,b.style),size:q(k,n,"Size",l,g),angle:q(k,n,"Rotation",l,I),offsetX:q(k,n,"OffsetX",l,J),offsetY:q(k,n,"OffsetY",l,v),horizontalAlignment:P(p.horizontalAlignment),verticalAlignment:N(p.verticalAlignment),text:A,color:H,outlineColor:X,outlineSize:w,referenceSize:S,sizeRatio:1,markerPlacement:e.markerPlacement})}function W(e,t,r,n,i,l,s,c,f,m,h,S){const d=r.geometry;if(!d)return;const y=r.symbol.symbolLayers;if(!y)return;if(S)return void G(e,t,r,i,n,l,s,c,f,m,h);let p=y.length;if(2!==p||!y[0].enable||!y[1].enable||"CIMSolidStroke"!==y[0].type||"CIMSolidFill"!==y[1].type||y[0].effects||y[1].effects)for(;p--;){const S=y[p];if(S&&!1!==S.enable)switch(S.type){case"CIMSolidFill":case"CIMSolidStroke":{var C,O,k,g;const c=M(d);if(!c)continue;const[y,p,I]=b(c,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),P="CIMSolidFill"===S.type,N={type:"sdf",geom:d,asFill:P},J=e.primitiveName,v=null!=(C=e.size)?C:10,H=null!=(O=e.rotation)?O:0,X=null!=(k=e.offsetX)?k:0,w=null!=(g=e.offsetY)?g:0,z=S.path,L=S.primitiveName,Y=u(P?a.getFillColor(S):a.getStrokeColor(S)),R=P?{r:0,g:0,b:0,a:0}:u(a.getStrokeColor(S)),$=a.getStrokeWidth(S);if(!P&&!$)break;let A=!1,F="";for(const e of n)e.primitiveName!==L&&e.primitiveName!==J||(void 0!==e.value?F+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(A=!0));const j=JSON.stringify({...e,markerGraphics:null}),x=o(JSON.stringify(N)+z).toString(),W={type:"marker",templateHash:o(JSON.stringify(r)+JSON.stringify(S)+j+F).toString(),materialHash:A?()=>x:x,cim:N,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:f,anchorPoint:{x:p,y:I},isAbsoluteAnchorPoint:!1,size:q(e.primitiveName,i,"Size",l,v),rotation:q(e.primitiveName,i,"Rotation",l,H),offsetX:q(e.primitiveName,i,"OffsetX",l,X),offsetY:q(e.primitiveName,i,"OffsetY",l,w),scaleX:1,frameHeight:h,rotateClockwise:e.rotateClockwise,referenceSize:m,sizeRatio:y,color:q(L,i,"Color",l,Y,D),outlineColor:q(L,i,"Color",l,R,D),outlineWidth:q(L,i,"Width",l,$),markerPlacement:e.markerPlacement,path:z};s.push(W);break}default:G(e,t,r,i,n,l,s,c,f,m,h)}}else!function(e,t,r,n,i,l,s,c,f,m){const h=t.geometry,S=r[0],d=r[1],y=M(h);if(!y)return;const[p,C,O]=b(y,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),k={type:"sdf",geom:h,asFill:!0},g=e.primitiveName,I=e.size,P=e.rotation||0,N=e.offsetX,J=e.offsetY,v=d.path,H=d.primitiveName,X=S.primitiveName,w=u(a.getFillColor(d)),z=u(a.getStrokeColor(S)),L=a.getStrokeWidth(S);let Y=!1,R="";for(const e of n)e.primitiveName!==H&&e.primitiveName!==X&&e.primitiveName!==g||(void 0!==e.value?R+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(Y=!0));const $=JSON.stringify({...e,markerGraphics:null}),A=o(JSON.stringify(k)+v).toString(),F={type:"marker",templateHash:o(JSON.stringify(t)+JSON.stringify(d)+JSON.stringify(S)+$+R).toString(),materialHash:Y?()=>A:A,cim:k,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:c,anchorPoint:{x:C,y:O},isAbsoluteAnchorPoint:!1,size:q(e.primitiveName,i,"Size",l,I),rotation:q(e.primitiveName,i,"Rotation",l,P),offsetX:q(e.primitiveName,i,"OffsetX",l,N),offsetY:q(e.primitiveName,i,"OffsetY",l,J),scaleX:1,frameHeight:m,rotateClockwise:e.rotateClockwise,referenceSize:f,sizeRatio:p,color:q(H,i,"Color",l,w,D),outlineColor:q(X,i,"Color",l,z,D),outlineWidth:q(X,i,"Width",l,L),markerPlacement:e.markerPlacement,path:v};s.push(F)}(e,r,y,n,i,l,s,f,m,h)}function G(e,t,n,i,l,s,c,f,u,m,h){const S=function(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath,effects:e.effects}}(e,n);let d=[];const y=["Rotation","OffsetX","OffsetY"];d=l.filter((t=>t.primitiveName!==e.primitiveName||-1===y.indexOf(t.propertyName)));let p="";for(const e of l)void 0!==e.value&&(p+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`);const[M,b,C]=a.getTextureAnchor(S,f),O=e.primitiveName,k=e.rotation||0,g=e.offsetX||0,I=e.offsetY||0,P=o(JSON.stringify(S)+p).toString(),N={type:"marker",templateHash:P,materialHash:0===d.length?P:B(P,i,d,s),cim:S,materialOverrides:d,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:u,anchorPoint:{x:M,y:b},isAbsoluteAnchorPoint:!1,size:e.size,rotation:q(O,i,"Rotation",s,k),offsetX:q(O,i,"OffsetX",s,g),offsetY:q(O,i,"OffsetY",s,I),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:h,rotateClockwise:e.rotateClockwise,referenceSize:m,sizeRatio:C/r(e.size),markerPlacement:e.markerPlacement};c.push(N)}function T(e){if(e&&0===e.indexOf("Level_")){const t=parseInt(e.substr(6),10);if(NaN!==t)return t}return 0}function D(t){if(!t||0===t.length)return null;const o=new e(t).toRgba();return{r:o[0],g:o[1],b:o[2],a:o[3]}}function q(e,t,o,r,n,l,a){const s=t[e];if(s){const e=s[o];if("string"==typeof e||"number"==typeof e||e instanceof Array)return l?l.call(null,e,a):e;if(null!=e&&e instanceof i)return(t,o,i)=>{let s=S(e,t,{$view:i},r.geometryType,o);return null!==s&&l&&(s=l.call(null,s,a)),null!==s?s:n}}return n}function B(e,t,r,n){for(const e of r)if(e.valueExpressionInfo){const o=t[e.primitiveName]&&t[e.primitiveName][e.propertyName];o instanceof i&&(e.fn=(e,t,r)=>S(o,e,{$view:r},n.geometryType,t))}return(t,n,i)=>{for(const e of r)e.fn&&(e.value=e.fn(t,n,i));return o(e+s.buildOverrideKey(r)).toString()}}function E(e,t){if(!t||0===t.length)return e;const o=JSON.parse(JSON.stringify(e));return s.applyOverrides(o,t),o}function V(e,t){let o=!1,r="";for(const n of e)n.primitiveName===t&&(void 0!==n.value?r+=`-${n.primitiveName}-${n.propertyName}-${JSON.stringify(n.value)}`:n.valueExpressionInfo&&(o=!0));return[o,r]}function U(e,t,o){if(e&&t)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=e.symbolLayers;if(!r)return;for(const e of r)switch(e.type){case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMCharacterMarker":case"CIMPictureMarker":"url"in e&&e.url&&o.push(t.fetchResource(e.url,null));break;case"CIMVectorMarker":{const r=e.markerGraphics;if(!r)continue;for(const e of r)if(e){const r=e.symbol;r&&U(r,t,o)}}}}}}export{H as C,E as G,C as m,d as r}