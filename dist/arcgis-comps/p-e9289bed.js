import{W as t,g as s,dm as i,jR as h,bg as e,bO as r,be as n,bd as o,bc as u,dr as a,bZ as c,al as l,dd as d,e as f,i as p,aH as m,cH as b}from"./p-7b6f6c18.js";import{s as g}from"./p-c3db99c7.js";import{r as w,E as y,I as v}from"./p-804725e3.js";import{i as j,f as A,o as x}from"./p-fb136006.js";import{h as M,f as C}from"./p-54e8960f.js";import"./p-1dd7027e.js";import{s as _}from"./p-5c077b4e.js";import{o as U}from"./p-d284d67f.js";import{m as k}from"./p-10e211d9.js";import{G as T}from"./p-e53f77c2.js";import"./p-227a5838.js";import"./p-47e1bd73.js";import"./p-1088d11f.js";import"./p-a4a5967b.js";import"./p-033339b0.js";import"./p-a16c2b1d.js";import"./p-df9635e1.js";import"./p-cede17c2.js";import"./p-ea65d9c9.js";import"./p-b392deaf.js";import"./p-9790d1b4.js";import"./p-55e3d31e.js";import"./p-9f705d18.js";import"./p-ec834938.js";import"./p-dede18bd.js";import"./p-e991a11e.js";import"./p-5bfd1d7e.js";import"./p-4414d64f.js";import"./p-a617738c.js";import"./p-167d094f.js";import"./p-97ec6ae5.js";const E=4294967296;class R{constructor(t){this._head=t,this._cursor=t}static from(t){const s=S.from(new Float32Array(t));return new R(s)}get id(){return this._cursor.id}get baseZoom(){return this._cursor.baseZoom}get anchorX(){return this._cursor.anchorX}get anchorY(){return this._cursor.anchorY}get directionX(){return this._cursor.directionX}get directionY(){return this._cursor.directionY}get size(){return this._cursor.size}get materialKey(){return this._cursor.materialKey}get boundsCount(){return this._cursor.boundsCount}computedMinZoom(){return this._cursor.computedMinZoom()}setComputedMinZoom(t){return this._cursor.setComputedMinZoom(t)}boundsComputedAnchorX(t){return this._cursor.boundsComputedAnchorX(t)}boundsComputedAnchorY(t){return this._cursor.boundsComputedAnchorY(t)}setBoundsComputedAnchorX(t,s){return this._cursor.setBoundsComputedAnchorX(t,s)}setBoundsComputedAnchorY(t,s){return this._cursor.setBoundsComputedAnchorY(t,s)}boundsX(t){return this._cursor.boundsX(t)}boundsY(t){return this._cursor.boundsY(t)}boundsWidth(t){return this._cursor.boundsWidth(t)}boundsHeight(t){return this._cursor.boundsHeight(t)}link(s){if(t(s._head))return this._cursor.link(s._head)}getCursor(){return this.copy()}copy(){var t;const s=new R(null==(t=this._head)?void 0:t.copy());if(!s._head)return s;let i=s._head,h=s._head._link;for(;h;)i._link=h.copy(),i=h,h=i._link;return s}peekId(){var t;return null!=(t=this._cursor.peekId())?t:this._cursor._link.peekId()}nextId(){const t=this.id;for(;t===this.id;)if(!this.next())return!1;return!0}save(){this._savedCursor=this._cursor,this._savedOffset=this._cursor._offset}restore(){this._cursor=this._savedCursor,this._cursor._offset=this._savedOffset}next(){if(!this._cursor)return!1;if(!this._cursor.next()){if(!this._cursor._link)return!1;this._cursor=this._cursor._link,this._cursor._offset=0}return!0}lookup(t){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(t);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor}delete(s){let i=this._head,h=null;for(;i;){if(i.delete(s))return i.isEmpty()&&t(h)&&(h._link=i._link),!0;h=i,i=i._link}return!1}}class S{constructor(t){this._offset=-1,this._link=null,this._count=0,this._deletedCount=0,this._offsets={instance:null},this._buffer=t}static from(t){return new S(new Float32Array(t))}isEmpty(){return this._deletedCount===this.count}get count(){return this._count||(this._count=this._computeCount()),this._count}get id(){return this._buffer[this._offset+0]}set id(t){this._buffer[this._offset+0]=t}get baseZoom(){return this._buffer[this._offset+1]}get anchorX(){return this._buffer[this._offset+2]}get anchorY(){return this._buffer[this._offset+3]}get directionX(){return this._buffer[this._offset+4]}get directionY(){return this._buffer[this._offset+5]}get size(){return this._buffer[this._offset+6]}get materialKey(){return this._buffer[this._offset+7]}computedMinZoom(){return this._buffer[this._offset+8]}setComputedMinZoom(t){this._buffer[this._offset+8]=t}get boundsCount(){return this._buffer[this._offset+9]}boundsComputedAnchorX(t){return this._buffer[this._offset+10+6*t+0]}boundsComputedAnchorY(t){return this._buffer[this._offset+10+6*t+1]}setBoundsComputedAnchorX(t,s){this._buffer[this._offset+10+6*t+0]=s}setBoundsComputedAnchorY(t,s){this._buffer[this._offset+10+6*t+1]=s}boundsX(t){return this._buffer[this._offset+10+6*t+2]}boundsY(t){return this._buffer[this._offset+10+6*t+3]}boundsWidth(t){return this._buffer[this._offset+10+6*t+4]}boundsHeight(t){return this._buffer[this._offset+10+6*t+5]}link(t){let s=this;for(;s._link;)s=s._link;s._link=t}getCursor(){return this.copy()}copy(){const t=new S(this._buffer);return t._link=this._link,t._offset=this._offset,t._deletedCount=this._deletedCount,t._offsets=this._offsets,t._count=this._count,t}peekId(){const t=this._offset+10+6*this.boundsCount+0;return t>=this._buffer.length?0:this._buffer[t]}next(){let t=0;for(;this._offset<this._buffer.length&&t++<100&&(-1===this._offset?this._offset=0:this._offset+=10+6*this.boundsCount,this.id===E););return this.id!==E&&this._offset<this._buffer.length}delete(t){const s=this._offset,i=this.lookup(t);if(i)for(this.id=4294967295,++this._deletedCount;this.next()&&this.id===t;)this.id=4294967295,++this._deletedCount;return this._offset=s,i}lookup(t){const i=this._offset;if(s(this._offsets.instance)){this._offsets.instance=new Map;const t=this.copy();t._offset=-1;let s=0;for(;t.next();)t.id!==s&&(this._offsets.instance.set(t.id,t._offset),s=t.id)}return!!this._offsets.instance.has(t)&&(this._offset=this._offsets.instance.get(t),this.id!==E||(this._offset=i,!1))}_computeCount(){const t=this._offset;let s=0;for(this._offset=-1;this.next();)s++;return this._offset=t,s}}class X{constructor(t){if(!Array.isArray(t))return void(this.data=t);this.data=t[0];let s=this;for(let i=1;i<t.length;i++)s.next=new X([t[i]]),s=s.next}*values(){let t=this;for(;t;)yield t.data,t=t.next}forEach(t){let s=this;for(;s;)t(s.data),s=s.next}find(t){var s;return t(this.data)?this:null==(s=this.next)?void 0:s.find(t)}max(t,s=this){const i=t(this.data)>t(s.data)?this:s;return this.next?this.next.max(t,i):i}remove(t,s=null){return this===t?s?(s.next=this.next,s):this.next:this.next.remove(t,this)}get last(){return this.next?this.next.last:this}}class Y{constructor(t){this._head=null,s(t)||(this._head=new X(t))}get head(){return this._head}maxAvailableSpace(){if(s(this._head))return 0;const t=this._head.max((t=>t.end-t.start));return t.data.end-t.data.start}firstFit(t){if(s(this._head))return null;let i=null,h=this._head;for(;h;){const s=h.data.end-h.data.start;if(s===t)return i?i.next=h.next:this._head=h.next,h.data.start;if(s>t){const s=h.data.start;return h.data.start+=t,s}i=h,h=h.next}return null}free(t,i){const h=t+i;if(s(this._head)){const s=new X({start:t,end:h});return void(this._head=s)}if(h<=this._head.data.start){if(h===this._head.data.start)return void(this._head.data.start-=i);const s=new X({start:t,end:h});return s.next=this._head,void(this._head=s)}let e=this._head,r=e.next;for(;r;){if(r.data.start>=h){if(e.data.end===t)return void(e.data.end+=i);if(r.data.start===h)return void(r.data.start-=i);const s=new X({start:t,end:h});return s.next=e.next,void(e.next=s)}e=r,r=r.next}if(t===e.data.end)return void(e.data.end+=i);const n=new X({start:t,end:h});e.next=n}}class B{constructor(t,s,i,h,e){this.target=t,this.geometryType=s,this.materialKey=i,this.indexFrom=h,this.indexCount=e}get indexEnd(){return this.indexFrom+this.indexCount}extend(t){this.indexCount+=t}draw(t,s,i){this.target.draw(t,s,i,this.indexFrom,this.indexCount)}}class F{constructor(t,s){this.geometryType=0,this._target=t,this.geometryType=s}static from(s,i,h,e){const r=new F(s,i);if(t(e))for(const t of e)h.seekIndex(t),r.addRecord(h);else for(;h.next();)r.addRecord(h);return r}addRecord(t){const i=this._target,h=this.geometryType,e=t.materialKey,r=t.indexFrom,n=t.indexCount;if(s(this._head)){const t=new B(i,h,e,r,n);return void(this._head=new X(t))}let o=null,u=this._head;for(;u;){if(r<u.data.indexFrom)return this._insert(e,r,n,o,u);o=u,u=u.next}this._insert(e,r,n,o,null)}forEach(s){t(this._head)&&this._head.forEach(s)}*infos(){if(t(this._head))for(const t of this._head.values())yield t}_insert(i,h,e,r,n){if(s(r)&&s(n)){const t=new B(this._target,this.geometryType,i,h,e);this._head=new X(t)}return s(r)&&t(n)?this._insertAtHead(i,h,e,n):t(r)&&s(n)?this._insertAtEnd(i,h,e,r):t(r)&&t(n)?this._insertAtMiddle(i,h,e,r,n):void 0}_insertAtHead(t,s,i,h){if(t===h.data.materialKey&&s+i===h.data.indexFrom)h.data.indexFrom=s,h.data.indexCount+=i;else{const e=new B(this._target,this.geometryType,t,s,i);this._head=new X(e),this._head.next=h}}_insertAtEnd(t,s,i,h){if(h.data.materialKey===t&&h.data.indexEnd===s)h.data.indexCount+=i;else{const e=new B(this._target,this.geometryType,t,s,i),r=new X(e);h.next=r}}_insertAtMiddle(t,s,i,h,e){const r=s+i;if(h.data.materialKey===t&&h.data.indexEnd===s)h.data.indexCount+=i,h.data.materialKey===e.data.materialKey&&h.data.indexEnd===e.data.indexFrom&&(h.data.indexCount+=e.data.indexCount,h.next=e.next);else if(t===e.data.materialKey&&r===e.data.indexFrom)e.data.indexFrom=s,e.data.indexCount+=i;else{const r=new B(this._target,this.geometryType,t,s,i),n=new X(r);h.next=n,n.next=e}}}class P{constructor(t,s,i){const h=new Uint32Array(s*i);this.strideInt=i,this.bufferType=t,this.dirty={start:1/0,end:0},this.gpu=null,this._cpu=h,this.clear()}get elementSize(){return this._cpu.length/this.strideInt}destroy(){i(this.gpu,(t=>t.dispose()))}clear(){this.dirty.start=1/0,this.dirty.end=0,this.freeList=new Y({start:0,end:this._cpu.length/this.strideInt}),this.fillPointer=0}ensure(s){if(this.maxAvailableSpace()>=s)return;const i=s*this.strideInt;if(i>this._cpu.length-this.fillPointer){t(this.gpu)&&(this.gpu=null);const s=Math.round(1.5*(this._cpu.length+i)),h=new Uint32Array(s),e=this._cpu.length/this.strideInt;this.freeList.free(e,s/this.strideInt-e),h.set(this._cpu),this._cpu=h}}set(t,s){this._cpu[t]!==s&&(this._cpu[t]=s,this.dirty.start=Math.min(t,this.dirty.start),this.dirty.end=Math.max(t,this.dirty.end))}getBuffer(){if(!this._cpu2||this._cpu2.length!==this._cpu.length){const t=this._cpu.slice();this._cpu2=t}return this._cpu2.set(this._cpu),this._cpu2}get bufferSize(){return this._cpu.length/this.strideInt}maxAvailableSpace(){return this.freeList.maxAvailableSpace()}insert(t,s,i,e){const r=i*this.strideInt,n=s*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,o=new Uint32Array(t,n,r),u=h(this.freeList.firstFit(i),"First fit region must be defined")*this.strideInt,a=r,c=u/this.strideInt-s;if(0!==e)for(let t=0;t<o.length;t++)o[t]+=e;return this._cpu.set(o,u),this.dirty.start=Math.min(this.dirty.start,u),this.dirty.end=Math.max(this.dirty.end,u+a),this.fillPointer=Math.max(this.fillPointer,u+a),c}free(t,s,i){const h=t*this.strideInt,e=(t+s)*this.strideInt;if(!0===i)for(let i=t;i!==t+s;i++)this._cpu[i*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,h),this.dirty.end=Math.max(this.dirty.end,e),this.freeList.free(t,s)}upload(t){if(this.dirty.end){if(s(this.gpu))return this.gpu=this._createBuffer(t),this.dirty.start=1/0,void(this.dirty.end=0);this.gpu.setSubData(this._cpu,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=1/0,this.dirty.end=0}}_createBuffer(t){return"index"===this.bufferType?M.createIndex(t,35048,this._cpu):M.createVertex(t,35048,this._cpu)}}class D{constructor(t,s){this._indicesInvalid=!1,this.geometryType=t}destroy(){this._vao&&(this._vao.dispose(),this._vao=null)}insert(t,s,i){if(!t.records.byteLength)return;const e=t.stride;if(this._vertexBuffer&&this._indexBuffer){const i=t.vertices.byteLength/e;this._indexBuffer.ensure(4*t.indices.byteLength),this._vertexBuffer.ensure(i);const{vertices:r,indices:n}=t,o=j.from(t.records),u=this._vertexBuffer.insert(r,0,r.byteLength/e,0),a=this._indexBuffer.insert(n,0,n.byteLength/4,u);if(o.forEach((t=>{t.indexFrom+=a,t.vertexFrom+=u})),h(this._records,"Expected records to be defined").link(o),s)this._indicesInvalid=!0;else if(this._displayList){const t=o.getCursor();for(;t.next();)this._displayList.addRecord(t)}}else{const i=4*t.indices.byteLength,h=t.vertices.byteLength/e,r=e/Uint32Array.BYTES_PER_ELEMENT;this._records=j.from(t.records),this._indexBuffer=new P("index",i,1),this._vertexBuffer=new P("vertex",h,r),this._indexBuffer.insert(t.indices,0,t.indices.byteLength/4,0),this._vertexBuffer.insert(t.vertices,0,t.vertices.byteLength/e,0),s&&(this._indicesInvalid=!0)}}remove(t){if(!s(this._records))for(const s of t){const t=this._records.getCursor();if(!t.lookup(s))continue;const i=t.indexFrom,h=t.vertexFrom;let e=t.indexCount,r=t.vertexCount;for(;t.next()&&t.id===s;)e+=t.indexCount,r+=t.vertexCount;this._indexBuffer.free(i,e),this._vertexBuffer.free(h,r,!0),this._records.delete(s)}}draw(t,i,h,e,r){if(!this._vertexBuffer||!this._indexBuffer||s(this._records))return;if((s(this._vertexBuffer.gpu)||s(this._indexBuffer.gpu))&&(this._vao&&(this._vao.dispose(),this._vao=null),this._vertexBuffer.gpu=null,this._indexBuffer.gpu=null),this._vertexBuffer.upload(t),this._indexBuffer.upload(t),!this._vao){const s=this._vertexBuffer.gpu,e=this._indexBuffer.gpu;if(!e||!s)return;this._vao=new C(t,h,i,{geometry:s},e)}const n=e*Uint32Array.BYTES_PER_ELEMENT;t.bindVAO(this._vao),t.drawElements(4,r,5125,n)}forEachCommand(t){if(!s(this._records)){if(this._sortIndices(this._records),!this._displayList){const t=this._cursorIndexOrder;this._displayList=F.from(this,this.geometryType,this._records.getCursor(),t)}this._displayList.forEach(t)}}_sortIndices(t){if(!this._indicesInvalid)return;this._indicesInvalid=!1;let s=0;const i=t.getCursor(),h=this._indexBuffer.getBuffer(),e=[],r=[],n=[];for(;i.next();)r.push(i.index),n.push(i.sortKey),e.push(i.id);r.sort(((t,s)=>{const i=n[s],h=n[t];return h===i?e[s]-e[t]:i-h}));const o=t.getCursor();for(const t of r){if(!o.seekIndex(t))throw new Error("Expected to find index");const{indexFrom:i,indexCount:e}=o;o.indexFrom=s;for(let t=0;t<e;t++)this._indexBuffer.set(s++,h[i+t])}this._cursorIndexOrder=r,this._displayList=null}}let Z=0;class z extends A{constructor(t,s,i,h){super(t,s,i),this.instanceId=Z++,this.patchCount=0,this._renderState={current:{geometry:new Map,metrics:null},next:null,swap:!1,swapFrames:0,locked:!1},this._patches=new g(100),this._bufferPatches=new g(100),this._lastCommitTime=0,this._lastMessageWasClear=!1,this.transforms.labelMat2d=e(),this._store=h}destroy(){super.destroy(),this._renderState.current.geometry.forEach((t=>t.destroy()))}get labelMetrics(){return this._renderState.current.metrics}get hasData(){return!!this._renderState.current.geometry.size}getGeometry(t){return this._renderState.current.geometry.get(t)}setTransform(t,s){super.setTransform(t,s);const i=this.transforms.labelMat2d,h=t.getScreenTransform(i,s),e=c();r(e,[this.x,this.y],h),n(i),o(i,i,e),u(i,t.viewMat2d,i)}patch(t,s){if(this.patchCount++,t.clear&&this._lastMessageWasClear)return;this._lastMessageWasClear=t.clear,t.clear&&this._patches.size>=50&&this._dropPatches();const i=t;s&&i.addOrUpdate&&this.key.id!==i.addOrUpdate.tileKeyOrigin?this._bufferPatches.enqueue(i):(i.sort=i.sort&&!s,this._patches.enqueue(i)),this.requestRender()}commit(t){if(this._lastCommitTime!==t.time){this._lastCommitTime=t.time;for(let t=0;t<4;t++)this._updateMesh(),this.isReady&&this._updateBufferMesh();this._renderState.swap&&(this._swapRenderStates(),this.requestRender())}}lock(){this._renderState.locked=!0}unlock(){this._renderState.locked=!1,this._flushUpdates(),this._swap()}_swapRenderStates(){if(this._renderState.next){if(this._renderState.locked)return this._renderState.swap=!0,void this.requestRender();if(this._renderState.swap=!0,0===this._renderState.swapFrames)return this._renderState.swapFrames=8,void this.requestRender();1==this._renderState.swapFrames--?this._swap():this.requestRender()}}_swap(){this._renderState.swap&&(this._renderState.swap=!1,t(this._renderState.next)&&(this._renderState.current.geometry.forEach((t=>t.destroy())),this._renderState.current=this._renderState.next,this._renderState.next=null))}_flushUpdates(){let t=this._patches.maxSize;for(;this._patches.size&&t--;)this._updateMesh(),this._swap()}_updateBufferMesh(){const s=this._bufferPatches.peek();if(!t(s)||!s.clear||null===this._renderState.next)for(;this._bufferPatches.size;){const s=this._bufferPatches.dequeue();t(s)&&this._patchBuffer(s)}}_updateMesh(){const s=this._patches.peek();if(t(s)&&s.clear&&null!==this._renderState.next)return;const i=this._patches.dequeue();if(t(i)){if(!0===i.clear){if(!this.isReady)return;return void(this._renderState.next={geometry:new Map,metrics:null})}this.requestRender(),this._patch(i),i.end&&(this.ready(),this._swapRenderStates())}}_patch(t){w((s=>{this._remove(s,t.remove),this._insert(s,t,!1)}))}_patchBuffer(t){w((s=>{this._insert(s,t,!0)}))}_insert(t,i,h){try{var e;const r=a(this._renderState.next,this._renderState.current),n=null==(e=i.addOrUpdate)?void 0:e.data[t],o=r.geometry;if(s(n))return;o.has(t)||o.set(t,new D(t,this.stage)),o.get(t).insert(n,i.sort,h),t===y.LABEL&&this._insertLabelMetrics(i.type,n.metrics,i.clear)}catch(t){}}_insertLabelMetrics(t,i,h){const e=a(this._renderState.next,this._renderState.current);if(s(i))return;const r=R.from(i);if(s(e.metrics))e.metrics=r;else{if("update"===t){const t=r.getCursor();for(;t.next();)e.metrics.delete(t.id)}e.metrics.link(r)}}_remove(t,s){const i=a(this._renderState.next,this._renderState.current).geometry.get(t);s&&s.length&&i&&(i.remove(s),this._removeLabelMetrics(s))}_removeLabelMetrics(t){const{metrics:i}=a(this._renderState.next,this._renderState.current);if(!s(i)&&t.length)for(const s of t)for(;i.delete(s););}_dropPatches(){const t=new Array;let i=!1;for(;this._patches.size;){const h=this._patches.dequeue();if(s(h))break;if(h.clear){if(i)break;i=!0}t.push(h)}this._patches.clear(),t.forEach((t=>this._patches.enqueue(t)))}}const H=l("featurelayer-order-by-server-enabled");class I extends x{constructor(t,s,i,h){super(t),this._pointToCallbacks=new Map,this._layer=i,this._layerView=s,this._onUpdate=h}renderChildren(t){this.attributeView.update(),this.hasAnimation&&t.painter.effects.integrate.draw(t,t.attributeView),super.renderChildren(t)}isUpdating(){return this.attributeView.isUpdating()}hitTest(t,s){const i=[t,s],h=d();return this._pointToCallbacks.set(i,h),this.requestRender(),h.promise}onTileData(t,s){const i=H&&"orderBy"in this._layer&&this._layer.orderBy;t.patch(s,i&&this._layerView.orderByFields===((null==i?void 0:i.length)&&!i[0].valueExpression&&i[0].field)),this.contains(t)||this.addChild(t),this.requestRender()}onTileError(t){this.contains(t)||this.addChild(t)}doRender(t){const{minScale:s,maxScale:i}=this._layer,h=t.state.scale;h<=(s||1/0)&&h>=i&&super.doRender(t)}onAttributeStoreUpdate(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this._onUpdate()}get hasAnimation(){return this.hasLabels}get hasLabels(){if("sublayers"in this._layer)return this._layer.sublayers.some((t=>t.labelingInfo&&t.labelingInfo.length&&t.labelsVisible));const t=this._layer.featureReduction;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!(t&&"cluster"===t.type&&t.labelsVisible&&t.labelingInfo&&t.labelingInfo.length)}prepareRenderPasses(t){const s=t.registerRenderPass({name:"label",brushes:[T.label],target:()=>this.hasLabels?this.children:null,drawPhase:v.LABEL|v.LABEL_ALPHA}),i=t.registerRenderPass({name:"geometry",brushes:[T.fill,T.line,T.marker,T.text],target:()=>this.children,enableDefaultDraw:()=>!this._layerView.hasEffects,effects:[{apply:t.effects.outsideEffect,enable:()=>this._layerView.hasEffects,args:()=>this._layerView.effectLists.excluded},{apply:t.effects.insideEffect,enable:()=>this._layerView.hasEffects,args:()=>this._layerView.effectLists.included},{apply:t.effects.hittest,enable:()=>!!this._pointToCallbacks.size,args:()=>this._pointToCallbacks}]}),h=t.registerRenderPass({name:"highlight",brushes:[T.fill,T.line,T.marker,T.text],target:()=>this.children,drawPhase:v.HIGHLIGHT,enableDefaultDraw:()=>!1,effects:[{apply:t.effects.highlight,enable:()=>!!this._layerView.hasHighlight()}]});return[...super.prepareRenderPasses(t),i,h,s]}}let L=class extends U{install(t){const s=new I(this.tileInfoView,this.layerView,this.layer,(()=>this.notifyChange("updating")));this.featuresView=s,t.addChild(s)}uninstall(t){t.removeChild(this.featuresView),this.featuresView.destroy()}fetchResource(t,s){const{url:i}=t,h=this.featuresView.stage;try{return h.resourceManager.fetchResource(i,{signal:s.signal})}catch(t){return m(t)?Promise.resolve({width:0,height:0}):Promise.reject(t)}}isUpdating(){const t=super.isUpdating(),s=!this.featuresView||this.featuresView.isUpdating(),i=t||s;return l("esri-2d-log-updating")&&console.log(`Updating SymbolTileRenderer ${i}\n  -> updatingTiles ${t}\n  -> updatingFeaturesView ${s}`),i}hitTest(t,s){return this.featuresView.hitTest(t,s)}supportsRenderer(t){return null!=t&&-1!==["simple","class-breaks","unique-value","dot-density","dictionary"].indexOf(t.type)}onConfigUpdate(t){let s=null;if("visualVariables"in t){const i=(_(t).visualVariables||[]).map((t=>{const s=t.clone();return"normalizationField"in t&&(s.normalizationField=null),t.valueExpression&&"$view.scale"!==t.valueExpression&&(s.valueExpression=null,s.field="nop"),s}));s=k(i)}this.featuresView.setRendererInfo(t,s,this.layerView.featureEffect)}onTileData(t){const s=this.tiles.get(t.tileKey);s&&t.data&&this.featuresView.onTileData(s,t.data),this.layerView.view.labelManager.requestUpdate()}onTileError(t){const s=this.tiles.get(t.tileKey);s&&this.featuresView.onTileError(s)}forceAttributeTextureUpload(){this.featuresView.attributeView.forceTextureUpload()}lockGPUUploads(){this.featuresView.attributeView.lockTextureUpload(),this.tiles.forEach((t=>t.lock()))}unlockGPUUploads(){this.featuresView.attributeView.unlockTextureUpload(),this.tiles.forEach((t=>t.unlock()))}async getMaterialItems(t){return this.featuresView.getMaterialItems(t)}invalidateLabels(){this.featuresView.hasLabels&&this.layerView.view.labelManager.requestUpdate()}createTile(t){const s=this.tileInfoView.getTileBounds(b(),t);return new z(t,s[0],s[3],this.featuresView.attributeView)}disposeTile(t){this.featuresView.removeChild(t),t.destroy(),this.layerView.view.labelManager.requestUpdate()}};L=f([p("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],L);const $=L;export default $;