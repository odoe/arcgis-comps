import{cW as t,dE as n,A as i,b7 as o,a_ as r,af as e,bb as s,dF as a,cL as c,ak as p,bv as f}from"./p-e58503d5.js";import{i as u}from"./p-5f8e8f6c.js";import{m as l,i as g,U as m,R as d}from"./p-8a919d07.js";function b(n){return v[function(n){return n instanceof Blob?n.type:function(n){const i=t(n);return y[i]||j}(n.url)}(n)]||w}const v={},j="text/plain",w=v[j],y={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const t in y)v[y[t]]=t;function h(t){const o=i(t)&&t.origins?t.origins:[void 0];return(r,e)=>{const s=function(t,n,o){if(i(t)&&"resource"===t.type)return x(t,n,o);switch(i(t)&&t.type?t.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:t,write:n}=d;return{read:t,write:n}}}}(t,r,e);for(const t of o){const i=n(r,t,e);for(const t in s)i[t]=s[t]}}}function x(t,n,c){const p=a(n,c);return{type:String,read:(t,n,i)=>{const o=l(t,n,i);return p.type===String?o:"function"==typeof p.type?new p.type({url:o}):void 0},write:{writer(n,a,f,l){if(!l||!l.resources)return"string"==typeof n?void(a[f]=g(n,l)):void(a[f]=n.write({},l));const d=e(j=n)?null:"string"==typeof j?j:j.url,b=d?g(d,{...l,verifyItemRelativeUrls:l&&l.verifyItemRelativeUrls?{writtenUrls:l.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},1):null,v=p.type!==String&&(!u(this)||l&&l.origin&&this.originIdOf(c)>o(l.origin));var j;l&&l.portalItem&&i(b)&&!r(b)?v?S(this,c,n,b,a,f,l,t):function(t,n,i,o){o.resources.toKeep.push({resource:o.portalItem.resourceFromPath(t)}),n[i]=t}(b,a,f,l):l&&l.portalItem&&(e(b)||i(m(b))||s(b)||v)?z(this,c,n,b,a,f,l,t):a[f]=b}}}}function z(t,n,i,o,r,e,a,u){const l=c(),g=U(i,o,a),m=p(f(u,"prefix"),l),d=`${m}.${b(g)}`,v=a.portalItem.resourceFromPath(d);s(o)&&a.resources.pendingOperations.push(async function(t){const n=(await import("./p-e58503d5.js").then((function(t){return t.dY}))).default,{data:i}=await n(t,{responseType:"blob"});return i}(o).then((t=>{v.path=`${m}.${b(t)}`,r[e]=v.itemRelativeUrl})).catch((()=>{}))),$(t,n,v,g,a.resources.toAdd),r[e]=v.itemRelativeUrl}function S(n,i,o,r,e,s,a,c){const p=a.portalItem.resourceFromPath(r),f=U(o,r,a);b(f)===t(p.path)?($(n,i,p,f,a.resources.toUpdate),e[s]=r):z(n,i,o,r,e,s,a,c)}function $(t,n,i,o,r){r.push({resource:i,content:o,finish:i=>{!function(t,n,i){"string"==typeof t[n]?t[n]=i.url:t[n].url=i.url}(t,n,i)}})}function U(t,n,i){return"string"==typeof t?{url:n}:new Blob([JSON.stringify(t.toJSON(i))],{type:"application/json"})}export{h as g}