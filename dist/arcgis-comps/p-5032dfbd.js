import{c as t,af as e,s as n,A as r}from"./p-e58503d5.js";import{l as o,c as s,y as u,f as i}from"./p-c048b814.js";import{t as c,s as f}from"./p-182bb5be.js";import{e as l}from"./p-db87794e.js";function a(t,e){return t?e?4:3:e?3:2}const m=t.getLogger("esri.tasks.support.optimizedFeatureSet"),y={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},h=(t,e,n,r,o,s)=>{t[n]=o,t[n+1]=s},p=(t,e,n,r,o,s)=>{t[n]=o,t[n+1]=s,t[n+2]=e[r+2]},d=(t,e,n,r,o,s)=>{t[n]=o,t[n+1]=s,t[n+2]=e[r+3]},g=(t,e,n,r,o,s)=>{t[n]=o,t[n+1]=s,t[n+2]=e[r+2],t[n+3]=e[r+3]};function w(t,e,n,r){if(t){if(n)return e&&r?g:p;if(e&&r)return d}else if(e&&r)return p;return h}function b({scale:t,translate:e},n){return Math.round((n-e[0])/t[0])}function G({scale:t,translate:e},n){return Math.round((e[1]-n)/t[1])}function M({scale:t,translate:e},n){return n*t[0]+e[0]}function P({scale:t,translate:e},n){return e[1]-n*t[1]}function k(t,e,n){return t?e?n?x(t):Z(t):n?N(t):F(t):null}function F(t){const e=t.coords;return{x:e[0],y:e[1]}}function T(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function Z(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function j(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function N(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function v(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function x(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function I(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function q(t,e,n,o){let s=F;n&&o?s=x:n?s=Z:o&&(s=N);for(const n of e){const{geometry:e,attributes:o}=n,u=r(e)?s(e):null;t.push({attributes:o,geometry:u})}return t}function U(t,e){return t&&e?I:t?j:e?v:T}function $(t,e,n,r,o){const s=U(n,r);for(const n of e){const{geometry:e,attributes:r}=n;let u;e&&(u=s(new c,e)),t.push(new f(u,r,null,r[o]))}return t}function z(t,n,r){if(e(t))return null;const o=a(n,r),s=[];for(let e=0;e<t.coords.length;e+=o){const n=[];for(let r=0;r<o;r++)n.push(t.coords[e+r]);s.push(n)}return n?r?{points:s,hasZ:n,hasM:r}:{points:s,hasZ:n}:r?{points:s,hasM:r}:{points:s}}function S(t,e,n,r,o){const s=a(n,r);for(const n of e){const e=n.geometry,r=n.attributes;let u;e&&(u=R(new c,e,s)),t.push(new f(u,r,null,r[o]))}return t}function R(t,e,n=a(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let o=0;for(const t of e.points)for(let e=0;e<n;e++)r[o++]=t[e];return t}function L(t,e,n,o){for(const s of e){const{geometry:e,attributes:u}=s;let i;r(e)&&(i=A(e,n,o)),t.push({attributes:u,geometry:i})}return t}function A(t,e,n){if(!t)return null;const r=a(e,n),{coords:o,lengths:s}=t,u=[];let i=0;for(const t of s){const e=[];for(let n=0;n<t;n++){const t=[];for(let e=0;e<r;e++)t.push(o[i++]);e.push(t)}u.push(e)}return e?n?{paths:u,hasZ:e,hasM:n}:{paths:u,hasZ:e}:n?{paths:u,hasM:n}:{paths:u}}function B(t,e,n,r,o){const s=a(n,r);for(const n of e){const e=n.geometry,r=n.attributes;let u;e&&(u=C(new c,e,s)),t.push(new f(u,r,null,r[o]))}return t}function C(t,e,n=a(e.hasZ,e.hasM)){const{lengths:r,coords:o}=t;let s=0;for(const t of e.paths){for(const e of t)for(let t=0;t<n;t++)o[s++]=e[t];r.push(t.length)}return t}function D(t,e,n,o){for(const s of e){const{geometry:e,attributes:u,centroid:i}=s;let c;if(r(e)&&(c=E(e,n,o)),i){const e=F(i);t.push({attributes:u,centroid:e,geometry:c})}else t.push({attributes:u,geometry:c})}return t}function E(t,e,n){if(!t)return null;const r=a(e,n),{coords:o,lengths:s}=t,u=[];let i=0;for(const t of s){const e=[];for(let n=0;n<t;n++){const t=[];for(let e=0;e<r;e++)t.push(o[i++]);e.push(t)}u.push(e)}return e?n?{rings:u,hasZ:e,hasM:n}:{rings:u,hasZ:e}:n?{rings:u,hasM:n}:{rings:u}}function H(t,e,n,o,s){for(const u of e){const e=u.geometry,i=u.centroid,l=u.attributes;let a;e&&(a=J(new c,e,n,o)),r(i)?t.push(new f(a,l,T(new c,i),l[s])):t.push(new f(a,l,null,l[s]))}return t}function J(t,e,n=e.hasZ,r=e.hasM){return K(t,e.rings,n,r),t}function K(t,e,n,r){const o=a(n,r),{lengths:s,coords:u}=t;let i=0;s.length=u.length=0;for(const t of e){for(const e of t)for(let t=0;t<o;t++)u[i++]=e[t];s.push(t.length)}return t}const O=[],Q=[];function V(t,e,n,r,o){O[0]=t;const[s]=W(Q,O,e,n,r,o);return O.length=Q.length=0,s}function W(t,e,r,o,s,u){if(t.length=0,!r){for(const n of e)t.push(new f(null,n.attributes,null,n.attributes[u]));return t}switch(r){case"esriGeometryPoint":return $(t,e,o,s,u);case"esriGeometryMultipoint":return S(t,e,o,s,u);case"esriGeometryPolyline":return B(t,e,o,s,u);case"esriGeometryPolygon":return H(t,e,o,s,u);default:m.error("convertToFeatureSet:unknown-geometry",new n(`Unable to parse unknown geometry type '${r}'`)),t.length=0}return t}function X(t,e,r,o,s,u){const i=t.length;switch(r){case"esriGeometryPoint":$(t,e,o,s,u);break;case"esriGeometryMultipoint":S(t,e,o,s,u);break;case"esriGeometryPolyline":B(t,e,o,s,u);break;case"esriGeometryPolygon":H(t,e,o,s,u);break;default:m.error("convertToFeatureSet:unknown-geometry",new n(`Unable to parse unknown geometry type '${r}'`))}for(let n=0;n<e.length;n++)t[n+i].geometryType=r,t[n+i].insertAfter=e[n].insertAfter,t[n+i].groupId=e[n].groupId;return t}function Y(t,e,n,r){Q[0]=t,et(O,Q,e,n,r);const o=O[0];return O.length=Q.length=0,o}function _(t,r,f){if(e(t))return null;const l=new c;return"hasZ"in t&&null==r&&(r=t.hasZ),"hasM"in t&&null==f&&(f=t.hasM),o(t)?U(null!=r?r:null!=t.z,null!=f?f:null!=t.m)(l,t):s(t)?J(l,t,r,f):u(t)?C(l,t,a(r,f)):i(t)?R(l,t,a(r,f)):void m.error("convertFromGeometry:unknown-geometry",new n(`Unable to parse unknown geometry type '${t}'`))}function tt(t,r,o,s){const u=t&&("coords"in t?t:t.geometry);if(e(u))return null;switch(r){case"esriGeometryPoint":{let t=F;return o&&s?t=x:o?t=Z:s&&(t=N),t(u)}case"esriGeometryMultipoint":return z(u,o,s);case"esriGeometryPolyline":return A(u,o,s);case"esriGeometryPolygon":return E(u,o,s);default:return void m.error("convertToGeometry:unknown-geometry",new n(`Unable to parse unknown geometry type '${r}'`))}}function et(t,r,o,s,u){if(t.length=0,e(o))return function(t,e){for(const n of e)t.push({attributes:n.attributes});return t}(t,r);switch(o){case"esriGeometryPoint":return q(t,r,s,u);case"esriGeometryMultipoint":return function(t,e,n,r){for(const o of e){const{geometry:e,attributes:s}=o;let u;e&&(u=z(e,n,r)),t.push({attributes:s,geometry:u})}return t}(t,r,s,u);case"esriGeometryPolyline":return L(t,r,s,u);case"esriGeometryPolygon":return D(t,r,s,u);default:m.error("convertToFeatureSet:unknown-geometry",new n(`Unable to parse unknown geometry type '${o}'`))}return t}function nt(t){const{objectIdFieldName:e,spatialReference:n,transform:r,fields:o,hasM:s,hasZ:u,features:i,geometryType:c,exceededTransferLimit:f,uniqueIdField:l,queryGeometry:a,queryGeometryType:m}=t,y={features:et([],i,c,u,s),fields:o,geometryType:c,objectIdFieldName:e,spatialReference:n,uniqueIdField:l,queryGeometry:tt(a,m,!1,!1)};return r&&(y.transform=r),f&&(y.exceededTransferLimit=f),s&&(y.hasM=s),u&&(y.hasZ=u),y}function rt(t,e){const r=new l,{hasM:o,hasZ:s,features:u,objectIdFieldName:i,spatialReference:c,geometryType:f,exceededTransferLimit:a,transform:y,fields:h}=t;return h&&(r.fields=h),r.geometryType=f,r.objectIdFieldName=i||e,r.spatialReference=c,r.objectIdFieldName?(u&&W(r.features,u,f,s,o,r.objectIdFieldName),a&&(r.exceededTransferLimit=a),o&&(r.hasM=o),s&&(r.hasZ=s),y&&(r.transform=y),r):(m.error(new n("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function ot(t){const{transform:e,features:n,hasM:o,hasZ:s}=t;if(!e)return t;for(const t of n)r(t.geometry)&&at(t.geometry,t.geometry,o,s,e),t.centroid&&at(t.centroid,t.centroid,o,s,e);return t.transform=null,t}function st(t,e){const{geometryType:n,features:r,hasM:o,hasZ:s}=e;if(!t)return e;for(let e=0;e<r.length;e++){const u=r[e],i=u.weakClone();i.geometry=new c,ut(i.geometry,u.geometry,o,s,n,t),u.centroid&&(i.centroid=new c,ut(i.centroid,u.centroid,o,s,"esriGeometryPoint",t)),r[e]=i}return e.transform=t,e}function ut(t,n,r,o,s,u,i=r,c=o){if(t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0),e(n)||!n.coords.length)return null;const f=y[s],{coords:l,lengths:m}=n,h=a(r,o),p=a(r&&i,o&&c),d=w(r,o,i,c);if(!m.length)return d(t.coords,l,0,0,b(u,l[0]),G(u,l[1])),t.lengths.length&&(t.lengths.length=0),t.coords.length=h,t;let g,M,P,k,F=0,T=0,Z=T;for(const e of m){if(e<f)continue;let n=0;T=Z,P=g=b(u,l[F]),k=M=G(u,l[F+1]),d(t.coords,l,T,F,P,k),n++,F+=h,T+=p;for(let r=1;r<e;r++,F+=h)P=b(u,l[F]),k=G(u,l[F+1]),P===g&&k===M||(d(t.coords,l,T,F,P-g,k-M),T+=p,n++,g=P,M=k);n>=f&&(t.lengths.push(n),Z=T)}return t.coords.length=Z,t.coords.length?t:null}function it(t,e,n,r,o,s,u=n,i=r){if(t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0),!e||!e.coords.length)return null;const c=y[o],{coords:f,lengths:l}=e,m=a(n,r),h=a(n&&u,r&&i),p=w(n,r,u,i);if(!l.length)return p(t.coords,f,0,0,f[0],f[1]),t.lengths.length&&(t.lengths.length=0),t.coords.length=m,t;let d=0;const g=s*s;for(const e of l){if(e<c){d+=e*m;continue}const n=t.coords.length/h,r=d,o=d+(e-1)*m;p(t.coords,f,t.coords.length,r,f[r],f[r+1]),ft(t.coords,f,m,g,p,r,o),p(t.coords,f,t.coords.length,o,f[o],f[o+1]);const s=t.coords.length/h-n;s>=c?t.lengths.push(s):t.coords.length=n*h,d+=e*m}return t.coords.length?t:null}function ct(t,e,n,r){const o=t[e],s=t[e+1],u=t[r],i=t[r+1];let c=t[n],f=t[n+1],l=u-c,a=i-f;if(0!==l||0!==a){const t=((o-c)*l+(s-f)*a)/(l*l+a*a);t>1?(c=u,f=i):t>0&&(c+=l*t,f+=a*t)}return l=o-c,a=s-f,l*l+a*a}function ft(t,e,n,r,o,s,u){let i,c=r,f=0;for(let t=s+n;t<u;t+=n)i=ct(e,t,s,u),i>c&&(f=t,c=i);c>r&&(f-s>n&&ft(t,e,n,r,o,s,f),o(t,e,t.length,f,e[f],e[f+1]),u-f>n&&ft(t,e,n,r,o,f,u))}function lt(t,n,r,o){if(e(n)||!n.coords||!n.coords.length)return null;const s=a(r,o);let u=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,f=Number.NEGATIVE_INFINITY;if(n&&n.coords){const t=n.coords;for(let e=0;e<t.length;e+=s){const n=t[e],r=t[e+1];u=Math.min(u,n),c=Math.max(c,n),i=Math.min(i,r),f=Math.max(f,r)}}return t[0]=u,t[1]=i,t[2]=c,t[3]=f,t}function at(t,e,n,r,o){const{coords:s,lengths:u}=e,i=n?r?g:p:r?p:h,c=a(n,r);if(!s.length)return t!==e&&(t.lengths.length=0,t.coords.length=0),t;if(!u.length)return i(t.coords,s,0,0,M(o,s[0]),P(o,s[1])),t!==e&&(t.lengths.length=0,t.coords.length=c),t;const[f,l]=o.scale;let m=0;for(let e=0;e<u.length;e++){const n=u[e];t.lengths[e]=n;let r=M(o,s[m]),a=P(o,s[m+1]);i(t.coords,s,m,m,r,a),m+=c;for(let e=1;e<n;e++,m+=c)r+=s[m]*f,a-=s[m+1]*l,i(t.coords,s,m,m,r,a)}return t!==e&&(t.lengths.length=u.length,t.coords.length=s.length),t}function mt(t,e,n,r,o,s){const u=a(n,r),i=w(n,r,o,s),c=e.coords;t.coords.length=0,t.lengths.length=0,t.lengths.push(...e.lengths);for(let e=0;e<c.length;e+=u)i(t.coords,c,t.coords.length,e,c[e],c[e+1]);return t}function yt(t,e,n,r){let o=0,s=t[r*e],u=t[r*(e+1)];for(let i=1;i<n;i++){const n=s+t[r*(e+i)],c=u+t[r*(e+i)+1],f=(n-s)*(c+u);s=n,u=c,o+=f}return.5*o}function ht(t,e){const{coords:n,lengths:r}=t;let o=0,s=0;for(let t=0;t<r.length;t++)s+=yt(n,o,r[t],e),o+=t;return Math.abs(s)}function pt(t,n){if(e(t))return null;const r=t.clone(),o=t.coords,s=t.lengths;let u=0;for(let t=0;t<s.length;t++){const e=s[t];let i=o[n*u],c=o[n*u+1];for(let t=1;t<e;t++){const e=i+o[n*(u+t)],s=c+o[n*(u+t)+1];r.coords[n*(u+t)]=e,r.coords[n*(u+t)+1]=s,i=e,c=s}u+=e}return r}export{C as $,E as C,J as D,k as G,K as H,G as M,V as Q,A as U,W,X,z as _,b as a,ht as b,rt as c,_ as e,it as f,lt as g,ut as i,ot as l,at as m,tt as n,nt as s,Y as t,st as u,pt as w,mt as y}