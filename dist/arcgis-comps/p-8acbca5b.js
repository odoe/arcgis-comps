import{C as t}from"./p-dc15ecc1.js";import{E as e}from"./p-e3500fdc.js";import{M as r}from"./p-b9c93bb2.js";import{a as n,t as s}from"./p-b05e75b2.js";import{s as i,h as o,Z as a}from"./p-e58503d5.js";import{B as l}from"./p-efbca0ca.js";import{c}from"./p-8a919d07.js";import{m,j as u,b as f,c as p,p as y}from"./p-81b9df84.js";const b={marker:e.MARKER,fill:e.FILL,line:e.LINE,text:e.TEXT};class h{constructor(t,e,n,s){const i={minScale:null==e?void 0:e.minScale,maxScale:null==e?void 0:e.maxScale},o=function(t){return t.minScale||t.maxScale?t.minScale+"-"+t.maxScale:""}(i);this.layers=t,this.data=e,this.hash=this._createHash()+o,this.rendererKey=n;for(const e of t)e.materialKey=r(b[e.type],this.rendererKey),e.maxVVSize=s,e.scaleInfo=i,e.templateHash+=o}get type(){return"expanded-cim"}_createHash(){let t="";for(const e of this.layers)t+=e.templateHash;return t}}async function d(t,e,r){if(!t.name)return Promise.reject(new i("style-symbol-reference-name-missing","Missing name in style symbol reference"));if(t.styleName&&"Esri2DPointSymbolsStyle"===t.styleName)return async function(t,e){const r=u.replace(/\{SymbolName\}/gi,t.name);try{const t=await f(r,e);return p(t.data)}catch(t){return o(t),null}}(t,r);try{return w(await m(t,e,r),t.name,e,r)}catch(t){return o(t),null}}async function w(t,e,r,m){const u=t.data,b={portal:r&&r.portal||l.getDefault(),url:a(t.baseUrl),origin:"portal-item"},h=u.items.find((t=>t.name===e));if(!h)throw new i("symbolstyleutils:symbol-name-not-found",`The symbol name '${e}' could not be found`,{symbolName:e});let d=c(y(h,"cimRef"),b);n()&&(d=s(d));try{const t=await f(d,m);return p(t.data)}catch(t){return o(t),null}}const j=async(e,r,n)=>new h(await t(e.data,r,n),e.data,e.rendererKey,e.maxVVSize),x=async(t,e,r,n)=>{if(!t)return null;if("cim"===t.type)return j(t,e,r);if("web-style"===t.type){const s={type:"cim",data:await d(t,null,n),rendererKey:t.rendererKey,maxVVSize:t.maxVVSize};return j(s,e,r)}return t};function S(t){if(!t)return null;const{type:e,cim:r,url:n,materialHash:s}=t,i={cim:r,type:e,mosaicHash:s,url:n,size:null,dashTemplate:null,path:null,text:null,fontName:null};switch(e){case"marker":i.size=t.size,i.path=t.path;break;case"line":i.dashTemplate=t.dashTemplate;break;case"text":i.text=t.text,i.fontName=t.fontName}return i}export{S as i,x as l}