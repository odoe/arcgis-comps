import{e,d as t,a8 as i,ed as r,i as s,a6 as n,aL as l,B as a,jP as o,jQ as u,a7 as c,ac as d,W as h,i0 as m,i2 as p,i1 as f,e6 as y,e7 as g,aG as v,ec as w,u as x,cY as S,e1 as T,H as I,ab as M,aI as E,e9 as L,aO as b}from"./p-c8bc3433.js";import{a as j,x as R}from"./p-0c01fe33.js";import{o as V}from"./p-9a8fa752.js";import"./p-84bf99cb.js";var P;let F=P=class extends n{constructor(e){super(e),this.fullExtent=null,this.id=null,this.tileInfo=null}clone(){const e=new P;return this.hasOwnProperty("fullExtent")&&(e.fullExtent=this.fullExtent&&this.fullExtent.clone()),this.hasOwnProperty("id")&&(e.id=this.id),this.hasOwnProperty("tileInfo")&&(e.tileInfo=this.tileInfo&&this.tileInfo.clone()),e}};e([t({type:i,json:{read:{source:"fullExtent"}}})],F.prototype,"fullExtent",void 0),e([t({type:String,json:{read:{source:"id"}}})],F.prototype,"id",void 0),e([t({type:r,json:{read:{source:"tileInfo"}}})],F.prototype,"tileInfo",void 0),F=P=e([s("esri.layer.support.TileMatrixSet")],F);const C=F;var A;let U=A=class extends n{constructor(e){super(e),this.id=null,this.title=null,this.description=null,this.legendUrl=null}clone(){const e=new A;return this.hasOwnProperty("description")&&(e.description=this.description),this.hasOwnProperty("id")&&(e.id=this.id),this.hasOwnProperty("isDefault")&&(e.isDefault=this.isDefault),this.hasOwnProperty("keywords")&&(e.keywords=this.keywords&&this.keywords.slice()),this.hasOwnProperty("legendUrl")&&(e.legendUrl=this.legendUrl),this.hasOwnProperty("title")&&(e.title=this.title),e}};e([t({json:{read:{source:"id"}}})],U.prototype,"id",void 0),e([t({json:{read:{source:"title"}}})],U.prototype,"title",void 0),e([t({json:{read:{source:"abstract"}}})],U.prototype,"description",void 0),e([t({json:{read:{source:"legendUrl"}}})],U.prototype,"legendUrl",void 0),e([t({json:{read:{source:"isDefault"}}})],U.prototype,"isDefault",void 0),e([t({json:{read:{source:"keywords"}}})],U.prototype,"keywords",void 0),U=A=e([s("esri.layer.support.WMTSStyle")],U);const W=U;var O;let K=O=class extends n{constructor(e){super(e),this.fullExtent=null,this.fullExtents=null,this.imageFormats=null,this.id=null,this.layer=null,this.styles=null,this.tileMatrixSetId=null,this.tileMatrixSets=null}get description(){return this._get("description")}set description(e){this._set("description",e)}readFullExtent(e,t){return(e=t.fullExtent)?i.fromJSON(e):null}readFullExtents(e,t){var r;return null!=(r=t.fullExtents)&&r.length?t.fullExtents.map((e=>i.fromJSON(e))):t.tileMatrixSets.map((e=>i.fromJSON(e.fullExtent))).filter((e=>e))}get imageFormat(){let e=this._get("imageFormat");return e||(e=this.imageFormats&&this.imageFormats.length?this.imageFormats[0]:""),e}set imageFormat(e){const t=this.imageFormats;e&&(e.indexOf("image/")>-1||t&&-1===t.indexOf(e))&&(-1===e.indexOf("image/")&&(e="image/"+e),t&&-1===t.indexOf(e))?console.error("The layer doesn't support the format of "+e):this._set("imageFormat",e)}get styleId(){let e=this._get("styleId");return e||(e=this.styles&&this.styles.length?this.styles.getItemAt(0).id:""),e}set styleId(e){this._set("styleId",e)}get title(){return this._get("title")}set title(e){this._set("title",e)}get tileMatrixSet(){return this.tileMatrixSets?this.tileMatrixSets.find((e=>e.id===this.tileMatrixSetId)):null}clone(){const e=new O;return this.hasOwnProperty("description")&&(e.description=this.description),this.hasOwnProperty("imageFormats")&&(e.imageFormats=this.imageFormats&&this.imageFormats.slice()),this.hasOwnProperty("imageFormat")&&(e.imageFormat=this.imageFormat),this.hasOwnProperty("fullExtent")&&(e.fullExtent=this.fullExtent&&this.fullExtent.clone()),this.hasOwnProperty("id")&&(e.id=this.id),this.hasOwnProperty("layer")&&(e.layer=this.layer),this.hasOwnProperty("styleId")&&(e.styleId=this.styleId),this.hasOwnProperty("styles")&&(e.styles=this.styles&&this.styles.clone()),this.hasOwnProperty("tileMatrixSetId")&&(e.tileMatrixSetId=this.tileMatrixSetId),this.hasOwnProperty("tileMatrixSets")&&(e.tileMatrixSets=this.tileMatrixSets.clone()),this.hasOwnProperty("title")&&(e.title=this.title),e}};e([t()],K.prototype,"description",null),e([t()],K.prototype,"fullExtent",void 0),e([l("fullExtent",["fullExtent"])],K.prototype,"readFullExtent",null),e([t({readOnly:!0})],K.prototype,"fullExtents",void 0),e([l("fullExtents",["fullExtents","tileMatrixSets"])],K.prototype,"readFullExtents",null),e([t()],K.prototype,"imageFormat",null),e([t({json:{read:{source:"formats"}}})],K.prototype,"imageFormats",void 0),e([t()],K.prototype,"id",void 0),e([t()],K.prototype,"layer",void 0),e([t()],K.prototype,"styleId",null),e([t({type:a.ofType(W),json:{read:{source:"styles"}}})],K.prototype,"styles",void 0),e([t({value:null,json:{write:{ignoreOrigin:!0}}})],K.prototype,"title",null),e([t()],K.prototype,"tileMatrixSetId",void 0),e([t({readOnly:!0})],K.prototype,"tileMatrixSet",null),e([t({type:a.ofType(C),json:{read:{source:"tileMatrixSets"}}})],K.prototype,"tileMatrixSets",void 0),K=O=e([s("esri.layers.support.WMTSSublayer")],K);const D=K,k=90.71428571428571,B=[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]];function _(e){return e.nodeType===Node.ELEMENT_NODE}function N(e,t){for(let i=0;i<t.childNodes.length;i++){const r=t.childNodes[i];if(_(r)&&r.nodeName===e)return r}return null}function G(e,t){const i=[];for(let r=0;r<t.childNodes.length;r++){const s=t.childNodes[r];_(s)&&s.nodeName===e&&i.push(s)}return i}function $(e,t){const i=[];for(let r=0;r<t.childNodes.length;r++){const s=t.childNodes[r];_(s)&&s.nodeName===e&&i.push(s)}return i.map((e=>e.textContent))}function H(e,t){return e.split(">").forEach((e=>{t&&(t=N(e,t))})),t&&t.textContent}function Y(e,t,i,r){let s;return Array.prototype.slice.call(r.childNodes).some((r=>{if(r.nodeName.indexOf(e)>-1){const e=N(t,r),n=e&&e.textContent;if(n===i||i.split(":")&&i.split(":")[1]===n)return s=r,!0}return!1})),s}function q(e,t,i,r,s){const n=H("Abstract",t),l=$("Format",t);return{id:e,fullExtent:Q(t),fullExtents:X(t),description:n,formats:l,styles:J(t,r),title:H("Title",t),tileMatrixSets:Z(s,t,i)}}function z(e,t){var i;const r=[],s=null==(i=e.layerMap)?void 0:i.get(t);if(!s)return;const n=G("ResourceURL",s),l=G("Dimension",s);let a,o,u,c;return l.length&&(a=H("Identifier",l[0]),o=$("Default",l[0])||$("Value",l[0])),l.length>1&&(u=H("Identifier",l[1]),c=$("Default",l[1])||$("Value",l[1])),e.dimensionMap.set(t,{dimensions:o,dimensions2:c}),n.forEach((e=>{let t=e.getAttribute("template");if("tile"===e.getAttribute("resourceType")){if(a&&o.length)if(t.indexOf("{"+a+"}")>-1)t=t.replace("{"+a+"}","{dimensionValue}");else{const e=t.toLowerCase().indexOf("{"+a.toLowerCase()+"}");e>-1&&(t=t.substring(0,e)+"{dimensionValue}"+t.substring(e+a.length+2))}if(u&&c.length)if(t.indexOf("{"+u+"}")>-1)t=t.replace("{"+u+"}","{dimensionValue2}");else{const e=t.toLowerCase().indexOf("{"+u.toLowerCase()+"}");e>-1&&(t=t.substring(0,e)+"{dimensionValue2}"+t.substring(e+u.length+2))}r.push({template:t,format:e.getAttribute("format"),resourceType:"tile"})}})),r}function Q(e){const t=N("WGS84BoundingBox",e),i=t?H("LowerCorner",t).split(" "):["-180","-90"],r=t?H("UpperCorner",t).split(" "):["180","90"];return{xmin:parseFloat(i[0]),ymin:parseFloat(i[1]),xmax:parseFloat(r[0]),ymax:parseFloat(r[1]),spatialReference:{wkid:4326}}}function X(e){const t=[];return V(e,{BoundingBox:e=>{const i=e.getAttribute("crs"),r=ee(i),s=i.includes("epsg")&&te(r.wkid);let n,l,a,o;V(e,{LowerCorner:e=>{[n,l]=e.textContent.split(" ").map((e=>Number.parseFloat(e))),s&&([n,l]=[l,n])},UpperCorner:e=>{[a,o]=e.textContent.split(" ").map((e=>Number.parseFloat(e))),s&&([a,o]=[o,a])}}),t.push({xmin:n,ymin:l,xmax:a,ymax:o,spatialReference:r})}}),t}function J(e,t){return G("Style",e).map((e=>{const i=N("LegendURL",e),r=N("Keywords",e),s=r&&$("Keyword",r);let n=i&&i.getAttribute("xlink:href");return t&&(n=n&&n.replace(/^http:/i,"https:")),{abstract:H("Abstract",e),id:H("Identifier",e),isDefault:"true"===e.getAttribute("isDefault"),keywords:s,legendUrl:n,title:H("Title",e)}}))}function Z(e,t,s){return G("TileMatrixSetLink",t).map((e=>N("TileMatrixSet",e).textContent)).map((n=>function(e,t,s,n){const l=$("TileMatrix",Y("TileMatrixSetLink","TileMatrixSet",t,s)),a=n.find((e=>{const i=N("Identifier",e),r=i&&i.textContent;return!!(r===t||t.split(":")&&t.split(":")[1]===r)})),o=function(e){const t=H("SupportedCRS",e).toLowerCase(),i=ee(t),r=H("TopLeftCorner",N("TileMatrix",e)).split(" "),s=r[0].split("E").map((e=>Number(e))),n=r[1].split("E").map((e=>Number(e))),l=s.length>1?s[0]*10**s[1]:s[0],a=n.length>1?n[0]*10**n[1]:n[0];return t.includes("epsg")&&te(i.wkid)?new d({x:a,y:l,spatialReference:i}):new d({x:l,y:a,spatialReference:i})}(a),u=o.spatialReference,c=u.wkid,h=N("TileMatrix",a),m=[parseInt(H("TileWidth",h),10),parseInt(H("TileHeight",h),10)],p=[];l.length?l.forEach(((e,i)=>{const r=Y("TileMatrix","Identifier",e,a);p.push(ie(r,c,i,t))})):G("TileMatrix",a).forEach(((e,i)=>{p.push(ie(e,c,i,t))}));const f=function(e,t,r,s,n){const l=N("BoundingBox",t);let a,o,u,c,d,h;if(l&&(a=H("LowerCorner",l).split(" "),o=H("UpperCorner",l).split(" ")),a&&a.length>1&&o&&o.length>1)u=parseFloat(a[0]),d=parseFloat(a[1]),c=parseFloat(o[0]),h=parseFloat(o[1]);else{const e=N("TileMatrix",t),i=parseInt(H("MatrixWidth",e),10),l=parseInt(H("MatrixHeight",e),10);u=r.x,h=r.y,c=u+i*s[0]*n.resolution,d=h-l*s[1]*n.resolution}return function(e,t){return"1.0.0"===e&&te(t.wkid)}(e,r.spatialReference)?new i(d,u,h,c,r.spatialReference):new i(u,d,c,h,r.spatialReference)}(e,a,o,m,p[0]).toJSON(),y=new r({dpi:96,spatialReference:u,size:m,origin:o,lods:p}).toJSON();return{id:t,fullExtent:f,tileInfo:y}}(e,n,t,s)))}function ee(e){e=e.toLowerCase();let t=parseInt(e.split(":").pop(),10);900913!==t&&3857!==t||(t=102100);const i=function(e){return e.includes("crs84")||e.includes("crs:84")?4326:e.includes("crs83")||e.includes("crs:83")?4269:e.includes("crs27")||e.includes("crs:27")?4267:null}(e);return h(i)&&(t=i),{wkid:t}}function te(e){return B.some((([t,i])=>e>=t&&e<=i))}function ie(e,t,i,r){const s=H("Identifier",e),n=H("ScaleDenominator",e).split("E").map((e=>Number(e)));let l;l=n.length>1?n[0]*10**n[1]:n[0];const a=re(t,l,r);return l*=96/k,{cols:parseInt(H("MatrixWidth",e),10),level:i,levelValue:s,scale:l,resolution:a,rows:parseInt(H("MatrixHeight",e),10)}}function re(e,t,i){let r;return r=o.hasOwnProperty(String(e))?o.values[o[e]]:"default028mm"===i?6370997*Math.PI/180:u(e).metersPerDegree,7*t/25e3/r}const se={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png","image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""},ne=new Set(["version","service","request","layer","style","format","tilematrixset","tilematrix","tilerow","tilecol"]);let le=class extends(m(p(f(y(g(v(w))))))){constructor(...e){super(...e),this._sublayersHandles=new x,this.copyright="",this.customParameters=null,this.customLayerParameters=null,this.fullExtent=null,this.operationalLayerType="WebTiledLayer",this.resourceInfo=null,this.serviceMode="RESTful",this.sublayers=null,this.type="wmts",this.version="1.0.0",this.watch("activeLayer",((e,t)=>{t&&(t.layer=null),e&&(e.layer=this)}),!0),this.watch("sublayers",((e,t)=>{t&&(t.forEach((e=>{e.layer=null})),this._sublayersHandles.removeAll(),this._sublayersHandles=null),e&&(e.forEach((e=>{e.layer=this})),this._sublayersHandles||(this._sublayersHandles=new x),this._sublayersHandles.add([e.on("after-add",(({item:e})=>{e.layer=this})),e.on("after-remove",(({item:e})=>{e.layer=null}))]))}),!0)}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){if("KVP"===this.serviceMode||"RESTful"===this.serviceMode)return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMTS"]},e).catch(S).then((()=>this._fetchService(e))).catch((e=>{throw S(e),new c("wmtslayer:unsupported-service-data","Invalid response from the WMTS service.",{error:e})}))),Promise.resolve(this);console.error("WMTS mode could only be 'KVP' or 'RESTful'")}get activeLayer(){return this._get("activeLayer")}set activeLayer(e){this._set("activeLayer",e)}readActiveLayerFromService(e,t,i){this.activeLayer||(this.activeLayer=new D);let r=t.layers.find((e=>e.id===this.activeLayer.id));return r||(r=t.layers[0]),this.activeLayer.read(r,i),this.activeLayer}readActiveLayerFromItemOrWebDoc(e,t){const{templateUrl:i,wmtsInfo:r}=t,s=i?this._getLowerCasedUrlParams(i):null,n=null==r?void 0:r.layerIdentifier;let l=null;const a=null==r?void 0:r.tileMatrixSet;return a&&(Array.isArray(a)?a.length&&(l=a[0]):l=a),new D({id:n,imageFormat:null==s?void 0:s.format,styleId:null==s?void 0:s.style,tileMatrixSetId:l})}writeActiveLayer(e,t,i,r){const s=this.activeLayer;t.templateUrl=this.getUrlTemplate(s.id,s.tileMatrixSetId,s.imageFormat,s.styleId);const n=T("tileMatrixSet.tileInfo",s);t.tileInfo=n?n.toJSON(r):null,t.wmtsInfo={...t.wmtsInfo,layerIdentifier:s.id,tileMatrixSet:s.tileMatrixSetId}}readCustomParameters(e,t){const i=t.wmtsInfo;return i?this._mergeParams(i.customParameters,i.url):null}get fullExtents(){return this.activeLayer.fullExtents}readServiceMode(e,t){return t.templateUrl.indexOf("?")>-1?"KVP":"RESTful"}readSublayersFromService(e,t,i){return function(e,t){return e.map((e=>{const i=new D;return i.read(e,t),i}))}(t.layers,i)}get supportedSpatialReferences(){return this.activeLayer.tileMatrixSets.map((e=>e.tileInfo.spatialReference)).toArray()}get title(){var e,t;return null!=(e=null==(t=this.activeLayer)?void 0:t.title)?e:"Layer"}set title(e){e?this._override("title",e):this._clearOverride("title")}get url(){return this._get("url")}set url(e){e&&"/"===e.substr(-1)?this._set("url",e.slice(0,-1)):this._set("url",e)}createWebTileLayer(e){const t=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,this.activeLayer.styleId),i=this._getTileMatrixSetById(e.tileMatrixSetId).tileInfo,r=e.fullExtent,s=new j({layerIdentifier:e.id,tileMatrixSet:e.tileMatrixSetId,url:this.url});return this.customLayerParameters&&(s.customLayerParameters=this.customLayerParameters),this.customParameters&&(s.customParameters=this.customParameters),new R({fullExtent:r,urlTemplate:t,tileInfo:i,wmtsInfo:s})}fetchTile(e,t,i){const r=this.getTileUrl(e,t,i);return I(r,{responseType:"image"}).then((e=>e.data))}findSublayerById(e){return this.sublayers.find((t=>t.id===e))}getTileUrl(e,t,i){const r=this._getTileMatrixSetById(this.activeLayer.tileMatrixSetId).tileInfo.lods[e],s=r?r.levelValue?r.levelValue:`${r.level}`:`${e}`;let n=this.resourceInfo?"":function(e,t,i,r,s,n,l,a){const{dimensionMap:o}=e,u=z(e,t),c=o.get(t).dimensions&&o.get(t).dimensions[0],d=o.get(t).dimensions2&&o.get(t).dimensions2[0];let h="";if(u&&u.length>0){let e=null;u.some((t=>t.format===r&&(e=t,!0))),e||(e=u[l%u.length]),h=e.template.replace(/\{Style\}/gi,s).replace(/\{TileMatrixSet\}/gi,i).replace(/\{TileMatrix\}/gi,n).replace(/\{TileRow\}/gi,""+l).replace(/\{TileCol\}/gi,""+a).replace(/\{dimensionValue\}/gi,c).replace(/\{dimensionValue2\}/gi,d)}return h}({dimensionMap:this.dimensionMap,layerMap:this.layerMap},this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,this.activeLayer.styleId,s,t,i);return n||(n=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,this.activeLayer.styleId).replace(/\{level\}/gi,s).replace(/\{row\}/gi,`${t}`).replace(/\{col\}/gi,`${i}`)),n=this._appendCustomLayerParameters(n),n}getUrlTemplate(e,t,i,r){if(!this.resourceInfo){const i=function(e,t,i,r){const{dimensionMap:s}=e,n=z(e,t);let l="";if(n&&n.length>0){const e=s.get(t).dimensions&&s.get(t).dimensions[0],a=s.get(t).dimensions2&&s.get(t).dimensions2[0];l=n[0].template,l.indexOf(".xxx")===l.length-4&&(l=l.slice(0,l.length-4)),l=l.replace(/\{Style\}/gi,r),l=l.replace(/\{TileMatrixSet\}/gi,i),l=l.replace(/\{TileMatrix\}/gi,"{level}"),l=l.replace(/\{TileRow\}/gi,"{row}"),l=l.replace(/\{TileCol\}/gi,"{col}"),l=l.replace(/\{dimensionValue\}/gi,e),l=l.replace(/\{dimensionValue2\}/gi,a)}return l}({dimensionMap:this.dimensionMap,layerMap:this.layerMap},e,t,r);if(i)return i}if("KVP"===this.serviceMode)return this.url+"?SERVICE=WMTS&VERSION="+this.version+"&REQUEST=GetTile&LAYER="+e+"&STYLE="+r+"&FORMAT="+i+"&TILEMATRIXSET="+t+"&TILEMATRIX={level}&TILEROW={row}&TILECOL={col}";if("RESTful"===this.serviceMode){let s="";return se[i.toLowerCase()]&&(s=se[i.toLowerCase()]),this.url+e+"/"+r+"/"+t+"/{level}/{row}/{col}"+s}return""}async _fetchService(e){let t;if(this.resourceInfo)"KVP"===this.resourceInfo.serviceMode&&(this.url+=this.url.indexOf("?")>-1?"":"?"),t={ssl:!1,data:this.resourceInfo};else try{t=await this._getCapabilities(this.serviceMode,e)}catch{const i="KVP"===this.serviceMode?"RESTful":"KVP";try{t=await this._getCapabilities(i,e),this.serviceMode=i}catch(e){throw new c("wmtslayer:unsupported-service-data","Services does not support RESTful or KVP service modes.",{error:e})}}t.data=this.resourceInfo?function(e){return e.layers.forEach((e=>{e.tileMatrixSets.forEach((e=>{const t=e.tileInfo;96!==t.dpi&&(t.lods.forEach((i=>{i.scale=96*i.scale/t.dpi,i.resolution=re(t.spatialReference.wkid,i.scale*k/96,e.id)})),t.dpi=96)}))})),e}(t.data):function(e,t){var i,r;e=e.replace(/ows:/gi,"");const s=(new DOMParser).parseFromString(e,"text/xml").documentElement,n=new Map,l=new Map,a=N("Contents",s);if(!a)throw new c("wmtslayer:wmts-capabilities-xml-is-not-valid");const o=N("OperationsMetadata",s),u=null==o?void 0:o.querySelector("[name='GetTile']"),d=null==u?void 0:u.getElementsByTagName("Get"),h=d&&Array.prototype.slice.call(d),m=null!=(i=(null==t||null==(r=t.url)?void 0:r.indexOf("https"))>-1)&&i;let p,f,y=t.serviceMode,g=t&&t.url;if(h&&h.length&&h.some((e=>{const t=N("Constraint",e);return!t||Y("AllowedValues","Value",y,t)?(g=e.attributes[0].nodeValue,!0):(!t||Y("AllowedValues","Value","RESTful",t)||Y("AllowedValues","Value","REST",t)?f=e.attributes[0].nodeValue:t&&!Y("AllowedValues","Value","KVP",t)||(p=e.attributes[0].nodeValue),!1)})),!g)if(f)g=f,y="RESTful";else if(p)g=p,y="KVP";else{const e=N("ServiceMetadataURL",s);g=e&&e.getAttribute("xlink:href")}const v=g.indexOf("1.0.0/");-1===v&&"RESTful"===y?g+="/":v>-1&&(g=g.substring(0,v)),"KVP"===y&&(g+=v>-1?"":"?"),m&&(g=g.replace(/^http:/i,"https:"));const w=H("ServiceIdentification>ServiceTypeVersion",s),x=H("ServiceIdentification>AccessConstraints",s),S=G("Layer",a),T=G("TileMatrixSet",a),I=S.map((e=>{const t=H("Identifier",e);return n.set(t,e),q(t,e,T,m,w)}));return{copyright:x,dimensionMap:l,layerMap:n,layers:I,serviceMode:y,tileUrl:g}}(t.data,{serviceMode:this.serviceMode,url:this.url}),t.data&&this.read(t.data,{origin:"service"})}async _getCapabilities(e,t){const i=this._getCapabilitiesUrl(e);return await I(i,{...t,responseType:"text"})}_getTileMatrixSetById(e){return this.findSublayerById(this.activeLayer.id).tileMatrixSets.find((t=>t.id===e))}_appendCustomParameters(e){return this._appendParameters(e,this.customParameters)}_appendCustomLayerParameters(e){return this._appendParameters(e,{...M(this.customParameters),...this.customLayerParameters})}_appendParameters(e,t){const i=E(e),r={...i.query,...t},s=L(r);return""===s?i.path:`${i.path}?${s}`}_getCapabilitiesUrl(e){let t;return this.url=this.url.split("?")[0],"KVP"===e?t=this.url+"?request=GetCapabilities&service=WMTS&version="+this.version:"RESTful"===e&&(t=this.url+"/"+this.version+"/WMTSCapabilities.xml"),t=this._appendCustomParameters(t),t}_getLowerCasedUrlParams(e){if(!e)return null;const t=E(e).query;if(!t)return null;const i={};return Object.keys(t).forEach((e=>{i[e.toLowerCase()]=t[e]})),i}_mergeParams(e,t){const i=this._getLowerCasedUrlParams(t);if(i){const t=Object.keys(i);t.length&&(e=e?M(e):{},t.forEach((t=>{e.hasOwnProperty(t)||ne.has(t)||(e[t]=i[t])})))}return e}};e([t()],le.prototype,"dimensionMap",void 0),e([t()],le.prototype,"layerMap",void 0),e([t({type:D,json:{origins:{"web-document":{write:{ignoreOrigin:!0}}}}})],le.prototype,"activeLayer",null),e([l("service","activeLayer",["layers"])],le.prototype,"readActiveLayerFromService",null),e([l(["web-document","portal-item"],"activeLayer",["wmtsInfo"])],le.prototype,"readActiveLayerFromItemOrWebDoc",null),e([b(["web-document","portal-item"],"activeLayer",{templateUrl:{type:String},tileInfo:{type:r},"wmtsInfo.layerIdentifier":{type:String},"wmtsInfo.tileMatrixSet":{type:String}})],le.prototype,"writeActiveLayer",null),e([t({type:String,value:"",json:{write:!0}})],le.prototype,"copyright",void 0),e([t({type:["show","hide"]})],le.prototype,"listMode",void 0),e([t({json:{origins:{"web-document":{read:{source:["wmtsInfo.customParameters","wmtsInfo.url"]},write:{target:"wmtsInfo.customParameters"}},"portal-item":{read:{source:["wmtsInfo.customParameters","wmtsInfo.url"]},write:{target:"wmtsInfo.customParameters"}}}}})],le.prototype,"customParameters",void 0),e([l(["portal-item","web-document"],"customParameters")],le.prototype,"readCustomParameters",null),e([t({json:{origins:{"web-document":{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}},"portal-item":{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}}}}})],le.prototype,"customLayerParameters",void 0),e([t({type:i,json:{write:{ignoreOrigin:!0},origins:{"web-document":{read:{source:"fullExtent"}},"portal-item":{read:{source:"fullExtent"}}}}})],le.prototype,"fullExtent",void 0),e([t({readOnly:!0})],le.prototype,"fullExtents",null),e([t({type:["WebTiledLayer"]})],le.prototype,"operationalLayerType",void 0),e([t()],le.prototype,"resourceInfo",void 0),e([t()],le.prototype,"serviceMode",void 0),e([l(["portal-item","web-document"],"serviceMode",["templateUrl"])],le.prototype,"readServiceMode",null),e([t({type:a.ofType(D)})],le.prototype,"sublayers",void 0),e([l("service","sublayers",["layers"])],le.prototype,"readSublayersFromService",null),e([t({readOnly:!0})],le.prototype,"supportedSpatialReferences",null),e([t({json:{read:{source:"title"}}})],le.prototype,"title",null),e([t({json:{read:!1},readOnly:!0,value:"wmts"})],le.prototype,"type",void 0),e([t({json:{origins:{service:{read:{source:"tileUrl"}},"web-document":{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}},"portal-item":{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}}}}})],le.prototype,"url",null),e([t()],le.prototype,"version",void 0),le=e([s("esri.layers.WMTSLayer")],le);const ae=le;export default ae;