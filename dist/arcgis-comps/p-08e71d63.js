import{e as t,d as i,i as s,p as e,D as r,dD as o,C as n,af as p,A as a,r as c,u as l,aE as d,aW as h,bN as m,cq as u,cu as j,bd as f,cp as b,bo as g,cR as v,S as y,ai as w,bp as _}from"./p-e58503d5.js";import{l as O,a as L}from"./p-7731c620.js";import{e as C}from"./p-e06536a7.js";import"./p-b79fcce3.js";import{i as A,p as S,m as T}from"./p-5d962998.js";import{r as V,d as I,a as R,u as E,z as P,c as z,J as x,S as D,a9 as N}from"./p-2f398ed1.js";import{n as F,b as G,e as M}from"./p-d3105731.js";import{d as H}from"./p-c93d2280.js";import{j as W,B as $}from"./p-ea916a39.js";import{m as k,l as q,p as B,d as U}from"./p-95909347.js";import{d as J}from"./p-fb38a9d0.js";import{t as K}from"./p-3c70d22f.js";import{O as Q}from"./p-3bcc4805.js";import{s as X}from"./p-70787875.js";import{A as Y,m as Z}from"./p-7de54cd0.js";import{y as tt,i as it}from"./p-340cd100.js";import{D as st,f as et}from"./p-ca295674.js";import{h as rt}from"./p-e273719b.js";import{e as ot}from"./p-2c84c65f.js";import{m as nt}from"./p-c96ccdbf.js";import"./p-53bb6ab4.js";import"./p-01e5a461.js";import"./p-ccdb8e80.js";import"./p-fea9512d.js";import"./p-4d38e149.js";import"./p-8f986f60.js";import"./p-746a9d8f.js";import"./p-3721667d.js";import"./p-f94762ac.js";import"./p-4019eec3.js";import"./p-c048b814.js";import"./p-a131049b.js";import"./p-a9a30646.js";import"./p-a2324023.js";import"./p-e6fe5d89.js";import"./p-eb48bb01.js";import"./p-b9aa4901.js";import"./p-a3955219.js";import"./p-c2152437.js";import"./p-0bb84768.js";import"./p-19bc1e3d.js";import"./p-a24f7752.js";import"./p-74de0937.js";import"./p-7f47b970.js";import"./p-0d1e969a.js";import"./p-5763113b.js";import"./p-37f005a2.js";import"./p-1c99992b.js";import"./p-f06611ed.js";import"./p-bdf9e611.js";import"./p-6484267b.js";import"./p-400ca3dc.js";import"./p-efbca0ca.js";import"./p-9b7a2176.js";import"./p-e654504b.js";import"./p-0eb619a6.js";import"./p-4d17d2cd.js";import"./p-b5b00e38.js";import"./p-765e6c28.js";import"./p-e94b450b.js";import"./p-1189fa83.js";import"./p-37058f88.js";import"./p-3e39c093.js";import"./p-8747982c.js";import"./p-7a5bfd29.js";import"./p-7d081d01.js";import"./p-54330161.js";import"./p-93765525.js";import"./p-8bc9b36a.js";import"./p-7a658388.js";import"./p-8a919d07.js";import"./p-afac6fb2.js";import"./p-612a2c14.js";import"./p-d443df87.js";import"./p-7ca40eac.js";import"./p-9087b4d3.js";import"./p-c1cd5521.js";import"./p-ca4492df.js";import"./p-9d34911e.js";import"./p-182bb5be.js";import"./p-db87794e.js";import"./p-2db4840f.js";import"./p-bba8b671.js";import"./p-5e833dfc.js";import"./p-dc852195.js";import"./p-ff2962f5.js";import"./p-da9e7ba9.js";import"./p-a8f0aa27.js";import"./p-4a96de15.js";import"./p-5032dfbd.js";import"./p-a87cccba.js";import"./p-dae095dd.js";import"./p-0e784e4d.js";import"./p-dbdf15fc.js";import"./p-e0d9ff4c.js";import"./p-08e5f531.js";import"./p-dfc6337f.js";import"./p-9f1c2d50.js";import"./p-6b2eb7a7.js";import"./p-889f7a78.js";import"./p-1f81b35d.js";import"./p-81b9df84.js";import"./p-5ce39624.js";import"./p-e9bae5e9.js";import"./p-b0565d49.js";import"./p-51a17e75.js";import"./p-d208934e.js";import"./p-480e5606.js";import"./p-22c9f19c.js";import"./p-c096b5df.js";import"./p-da33e926.js";import"./p-4a6dc5e4.js";import"./p-6a92ecb9.js";import"./p-1ab449fc.js";import"./p-a6c8fb32.js";import"./p-0edb3309.js";import"./p-e8160b60.js";import"./p-2e8ad983.js";import"./p-e3270d48.js";import"./p-e44bd0a6.js";import"./p-fe68aab5.js";import"./p-c6970847.js";import"./p-de86b3c9.js";import"./p-37d3434c.js";import"./p-120b7410.js";import"./p-b1eff69d.js";import"./p-612de336.js";import"./p-91fe06d4.js";import"./p-ab0e9273.js";import"./p-15a9486c.js";import"./p-2ae44317.js";import"./p-9f58a277.js";import"./p-9e860e7b.js";import"./p-f3659a34.js";import"./p-ca657fcf.js";import"./p-b312c1fd.js";import"./p-b8beb0d3.js";import"./p-2a99994a.js";import"./p-76f37e40.js";import"./p-eee9ef50.js";import"./p-6ded4c02.js";import"./p-1e473dab.js";import"./p-d1d9dbe4.js";import"./p-d57f9971.js";import"./p-56ed1c7a.js";import"./p-db4d63dc.js";import"./p-389c5380.js";import"./p-5f8e8f6c.js";import"./p-d2d87566.js";import"./p-db63fa0e.js";import"./p-21bd46cc.js";import"./p-4f86c37f.js";import"./p-fd584619.js";import"./p-31225789.js";import"./p-a4587ab0.js";import"./p-ea0c022e.js";import"./p-dcdb33cf.js";import"./p-954786fa.js";import"./p-d87e82bf.js";import"./p-b05e75b2.js";import"./p-2f5c7e83.js";import"./p-58c16730.js";import"./p-a8d1cf30.js";import"./p-a72732f2.js";import"./p-04a0cfca.js";import"./p-cbbdb7db.js";import"./p-97ec6ae5.js";import"./p-e72a43d7.js";import"./p-382f7028.js";import"./p-728dcbb0.js";import"./p-0923eebd.js";import"./p-568eb6e8.js";import"./p-de5b11d6.js";import"./p-c7a58085.js";import"./p-1f1360f9.js";import"./p-025c0c8e.js";import"./p-1a2ab148.js";import"./p-09dd2137.js";import"./p-42bb6c1e.js";import"./p-2e37d910.js";import"./p-24d8fcee.js";import"./p-e9596294.js";import"./p-fbb06b4d.js";import"./p-4414d64f.js";import"./p-1ccb0bf6.js";import"./p-1c2ff3a7.js";import"./p-77b9a0fc.js";import"./p-a63f7978.js";import"./p-6fe4db61.js";import"./p-f6a340f9.js";import"./p-9fe35ea1.js";import"./p-f70b836b.js";import"./p-41f2b2dd.js";let pt=class extends e{constructor(t){super(t),this.elevationAlignedTargetLocation=null,this.inputPoints={isValid:!1,observer:F(),observerSurfaceNormal:null,target:F(),targetSurfaceNormal:null,observerAdjusted:F(),targetAdjusted:F()},this.computationResult={start:F(),end:F(),intersection:F(),isValid:!1,isTargetVisible:!1},this.result=null}updateComputationResults(){this.notifyChange("computationResult")}updateInputPoints(){this.notifyChange("inputPoints")}onElevationChange(){this.notifyChange("elevationAlignedTargetLocation")}};var at;t([i()],pt.prototype,"target",void 0),t([i()],pt.prototype,"elevationAlignedTargetLocation",void 0),t([i()],pt.prototype,"inputPoints",void 0),t([i()],pt.prototype,"computationResult",void 0),t([i()],pt.prototype,"result",void 0),pt=t([s("esri.views.3d.analysis.LineOfSight.LineOfSightAnalysis")],pt);let ct=at=class extends e{clone(){return new at({type:this.type,id:r(this.id),point:r(this.point),normal:r(this.normal),ray:r(this.ray)})}equals(t){return this.type===t.type&&this.id===t.id&&o(this.point,t.point)&&n(this.normal,t.normal)&&k(this.ray,t.ray)}};t([i()],ct.prototype,"type",void 0),t([i()],ct.prototype,"id",void 0),t([i()],ct.prototype,"point",void 0),t([i()],ct.prototype,"normal",void 0),t([i()],ct.prototype,"ray",void 0),ct=at=t([s("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],ct);let lt=class extends e{constructor(t){super(t)}initialize(){this.intersector=new tt(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=0}getScreenPointIntersection(t){const i=J(t,K.get()),s=X(this.view.state.camera,i,ut);return this._getRayIntersection(s)}_getRayIntersection(t){if(p(t))return null;this.view.sceneIntersectionHelper.intersectToolIntersectorRay(t,this.intersector);const i=this.intersector.results.min,s=dt;if(!i||!i.getIntersectionPoint(s))return null;const e=this.view.renderCoordsHelper.fromRenderCoords(s,this.view.spatialReference),r=F();V(r,i.normal);const o=P(r,t.direction)>0?-1:1;I(r,r,o);const n=Y(i,this.view);if(a(n)){const s=n.layer,o=n.sourceLayer;let p;if(o)switch(o.type){case"scene":p=Q(n,o.objectIdField);break;case"integrated-mesh":{const t=i.target;p=`${t.metadata.nodeIndex}/${t.metadata.componentIndex}`;break}default:p=n.uid}else p=n.uid;return new ct({type:"Graphic",id:`${s.uid}/${p}`,ray:q(t),normal:r,point:e})}if("TerrainRenderer"===i.intersector){const s=i.target.metadata.tile.lij.slice();return new ct({type:"Terrain",id:s,ray:q(t),normal:r,point:e})}return null}_canUpdateFromIntersectionResult(t,i){if(p(t)||!i||t.type!==i.type)return!1;switch(t.type){case"Terrain":{const s=t.id,e=i.id;return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]||Z(s,e)}case"Graphic":case"I3S":return t.id===i.id}}updateFromIntersectionResult(t){let i;if("Terrain"===t.type&&a(t.point)){const s=dt,e=ht,r=mt;this.view.renderCoordsHelper.toRenderCoords(t.point,e),this.view.renderCoordsHelper.worldUpAtPosition(e,r);const o=this.view.basemapTerrain.elevationBounds,n=this.view.renderCoordsHelper.getAltitude(e),p=o?Math.abs(o.max-o.min)/Math.abs(n):100,a=n>0?1:-1;R(r,r),I(r,r,a*p),E(s,e,r),B(s,e,ut),i=this._getRayIntersection(ut)}else i=this._getRayIntersection(t.ray);return this._canUpdateFromIntersectionResult(i,t)?i.point:null}};t([i()],lt.prototype,"view",void 0),t([i()],lt.prototype,"intersector",void 0),lt=t([s("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],lt);const dt=F(),ht=F(),mt=F(),ut=U();let jt=class extends e{constructor(t){super(t),this.target=null,this.intersectedGraphic=null,this.intersectedLocation=null,this.elevationAlignedTargetLocation=null}};t([i()],jt.prototype,"target",void 0),t([i()],jt.prototype,"intersectedGraphic",void 0),t([i()],jt.prototype,"intersectedLocation",void 0),t([i()],jt.prototype,"elevationAlignedTargetLocation",void 0),t([i()],jt.prototype,"visible",void 0),jt=t([s("esri.views.3d.analysis.LineOfSight.LineOfSightResult")],jt);let ft=class extends(c.EventedMixin(e)){constructor(t){super(t),this._updatingHandles=new O,this._frameTask=st,this._handles=new l,this._analysisHandles=new l}initialize(){var t;const i=null==(t=this.view.resourceController)?void 0:t.scheduler;i&&(this._frameTask=i.registerTask(et.LINE_OF_SIGHT_TOOL)),this._handles.add([this._connectObserver(),this._connectAnalyses(),this._connectTargets()]),this._intersector=new lt({view:this.view})}destroy(){this._handles.destroy(),this._analysisHandles.destroy(),this._analyses.removeAll(),this._updatingHandles.destroy()}get updating(){return this._frameTask.updating||this._updatingHandles.updating}get priority(){return this._frameTask.priority}set priority(t){this._frameTask.priority=t}get _analyses(){return this.analysisViewData.analyses}get _observerEngineLocation(){return this.analysisViewData.observerEngineLocation}set _observerEngineLocation(t){this.analysisViewData.observerEngineLocation=t}get _screenPixelSize(){return this.view.state.camera.computeScreenPixelSizeAt(this._observerEngineLocation)}getLineOfSightComputationDependencies(t){const{inputPoints:i}=t;return{inputPoints:i}}computeAnalysis(t){const i=t.analysis,{inputPoints:s,computationResult:e}=i,{observerAdjusted:r,targetAdjusted:o}=s,{start:n,end:p}=e;V(n,r),V(p,o),this._canComputeAnalysis(i)?this._computeAnalysisIntersection(t):this._interpolateAnalysisIntersection(t),i.updateComputationResults(),this.emit("result-changed",{target:t.analysis.target,result:i.result})}_adjustStartEndPositions(t){const i=this._screenPixelSize,s=this.view,{inputPoints:e}=t,{observer:r,observerSurfaceNormal:o,target:n,targetSurfaceNormal:p,observerAdjusted:c,targetAdjusted:l}=e,d=vt;a(o)?V(d,o):z(d,n,r);const h=i;R(d,d),I(d,d,Math.min(h,1)),E(c,r,d),a(p)?V(d,p):z(d,r,n);const m=s.state.camera.computeScreenPixelSizeAt(n);R(d,d),I(d,d,Math.min(m,1)),E(l,n,d)}_computeAnalysisIntersection({analysis:t,interpolationInfo:i}){const{view:s}=this,{sceneIntersectionHelper:e,renderCoordsHelper:r}=s;if(p(e))return;const o=this._intersector.intersector,{computationResult:n,inputPoints:c}=t,{observer:l,target:h}=c,{start:m,end:u}=n,j=B(m,u,yt);e.intersectToolIntersectorRay(j,o);const f=n.intersection,b=vt,g=!!o.results.min&&o.results.min.getIntersectionPoint(f);let v=!0;if(g){V(i.originalIntersection,f),V(i.originalObserver,m),V(i.originalTarget,u),r.fromRenderCoords(f,b,s.spatialReference);const t=1-D(u,h)/D(m,h);v=D(l,f)>=t*D(l,h)}const y=new d(b,s.spatialReference);{const{result:i,target:e}=t;a(i)?(i.target=e,i.intersectedGraphic=v?null:Y(o.results.min,s),i.intersectedLocation=v?null:y,i.visible=!!g&&v):t.result=new jt({target:e,elevationAlignedTargetLocation:t.elevationAlignedTargetLocation,intersectedGraphic:v?null:Y(o.results.min,s),intersectedLocation:v?null:y,visible:!!g&&v})}n.isValid=c.isValid=!0,n.isTargetVisible=v}_interpolateAnalysisIntersection({analysis:t,interpolationInfo:i}){const{computationResult:s,inputPoints:e}=t,{start:r,end:o,intersection:n}=s,{originalIntersection:p,originalObserver:a,originalTarget:c}=i;if(V(n,p),e.isValid){const t=vt,i=D(a,p)/D(a,c);x(t,r,a),I(t,t,1-i),E(n,n,t),x(t,o,c),I(t,t,i),E(n,n,t),s.isValid=!0}else t.result=new jt,s.isValid=!1,s.isTargetVisible=!1}_canComputeAnalysis(t){const i=this.view.frustum;if(p(this.analysisViewData.elevationAlignedObserver)||p(t.target)||p(i))return!1;const{observerAdjusted:s,targetAdjusted:e}=t.inputPoints,r=i.intersectsPoint(s),o=i.intersectsPoint(e);return r&&o}_onObserverChange(t){if(p(t))return this.analysis.targets.removeAll(),void(this.analysisViewData.elevationAlignedObserver=null);this.analysisViewData.elevationAlignedObserver=this._applyElevationAlignment(t,this.analysis.intersection);const i=F();this.view.renderCoordsHelper.toRenderCoords(this.analysisViewData.elevationAlignedObserver,i),this._observerEngineLocation=i,this.priority=et.LINE_OF_SIGHT_TOOL_INTERACTIVE}_applyElevationAlignment(t,i){if(t.hasZ&&(p(i)||"Graphic"===i.type))return t;const s=t.clone();return s.z=h(it(this.view.elevationProvider,s),0),s}_onObserverChangeForAnalysis(t){t.inputPoints.isValid=!1}_onObserverEngineForAnalysis(t,i,s){const{inputPoints:e}=t;if(V(e.observer,i),a(s)){const t=this._intersector.updateFromIntersectionResult(s);a(t)&&this.view.renderCoordsHelper.toRenderCoords(t,e.observer),e.observerSurfaceNormal=G(s.normal)}else e.observerSurfaceNormal=null;this._adjustStartEndPositions(t),t.updateInputPoints(),this.priority=et.LINE_OF_SIGHT_TOOL_INTERACTIVE}_onTargetLocationChange(t,i,s){const e=t.inputPoints;if(e.isValid=!1,a(i)){if(t.elevationAlignedTargetLocation=this._applyElevationAlignment(i,s),this.view.renderCoordsHelper.toRenderCoords(t.elevationAlignedTargetLocation,e.target),a(s)){const t=this._intersector.updateFromIntersectionResult(s);a(t)&&this.view.renderCoordsHelper.toRenderCoords(t,e.target),e.targetSurfaceNormal=G(s.normal)}else e.targetSurfaceNormal=null;this._adjustStartEndPositions(t),t.updateInputPoints()}this.priority=et.LINE_OF_SIGHT_TOOL_INTERACTIVE}_connectAnalysisToTarget(t){return A((()=>({analysis:t,targetLocation:t.target.location,targetIntersection:t.target.intersection})),(({analysis:t,targetLocation:i,targetIntersection:s})=>{a(i)&&this._onTargetLocationChange(t,i,s)}),S)}_connectAnalysisToObserver(t){return A((()=>({analysis:t,observer:this.analysisViewData.elevationAlignedObserver})),(({analysis:t})=>{this._onObserverChangeForAnalysis(t)}),S)}_connectAnalysisToObserverEngine(t){return A((()=>({analysis:t,observer:this._observerEngineLocation,observerIntersection:this.analysis.intersection})),(({analysis:t,observer:i,observerIntersection:s})=>{this._onObserverEngineForAnalysis(t,i,s)}),S)}_connectAnalysisToCamera(t){return A((()=>({camera:this.view.state.camera,isDirty:this._isCameraDirty})),(({isDirty:i})=>{t.inputPoints.isValid&&!i||t.updateInputPoints()}),T)}_connectAnalysisToElevation(t){return this.view.elevationProvider.on("elevation-change",(i=>{if(!this._canComputeAnalysis(t))return;const s=this.analysis.observer;bt(i.extent,i.spatialReference,s)&&this._onObserverChange(s);const e=t.target;a(e)&&bt(i.extent,i.spatialReference,e.location)&&t.onElevationChange()}))}_connectAnalysisForCompute(t){let i=v;const s={analysis:t,interpolationInfo:{originalIntersection:F(),originalObserver:F(),originalTarget:F()}};return m([A((()=>this.getLineOfSightComputationDependencies(t)),(()=>{i=u(i),i=j((async t=>{await f(this._frameTask.schedule((()=>this.computeAnalysis(s)),t))}))}),S),b((()=>i=u(i)))])}_connectAnalysis(t){const i=this._analysisHandles;i.has(t)||i.add([this._connectAnalysisToTarget(t),this._connectAnalysisToObserver(t),this._connectAnalysisToObserverEngine(t),this._connectAnalysisToCamera(t),this._connectAnalysisToElevation(t),this._connectAnalysisForCompute(t)])}_disconnectAnalysis(t){this._analysisHandles.remove(t)}_onAnalysesCollectionChange(t){t.added.forEach((t=>this._connectAnalysis(t))),t.removed.forEach((t=>this._disconnectAnalysis(t)))}_onTargetsChange(){return this._analyses.removeAll(),this.analysis.targets.forEach((t=>this._addTarget(t))),this._updatingHandles.addOnCollectionPropertyChange(this.analysis,"targets",(t=>this._onTargetCollectionChange(t)))}_onTargetCollectionChange(t){t.added.forEach((t=>this._addTarget(t))),t.removed.forEach((t=>this._removeTarget(t)))}_onCursorTargetChange(t,i){a(i)&&this._removeTarget(i),a(t)&&this._addTarget(t)}_addTarget(t){this._analyses.some((i=>i.target===t))||this._analyses.add(new pt({target:t}))}_removeTarget(t){const i=this._analyses.find((i=>i.target===t));this._analyses.remove(i)}_connectObserver(){return m([A((()=>this.analysis.observer),(t=>this._onObserverChange(t)),S)])}_connectAnalyses(){let t=null;return m([A((()=>this._analyses),(()=>{g(t),t=this._updatingHandles.addOnCollectionPropertyChange(this,"_analyses",(t=>this._onAnalysesCollectionChange(t))),this._analyses.forEach((t=>this._connectAnalysis(t)))}),S),b((()=>t=g(t)))])}_connectTargets(){let t=null;return m([A((()=>this.analysis.targets),(()=>{t=g(t),t=this._onTargetsChange()}),S),A((()=>this.analysisViewData.cursorTarget),((t,i)=>{this._onCursorTargetChange(t,i)})),b((()=>{t=g(t)}))])}get _isCameraDirty(){const t=this.analysisViewData.elevationAlignedObserver,{view:i}=this,{renderCoordsHelper:s}=i;if(p(t)||p(s))return!1;const e=vt;s.toRenderCoords(t,e);const r=i.state.camera.computeScreenPixelSizeAt(e);return Math.abs((r-this._screenPixelSize)/this._screenPixelSize)>gt}};function bt(t,i,s){return!p(s)&&(H(t,i,wt,s.spatialReference),W(wt,s))}t([i({constructOnly:!0})],ft.prototype,"analysis",void 0),t([i({constructOnly:!0})],ft.prototype,"analysisViewData",void 0),t([i({constructOnly:!0})],ft.prototype,"view",void 0),t([i()],ft.prototype,"updating",null),t([i()],ft.prototype,"priority",null),t([i()],ft.prototype,"_analyses",null),t([i()],ft.prototype,"_observerEngineLocation",null),t([i()],ft.prototype,"_screenPixelSize",null),t([i({readOnly:!0})],ft.prototype,"_updatingHandles",void 0),t([i()],ft.prototype,"_frameTask",void 0),t([i()],ft.prototype,"_isCameraDirty",null),ft=t([s("esri.views.3d.analysis.LineOfSight.LineOfSightController")],ft);const gt=.1,vt=F(),yt=U(),wt=$();let _t=class extends e{constructor(t){super(t),this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new rt([3,252,111,1]),this.visibleOuterColor=new rt([3,252,111,.15]),this.occludedInnerColor=new rt([252,3,69,1]),this.occludedOuterColor=new rt([252,3,69,.1]),this.undefinedInnerColor=new rt([255,255,255,1]),this.undefinedOuterColor=new rt([127,127,127,.2])}};t([i({type:Number})],_t.prototype,"innerWidth",void 0),t([i({type:Number})],_t.prototype,"outerWidth",void 0),t([i({type:rt})],_t.prototype,"visibleInnerColor",void 0),t([i({type:rt})],_t.prototype,"visibleOuterColor",void 0),t([i({type:rt})],_t.prototype,"occludedInnerColor",void 0),t([i({type:rt})],_t.prototype,"occludedOuterColor",void 0),t([i({type:rt})],_t.prototype,"undefinedInnerColor",void 0),t([i({type:rt})],_t.prototype,"undefinedOuterColor",void 0),_t=t([s("esri.views.3d.analysis.LineOfSight.LineOfSightConfiguration")],_t);let Ot=class extends e{constructor(){super(...arguments),this.analyses=new y,this.elevationAlignedObserver=null,this.configuration=new _t,this.observerEngineLocation=F(),this.cursorTarget=null}};t([i()],Ot.prototype,"analyses",void 0),t([i()],Ot.prototype,"elevationAlignedObserver",void 0),t([i({type:_t})],Ot.prototype,"configuration",void 0),t([i()],Ot.prototype,"observerEngineLocation",void 0),t([i()],Ot.prototype,"cursorTarget",void 0),Ot=t([s("esri.views.3d.analysis.LineOfSight.LineOfSightLayerViewData")],Ot);let Lt=class extends e{constructor(t){super(t),this._handle=null,this._analysisHandles=new l}initialize(){this._handle=this._connectAnalyses()}destroy(){this._handle=g(this._handle),this._analysisHandles=w(this._analysisHandles)}get visible(){return this.analysisView.visible&&!this.analysisView.suspended}get _analyses(){return this.analysisView.analysisViewData.analyses}get _configuration(){return this.analysisView.analysisViewData.configuration}get _opacity(){return this.analysisView.fullOpacity}createLineOfSightVisualization(){const t=this._configuration,i=this._opacity,s={view:this.view,attached:!0,width:t.outerWidth,innerWidth:t.innerWidth},e=rt.toUnitRGBA(t.visibleOuterColor);N(e,e,i);const r=rt.toUnitRGBA(t.visibleInnerColor);N(r,r,i);const o=rt.toUnitRGBA(t.occludedOuterColor);N(o,o,i);const n=rt.toUnitRGBA(t.occludedInnerColor);N(n,n,i);const p=rt.toUnitRGBA(t.undefinedOuterColor);N(p,p,i);const a=rt.toUnitRGBA(t.undefinedInnerColor);return N(a,a,i),{visibleLineVisualElement:new nt({...s,color:e,innerColor:r}),occludedLineVisualElement:new nt({...s,color:o,innerColor:n}),undefinedLineVisualElement:new nt({...s,color:p,innerColor:a})}}destroyLineOfSightVisualization(t){t.visibleLineVisualElement=w(t.visibleLineVisualElement),t.occludedLineVisualElement=w(t.occludedLineVisualElement),t.undefinedLineVisualElement=w(t.undefinedLineVisualElement)}updateLineOfSightVisualization(t,i){const s=this.visible,e=this._configuration,{computationResult:r,inputPoints:o}=t,{start:n,end:p,intersection:a,isValid:c,isTargetVisible:l}=r,{observer:d}=o,h=Tt;h[12]=d[0],h[13]=d[1],h[14]=d[2];const m=z(Ct,n,d),u=z(At,p,d),j=z(St,a,d),{visibleLineVisualElement:f,occludedLineVisualElement:b,undefinedLineVisualElement:g}=i;if(!s)return f.visible=!1,b.visible=!1,void(g.visible=!1);if(f.visible=!0,b.visible=!0,g.visible=!0,f.geometry=null,b.geometry=null,g.geometry=null,c)if(l){f.geometry=[[M(m),M(u)]],f.transform=h;const t=rt.toUnitRGBA(e.visibleOuterColor);f.color=N(t,t,this._opacity)}else{f.geometry=[[M(m),M(j)]],f.transform=h;const t=rt.toUnitRGBA(e.occludedOuterColor);f.color=N(t,t,this._opacity),b.geometry=[[M(j),M(u)]],b.transform=h}else g.geometry=[[M(m),M(u)]],g.transform=h}updateVisualizationOpacity(t,i){const s=this._configuration,e=this._opacity,r=rt.toUnitRGBA(s.visibleOuterColor);N(r,r,e);const o=rt.toUnitRGBA(s.visibleInnerColor);N(o,o,e);const n=rt.toUnitRGBA(s.occludedOuterColor);N(n,n,e);const p=rt.toUnitRGBA(s.occludedInnerColor);N(p,p,e);const a=rt.toUnitRGBA(s.undefinedOuterColor);N(a,a,e);const c=rt.toUnitRGBA(s.undefinedInnerColor);N(c,c,e),i.visibleLineVisualElement.color=t.computationResult.isTargetVisible?r:n,i.visibleLineVisualElement.innerColor=o,i.occludedLineVisualElement.color=n,i.occludedLineVisualElement.innerColor=p,i.undefinedLineVisualElement.color=a,i.undefinedLineVisualElement.innerColor=c}getLineOfSightVisualizationDependencies(t){const{computationResult:i}=t,{occludedOuterColor:s,visibleOuterColor:e}=this._configuration;return{computationResult:i,occludedOuterColor:s,visibleOuterColor:e,visible:this.visible}}_connectAnalysis(t){const i=this._analysisHandles;if(i.has(t))return;const s=this.createLineOfSightVisualization();i.add([A((()=>this.getLineOfSightVisualizationDependencies(t)),(()=>this.updateLineOfSightVisualization(t,s)),S),A((()=>this._opacity),(()=>this.updateVisualizationOpacity(t,s)),T),b((()=>this.destroyLineOfSightVisualization(s)))],t)}_disconnectAnalysis(t){this._analysisHandles.remove(t)}_connectAnalyses(){let t=null;return m([A((()=>this._analyses),(i=>{t=g(t),t=i.on("change",(t=>this._onAnalysesCollectionChange(t))),this._onAnalysesCollectionChange({target:i,added:i.items,removed:[],moved:[]})}),S),b((()=>t=g(t)))])}_onAnalysesCollectionChange(t){t.added.forEach((t=>this._connectAnalysis(t))),t.removed.forEach((t=>this._disconnectAnalysis(t)))}};t([i({constructOnly:!0})],Lt.prototype,"analysis",void 0),t([i({constructOnly:!0})],Lt.prototype,"analysisView",void 0),t([i({constructOnly:!0})],Lt.prototype,"view",void 0),t([i({readOnly:!0})],Lt.prototype,"visible",null),t([i()],Lt.prototype,"_analyses",null),t([i()],Lt.prototype,"_configuration",null),t([i()],Lt.prototype,"_opacity",null),Lt=t([s("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],Lt);const Ct=F(),At=F(),St=F(),Tt=ot();let Vt=class extends(C(L(c.EventedMixin(e)))){constructor(t){super(t),this.type="line-of-sight-view",this.suspended=!1,this.fullOpacity=1,this.analysisViewData=new Ot}initialize(){const t=this.view,i=this.analysis;this._analysisController=new ft({analysis:i,analysisViewData:this.analysisViewData,view:t}),this._analysisVisualization=new Lt({analysis:i,analysisView:this,view:t}),this.handles.add([this._analysisController.on("result-changed",(t=>{t.target!==this.analysisViewData.cursorTarget&&this.emit("result-changed",t)}))])}destroy(){this._analysisController=w(this._analysisController),this._analysisVisualization=w(this._analysisVisualization)}get results(){return this.analysisViewData.analyses.map((t=>t.result))}get priority(){return this._analysisController.priority}set priority(t){this._analysisController.priority=t}get updating(){return a(this._analysisController)&&this._analysisController.updating}getResultForTarget(t){const i=this.analysisViewData.analyses.find((i=>i.target===t)),s=_(i,(t=>t.result));return h(s,null)}get test(){return{visualization:this._analysisVisualization,controller:this._analysisController}}};t([i()],Vt.prototype,"type",void 0),t([i()],Vt.prototype,"analysis",void 0),t([i({readOnly:!0})],Vt.prototype,"results",null),t([i()],Vt.prototype,"priority",null),t([i()],Vt.prototype,"suspended",void 0),t([i()],Vt.prototype,"fullOpacity",void 0),t([i()],Vt.prototype,"analysisViewData",void 0),t([i()],Vt.prototype,"updating",null),t([i()],Vt.prototype,"_analysisController",void 0),t([i()],Vt.prototype,"_analysisVisualization",void 0),Vt=t([s("esri.views.3d.analysis.LineOfSight.LineOfSightView")],Vt);const It=Vt;export default It;