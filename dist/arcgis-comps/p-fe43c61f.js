import{W as t,aj as s,B as i,U as r,$ as p,g as e,e as o,i as a}from"./p-c8bc3433.js";import{l as h,u as n}from"./p-c4678b0b.js";import{i as c}from"./p-bff8da07.js";import{r as f}from"./p-ad145b1b.js";import"./p-84bf99cb.js";import"./p-8fd94488.js";import"./p-feee221d.js";import"./p-a6945989.js";import"./p-30eee135.js";import"./p-b0a11892.js";import"./p-ea65d9c9.js";import"./p-47e1bd73.js";import"./p-b392deaf.js";import"./p-9790d1b4.js";import"./p-099e7dab.js";import"./p-50ff864e.js";import"./p-fd064341.js";import"./p-b8e3591b.js";import"./p-f806c5d9.js";import"./p-2c46c687.js";import"./p-60f5af83.js";import"./p-4414d64f.js";import"./p-a617738c.js";import"./p-be58da65.js";import"./p-17a8cfc0.js";import"./p-97ec6ae5.js";import"./p-f9493103.js";import"./p-c167c2b1.js";import"./p-1fcdfc57.js";import"./p-38a6e03f.js";import"./p-a805321e.js";import"./p-96687495.js";import"./p-815ddfb1.js";import"./p-b220b850.js";import"./p-a989744e.js";import"./p-429d3db0.js";import"./p-167f65f1.js";import"./p-b7c042b3.js";import"./p-7c926f90.js";import"./p-e991a11e.js";import"./p-b1c9647c.js";const m="sublayers",j="layerView",d=Object.freeze({remove(){},pause(){},resume(){}});let u=class extends(h(n)){async fetchPopupFeatures(t){return(await Promise.all(Array.from(this.graphicsViews(),(s=>s.searchFeatures(t).then((t=>t.filter((t=>!!t.popupTemplate)))))))).flat()}*graphicsViews(){t(this._graphicsViewsFeatureCollectionMap)?yield*this._graphicsViewsFeatureCollectionMap.keys():t(this._graphicsViews)?yield*this._graphicsViews:yield*[]}async hitTest(s,i){if(this.suspended)return null;const r=Array.from(this.graphicsViews(),(async r=>{const p=await r.hitTest(s,i);if(p){if(t(this._graphicsViewsFeatureCollectionMap)){const t=this._graphicsViewsFeatureCollectionMap.get(r);!p.popupTemplate&&t.popupTemplate&&(p.popupTemplate=t.popupTemplate)}return p}return null}));return(await Promise.all(r)).filter((t=>!!t))[0]||null}highlight(t){let r;if("number"==typeof t?r=[t]:t instanceof s?r=[t.uid]:Array.isArray(t)&&t.length>0?r="number"==typeof t[0]?t:t.map((t=>t&&t.uid)):i.isCollection(t)&&(r=t.map((t=>t&&t.uid)).toArray()),r=r.filter((t=>null!=t)),!r.length)return d;for(const t of this.graphicsViews())t.addHighlight(r);return{remove:()=>{for(const t of this.graphicsViews())t.removeHighlight(r)}}}update(t){for(const s of this.graphicsViews())s.processUpdate(t)}attach(){const s=this.view,i=()=>this.requestUpdate(),e=this.layer.featureCollections;if(t(e)&&e.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const t of e){const p=new c(this.view.featuresTilingScheme);p.fadeTransitionEnabled=!0;const e=new f({view:s,graphics:t.source,renderer:t.renderer,requestUpdateCallback:i,container:p});this._graphicsViewsFeatureCollectionMap.set(e,t),this.container.addChild(e.container),this.handles.add([r(t,"visible",(t=>e.container.visible=t)),r(e,"updating",(()=>this.notifyChange("updating")))],j)}}else t(this.layer.sublayers)&&this.handles.add(p(this.layer,"sublayers","change",(()=>this._createGraphicsViews()),(()=>this._createGraphicsViews()),(()=>this._destroyGraphicsViews())),m)}detach(){this._destroyGraphicsViews(),this.handles.remove(m)}moveStart(){}moveEnd(){}viewChange(){for(const t of this.graphicsViews())t.viewChange()}isUpdating(){for(const t of this.graphicsViews())if(t.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.handles.remove(j);for(const t of this.graphicsViews())t.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),e(this.layer.sublayers))return;const t=[],s=this.view,i=()=>this.requestUpdate();for(const p of this.layer.sublayers){const e=new c(this.view.featuresTilingScheme);e.fadeTransitionEnabled=!0;const o=new f({view:s,graphics:p.graphics,requestUpdateCallback:i,container:e});this.handles.add([p.on("graphic-update",o.graphicUpdateHandler),r(p,"visible",(t=>o.container.visible=t)),r(o,"updating",(()=>this.notifyChange("updating")))],j),this.container.addChild(o.container),t.push(o)}this._graphicsViews=t}};u=o([a("esri.views.2d.layers.MapNotesLayerView2D")],u);const b=u;export default b;