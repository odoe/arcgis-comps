import{r as t,c as i,g as e}from"./p-53bb6ab4.js";import{e as s,d as a,i as n,p as l,u as r,a as o,a1 as h,S as d,at as c,c as p,s as u,Q as m,t as v,x as b,o as _,j as f,z as w,aC as y,aG as g,l as x,B as k,cn as T,b_ as j,M as O}from"./p-e58503d5.js";import{n as I,r as L,Q as M,p as P}from"./p-5faa9676.js";import{B as $,m as E}from"./p-efbca0ca.js";import{s as C}from"./p-da9e7ba9.js";import{f as F}from"./p-78a21eae.js";import"./p-fb38a9d0.js";import"./p-b79fcce3.js";import"./p-9f1c2d50.js";import"./p-e273719b.js";import"./p-74de0937.js";import"./p-2f398ed1.js";import"./p-d3105731.js";import"./p-54330161.js";import"./p-93765525.js";import"./p-765e6c28.js";import"./p-a9a30646.js";import"./p-8747982c.js";import"./p-8bc9b36a.js";import"./p-7a658388.js";import"./p-f94762ac.js";import"./p-ea916a39.js";import"./p-8a919d07.js";import"./p-c048b814.js";import"./p-6b2eb7a7.js";import"./p-01e5a461.js";import"./p-dfc6337f.js";import"./p-c1cd5521.js";import"./p-a131049b.js";import"./p-a2324023.js";import"./p-7ca40eac.js";import"./p-dc852195.js";import"./p-e258f3af.js";import"./p-03d6250d.js";let A=class extends l{constructor(t){super(t),this._handles=new r,this.state="pending",this.url=""}initialize(){this._handles.add([o(this,["extension","name"],(()=>this._setFormattedFileName()))])}destroy(){this._handles.destroy()}_setFormattedFileName(){if(!this.name||!this.extension)return;let t=this.name+"."+this.extension;this.count&&(t=this.name+"("+this.count+")."+this.extension),this.formattedName=t}};s([a()],A.prototype,"count",void 0),s([a()],A.prototype,"error",void 0),s([a()],A.prototype,"extension",void 0),s([a()],A.prototype,"formattedName",void 0),s([a()],A.prototype,"name",void 0),s([a()],A.prototype,"state",void 0),s([a()],A.prototype,"url",void 0),A=s([n("esri.widgets.print.FileLink")],A);const S=A;let D=class extends l{constructor(t){super(t),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};s([a()],D.prototype,"extent",void 0),s([a()],D.prototype,"extraParameters",void 0),s([a()],D.prototype,"outSpatialReference",void 0),s([a()],D.prototype,"template",void 0),s([a()],D.prototype,"updateDelay",void 0),s([a()],D.prototype,"view",void 0),D=s([n("esri.rest.support.PrintParameters")],D);const U=D;let N=class extends h{constructor(t){super(t),this.description=null,this.format=null,this.label=null,this.layout=null,this.layoutOptions=null}};s([a()],N.prototype,"description",void 0),s([a({json:{read:I}})],N.prototype,"format",void 0),s([a()],N.prototype,"label",void 0),s([a({json:{read:L}})],N.prototype,"layout",void 0),s([a()],N.prototype,"layoutOptions",void 0),N=s([n("esri.widgets.Print.CustomTemplate")],N);const V=N,z=d.ofType(V);let R=class extends E{constructor(t){super(t),this._handles=new r,this.allowedFormats="all",this.allowedLayouts="all",this.defaultTemplates=new z,this.extraParameters=null,this.includeDefaultTemplates=!0,this.effectivePrintServiceUrl=null,this.error=null,this.portal=$.getDefault(),this.printServiceUrl=null,this.templatesInfo=null,this.updateDelay=1e3,this.view=null,this.print=this.print.bind(this)}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return"loading"===this.loadStatus?"initializing":this.error||"failed"===this.loadStatus?"error":this.get("view.ready")&&"loaded"===this.loadStatus?"ready":"disabled"}set scaleEnabled(t){c(p.getLogger(this.declaredClass),"scaleEnabled",{version:"4.22"}),this.set("scaleEnabled",t)}async load(t){return this.addResolvingPromise(this._loadResources(t).catch((t=>this.error=t))),this}async print(t){const{view:i,extraParameters:e,updateDelay:s}=this;if(!i)throw new u("print:view-required","view is not set");!function(t){if(t.layoutOptions||(t.layoutOptions={}),t.layoutOptions.customTextElements||(t.layoutOptions.customTextElements=[]),!t.layoutOptions.customTextElements.find((t=>"date"in t))){const{customTextElements:i}=t.layoutOptions;i.push({date:v(Date.now(),b("short-date"))})}}(t);const a=new U({view:i,template:t,extraParameters:e,updateDelay:s});try{return await M(this.effectivePrintServiceUrl,a)}catch(t){throw new u("print:export-error","An error occurred while exporting the web map.",{error:t})}}async _loadResources(t){let i=[];const{printServiceUrl:e}=this;if(!e){var s;if(this.destroyed)return;const{portal:e}=this;try{await e.load(t)}catch(t){throw new u("print:could-not-load-portal","Cannot load print resource information from portal",{url:this.effectivePrintServiceUrl})}const n=null==(s=e.helperServices)?void 0:s.printTask;var a;n&&(this._set("effectivePrintServiceUrl",n.url),i=(null!=(a=null==n?void 0:n.templates)?a:[]).map((t=>V.fromJSON(t))))}i.length>0&&this.defaultTemplates.addMany(i),await this._loadServiceDescription(t)}async _loadServiceDescription(t){const i=await this._getPrintTemplatesFromService(t);this._set("templatesInfo",i)}_getPrintTemplatesFromService(t){if(-1===this.effectivePrintServiceUrl.toLowerCase().split("/").indexOf("gpserver"))throw new u("print:invalid-print-service-url","Can't fetch print templates information from provided URL",{url:this.effectivePrintServiceUrl});return m(this.effectivePrintServiceUrl,{...t,query:{f:"json"},timeout:6e4}).then((t=>{const i=t&&t.data;let e=null,s=null;return(i&&i.parameters).forEach((t=>{let i,a=t.choiceList&&t.choiceList.slice();a&&a.length&&t.defaultValue&&(i=a.indexOf(t.defaultValue)),i>-1&&(a.splice(i,1),a.unshift(t.defaultValue));const n=(t,i)=>{const e="all"===i?t:t.filter((t=>i.indexOf(t)>-1));return 0===e.length?t:e};if("Format"===t.name){const i=n(a.map(I),this.allowedFormats),s=I(t.defaultValue);e={defaultValue:i.includes(s)?s:i[0],choiceList:i}}else if("Layout_Template"===t.name){let i,e;a=a.filter((t=>"map_only"!==t.toLowerCase())),a.some(((t,e)=>{const s=t.toLowerCase();return s.indexOf("letter")>-1&&s.indexOf("landscape")>-1?(i=e,!0):s.indexOf("a4")>-1&&s.indexOf("landscape")>-1&&(i=e,!1)})),i&&(e=a[i],a.splice(i,1),a.unshift(e));const l=n(a.map(L),this.allowedLayouts),r=L(t.defaultValue);s={defaultValue:l.includes(r)?r:l[0],choiceList:l}}})),this.error=null,{format:e,layout:s}})).catch((t=>{throw new u("print:unavailable-service-info","Can't fetch templates info from service",{error:t})}))}};s([a()],R.prototype,"allowedFormats",void 0),s([a()],R.prototype,"allowedLayouts",void 0),s([a({type:z})],R.prototype,"defaultTemplates",void 0),s([a()],R.prototype,"extraParameters",void 0),s([a()],R.prototype,"includeDefaultTemplates",void 0),s([a({aliasOf:{source:"printServiceUrl",overridable:!0},readOnly:!0})],R.prototype,"effectivePrintServiceUrl",void 0),s([a()],R.prototype,"error",void 0),s([a({type:$})],R.prototype,"portal",void 0),s([a()],R.prototype,"printServiceUrl",void 0),s([a({readOnly:!0})],R.prototype,"state",null),s([a()],R.prototype,"scaleEnabled",null),s([a({readOnly:!0})],R.prototype,"templatesInfo",void 0),s([a()],R.prototype,"updateDelay",void 0),s([a()],R.prototype,"view",void 0),R=s([n("esri.widgets.Print.PrintViewModel")],R);const q=R;let H=class extends l{constructor(t){super(t),this.attributionEnabled=!0,this.author=null,this.copyright=null,this.dpi=96,this.fileName=null,this.forceFeatureAttributes=!1,this.format=null,this.layout=null,this.legendEnabled=!0,this.height=null,this.scale=null,this.scaleEnabled=!1,this.title=null,this.width=null}};s([a()],H.prototype,"attributionEnabled",void 0),s([a()],H.prototype,"author",void 0),s([a()],H.prototype,"copyright",void 0),s([a()],H.prototype,"dpi",void 0),s([a()],H.prototype,"fileName",void 0),s([a()],H.prototype,"forceFeatureAttributes",void 0),s([a()],H.prototype,"format",void 0),s([a()],H.prototype,"layout",void 0),s([a()],H.prototype,"legendEnabled",void 0),s([a()],H.prototype,"height",void 0),s([a()],H.prototype,"scale",void 0),s([a()],H.prototype,"scaleEnabled",void 0),s([a()],H.prototype,"title",void 0),s([a()],H.prototype,"width",void 0),H=s([n("esri.widgets.Print.TemplateOptions")],H);const B=H,G=d.ofType(S),K="MAP_ONLY",Q="esri-print__input-text",W="esri-print__form-section-container",Y="esri-print__panel-container",J="esri-input",X=p.getLogger("esri.widgets.Print"),Z="User sets an invalid layout, resetting it to the default valid one...",tt="User sets an invalid format, resetting it to the default valid one...";function it(t){return(null==t?void 0:t.toUpperCase())===K}let et=class extends w{constructor(t,i){super(t,i),this._activeTabFocusRequested=!1,this._advancedOptionsVisibleForLayout=!1,this._advancedOptionsVisibleForMapOnly=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._focusedTemplateIndex=0,this._layoutTabSelected=!0,this._pendingExportScroll=!1,this._rootNode=null,this._selectTemplateNode=null,this._templateListPopover=new F({owner:this,placement:"top",offset:[0,-100],anchorElement:()=>this._selectTemplateNode,renderContentFunction:this.renderTemplateList}),this.allowedFormats=null,this.allowedLayouts=null,this.exportedLinks=new G,this.extraParameters=null,this.headingLevel=3,this.iconClass="esri-icon-printer",this.includeDefaultTemplates=null,this.label=void 0,this.portal=null,this.printServiceUrl=null,this.templateOptions=new B,this.view=null,this.viewModel=new q,this.handleTemplateListCreation=t=>t.focus(),this.handleTemplateChildBlur=t=>{var i;(null==(i=t.relatedTarget)?void 0:i.closest(".esri-print__template-list"))||this.handleCloseTemplateSelection()},this.handleCloseTemplateSelection=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!1,this._selectTemplateNode.focus()},this.handleSelectTemplateClick=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!0},this.handleTemplateListClick=t=>{this.applyTemplate(t.target["data-template"])},this.handleTemplateListKeyDown=t=>{if(y(t.key))return this.applyTemplate(this.viewModel.defaultTemplates.getItemAt(this._focusedTemplateIndex)),void t.preventDefault();if("ArrowDown"===t.key||"ArrowUp"===t.key){const{defaultTemplates:i}=this.viewModel,e=(this._focusedTemplateIndex+("ArrowDown"===t.key?1:-1))%i.length;this._focusedTemplateIndex=e<0?i.length-1:e;const s=t.currentTarget;g(s.querySelectorAll(".esri-menu__list-item")[this._focusedTemplateIndex],s.parentElement),t.preventDefault()}"Escape"===t.key&&this.handleCloseTemplateSelection()},this._removeLink=t=>{const i=t.currentTarget["data-item"];i&&"error"===i.state&&this.exportedLinks.remove(i)},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.own([o(this,"viewModel.templatesInfo",(t=>{const{format:i,layout:e}=this.templateOptions;if(t){const s=e===t.layout.defaultValue||it(e)||t.layout.choiceList&&t.layout.choiceList.indexOf(e)>-1,a=i===t.format.defaultValue||t.format.choiceList&&t.format.choiceList.indexOf(i)>-1;s||(e&&X.warn(Z),this.templateOptions.layout=t.layout.defaultValue),a||(i&&X.warn(tt),this.templateOptions.format=t.format.defaultValue),it(e)&&(this._layoutTabSelected=!1)}})),o(this,"templateOptions.format",(t=>{const{viewModel:{templatesInfo:i}}=this;if(i&&t){let e=!1;i.format.choiceList&&i.format.choiceList.forEach((i=>{i.toUpperCase()===t.toUpperCase()&&(this.templateOptions.format=i,e=!0)})),e||(this.templateOptions.format=i.format.defaultValue,X.warn(tt)),this.scheduleRender()}})),o(this,"templateOptions.layout",(t=>{const{viewModel:{templatesInfo:i}}=this;if(i&&t){this._layoutTabSelected=!it(t);let e=!this._layoutTabSelected;e||i.layout.choiceList&&i.layout.choiceList.forEach((i=>{i.toUpperCase()===t.toUpperCase()&&(this.templateOptions.layout=i,e=!0)})),e||(this.templateOptions.layout=i.layout.defaultValue,X.warn(Z)),this.scheduleRender()}})),o(this,"templateOptions.dpi",(t=>{t<=0?this.templateOptions.dpi=1:this.scheduleRender()})),o(this,"viewModel.view.scale",(t=>{const{scale:i,scaleEnabled:e}=this.templateOptions;e&&i||(this.templateOptions.scale=t)}))]);const{height:t,width:i}=this.templateOptions;this.templateOptions.width=i||800,this.templateOptions.height=t||1100;const e=setTimeout((()=>{this._awaitingServerResponse=!0,this.scheduleRender()}),500);this.viewModel.load().then((()=>clearTimeout(e)))}render(){const{attributionEnabled:t,author:i,copyright:e,dpi:s,format:a,height:n,layout:l,legendEnabled:r,scaleEnabled:o,scale:h,width:d}=this.templateOptions,c="ready"!==this.get("viewModel.state"),p=this.renderTitleOrFileNameSection(),{includeDefaultTemplates:u,messages:m,viewModel:v}=this,b=this.get("viewModel.templatesInfo.format.choiceList")||[],_=b.length>0?b.map((t=>x("option",{key:t,selected:t===a,value:t},t.toUpperCase()))):x("option",{key:"format-default-option"},m.formatDefaultOption),f=x("div",{class:W},x("label",null,m.fileFormatTitle,x("select",{class:"esri-select",onchange:this._updateFromOption,"data-target-property":"format",bind:this},_))),w=this.get("viewModel.templatesInfo.layout.choiceList")||[],y=w.length>0?w.map((t=>x("option",{key:t,selected:t===l,value:t},m[t]||t))):x("option",{key:"layout-default-option"},m.layoutDefaultOption),g=x("div",{class:W},x("label",null,m.layoutTitle,x("select",{class:"esri-select",onchange:this._updateFromOption,"data-target-property":"layout",bind:this},y))),k=x("div",{class:W},x("label",null,m.dpi,x("input",{type:"number",class:this.classes(Q,J),"data-input-name":"dpi",onchange:this._handleDPIChange,value:`${s}`,min:"1",tabIndex:0,bind:this}))),T=x("div",{class:this.classes("esri-print__scale-info-container",W)},x("label",null,x("input",{"data-option-name":"scaleEnabled",checked:o,type:"checkbox",tabIndex:0,onchange:this._toggleInputValue,bind:this}),m.scale),x("div",{class:"esri-print__scale-input-container"},x("input",{"aria-label":m.scaleLabel,"aria-valuenow":`${h}`,role:"spinbutton",type:"number",class:this.classes(Q,J,"esri-print__scale-input"),tabIndex:0,"data-input-name":"scale",onchange:this._updateInputValue,disabled:!o,value:`${h}`,bind:this}),x("button",{type:"button","aria-label":m.reset,class:this.classes("esri-widget--button","esri-print__refresh-button","esri-icon-refresh"),tabIndex:0,onclick:this._resetToCurrentScale,bind:this}))),j=this._advancedOptionsVisibleForLayout?x("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:"esri-print__advanced-options-container"},T,x("div",{class:this.classes("esri-print__author-info-container",W)},x("label",null,m.author,x("input",{type:"text",value:i,class:this.classes(Q,J),tabIndex:0,"data-input-name":"author",onchange:this._updateInputValue,bind:this}))),x("div",{class:this.classes("esri-print__copyright-info-container",W)},x("label",null,m.copyright,x("input",{type:"text",class:this.classes(Q,J),tabIndex:0,value:e,"data-input-name":"copyright",onchange:this._updateInputValue,bind:this}))),k,x("div",{class:this.classes("esri-print__legend-info-container",W)},x("label",null,x("input",{type:"checkbox","data-option-name":"legendEnabled",tabIndex:0,checked:r,onchange:this._toggleInputValue,bind:this}),m.legend))):null,O=this._advancedOptionsVisibleForMapOnly?x("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:"esri-print__advanced-options-container"},T,k,x("div",{class:W},x("label",null,x("input",{"data-option-name":"attributionEnabled",type:"checkbox",onchange:this._toggleInputValue,tabIndex:0,checked:t,bind:this}),m.attribution))):null,I=this._layoutTabSelected?x("section",{key:"esri-print__layoutContent",id:`${this.id}__layoutContent`,"aria-labelledby":`${this.id}__layoutTab`,class:"esri-print__layout-section",role:"tabpanel","aria-selected":this._layoutTabSelected.toString()},x("div",{class:Y},p,g,this._layoutTabSelected?f:null),x("div",{class:this.classes(Y,"esri-print__advanced-options-section")},x("button",{"aria-label":m.advancedOptions,"aria-expanded":this._advancedOptionsVisibleForLayout?"true":"false",class:"esri-print__advanced-options-button",onclick:this._showAdvancedOptions,bind:this,type:"button"},x("div",{class:"esri-print__advanced-options-button-container"},x("span",{"aria-hidden":"true",class:this.classes("esri-icon-right-triangle-arrow","esri-print__advanced-options-button-icon--closed")}),x("span",{"aria-hidden":"true",class:this.classes("esri-icon-left-triangle-arrow","esri-print__advanced-options-button-icon--closed-rtl")}),x("span",{"aria-hidden":"true",class:this.classes("esri-icon-down-arrow","esri-print__advanced-options-button-icon--opened")}),x("span",{class:"esri-print__advanced-options-button-title"},m.advancedOptions))),j)):x("section",{key:"esri-print__mapOnlyContent",id:`${this.id}__mapOnlyContent`,"aria-selected":(!this._layoutTabSelected).toString(),"aria-labelledby":`${this.id}__mapOnlyTab`,class:"esri-print__map-only-section",role:"tabpanel"},x("div",{class:Y},p,this._layoutTabSelected?null:f,x("div",{class:this.classes("esri-print__size-container",W)},x("div",{class:"esri-print__width-container"},x("label",null,m.width,x("input",{type:"number",class:this.classes(Q,J),"data-input-name":"width",onchange:this._updateInputValue,value:`${d}`,tabIndex:0,bind:this}))),x("div",{class:"esri-print__height-container"},x("label",null,m.height,x("input",{type:"number",class:this.classes(Q,J),"data-input-name":"height",onchange:this._updateInputValue,value:`${n}`,tabIndex:0,bind:this}))),x("button",{type:"button","aria-label":m.swap,class:this.classes("esri-widget--button","esri-print__swap-button","esri-icon-swap"),onclick:this._switchInput,tabIndex:0,bind:this})),x("div",{class:this.classes(Y,"esri-print__advanced-options-section")},x("button",{"aria-label":m.advancedOptions,"aria-expanded":this._advancedOptionsVisibleForMapOnly?"true":"false",type:"button",class:"esri-print__advanced-options-button",onclick:this._showAdvancedOptions,bind:this},x("div",{class:"esri-print__advanced-options-button-container"},x("span",{"aria-hidden":"true",class:this.classes("esri-icon-right-triangle-arrow","esri-print__advanced-options-button-icon--closed")}),x("span",{"aria-hidden":"true",class:this.classes("esri-icon-left-triangle-arrow","esri-print__advanced-options-button-icon--closed-rtl")}),x("span",{"aria-hidden":"true",class:this.classes("esri-icon-down-arrow","esri-print__advanced-options-button-icon--opened")}),x("span",{class:"esri-print__advanced-options-button-title"},m.advancedOptions))),O))),L=this.exportedLinks.toArray(),M=this._renderExportedLink(L),P={"esri-button--disabled":c||!l&&!a},$=null!=this.get("view")&&"2d"!==this.get("view.type"),E=x("div",{class:"esri-print__panel--error"},$?m.sceneViewError:m.serviceError),F=x("div",null,x("ul",{class:"esri-print__layout-tab-list",role:"tablist",onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,bind:this},x("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,id:`${this.id}__layoutTab`,"data-tab-id":"layoutTab",class:"esri-print__layout-tab",role:"tab",tabIndex:0,"aria-selected":`${this._layoutTabSelected}`},m.layoutTab),x("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,id:`${this.id}__mapOnlyTab`,"data-tab-id":"mapOnlyTab",class:"esri-print__layout-tab",role:"tab",tabIndex:0,"aria-selected":`${!this._layoutTabSelected}`},m.mapOnlyTab)),I,x("button",{"aria-label":m.exportDescription,type:"button",class:this.classes("esri-print__export-button","esri-button",P),disabled:c,tabIndex:0,onclick:this._handlePrintMap,bind:this},m.export),u&&v.defaultTemplates.length>0?this.renderTemplateSectionTrigger():null,x("div",{class:"esri-print__export-panel-container",afterUpdate:this._scrollExportIntoView,bind:this},x(C,{class:"esri-print__export-title",level:this.headingLevel},m.exportText),L.length>0?null:x("div",null,x("div",null,m.exportHint)),M)),A=x("div",{class:"esri-print__container"},x("header",{class:"esri-print__header-title"},m.export),this.error||$||!this.view?E:F),S="initializing"===this.get("viewModel.state")?this._renderLoader():A;return x("div",{afterCreate:this._handleRootAfterCreate,bind:this,class:this.classes("esri-print","esri-widget","esri-widget--panel")},S)}renderTemplateSectionTrigger(){const{messages:t,_templateListPopover:i}=this,e=i.open;return x("button",{afterCreate:t=>this._selectTemplateNode=t,"aria-controls":e?`${this.id}__template-selection`:"","aria-label":t.selectTemplateDescription,"aria-pressed":e.toString(),class:this.classes("esri-button","esri-button--tertiary","esri-print__template-button"),onclick:this.handleSelectTemplateClick,title:t.selectTemplateDescription},t.selectTemplate)}renderTemplateList(){const{messages:t,messagesCommon:i,viewModel:e}=this,{defaultTemplates:s}=e,a=t.selectTemplateDescription,n=`${this.id}__template-selection`;return x("div",{class:this.classes("esri-print__template-list","esri-widget","esri-widget--panel"),id:n},x(C,{class:"esri-menu__header",level:this.headingLevel},t.selectTemplate),x("div",{class:"esri-print__template-list-scroller"},x("ul",{afterCreate:this.handleTemplateListCreation,"aria-activedescendant":`${this.id}__template-item--${this._focusedTemplateIndex}`,"aria-label":a,class:"esri-menu__list",key:"templates",onblur:this.handleTemplateChildBlur,onclick:this.handleTemplateListClick,onkeydown:this.handleTemplateListKeyDown,role:"listbox",tabIndex:0,title:a},s.toArray().map(((i,e)=>{const{description:s}=i,a=i.label;return x("li",{"aria-label":s,class:this.classes("esri-menu__list-item",{"esri-menu__list-item--focus":e===this._focusedTemplateIndex}),"data-template":i,id:`${this.id}__template-item--${e}`,key:a,title:s},it(a)?t.mapOnlyTab:a)})))),x("div",{class:"esri-print__template-list-footer"},x("button",{type:"button",class:this.classes("esri-button","esri-button--secondary"),onblur:this.handleTemplateChildBlur,onclick:this.handleCloseTemplateSelection},i.done)))}applyTemplate(t){var i;const{format:e,layout:s,layoutOptions:a}=t,{templateOptions:n}=this;this._templateListPopover.open=!1,this._toggleTab("map-only"===s?"mapOnlyTab":"layoutTab",!1),e&&(n.format=e),s&&(n.layout=s),this._focusedTemplateIndex=null,n.legendEnabled=null!=(i=null==a?void 0:a.legend)?i:n.legendEnabled,this.handleCloseTemplateSelection()}renderTitleOrFileNameSection(){const{templateOptions:t,messages:i}=this;let e,s,a,n;return this._layoutTabSelected?(e=i.title,s=i.titlePlaceHolder,a=t.title,n="title"):(e=i.fileName,s=i.fileNamePlaceHolder,a=t.fileName,n="fileName"),x("div",{class:W,key:n},x("label",null,e,x("input",{type:"text",tabIndex:0,placeholder:s,class:this.classes(Q,J),value:a,"data-input-name":n,onchange:this._updateInputValue,bind:this})))}_handleRootAfterCreate(t){this._rootNode=t,this.own(k(t,"scroll",(()=>{this._templateListPopover.open&&this.handleCloseTemplateSelection()})))}_focusOnTabChange(t){if(!this._activeTabFocusRequested)return;const i=t.getAttribute("data-tab-id");("layoutTab"===i&&this._layoutTabSelected||"mapOnlyTab"===i&&!this._layoutTabSelected)&&(t.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){return x("div",{class:this.classes({"esri-print__loader":this._awaitingServerResponse}),key:"loader"})}_createFileLink(t,i){const e=i||this.messages.untitled,s=t.format.toLowerCase(),a=s.indexOf("png")>-1?"png":s,n=e+a;return void 0!==this._exportedFileNameMap[n]?this._exportedFileNameMap[n]++:this._exportedFileNameMap[n]=0,new S({name:e,extension:a,count:this._exportedFileNameMap[n]})}_toPrintTemplate({attributionEnabled:t,author:i,copyright:e,dpi:s,forceFeatureAttributes:a,format:n,height:l,layout:r,legendEnabled:o,title:h,scale:d,scaleEnabled:c,width:p}){const u=new P({attributionVisible:t,layoutOptions:{authorText:i||"",copyrightText:e||"",titleText:h||""},forceFeatureAttributes:a,format:n,layout:r,scalePreserved:c,outScale:d});return p&&(u.exportOptions.width=p),l&&(u.exportOptions.height=l),s&&(u.exportOptions.dpi=s),o||(u.layoutOptions.legendLayers=[]),u}_resetToCurrentScale(){this.templateOptions.scale=this.viewModel.view.scale}_updateInputValue(t){const i=t.target,e=i.getAttribute("data-input-name");let s;if("number"===i.type){if(!function(t){return!isNaN(t)&&t>0}(i.valueAsNumber))return void(i.value=`${this.templateOptions[e]}`);s=i.valueAsNumber}else s=i.value;this.templateOptions[e]=s}_handleDPIChange(t){this._updateInputValue(t);const i=t.currentTarget.valueAsNumber,{height:e,width:s}=function(t){return{width:Math.round(8.3333*t),height:Math.round(11.4583*t)}}(i),{templateOptions:a}=this;a.height=e,a.width=s}_handlePrintMap(){this._pendingExportScroll=!0;const{templateOptions:t}=this,i=this._toPrintTemplate(t),e=this._createFileLink(i,this._layoutTabSelected?i.layoutOptions.titleText:t.fileName);this.exportedLinks.add(e),this.emit("submit",{link:e}),this.viewModel.print(i).then((t=>{e.set({url:t&&t.url,state:"ready"})})).catch((t=>{e.set({error:t,state:"error"})})).then((()=>{this.emit("complete",{link:e}),this.scheduleRender()}))}_updateFromOption(t){const i=t.target,e=i.selectedOptions?i.selectedOptions.item(0).value:i.options[i.selectedIndex].value,s=i.getAttribute("data-target-property");this.templateOptions[s]=e}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_showAdvancedOptions(){this._layoutTabSelected?this._advancedOptionsVisibleForLayout=!this._advancedOptionsVisibleForLayout:this._advancedOptionsVisibleForMapOnly=!this._advancedOptionsVisibleForMapOnly}_scrollExportIntoView(){if(this._pendingExportScroll){this._pendingExportScroll=!1;const{_rootNode:t,_rootNode:{clientHeight:i,scrollHeight:e}}=this,s=e-i;s>0&&(t.scrollTop=s)}}_toggleInputValue(t){const i=t.target,e=i.getAttribute("data-option-name");this.templateOptions[e]=i.checked,"scaleEnabled"===e&&(this.templateOptions[e]||this._resetToCurrentScale())}_renderExportedLink(t){const i=this.messages;return t.map((t=>{const{error:e,url:s,formattedName:a,state:n}=t,l="error"===n,r="pending"===n,o="ready"===n,h={"esri-widget__anchor--disabled":r||l};let d=s||null;d&&(d=T(d));const c=j(s,location.href),p={"esri-icon-loading-indicator":r,"esri-rotating":r,"esri-icon-download":c&&o,"esri-icon-launch-link-external":!c&&o,"esri-icon-error":l,"esri-print__exported-file--error":l},u={"esri-print__exported-file--error":l};let m;return m=r?i.pending:o?i.ready:i.errorMessage,x("div",{"aria-label":m,class:"esri-print__exported-file","data-item":t,key:a,onclick:this._removeLink,title:l?"print-task:cim-symbol-unsupported"===e.name?i.exportWebMapCIMError:i.exportWebMapError:""},x("a",{"aria-label":`${a}. ${i.linkReady}`,download:a,href:d,rel:"noreferrer",tabIndex:0,target:"_blank",class:this.classes("esri-widget__anchor esri-print__exported-file-link",h)},x("span",{class:this.classes(p)}),x("span",{class:this.classes("esri-print__exported-file-link-title",u)},a)))}))}_toggleLayoutPanel(t){this._toggleTab(t.target.getAttribute("data-tab-id"))}_toggleTab(t,i=!0){if(this._layoutTabSelected="layoutTab"===t,this._layoutTabSelected){const t=this.get("viewModel.templatesInfo.layout.choiceList");this.templateOptions.layout=t&&t[0]}else this.templateOptions.layout=K;i&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(t){const i=O(t),e=t.target.getAttribute("data-tab-id");if(y(i))return this._toggleTab(e),t.preventDefault(),void t.stopPropagation();"ArrowLeft"!==i&&"ArrowRight"!==i||(this._toggleTab("layoutTab"===e?"mapOnlyTab":"layoutTab"),t.preventDefault(),t.stopPropagation())}};s([_("viewModel.allowedFormats")],et.prototype,"allowedFormats",void 0),s([_("viewModel.allowedLayouts")],et.prototype,"allowedLayouts",void 0),s([_("viewModel.error")],et.prototype,"error",void 0),s([a({type:G})],et.prototype,"exportedLinks",void 0),s([_("viewModel.extraParameters")],et.prototype,"extraParameters",void 0),s([a()],et.prototype,"headingLevel",void 0),s([a()],et.prototype,"iconClass",void 0),s([_("viewModel.includeDefaultTemplates")],et.prototype,"includeDefaultTemplates",void 0),s([a({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],et.prototype,"label",void 0),s([a(),f("esri/widgets/Print/t9n/Print")],et.prototype,"messages",void 0),s([a(),f("esri/t9n/common")],et.prototype,"messagesCommon",void 0),s([_("viewModel.portal")],et.prototype,"portal",void 0),s([_("viewModel.printServiceUrl")],et.prototype,"printServiceUrl",void 0),s([a({type:B})],et.prototype,"templateOptions",void 0),s([_("viewModel.view")],et.prototype,"view",void 0),s([a({type:q})],et.prototype,"viewModel",void 0),et=s([n("esri.widgets.Print")],et);const st=et;let at=class{constructor(e){t(this,e),this.loaded=i(this,"loaded",7),this.position="bottom-left"}validateAllowedFormats(t){t&&this.widget&&(this.widget.allowedFormats=t.split(","))}validateAllowedLayouts(t){t&&this.widget&&(this.widget.allowedLayouts=t.split(","))}validateView(t){t&&(this.widget.view=t,"arcgis-expand"!==this.el.parentElement.tagName.toLowerCase()&&this.widget.view.ui.add(this.widget,this.position))}componentWillLoad(){const t={container:this.el};this.allowedFormats&&(t.allowedFormats=this.allowedFormats.split(",")),this.allowedLayouts&&(t.allowedLayouts=this.allowedLayouts.split(",")),this.view&&(t.view=this.view);const i=new st(t);this.widget=i,this.loaded.emit(!0)}get el(){return e(this)}static get watchers(){return{allowedFormats:["validateAllowedFormats"],allowedLayouts:["validateAllowedLayouts"],view:["validateView"]}}};at.style="@import url('https://js.arcgis.com/next/esri/themes/light/main.css');";export{at as arcgis_print}