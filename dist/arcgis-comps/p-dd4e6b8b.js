import{s,i as t}from"./p-39da60a5.js";import{a as e}from"./p-6ab16fcc.js";import{e as r}from"./p-2b250922.js";import{a7 as i}from"./p-9ae46e68.js";import{I as h}from"./p-16def889.js";import{a as o,b as a,m as n}from"./p-d40c97c9.js";class c extends e{constructor(s,t,e,i,h,o=i,a=h){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new r(s),this.x=t,this.y=e,this.width=i,this.height=h,this.rangeX=o,this.rangeY=a}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e,r){const i=r/(e.resolution*e.pixelRatio),h=this.transforms.tileMat3,[o,a]=e.toScreenNoRotation([0,0],[this.x,this.y]);s(h,this.width/this.rangeX*i,0,0,0,this.height/this.rangeY*i,0,o,a,1),t(this.transforms.dvs,e.displayViewMat3,h)}}const p=(s,t)=>s.key.level-t.key.level!=0?s.key.level-t.key.level:s.key.row-t.key.row!=0?s.key.row-t.key.row:s.key.col-t.key.col;class u extends o{constructor(s){super(),this._tileInfoView=s}get requiresDedicatedFBO(){return!1}renderChildren(s){this.sortChildren(p),this.setStencilReference(),super.renderChildren(s)}createRenderParams(s){const{state:t}=s,e=super.createRenderParams(s);return e.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,e.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),e}prepareRenderPasses(s){const t=super.prepareRenderPasses(s);return t.push(s.registerRenderPass({name:"stencil",brushes:[a],drawPhase:h.DEBUG|h.MAP|h.HIGHLIGHT,target:()=>this.getStencilTarget()})),i("esri-tiles-debug")&&t.push(s.registerRenderPass({name:"tileInfo",brushes:[n],drawPhase:h.DEBUG,target:()=>this.children})),t}getStencilTarget(){return this.children}updateTransforms(s){for(const t of this.children){const e=this._tileInfoView.getTileResolution(t.key);t.setTransform(s,e)}}setStencilReference(){let s=1;for(const t of this.children)t.stencilRef=s++}}export{u as o,c as r}