import{a0 as o,Q as e,D as n,az as r,R as t,ad as s}from"./p-e58503d5.js";import{M as i}from"./p-93765525.js";import{k as c,a as f,D as a,f as l}from"./p-f94762ac.js";import{j as m}from"./p-b79fcce3.js";import{t as y}from"./p-51a17e75.js";import p from"./p-dc852195.js";const u={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function G(o){const e=o.folders||[],r=e.slice(),t=new Map,s=new Map,i=new Map,c=new Map,f=new Map,a={esriGeometryPoint:s,esriGeometryPolyline:i,esriGeometryPolygon:c};(o.featureCollection&&o.featureCollection.layers||[]).forEach((o=>{const e=n(o);e.featureSet.features=[];const r=o.featureSet.geometryType;t.set(r,e);const f=o.layerDefinition.objectIdField;"esriGeometryPoint"===r?j(s,f,o.featureSet.features):"esriGeometryPolyline"===r?j(i,f,o.featureSet.features):"esriGeometryPolygon"===r&&j(c,f,o.featureSet.features)})),o.groundOverlays&&o.groundOverlays.forEach((o=>{f.set(o.id,o)})),e.forEach((e=>{e.networkLinkIds.forEach((n=>{const t=function(o,e,n){const r=function(o,e){let n;return e.some((e=>e.id===o&&(n=e,!0))),n}(o,n);return r&&(r.parentFolderId=e,r.networkLink=r),r}(n,e.id,o.networkLinks);t&&r.push(t)}))})),r.forEach((o=>{if(o.featureInfos){o.points=n(t.get("esriGeometryPoint")),o.polylines=n(t.get("esriGeometryPolyline")),o.polygons=n(t.get("esriGeometryPolygon")),o.mapImages=[];for(const e of o.featureInfos)switch(e.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const n=a[e.type].get(e.id);n&&o[u[e.type]].featureSet.features.push(n);break}case"GroundOverlay":{const n=f.get(e.id);n&&o.mapImages.push(n);break}}o.fullExtent=g([o])}}));const l=g(r);return{folders:e,sublayers:r,extent:l}}function P(o,n,i,c){const f=r&&r.findCredential(o);return o=t(o,{token:f&&f.token}),e(s.kmlServiceUrl,{query:{url:o,model:"simple",folders:"",refresh:0!==i||void 0,outSR:JSON.stringify(n)},responseType:"json",signal:c})}function d(o,e,n=null,r=[]){const t=[],s={},i=e.sublayers,c=e.folders.map((o=>o.id));return i.forEach((e=>{const i=new o;if(n?i.read(e,n):i.read(e),r.length&&c.indexOf(i.id)>-1&&(i.visible=-1!==r.indexOf(i.id)),s[e.id]=i,null!=e.parentFolderId&&-1!==e.parentFolderId){const o=s[e.parentFolderId];o.sublayers||(o.sublayers=[]),o.sublayers.unshift(i)}else t.unshift(i)})),t}function j(o,e,n){n.forEach((n=>{o.set(n.attributes[e],n)}))}async function w(o){const e=p.fromJSON(o.featureSet).features,n=y(o.layerDefinition.drawingInfo.renderer),r=i.fromJSON(o.popupInfo),t=[];for(const o of e){const e=await n.getSymbolAsync(o);o.symbol=e,o.popupTemplate=r,o.visible=!0,t.push(o)}return t}function g(e){const n=f(a),r=f(a);for(const o of e){if(o.polygons&&o.polygons.featureSet&&o.polygons.featureSet.features)for(const e of o.polygons.featureSet.features)m(n,e.geometry),l(r,n);if(o.polylines&&o.polylines.featureSet&&o.polylines.featureSet.features)for(const e of o.polylines.featureSet.features)m(n,e.geometry),l(r,n);if(o.points&&o.points.featureSet&&o.points.featureSet.features)for(const e of o.points.featureSet.features)m(n,e.geometry),l(r,n);if(o.mapImages)for(const e of o.mapImages)m(n,e.extent),l(r,n)}return c(r,a)?null:{xmin:r[0],ymin:r[1],zmin:r[2],xmax:r[3],ymax:r[4],zmax:r[5],spatialReference:o.WGS84}}export{d as S,w as b,G as d,P as g,g as j}