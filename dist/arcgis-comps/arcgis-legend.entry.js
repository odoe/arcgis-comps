import { r as registerInstance, h as h$5, g as getElement } from './index-5b4f4de1.js';
import { l as t$3, C as s$5, H as m$3, S as S$2, D as L$6, M as l$5, f as s$6, X as o$4, p as p$4, u as u$8, I as S$4, $ as $$1, h as i$6, aW as T, aR as z$2, bk as g$4, v as f$7, bl as Rt, a3 as E, bm as i$7, aG as e$2, r as r$6, e as e$4, a as d$3, i as i$8, Q as g$5, bn as v$3, n as n$5, bo as l$6, bp as i$9, A as s$7, z as z$3, b as e$5, t as t$5, o as o$5, g as c$5 } from './jsxFactory-ef3e403e.js';
import { J as h$3, ap as x$2, a2 as y$2, S as S$3, ai as e$3, K as K$1, aB as u$9 } from './unitUtils-8a2b838a.js';
import { r as r$5 } from './EffectList-1cdcf1eb.js';
import { f as f$6 } from './jsonUtils-7ed7a510.js';
import { c as c$4 } from './ExportImageParameters-b1c6f328.js';
import { i as i$5, t as t$4 } from './jsonUtils-595f52d3.js';
import { a as a$3 } from './jsonUtils-9c0d7442.js';
import { b as b$2, a as a$4 } from './VisualVariablesMixin-0776df0b.js';
import { j as j$1, b as b$3, w as w$3, a as b$4, I as I$4 } from './utils-51d0d46b.js';
import { p as p$5, y as y$3, h as h$4, s as s$8 } from './Heading-88f80afd.js';
import { getSymbolLayerFill as N$1 } from './previewSymbol3D-90f72063.js';
import { v as v$4, A as A$2, I as I$5, b as b$5, T as T$1, U as U$2, L as L$7, C as C$3 } from './renderUtils-4f494d3b.js';
import './JSONSupport-a5eb98e7.js';
import './mat4-fe6f4784.js';
import './_commonjsHelpers-020ca939.js';
import './HandleOwner-ebad91ab.js';
import './reactiveUtils-2b52b231.js';
import './commonProperties-e22a7011.js';
import './TimeExtent-fb7ed3e3.js';
import './lengthUtils-26f6142e.js';
import './sublayerUtils-c6a17833.js';
import './floorFilterUtils-a09da11b.js';
import './UniqueValueRenderer-1e1c8bf1.js';
import './ColorStop-d3744592.js';
import './diffUtils-1f52a3dd.js';
import './styleUtils-f18fb225.js';
import './DictionaryRenderer-b0e19146.js';
import './LRUCache-59f5b25d.js';
import './MemCache-bf2be364.js';
import './colorRamps-a6280e46.js';
import './sizeVariableUtils-4d3662df.js';
import './visualVariableUtils-5b3d6d65.js';
import './compilerUtils-be3a2322.js';
import './asyncUtils-968a02e9.js';
import './ItemCache-3713f352.js';
import './utils-f8425723.js';
import './colorUtils-a7d03078.js';
import './webStyleSymbolUtils-42a01118.js';
import './devEnvironmentUtils-930ae782.js';
import './mat2d-9870c32e.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function o$3(r){return t$3(r)||"simple"===r.type||"unique-value"===r.type||"class-breaks"===r.type||"dictionary"===r.type}function s$4(n){if(t$3(n))return null;if(!o$3(n))return new s$5("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${n.type||n.declaredClass}'`,{renderer:n});switch(n.type){case"simple":return u$7(n);case"unique-value":return l$4(n);case"class-breaks":return i$4(n);case"dictionary":return null}return null}function t$2(e,n){if(!n)return null;let o;if(o=Array.isArray(n)?n:[n],o.length>0){const n=o.map((r=>r.details.symbol.type||r.details.symbol.declaredClass)).filter((r=>!!r));n.sort();const s=[];return n.forEach(((r,e)=>{0!==e&&r===n[e-1]||s.push(r);})),new s$5("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${s.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:o})}return null}function u$7(r){return t$2(r,a$3(r.symbol).error)}function l$4(r){const e=r.uniqueValueInfos.map((r=>a$3(r.symbol).error)).filter((r=>!!r)),o=a$3(r.defaultSymbol);return o.error&&e.unshift(o.error),t$2(r,e)}function i$4(r){const e=r.classBreakInfos.map((r=>a$3(r.symbol).error)).filter((r=>!!r)),o=a$3(r.defaultSymbol);return o.error&&e.unshift(o.error),t$2(r,e)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const l$3=(e,l)=>{const a=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return null!=l&&l.levels?l.levels[a]:null};function a$2(a,i){if(!a||!("visualVariables"in a)||!a.visualVariables)return null;const s=a.visualVariables.find((e=>"size"===e.type)),n=l$3(i,s);return n?new b$2({field:s.field,minSize:n[2].size,minDataValue:n[2].value,maxSize:n[3].size,maxDataValue:n[3].value}):null}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const n$4=/^-?(\d+)(\.(\d+))?$/i;function e$1(t,n){return t-n}function r$4(t,n){let e,r;return e=Number(t.toFixed(n)),e<t?r=e+1/10**n:(r=e,e-=1/10**n),e=Number(e.toFixed(n)),r=Number(r.toFixed(n)),[e,r]}function o$2(t,n,e,r,o){const i=l$2(t,n,e,r),u=null==i.previous||i.previous<=o,s=null==i.next||i.next<=o;return u&&s||i.previous+i.next<=2*o}function i$3(t){const e=String(t),r=e.match(n$4);if(r&&r[1])return {integer:r[1].split("").length,fractional:r[3]?r[3].split("").length:0};if(e.toLowerCase().indexOf("e")>-1){const t=e.split("e"),n=t[0],r=t[1];if(n&&r){const t=Number(n);let e=Number(r);const o=e>0;o||(e=Math.abs(e));const l=i$3(t);return o?(l.integer+=e,e>l.fractional?l.fractional=0:l.fractional-=e):(l.fractional+=e,e>l.integer?l.integer=1:l.integer-=e),l}}return {integer:0,fractional:0}}function l$2(t,n,e,r){const o={previous:null,next:null};if(null!=e){const r=t-e,i=n-e-r;o.previous=Math.floor(Math.abs(100*i/r));}if(null!=r){const e=r-t,i=r-n-e;o.next=Math.floor(Math.abs(100*i/e));}return o}function u$6(t,n={}){const l=t.slice(0),{tolerance:u=2,strictBounds:s=!1,indexes:c=l.map(((t,n)=>n))}=n;c.sort(e$1);for(let e=0;e<c.length;e++){const t=c[e],n=l[t],a=0===t?null:l[t-1],f=t===l.length-1?null:l[t+1],m=i$3(n).fractional;if(m){let i,c=0,g=!1;for(;c<=m&&!g;){const t=r$4(n,c);i=s&&0===e?t[1]:t[0],g=o$2(n,i,a,f,u),c++;}g&&(l[t]=i);}}return l}const s$3={maximumFractionDigits:20};function c$3(n){return m$3(n,s$3)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const g$3="<",w$2=">",I$3=S$2("short-date");function U$1(a,U,e,i){let o="";0===U?o=`${g$3} `:U===e&&(o=`${w$2} `);let r=null;return r=i?L$6(a,I$3):c$3(a),o+r}const e=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const o$1=new h$3([64,64,64]);function n$3(l,o){const n=[],r=l.length-1;return 5===l.length?n.push(0,2,4):n.push(0,r),l.map(((l,t)=>n.indexOf(t)>-1?U$1(l,t,r,o):null))}async function r$3(l,e,o){let r=!1,a=[],u=[];if(l.stops){const e=l.stops;a=e.map((l=>l.value)),r=e.some((l=>!!l.label)),r&&(u=e.map((l=>l.label)));}const s=a[0],i=a[a.length-1];if(null==s&&null==i)return null;const c=r?null:n$3(a,o);return (await Promise.all(a.map((async(o,n)=>({value:o,color:"opacity"===l.type?await t$1(o,l,e):(await import('./visualVariableUtils-5b3d6d65.js')).getColor(l,o),label:r?u[n]:c[n]}))))).reverse()}async function t$1(e,n,r=o$1){const t=new h$3(r),a=(await import('./visualVariableUtils-5b3d6d65.js')).getOpacity(n,e);return null!=a&&(t.a=a),t}function a$1(l){let e=!1,o=[],r=[];o=l.map((l=>l.value)),e=l.some((l=>!!l.label)),e&&(r=l.map((l=>l.label)));const t=o[0],a=o[o.length-1];if(null==t&&null==a)return null;const s=e?null:n$3(o,!1);return o.map(((o,n)=>({value:o,color:u$5(o,l),label:e?r[n]:s[n]}))).reverse()}function u$5(e,o){const{startIndex:n,endIndex:r,weight:t}=s$2(e,o);if(n===r)return o[n].color;const a=h$3.blendColors(o[n].color,o[r].color,t);return new h$3(a)}function s$2(l,e){let o=0,n=e.length-1;return e.some(((e,r)=>l<e.value?(n=r,!0):(o=r,!1))),{startIndex:o,endIndex:n,weight:(l-e[o].value)/(e[n].value-e[o].value)}}function i$2(e,o){let n=[];if(e&&"multipart"===e.type)e.colorRamps.reverse().forEach((function(r,t){0===t?n.push({value:o.max,color:new h$3(r.toColor),label:"high"}):n.push({value:null,color:new h$3(r.toColor),label:""}),t===e.colorRamps.length-1?n.push({value:o.min,color:new h$3(r.fromColor),label:"low"}):n.push({value:null,color:new h$3(r.fromColor),label:""});}));else {let r,t;e&&"algorithmic"===e.type?(r=e.fromColor,t=e.toColor):(r=[0,0,0,1],t=[255,255,255,1]),n=[{value:o.max,color:new h$3(t),label:"high"},{value:o.min,color:new h$3(r),label:"low"}];}return n}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function r$2(r){let t=r.colorStops,e=t.length-1;if(t&&t[0]){const r=t[e];r&&1!==r.ratio&&(t=t.slice(0),t.push(new i$5({ratio:1,color:r.color})),e++);}return t.map(((o,r)=>{let t="";return 0===r?t="low":r===e&&(t="high"),{color:o.color,label:t,ratio:o.ratio}})).reverse()}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const s$1={HH:315,HL:45,LL:135,LH:225},l$1={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function n$2(t){if(!t)return;const{type:s}=t;if(s.indexOf("3d")>-1)return N$1(t.symbolLayers.getItemAt(0));if("simple-line"===s){const e=j$1(t);return e&&e.color}if("simple-marker"===t.type&&("x"===t.style||"cross"===t.style)){const e=j$1(t);return e&&e.color}return b$3(t)}function H$1(t,o){const e=o.HH.label,r=o.LL.label,s=o.HL.label,l=o.LH.label;switch(t){default:return {top:e,bottom:r,left:s,right:l};case"HL":return {top:s,bottom:l,left:r,right:e};case"LL":return {top:r,bottom:e,left:l,right:s};case"LH":return {top:l,bottom:s,left:e,right:r}}}function L$5(o,e){const r=[],s=o.length**.5,l=l$5(o),n=(e||"HH").split(""),H=n[0],L="H"===n[1];for(;l.length;){const t=[];for(;t.length<s;)t.push(l.shift());L&&t.reverse(),r.push(t);}return "L"===H&&r.reverse(),r}function i$1(t){const{focus:o,infos:e,numClasses:r}=t,s=l$1[r],L={};e.forEach((t=>{L[t.value]={label:t.label,fill:n$2(t.symbol)};}));const i=[];for(let l=0;l<r;l++){const t=[];for(let o=0;o<r;o++){const e=L[s[l][o]];t.push(e.fill);}i.push(t);}return {type:"relationship-ramp",numClasses:r,focus:o,colors:i,labels:H$1(o,L),rotation:f$5(o)}}function f$5(t){let o=s$1[t];return t&&null==o&&(o=s$1.HH),o||0}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const u$4=30,c$2=12,m$2=[255,255,255],f$4=[200,200,200],p$3=[128,128,128],y$1=20,b$1=5;function d$2(e){return "esri.symbols.SimpleMarkerSymbol"===e.declaredClass}function h$2(e){return "esri.symbols.PictureMarkerSymbol"===e.declaredClass}function v$2(e){return "esri.symbols.SimpleLineSymbol"===e.declaredClass}function g$2(e){return "esri.symbols.TextSymbol"===e.declaredClass}function w$1(e,l){const t=e.length-1;return e.map(((e,n)=>U$1(e,n,t,l)))}async function S$1(e,l,n,i,o,a){var u,c;const m=l.legendOptions,f=m&&m.customValues,p=V(e,n),y=!!p,b=!!f,d=null!=l.minSize&&null!=l.maxSize,h=l.stops&&l.stops.length>1,v=!!l.target;if(!y||!b&&!(d||h&&!v))return;const g=w$3(p);let S=null,k=null,j=null;k=g&&!h?u$6([l.minDataValue,l.maxDataValue]):f||await C$2(l,p,i,o);const L=null==e?void 0:e.authoringInfo,O="univariate-color-size"===(null==L?void 0:L.type),D=O&&"above-and-below"===(null==L?void 0:L.univariateTheme);if(!k&&h&&(k=l.stops.map((e=>e.value)),S=l.stops.some((e=>!!e.label)),S&&(j=l.stops.map((e=>e.label)))),g&&(null==(u=k)?void 0:u.length)>2&&!D&&(k=[k[0],k[k.length-1]]),!k)return null;O&&5!==(null==(c=k)?void 0:c.length)&&(k=I$2({minSize:k[0],maxSize:k[k.length-1]}));const E=g?z$1(e,k):null,T=b$4(p),q=S?null:w$1(k,a);return (await Promise.all(k.map((async(t,n)=>{const s=g?E[n]:await M(l,p,t,i,o);return {value:t,symbol:U(D&&"class-breaks"===e.type?x$1(e,n):p,s),label:S?j[n]:q[n],size:s,outlineSize:T}})))).reverse()}function z$1(e,l){const t=null==e?void 0:e.authoringInfo,n="univariate-color-size"===(null==t?void 0:t.type);let i=[c$2,u$4];if(n){const e=l[0],t=l[l.length-1],n=c$2,o=u$4;i=l.map((l=>n+(l-e)/(t-e)*(o-n)));}return n&&"below"===(null==t?void 0:t.univariateTheme)&&i.reverse(),i}function x$1(e,l){const t=e.classBreakInfos,n=t.length,i=n<2||!(l>=2)?t[0].symbol.clone():t[n-1].symbol.clone();return e.visualVariables.some((e=>"color"===e.type))&&(i.type.indexOf("3d")>-1?j(i):L$4(i)),i}function V(e,l){let t=null,n=null;if("simple"===e.type)t=e.symbol;else if("class-breaks"===e.type){const l=e.classBreakInfos;t=l&&l[0]&&l[0].symbol,n=l.length>1;}else if("unique-value"===e.type){const l=e.uniqueValueInfos;t=l&&l[0]&&l[0].symbol,n=l.length>1;}return !t||k$1(t)?null:(t=t.clone(),(l||n)&&(t.type.indexOf("3d")>-1?j(t):L$4(t)),t)}function k$1(e){if(e){if(x$2(e)){return !!e.symbolLayers&&e.symbolLayers.some((e=>e&&"fill"===e.type))}return -1!==e.type.indexOf("fill")}return !1}function j(e){"line-3d"===e.type?e.symbolLayers.forEach((e=>{e.material={color:p$3};})):e.symbolLayers.forEach((e=>{"icon"!==e.type||e.resource&&e.resource.href?e.material={color:f$4}:(e.material={color:m$2},e.outline={color:p$3,size:1.5});}));}function L$4(l){"cim"===l.type?I$4(l,new h$3(f$4)):-1!==l.type.indexOf("line")?l.color=p$3:(l.color=m$2,"simple-marker"===l.type&&(l.outline={color:p$3,width:1.5}));}async function C$2(e,l,n,i){const o=(await import('./visualVariableUtils-5b3d6d65.js')).getSizeRangeAtScale(e,n,i),s=o&&I$2(o);if(!o&&!s)return;let r=s.map((l=>O(l,e,o)));r=u$6(r);for(let t=1;t<r.length-1;t++){const o=await D(e,l,r[t],r[t-1],n,i);o&&(r[t]=o[0],s[t]=o[1]);}return r}function I$2(e){const l=e.minSize,t=e.maxSize,n=b$1,i=(t-l)/(n-1),o=[];for(let s=0;s<n;s++)o.push(l+i*s);return o}function O(e,l,t){const n=t.minSize,i=t.maxSize,o=l.minDataValue,s=l.maxDataValue;let r=null;if(e<=n)r=o;else if(e>=i)r=s;else {r=(e-n)/(i-n)*(s-o)+o;}return r}async function D(e,l,o,s,r,a){const u=await M(e,l,o,r,a),c=await M(e,l,s,r,a),m=i$3(o),f=m.fractional,p=y$1;let b=m.integer,d=null,h=null;o>0&&o<1&&(d=10**f,b=i$3(o*=d).integer);for(let n=b-1;n>=0;n--){const s=10**n;let m=Math.floor(o/s)*s,f=Math.ceil(o/s)*s;null!=d&&(m/=d,f/=d);let y=(m+f)/2;[,y]=u$6([m,y,f],{indexes:[1]});const b=await M(e,l,m,r,a),v=await M(e,l,f,r,a),g=await M(e,l,y,r,a),w=l$2(u,b,c,null),S=l$2(u,v,c,null),z=l$2(u,g,c,null);let x=w.previous<=p,V=S.previous<=p;if(x&&V&&(w.previous<=S.previous?(x=!0,V=!1):(V=!0,x=!1)),x?h=[m,b]:V?h=[f,v]:z.previous<=p&&(h=[y,g]),h)break}return h}async function M(e,l,t,n,i){const{getSize:o}=await import('./visualVariableUtils-5b3d6d65.js');return o(e,t,{scale:n,view:i,shape:"simple-marker"===l.type?l.style:null})}function U(e,t){const n=e.clone();if(x$2(n))w$3(n)||n.symbolLayers.forEach((e=>{"fill"!==e.type&&(e.size=t);}));else if(d$2(n))n.size=t;else if(h$2(n)){const e=n.width,l=n.height;n.height=t,n.width=t*(e/l);}else v$2(n)?n.width=t:g$2(n)&&n.font&&(n.font.size=t);return n}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const J=s$6.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),Q="https://utility.arcgis.com/sharing/tools/legend",H="esri.layers.ImageryLayer",X="esri.layers.ImageryTileLayer",K="esri.layers.WCSLayer",Y=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Z=new o$4({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),ee={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},te=new y$2({size:6,outline:{color:[128,128,128,.5],width:.5}}),se=new S$3({style:"solid"});function le(e){return "vector-field"===e.type}function re(e){return "raster-colormap"===e.type}function ie(e){return "raster-stretch"===e.type}function ne(e){return "raster-shaded-relief"===e.type}function ae(e){return "esri.renderers.SimpleRenderer"===e.declaredClass}function oe(e){return "esri.renderers.ClassBreaksRenderer"===e.declaredClass}function ue(e){return "esri.renderers.UniqueValueRenderer"===e.declaredClass}function ce(e){return "esri.renderers.HeatmapRenderer"===e.declaredClass}function de(e){return he(e)||me(e)||pe(e)||ye(e)}function ye(e){return "esri.renderers.PointCloudRGBRenderer"===e.declaredClass}function he(e){return "esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function me(e){return "esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function pe(e){return "esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function fe(e){return "esri.renderers.DotDensityRenderer"===e.declaredClass}function ge(e,t){return ae(e)||oe(e)||ue(e)||ce(e)||fe(e)?"2d"===t.type||o$3(e):ie(e)||re(e)||ne(e)||he(e)||me(e)||pe(e)||le(e)}function be(e){return "esri.layers.BuildingSceneLayer"===e.declaredClass}function Se(e){return "esri.layers.WMSLayer"===e.declaredClass}function _e(e){return "esri.layers.WMTSLayer"===e.declaredClass}function ve(e){return "esri.layers.MapImageLayer"===e.declaredClass}function we(e){return "esri.layers.TileLayer"===e.declaredClass}function Le(e){return "esri.layers.FeatureLayer"===e.declaredClass}function Ee(e){return e.declaredClass===H}function Ie(e){return e.declaredClass===X}function Ce(e){return e.declaredClass===K}function Re(e){return "stretch-ramp"===e.type}function Fe(e){const t="authoringInfo"in e&&(null==e?void 0:e.authoringInfo);return "univariate-color-size"===(null==t?void 0:t.type)}function Ve(e){const t="authoringInfo"in e&&(null==e?void 0:e.authoringInfo);return "univariate-color-size"===(null==t?void 0:t.type)&&"above-and-below"===(null==t?void 0:t.univariateTheme)}const Te=new y$2({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let ze={},xe=class extends p$4{constructor(e){super(e),this._handles=new u$8,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new S$4,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null;}initialize(){const e=()=>this.notifyChange("ready");this._handles.add([$$1(this,"children","change",(t=>{const{added:s,removed:l}=t,r=this._handles;s.forEach((t=>{const s=`activeLayerInfo-ready-watcher-${t.layer.uid}`;r.add(i$6(t,"ready",e),s);})),l.forEach((e=>r.remove(e.layer.uid))),e();}))]),this.keepCacheOnDestroy||(ze={});}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(ze=null);}get effect(){const e=this.layer;let t=null;if("effect"in e&&e.effect){const s=new r$5(0);s.effect=e.effect,s.transitionStep(0,this.scale);const l=s.effects.filter((e=>"bloom"!==e.type)),r=l.map((e=>e.toJSON()));t=f$6(r);}return t}get opacity(){var e;const t=this.layer.opacity,s=null==(e=this.parent)?void 0:e.opacity,l=this.layer.parent,r=l&&"uid"in l?this._getParentLayerOpacity(l):null;return null!=s?s*t:null!=r?r*t:t}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const e=this.layer;if(null===e)return !1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return !0;if("featureReduction"in e&&e.featureReduction&&"cluster"===e.featureReduction.type)return !0;if("renderer"in e&&e.renderer){if("dot-density"===e.renderer.type)return !0;const t=e.get("renderer.valueExpression");if(Y.test(t))return !0;const s=e.get("renderer.visualVariables");if(s)return s.some((e=>this._isScaleDrivenSizeVariable(e)))}return this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){if(!(!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView()))return this.legendElements=[],void this.notifyChange("ready");const t=Array.from(e,(e=>{if(Le(e))return this._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){const t=e.layerDefinition,s=t&&t.drawingInfo,l=s&&t$4(s.renderer),r=Z.read(t.geometryType);return l?this._getRendererLegendElements(l,{title:e.name,geometryType:r}):(J.warn("drawingInfo not available!"),null)}return null}));try{const e=[];await T(t).then((t=>{t.forEach((({value:t})=>t&&e.push(...t)));})),this.legendElements=e,this.notifyChange("ready");}catch(s){J.warn("error while building legend for layer!",s);}}async buildLegendElementsForRenderer(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getRendererLegendElements(e):[],this.notifyChange("ready");}catch(t){J.warn("error while building legend for layer!",t);}}async buildLegendElementsForTools(){const e=this.layer;if(_e(e))this._constructLegendElementsForWMTSlayer();else if(Se(e))await this._constructLegendElementsForWMSSublayers();else if(be(e))await this._constructLegendElementsForBuildingSceneLayer();else if(ve(e)||we(e)||be(e))await this._constructLegendElementsForSublayers();else {this._handles.remove("imageryLayers-watcher");let l="default";if(Ee(e)){var t,s;const r=e;l=((null==r||null==(t=r.renderingRule)?void 0:t.functionName)||"default")+"_"+(null!=(s=e.bandIds)&&s.length?e.bandIds.join(""):"###");}await this._getLegendLayers(`${e.uid}-${l}`).then((async t=>{this.legendElements=[],this.notifyChange("ready");const s=t.map((async t=>{if(Ee(e)||Ie(e)){const t=e.watch(["renderingRule","bandIds"],(()=>z$2((async()=>{ze.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools();}))()));this._handles.add(t,"imageryLayers-watcher");}const s=this._generateSymbolTableElementForLegendLayer(t);s&&s.infos.length&&(Ee(e)&&(s.title=e.title),this.legendElements.push(s)),this.notifyChange("ready");}));await T(s);})).catch((e=>{J.warn("Request to server for legend has failed!",e);}));}}async _isLayerInCurrentView(){const e=this.layer,t=this.layerView,s=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!s&&!(t&&"createQuery"in e&&"queryFeatureCount"in e))return !0;await g$4(t,"updating");const l=s?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();l.geometry=this.view.extent;return 0!==(s?"queryFeatureCount"in t&&await t.queryFeatureCount(l):"queryFeatureCount"in e&&await e.queryFeatureCount(l))}_getParentLayerOpacity(e){let t=1;const s=e.parent;return s&&"uid"in s&&(t=this._getParentLayerOpacity(s)),e.opacity*t}_isGroupActive(){const e=this.children;return !!e.length&&e.some((e=>e.ready))}_isScaleDrivenSizeVariable(e){if(e&&"size"!==e.type)return !1;const t=e,s=t.minSize,l=t.maxSize;return "object"==typeof s&&s?this._isScaleDrivenSizeVariable(s):"object"==typeof l&&l?this._isScaleDrivenSizeVariable(l):!!t.expression||Y.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return !0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((e=>this._isLayerScaleDriven(e)));const t=e.parent;if(!1===e.loaded&&t&&ve(t)&&"source"in e&&e.source&&"map-layer"===e.source.type)for(const s of t.sourceJSON.layers)if(s.id===e.source.mapLayerId&&(s.minScale>0||s.maxScale>0))return !0;return !1}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this._handles.add(f$7(this.layer,"activeLayer",(()=>this._constructLegendElementsForWMTSlayer())),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some((s=>e.styleId===s.id&&(t=s.legendUrl,!0))),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}]);}this.notifyChange("ready");}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this._handles.remove("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t={...e.customParameters,...e.customLayerParameters}),this._handles.add(f$7(this.layer,"sublayers",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready");}async _generateLegendElementsForWMSSublayers(e,t){const s=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher");const l=e.toArray();for(const r of l){const e=r.watch(["title","visible","legendEnabled"],(()=>this._constructLegendElementsForWMSSublayers()));if(this._handles.add(e,"wms-sublayers-watcher"),!this.respectLayerVisibility||r.visible&&r.legendEnabled){const e=await this._generateSymbolTableElementForWMSSublayer(r,t);e&&e.infos.length&&s.unshift(e);}}return s}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const s=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter((e=>e));return {type:"symbol-table",title:e.title,infos:s}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){var s;let r=e.legendUrl;if(!r)return;const i={type:"symbol-table",title:e.title||e.name||e.id&&e.id+"",infos:[]};t&&(r=Rt(r,t));let n=null;const a=null==(s=e.layer)?void 0:s.opacity;try{n=(await E(r,{responseType:"image"})).data,n&&(n.style.opacity=a);}catch{}return i.infos.push({src:r,preview:n,opacity:a}),i}_getLegendLayers(e,t){const s=ze&&ze[e];return s?Promise.resolve(s):this._legendRequest(t).then((t=>{const s=t.layers;return ze[e]=s,s}))}_legendRequest(e){const t=this.layer;let s={f:"json",dynamicLayers:e};if(Ee(t)){const e=t.exportImageServiceParameters.renderingRule;if(e&&(s.renderingRule=JSON.stringify(e.toJSON())),t.bandIds&&(s.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){const{raster:e,viewId:l,customParameters:r}=t;s={raster:e,viewId:l,...s,...r};}}let r=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){const e=r.indexOf("?");e>-1?r=r.substring(0,e)+"/legend"+r.substring(e):r+="/legend";}else {const e=r.toLowerCase().indexOf("/rest/"),t=r.substring(0,e)+r.substring(e+5,r.length);r=Q+"?soapUrl="+encodeURI(t)+"&returnbytes=true";}return E(r,{query:s}).then((e=>e.data))}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(f$7(e,"sublayers",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready");}catch(t){J.warn("Request to server for legend has failed!",t);}}async _generateLegendElementsForBuildingSublayers(e,t){let s=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");const l=e.toArray();for(const r of l){const e=r.watch(["renderer","opacity","title","visible"],(()=>this._constructLegendElementsForBuildingSceneLayer()));if(this._handles.add(e,"sublayers-watcher"),!this.respectLayerVisibility||r.visible){const e=r&&null!=r.opacity?r.opacity:null,l=null!=e?e*t:t;if("building-group"===r.type){const e={type:"symbol-table",title:r.title,infos:[]},t=await this._generateLegendElementsForBuildingSublayers(r.sublayers,l);e.infos.push(...t),s=[e,...s];}else if(r.renderer){s=[...await this._getRendererLegendElements(r.renderer,{title:r.title,opacity:l,sublayer:r}),...s];}}}return s.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _constructLegendElementsForSublayers(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(f$7(e,"sublayers",(()=>this._constructLegendElementsForSublayers)),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready");}catch(t){J.warn("Request to server for legend has failed!",t);}}async _generateLegendElementsForSublayers(e,t,s){const l=this.layer;let r=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForSublayers())),"sublayers-watcher");let i=e.toArray();!s&&this.sublayerIds&&this.sublayerIds.length&&(i=this.sublayerIds.map((e=>l.findSublayerById(e))).filter(Boolean));for(const n of i){const e=n.watch("renderer, opacity, title, visible, legendEnabled",(()=>this._constructLegendElementsForSublayers()));if(this._handles.add(e,"sublayers-watcher"),!this.respectLayerVisibility||n.visible&&n.legendEnabled&&this._isSublayerInScale(n)){const e=n&&null!=n.opacity?n.opacity:null,l=null!=e?e*t:t;if(n.renderer&&!n.sublayers&&n.originIdOf("renderer")>2){await n.load();r=[...await this._getRendererLegendElements(n.renderer,{title:n.title,opacity:l,sublayer:n}),...r];}else {const e=await this._generateSymbolTableElementForSublayer(n,l,s);e&&r.unshift(e);}}}return r.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _generateSymbolTableElementForSublayer(e,t,s){if(!s){s=new Map;const t=this.layer,l=e.source;let r=null;if(!(!l||"map-layer"===l.type&&l.mapLayerId===e.id&&(!l.gdbVersion||l.gdbVersion===("gdbVersion"in t&&t.gdbVersion)))||e.originIdOf("renderer")>2||e.originIdOf("labelingInfo")>2||e.originIdOf("labelsVisible")>2){const e=new c$4({layer:this.layer});r=e.hasDynamicLayers?e.dynamicLayers:null,e.destroy();}const i=r||`${t.uid}-default`;(await this._getLegendLayers(i,r)).forEach((e=>s.set(e.layerId,e)));}const l=s.get(e.id);if(!l&&e.sublayers){const l=await this._generateLegendElementsForSublayers(e.sublayers,t,s);return {type:"symbol-table",title:e.title,infos:l}}return this._generateSymbolTableElementForLegendLayer(l,e,t)}_generateSymbolTableElementForLegendLayer(e,t,s){var l;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const r=null==t?void 0:t.renderer;let i=(null==t?void 0:t.title)||e.layerName;if(r&&(!t||(null==t?void 0:t.originIdOf("renderer"))>2)){const e=(null==t?void 0:t.title)||this._getRendererTitle(r,t);e&&(i&&"string"!=typeof e&&"title"in e&&(e.title=i),i=e);}const n={type:"symbol-table",title:i,legendType:e.legendType?e.legendType:null,infos:[]},a=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return (null==(l=e.legendGroups)?void 0:l.length)>0?e.legendGroups.forEach((t=>{var l;const r={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(a.filter((e=>e.groupId===t.id)),e.layerId,s)};(null==(l=r.infos)?void 0:l.length)>0&&n.infos.push(r);})):n.infos=this._generateSymbolTableElementInfosForLegendLayer(a,e.layerId,s),n.infos.length>0?n:null}_generateSymbolTableElementInfosForLegendLayer(e,t,l){return e.map((e=>{let r=e.url;if(e.imageData&&e.imageData.length>0)r=`data:image/png;base64,${e.imageData}`;else {if(0===r.indexOf("http"))return null;r=i$7(`${this.layer.url}/${t}/images/${r}`);}return {label:e.label,src:r,opacity:null==l?this.opacity:l,width:e.width,height:e.height}})).filter((e=>!!e))}_isSublayerInScale(e){const t=e.minScale||0,s=e.maxScale||0;return !(t>0&&t<this.scale||s>this.scale)}_isLegendLayerInScale(e,t){const s=t||this.layer;let l=null,r=null,i=!0;return !s.minScale&&0!==s.minScale||!s.maxScale&&0!==s.maxScale?(0===e.minScale&&s.tileInfo&&(l=s.tileInfo.lods[0].scale),0===e.maxScale&&s.tileInfo&&(r=s.tileInfo.lods[s.tileInfo.lods.length-1].scale)):(l=Math.min(s.minScale,e.minScale)||s.minScale||e.minScale,r=Math.max(s.maxScale,e.maxScale)),(l>0&&l<this.scale||r>this.scale)&&(i=!1),i}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;const s=t.renderer,l=e.some((e=>e.values));let r=null,i=null;return l&&e.some(((e,t)=>(e.values||(r=t,i=e,i.label||(i.label="others")),null!=i))),s?"unique-value"===s.type?i&&(e.splice(r,1),e.push(i)):"class-breaks"===s.type&&(i&&e.splice(r,1),e.reverse(),i&&e.push(i)):i&&(e.splice(r,1),e.push(i)),e}async _getRendererLegendElements(e,t={}){return ge(e,this.view)?de(e)?this._constructPointCloudRendererLegendElements(e,t):fe(e)?this._constructDotDensityRendererLegendElements(e):this._constructRendererLegendElements(e,t):(J.warn(`Renderer of type '${e.type}' not supported!`),[])}_getPointCloudRendererTitle(e){return e.legendOptions&&e.legendOptions.title||e.field}_constructPointCloudRendererLegendElements(e,t={}){const s=t.title,l=[];let r=null,i=null;if(he(e))r={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((e=>{r.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:this._getAppliedCloneSymbol(te,e.color)});}));else if(me(e)){const t=e.stops;let l=null;if(t.length&&(1===t.length&&(l=t[0].color),!l)){const e=t[0].value,s=t[t.length-1].value;if(null!=e&&null!=s){l=u$5(e+(s-e)/2,t);}}r={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(te,l||te.color)}]};const n=a$1(e.stops);i={type:"color-ramp",title:s||this._getPointCloudRendererTitle(e),infos:n,preview:p$5(n.map((e=>e.color)))};}else pe(e)&&(r={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((e=>{r.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:this._getAppliedCloneSymbol(te,e.color)});})));r&&r.infos.length&&l.push(r),i&&i.infos.length&&l.push(i);const n=l.reduce(((e,t)=>e.concat(t.infos)),[]).filter((e=>!!e.symbol)).map((t=>this._getSymbolPreview(t,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})));return T(n).then((()=>l))}_getElementInfoForDotDensity(e,t){const{backgroundColor:s,outline:l,dotSize:r}=e,i=this.effect,n=r+"-"+t+"-"+s+"-"+(l&&JSON.stringify(l.toJSON()))+"-"+i,a=this._dotDensityUrlCache,o=a.has(n)?a.get(n):y$3(e,t,{effect:i});return a.set(n,o),{opacity:1,src:o.src,preview:o,width:o.width,height:o.height}}_constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),s=e.legendOptions&&e.legendOptions.unit,l={type:"symbol-table",title:{value:t&&Math.round(t),unit:s||""},infos:[]};return e.attributes.forEach((t=>{const s=this._getElementInfoForDotDensity(e,t.color);s.label=t.label||t.valueExpressionTitle||t.field,l.infos.push(s);})),Promise.resolve([l])}async _constructRendererLegendElements(e,t={}){const{title:s,sublayer:l}=t,r=l||this.layer;let i=await this._loadRenderer(e);this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const n=await this._getVisualVariableLegendElements(i,r)||[],a={type:"symbol-table",title:s||this._getRendererTitle(i,r),infos:[]};let o=null,c=!1;const y=new Set;if(Fe(i)){let e=s;const t=Ve(i)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",l=n.findIndex((e=>"color-ramp"===e.type)),r=-1!==l?n.splice(l,1)[0]:null,a=n.findIndex((e=>"size-ramp"===e.type)),o=-1!==a?n.splice(a,1)[0]:null,u=[];r&&(e=r.title,u.push(r)),o&&(e=o.title,u.push(o)),u.length>0&&n.push({type:t,title:e,infos:u});}else if(ce(i)){const e=r$2(i);n.push({type:"heatmap-ramp",title:s,infos:e,preview:p$5(e.map((e=>e.color)),{effect:this.effect})});}else if(ue(i)){const e=i&&i.authoringInfo;if(e&&"relationship"===e.type){const{focus:t,numClasses:s,field1:l,field2:o}=e;if(s&&l&&o){const e=[l,o];let u=f$5(t)||0;for(const t of e){const{field:e,normalizationField:s,label:l}=t,i=l||{field:this._getFieldAlias(e,r),normField:s&&this._getFieldAlias(s,r)},n=Te.clone();n.angle=u,a.infos.push({label:i,symbol:n}),y.add(n),u+=90;}const c=i$1({focus:t,numClasses:s,infos:i.uniqueValueInfos});n.unshift(c);}}else {const e=i.field;i.uniqueValueInfos.forEach((t=>{t.symbol&&a.infos.push({label:t.label||this._getDomainName(e,t.value,r)||t.value,value:t.value,symbol:t.symbol});}));}i.defaultSymbol&&(a.infos.push({label:i.defaultLabel||"others",symbol:i.defaultSymbol}),c=!0);}else if(oe(i)){o=this._isUnclassedRenderer(i);(!o||!this._hasSizeRamp)&&(i.classBreakInfos.forEach((e=>{e.symbol&&a.infos.unshift({label:e.label||(o?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol});})),o&&(a.title=null),this._updateInfosforClassedSizeRenderer(i,a.infos)),i.defaultSymbol&&!o&&(a.infos.push({label:i.defaultLabel||"others",symbol:i.defaultSymbol}),c=!0);}else if(ie(i)){var h,m;if(Ie(this.layer)&&"Map"===(null==(h=this.layer)||null==(m=h.raster)?void 0:m.tileType))this._getServerSideLegend();else if(Ie(this.layer)||Ce(this.layer)){const e=this._constructTileImageryStretchRendererElements(i);Re(e)?n.push(e):a.infos=e;}else {const e=this.layer;let t,s;var p,f;if(i.statistics&&i.statistics.length)t=null!=i.statistics[0].min?i.statistics[0].min:i.statistics[0][0],s=null!=i.statistics[0].max?i.statistics[0].max:i.statistics[0][1];else t=null==(p=i)?void 0:p.outputMin,s=null==(f=i)?void 0:f.outputMax;let l=[];const r=e$2(e.renderingRule?await e.generateRasterInfo(e.renderingRule):e.serviceRasterInfo),o=r.keyProperties.BandProperties;1===r.bandCount?(t=null!=t?t:r.statistics&&r.statistics[0].min,s=null!=s?s:r.statistics&&r.statistics[0].max,t||s?n.push(this._getStretchLegendElements(i,{min:t,max:s})):this._getServerSideLegend()):e.bandIds&&1===e.bandIds.length?(t=null!=t?t:r.statistics&&r.statistics[e.bandIds[0]].min,s=null!=s?s:r.statistics&&r.statistics[e.bandIds[0]].max,t||s?n.push(this._getStretchLegendElements(i,{min:t,max:s})):this._getServerSideLegend()):r.bandCount>=3?o&&o.length>=r.bandCount?e.bandIds&&3===e.bandIds.length?(l=e.bandIds.map((e=>o[e].BandName)),a.infos=this._createSymbolTableElementMultiBand(l)):"lerc"===e.format?(l=[0,1,2].map((e=>o[e].BandName)),a.infos=this._createSymbolTableElementMultiBand(l)):this._getServerSideLegend():"lerc"===e.format?(l=["band1","band2","band3"],a.infos=this._createSymbolTableElementMultiBand(l)):this._getServerSideLegend():this._getServerSideLegend();}}else if(re(i))i.colormapInfos.forEach((e=>{a.infos.push({label:e.label,value:e.value,symbol:this._getAppliedCloneSymbol(se,e.color)});}));else if(ae(i)){let e=i.symbol;switch(t.geometryType){case"point":e="pointSymbol"in r&&r.pointSymbol;break;case"polyline":e="lineSymbol"in r&&r.lineSymbol;break;case"polygon":e="polygonSymbol"in r&&r.polygonSymbol;}i.symbol&&!this._hasSizeRamp&&a.infos.push({label:i.label,symbol:e});}else if(le(i)){i.outputUnit&&(this.title="("+i.toJSON().outputUnit+")"),a.title=i.attributeField;const e=i.getClassBreakInfos();null!=e&&e.length?e.forEach((e=>{a.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol});})):a.infos.push({label:i.attributeField,symbol:i.getDefaultSymbol()});}else ne(i)&&n.push(this._getStretchLegendElements(i,{min:0,max:255}));const g=i.defaultSymbol;!g||c||ae(i)||o&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||n.push({type:"symbol-table",infos:[{label:i.defaultLabel||"others",symbol:g}]}),a.infos.length&&n.unshift(a);const b=null==t.opacity?this.opacity:t.opacity,S=this._isTallSymbol("visualVariables"in i&&i.visualVariables),_=Ee(this.layer)||Ie(this.layer),v=n.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!(null==e||!e.symbol))).map((e=>this._getSymbolPreview(e,b,{isDefault:e.symbol===g,applyScaleDrivenSize:!y.has(e.symbol),symbolConfig:{isTall:S,isSquareFill:_},effect:y.has(e.symbol)?null:this.effect})));return i=null,await T(v),n}_getServerSideLegend(){setTimeout((()=>this.buildLegendElementsForTools()),0);}_getAllInfos(e){const t=null==e?void 0:e.infos;return t?t.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]):[e]}_constructTileImageryStretchRendererElements(e){var t,s;const l=this.layer,r=l.rasterInfo,i=r.bandCount||e.statistics.length;let n,a,o=[];const u=r.keyProperties&&r.keyProperties.BandProperties,c=null!=e&&null!=(t=e.statistics)&&t.length?e.statistics:null==r?void 0:r.statistics;if(c)n=void 0!==c[0].min?c[0].min:c[0][0],a=c[0].max||c[0][1];else {const e=ee[l.rasterInfo.pixelType.toLowerCase()];n=e[0],a=e[1];}if(l.hasStandardTime()&&(n=l.getStandardTimeValue(n),a=l.getStandardTimeValue(a)),1===r.bandCount||1===(null==(s=l.bandIds)?void 0:s.length))return this._getStretchLegendElements(e,{min:n,max:a});function d(e){var t;const s=(null!=l&&null!=(t=l.bandIds)&&t.length?l.bandIds:Array.from(Array(Math.min(r.bandCount,3)).keys())).map((t=>e&&e[t]&&e[t].BandName||"band"+(t+1)));return s.length<3?s.push(s[1]):s.length>3&&s.splice(3),s}return o=u&&u.length>=i?d(u):d(),this._createSymbolTableElementMultiBand(o)}_getStretchLegendElements(e,t){const s=e.colorRamp,l=i$2(s,t);return {type:"stretch-ramp",title:"",infos:l,preview:p$5(l.map((e=>e.color)))}}_createSymbolTableElementMultiBand(e$1){const t=[],s=["red","green","blue"];return e$1.forEach(((e$1,l)=>{t.push({label:{colorName:s[l],bandName:e$1},src:e[l],opacity:1});})),t}_updateInfosforClassedSizeRenderer(e,t){const s=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,l=e.classBreakInfos.some((e=>w$3(e.symbol)));if(s&&l){const s=u$4,l=c$2,r=e.classBreakInfos.length,i=(s-l)/(r>1?r-1:r);t.forEach(((e,t)=>{e.size=s-i*t;}));}}_isTallSymbol(e){let t=!1,s=!1;if(e)for(let l=0;l<e.length&&(!t||!s);l++){const r=e[l];"size"===r.type&&("height"===r.axis&&(t=!0),"width-and-depth"===r.axis&&(s=!0));}return t&&s}async _getSymbolPreview(e,t,s){let l=null!=s&&s.isDefault||null!=e.size||!this._hasSizeRamp?e.size:e$3(22);if(this._scaleDrivenSizeVariable&&null!=s&&s.applyScaleDrivenSize){const{getSize:t}=await import('./visualVariableUtils-5b3d6d65.js');l=t(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===e.symbol.type?e.symbol.style:null});}return h$4(e.symbol,{size:l,opacity:t,scale:!1,symbolConfig:null==s?void 0:s.symbolConfig,effect:null==s?void 0:s.effect}).then((t=>(e.preview=t,e))).catch((()=>(e.preview=null,e)))}async _loadRenderer(e){var t,s;const l=[],r=this.layer;e=e.clone(),this._hasClusterSizeVariable=!1;const i="visualVariables"in e&&(null==(t=e.visualVariables)?void 0:t.some((e=>"size"===e.type&&"outline"!==e.target&&!Y.test(e.valueExpression))));if(e&&"visualVariables"in e&&!i&&"featureReduction"in r&&"cluster"===(null==(s=r.featureReduction)?void 0:s.type)){const t=this.layerView._effectiveRenderer,s=e$2(a$2(t,this.view));if(s){const t=r.featureReduction;if("clusterMinSize"in t&&"clusterMaxSize"in t){const{clusterMinSize:e,clusterMaxSize:l}=t;s.legendOptions=new a$4({showLegend:e!==l});}const l=e.visualVariables||[];e.visualVariables=l.concat([s]),this._hasClusterSizeVariable=!0;}}const n=await this._getMedianColor(e);if(oe(e)||ue(e)){const t=(e.classBreakInfos||e.uniqueValueInfos).map((e=>this._fetchSymbol(e.symbol,n).then((t=>{e.symbol=t;})).catch((()=>{e.symbol=null;}))));Array.prototype.push.apply(l,t);}return l.push(this._fetchSymbol(e.symbol||e.defaultSymbol,e.defaultSymbol?null:n).then((t=>{this._applySymbolToRenderer(e,t,ae(e));})).catch((()=>{this._applySymbolToRenderer(e,null,ae(e));}))),T(l).then((()=>e))}_applySymbolToRenderer(e,t,s){s?e.symbol=t:e.defaultSymbol=t;}async _getMedianColor(e){if(!("visualVariables"in e)||!e.visualVariables)return null;const t=e.visualVariables.find((e=>"color"===e.type));if(!t)return null;let s=null,l=null;if(t.stops){if(1===t.stops.length)return t.stops[0].color;s=t.stops[0].value,l=t.stops[t.stops.length-1].value;}const r=s+(l-s)/2,{getColor:i}=await import('./visualVariableUtils-5b3d6d65.js');return i(t,r)}_fetchSymbol(e,t){if(!e)return Promise.reject();if("web-style"===e.type){const s=e.portal,l=s&&s.url,r=s&&s.user&&s.user.username,i=e.name+"-"+e.styleName+"-"+e.styleUrl+"-"+l+"-"+r,n=this._webStyleSymbolCache;return n.has(i)||("2d"===this.view.type?n.set(i,e.fetchCIMSymbol()):n.set(i,e.fetchSymbol())),n.get(i).then((e=>this._getAppliedCloneSymbol(e,t))).catch((()=>(J.warn("Fetching web-style failed!"),Promise.reject())))}return Promise.resolve(this._getAppliedCloneSymbol(e,t))}_getAppliedCloneSymbol(e,s){if(!e||!s)return e;const l=e.clone(),r=s&&s.toRgba();return l.type.indexOf("3d")>-1?this._applyColorTo3dSymbol(l,r):"cim"===l.type?I$4(l,s):l.color&&(l.color=new h$3(r||l.color)),l}_applyColorTo3dSymbol(e,s){s&&e.symbolLayers.forEach((e=>{e&&(e.material||(e.material={}),e.material.color=new h$3(s));}));}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||"vector-field"===e.type)return null;const s=e.visualVariables,l=[],r=[],i=[];for(const c of s)"color"===c.type?l.push(c):"size"===c.type?r.push(c):"opacity"===c.type&&i.push(c);const n=[...l,...r,...i];let a,o;if(0===l.length&&oe(e)&&e.classBreakInfos&&1===e.classBreakInfos.length){const t=e.classBreakInfos[0];a=t&&t.symbol;}if(0===l.length&&ae(e)&&(a=e.symbol),a)if(a.type.indexOf("3d")>-1){const e=a.symbolLayers.getItemAt(0);"water"===e.type?r$6(e.color)&&(o=e.color):r$6(e.material)&&r$6(e.material.color)&&(o=e.material.color);}else a.url||(o=a.color);const u=this.effect;return (await Promise.all(n.map((async s=>{if(!s.legendOptions||!1!==s.legendOptions.showLegend){const l=this._getRampTitle(s,t);let r=null;const i="getField"in t&&t.getField&&t.getField(s.field),n=i&&K$1(i);if("color"===s.type){const e=await r$3(s,null,n);r={type:"color-ramp",title:l,infos:e,preview:p$5(e.map((e=>e.color)),{effect:u})},this._hasColorRamp||(this._hasColorRamp=!(null==r.infos||!r.infos.length));}else if("size"===s.type&&"outline"!==s.target)Y.test(s.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=s):(r={type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(s):l,infos:await S$1(e,s,await this._getMedianColor(e),this.scale,this.view.type,n)},this._hasSizeRamp||(this._hasSizeRamp=!(null==r.infos||!r.infos.length)));else if("opacity"===s.type){const e=await r$3(s,o,n);r={type:"opacity-ramp",title:l,infos:e,preview:p$5(e.map((e=>e.color)),{effect:u})},this._hasOpacityRamp||(this._hasOpacityRamp=!(null==r.infos||!r.infos.length));}return r&&r.infos?r:null}})))).filter((e=>!!e))}_getDomainName(e,t,s){if(e&&"function"!=typeof e){const l="getField"in s&&s.getField&&s.getField(e),r=l&&"getFieldDomain"in s&&s.getFieldDomain?s.getFieldDomain(l.name):null;return r&&"coded-value"===r.type?r.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,s=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){const e=t.featureReduction,l="popupTemplate"in e&&e.popupTemplate,r=l&&l.fieldInfos;if(r)for(const t of r)if(t.fieldName===s)return "cluster_count"===s?t.label||{showCount:!0}:t.label}return {showCount:!0}}_getRampTitle(e,t){let s=e.field,l=e.normalizationField,r=!1,i=!1,n=!1,a=null;s="function"==typeof s?null:s,l="function"==typeof l?null:l;const o=e.legendOptions&&e.legendOptions.title;if(null!=o)a=o;else if(e.valueExpressionTitle)a=e.valueExpressionTitle;else {if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables){const e=t.renderer.authoringInfo.visualVariables;for(let t=0;t<e.length;t++){const s=e[t];if("color"===s.type){if("ratio"===s.style){r=!0;break}if("percent"===s.style){i=!0;break}if("percent-of-total"===s.style){n=!0;break}}}}a={field:s&&this._getFieldAlias(s,t),normField:l&&this._getFieldAlias(l,t),ratio:r,ratioPercent:i,ratioPercentTotal:n};}return a}_getRendererTitle(e,t){const s=e;if(s.legendOptions&&s.legendOptions.title)return s.legendOptions.title;if(s.valueExpressionTitle)return s.valueExpressionTitle;let l=s.field,r=null,i=null;oe(s)&&(r=s.normalizationField,i="percent-of-total"===s.normalizationType),l="function"==typeof l?null:l,r="function"==typeof r?null:r;let n=null;return (l||r)&&(n={field:l&&this._getFieldAlias(l,t),normField:r&&this._getFieldAlias(r,t),normByPct:i}),n}_getFieldAlias(e,t){const s="popupTemplate"in t&&t.popupTemplate,l=s&&s.fieldInfos;let r=null;l&&l.some((t=>e===t.fieldName&&(r=t,!0)));let i=null;"getField"in t&&t.getField?i=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(i=t.fieldsIndex.get(e));const n=r||i;let a=null;return n&&(a=r&&r.label||i&&i.alias||"name"in n&&n.name||"fieldName"in n&&n.fieldName),a}_isUnclassedRenderer(e){const t=e.visualVariables;let s=!1;return oe(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(s=e.field?t.some((t=>!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField))):!!t.length),s}};e$4([d$3()],xe.prototype,"children",void 0),e$4([d$3({readOnly:!0})],xe.prototype,"effect",null),e$4([d$3()],xe.prototype,"layerView",void 0),e$4([d$3()],xe.prototype,"layer",void 0),e$4([d$3()],xe.prototype,"legendElements",void 0),e$4([d$3({readOnly:!0})],xe.prototype,"opacity",null),e$4([d$3()],xe.prototype,"parent",void 0),e$4([d$3({readOnly:!0,dependsOn:[]})],xe.prototype,"ready",null),e$4([d$3()],xe.prototype,"hideLayersNotInCurrentView",void 0),e$4([d$3()],xe.prototype,"keepCacheOnDestroy",void 0),e$4([d$3()],xe.prototype,"respectLayerVisibility",void 0),e$4([d$3({readOnly:!0})],xe.prototype,"scale",null),e$4([d$3()],xe.prototype,"sublayerIds",void 0),e$4([d$3({readOnly:!0})],xe.prototype,"isScaleDriven",null),e$4([d$3()],xe.prototype,"title",void 0),e$4([d$3({readOnly:!0,dependsOn:["ready"],value:0})],xe.prototype,"version",null),e$4([d$3()],xe.prototype,"view",void 0),xe=e$4([i$8("esri.widgets.Legend.support.ActiveLayerInfo")],xe);const je=xe;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const h$1={state:"state",view:"view",allLayerViews:"all-layer-views",legendProperties:"legend-properties"},c$1=S$4.ofType(je),L$3=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],_$1="view.basemapView.baseLayerViews",f$3="view.groundView.layerViews",v$1="view.basemapView.referenceLayerViews",p$2=[_$1,f$3,"view.layerViews",v$1];let u$3=class extends p$4{constructor(e){super(e),this._handles=new u$8,this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new S$4,this.activeLayerInfos=new c$1,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null;}initialize(){this._handles.add(i$6(this,"view",this._viewHandles),h$1.view),this._handles.add(g$5((()=>this._refresh())));}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null;}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove(h$1.state),this.view&&this._handles.add(i$6(this,"state",this._stateHandles),h$1.state);}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews();}_resetAll(){this._handles.remove([h$1.allLayerViews,h$1.legendProperties]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll();}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this);}_destroyViewActiveLayerInfo(e){this._handles.remove(e);const i=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],i&&i.parent&&i.parent.children.remove(i);}_watchPropertiesAndAllLayerViews(){const{allLayerViews:e}=this.view;e.length&&this._refresh(),this._handles.add(e.on("change",this._allLayerViewsChangeHandle.bind(this)),h$1.allLayerViews),this._handles.add(f$7(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),h$1.legendProperties);}_allLayerViewsChangeHandle(e){e.removed.forEach((e=>this._destroyViewActiveLayerInfo(e.uid))),this._refresh();}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh();}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos);}_sortActiveLayerInfos(e){if(e.length<2)return;const i=[];e.forEach((r=>{if(!r.parent){const t=r.layer.parent,s=t&&"uid"in t&&this._layerViewByLayerId[t.uid],a=s&&this._activeLayerInfosByLayerViewId[s.uid];a&&-1!==e.indexOf(a)&&(i.push(r),r.parent=a,a.children.add(r),this._sortActiveLayerInfos(a.children));}})),e.removeMany(i);const r={};this.view.allLayerViews.forEach(((e,i)=>r[e.layer.uid]=i)),e.sort(((e,i)=>{const t=r[e.layer.uid]||0;return (r[i.layer.uid]||0)-t}));}_generateLayerViews(){const e=[];return p$2.filter(this._filterLayerViews,this).map(this.get,this).filter((e=>null!=e)).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const i=!this.basemapLegendVisible&&(e===_$1||e===v$1),r=!this.groundLegendVisible&&e===f$3;return !i&&!r}_collectLayerViews(e,i){const r=t=>(t&&t.forEach((t=>{i.push(t),r(t[e]);})),i);return r}_filterLayerViewsByLayerInfos(e){const i=this.layerInfos;return !i||!i.length||i.some((i=>this._hasLayerInfo(i,e)))}_hasLayerInfo(e,i){const r=this._isLayerUIDMatching(e.layer,i.layer.uid);return r&&(this._layerInfosByLayerViewId[i.uid]=e),r}_isLayerUIDMatching(e,i){return e&&(e.uid===i||this._hasLayerUID(e.layers,i))}_hasLayerUID(e,i){return e&&e.some((e=>this._isLayerUIDMatching(e,i)))}_isLayerViewSupported(e){return !!L$3.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add(f$7(e,"legendEnabled, layer.legendEnabled",(()=>this._layerActiveHandle(e))),e.uid));}_layerActiveHandle(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e));}_isLayerActive(e){return !this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}_buildActiveLayerInfo(e){var i;const r=e.layer,t=e.uid,s=this._layerInfosByLayerViewId[t];let o=this._activeLayerInfosByLayerViewId[t];if(!o){const i=s&&void 0!==s.title&&s.layer.uid===r.uid;o=new je({layer:r,layerView:e,title:i?s.title:r.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:s&&s.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[t]=o;}const l=r.parent&&"uid"in r.parent&&this._layerViewByLayerId[null==(i=r.parent)?void 0:i.uid];if(o.parent=this._activeLayerInfosByLayerViewId[null==l?void 0:l.uid],!this._handles.has(t)){const i=[f$7(r,"title",(e=>this._titleHandle(e,o))),f$7(r,"renderer?, opacity, pointSymbol?, lineSymbol?, polygonSymbol?",(()=>this._constructLegendElements(o))),v$3(this.view,"stationary",(()=>this._scaleHandle(o))),f$7(e,"_effectiveRenderer",(()=>this._constructLegendElements(o))),f$7(r,"effect",(()=>this._constructLegendElements(o)))];if(this.respectLayerVisibility){const t=f$7(e,"legendEnabled",(e=>this._legendEnabledHandle(e,o))),s=f$7(r,"legendEnabled",(e=>this._legendEnabledHandle(e,o)));i.push(t,s);}this._handles.add(i,t);}o.isScaleDriven||this._constructLegendElements(o),this._addActiveLayerInfo(o);}_titleHandle(e,i){i.title=e,this._constructLegendElements(i);}_legendEnabledHandle(e,i){e?this._addActiveLayerInfo(i):this._removeActiveLayerInfo(i);}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e);}_addActiveLayerInfo(e){const{layerView:i,layer:r}=e;if(this._isLayerActive(i)&&-1===this.activeLayerInfos.indexOf(e)){const i=e.parent;if(i)-1===i.children.indexOf(e)&&i.children.push(e),this._sortActiveLayerInfos(i.children);else {var t;const i=null==(t=this.layerInfos)?void 0:t.some((e=>e.layer.uid===r.uid));r.parent&&"uid"in r.parent&&!i?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos));}if(this._activeLayerInfosWithNoParent.length){const e=[];this._activeLayerInfosWithNoParent.forEach((i=>{const r=i.layer.parent,t=r&&"uid"in r&&this._layerViewByLayerId[null==r?void 0:r.uid],s=this._activeLayerInfosByLayerViewId[null==t?void 0:t.uid];s&&(e.push(i),i.parent=s);})),e.length&&(this._activeLayerInfosWithNoParent.removeMany(e),e.forEach((e=>this._addActiveLayerInfo(e))));}}}_removeActiveLayerInfo(e){const i=e.parent;i?i.children.remove(e):this.activeLayerInfos.remove(e);}_constructLegendElements(e){const i=e.layer;"featureCollections"in i&&i.featureCollections?e.buildLegendElementsForFeatureCollections(i.featureCollections):"renderer"in i&&i.renderer?e.buildLegendElementsForRenderer(i.renderer):"url"in i&&i.url?e.buildLegendElementsForTools():e.children.forEach((e=>this._constructLegendElements(e)));}};e$4([d$3({type:c$1})],u$3.prototype,"activeLayerInfos",void 0),e$4([d$3()],u$3.prototype,"basemapLegendVisible",void 0),e$4([d$3()],u$3.prototype,"groundLegendVisible",void 0),e$4([d$3()],u$3.prototype,"hideLayersNotInCurrentView",void 0),e$4([d$3()],u$3.prototype,"keepCacheOnDestroy",void 0),e$4([d$3()],u$3.prototype,"respectLayerVisibility",void 0),e$4([d$3()],u$3.prototype,"layerInfos",void 0),e$4([d$3({readOnly:!0})],u$3.prototype,"state",null),e$4([d$3()],u$3.prototype,"view",void 0),u$3=e$4([i$8("esri.widgets.Legend.LegendViewModel")],u$3);const I$1=u$3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const d$1="http://www.w3.org/2000/svg",m$1={diamondContainer:"esri-relationship-ramp--diamond__container",diamondLeftCol:"esri-relationship-ramp--diamond__left-column",diamondRightCol:"esri-relationship-ramp--diamond__right-column",diamondMidCol:"esri-relationship-ramp--diamond__middle-column",diamondMidColLabel:"esri-relationship-ramp--diamond__middle-column--label",diamondMidColRamp:"esri-relationship-ramp--diamond__middle-column--ramp",squareTable:"esri-relationship-ramp--square__table",squareTableRow:"esri-relationship-ramp--square__table-row",squareTableCell:"esri-relationship-ramp--square__table-cell",squareTableLabel:"esri-relationship-ramp--square__table-label",squareTableLabelLeftBottom:"esri-relationship-ramp--square__table-label--left-bottom",squareTableLabelRightBottom:"esri-relationship-ramp--square__table-label--right-bottom",squareTableLabelLeftTop:"esri-relationship-ramp--square__table-label--left-top",squareTableLabelRightTop:"esri-relationship-ramp--square__table-label--right-top"};function u$2(e,a,r,l){const{focus:t,labels:s}=e,i=!!t,d=p$1(e,a,r,l);return i?n$5("div",{class:m$1.diamondContainer},n$5("div",{class:m$1.diamondLeftCol},s.left),n$5("div",{class:m$1.diamondMidCol},n$5("div",{class:m$1.diamondMidColLabel},s.top),d,n$5("div",{class:m$1.diamondMidColLabel},s.bottom)),n$5("div",{class:m$1.diamondRightCol},s.right)):n$5("div",{class:m$1.squareTable},n$5("div",{class:m$1.squareTableRow},n$5("div",{class:l$6(m$1.squareTableCell,m$1.squareTableLabel,m$1.squareTableLabelRightBottom)},s.left),n$5("div",{class:m$1.squareTableCell}),n$5("div",{class:l$6(m$1.squareTableCell,m$1.squareTableLabel,m$1.squareTableLabelLeftBottom)},s.top)),n$5("div",{class:m$1.squareTableRow},n$5("div",{class:m$1.squareTableCell}),d,n$5("div",{class:m$1.squareTableCell})),n$5("div",{class:m$1.squareTableRow},n$5("div",{class:l$6(m$1.squareTableCell,m$1.squareTableLabel,m$1.squareTableLabelRightTop)},s.bottom),n$5("div",{class:m$1.squareTableCell}),n$5("div",{class:l$6(m$1.squareTableCell,m$1.squareTableLabel,m$1.squareTableLabelLeftTop)},s.right)))}function b(e,a,r){const l=`${r}_arrowStart`,t=`${r}_arrowEnd`,s="left"===e,i={markerStart:null,markerEnd:null};switch(a){case"HL":s?i.markerStart=`url(#${t})`:i.markerEnd=`url(#${l})`;break;case"LL":i.markerStart=`url(#${t})`;break;case"LH":s?i.markerEnd=`url(#${l})`:i.markerStart=`url(#${t})`;break;default:i.markerEnd=`url(#${l})`;}return i}function p$1(o,u,p,c,h=60){const{focus:q,numClasses:f,colors:k,rotation:T}=o,_=!!q,L=Math.sqrt(h**2+h**2)+(_?0:5),g=[],C=[],v=[],w=(h||75)/f;for(let s=0;s<f;s++){const i=s*w;for(let o=0;o<f;o++){const n=o*w,d=v$4(k[s][o]),m=A$2(null),u={type:"rect",x:n,y:i,width:w,height:w};g.push(I$5(d)),C.push(b$5(u,d.fill,m,null)),v.push(T$1(u));}}const y=10,x=15,R=15,$=10;let E=null;_||(E="margin: -15px -15px -18px -15px");const M=b("left",q,u),S=b("right",q,u),j=U$2(v),B=L$7(j,L,L,0,!1,T,!1),H=L$7(j,L,L,0,!1,_?-45:null,!1);return n$5("div",{styles:{filter:c,opacity:null==p?null:`${p}`},class:_?m$1.diamondMidColRamp:m$1.squareTableCell},n$5("svg",{xmlns:d$1,width:L,height:L,style:E},n$5("defs",null,n$5("marker",{id:`${u}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},n$5("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),n$5("marker",{id:`${u}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},n$5("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),g),n$5("g",{transform:B},C),n$5("g",{transform:H},n$5("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":M.markerStart,"marker-end":M.markerEnd,x1:-y,y1:h-x,x2:-y,y2:x}),n$5("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":S.markerStart,"marker-end":S.markerEnd,x1:R,y1:h+$,x2:h-R,y2:h+$}))))}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const l=i$9(),r$1=10,n$1=20,s=10,a=20,c={univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",colorRamp:"esri-legend__color-ramp"};function f$2(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return "vertical"===e?n$5("svg",{height:"4",width:"10"},n$5("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):n$5("svg",{height:"10",width:"10"},n$5("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function p(e,t="vertical"){const o=document.createElement("div");return o.style.height=`${n$1}px`,o.className=c.univariateAboveAndBelowSymbol,null!=e&&(o.style.opacity=e.toString()),l.append(o,f$2.bind(null,t)),o}function m(t,o,i="vertical",l){t.infos.forEach(((t,r)=>{if(l&&2===r)t.preview=p(o,i);else {const o=u$9(t.size)+("horizontal"===i?a:s),l="div"===t.preview.tagName.toLowerCase(),r=l?t.preview:document.createElement("div");r.className=c.univariateAboveAndBelowSymbol,"horizontal"===i?r.style.width=`${o}px`:r.style.height=`${o}px`,l||r.appendChild(t.preview),t.preview=r;}}));}function u$1(t,o="classic"){const i=t.infos;return "classic"===o?(u$9(i[0].size)+s)/2:(u$9(i[0].size)-u$9(i[i.length-1].size))/2}function v(e,t){if(!e)return null;const i=e.infos.map((e=>e.color)),l=p$5("full"===t.type?i:"above"===t.type?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effect:t.effect});return l.className=c.colorRamp,null!=t.opacity&&(l.style.opacity=t.opacity.toString()),l}function h(t,o,i,l="vertical"){let c=0;const f=t.infos,p=Math.floor(f.length/2),m="full"===o||"above"===o?0:p,u="full"===o||"below"===o?f.length-1:p;for(let v=m;v<=u;v++)if(i&&v===p)c+="horizontal"===l?r$1:n$1;else {c+=u$9(f[v].size)+("horizontal"===l?a:s);}return Math.round(c)}function y(t,o,i,l="vertical"){const c=h(t,o,i,l),f=t.infos,p=Math.floor(f.length/2),m="full"===o||"above"===o?0:p,u="full"===o||"below"===o?f.length-1:p,v="full"===o?f[m].size+f[u].size:"above"===o?f[m].size:f[u].size,y=i?"vertical"===l?n$1:r$1:0,d="vertical"===l?s*("full"===o?2:1):a*("full"===o?2:1);return Math.round(c-(u$9(v)/2+y/2+d/2))}function d(e,t,o="vertical"){const i=e.infos;let l=i.filter((({type:e})=>"size-ramp"===e))[0],r=i.filter((({type:e})=>"color-ramp"===e))[0];var n;(l&&(l={...l},l.infos=[...l.infos]),r&&(r={...r},r.infos=[...r.infos]),m(l,t,o,!0),"horizontal"===o)&&(l.infos.reverse(),null==(n=r)||n.infos.reverse());return {sizeRampElement:l,colorRampElement:r}}function g$1(e,t="vertical"){const o=e.infos;let i=o.filter((({type:e})=>"size-ramp"===e))[0],l=o.filter((({type:e})=>"color-ramp"===e))[0];var r;(i&&(i={...i},i.infos=[...i.infos]),l&&(l={...l},l.infos=[...l.infos]),m(i,null,t,!1),"horizontal"===t)&&(i.infos.reverse(),null==(r=l)||r.infos.reverse());return {sizeRampElement:i,colorRampElement:l}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function n(e,n){return n}function t(e){const n=this;e.appendChild(n);}function r(t,r,i){if(!r)return;if("string"==typeof r||"number"==typeof r)return r;if("value"in r||"unit"in r)return s$7(t.dotValue,r);if("colorName"in r||"bandName"in r)return t[r.colorName]+": "+(t[r.bandName]||r.bandName);if("showCount"in r)return r.showCount?t.clusterCountTitle:null;let l=null;return n(r,i)?l=r.ratioPercentTotal?"showRatioPercentTotal":r.ratioPercent?"showRatioPercent":r.ratio?"showRatio":r.normField?"showNormField":r.field?"showField":null:o(r,i)&&(l=r.normField?"showNormField":r.normByPct?"showNormPct":r.field?"showField":null),l?s$7("showField"===l?"{field}":t[l],{field:r.field,normField:r.normField}):null}function o(e,n){return !n}function i(e,n){return !!(n&&"Stretched"===n&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const L$2={activated:"esri-legend--card__carousel-indicator--activated",base:"esri-legend--card",stacked:"esri-legend--stacked",carouselTitle:"esri-legend--card__carousel-title",indicator:"esri-legend--card__carousel-indicator",intervalSeparator:"esri-legend--card__interval-separator",imageryLayerStretchedImage:"esri-legend--card__imagery-layer-image--stretched",imageLabel:"esri-legend--card__image-label",layerCaption:"esri-legend--card__layer-caption",labelElement:"esri-legend--card__label-element",layerRow:"esri-legend--card__layer-row",labelCell:"esri-legend--card__label-cell",message:"esri-legend--card__message",rampLabel:"esri-legend--card__ramp-label",section:"esri-legend--card__section",relationshipSection:"esri-legend--card__relationship-section",serviceCaptionText:"esri-legend--card__service-caption-text",serviceContent:"esri-legend--card__service-content",service:"esri-legend--card__service",groupLayer:"esri-legend--card__group-layer",groupLayerChild:"esri-legend--card__group-layer-child",symbol:"esri-legend--card__symbol",sizeRampRow:"esri-legend--card__size-ramp-row",symbolRow:"esri-legend--card__symbol-row",symbolCell:"esri-legend--card__symbol-cell",indicatorContainer:"esri-legend--card__carousel-indicator-container",intervalSeparatorsContainer:"esri-legend--card__interval-separators-container",relationshipLabelContainer:"esri-legend--card__relationship-label-container",labelContainer:"esri-legend--card__label-container",serviceCaptionContainer:"esri-legend--card__service-caption-container",symbolContainer:"esri-legend--card__symbol-container",sizeRampContainer:"esri-legend--card__size-ramp-container",sizeRampPreview:"esri-legend--card__size-ramp-preview",rampContainer:"esri-legend__ramps",sizeRampHorizontal:"esri-legend__size-ramp--horizontal",rampLabelsContainer:"esri-legend__ramp-labels",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card",hidden:"esri-hidden"},C$1=25,x=25,S=768,z=100,R$1="#ddd",$=window.devicePixelRatio;function I(e){if(e){if(e.type.indexOf("3d")>-1){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const s=e.symbolLayers.getItemAt(t-1),i=s.resource&&s.resource.primitive;return "circle"===i||"cross"===i||"kite"===i||"sphere"===i||"cube"===i||"diamond"===i}{const t=e.style;return "circle"===t||"diamond"===t||"cross"===t}}}function k(e){if(e){if(e.type.indexOf("3d")>-1){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const s=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return "triangle"===s||"cone"===s||"tetrahedron"===s}return "triangle"===e.style}}let N=class extends z$3{constructor(e,s){super(e,s),this._handles=new u$8,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout="stack",this.messages=null,this.messagesCommon=null,this.type="card",this.view=null;}initialize(){this.own([this.watch("activeLayerInfos",(e=>{this._handles.removeAll(),this._watchForSectionChanges(e);}))]);}destroy(){this._handles.destroy(),this._handles=null;}render(){this._hasIndicators="auto"===this.layout&&this.view.container.clientWidth<=S||"stack"===this.layout;const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const s=this._sectionNames.length,i=this._sectionNames.map(((e,t)=>{const i=s$7(this.messagesCommon.pagination.pageText,{index:t+1,total:s});return n$5("div",{key:e,role:"tab",id:e,"aria-label":i,"aria-controls":`${e}-panel`,"aria-selected":(this._selectedSectionName===e).toString(),tabIndex:this._selectedSectionName===e?0:-1,title:i,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes(L$2.indicator,{[L$2.activated]:this._selectedSectionName===e}),"data-section-name":e})})),r=this._hasIndicators&&s>1?n$5("div",{class:L$2.indicatorContainer,key:"carousel-navigation",role:"tablist"},i):null,a=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):t&&t.length?t:null,o={[L$2.stacked]:this._hasIndicators};return n$5("div",{class:this.classes(L$2.base,o)},a||n$5("div",{class:L$2.message},this.messages.noLegend),r)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t);}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e);}}_switchSectionOnArrowPress(e){const t=e.key,s="ArrowLeft"===t?-1:1,i=e.target.getAttribute("data-section-name"),r=this._sectionNames.indexOf(i),a=this._sectionNames;let o=null;-1!==r&&(a[r+s]?o=document.getElementById(a[r+s]):"ArrowLeft"===t?o=document.getElementById(a[a.length-1]):"ArrowRight"===t&&(o=document.getElementById(a[0])),o&&o.focus());}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach((e=>{const t=`activeLayerInfo-${e.layer.uid}-version-change`;this._handles.remove(t),this._watchForSectionChanges(e.children),this._handles.add(e.watch("version",(()=>this._generateSectionNames())),t);}));const t="activeLayerInfos-collection-change";this._handles.remove(t),this._handles.add(e.on("change",(()=>this._watchForSectionChanges(e))),t);}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this);}_getSectionName(e,t,s){return `${this.id}${e.uid}-type-${t.type}-${s}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach(((t,s)=>{this._sectionNames.push(this._getSectionName(e.layer,t,s));}));}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return n$5("div",{key:e.layer.uid,class:this.classes(L$2.service,L$2.groupLayer)},n$5("div",{class:L$2.serviceCaptionContainer},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const s=t.some((e=>"relationship-ramp"===e.type)),i=t.map(((t,i)=>this._renderLegendForElement(t,e,i,s))).filter((e=>!!e));if(!i.length)return null;const r={[L$2.groupLayerChild]:!!e.parent};return n$5("div",{key:e.layer.uid,class:this.classes(L$2.service,r)},n$5("div",{class:L$2.serviceCaptionContainer},n$5("div",{class:L$2.serviceCaptionText},e.title)),n$5("div",{class:L$2.serviceContent},i))}}_renderLegendForElement(e,t,s,i=!1){const r$1="color-ramp"===e.type,a="opacity-ramp"===e.type,o="size-ramp"===e.type,n=t.layer;let c=null;if("string"==typeof e.title)c=e.title;else if(e.title){const t=e.title,s=r(this.messages,t,r$1||a);c=t.title?`${t.title} (${s})`:s;}const d=this._getSectionName(n,e,s),p=this._hasIndicators?n$5("div",null,n$5(s$8,{level:this.headingLevel,class:L$2.carouselTitle},t.title),n$5(s$8,{level:this.headingLevel+1,class:L$2.layerCaption},c)):c?n$5(s$8,{level:this.headingLevel,class:L$2.layerCaption},c):null,m=t.effect;let h=null;if("symbol-table"===e.type){const s=e.infos.map(((s,i)=>this._renderLegendForElementInfo(s,t,e.legendType,i))).filter((e=>!!e));if(s.length){const e=s[0].properties.classes&&s[0].properties.classes[L$2.symbolRow],t={[L$2.labelContainer]:!e&&!i,[L$2.relationshipLabelContainer]:i};h=n$5("div",{class:this.classes(t)},s);}}else "color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?h=this._renderLegendForRamp(e,n.opacity,m):o?h=this._renderSizeRamp(e,n.opacity):"relationship-ramp"===e.type?h=u$2(e,this.id,n.opacity,m):"univariate-above-and-below-ramp"===e.type?h=this._renderUnivariateAboveAndBelowRamp(e,n.opacity,m):"univariate-color-size-ramp"===e.type&&(h=this._renderUnivariateColorSizeRamp(e,n.opacity,m));if(!h)return null;const g=n$5("div",{key:d,class:L$2.section,id:`${d}-panel`,role:"tabpanel","aria-labelledby":d,tabIndex:0},[p,h]);return this._sectionMap.set(d,g),g}_renderUnivariateAboveAndBelowRamp(e,t$1,s){const{sizeRampElement:i,colorRampElement:r}=d(e,t$1,"horizontal"),a=h(i,"full",!0,"horizontal"),o=y(i,"above",!0,"horizontal"),l=y(i,"below",!0,"horizontal"),h$1=12,y$1=v(r,{width:o,height:h$1,rampAlignment:"horizontal",opacity:t$1,type:"above",effect:s}),_=v(r,{width:l,height:h$1,rampAlignment:"horizontal",opacity:t$1,type:"below",effect:s}),v$1=u$1(i,"card"),f=i.infos.map((e=>e.label)),u=f.length-1,w=f.map(((e,t)=>0===t||t===u?n$5("div",{key:t},e):null)),C={display:"flex",flexDirection:"column"},x={display:"flex",flexDirection:"row"},S={marginTop:"3px",marginLeft:`${v$1}px`,display:"flex"},z={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return n$5("div",{class:L$2.layerRow,key:"size-ramp-preview",styles:C},n$5("div",{class:this.classes(L$2.symbolContainer,L$2.sizeRampHorizontal),styles:x},i.infos.map(((e,t$1)=>n$5("div",{key:t$1,class:L$2.symbol,bind:e.preview,afterCreate:t})))),y$1?n$5("div",{class:L$2.univariateAboveAndBelowColorRamp,styles:S,key:"color-ramp-preview"},n$5("div",{bind:y$1,afterCreate:t}),n$5("div",{bind:_,afterCreate:t})):null,n$5("div",{class:L$2.layerInfo},n$5("div",{class:L$2.rampLabelsContainer,styles:z},w)))}_renderUnivariateColorSizeRamp(e,t$1,s){const{sizeRampElement:i,colorRampElement:r}=g$1(e,"horizontal"),a=h(i,"full",!1,"horizontal"),o=y(i,"full",!1,"horizontal"),l=v(r,{width:o,height:12,rampAlignment:"horizontal",opacity:t$1,type:"full",effect:s}),n=u$1(i,"card"),y$1=i.infos.length-1,_=i.infos.map(((e,t)=>0===t||t===y$1?n$5("div",{key:t},e.label):null)),v$1={display:"flex",flexDirection:"column"},f={display:"flex",flexDirection:"row"},u={marginTop:"3px",marginLeft:`${n}px`,display:"flex"},w={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return n$5("div",{class:L$2.layerRow,key:"size-ramp-preview",styles:v$1},n$5("div",{class:this.classes(L$2.symbolContainer,L$2.sizeRampHorizontal),styles:f},i.infos.map(((e,t$1)=>n$5("div",{key:t$1,class:L$2.symbol,bind:e.preview,afterCreate:t})))),n$5("div",{class:L$2.univariateAboveAndBelowColorRamp,styles:u,key:"color-ramp-preview"},n$5("div",{bind:l,afterCreate:t})),n$5("div",{class:L$2.layerInfo},n$5("div",{class:L$2.rampLabelsContainer,styles:w},_)))}_renderLegendForElementInfo(e,t$1,s,i$1){const r$1=t$1.layer;if(e.type)return this._renderLegendForElement(e,t$1,i$1);const a=i(r$1,s);if(e.preview){var o,l;if(!e.symbol||-1===e.symbol.type.indexOf("simple-fill")){if(!e.label)return n$5("div",{key:i$1,bind:e.preview,afterCreate:t});const t$1={[L$2.symbolCell]:this._hasIndicators};return n$5("div",{key:i$1,class:this.classes(L$2.layerRow,{[L$2.symbolRow]:this._hasIndicators})},n$5("div",{class:this.classes(t$1),bind:e.preview,afterCreate:t}),n$5("div",{class:this.classes(L$2.imageLabel,{[L$2.labelCell]:this._hasIndicators})},r(this.messages,e.label,!1)||""))}let s=255,a=255,n=255,c=0,d=255,p=255,m=255,h=0;const _=e.symbol.color&&e.symbol.color.a,v=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;_&&(s=e.symbol.color.r,a=e.symbol.color.g,n=e.symbol.color.b,c=e.symbol.color.a*r$1.opacity),v&&(d=e.symbol.outline.color.r,p=e.symbol.outline.color.g,m=e.symbol.outline.color.b,h=e.symbol.outline.color.a*r$1.opacity);const f=null==(o=null==(l=e.symbol.color)?void 0:l.isBright)||o,u=f?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",w={background:_?`rgba(${s}, ${a}, ${n}, ${c})`:"none",color:f?"black":"white",textShadow:`-1px -1px 0 ${u},\n                                              1px -1px 0 ${u},\n                                              -1px 1px 0 ${u},\n                                              1px 1px 0 ${u}`,border:v?`1px solid rgba(${d}, ${p}, ${m}, ${h})`:"none",filter:t$1.effect};return n$5("div",{key:i$1,class:L$2.layerRow},n$5("div",{class:L$2.labelElement,styles:w}," ",e.label," "))}if(e.src){const t=this._renderImage(e,r$1,a);return n$5("div",{key:i$1,class:L$2.layerRow},t,n$5("div",{class:L$2.imageLabel},e.label||""))}}_renderImage(e,t,s){const{label:i,src:r$1,opacity:a}=e,o={[L$2.imageryLayerStretchedImage]:s,[L$2.symbol]:!s},l={opacity:`${null!=a?a:t.opacity}`};return n$5("img",{alt:r(this.messages,i,!1),src:r$1,border:0,width:e.width,height:e.height,class:this.classes(o),styles:l})}_renderSizeRampLines(e){const t$1=e.infos,i=t$1[0],r=t$1[t$1.length-1],a=i.symbol,o=this._hasIndicators,l=u$9(i.size+i.outlineSize)*$,n=u$9(r.size+r.outlineSize)*$,c=o?l:l+50*$,d=o?l/2+50*$:l,p=k(a),m=I(a),h=document.createElement("canvas");h.width=c,h.height=d,h.style.width=h.width/$+"px",h.style.height=h.height/$+"px";const y=h.getContext("2d");if(o){y.beginPath();const e=0,t=0,s=c/2-n/2,i=d;y.moveTo(e,t),y.lineTo(s,i);const r=c,a=0,o=c/2+n/2,l=d;y.moveTo(r,a),y.lineTo(o,l);}else {y.beginPath();const e=0,t=d/2-n/2,s=c,i=0;y.moveTo(e,t),y.lineTo(s,i);const r=0,a=d/2+n/2,o=c,l=d;y.moveTo(r,a),y.lineTo(o,l);}return y.strokeStyle=R$1,y.stroke(),n$5("div",{bind:h,afterCreate:t,styles:o?{display:"flex",marginTop:`-${p?0:m?l/2:0}px`,marginBottom:`-${p?n:m?n/2:0}px`}:{display:"flex",marginRight:`-${p?0:m?l/2:0}px`,marginLeft:`-${p?0:m?n/2:0}px`}})}_renderSizeRamp(e,t$1){const s=e.infos,i=s[0].label,r=s[s.length-1].label;let a=s[0].preview,o=s[s.length-1].preview;const l=this._hasIndicators,n={"flex-direction":l?"column":"row-reverse"};a&&(a=a.cloneNode(!0),a.style.display="flex"),o&&(o=o.cloneNode(!0),o.style.display="flex");const c={opacity:null!=t$1?`${t$1}`:""};return n$5("div",{class:this.classes(L$2.layerRow,{[L$2.sizeRampRow]:l})},n$5("div",{class:L$2.rampLabel},l?i:r),n$5("div",{class:L$2.sizeRampContainer,styles:n},n$5("div",{bind:a,afterCreate:t,class:L$2.sizeRampPreview,styles:c}),this._renderSizeRampLines(e),n$5("div",{bind:o,afterCreate:t,class:L$2.sizeRampContainer,styles:c})),n$5("div",{class:L$2.rampLabel},l?r:i))}_renderLegendForRamp(e,t,s){const i=e.infos,r="heatmap-ramp"===e.type,o=i.length-1,l=x,n=o>2&&!r?C$1*o:z,c=n+20,d=10,p=i.slice(0).reverse();p.forEach(((e,t)=>{e.offset=r?e.ratio:t/o;}));const m=p.length-1,h=p.length%2!=0&&p[p.length/2|0],y=h&&n$5("div",{class:L$2.intervalSeparatorsContainer},n$5("div",{class:L$2.intervalSeparator},"|"),n$5("div",{class:L$2.rampLabel},h.label)),g=i[i.length-1].label,_=i[0].label,v=[[{shape:{type:"path",path:`M0 ${l/2} L${d} 0 L${d} ${l} Z`},fill:p[0].color,stroke:{width:0}},{shape:{type:"rect",x:d,y:0,width:n,height:l},fill:{type:"linear",x1:d,y1:0,x2:n+d,y2:0,colors:p},stroke:{width:0}},{shape:{type:"path",path:`M${n+d} 0 L${c} ${l/2} L${n+d} ${l} Z`},fill:p[m].color,stroke:{width:0}}]],f=C$3(v,c,l),{messages:u}=this,w={filter:s,opacity:null==t?null:`${t}`};return n$5("div",{class:L$2.layerRow},n$5("div",{class:L$2.rampLabel},r?u[g]:g),n$5("div",{class:L$2.symbolContainer},n$5("div",{styles:w},f),y),n$5("div",{class:L$2.rampLabel},r?u[_]:_))}};e$4([d$3()],N.prototype,"activeLayerInfos",void 0),e$4([d$3()],N.prototype,"headingLevel",void 0),e$4([d$3()],N.prototype,"layout",void 0),e$4([d$3(),e$5("esri/widgets/Legend/t9n/Legend")],N.prototype,"messages",void 0),e$4([d$3(),e$5("esri/t9n/common")],N.prototype,"messagesCommon",void 0),e$4([d$3({readOnly:!0})],N.prototype,"type",void 0),e$4([d$3()],N.prototype,"view",void 0),e$4([t$5()],N.prototype,"_selectSection",null),N=e$4([i$8("esri.widgets.Legend.styles.Card")],N);const A$1=N;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const _={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},u="esri-legend__",f$1=24,L$1={display:"flex",alignItems:"flex-start"},w={marginLeft:"3px"},C={display:"table-cell",verticalAlign:"middle"};let R=class extends z$3{constructor(e,r){super(e,r),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic";}render(){const e=this.activeLayerInfos,r=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return n$5("div",null,r&&r.length?r:n$5("div",{class:_.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const r=!!e.children.length,l=`${u}${e.layer.uid}-version-${e.version}`,a=e.title?s$8({level:this.headingLevel,class:this.classes(_.header,_.label)},e.title):null;if(r){const r=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return n$5("div",{key:l,class:this.classes(_.service,_.groupLayer)},a,r)}{const r=e.legendElements;if(r&&!r.length)return null;const s=r.map((r=>this._renderLegendForElement(r,e.layer,e.effect))).filter((e=>!!e));if(!s.length)return null;const i={[_.groupLayerChild]:!!e.parent};return n$5("div",{key:l,class:this.classes(_.service,i),tabIndex:0},a,n$5("div",{class:_.layer},s))}}_renderLegendForElement(e,r$1,l,a){const i="color-ramp"===e.type,t="opacity-ramp"===e.type,n="size-ramp"===e.type;let o$1=null;if("symbol-table"===e.type||n){const a=e.infos.map((a=>this._renderLegendForElementInfo(a,r$1,l,n,e.legendType))).filter((e=>!!e));a.length&&(o$1=n$5("div",{class:_.layerBody},a));}else "color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?o$1=this._renderLegendForRamp(e,r$1.opacity):"relationship-ramp"===e.type?o$1=u$2(e,this.id,r$1.opacity,l):"univariate-above-and-below-ramp"===e.type?o$1=this._renderUnivariateAboveAndBelowRamp(e,r$1.opacity,l):"univariate-color-size-ramp"===e.type&&(o$1=this._renderUnivariateColorSizeRamp(e,r$1.opacity,l));if(!o$1)return null;const p=e.title;let m=null;if("string"==typeof p)m=p;else if(p){const e=r(this.messages,p,i||t);m=o(p,i||t)&&p.title?`${p.title} (${e})`:e;}const c=a?_.layerChildTable:_.layerTable,g=m?n$5("div",{class:_.layerCaption},m):null,v={[_.layerTableSizeRamp]:n||!a};return n$5("div",{class:this.classes(c,v)},g,o$1)}_renderUnivariateAboveAndBelowRamp(e,r,l){const{sizeRampElement:a,colorRampElement:s}=d(e,r),p=y(a,"above",!0),d$1=y(a,"below",!0),y$1=12,c=v(s,{width:y$1,height:p,rampAlignment:"vertical",opacity:r,type:"above",effect:l}),g=v(s,{width:y$1,height:d$1,rampAlignment:"vertical",opacity:r,type:"below",effect:l}),v$1=u$1(a),b=a.infos.map((e=>e.label)),u=b.map(((e,r)=>{const l=2===r;return 0===r?n$5("div",{key:r,class:e?c?_.univariateAboveAndBelowLabel:_.rampLabel:null},e):l?n$5("div",null):null})),f=b.length-1,R=Math.floor(b.length/2),A=b.map(((e,r)=>r===R||r===f?n$5("div",{key:r,class:e?c?_.univariateAboveAndBelowLabel:_.rampLabel:null},e):null)),S={display:"table-cell",verticalAlign:"middle"},j={marginTop:`${v$1}px`},I={height:`${p}px`},k={height:`${d$1}px`};return n$5("div",{key:"univariate-above-and-below-ramp-preview",styles:L$1},n$5("div",{class:_.layerBody},a.infos.map(((e,r)=>n$5("div",{class:this.classes(_.layerRow,_.sizeRamp)},n$5("div",{class:_.symbol,styles:S,bind:e.preview,afterCreate:t}),c||r%2!=0?null:n$5("div",{class:_.layerInfo},b[r]))))),c?n$5("div",{styles:j,key:"color-ramp-preview"},n$5("div",{styles:w},n$5("div",{styles:C},n$5("div",{class:_.rampContainer,bind:c,afterCreate:t})),n$5("div",{styles:C},n$5("div",{class:_.rampLabelsContainer,styles:I},u))),n$5("div",{styles:w},n$5("div",{styles:C},n$5("div",{class:_.rampContainer,bind:g,afterCreate:t})),n$5("div",{styles:C},n$5("div",{class:_.rampLabelsContainer,styles:k},A)))):null)}_renderUnivariateColorSizeRamp(e,r,l){const{sizeRampElement:a,colorRampElement:s}=g$1(e),i=u$1(a),d=12,y$1=y(a,"full",!1),c=v(s,{width:d,height:y$1,rampAlignment:"vertical",opacity:r,type:"full",effect:l}),g=a.infos.length-1,v$1=a.infos.map(((e,r)=>0===r||r===g?n$5("div",{key:r,class:e.label?s?_.univariateAboveAndBelowLabel:_.rampLabel:null},e.label):null)),b={display:"table-cell",verticalAlign:"middle"},u={marginTop:`${i}px`},f={height:`${y$1}px`};return n$5("div",{key:"univariate-above-and-below-ramp-preview",styles:L$1},n$5("div",{class:_.layerBody},a.infos.map((e=>n$5("div",{class:this.classes(_.layerRow,_.sizeRamp)},n$5("div",{class:_.symbol,styles:b,bind:e.preview,afterCreate:t}))))),n$5("div",{styles:u,key:"color-ramp-preview"},n$5("div",{styles:w},n$5("div",{styles:C},n$5("div",{class:_.rampContainer,bind:c,afterCreate:t})),n$5("div",{styles:C},n$5("div",{class:_.rampLabelsContainer,styles:f},v$1)))))}_renderLegendForRamp(e,r){const l=e.infos,a="opacity-ramp"===e.type,s="heatmap-ramp"===e.type,i="stretch-ramp"===e.type,t$1=e.preview,n=a?_.opacityRamp:"";t$1.className=`${_.colorRamp} ${n}`,null!=r&&(t$1.style.opacity=r.toString());const o=l.map((e=>n$5("div",{class:e.label?_.rampLabel:null},s?this.messages[e.label]:i?this._getStretchStopLabel(e):e.label))),p={width:`${f$1}px`},d={height:t$1.style.height};return n$5("div",{class:_.layerRow},n$5("div",{class:_.symbolContainer,styles:p},n$5("div",{class:_.rampContainer,bind:t$1,afterCreate:t})),n$5("div",{class:_.layerInfo},n$5("div",{class:_.rampLabelsContainer,styles:d},o)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:m$3(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"})):""}_renderLegendForElementInfo(e,r$1,l,a,s){if(e.type)return this._renderLegendForElement(e,r$1,l,!0);let i$1=null;const t$1=i(r$1,s);if(e.preview?i$1=n$5("div",{class:_.symbol,bind:e.preview,afterCreate:t}):e.src&&(i$1=this._renderImage(e,r$1,t$1)),!i$1)return null;const n={[_.imageryLayerInfoStretched]:t$1},o={[_.imageryLayerInfoStretched]:t$1,[_.sizeRamp]:!t$1&&a};return n$5("div",{class:_.layerRow},n$5("div",{class:this.classes(_.symbolContainer,o)},i$1),n$5("div",{class:this.classes(_.layerInfo,n)},r(this.messages,e.label,!1)||""))}_renderImage(e,r$1,l){const{label:a,src:s,opacity:i}=e,t={[_.imageryLayerStretchedImage]:l,[_.symbol]:!l},n={opacity:`${null!=i?i:r$1.opacity}`};return n$5("img",{alt:r(this.messages,a,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(t),styles:n})}};e$4([d$3()],R.prototype,"activeLayerInfos",void 0),e$4([d$3()],R.prototype,"headingLevel",void 0),e$4([d$3(),e$5("esri/widgets/Legend/t9n/Legend")],R.prototype,"messages",void 0),e$4([d$3({readOnly:!0})],R.prototype,"type",void 0),R=e$4([i$8("esri.widgets.Legend.styles.Classic")],R);const A=R;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const g={base:"esri-legend",widget:"esri-widget",panel:"esri-widget--panel",widgetIcon:"esri-icon-layer-list"};let f=class extends z$3{constructor(e,t){super(e,t),this._handles=new u$8,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.headingLevel=3,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=g.widgetIcon,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new A,this.view=null,this.viewModel=new I$1;}initialize(){this.own($$1(this,"view","resize",(()=>this.scheduleRender())),$$1(this,"activeLayerInfos","change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),f$7(this,"headingLevel",(e=>{const{style:s}=this;s&&(s.headingLevel=e);})),i$6(this,"style",((e,s)=>{s&&e!==s&&s.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel);})));}destroy(){this._handles.destroy(),this._handles=null;}castStyle(e){if(e instanceof A$1||e instanceof A)return e;if("string"==typeof e)return "card"===e?new A$1:new A;if(e&&"string"==typeof e.type){const s={...e};delete s.type;return new("card"===e.type?A$1:A)(s)}return new A}render(){return n$5("div",{class:this.classes(g.base,g.widget,this.style instanceof A?g.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender();}_renderOnActiveLayerInfoChange(e){const s=i$6(e,"version",(()=>this.scheduleRender()));this._handles.add(s,`version_${e.layer.uid}`);const i=$$1(e,"children","change",(()=>{e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)));}));this._handles.add(i,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)));}};e$4([o$5("viewModel.activeLayerInfos")],f.prototype,"activeLayerInfos",void 0),e$4([o$5("viewModel.basemapLegendVisible")],f.prototype,"basemapLegendVisible",void 0),e$4([o$5("viewModel.groundLegendVisible")],f.prototype,"groundLegendVisible",void 0),e$4([d$3()],f.prototype,"headingLevel",void 0),e$4([o$5("viewModel.hideLayersNotInCurrentView")],f.prototype,"hideLayersNotInCurrentView",void 0),e$4([o$5("viewModel.keepCacheOnDestroy")],f.prototype,"keepCacheOnDestroy",void 0),e$4([o$5("viewModel.respectLayerVisibility")],f.prototype,"respectLayerVisibility",void 0),e$4([d$3()],f.prototype,"iconClass",void 0),e$4([d$3({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],f.prototype,"label",void 0),e$4([o$5("viewModel.layerInfos")],f.prototype,"layerInfos",void 0),e$4([d$3(),e$5("esri/widgets/Legend/t9n/Legend")],f.prototype,"messages",void 0),e$4([d$3()],f.prototype,"style",void 0),e$4([c$5("style")],f.prototype,"castStyle",null),e$4([o$5("viewModel.view")],f.prototype,"view",void 0),e$4([d$3()],f.prototype,"viewModel",void 0),f=e$4([i$8("esri.widgets.Legend")],f);const L=f;

const arcgisLegendCss = "@import url('https://js.arcgis.com/next/esri/themes/light/main.css');";

let ArcGISLegend = class {
  constructor(hostRef) {
    registerInstance(this, hostRef);
    this.position = 'bottom-left';
  }
  validateView(value) {
    if (value) {
      this.widget.view = value;
      if (this.el.parentElement.tagName.toLowerCase() !== 'arcgis-expand') {
        this.widget.view.ui.add(this.widget, this.position);
      }
    }
  }
  componentWillLoad() {
    const legend = new L({
      container: this.el
    });
    if (this.view) {
      legend.view = this.view;
    }
    this.widget = legend;
  }
  render() {
    return (h$5("div", { class: "legend-container" }));
  }
  get el() { return getElement(this); }
  static get watchers() { return {
    "view": ["validateView"]
  }; }
};
ArcGISLegend.style = arcgisLegendCss;

export { ArcGISLegend as arcgis_legend };
