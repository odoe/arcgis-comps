import{gx as r}from"./p-c8bc3433.js";var e={};e.defaultNoDataValue=r(-1/0),e.decode=function(f,l){var o=(l=l||{}).encodedMaskData||null===l.encodedMaskData,u=i(f,l.inputOffset||0,o),s=null!=l.noDataValue?r(l.noDataValue):e.defaultNoDataValue,w=a(u,l.pixelType||Float32Array,l.encodedMaskData,s,l.returnMask),v={width:u.width,height:u.height,pixelData:w.resultPixels,minValue:u.pixels.minValue,maxValue:u.pixels.maxValue,noDataValue:s};return w.resultMask&&(v.maskData=w.resultMask),l.returnEncodedMask&&u.mask&&(v.encodedMaskData=u.mask.bitset?u.mask.bitset:null),l.returnFileInfo&&(v.fileInfo=n(u,s),l.computeUsedBitDepths&&(v.fileInfo.bitDepths=t(u))),v};var a=function(r,e,a,n,t){var i,l,o=0,u=r.pixels.numBlocksX,s=r.pixels.numBlocksY,w=Math.floor(r.width/u),v=Math.floor(r.height/s),h=2*r.maxZError;a=a||(r.mask?r.mask.bitset:null),i=new e(r.width*r.height),t&&a&&(l=new Uint8Array(r.width*r.height));for(var c,m,y=new Float32Array(w*v),d=0;d<=s;d++){var A=d!==s?v:r.height%s;if(0!==A)for(var M=0;M<=u;M++){var V=M!==u?w:r.width%u;if(0!==V){var k,p,x,g,U=d*r.width*v+M*w,B=r.width-V,D=r.pixels.blocks[o];if(D.encoding<2?(0===D.encoding?k=D.rawData:(f(D.stuffedData,D.bitsPerPixel,D.numValidPixels,D.offset,h,y,r.pixels.maxValue),k=y),p=0):x=2===D.encoding?0:D.offset,a)for(m=0;m<A;m++){for(7&U&&(g=a[U>>3],g<<=7&U),c=0;c<V;c++)7&U||(g=a[U>>3]),128&g?(l&&(l[U]=1),i[U++]=D.encoding<2?k[p++]:x):(l&&(l[U]=0),i[U++]=n),g<<=1;U+=B}else if(D.encoding<2)for(m=0;m<A;m++){for(c=0;c<V;c++)i[U++]=k[p++];U+=B}else for(m=0;m<A;m++)if(i.fill)i.fill(x,U,U+V),U+=V+B;else{for(c=0;c<V;c++)i[U++]=x;U+=B}if(1===D.encoding&&p!==D.numValidPixels)throw"Block and Mask do not match";o++}}}return{resultPixels:i,resultMask:l}},n=function(r,e){return{fileIdentifierString:r.fileIdentifierString,fileVersion:r.fileVersion,imageType:r.imageType,height:r.height,width:r.width,maxZError:r.maxZError,eofOffset:r.eofOffset,mask:r.mask?{numBlocksX:r.mask.numBlocksX,numBlocksY:r.mask.numBlocksY,numBytes:r.mask.numBytes,maxValue:r.mask.maxValue}:null,pixels:{numBlocksX:r.pixels.numBlocksX,numBlocksY:r.pixels.numBlocksY,numBytes:r.pixels.numBytes,maxValue:r.pixels.maxValue,minValue:r.pixels.minValue,noDataValue:e}}},t=function(r){for(var e=r.pixels.numBlocksX*r.pixels.numBlocksY,a={},n=0;n<e;n++){var t=r.pixels.blocks[n];0===t.encoding?a.float32=!0:1===t.encoding?a[t.bitsPerPixel]=!0:a[0]=!0}return Object.keys(a)},i=function(r,e,a){var n={},t=new Uint8Array(r,e,10);if(n.fileIdentifierString=String.fromCharCode.apply(null,t),"CntZImage"!=n.fileIdentifierString.trim())throw"Unexpected file identifier string: "+n.fileIdentifierString;e+=10;var i=new DataView(r,e,24);if(n.fileVersion=i.getInt32(0,!0),n.imageType=i.getInt32(4,!0),n.height=i.getUint32(8,!0),n.width=i.getUint32(12,!0),n.maxZError=i.getFloat64(16,!0),e+=24,!a)if(i=new DataView(r,e,16),n.mask={},n.mask.numBlocksY=i.getUint32(0,!0),n.mask.numBlocksX=i.getUint32(4,!0),n.mask.numBytes=i.getUint32(8,!0),n.mask.maxValue=i.getFloat32(12,!0),e+=16,n.mask.numBytes>0){var f=new Uint8Array(Math.ceil(n.width*n.height/8)),l=(i=new DataView(r,e,n.mask.numBytes)).getInt16(0,!0),o=2,u=0;do{if(l>0)for(;l--;)f[u++]=i.getUint8(o++);else{var s=i.getUint8(o++);for(l=-l;l--;)f[u++]=s}l=i.getInt16(o,!0),o+=2}while(o<n.mask.numBytes);if(-32768!==l||u<f.length)throw"Unexpected end of mask RLE encoding";n.mask.bitset=f,e+=n.mask.numBytes}else 0==(n.mask.numBytes|n.mask.numBlocksY|n.mask.maxValue)&&(f=new Uint8Array(Math.ceil(n.width*n.height/8)),n.mask.bitset=f);i=new DataView(r,e,16),n.pixels={},n.pixels.numBlocksY=i.getUint32(0,!0),n.pixels.numBlocksX=i.getUint32(4,!0),n.pixels.numBytes=i.getUint32(8,!0),n.pixels.maxValue=i.getFloat32(12,!0),e+=16;var w=n.pixels.numBlocksX,v=n.pixels.numBlocksY,h=w+(n.width%w>0?1:0),c=v+(n.height%v>0?1:0);n.pixels.blocks=new Array(h*c);for(var m=1e9,y=0,d=0;d<c;d++)for(var A=0;A<h;A++){var M=0;i=new DataView(r,e,Math.min(10,r.byteLength-e));var V={};n.pixels.blocks[y++]=V;var k=i.getUint8(0);if(M++,V.encoding=63&k,V.encoding>3)throw"Invalid block encoding ("+V.encoding+")";if(2!==V.encoding){if(0!==k&&2!==k){if(V.offsetType=k>>=6,2===k)V.offset=i.getInt8(1),M++;else if(1===k)V.offset=i.getInt16(1,!0),M+=2;else{if(0!==k)throw"Invalid block offset type";V.offset=i.getFloat32(1,!0),M+=4}if(m=Math.min(V.offset,m),1===V.encoding)if(k=i.getUint8(M),M++,V.bitsPerPixel=63&k,V.numValidPixelsType=k>>=6,2===k)V.numValidPixels=i.getUint8(M),M++;else if(1===k)V.numValidPixels=i.getUint16(M,!0),M+=2;else{if(0!==k)throw"Invalid valid pixel count type";V.numValidPixels=i.getUint32(M,!0),M+=4}}var p;if(e+=M,3!=V.encoding)if(0===V.encoding){var x=(n.pixels.numBytes-1)/4;if(x!==Math.floor(x))throw"uncompressed block has invalid length";p=new ArrayBuffer(4*x),new Uint8Array(p).set(new Uint8Array(r,e,4*x));for(var g=new Float32Array(p),U=0;U<g.length;U++)m=Math.min(m,g[U]);V.rawData=g,e+=4*x}else if(1===V.encoding){var B=Math.ceil(V.numValidPixels*V.bitsPerPixel/8),D=Math.ceil(B/4);p=new ArrayBuffer(4*D),new Uint8Array(p).set(new Uint8Array(r,e,B)),V.stuffedData=new Uint32Array(p),e+=B}}else e++,m=Math.min(m,0)}return n.pixels.minValue=m,n.eofOffset=e,n},f=function(r,e,a,n,t,i,f){var l,o,u,s=(1<<e)-1,w=0,v=0,h=Math.ceil((f-n)/t),c=4*r.length-Math.ceil(e*a/8);for(r[r.length-1]<<=8*c,l=0;l<a;l++){if(0===v&&(u=r[w++],v=32),v>=e)o=u>>>v-e&s,v-=e;else{var m=e-v;o=(u&s)<<m&s,o+=(u=r[w++])>>>(v=32-m)}i[l]=o<h?n+o*t:f}return i};const l=e.decode;export{l as r}