import{C as t}from"./p-a989744e.js";import{E as e}from"./p-a6945989.js";import{M as n}from"./p-be58da65.js";import{a as r,t as a}from"./p-b7c042b3.js";import{a7 as s,bA as i,bX as l,bF as o,bx as c,bG as u,ao as m,aI as f,bB as y,bC as b}from"./p-c8bc3433.js";const p={marker:e.MARKER,fill:e.FILL,line:e.LINE,text:e.TEXT};class h{constructor(t,e,r,a){const s={minScale:null==e?void 0:e.minScale,maxScale:null==e?void 0:e.maxScale},i=function(t){return t.minScale||t.maxScale?t.minScale+"-"+t.maxScale:""}(s);this.layers=t,this.data=e,this.hash=this._createHash()+i,this.rendererKey=r;for(const e of t)e.materialKey=n(p[e.type],this.rendererKey),e.maxVVSize=a,e.scaleInfo=s,e.templateHash+=i}get type(){return"expanded-cim"}_createHash(){let t="";for(const e of this.layers)t+=e.templateHash;return t}}async function d(t,e,n){if(!t.name)return Promise.reject(new s("style-symbol-reference-name-missing","Missing name in style symbol reference"));if(t.styleName&&"Esri2DPointSymbolsStyle"===t.styleName)return async function(t,e){const n=o.replace(/\{SymbolName\}/gi,t.name);try{const t=await c(n,e);return u(t.data)}catch(t){return l(t),null}}(t,n);try{return w(await i(t,e,n),t.name,e,n)}catch(t){return l(t),null}}async function w(t,e,n,i){const o=t.data,p={portal:n&&n.portal||m.getDefault(),url:f(t.baseUrl),origin:"portal-item"},h=o.items.find((t=>t.name===e));if(!h)throw new s("symbolstyleutils:symbol-name-not-found",`The symbol name '${e}' could not be found`,{symbolName:e});let d=y(b(h,"cimRef"),p);r()&&(d=a(d));try{const t=await c(d,i);return u(t.data)}catch(t){return l(t),null}}const x=async(e,n,r)=>new h(await t(e.data,n,r),e.data,e.rendererKey,e.maxVVSize),S=async(t,e,n,r)=>{if(!t)return null;if("cim"===t.type)return x(t,e,n);if("web-style"===t.type){const a={type:"cim",data:await d(t,null,r),rendererKey:t.rendererKey,maxVVSize:t.maxVVSize};return x(a,e,n)}return t};function g(t){if(!t)return null;const{type:e,cim:n,url:r,materialHash:a}=t,s={cim:n,type:e,mosaicHash:a,url:r,size:null,dashTemplate:null,path:null,text:null,fontName:null};switch(e){case"marker":s.size=t.size,s.path=t.path;break;case"line":s.dashTemplate=t.dashTemplate;break;case"text":s.text=t.text,s.fontName=t.fontName}return s}export{g as i,S as l}