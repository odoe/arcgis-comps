import{A as t,af as s}from"./p-e58503d5.js";import{n as i,r as e,c as h}from"./p-ccdb8e80.js";import{e as r}from"./p-2c84c65f.js";import{o,E as n,B as a}from"./p-2f398ed1.js";import{f as l,n as c}from"./p-d3105731.js";import{r as p,n as u,t as d}from"./p-09dd2137.js";import{T as f}from"./p-728dcbb0.js";import{n as m,au as g,aw as y}from"./p-340cd100.js";class w{constructor(t){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=t,this.view.watch("ready",(t=>{this._resourcesCreated&&(t?this._createResources():this._destroyResources())}))}applyProps(t){let s=!1;for(const i in t)i in this?"attached"===i?s=t[i]:this[i]=t[i]:console.error("Cannot set unknown property",i);this.attached=s}destroy(){this.attached=!1}get attached(){return this._attached}set attached(t){t!==this._attached&&this.view._stage&&(this._attached=t,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.attached&&this.updateVisibility(t))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}class b extends w{constructor(t){super(t.view),this._resources=null,this._transform=r()}get object(){return t(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(s){i(this._transform,s),t(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(s(this._resources))return;const t=this._resources.object,i=this.view._stage;i.removeMany(t.geometries),t.removeAllGeometries(),this.createGeometries(t),this.visible||t.setVisible(this.visible),i.addMany(t.geometries)}createResources(){this.destroyResources();const t=this.view._stage;if(!t)return;const s=new m({isPickable:!1,updatePolicy:1});t.add(s);const i=new f({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),t.addMany(i.geometries),this.forEachExternalMaterial((s=>t.add(s))),t.add(i),s.add(i),this.visible||i.setVisible(!1),this._resources={layer:s,object:i}}destroyResources(){const t=this.view._stage;!s(this._resources)&&t&&(t.remove(this._resources.object),t.remove(this._resources.layer),this.forEachExternalMaterial((s=>{t.remove(s),s.dispose()})),t.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(t){s(this._resources)||this._resources.object.setVisible(t)}}class j extends b{constructor(t){super(t),this._renderOccluded=4,this._width=1,this._color=p(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stippleIntegerRepeats=!1,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(t)}setGeometryFromRenderSpacePoint(t){const s=1e3,i=[];i.push([[t[0]-s,t[1]+0,t[2]+0],[t[0]+s,t[1]+0,t[2]+0]]),i.push([[t[0]-0,t[1]-s,t[2]+0],[t[0]+0,t[1]+s,t[2]+0]]),i.push([[t[0]-0,t[1]+0,t[2]-s],[t[0]+0,t[1]+0,t[2]+s]]),this.geometry=i}setGeometryFromExtent(t){const s=this.view.spatialReference,i=c(),e=c(),h=100,r=[];o(i,t[0],t[1],h),this.view.renderCoordsHelper.toRenderCoords(i,s,e),r.push([e[0],e[1],e[2]]),o(i,t[2],t[1],h),this.view.renderCoordsHelper.toRenderCoords(i,s,e),r.push([e[0],e[1],e[2]]),o(i,t[2],t[3],h),this.view.renderCoordsHelper.toRenderCoords(i,s,e),r.push([e[0],e[1],e[2]]),o(i,t[0],t[3],h),this.view.renderCoordsHelper.toRenderCoords(i,s,e),r.push([e[0],e[1],e[2]]),o(i,t[0],t[1],h),this.view.renderCoordsHelper.toRenderCoords(i,s,e),r.push([e[0],e[1],e[2]]),o(i,t[0],t[1],h),this.view.renderCoordsHelper.toRenderCoords(i,s,e),r.push([e[0],e[1],e[2]]),this.geometry=[r]}setGeometryFromFrustum(t){const s=[];t.lines.forEach((t=>{s.push([t.origin[0],t.origin[1],t.origin[2]]),s.push([t.endpoint[0],t.endpoint[1],t.endpoint[2]])})),this.geometry=[s]}setGeometryFromBoundedPlane(t){const s=[],i=t.origin,e=t.basis1,h=t.basis2,r=.5,o=c(),n=c(),a=c(),l=c();o[0]=i[0]-e[0]*r-h[0]*r,o[1]=i[1]-e[1]*r-h[1]*r,o[2]=i[2]-e[2]*r-h[2]*r,n[0]=i[0]-e[0]*r+h[0]*r,n[1]=i[1]-e[1]*r+h[1]*r,n[2]=i[2]-e[2]*r+h[2]*r,a[0]=i[0]+e[0]*r+h[0]*r,a[1]=i[1]+e[1]*r+h[1]*r,a[2]=i[2]+e[2]*r+h[2]*r,l[0]=i[0]+e[0]*r-h[0]*r,l[1]=i[1]+e[1]*r-h[1]*r,l[2]=i[2]+e[2]*r-h[2]*r,s.push([o[0],o[1],o[2]]),s.push([n[0],n[1],n[2]]),s.push([a[0],a[1],a[2]]),s.push([l[0],l[1],l[2]]),s.push([o[0],o[1],o[2]]),this.geometry=[s]}setGeometryFromSegment(t){const s=t.endRenderSpace;e(R),h(R,R,s),this.transform=R;const{points:i}=t.createRenderGeometry(s,this.view.renderCoordsHelper);this.geometry=[i]}setGeometryFromSegments(t,s=l){e(R),h(R,R,s),this.transform=R,this.geometry=t.map((t=>t.createRenderGeometry(s,this.view.renderCoordsHelper).points))}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this._updateMaterial())}get color(){return this._color}set color(t){n(t,this._color)||(a(this._color,t),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(t){t!==this._innerWidth&&(this._innerWidth=t,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(i){t(i)?!s(this._innerColor)&&n(i,this._innerColor)||(this._innerColor=a(u(),i),this._updateMaterial()):t(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(s){const i=t(s)!==t(this._stipplePattern);this._stipplePattern=s,i?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(i){(s(i)||s(this._stippleOffColor)||!n(i,this._stippleOffColor))&&(this._stippleOffColor=t(i)?d(i):null,this._updateMaterial())}get stippleIntegerRepeats(){return this._stippleIntegerRepeats}set stippleIntegerRepeats(t){this._stippleIntegerRepeats!==t&&(this._stippleIntegerRepeats=t,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(t){this._writeDepthEnabled!==t&&(this._writeDepthEnabled=t,this._updateMaterial())}get falloff(){return this._falloff}set falloff(t){t!==this._falloff&&(this._falloff=t,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){t!==this._polygonOffset&&(this._polygonOffset=t,this._updateMaterial())}createExternalResources(){this._material=new g(this.materialParameters)}destroyExternalResources(){this._material=null}createGeometries(t){const s=this._createLineGeometries();if(0!==s.length)for(let i=0;i<s.length;++i){const e=y(s[i]);t.addGeometry(e,this._material)}}forEachExternalMaterial(t){t(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,stippleIntegerRepeats:this._stippleIntegerRepeats,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameters(this.materialParameters)}_createLineGeometries(){const t=this.geometry;if(s(t)||0===t.length)return[];const i=[];return t.forEach((t=>{const s=new Float64Array(3*t.length);t.forEach(((t,i)=>{s[3*i+0]=t[0],s[3*i+1]=t[1],s[3*i+2]=t[2]})),i.push({attributeData:{position:s},removeDuplicateStartEnd:0})})),i}}const R=r();export{b as c,j as m,w as t}