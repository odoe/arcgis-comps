import{bk as e,u as t,ea as n,bh as i,w as r,T as s,eJ as a,e as l,d as o,bK as u,i as c,aS as f,eR as d,l as p,bs as m,t as y,eS as b,b as g,a$ as h,r as v,eT as x,eK as w,cs as S}from"./p-5420851c.js";import{A as M,E as V,V as F}from"./p-54db165f.js";import{L as z,M as I}from"./p-13d3a443.js";import{o as T}from"./p-6189adb6.js";import{n as E,A as k,f as _,h as R,E as $,t as K}from"./p-ba8c567b.js";import{b as O,s as D,k as P}from"./p-47e1bd73.js";import{l as C}from"./p-7e5e535f.js";import{x as j}from"./p-e991a11e.js";const G=512,N=50;function L(e,i){if(!i.isWrappable)return null;const[r,s]=n(i);return e[2]>s?[t([e[0],e[1],s,e[3]]),t([r,e[1],r+e[2]-s,e[3]])]:e[0]<r?[t([r,e[1],e[2],e[3]]),t([s-(r-e[0]),e[1],s,e[3]])]:null}function B(e){return"text"===e||"esriTS"===e}function A(e){return"simple-marker"===e||"picture-marker"===e||"esriSMS"===e||"esriPMS"===e}function U(e){switch(r(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}function q(t){if(!t)return null;const{xmin:n,ymin:i,xmax:r,ymax:s,spatialReference:a}=t;return new e({rings:[[[n,i],[n,s],[r,s],[r,i],[n,i]]],spatialReference:a})}const J={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1};function W(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;const t=e.getVisualVariablesForType("size");if(!t[0])return 0;const n=t[0];if("outline"===n.target)return 0;if("stops"===n.transformationType)return n.stops.map((e=>e.size)).reduce(ne,0);if("clamped-linear"===n.transformationType){let e=-1/0,t=-1/0;return e="number"==typeof n.maxSize?n.maxSize:n.maxSize.stops.map((e=>e.size)).reduce(ne,0),t="number"==typeof n.minSize?n.minSize:n.minSize.stops.map((e=>e.size)).reduce(ne,0),Math.max(e,t)}return"real-world-size"===n.transformationType?30:void 0}async function H(e,t,n,r,s,a){if(!e||a&&"cluster"===a.type)return 0;if("heatmap"===e.type)return Math.round(3*e.blurRadius);if("dot-density"===e.type)return 0;if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?100:200;const l=e.getSymbols(),o=W(e),u=[];for(const e of l)u.push(ee(e,o,n,t,r,s));const c=await Promise.all(u);return i(c.reduce(ne,0))}const Q=[0,0,0,0];function X(e,t){return null==e?t:e}const Y={sdf:!0,code:99,metrics:P.metrics,rect:new K(0,0,24,24),page:0,textureBinding:2};async function Z(e,t,n,r,s,a){if("simple-marker"===e.type){const n=Math.max(X(e.size,12),t);return te(e)+.707*n}if("picture-marker"===e.type){const n=Math.max(X(e.height,12),t),i=X(e.width,12)*(n/X(e.height,12))/2,r=n/2;return te(e)+Math.sqrt(i*i+r*r)}if("text"===e.type){const t=function(e){const t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[Y]};const n=[];for(let i=0;i<t;i++)n.push({...Y,code:e.text.charCodeAt(i)});return{glyphMosaicItems:n}}(e);!function(e,t,n){var r,s,a;if(!n||0===n.glyphMosaicItems.length)return e;const l=E(t.text)[1],o=k(n.glyphMosaicItems,l,{scale:i(t.font.size)/O,angle:null!=(r=t.angle)?r:0,xOffset:null!=(s=t.xoffset)?s:0,yOffset:null!=(a=t.yoffset)?a:0,hAlign:_(t.horizontalAlignment||"center"),vAlign:R(t.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(t.lineWidth||512,512)),lineHeight:D*Math.max(.25,Math.min(t.lineHeight||1,4)),decoration:t.font.decoration||"none",isCIM:!1}).bounds;e[0]=i(o.x-o.halfWidth),e[1]=i(o.y-o.halfHeight),e[2]=i(o.width),e[3]=i(o.height)}(Q,e.toJSON(),t);const n=Math.abs(Q[0]),r=Math.abs(Q[1]),s=Q[2],a=Q[3];return Math.max(n,r)+Math.max(s,a)}if("simple-line"===e.type){const n=e,i=Math.max(X(n.width,.75),t)/2;return n.marker?Math.max(6*n.width,2*t):i}if("simple-fill"===e.type||"picture-fill"===e.type)return Math.max(function(e){return null==e.outline?0:X(e.outline.width,0)}(e),t)/2;if("cim"===e.type){const i={geometryType:r,fields:s,spatialReference:a},l={type:"cim",rendererKey:0,data:e.data,maxVVSize:t};await C(l,i,n);const o=$.getEnvelope(e.data,n);return o?Math.sqrt(o.width*o.width+o.height*o.height):0}return"web-style"===e.type?Z(await e.fetchCIMSymbol(),t,n,r,s,a):0}async function ee(e,t,n,i,r,s){return function(e){return e.type in J}(e)?Math.min(await Z(e,t,n,i,r,s),75):0}function te(e){const t=X(e.xoffset,0),n=X(e.yoffset,0);return Math.sqrt(t*t+n*n)}function ne(e,t){return Math.max(e,t)}const ie=s.getLogger("esri.renderers.visualVariables.support.utils"),re=e=>{if(!("visualVariables"in e)||!e.visualVariables||!e.visualVariables.length)return e;const t=e.clone(),n=t.visualVariables.map((e=>ae(e)?le(e):e));return t.visualVariables=n,t};function se(e){return e.map((e=>ae(e)?le(e.clone()):e))}function ae(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}function le(e){return e.stops=function(e,t){return t.length<=8?t:(ie.warn(`Found ${t.length} Visual Variable stops, but MapView only supports 8. Displayed stops will be simplified.`),t.length>16?function(e,t){const[n,...i]=t,r=i.pop(),s=i[0].value,l=i[i.length-1].value,o=(l-s)/6,u=[];for(let n=s;n<l;n+=o){let r=0;for(;n>=i[r].value;)r++;const s=i[r],l=t[r-1],o=n-l.value,c=s.value===l.value?1:o/(s.value-l.value);if("color"===e){const e=i[r],s=t[r-1],a=e.color.clone();a.r=oe(s.color.r,a.r,c),a.g=oe(s.color.g,a.g,c),a.b=oe(s.color.b,a.b,c),a.a=oe(s.color.a,a.a,c),u.push({value:n,color:a,label:e.label})}else if("size"===e){const e=i[r],s=t[r-1],l=a(e.size),o=oe(a(s.size),l,c);u.push({value:n,size:o,label:e.label})}else{const e=i[r],s=oe(t[r-1].opacity,e.opacity,c);u.push({value:n,opacity:s,label:e.label})}}return[n,...u,r]}(e,t):function(e){const[t,...n]=e,i=n.pop();for(;n.length>6;){let e=0,t=0;for(let i=1;i<n.length;i++){const r=Math.abs(n[i].value-n[i-1].value);r>t&&(t=r,e=i)}n.splice(e,1)}return[t,...n,i]}(t))}(e.type,e.stops),e}function oe(e,t,n){return(1-n)*e+n*t}var ue;let ce=ue=class extends f{writeLevels(e,t,n){for(const n in e)return void(t.stops=this.levels[n])}clone(){return new ue({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:d(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:d(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map((e=>e.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:p(this.levels)})}};l([o()],ce.prototype,"levels",void 0),l([u("levels")],ce.prototype,"writeLevels",null),ce=ue=l([c("esri.views.2d.engine.LevelDependentSizeVariable")],ce);const fe=s.getLogger("esri.views.2d.layers.support.clusterUtils");m.add("esri-cluster-arcade-enabled",!0);const de=m("esri-cluster-arcade-enabled"),pe=(e,t,n,i)=>{const r=t.clone();if(!ge(r))return r;if(n.fields)for(const t of n.fields)he(e,t);if("visualVariables"in r){const t=(r.visualVariables||[]).filter((e=>"$view.scale"!==e.valueExpression)),s=me(t);t.forEach((t=>{"rotation"===t.type?t.field?t.field=xe(e,t.field,"avg_angle"):t.valueExpression&&(t.field=ve(e,t.valueExpression,"avg_angle"),t.valueExpression=null):t.normalizationField?(t.field=xe(e,t.field,"norm",t.normalizationField),t.normalizationField=null):t.field?t.field=xe(e,t.field,"avg"):(t.field=ve(e,t.valueExpression,"avg"),t.valueExpression=null)})),y(s)&&!ye(t)&&(t.push(be(n,i)),r.dynamicClusterSize=!0),r.visualVariables=t}switch(r.type){case"simple":break;case"unique-value":r.field?r.field=xe(e,r.field,"mode"):r.valueExpression&&(r.field=ve(e,r.valueExpression,"mode"),r.valueExpression=null);break;case"class-breaks":r.normalizationField?(r.field=xe(e,r.field,"norm",r.normalizationField),r.normalizationField=null):r.field?r.field=xe(e,r.field,"avg"):(r.field=ve(e,r.valueExpression,"avg"),r.valueExpression=null)}return r},me=e=>{for(const t of e)if("size"===t.type)return t;return null},ye=e=>{for(const t of e)if("cluster_count"===t.field)return!0;return!1},be=(e,t)=>{const n=[new b({value:0,size:0}),new b({value:1})];if(y(t))return new f({field:"cluster_count",stops:[...n,new b({value:2,size:0})]});const i=Object.keys(t).reduce(((i,r)=>({...i,[r]:[...n,new b({value:Math.max(2,t[r].minValue),size:e.clusterMinSize}),new b({value:Math.max(3,t[r].maxValue),size:e.clusterMaxSize})]})),{});return new ce({field:"cluster_count",levels:i})},ge=e=>{const t=t=>fe.error(new g("Unsupported-renderer",t,{renderer:e}));if("unique-value"===e.type){if(e.field2||e.field3)return t("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1}else if("class-breaks"===e.type){if(e.normalizationField){const n=e.normalizationType;if("field"!==n)return t(`FeatureReductionCluster does not support a normalizationType of ${n}`),!1}}else if("simple"!==e.type)return t(`FeatureReductionCluster does not support renderers of type ${e.type}`),!1;if(!de){if("valueExpression"in e&&e.valueExpression)return t("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in e&&e.visualVariables||[]).some((e=>!(!("valueExpression"in e)||!e.valueExpression))))return t("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function he(e,t){const{name:n,outStatistic:i}=t,{onStatisticField:r,onStatisticValueExpression:s,statisticType:a}=i;if(s){const t=j(s.toLowerCase());e.push({name:n,outStatistic:{onStatisticField:t,onStatisticValueExpression:s,statisticType:a}})}else r?e.push({name:n,outStatistic:{onStatisticField:r,statisticType:a}}):fe.error(new g("mapview-unsupported-field","Unable to handle field",{field:t}))}function ve(e,t,n){const i=j(t),r="mode"===n?`cluster_type_${i}`:`cluster_avg_${i}`;return e.some((e=>e.name===r))||e.push({name:r,outStatistic:{onStatisticField:i,onStatisticValueExpression:t,statisticType:n}}),r}function xe(e,t,n,i){if("cluster_count"===t||e.some((e=>e.name===t)))return t;const r=function(e,t,n){switch(e){case"avg":case"avg_angle":return`cluster_avg_${t}`;case"mode":return`cluster_type_${t}`;case"norm":{const e=n,i="field",r=t.toLowerCase()+",norm:"+i+","+e.toLowerCase();return"cluster_avg_"+j(r)}}}(n,t,i);return e.some((e=>e.name===r))||e.push("norm"===n?{name:r,outStatistic:{onStatisticField:t,onStatisticNormalizationField:i,statisticType:n}}:{name:r,outStatistic:{onStatisticField:t,statisticType:n}}),r}const we=new h({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function Se(e){return we.toJSON(e)}const Me=s.getLogger("esri.views.2d.layers.features.schemaUtils"),Ve="ValidationError",Fe={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function ze(e){return z(e)}function Ie(e){var t;return"line-marker"===e.type?{type:"line-marker",color:null==(t=e.color)?void 0:t.toJSON(),placement:e.placement,style:e.style}:S(e.toJSON()).toJSON()}function Te(e){let t=0,n=0,i=!1,r=!1;if(v(e)&&(n=W(e),"visualVariables"in e&&(t=function(e){if(!e)return M.NONE;let t=0;for(const n of e)if("size"===n.type){const e=T(n);t|=e,"outline"===n.target&&(t|=e<<4)}else"color"===n.type?t|=M.COLOR:"opacity"===n.type?t|=M.OPACITY:"rotation"===n.type&&(t|=M.ROTATION);return t}(e.visualVariables||[]),i="dot-density"===e.type),!i)){const t=e.getSymbols();"backgroundFillSymbol"in e&&e.backgroundFillSymbol&&t.push(e.backgroundFillSymbol);for(const e of t)if(("simple-fill"===e.type||"picture-fill"===e.type)&&e.outline&&"none"!==e.outline.style){if("solid"!==e.outline.style){r=!1;break}r=!0}}return{vvFlags:t,maxVVSize:n,isDD:i,isOutlinedFill:r}}function Ee(e,t,n){return ke(e,Te(t),n)}function ke(e,t,n){if(!e)return null;switch(e.type){case"simple-fill":case"picture-fill":return function(e,t,n,i){const r=I(V.FILL,t,i),s=n?ze(r):r,a=e.clone(),l=a.outline;i.isOutlinedFill||(a.outline=null);const o={materialKey:s,hash:a.hash(),isOutlinedFill:!!i.isOutlinedFill,...Ie(a)};if(i.isOutlinedFill)return o;const u=[];if(u.push(o),l){const e=I(V.LINE,t,{isOutline:!0}),i={materialKey:n?ze(e):e,hash:l.hash(),...Ie(l)};u.push(i)}return{type:"composite-symbol",layers:u,hash:u.reduce(((e,t)=>t.hash+e),"")}}(e,t.vvFlags,n,{isDD:t.isDD,isOutlinedFill:t.isOutlinedFill});case"simple-marker":case"picture-marker":return function(e,t,n,i){const r=I(V.MARKER,t),s=i?ze(r):r,a=Ie(e);return{materialKey:s,hash:e.hash(),...a,angle:e.angle,maxVVSize:n}}(e,t.vvFlags,t.maxVVSize,n);case"simple-line":return function(e,t,n){const i=I(V.LINE,t),r=n?ze(i):i,s=e.clone(),a=s.marker;s.marker=null;const l=[];if(l.push({materialKey:r,hash:s.hash(),...Ie(s)}),a){var o;const e=I(V.MARKER,t),i=n?ze(e):e;a.color=null!=(o=a.color)?o:s.color,l.push({materialKey:i,hash:a.hash(),lineWidth:s.width,...Ie(a)})}return{type:"composite-symbol",layers:l,hash:l.reduce(((e,t)=>t.hash+e),"")}}(e,t.vvFlags,n);case"text":return function(e,t,n,i){const r=I(V.TEXT,t),s=i?ze(r):r,a=Ie(e);return{materialKey:s,hash:e.hash(),...a,angle:e.angle,maxVVSize:n}}(e,t.vvFlags,t.maxVVSize,n);case"label":return function(e,t,n){const i=e.toJSON(),r=I(V.LABEL,t,{placement:i.labelPlacement});return{materialKey:n?ze(r):r,hash:e.hash(),...i,labelPlacement:i.labelPlacement}}(e,t.vvFlags,n);case"cim":return{type:"cim",rendererKey:t.vvFlags,data:e.data,maxVVSize:t.maxVVSize};case"CIMSymbolReference":return{type:"cim",rendererKey:t.vvFlags,data:e,maxVVSize:t.maxVVSize};case"web-style":return{...Ie(e),type:"web-style",hash:e.hash(),rendererKey:t.vvFlags,maxVVSize:t.maxVVSize};default:throw new Error(`symbol not supported ${e.type}`)}}function _e(e,t){const n=p(e);return n.some((e=>function(e,t){const n=e.labelPlacement,i=Fe[t];if(!e.symbol)return Me.warn("No ILabelClass symbol specified."),!0;if(!i)return Me.error(new g("mapview-labeling:unsupported-geometry-type",`Unable to create labels for Feature Layer, ${t} is not supported`)),!0;if(!i.some((e=>e===n))){const r=i[0];n&&Me.warn(`Found invalid label placement type ${n} for ${t}. Defaulting to ${r}`),e.labelPlacement=r}return!1}(e,t)))?[]:n}function Re(e){return m("esri-2d-update-debug")&&console.debug("Created new schema",$e(e,!0)),$e(e)}function $e(e,t=!1){try{var n,r;const s=function(e,t=!1){const n=new Array;return n.push(Ge(e,t)),n}(e,t),a={};return s.map((t=>function(e,t,n){switch(n.target){case"feature":return void De(e,Oe(t),n);case"aggregate":{if(!("featureReduction"in t))return;const r=t.featureReduction;if("selection"===r.type)throw new g(Ve,"Mapview does not support `selection` reduction type",r);return De(e,Oe(t),n),void function(e,t,n){e.aggregate||(e.aggregate={name:"aggregate",input:"feature",filters:null,attributes:{},params:{clusterRadius:i(t.clusterRadius/2),clusterPixelBuffer:64*Math.ceil(i(t.clusterMaxSize)/64),fields:n.aggregateFields}}),Ke(e.aggregate,n.attributes.fields)}(e,r,n)}}}(a,e,t))),{source:{definitionExpression:e.definitionExpression,fields:e.fields.map((e=>e.toJSON())),gdbVersion:e.gdbVersion,historicMoment:null==(n=e.historicMoment)?void 0:n.getTime(),outFields:e.availableFields,pixelBuffer:e.pixelBuffer,spatialReference:e.spatialReference.toJSON(),timeExtent:null==(r=e.timeExtent)?void 0:r.toJSON(),customParameters:e.customParameters},attributes:{fields:{},indexCount:0},processors:s,targets:a}}catch(e){if(e.fieldName===Ve)return Me.error(e),null;throw e}}function Ke(e,t){for(const n in t){const i=t[n];if(i.target!==e.name)continue;const r=e.attributes[n];r?(r.context.mesh=r.context.mesh||i.context.mesh,r.context.storage=r.context.storage||i.context.storage):e.attributes[n]=i}return e}function Oe(e){var t,n,i,s,a;return[null!=(t=null==(n=r(e.filter))?void 0:n.toJSON())?t:null,null!=(i=null==(s=r(null==(a=r(e.featureEffect))?void 0:a.filter))?void 0:s.toJSON())?i:null]}function De(e,t,n){return e.feature||(e.feature={name:"feature",input:"source",filters:t,attributes:{}}),Ke(e.feature,n.attributes.fields),e}function Pe(e,t){return t.field?Ce(e,{...t,type:"field",field:t.field}):t.valueExpression?Ce(e,{...t,type:"expression",valueExpression:t.valueExpression}):{field:null,fieldIndex:null}}function Ce(e,t){switch(t.type){case"expression":{const n=t.valueExpression;if(!e.fields[n]){const i=e.indexCount++;e.fields[n]={...t,name:n,fieldIndex:i}}return{fieldIndex:e.fields[n].fieldIndex}}case"label-expression":{const n=JSON.stringify(t.label);if(!e.fields[n]){const i=e.indexCount++;e.fields[n]={...t,name:n,fieldIndex:i}}return{fieldIndex:e.fields[n].fieldIndex}}case"field":{const n=t.field;return"aggregate"===t.target&&e.fields[n]||(e.fields[n]={...t,name:n}),{field:n}}case"statistic":return e.fields[t.name]={...t},{field:t.name}}}function je(e,t,n,i,r,s=!1){const a=Ce(t,{type:"label-expression",target:i,context:{mesh:!0},resultType:"string",label:{labelExpression:n.labelExpression,labelExpressionInfo:n.labelExpressionInfo?{expression:n.labelExpressionInfo.expression}:null,symbol:!!n.symbol,where:n.where}}),{fieldIndex:l}=a;return{...Ee(n,e,s),fieldIndex:l,target:i,index:r}}function Ge(e,t,n=!1){const i={indexCount:0,fields:{}},r="featureReduction"in e&&e.featureReduction,s=r?"aggregate":"feature";if("sublayers"in e){const t={type:"subtype",subtypeField:e.subtypeField,renderers:{}},r={type:"subtype",mapping:{},target:"feature"},a={type:"subtype",classes:{}},l={type:"symbol",target:"feature",aggregateFields:[],attributes:i,storage:r,mesh:{matcher:t,aggregateMatcher:null,labels:a,sortKey:null}},o=new Set;let u=0;for(const{renderer:l,subtypeCode:c,labelingInfo:f,labelsVisible:d}of e.sublayers){const e=Be(i,s,l,n),p=Le(i,s,l),m=d&&f;if("visualVariables"in l&&l.visualVariables&&l.visualVariables.length)throw new g(Ve,"Visual variables are currently not supported for subtype layers");if("dictionary"===e.type)throw new g(Ve,"Dictionary renderer is not supported in subtype layers");if("subtype"===e.type)throw new g(Ve,"Nested subtype renderers is not supported");if(v(p)&&"subtype"===p.type)throw new g(Ve,"Nested subtype storage is not supported");if(v(p)&&"dot-density"===p.type)throw new g(Ve,"Dot density attributes are not supported in subtype layers");if(o.has(c))throw new g(Ve,"Subtype codes for sublayers must be unique");o.add(c),t.renderers[c]=e,r.mapping[c]=p,m&&(a.classes[c]=m.map((e=>je(l,i,e,"feature",u++,n))))}return l}if("heatmap"===e.renderer.type){const{blurRadius:t,fieldOffset:n,field:r}=e.renderer;return{type:"heatmap",aggregateFields:[],attributes:i,target:s,storage:null,mesh:{blurRadius:t,fieldOffset:n,field:Pe(i,{target:s,field:r,resultType:"numeric"}).field}}}{const t=[],a="aggregate"===s?pe(t,e.renderer,r,null):e.renderer;Ne(i,t);const l=Be(i,s,a,n);let o=null;const u=Le(i,s,a),c=Se(e.geometryType);let f=e.labelsVisible&&e.labelingInfo||[],d=[];if(r){if("selection"===r.type)throw new g(Ve,"Mapview does not support `selection` reduction type",r);if(r.symbol){const e=new x({symbol:r.symbol,visualVariables:"visualVariables"in a?a.visualVariables:null});o=Be(i,s,e,n)}d=r&&r.labelsVisible&&r.labelingInfo||[]}f=_e(f,c),d=_e(d,c);let p=0;const m=[...f.map((e=>je(a,i,e,"feature",p++,n))),...d.map((e=>je(a,i,e,"aggregate",p++,n)))],b=function(e,t){if(y(t)||!t.length)return null;t.length>1&&Me.warn(`Layer rendering currently only supports ordering by 1 orderByInfo, but found ${t.length}. All but the first will be discarded`);const n=t[0],i="ascending"===n.order?"asc":"desc";return n.field?{field:n.field,order:i}:n.valueExpression?{fieldIndex:Ce(e,{type:"expression",target:"feature",valueExpression:n.valueExpression,resultType:"numeric"}).fieldIndex,order:i}:(Me.error(new g(Ve,"Expected to find a field or valueExpression for OrderByInfo",n)),null)}(i,e.orderBy);return{type:"symbol",target:s,attributes:i,aggregateFields:t,storage:u,mesh:{matcher:l,labels:{type:"simple",classes:m},aggregateMatcher:o,sortKey:b}}}}function Ne(e,t){const n={mesh:!0,storage:!0};for(const i of t){const{name:t,outStatistic:r}=i,{statisticType:s,onStatisticField:a}=r;let l=null,o=null,u=null;const c="numeric",f="feature";"onStatisticValueExpression"in r?o=Ce(e,{type:"expression",target:f,valueExpression:r.onStatisticValueExpression,resultType:c}).fieldIndex:"onStatisticNormalizationField"in r?(l=Ce(e,{type:"field",target:f,field:a,resultType:c}).field,u=r.onStatisticNormalizationField):l=Ce(e,{type:"field",target:f,field:a,resultType:c}).field,Ce(e,{type:"statistic",target:"aggregate",name:t,context:n,inField:l,inNormalizationField:u,inFieldIndex:o,statisticType:s})}}function Le(e,t,n){switch(n.type){case"dot-density":return function(e,t,n){return n&&n.length?{type:"dot-density",mapping:n.map(((n,i)=>{const{field:r,fieldIndex:s}=Pe(e,{valueExpression:n.valueExpression,field:n.field,resultType:"numeric",target:t});return{binding:i,field:r,fieldIndex:s}})),target:t}:{type:"dot-density",mapping:[],target:t}}(e,t,n.attributes);case"simple":case"class-breaks":case"unique-value":case"dictionary":return function(e,t,n){if(!n||!n.length)return{type:"visual-variable",mapping:[],target:t};const i={storage:!0},r="numeric";return{type:"visual-variable",mapping:se(n).map((n=>{var s;const a=F(n.type),{field:l,fieldIndex:o}=Pe(e,{target:t,valueExpression:n.valueExpression,field:n.field,context:i,resultType:r});switch(n.type){case"size":return"$view.scale"===n.valueExpression?null:{type:"size",binding:a,field:l,fieldIndex:o,normalizationField:Pe(e,{target:t,field:n.normalizationField,context:i,resultType:r}).field,valueRepresentation:null!=(s=n.valueRepresentation)?s:null};case"color":return{type:"color",binding:a,field:l,fieldIndex:o,normalizationField:Pe(e,{target:t,field:n.normalizationField,context:i,resultType:r}).field};case"opacity":return{type:"opacity",binding:a,field:l,fieldIndex:o,normalizationField:Pe(e,{target:t,field:n.normalizationField,context:i,resultType:r}).field};case"rotation":return{type:"rotation",binding:a,field:l,fieldIndex:o}}})).filter((e=>e)),target:t}}(e,t,n.visualVariables);case"heatmap":return null}}function Be(e,t,n,i=!1){const r=w(e,{indexCount:0,fields:{}});switch(n.type){case"simple":case"dot-density":return function(e,t,n,i=!1){const r=t.getSymbols();return{type:"simple",symbol:Ee(r.length?r[0]:null,t,i),isDotDensity:n}}(0,n,"dot-density"===n.type,i);case"class-breaks":return function(e,t,n,i=!1){const r=n.backgroundFillSymbol,{field:s,fieldIndex:a}=Pe(e,{target:t,field:n.field,valueExpression:n.valueExpression,resultType:"numeric",context:{mesh:!0,use:"renderer.field"}}),l=n.normalizationType,o="log"===l?"esriNormalizeByLog":"percent-of-total"===l?"esriNormalizeByPercentOfTotal":"field"===l?"esriNormalizeByField":null,u=Te(n),c=n.classBreakInfos.map((e=>({symbol:ke(e.symbol,u,i),min:e.minValue,max:e.maxValue}))).sort(((e,t)=>e.min-t.min));return{type:"interval",attributes:e.fields,field:s,fieldIndex:a,backgroundFillSymbol:ke(r,u,i),defaultSymbol:ke(n.defaultSymbol,u,i),intervals:c,normalizationField:n.normalizationField,normalizationTotal:n.normalizationTotal,normalizationType:o,isMaxInclusive:n.isMaxInclusive}}(r,t,n,i);case"unique-value":return function(e,t,n,i=!1){const r=[],s=n.backgroundFillSymbol,a={target:t,context:{mesh:!0},resultType:"string"};if(n.field&&"string"!=typeof n.field)throw new g(Ve,"Expected renderer.field to be a string",n);const{field:l,fieldIndex:o}=Pe(e,{...a,field:n.field,valueExpression:n.valueExpression}),u=Te(n);for(const e of n.uniqueValueInfos)r.push({value:""+e.value,symbol:ke(e.symbol,u,i)});return{type:"map",attributes:e.fields,field:l,fieldIndex:o,field2:Pe(e,{...a,field:n.field2}).field,field3:Pe(e,{...a,field:n.field3}).field,fieldDelimiter:n.fieldDelimiter,backgroundFillSymbol:ke(s,u),defaultSymbol:ke(n.defaultSymbol,u),map:r}}(r,t,n,i);case"dictionary":return function(e,t){return{type:"dictionary",renderer:t.toJSON()}}(0,n)}}const Ae=Object.freeze({__proto__:null,addAggregateFields:Ne,createMatcherSchema:Be,createSchema:Re,createSymbolSchema:Ee,getSymbolSchemaOptsFromRenderer:Te});export{Re as M,Be as _,H as a,me as b,G as c,q as d,Se as e,be as f,L as g,A as h,pe as i,Ae as j,ge as m,B as p,re as s,N as u,U as y,Ee as z}