import{e as t,d as e,a3 as n,a2 as s,i as r,a1 as i,bk as a,A as o,c as l,f as u,D as c}from"./p-e58503d5.js";import{h}from"./p-e273719b.js";import{p as d,i as p}from"./p-8a919d07.js";import{u as m}from"./p-de5b11d6.js";var g;const f=new WeakMap;let y=0,v=g=class extends i{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,n,s){if(t instanceof HTMLImageElement){const r={type:"image-element",src:p(t.src,s),crossOrigin:t.crossOrigin};e[n]=r}else if(t instanceof HTMLCanvasElement){const s=t.getContext("2d").getImageData(0,0,t.width,t.height),r={type:"canvas-element",imageData:this.encodeImageData(s)};e[n]=r}else if(t instanceof HTMLVideoElement){const r={type:"video-element",src:p(t.src,s),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[n]=r}else{const s={type:"image-data",imageData:this.encodeImageData(t)};e[n]=s}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this.decodeImageData(t.imageData),n=document.createElement("canvas");return n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),n}case"image-data":return this.decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this.imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this.imageDataContainsTransparent(t);if(e){const t=e.substr(e.length-4,4).toLowerCase(),n=e.substr(0,15).toLocaleLowerCase();if(".png"===t||"data:image/png;"===n)return!0}return!1}set transparent(t){null!=t?this._override("transparent",t):this._clearOverride("transparent")}get contentHash(){const t="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(e="")=>`d:${e},t:${this.transparent},w:${t}`;return null!=this.url?e(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(f.has(this.data)||f.set(this.data,++y),e(f.get(this.data))):e()}clone(){const t={url:this.url,data:this.data,wrap:this.cloneWrap()};return new g(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const n=this.clone();return t.set(this,n),n}cloneWrap(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}encodeImageData(t){let e="";for(let n=0;n<t.data.length;n++)e+=String.fromCharCode(t.data[n]);return{data:btoa(e),width:t.width,height:t.height}}decodeImageData(t){const e=atob(t.data),n=new Uint8ClampedArray(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return m(n,t.width,t.height)}imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(255!==t.data[e])return!0;return!1}static from(t){return"string"==typeof t?new g({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new g({data:t}):a(g,t)}};t([e({type:String,json:{write:d}})],v.prototype,"url",null),t([e({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),e()],v.prototype,"data",null),t([n("data")],v.prototype,"writeData",null),t([s("data")],v.prototype,"readData",null),t([e({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],v.prototype,"transparent",null),t([e({json:{write:!0}})],v.prototype,"wrap",void 0),t([e({readOnly:!0})],v.prototype,"contentHash",null),v=g=t([r("esri.geometry.support.MeshTexture")],v);const w=v;var T;let j=T=class extends i{constructor(t){super(t),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const n=o(t)?t.get(this):null;if(n)return n;const s=new T(this.clonePropertiesWithDeduplication(e));return o(t)&&t.set(this,s),s}clonePropertiesWithDeduplication(t){return{color:o(this.color)?this.color.clone():null,colorTexture:o(this.colorTexture)?this.colorTexture.cloneWithDeduplication(t):null,normalTexture:o(this.normalTexture)?this.normalTexture.cloneWithDeduplication(t):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};t([e({type:h,json:{write:!0}})],j.prototype,"color",void 0),t([e({type:w,json:{write:!0}})],j.prototype,"colorTexture",void 0),t([e({type:w,json:{write:!0}})],j.prototype,"normalTexture",void 0),t([e({nonNullable:!0,json:{write:!0}})],j.prototype,"alphaMode",void 0),t([e({nonNullable:!0,json:{write:!0}})],j.prototype,"alphaCutoff",void 0),t([e({nonNullable:!0,json:{write:!0}})],j.prototype,"doubleSided",void 0),j=T=t([r("esri.geometry.support.MeshMaterial")],j);const M=j;var b;let x=b=class extends M{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const n=o(t)?t.get(this):null;if(n)return n;const s=new b(this.clonePropertiesWithDeduplication(e));return o(t)&&t.set(this,s),s}clonePropertiesWithDeduplication(t){return{...super.clonePropertiesWithDeduplication(t),emissiveColor:o(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:o(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(t):null,occlusionTexture:o(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(t):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:o(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(t):null}}};t([e({type:h,json:{write:!0}})],x.prototype,"emissiveColor",void 0),t([e({type:w,json:{write:!0}})],x.prototype,"emissiveTexture",void 0),t([e({type:w,json:{write:!0}})],x.prototype,"occlusionTexture",void 0),t([e({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],x.prototype,"metallic",void 0),t([e({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],x.prototype,"roughness",void 0),t([e({type:w,json:{write:!0}})],x.prototype,"metallicRoughnessTexture",void 0),x=b=t([r("esri.geometry.support.MeshMaterialMetallicRoughness")],x);const A=x;var D;const C=l.getLogger("esri.geometry.support.MeshVertexAttributes");let F=D=class extends i{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return H(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},C)}castPosition(t){return t&&t instanceof Float32Array&&C.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),H(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},C)}castUv(t){return H(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},C)}castNormal(t){return H(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},C)}castTangent(t){return H(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},C)}clone(){const t={position:c(this.position),uv:c(this.uv),normal:c(this.normal),tangent:c(this.tangent),color:c(this.color)};return new D(t)}clonePositional(){const t={position:c(this.position),normal:c(this.normal),tangent:c(this.tangent),uv:this.uv,color:this.color};return new D(t)}};function N(t,e,n,s){const{loggerTag:r,stride:i}=e;return t.length%i!=0?(s.error(r,`Invalid array length, expected a multiple of ${i}`),new n([])):t}function H(t,e,n,s,r){if(!t)return t;if(t instanceof e)return N(t,s,e,r);for(const i of n)if(t instanceof i)return N(new e(t),s,e,r);if(Array.isArray(t))return N(new e(t),s,e,r);{const s=n.map((t=>`'${t.name}'`));return r.error(`Failed to set property, expected one of ${s}, but got ${t.constructor.name}`),new e([])}}function E(t,e,n){e[n]=function(t){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=t[n];return e}(t)}t([e({json:{write:E}})],F.prototype,"color",void 0),t([u("color")],F.prototype,"castColor",null),t([e({nonNullable:!0,json:{write:E}})],F.prototype,"position",void 0),t([u("position")],F.prototype,"castPosition",null),t([e({json:{write:E}})],F.prototype,"uv",void 0),t([u("uv")],F.prototype,"castUv",null),t([e({json:{write:E}})],F.prototype,"normal",void 0),t([u("normal")],F.prototype,"castNormal",null),t([e({json:{write:E}})],F.prototype,"tangent",void 0),t([u("tangent")],F.prototype,"castTangent",null),F=D=t([r("esri.geometry.support.MeshVertexAttributes")],F);const I=F;var L;const S=l.getLogger("esri.geometry.support.MeshComponent");let $=L=class extends i{constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(t){return a(L,t)}castFaces(t){return H(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},S)}castMaterial(t){return a(t&&"object"==typeof t&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?A:M,t)}clone(){return new L({faces:c(this.faces),shading:this.shading,material:c(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const n={faces:c(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new L(n)}};t([e({json:{write:!0}})],$.prototype,"faces",void 0),t([u("faces")],$.prototype,"castFaces",null),t([e({type:M,json:{write:!0}})],$.prototype,"material",void 0),t([u("material")],$.prototype,"castMaterial",null),t([e({type:String,json:{write:!0}})],$.prototype,"shading",void 0),t([e({type:Boolean})],$.prototype,"trustSourceNormals",void 0),$=L=t([r("esri.geometry.support.MeshComponent")],$);const W=$;export{F as a,A as c,W as f,w as m,I as y}