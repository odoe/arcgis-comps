import{e as t,d as s,i as e,p as i,J as n,a,$ as h,t as r,ay as d,aR as o}from"./p-9ae46e68.js";import{i as l}from"./p-4fd6e394.js";let c=class extends i{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new n,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(t,s,e,i=0){const n=0!=(1&i),h=++this.handleId;n||this.installSyncUpdatingWatch(t,s,h);const r=0!=(2&i)?a(t,s,e,n):t.watch(s,e,n);return this.handles.add(r,h),{remove:()=>this.handles.remove(h)}}addOnCollectionPropertyChange(t,s,e,i=0){const n=0!=(2&i),a=++this.handleId;return this.handles.add([h(t,s,"after-changes",this.createSyncUpdatingCallback()),h(t,s,"change",e,n?t=>{e({added:t.items,removed:[],moved:[],target:t})}:void 0)],a),{remove:()=>{this.handles.remove(a)}}}addOnCollectionChange(t,s,e=0){const i=0!=(2&e),n=++this.handleId;return this.handles.add([t.on("after-changes",this.createSyncUpdatingCallback()),t.on("change",s)],n),i&&s({added:t.items,removed:[],moved:[],target:t}),{remove:()=>{this.handles.remove(n)}}}addPromise(t){if(r(t))return t;const s=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(t)&&(0!==this.pendingPromises.size||this.handles.has(u)||this._set("updating",!1))}},s),this.pendingPromises.add(t),this._set("updating",!0);const e=()=>this.handles.remove(s);return t.then(e,e),t}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}installSyncUpdatingWatch(t,s,e){const i=this.createSyncUpdatingCallback(),n=l((()=>o(t,s)),i,{sync:!0,equals:()=>!1});return this.handles.add(n,e),n}createSyncUpdatingCallback(){return()=>{this.handles.remove(u),++this.scheduleHandleId;const t=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(d((()=>{t===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(u))})),u)}}};t([s({readOnly:!0})],c.prototype,"updating",void 0),c=t([e("esri.views.support.WatchUpdatingTracking")],c);const u=-42,g=i=>{let a=class extends i{destroy(){this.destroyed||(this.handles.destroy(),this.updatingHandles.destroy())}get handles(){return this._get("handles")||new n}get updatingHandles(){return this._get("updatingHandles")||new c}};return t([s({readOnly:!0})],a.prototype,"handles",null),t([s({readOnly:!0})],a.prototype,"updatingHandles",null),a=t([e("esri.core.HandleOwner")],a),a};let p=class extends(g(i)){};p=t([e("esri.core.HandleOwner")],p);export{g as a,p as d,c as l}