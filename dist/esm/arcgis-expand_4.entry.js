import { r as registerInstance, h as h$a, g as getElement, c as createEvent } from './index-41925fe8.js';
import { e as e$6, d as d$b, i as i$j, p as p$l, u as u$e, $ as $$4, a as d$c, O as O$2, o as o$6, b as e$7, t as t$5, z as z$3, c as e$8, n as n$i, f as t$6, g as t$7, h as b$6, m as m$a, L as L$7, S as S$5, j as h$b, k as i$k, l as j$5, q as b$7, w as w$7, r as b$8, x as x$6, I as I$6, s as s$e, v as o$7, y as y$8, A as S$6, B as S$7, C as f$a, D as t$8, T as T$1, E as z$4, F as g$8, G as f$b, R as Rt, H as E$1, J as i$l, K as p$m, M as y$9, N as e$9, P as h$c, Q as a$e, U as i$m, V as e$a, W as r$6, X as K$3, Y as g$9, Z as v$6, _ as l$e, a0 as i$n, a1 as u$f, a2 as s$f, a3 as s$g, a4 as c$n, a5 as r$7, a6 as a$f, a7 as s$h, a8 as M$2, a9 as H$2, aa as v$8, ab as l$f, ac as b$a, ad as k$3, ae as b$b, af as e$b, ag as n$j, ah as r$8, ai as l$g, aj as h$d, ak as r$9, al as s$i, am as R$3, an as t$9, ao as B, ap as e$c, aq as n$l, ar as n$m, as as a$h, at as m$b, au as c$p, av as e$d, aw as a$i, ax as L$9, ay as M$3, az as u$g, aA as t$a, aB as g$a, aC as w$8, aD as y$a, aE as o$8, aF as i$o, aG as l$h, aH as d$d, aI as U$3, aJ as d$e, aK as m$c, aL as o$9, aM as O$3, aN as y$b, aO as r$a, aP as l$i, aQ as o$a, aR as r$b, aS as i$p, aT as S$8, aU as u$h, aV as m$d, aW as n$n, aX as a$j, aY as n$o, aZ as d$f, a_ as M$4, a$ as y$c, b0 as j$6, b1 as d$g, b2 as S$9, b3 as L$a, b4 as b$c, b5 as G, b6 as V$1, b7 as bt, b8 as j$7, b9 as G$1 } from './MapView-2c43b6d4.js';
import { r as r$5 } from './EffectList-02a3200c.js';
import { c as c$m } from './ExportImageParameters-c98a9cc7.js';
import { getSymbolLayerFill as N$2 } from './previewSymbol3D-01fa068c.js';
import { v as v$7, A as A$2, I as I$7, b as b$9, T as T$2, U as U$2, L as L$8, C as C$4 } from './renderUtils-a56a67e3.js';
import { c as c$o } from './scaleUtils-8a06d2c4.js';
import './trimExtend-88cd9daf.js';
import { a as a$g, n as n$k } from './project-6023a7d4.js';
import { r as r$d } from './originUtils-7b0bbc60.js';
import { n as n$p, e as e$e, t as t$b } from './portalItemUtils-6e127923.js';
import { r as r$c } from './Version-35d4b212.js';
import './sublayerUtils-c6a17833.js';
import './floorFilterUtils-a09da11b.js';
import './colorUtils-4e913569.js';
import './webStyleSymbolUtils-11abeacf.js';
import './devEnvironmentUtils-872cccb2.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let p$k=class extends p$l{constructor(e){super(e),this._viewpointHandle=null,this._handles=new u$e,this.group=null;}initialize(){this._handles.add($$4(this,"view.ui","expand",(e=>{const{target:t}=e;t&&t!==this&&t.expanded&&t.group&&t.group===this.group&&this._collapse();})));}destroy(){this._viewpointHandle=null,this.view=null,this._handles.destroy(),this._handles=null;}set autoCollapse(e){this._set("autoCollapse",e),this._watchViewpoint();}set expanded(e){const t=!!e;this._set("expanded",t);const s=this.get("view.ui");s&&s.emit("expand",{target:this}),this._viewpointHandleChange(t);}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){this._get("view")!==e&&(this._set("view",e),e&&d$c(e,"ready",(()=>{this.view===e&&this._watchViewpoint();})));}_viewpointHandleChange(e){this._viewpointHandle&&(e?d$c(this.view,"stationary",(()=>this._viewpointHandle.resume())):this._viewpointHandle.pause());}_watchViewpoint(){const e="viewpoint";this._handles.remove(e),this._viewpointHandle=null;const{autoCollapse:t,view:s}=this;if(s&&t){const t="3d"===s.type?"camera":"viewpoint",i=O$2(s,t,(()=>this._collapse()));this._handles.add(i,e),this._viewpointHandle=i;}}_collapse(){this.expanded=!1;}};e$6([d$b({value:!1})],p$k.prototype,"autoCollapse",null),e$6([d$b({value:!1})],p$k.prototype,"expanded",null),e$6([d$b()],p$k.prototype,"group",void 0),e$6([d$b({readOnly:!0})],p$k.prototype,"state",null),e$6([d$b({value:null})],p$k.prototype,"view",null),p$k=e$6([i$j("esri.widgets.Expand.ExpandViewModel")],p$k);const l$d=p$k;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const c$l={base:"esri-expand esri-widget",modeAuto:"esri-expand--auto",modeDrawer:"esri-expand--drawer",modeFloating:"esri-expand--floating",container:"esri-expand__container",containerExpanded:"esri-expand__container--expanded",panel:"esri-expand__panel",button:"esri-widget--button",text:"esri-icon-font-fallback-text",icon:"esri-collapse__icon",iconExpanded:"esri-expand__icon--expanded",iconNumber:"esri-expand__icon-number",iconNumberExpanded:"esri-expand__icon-number--expanded",expandIcon:"esri-icon-expand",collapseIcon:"esri-icon-collapse",content:"esri-expand__content",contentExpanded:"esri-expand__content--expanded",expandMask:"esri-expand__mask",expandMaskExpanded:"esri-expand__mask--expanded"};let u$d=class extends z$3{constructor(e,o){super(e,o),this.autoCollapse=null,this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expanded=null,this.expandTooltip="",this.group=null,this.iconNumber=0,this.label=void 0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.view=null,this.viewModel=new l$d,this._handleKeyDown=e=>{const{closeOnEsc:o,_toggleButtonEl:t,expanded:n}=this;if(!n||!o||e.target===t||"Escape"!==e.key)return;("function"==typeof o?o(e):o)&&(this.expanded=!1,null==t||t.focus());};}get contentId(){return `${this.id}_controls_content`}get expandTitle(){const{expanded:e,messagesCommon:o,collapseTooltip:t,expandTooltip:n}=this;return e?t||o.collapse:n||o.expand}get collapseIconClass(){return c$l.collapseIcon}set collapseIconClass(e){e?this._override("collapseIconClass",e):this._clearOverride("collapseIconClass");}get expandIconClass(){return e$8(this.content)?this.content.iconClass:c$l.expandIcon}set expandIconClass(e){e?this._override("expandIconClass",e):this._clearOverride("expandIconClass");}expand(){this.viewModel.expanded=!0;}collapse(){this.viewModel.expanded=!1;}toggle(){this.viewModel.expanded=!this.viewModel.expanded;}render(){const{mode:e}=this,o={[c$l.modeAuto]:"auto"===e,[c$l.modeDrawer]:"drawer"===e,[c$l.modeFloating]:"floating"===e};return n$i("div",{class:this.classes(c$l.base,o),onkeydown:this._handleKeyDown},this.renderMask(),this.renderContainer())}renderContainer(){const{expanded:e}=this,o={[c$l.containerExpanded]:e};return n$i("div",{class:this.classes(c$l.container,o)},this.renderPanel(),this.renderContent())}renderMask(){const{expanded:e}=this,o={[c$l.expandMaskExpanded]:e};return n$i("div",{bind:this,onclick:this._toggle,class:this.classes(c$l.expandMask,o)})}renderBadgeNumber(){const{expanded:e,iconNumber:o}=this;return o&&!e?n$i("span",{key:"expand__icon-number",class:c$l.iconNumber},o):null}renderPanelNumber(){const{iconNumber:e,expanded:o}=this;return e&&o?n$i("span",{key:"expand__expand-icon-number",class:this.classes(c$l.iconNumber,c$l.iconNumberExpanded)},e):null}renderIcon(){const{collapseIconClass:e,expandIconClass:o,expanded:t}=this,n={[c$l.iconExpanded]:t,[e]:t,[o]:!t};return e===o&&(n[e]=!0),n$i("span",{"aria-hidden":"true",class:this.classes(c$l.icon,n)})}renderTitle(){return n$i("span",{class:c$l.text},this.expandTitle)}renderExpandButton(){const{expanded:e,expandTitle:o,contentId:t}=this;return n$i("div",{afterCreate:this._storeToggleButtonEl,"aria-controls":t,"aria-expanded":e?"true":"false",bind:this,class:c$l.button,onclick:this._toggle,onkeydown:this._toggle,role:"button",tabindex:"0",title:o},this.renderBadgeNumber(),this.renderIcon(),this.renderTitle())}renderPanel(){return n$i("div",{class:c$l.panel},this.renderExpandButton(),this.renderPanelNumber())}renderContent(){const{expanded:e,contentId:o}=this,t={[c$l.contentExpanded]:e};return n$i("div",{id:o,role:"region",class:this.classes(c$l.content,t)},this.renderContentContainer())}renderContentContainer(){const e=this.content;return "string"==typeof e?n$i("div",{innerHTML:e}):e$8(e)?e.render():e instanceof HTMLElement?n$i("div",{bind:e,afterCreate:this._attachToNode}):t$6(e)?n$i("div",{bind:e.domNode,afterCreate:this._attachToNode}):null}_toggle(){this.toggle();}_attachToNode(e){const o=this;e.appendChild(o);}_storeToggleButtonEl(e){this._toggleButtonEl=e;}};e$6([d$b({readOnly:!0})],u$d.prototype,"contentId",null),e$6([d$b({readOnly:!0})],u$d.prototype,"expandTitle",null),e$6([o$6("viewModel.autoCollapse")],u$d.prototype,"autoCollapse",void 0),e$6([d$b()],u$d.prototype,"closeOnEsc",void 0),e$6([d$b()],u$d.prototype,"collapseIconClass",null),e$6([d$b()],u$d.prototype,"collapseTooltip",void 0),e$6([d$b()],u$d.prototype,"content",void 0),e$6([o$6("viewModel.expanded")],u$d.prototype,"expanded",void 0),e$6([d$b()],u$d.prototype,"expandIconClass",null),e$6([d$b()],u$d.prototype,"expandTooltip",void 0),e$6([o$6("viewModel.group")],u$d.prototype,"group",void 0),e$6([d$b()],u$d.prototype,"iconNumber",void 0),e$6([d$b({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],u$d.prototype,"label",void 0),e$6([d$b(),e$7("esri/widgets/Expand/t9n/Expand")],u$d.prototype,"messages",void 0),e$6([d$b(),e$7("esri/t9n/common")],u$d.prototype,"messagesCommon",void 0),e$6([d$b()],u$d.prototype,"mode",void 0),e$6([o$6("viewModel.view")],u$d.prototype,"view",void 0),e$6([d$b({type:l$d})],u$d.prototype,"viewModel",void 0),e$6([t$5()],u$d.prototype,"_toggle",null),u$d=e$6([i$j("esri.widgets.Expand")],u$d);const x$5=u$d;

const arcgisExpandCss = "@import url('https://js.arcgis.com/next/esri/themes/light/main.css');";

let ArcGISSearch$1 = class {
  constructor(hostRef) {
    registerInstance(this, hostRef);
  }
  validateView(value) {
    if (value) {
      this.widget.view = value;
      this.widget.view.ui.add(this.widget, this.position);
    }
  }
  componentWillLoad() {
    const expand = new x$5({
      container: this.el
    });
    this.widget = expand;
  }
  componentDidRender() {
    const elems = Array.from(this.el.children);
    for (let e of elems) {
      if (e.tagName.toLowerCase().includes('arcgis-')) {
        e.view = this.view;
        this.widget.content = e;
        this.widget.expandIconClass = e.widget.iconClass;
      }
    }
  }
  render() {
    return (h$a("div", { class: "expand-container" }));
  }
  get el() { return getElement(this); }
  static get watchers() { return {
    "view": ["validateView"]
  }; }
};
ArcGISSearch$1.style = arcgisExpandCss;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function o$5(r){return t$7(r)||"simple"===r.type||"unique-value"===r.type||"class-breaks"===r.type||"dictionary"===r.type}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const l$c=(e,l)=>{const a=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return null!=l&&l.levels?l.levels[a]:null};function a$d(a,i){if(!a||!("visualVariables"in a)||!a.visualVariables)return null;const s=a.visualVariables.find((e=>"size"===e.type)),n=l$c(i,s);return n?new b$6({field:s.field,minSize:n[2].size,minDataValue:n[2].value,maxSize:n[3].size,maxDataValue:n[3].value}):null}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const n$h=/^-?(\d+)(\.(\d+))?$/i;function e$5(t,n){return t-n}function r$4(t,n){let e,r;return e=Number(t.toFixed(n)),e<t?r=e+1/10**n:(r=e,e-=1/10**n),e=Number(e.toFixed(n)),r=Number(r.toFixed(n)),[e,r]}function o$4(t,n,e,r,o){const i=l$b(t,n,e,r),u=null==i.previous||i.previous<=o,s=null==i.next||i.next<=o;return u&&s||i.previous+i.next<=2*o}function i$i(t){const e=String(t),r=e.match(n$h);if(r&&r[1])return {integer:r[1].split("").length,fractional:r[3]?r[3].split("").length:0};if(e.toLowerCase().indexOf("e")>-1){const t=e.split("e"),n=t[0],r=t[1];if(n&&r){const t=Number(n);let e=Number(r);const o=e>0;o||(e=Math.abs(e));const l=i$i(t);return o?(l.integer+=e,e>l.fractional?l.fractional=0:l.fractional-=e):(l.fractional+=e,e>l.integer?l.integer=1:l.integer-=e),l}}return {integer:0,fractional:0}}function l$b(t,n,e,r){const o={previous:null,next:null};if(null!=e){const r=t-e,i=n-e-r;o.previous=Math.floor(Math.abs(100*i/r));}if(null!=r){const e=r-t,i=r-n-e;o.next=Math.floor(Math.abs(100*i/e));}return o}function u$c(t,n={}){const l=t.slice(0),{tolerance:u=2,strictBounds:s=!1,indexes:c=l.map(((t,n)=>n))}=n;c.sort(e$5);for(let e=0;e<c.length;e++){const t=c[e],n=l[t],a=0===t?null:l[t-1],f=t===l.length-1?null:l[t+1],m=i$i(n).fractional;if(m){let i,c=0,g=!1;for(;c<=m&&!g;){const t=r$4(n,c);i=s&&0===e?t[1]:t[0],g=o$4(n,i,a,f,u),c++;}g&&(l[t]=i);}}return l}const s$d={maximumFractionDigits:20};function c$k(n){return m$a(n,s$d)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const g$7="<",w$6=">",I$5=S$5("short-date");function U$1(a,U,e,i){let o="";0===U?o=`${g$7} `:U===e&&(o=`${w$6} `);let r=null;return r=i?L$7(a,I$5):c$k(a),o+r}const e$4=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const o$3=new h$b([64,64,64]);function n$g(l,o){const n=[],r=l.length-1;return 5===l.length?n.push(0,2,4):n.push(0,r),l.map(((l,t)=>n.indexOf(t)>-1?U$1(l,t,r,o):null))}async function r$3(l,e,o){let r=!1,a=[],u=[];if(l.stops){const e=l.stops;a=e.map((l=>l.value)),r=e.some((l=>!!l.label)),r&&(u=e.map((l=>l.label)));}const s=a[0],i=a[a.length-1];if(null==s&&null==i)return null;const c=r?null:n$g(a,o);return (await Promise.all(a.map((async(o,n)=>({value:o,color:"opacity"===l.type?await t$4(o,l,e):(await import('./MapView-2c43b6d4.js').then(function (n) { return n.ke; })).getColor(l,o),label:r?u[n]:c[n]}))))).reverse()}async function t$4(e,n,r=o$3){const t=new h$b(r),a=(await import('./MapView-2c43b6d4.js').then(function (n) { return n.ke; })).getOpacity(n,e);return null!=a&&(t.a=a),t}function a$c(l){let e=!1,o=[],r=[];o=l.map((l=>l.value)),e=l.some((l=>!!l.label)),e&&(r=l.map((l=>l.label)));const t=o[0],a=o[o.length-1];if(null==t&&null==a)return null;const s=e?null:n$g(o,!1);return o.map(((o,n)=>({value:o,color:u$b(o,l),label:e?r[n]:s[n]}))).reverse()}function u$b(e,o){const{startIndex:n,endIndex:r,weight:t}=s$c(e,o);if(n===r)return o[n].color;const a=h$b.blendColors(o[n].color,o[r].color,t);return new h$b(a)}function s$c(l,e){let o=0,n=e.length-1;return e.some(((e,r)=>l<e.value?(n=r,!0):(o=r,!1))),{startIndex:o,endIndex:n,weight:(l-e[o].value)/(e[n].value-e[o].value)}}function i$h(e,o){let n=[];if(e&&"multipart"===e.type)e.colorRamps.reverse().forEach((function(r,t){0===t?n.push({value:o.max,color:new h$b(r.toColor),label:"high"}):n.push({value:null,color:new h$b(r.toColor),label:""}),t===e.colorRamps.length-1?n.push({value:o.min,color:new h$b(r.fromColor),label:"low"}):n.push({value:null,color:new h$b(r.fromColor),label:""});}));else {let r,t;e&&"algorithmic"===e.type?(r=e.fromColor,t=e.toColor):(r=[0,0,0,1],t=[255,255,255,1]),n=[{value:o.max,color:new h$b(t),label:"high"},{value:o.min,color:new h$b(r),label:"low"}];}return n}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function r$2(r){let t=r.colorStops,e=t.length-1;if(t&&t[0]){const r=t[e];r&&1!==r.ratio&&(t=t.slice(0),t.push(new i$k({ratio:1,color:r.color})),e++);}return t.map(((o,r)=>{let t="";return 0===r?t="low":r===e&&(t="high"),{color:o.color,label:t,ratio:o.ratio}})).reverse()}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const s$b={HH:315,HL:45,LL:135,LH:225},l$a={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function n$f(t){if(!t)return;const{type:s}=t;if(s.indexOf("3d")>-1)return N$2(t.symbolLayers.getItemAt(0));if("simple-line"===s){const e=j$5(t);return e&&e.color}if("simple-marker"===t.type&&("x"===t.style||"cross"===t.style)){const e=j$5(t);return e&&e.color}return b$7(t)}function H$1(t,o){const e=o.HH.label,r=o.LL.label,s=o.HL.label,l=o.LH.label;switch(t){default:return {top:e,bottom:r,left:s,right:l};case"HL":return {top:s,bottom:l,left:r,right:e};case"LL":return {top:r,bottom:e,left:l,right:s};case"LH":return {top:l,bottom:s,left:e,right:r}}}function i$g(t){const{focus:o,infos:e,numClasses:r}=t,s=l$a[r],L={};e.forEach((t=>{L[t.value]={label:t.label,fill:n$f(t.symbol)};}));const i=[];for(let l=0;l<r;l++){const t=[];for(let o=0;o<r;o++){const e=L[s[l][o]];t.push(e.fill);}i.push(t);}return {type:"relationship-ramp",numClasses:r,focus:o,colors:i,labels:H$1(o,L),rotation:f$9(o)}}function f$9(t){let o=s$b[t];return t&&null==o&&(o=s$b.HH),o||0}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const u$a=30,c$j=12,m$9=[255,255,255],f$8=[200,200,200],p$j=[128,128,128],y$7=20,b$5=5;function d$a(e){return "esri.symbols.SimpleMarkerSymbol"===e.declaredClass}function h$9(e){return "esri.symbols.PictureMarkerSymbol"===e.declaredClass}function v$5(e){return "esri.symbols.SimpleLineSymbol"===e.declaredClass}function g$6(e){return "esri.symbols.TextSymbol"===e.declaredClass}function w$5(e,l){const t=e.length-1;return e.map(((e,n)=>U$1(e,n,t,l)))}async function S$4(e,l,n,i,o,a){var u,c;const m=l.legendOptions,f=m&&m.customValues,p=V(e,n),y=!!p,b=!!f,d=null!=l.minSize&&null!=l.maxSize,h=l.stops&&l.stops.length>1,v=!!l.target;if(!y||!b&&!(d||h&&!v))return;const g=w$7(p);let S=null,k=null,j=null;k=g&&!h?u$c([l.minDataValue,l.maxDataValue]):f||await C$3(l,p,i,o);const L=null==e?void 0:e.authoringInfo,O="univariate-color-size"===(null==L?void 0:L.type),D=O&&"above-and-below"===(null==L?void 0:L.univariateTheme);if(!k&&h&&(k=l.stops.map((e=>e.value)),S=l.stops.some((e=>!!e.label)),S&&(j=l.stops.map((e=>e.label)))),g&&(null==(u=k)?void 0:u.length)>2&&!D&&(k=[k[0],k[k.length-1]]),!k)return null;O&&5!==(null==(c=k)?void 0:c.length)&&(k=I$4({minSize:k[0],maxSize:k[k.length-1]}));const E=g?z$2(e,k):null,T=b$8(p),q=S?null:w$5(k,a);return (await Promise.all(k.map((async(t,n)=>{const s=g?E[n]:await M$1(l,p,t,i,o);return {value:t,symbol:U(D&&"class-breaks"===e.type?x$4(e,n):p,s),label:S?j[n]:q[n],size:s,outlineSize:T}})))).reverse()}function z$2(e,l){const t=null==e?void 0:e.authoringInfo,n="univariate-color-size"===(null==t?void 0:t.type);let i=[c$j,u$a];if(n){const e=l[0],t=l[l.length-1],n=c$j,o=u$a;i=l.map((l=>n+(l-e)/(t-e)*(o-n)));}return n&&"below"===(null==t?void 0:t.univariateTheme)&&i.reverse(),i}function x$4(e,l){const t=e.classBreakInfos,n=t.length,i=n<2||!(l>=2)?t[0].symbol.clone():t[n-1].symbol.clone();return e.visualVariables.some((e=>"color"===e.type))&&(i.type.indexOf("3d")>-1?j$4(i):L$6(i)),i}function V(e,l){let t=null,n=null;if("simple"===e.type)t=e.symbol;else if("class-breaks"===e.type){const l=e.classBreakInfos;t=l&&l[0]&&l[0].symbol,n=l.length>1;}else if("unique-value"===e.type){const l=e.uniqueValueInfos;t=l&&l[0]&&l[0].symbol,n=l.length>1;}return !t||k$2(t)?null:(t=t.clone(),(l||n)&&(t.type.indexOf("3d")>-1?j$4(t):L$6(t)),t)}function k$2(e){if(e){if(x$6(e)){return !!e.symbolLayers&&e.symbolLayers.some((e=>e&&"fill"===e.type))}return -1!==e.type.indexOf("fill")}return !1}function j$4(e){"line-3d"===e.type?e.symbolLayers.forEach((e=>{e.material={color:p$j};})):e.symbolLayers.forEach((e=>{"icon"!==e.type||e.resource&&e.resource.href?e.material={color:f$8}:(e.material={color:m$9},e.outline={color:p$j,size:1.5});}));}function L$6(l){"cim"===l.type?I$6(l,new h$b(f$8)):-1!==l.type.indexOf("line")?l.color=p$j:(l.color=m$9,"simple-marker"===l.type&&(l.outline={color:p$j,width:1.5}));}async function C$3(e,l,n,i){const o=(await import('./MapView-2c43b6d4.js').then(function (n) { return n.ke; })).getSizeRangeAtScale(e,n,i),s=o&&I$4(o);if(!o&&!s)return;let r=s.map((l=>O$1(l,e,o)));r=u$c(r);for(let t=1;t<r.length-1;t++){const o=await D$1(e,l,r[t],r[t-1],n,i);o&&(r[t]=o[0],s[t]=o[1]);}return r}function I$4(e){const l=e.minSize,t=e.maxSize,n=b$5,i=(t-l)/(n-1),o=[];for(let s=0;s<n;s++)o.push(l+i*s);return o}function O$1(e,l,t){const n=t.minSize,i=t.maxSize,o=l.minDataValue,s=l.maxDataValue;let r=null;if(e<=n)r=o;else if(e>=i)r=s;else {r=(e-n)/(i-n)*(s-o)+o;}return r}async function D$1(e,l,o,s,r,a){const u=await M$1(e,l,o,r,a),c=await M$1(e,l,s,r,a),m=i$i(o),f=m.fractional,p=y$7;let b=m.integer,d=null,h=null;o>0&&o<1&&(d=10**f,b=i$i(o*=d).integer);for(let n=b-1;n>=0;n--){const s=10**n;let m=Math.floor(o/s)*s,f=Math.ceil(o/s)*s;null!=d&&(m/=d,f/=d);let y=(m+f)/2;[,y]=u$c([m,y,f],{indexes:[1]});const b=await M$1(e,l,m,r,a),v=await M$1(e,l,f,r,a),g=await M$1(e,l,y,r,a),w=l$b(u,b,c,null),S=l$b(u,v,c,null),z=l$b(u,g,c,null);let x=w.previous<=p,V=S.previous<=p;if(x&&V&&(w.previous<=S.previous?(x=!0,V=!1):(V=!0,x=!1)),x?h=[m,b]:V?h=[f,v]:z.previous<=p&&(h=[y,g]),h)break}return h}async function M$1(e,l,t,n,i){const{getSize:o}=await import('./MapView-2c43b6d4.js').then(function (n) { return n.ke; });return o(e,t,{scale:n,view:i,shape:"simple-marker"===l.type?l.style:null})}function U(e,t){const n=e.clone();if(x$6(n))w$7(n)||n.symbolLayers.forEach((e=>{"fill"!==e.type&&(e.size=t);}));else if(d$a(n))n.size=t;else if(h$9(n)){const e=n.width,l=n.height;n.height=t,n.width=t*(e/l);}else v$5(n)?n.width=t:g$6(n)&&n.font&&(n.font.size=t);return n}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const J=s$e.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),Q="https://utility.arcgis.com/sharing/tools/legend",H="esri.layers.ImageryLayer",X$2="esri.layers.ImageryTileLayer",K$2="esri.layers.WCSLayer",Y$2=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Z$2=new o$7({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),ee$2={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},te$2=new y$8({size:6,outline:{color:[128,128,128,.5],width:.5}}),se$2=new S$6({style:"solid"});function le$1(e){return "vector-field"===e.type}function re$2(e){return "raster-colormap"===e.type}function ie$1(e){return "raster-stretch"===e.type}function ne$1(e){return "raster-shaded-relief"===e.type}function ae$1(e){return "esri.renderers.SimpleRenderer"===e.declaredClass}function oe$2(e){return "esri.renderers.ClassBreaksRenderer"===e.declaredClass}function ue$1(e){return "esri.renderers.UniqueValueRenderer"===e.declaredClass}function ce$1(e){return "esri.renderers.HeatmapRenderer"===e.declaredClass}function de$1(e){return he$1(e)||me$1(e)||pe$1(e)||ye$1(e)}function ye$1(e){return "esri.renderers.PointCloudRGBRenderer"===e.declaredClass}function he$1(e){return "esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function me$1(e){return "esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function pe$1(e){return "esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function fe$1(e){return "esri.renderers.DotDensityRenderer"===e.declaredClass}function ge$1(e,t){return ae$1(e)||oe$2(e)||ue$1(e)||ce$1(e)||fe$1(e)?"2d"===t.type||o$5(e):ie$1(e)||re$2(e)||ne$1(e)||he$1(e)||me$1(e)||pe$1(e)||le$1(e)}function be(e){return "esri.layers.BuildingSceneLayer"===e.declaredClass}function Se(e){return "esri.layers.WMSLayer"===e.declaredClass}function _e(e){return "esri.layers.WMTSLayer"===e.declaredClass}function ve(e){return "esri.layers.MapImageLayer"===e.declaredClass}function we$1(e){return "esri.layers.TileLayer"===e.declaredClass}function Le(e){return "esri.layers.FeatureLayer"===e.declaredClass}function Ee(e){return e.declaredClass===H}function Ie(e){return e.declaredClass===X$2}function Ce(e){return e.declaredClass===K$2}function Re(e){return "stretch-ramp"===e.type}function Fe(e){const t="authoringInfo"in e&&(null==e?void 0:e.authoringInfo);return "univariate-color-size"===(null==t?void 0:t.type)}function Ve(e){const t="authoringInfo"in e&&(null==e?void 0:e.authoringInfo);return "univariate-color-size"===(null==t?void 0:t.type)&&"above-and-below"===(null==t?void 0:t.univariateTheme)}const Te=new y$8({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let ze={},xe=class extends p$l{constructor(e){super(e),this._handles=new u$e,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new S$7,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null;}initialize(){const e=()=>this.notifyChange("ready");this._handles.add([$$4(this,"children","change",(t=>{const{added:s,removed:l}=t,r=this._handles;s.forEach((t=>{const s=`activeLayerInfo-ready-watcher-${t.layer.uid}`;r.add(i$m(t,"ready",e),s);})),l.forEach((e=>r.remove(e.layer.uid))),e();}))]),this.keepCacheOnDestroy||(ze={});}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(ze=null);}get effect(){const e=this.layer;let t=null;if("effect"in e&&e.effect){const s=new r$5(0);s.effect=e.effect,s.transitionStep(0,this.scale);const l=s.effects.filter((e=>"bloom"!==e.type)),r=l.map((e=>e.toJSON()));t=f$a(r);}return t}get opacity(){var e;const t=this.layer.opacity,s=null==(e=this.parent)?void 0:e.opacity,l=this.layer.parent,r=l&&"uid"in l?this._getParentLayerOpacity(l):null;return null!=s?s*t:null!=r?r*t:t}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const e=this.layer;if(null===e)return !1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return !0;if("featureReduction"in e&&e.featureReduction&&"cluster"===e.featureReduction.type)return !0;if("renderer"in e&&e.renderer){if("dot-density"===e.renderer.type)return !0;const t=e.get("renderer.valueExpression");if(Y$2.test(t))return !0;const s=e.get("renderer.visualVariables");if(s)return s.some((e=>this._isScaleDrivenSizeVariable(e)))}return this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){if(!(!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView()))return this.legendElements=[],void this.notifyChange("ready");const t=Array.from(e,(e=>{if(Le(e))return this._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){const t=e.layerDefinition,s=t&&t.drawingInfo,l=s&&t$8(s.renderer),r=Z$2.read(t.geometryType);return l?this._getRendererLegendElements(l,{title:e.name,geometryType:r}):(J.warn("drawingInfo not available!"),null)}return null}));try{const e=[];await T$1(t).then((t=>{t.forEach((({value:t})=>t&&e.push(...t)));})),this.legendElements=e,this.notifyChange("ready");}catch(s){J.warn("error while building legend for layer!",s);}}async buildLegendElementsForRenderer(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getRendererLegendElements(e):[],this.notifyChange("ready");}catch(t){J.warn("error while building legend for layer!",t);}}async buildLegendElementsForTools(){const e=this.layer;if(_e(e))this._constructLegendElementsForWMTSlayer();else if(Se(e))await this._constructLegendElementsForWMSSublayers();else if(be(e))await this._constructLegendElementsForBuildingSceneLayer();else if(ve(e)||we$1(e)||be(e))await this._constructLegendElementsForSublayers();else {this._handles.remove("imageryLayers-watcher");let l="default";if(Ee(e)){var t,s;const r=e;l=((null==r||null==(t=r.renderingRule)?void 0:t.functionName)||"default")+"_"+(null!=(s=e.bandIds)&&s.length?e.bandIds.join(""):"###");}await this._getLegendLayers(`${e.uid}-${l}`).then((async t=>{this.legendElements=[],this.notifyChange("ready");const s=t.map((async t=>{if(Ee(e)||Ie(e)){const t=e.watch(["renderingRule","bandIds"],(()=>z$4((async()=>{ze.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools();}))()));this._handles.add(t,"imageryLayers-watcher");}const s=this._generateSymbolTableElementForLegendLayer(t);s&&s.infos.length&&(Ee(e)&&(s.title=e.title),this.legendElements.push(s)),this.notifyChange("ready");}));await T$1(s);})).catch((e=>{J.warn("Request to server for legend has failed!",e);}));}}async _isLayerInCurrentView(){const e=this.layer,t=this.layerView,s=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!s&&!(t&&"createQuery"in e&&"queryFeatureCount"in e))return !0;await g$8(t,"updating");const l=s?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();l.geometry=this.view.extent;return 0!==(s?"queryFeatureCount"in t&&await t.queryFeatureCount(l):"queryFeatureCount"in e&&await e.queryFeatureCount(l))}_getParentLayerOpacity(e){let t=1;const s=e.parent;return s&&"uid"in s&&(t=this._getParentLayerOpacity(s)),e.opacity*t}_isGroupActive(){const e=this.children;return !!e.length&&e.some((e=>e.ready))}_isScaleDrivenSizeVariable(e){if(e&&"size"!==e.type)return !1;const t=e,s=t.minSize,l=t.maxSize;return "object"==typeof s&&s?this._isScaleDrivenSizeVariable(s):"object"==typeof l&&l?this._isScaleDrivenSizeVariable(l):!!t.expression||Y$2.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return !0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((e=>this._isLayerScaleDriven(e)));const t=e.parent;if(!1===e.loaded&&t&&ve(t)&&"source"in e&&e.source&&"map-layer"===e.source.type)for(const s of t.sourceJSON.layers)if(s.id===e.source.mapLayerId&&(s.minScale>0||s.maxScale>0))return !0;return !1}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this._handles.add(f$b(this.layer,"activeLayer",(()=>this._constructLegendElementsForWMTSlayer())),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some((s=>e.styleId===s.id&&(t=s.legendUrl,!0))),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}]);}this.notifyChange("ready");}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this._handles.remove("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t={...e.customParameters,...e.customLayerParameters}),this._handles.add(f$b(this.layer,"sublayers",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready");}async _generateLegendElementsForWMSSublayers(e,t){const s=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher");const l=e.toArray();for(const r of l){const e=r.watch(["title","visible","legendEnabled"],(()=>this._constructLegendElementsForWMSSublayers()));if(this._handles.add(e,"wms-sublayers-watcher"),!this.respectLayerVisibility||r.visible&&r.legendEnabled){const e=await this._generateSymbolTableElementForWMSSublayer(r,t);e&&e.infos.length&&s.unshift(e);}}return s}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const s=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter((e=>e));return {type:"symbol-table",title:e.title,infos:s}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){var s;let r=e.legendUrl;if(!r)return;const i={type:"symbol-table",title:e.title||e.name||e.id&&e.id+"",infos:[]};t&&(r=Rt(r,t));let n=null;const a=null==(s=e.layer)?void 0:s.opacity;try{n=(await E$1(r,{responseType:"image"})).data,n&&(n.style.opacity=a);}catch{}return i.infos.push({src:r,preview:n,opacity:a}),i}_getLegendLayers(e,t){const s=ze&&ze[e];return s?Promise.resolve(s):this._legendRequest(t).then((t=>{const s=t.layers;return ze[e]=s,s}))}_legendRequest(e){const t=this.layer;let s={f:"json",dynamicLayers:e};if(Ee(t)){const e=t.exportImageServiceParameters.renderingRule;if(e&&(s.renderingRule=JSON.stringify(e.toJSON())),t.bandIds&&(s.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){const{raster:e,viewId:l,customParameters:r}=t;s={raster:e,viewId:l,...s,...r};}}let r=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){const e=r.indexOf("?");e>-1?r=r.substring(0,e)+"/legend"+r.substring(e):r+="/legend";}else {const e=r.toLowerCase().indexOf("/rest/"),t=r.substring(0,e)+r.substring(e+5,r.length);r=Q+"?soapUrl="+encodeURI(t)+"&returnbytes=true";}return E$1(r,{query:s}).then((e=>e.data))}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(f$b(e,"sublayers",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready");}catch(t){J.warn("Request to server for legend has failed!",t);}}async _generateLegendElementsForBuildingSublayers(e,t){let s=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");const l=e.toArray();for(const r of l){const e=r.watch(["renderer","opacity","title","visible"],(()=>this._constructLegendElementsForBuildingSceneLayer()));if(this._handles.add(e,"sublayers-watcher"),!this.respectLayerVisibility||r.visible){const e=r&&null!=r.opacity?r.opacity:null,l=null!=e?e*t:t;if("building-group"===r.type){const e={type:"symbol-table",title:r.title,infos:[]},t=await this._generateLegendElementsForBuildingSublayers(r.sublayers,l);e.infos.push(...t),s=[e,...s];}else if(r.renderer){s=[...await this._getRendererLegendElements(r.renderer,{title:r.title,opacity:l,sublayer:r}),...s];}}}return s.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _constructLegendElementsForSublayers(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(f$b(e,"sublayers",(()=>this._constructLegendElementsForSublayers)),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready");}catch(t){J.warn("Request to server for legend has failed!",t);}}async _generateLegendElementsForSublayers(e,t,s){const l=this.layer;let r=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForSublayers())),"sublayers-watcher");let i=e.toArray();!s&&this.sublayerIds&&this.sublayerIds.length&&(i=this.sublayerIds.map((e=>l.findSublayerById(e))).filter(Boolean));for(const n of i){const e=n.watch("renderer, opacity, title, visible, legendEnabled",(()=>this._constructLegendElementsForSublayers()));if(this._handles.add(e,"sublayers-watcher"),!this.respectLayerVisibility||n.visible&&n.legendEnabled&&this._isSublayerInScale(n)){const e=n&&null!=n.opacity?n.opacity:null,l=null!=e?e*t:t;if(n.renderer&&!n.sublayers&&n.originIdOf("renderer")>2){await n.load();r=[...await this._getRendererLegendElements(n.renderer,{title:n.title,opacity:l,sublayer:n}),...r];}else {const e=await this._generateSymbolTableElementForSublayer(n,l,s);e&&r.unshift(e);}}}return r.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _generateSymbolTableElementForSublayer(e,t,s){if(!s){s=new Map;const t=this.layer,l=e.source;let r=null;if(!(!l||"map-layer"===l.type&&l.mapLayerId===e.id&&(!l.gdbVersion||l.gdbVersion===("gdbVersion"in t&&t.gdbVersion)))||e.originIdOf("renderer")>2||e.originIdOf("labelingInfo")>2||e.originIdOf("labelsVisible")>2){const e=new c$m({layer:this.layer});r=e.hasDynamicLayers?e.dynamicLayers:null,e.destroy();}const i=r||`${t.uid}-default`;(await this._getLegendLayers(i,r)).forEach((e=>s.set(e.layerId,e)));}const l=s.get(e.id);if(!l&&e.sublayers){const l=await this._generateLegendElementsForSublayers(e.sublayers,t,s);return {type:"symbol-table",title:e.title,infos:l}}return this._generateSymbolTableElementForLegendLayer(l,e,t)}_generateSymbolTableElementForLegendLayer(e,t,s){var l;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const r=null==t?void 0:t.renderer;let i=(null==t?void 0:t.title)||e.layerName;if(r&&(!t||(null==t?void 0:t.originIdOf("renderer"))>2)){const e=(null==t?void 0:t.title)||this._getRendererTitle(r,t);e&&(i&&"string"!=typeof e&&"title"in e&&(e.title=i),i=e);}const n={type:"symbol-table",title:i,legendType:e.legendType?e.legendType:null,infos:[]},a=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return (null==(l=e.legendGroups)?void 0:l.length)>0?e.legendGroups.forEach((t=>{var l;const r={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(a.filter((e=>e.groupId===t.id)),e.layerId,s)};(null==(l=r.infos)?void 0:l.length)>0&&n.infos.push(r);})):n.infos=this._generateSymbolTableElementInfosForLegendLayer(a,e.layerId,s),n.infos.length>0?n:null}_generateSymbolTableElementInfosForLegendLayer(e,t,l){return e.map((e=>{let r=e.url;if(e.imageData&&e.imageData.length>0)r=`data:image/png;base64,${e.imageData}`;else {if(0===r.indexOf("http"))return null;r=i$l(`${this.layer.url}/${t}/images/${r}`);}return {label:e.label,src:r,opacity:null==l?this.opacity:l,width:e.width,height:e.height}})).filter((e=>!!e))}_isSublayerInScale(e){const t=e.minScale||0,s=e.maxScale||0;return !(t>0&&t<this.scale||s>this.scale)}_isLegendLayerInScale(e,t){const s=t||this.layer;let l=null,r=null,i=!0;return !s.minScale&&0!==s.minScale||!s.maxScale&&0!==s.maxScale?(0===e.minScale&&s.tileInfo&&(l=s.tileInfo.lods[0].scale),0===e.maxScale&&s.tileInfo&&(r=s.tileInfo.lods[s.tileInfo.lods.length-1].scale)):(l=Math.min(s.minScale,e.minScale)||s.minScale||e.minScale,r=Math.max(s.maxScale,e.maxScale)),(l>0&&l<this.scale||r>this.scale)&&(i=!1),i}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;const s=t.renderer,l=e.some((e=>e.values));let r=null,i=null;return l&&e.some(((e,t)=>(e.values||(r=t,i=e,i.label||(i.label="others")),null!=i))),s?"unique-value"===s.type?i&&(e.splice(r,1),e.push(i)):"class-breaks"===s.type&&(i&&e.splice(r,1),e.reverse(),i&&e.push(i)):i&&(e.splice(r,1),e.push(i)),e}async _getRendererLegendElements(e,t={}){return ge$1(e,this.view)?de$1(e)?this._constructPointCloudRendererLegendElements(e,t):fe$1(e)?this._constructDotDensityRendererLegendElements(e):this._constructRendererLegendElements(e,t):(J.warn(`Renderer of type '${e.type}' not supported!`),[])}_getPointCloudRendererTitle(e){return e.legendOptions&&e.legendOptions.title||e.field}_constructPointCloudRendererLegendElements(e,t={}){const s=t.title,l=[];let r=null,i=null;if(he$1(e))r={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((e=>{r.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:this._getAppliedCloneSymbol(te$2,e.color)});}));else if(me$1(e)){const t=e.stops;let l=null;if(t.length&&(1===t.length&&(l=t[0].color),!l)){const e=t[0].value,s=t[t.length-1].value;if(null!=e&&null!=s){l=u$b(e+(s-e)/2,t);}}r={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(te$2,l||te$2.color)}]};const n=a$c(e.stops);i={type:"color-ramp",title:s||this._getPointCloudRendererTitle(e),infos:n,preview:p$m(n.map((e=>e.color)))};}else pe$1(e)&&(r={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((e=>{r.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:this._getAppliedCloneSymbol(te$2,e.color)});})));r&&r.infos.length&&l.push(r),i&&i.infos.length&&l.push(i);const n=l.reduce(((e,t)=>e.concat(t.infos)),[]).filter((e=>!!e.symbol)).map((t=>this._getSymbolPreview(t,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})));return T$1(n).then((()=>l))}_getElementInfoForDotDensity(e,t){const{backgroundColor:s,outline:l,dotSize:r}=e,i=this.effect,n=r+"-"+t+"-"+s+"-"+(l&&JSON.stringify(l.toJSON()))+"-"+i,a=this._dotDensityUrlCache,o=a.has(n)?a.get(n):y$9(e,t,{effect:i});return a.set(n,o),{opacity:1,src:o.src,preview:o,width:o.width,height:o.height}}_constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),s=e.legendOptions&&e.legendOptions.unit,l={type:"symbol-table",title:{value:t&&Math.round(t),unit:s||""},infos:[]};return e.attributes.forEach((t=>{const s=this._getElementInfoForDotDensity(e,t.color);s.label=t.label||t.valueExpressionTitle||t.field,l.infos.push(s);})),Promise.resolve([l])}async _constructRendererLegendElements(e,t={}){const{title:s,sublayer:l}=t,r=l||this.layer;let i=await this._loadRenderer(e);this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const n=await this._getVisualVariableLegendElements(i,r)||[],a={type:"symbol-table",title:s||this._getRendererTitle(i,r),infos:[]};let o=null,c=!1;const y=new Set;if(Fe(i)){let e=s;const t=Ve(i)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",l=n.findIndex((e=>"color-ramp"===e.type)),r=-1!==l?n.splice(l,1)[0]:null,a=n.findIndex((e=>"size-ramp"===e.type)),o=-1!==a?n.splice(a,1)[0]:null,u=[];r&&(e=r.title,u.push(r)),o&&(e=o.title,u.push(o)),u.length>0&&n.push({type:t,title:e,infos:u});}else if(ce$1(i)){const e=r$2(i);n.push({type:"heatmap-ramp",title:s,infos:e,preview:p$m(e.map((e=>e.color)),{effect:this.effect})});}else if(ue$1(i)){const e=i&&i.authoringInfo;if(e&&"relationship"===e.type){const{focus:t,numClasses:s,field1:l,field2:o}=e;if(s&&l&&o){const e=[l,o];let u=f$9(t)||0;for(const t of e){const{field:e,normalizationField:s,label:l}=t,i=l||{field:this._getFieldAlias(e,r),normField:s&&this._getFieldAlias(s,r)},n=Te.clone();n.angle=u,a.infos.push({label:i,symbol:n}),y.add(n),u+=90;}const c=i$g({focus:t,numClasses:s,infos:i.uniqueValueInfos});n.unshift(c);}}else {const e=i.field;i.uniqueValueInfos.forEach((t=>{t.symbol&&a.infos.push({label:t.label||this._getDomainName(e,t.value,r)||t.value,value:t.value,symbol:t.symbol});}));}i.defaultSymbol&&(a.infos.push({label:i.defaultLabel||"others",symbol:i.defaultSymbol}),c=!0);}else if(oe$2(i)){o=this._isUnclassedRenderer(i);(!o||!this._hasSizeRamp)&&(i.classBreakInfos.forEach((e=>{e.symbol&&a.infos.unshift({label:e.label||(o?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol});})),o&&(a.title=null),this._updateInfosforClassedSizeRenderer(i,a.infos)),i.defaultSymbol&&!o&&(a.infos.push({label:i.defaultLabel||"others",symbol:i.defaultSymbol}),c=!0);}else if(ie$1(i)){var h,m;if(Ie(this.layer)&&"Map"===(null==(h=this.layer)||null==(m=h.raster)?void 0:m.tileType))this._getServerSideLegend();else if(Ie(this.layer)||Ce(this.layer)){const e=this._constructTileImageryStretchRendererElements(i);Re(e)?n.push(e):a.infos=e;}else {const e=this.layer;let t,s;var p,f;if(i.statistics&&i.statistics.length)t=null!=i.statistics[0].min?i.statistics[0].min:i.statistics[0][0],s=null!=i.statistics[0].max?i.statistics[0].max:i.statistics[0][1];else t=null==(p=i)?void 0:p.outputMin,s=null==(f=i)?void 0:f.outputMax;let l=[];const r=e$9(e.renderingRule?await e.generateRasterInfo(e.renderingRule):e.serviceRasterInfo),o=r.keyProperties.BandProperties;1===r.bandCount?(t=null!=t?t:r.statistics&&r.statistics[0].min,s=null!=s?s:r.statistics&&r.statistics[0].max,t||s?n.push(this._getStretchLegendElements(i,{min:t,max:s})):this._getServerSideLegend()):e.bandIds&&1===e.bandIds.length?(t=null!=t?t:r.statistics&&r.statistics[e.bandIds[0]].min,s=null!=s?s:r.statistics&&r.statistics[e.bandIds[0]].max,t||s?n.push(this._getStretchLegendElements(i,{min:t,max:s})):this._getServerSideLegend()):r.bandCount>=3?o&&o.length>=r.bandCount?e.bandIds&&3===e.bandIds.length?(l=e.bandIds.map((e=>o[e].BandName)),a.infos=this._createSymbolTableElementMultiBand(l)):"lerc"===e.format?(l=[0,1,2].map((e=>o[e].BandName)),a.infos=this._createSymbolTableElementMultiBand(l)):this._getServerSideLegend():"lerc"===e.format?(l=["band1","band2","band3"],a.infos=this._createSymbolTableElementMultiBand(l)):this._getServerSideLegend():this._getServerSideLegend();}}else if(re$2(i))i.colormapInfos.forEach((e=>{a.infos.push({label:e.label,value:e.value,symbol:this._getAppliedCloneSymbol(se$2,e.color)});}));else if(ae$1(i)){let e=i.symbol;switch(t.geometryType){case"point":e="pointSymbol"in r&&r.pointSymbol;break;case"polyline":e="lineSymbol"in r&&r.lineSymbol;break;case"polygon":e="polygonSymbol"in r&&r.polygonSymbol;}i.symbol&&!this._hasSizeRamp&&a.infos.push({label:i.label,symbol:e});}else if(le$1(i)){i.outputUnit&&(this.title="("+i.toJSON().outputUnit+")"),a.title=i.attributeField;const e=i.getClassBreakInfos();null!=e&&e.length?e.forEach((e=>{a.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol});})):a.infos.push({label:i.attributeField,symbol:i.getDefaultSymbol()});}else ne$1(i)&&n.push(this._getStretchLegendElements(i,{min:0,max:255}));const g=i.defaultSymbol;!g||c||ae$1(i)||o&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||n.push({type:"symbol-table",infos:[{label:i.defaultLabel||"others",symbol:g}]}),a.infos.length&&n.unshift(a);const b=null==t.opacity?this.opacity:t.opacity,S=this._isTallSymbol("visualVariables"in i&&i.visualVariables),_=Ee(this.layer)||Ie(this.layer),v=n.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!(null==e||!e.symbol))).map((e=>this._getSymbolPreview(e,b,{isDefault:e.symbol===g,applyScaleDrivenSize:!y.has(e.symbol),symbolConfig:{isTall:S,isSquareFill:_},effect:y.has(e.symbol)?null:this.effect})));return i=null,await T$1(v),n}_getServerSideLegend(){setTimeout((()=>this.buildLegendElementsForTools()),0);}_getAllInfos(e){const t=null==e?void 0:e.infos;return t?t.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]):[e]}_constructTileImageryStretchRendererElements(e){var t,s;const l=this.layer,r=l.rasterInfo,i=r.bandCount||e.statistics.length;let n,a,o=[];const u=r.keyProperties&&r.keyProperties.BandProperties,c=null!=e&&null!=(t=e.statistics)&&t.length?e.statistics:null==r?void 0:r.statistics;if(c)n=void 0!==c[0].min?c[0].min:c[0][0],a=c[0].max||c[0][1];else {const e=ee$2[l.rasterInfo.pixelType.toLowerCase()];n=e[0],a=e[1];}if(l.hasStandardTime()&&(n=l.getStandardTimeValue(n),a=l.getStandardTimeValue(a)),1===r.bandCount||1===(null==(s=l.bandIds)?void 0:s.length))return this._getStretchLegendElements(e,{min:n,max:a});function d(e){var t;const s=(null!=l&&null!=(t=l.bandIds)&&t.length?l.bandIds:Array.from(Array(Math.min(r.bandCount,3)).keys())).map((t=>e&&e[t]&&e[t].BandName||"band"+(t+1)));return s.length<3?s.push(s[1]):s.length>3&&s.splice(3),s}return o=u&&u.length>=i?d(u):d(),this._createSymbolTableElementMultiBand(o)}_getStretchLegendElements(e,t){const s=e.colorRamp,l=i$h(s,t);return {type:"stretch-ramp",title:"",infos:l,preview:p$m(l.map((e=>e.color)))}}_createSymbolTableElementMultiBand(e){const t=[],s=["red","green","blue"];return e.forEach(((e,l)=>{t.push({label:{colorName:s[l],bandName:e},src:e$4[l],opacity:1});})),t}_updateInfosforClassedSizeRenderer(e,t){const s=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,l=e.classBreakInfos.some((e=>w$7(e.symbol)));if(s&&l){const s=u$a,l=c$j,r=e.classBreakInfos.length,i=(s-l)/(r>1?r-1:r);t.forEach(((e,t)=>{e.size=s-i*t;}));}}_isTallSymbol(e){let t=!1,s=!1;if(e)for(let l=0;l<e.length&&(!t||!s);l++){const r=e[l];"size"===r.type&&("height"===r.axis&&(t=!0),"width-and-depth"===r.axis&&(s=!0));}return t&&s}async _getSymbolPreview(e,t,s){let l=null!=s&&s.isDefault||null!=e.size||!this._hasSizeRamp?e.size:e$a(22);if(this._scaleDrivenSizeVariable&&null!=s&&s.applyScaleDrivenSize){const{getSize:t}=await import('./MapView-2c43b6d4.js').then(function (n) { return n.ke; });l=t(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===e.symbol.type?e.symbol.style:null});}return h$c(e.symbol,{size:l,opacity:t,scale:!1,symbolConfig:null==s?void 0:s.symbolConfig,effect:null==s?void 0:s.effect}).then((t=>(e.preview=t,e))).catch((()=>(e.preview=null,e)))}async _loadRenderer(e){var t,s;const l=[],r=this.layer;e=e.clone(),this._hasClusterSizeVariable=!1;const i="visualVariables"in e&&(null==(t=e.visualVariables)?void 0:t.some((e=>"size"===e.type&&"outline"!==e.target&&!Y$2.test(e.valueExpression))));if(e&&"visualVariables"in e&&!i&&"featureReduction"in r&&"cluster"===(null==(s=r.featureReduction)?void 0:s.type)){const t=this.layerView._effectiveRenderer,s=e$9(a$d(t,this.view));if(s){const t=r.featureReduction;if("clusterMinSize"in t&&"clusterMaxSize"in t){const{clusterMinSize:e,clusterMaxSize:l}=t;s.legendOptions=new a$e({showLegend:e!==l});}const l=e.visualVariables||[];e.visualVariables=l.concat([s]),this._hasClusterSizeVariable=!0;}}const n=await this._getMedianColor(e);if(oe$2(e)||ue$1(e)){const t=(e.classBreakInfos||e.uniqueValueInfos).map((e=>this._fetchSymbol(e.symbol,n).then((t=>{e.symbol=t;})).catch((()=>{e.symbol=null;}))));Array.prototype.push.apply(l,t);}return l.push(this._fetchSymbol(e.symbol||e.defaultSymbol,e.defaultSymbol?null:n).then((t=>{this._applySymbolToRenderer(e,t,ae$1(e));})).catch((()=>{this._applySymbolToRenderer(e,null,ae$1(e));}))),T$1(l).then((()=>e))}_applySymbolToRenderer(e,t,s){s?e.symbol=t:e.defaultSymbol=t;}async _getMedianColor(e){if(!("visualVariables"in e)||!e.visualVariables)return null;const t=e.visualVariables.find((e=>"color"===e.type));if(!t)return null;let s=null,l=null;if(t.stops){if(1===t.stops.length)return t.stops[0].color;s=t.stops[0].value,l=t.stops[t.stops.length-1].value;}const r=s+(l-s)/2,{getColor:i}=await import('./MapView-2c43b6d4.js').then(function (n) { return n.ke; });return i(t,r)}_fetchSymbol(e,t){if(!e)return Promise.reject();if("web-style"===e.type){const s=e.portal,l=s&&s.url,r=s&&s.user&&s.user.username,i=e.name+"-"+e.styleName+"-"+e.styleUrl+"-"+l+"-"+r,n=this._webStyleSymbolCache;return n.has(i)||("2d"===this.view.type?n.set(i,e.fetchCIMSymbol()):n.set(i,e.fetchSymbol())),n.get(i).then((e=>this._getAppliedCloneSymbol(e,t))).catch((()=>(J.warn("Fetching web-style failed!"),Promise.reject())))}return Promise.resolve(this._getAppliedCloneSymbol(e,t))}_getAppliedCloneSymbol(e,s){if(!e||!s)return e;const l=e.clone(),r=s&&s.toRgba();return l.type.indexOf("3d")>-1?this._applyColorTo3dSymbol(l,r):"cim"===l.type?I$6(l,s):l.color&&(l.color=new h$b(r||l.color)),l}_applyColorTo3dSymbol(e,s){s&&e.symbolLayers.forEach((e=>{e&&(e.material||(e.material={}),e.material.color=new h$b(s));}));}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||"vector-field"===e.type)return null;const s=e.visualVariables,l=[],r=[],i=[];for(const c of s)"color"===c.type?l.push(c):"size"===c.type?r.push(c):"opacity"===c.type&&i.push(c);const n=[...l,...r,...i];let a,o;if(0===l.length&&oe$2(e)&&e.classBreakInfos&&1===e.classBreakInfos.length){const t=e.classBreakInfos[0];a=t&&t.symbol;}if(0===l.length&&ae$1(e)&&(a=e.symbol),a)if(a.type.indexOf("3d")>-1){const e=a.symbolLayers.getItemAt(0);"water"===e.type?r$6(e.color)&&(o=e.color):r$6(e.material)&&r$6(e.material.color)&&(o=e.material.color);}else a.url||(o=a.color);const u=this.effect;return (await Promise.all(n.map((async s=>{if(!s.legendOptions||!1!==s.legendOptions.showLegend){const l=this._getRampTitle(s,t);let r=null;const i="getField"in t&&t.getField&&t.getField(s.field),n=i&&K$3(i);if("color"===s.type){const e=await r$3(s,null,n);r={type:"color-ramp",title:l,infos:e,preview:p$m(e.map((e=>e.color)),{effect:u})},this._hasColorRamp||(this._hasColorRamp=!(null==r.infos||!r.infos.length));}else if("size"===s.type&&"outline"!==s.target)Y$2.test(s.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=s):(r={type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(s):l,infos:await S$4(e,s,await this._getMedianColor(e),this.scale,this.view.type,n)},this._hasSizeRamp||(this._hasSizeRamp=!(null==r.infos||!r.infos.length)));else if("opacity"===s.type){const e=await r$3(s,o,n);r={type:"opacity-ramp",title:l,infos:e,preview:p$m(e.map((e=>e.color)),{effect:u})},this._hasOpacityRamp||(this._hasOpacityRamp=!(null==r.infos||!r.infos.length));}return r&&r.infos?r:null}})))).filter((e=>!!e))}_getDomainName(e,t,s){if(e&&"function"!=typeof e){const l="getField"in s&&s.getField&&s.getField(e),r=l&&"getFieldDomain"in s&&s.getFieldDomain?s.getFieldDomain(l.name):null;return r&&"coded-value"===r.type?r.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,s=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){const e=t.featureReduction,l="popupTemplate"in e&&e.popupTemplate,r=l&&l.fieldInfos;if(r)for(const t of r)if(t.fieldName===s)return "cluster_count"===s?t.label||{showCount:!0}:t.label}return {showCount:!0}}_getRampTitle(e,t){let s=e.field,l=e.normalizationField,r=!1,i=!1,n=!1,a=null;s="function"==typeof s?null:s,l="function"==typeof l?null:l;const o=e.legendOptions&&e.legendOptions.title;if(null!=o)a=o;else if(e.valueExpressionTitle)a=e.valueExpressionTitle;else {if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables){const e=t.renderer.authoringInfo.visualVariables;for(let t=0;t<e.length;t++){const s=e[t];if("color"===s.type){if("ratio"===s.style){r=!0;break}if("percent"===s.style){i=!0;break}if("percent-of-total"===s.style){n=!0;break}}}}a={field:s&&this._getFieldAlias(s,t),normField:l&&this._getFieldAlias(l,t),ratio:r,ratioPercent:i,ratioPercentTotal:n};}return a}_getRendererTitle(e,t){const s=e;if(s.legendOptions&&s.legendOptions.title)return s.legendOptions.title;if(s.valueExpressionTitle)return s.valueExpressionTitle;let l=s.field,r=null,i=null;oe$2(s)&&(r=s.normalizationField,i="percent-of-total"===s.normalizationType),l="function"==typeof l?null:l,r="function"==typeof r?null:r;let n=null;return (l||r)&&(n={field:l&&this._getFieldAlias(l,t),normField:r&&this._getFieldAlias(r,t),normByPct:i}),n}_getFieldAlias(e,t){const s="popupTemplate"in t&&t.popupTemplate,l=s&&s.fieldInfos;let r=null;l&&l.some((t=>e===t.fieldName&&(r=t,!0)));let i=null;"getField"in t&&t.getField?i=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(i=t.fieldsIndex.get(e));const n=r||i;let a=null;return n&&(a=r&&r.label||i&&i.alias||"name"in n&&n.name||"fieldName"in n&&n.fieldName),a}_isUnclassedRenderer(e){const t=e.visualVariables;let s=!1;return oe$2(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(s=e.field?t.some((t=>!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField))):!!t.length),s}};e$6([d$b()],xe.prototype,"children",void 0),e$6([d$b({readOnly:!0})],xe.prototype,"effect",null),e$6([d$b()],xe.prototype,"layerView",void 0),e$6([d$b()],xe.prototype,"layer",void 0),e$6([d$b()],xe.prototype,"legendElements",void 0),e$6([d$b({readOnly:!0})],xe.prototype,"opacity",null),e$6([d$b()],xe.prototype,"parent",void 0),e$6([d$b({readOnly:!0,dependsOn:[]})],xe.prototype,"ready",null),e$6([d$b()],xe.prototype,"hideLayersNotInCurrentView",void 0),e$6([d$b()],xe.prototype,"keepCacheOnDestroy",void 0),e$6([d$b()],xe.prototype,"respectLayerVisibility",void 0),e$6([d$b({readOnly:!0})],xe.prototype,"scale",null),e$6([d$b()],xe.prototype,"sublayerIds",void 0),e$6([d$b({readOnly:!0})],xe.prototype,"isScaleDriven",null),e$6([d$b()],xe.prototype,"title",void 0),e$6([d$b({readOnly:!0,dependsOn:["ready"],value:0})],xe.prototype,"version",null),e$6([d$b()],xe.prototype,"view",void 0),xe=e$6([i$j("esri.widgets.Legend.support.ActiveLayerInfo")],xe);const je=xe;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const h$8={state:"state",view:"view",allLayerViews:"all-layer-views",legendProperties:"legend-properties"},c$i=S$7.ofType(je),L$5=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],_$1="view.basemapView.baseLayerViews",f$7="view.groundView.layerViews",v$4="view.basemapView.referenceLayerViews",p$i=[_$1,f$7,"view.layerViews",v$4];let u$9=class extends p$l{constructor(e){super(e),this._handles=new u$e,this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new S$7,this.activeLayerInfos=new c$i,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null;}initialize(){this._handles.add(i$m(this,"view",this._viewHandles),h$8.view),this._handles.add(g$9((()=>this._refresh())));}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null;}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove(h$8.state),this.view&&this._handles.add(i$m(this,"state",this._stateHandles),h$8.state);}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews();}_resetAll(){this._handles.remove([h$8.allLayerViews,h$8.legendProperties]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll();}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this);}_destroyViewActiveLayerInfo(e){this._handles.remove(e);const i=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],i&&i.parent&&i.parent.children.remove(i);}_watchPropertiesAndAllLayerViews(){const{allLayerViews:e}=this.view;e.length&&this._refresh(),this._handles.add(e.on("change",this._allLayerViewsChangeHandle.bind(this)),h$8.allLayerViews),this._handles.add(f$b(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),h$8.legendProperties);}_allLayerViewsChangeHandle(e){e.removed.forEach((e=>this._destroyViewActiveLayerInfo(e.uid))),this._refresh();}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh();}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos);}_sortActiveLayerInfos(e){if(e.length<2)return;const i=[];e.forEach((r=>{if(!r.parent){const t=r.layer.parent,s=t&&"uid"in t&&this._layerViewByLayerId[t.uid],a=s&&this._activeLayerInfosByLayerViewId[s.uid];a&&-1!==e.indexOf(a)&&(i.push(r),r.parent=a,a.children.add(r),this._sortActiveLayerInfos(a.children));}})),e.removeMany(i);const r={};this.view.allLayerViews.forEach(((e,i)=>r[e.layer.uid]=i)),e.sort(((e,i)=>{const t=r[e.layer.uid]||0;return (r[i.layer.uid]||0)-t}));}_generateLayerViews(){const e=[];return p$i.filter(this._filterLayerViews,this).map(this.get,this).filter((e=>null!=e)).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const i=!this.basemapLegendVisible&&(e===_$1||e===v$4),r=!this.groundLegendVisible&&e===f$7;return !i&&!r}_collectLayerViews(e,i){const r=t=>(t&&t.forEach((t=>{i.push(t),r(t[e]);})),i);return r}_filterLayerViewsByLayerInfos(e){const i=this.layerInfos;return !i||!i.length||i.some((i=>this._hasLayerInfo(i,e)))}_hasLayerInfo(e,i){const r=this._isLayerUIDMatching(e.layer,i.layer.uid);return r&&(this._layerInfosByLayerViewId[i.uid]=e),r}_isLayerUIDMatching(e,i){return e&&(e.uid===i||this._hasLayerUID(e.layers,i))}_hasLayerUID(e,i){return e&&e.some((e=>this._isLayerUIDMatching(e,i)))}_isLayerViewSupported(e){return !!L$5.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add(f$b(e,"legendEnabled, layer.legendEnabled",(()=>this._layerActiveHandle(e))),e.uid));}_layerActiveHandle(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e));}_isLayerActive(e){return !this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}_buildActiveLayerInfo(e){var i;const r=e.layer,t=e.uid,s=this._layerInfosByLayerViewId[t];let o=this._activeLayerInfosByLayerViewId[t];if(!o){const i=s&&void 0!==s.title&&s.layer.uid===r.uid;o=new je({layer:r,layerView:e,title:i?s.title:r.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:s&&s.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[t]=o;}const l=r.parent&&"uid"in r.parent&&this._layerViewByLayerId[null==(i=r.parent)?void 0:i.uid];if(o.parent=this._activeLayerInfosByLayerViewId[null==l?void 0:l.uid],!this._handles.has(t)){const i=[f$b(r,"title",(e=>this._titleHandle(e,o))),f$b(r,"renderer?, opacity, pointSymbol?, lineSymbol?, polygonSymbol?",(()=>this._constructLegendElements(o))),v$6(this.view,"stationary",(()=>this._scaleHandle(o))),f$b(e,"_effectiveRenderer",(()=>this._constructLegendElements(o))),f$b(r,"effect",(()=>this._constructLegendElements(o)))];if(this.respectLayerVisibility){const t=f$b(e,"legendEnabled",(e=>this._legendEnabledHandle(e,o))),s=f$b(r,"legendEnabled",(e=>this._legendEnabledHandle(e,o)));i.push(t,s);}this._handles.add(i,t);}o.isScaleDriven||this._constructLegendElements(o),this._addActiveLayerInfo(o);}_titleHandle(e,i){i.title=e,this._constructLegendElements(i);}_legendEnabledHandle(e,i){e?this._addActiveLayerInfo(i):this._removeActiveLayerInfo(i);}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e);}_addActiveLayerInfo(e){const{layerView:i,layer:r}=e;if(this._isLayerActive(i)&&-1===this.activeLayerInfos.indexOf(e)){const i=e.parent;if(i)-1===i.children.indexOf(e)&&i.children.push(e),this._sortActiveLayerInfos(i.children);else {var t;const i=null==(t=this.layerInfos)?void 0:t.some((e=>e.layer.uid===r.uid));r.parent&&"uid"in r.parent&&!i?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos));}if(this._activeLayerInfosWithNoParent.length){const e=[];this._activeLayerInfosWithNoParent.forEach((i=>{const r=i.layer.parent,t=r&&"uid"in r&&this._layerViewByLayerId[null==r?void 0:r.uid],s=this._activeLayerInfosByLayerViewId[null==t?void 0:t.uid];s&&(e.push(i),i.parent=s);})),e.length&&(this._activeLayerInfosWithNoParent.removeMany(e),e.forEach((e=>this._addActiveLayerInfo(e))));}}}_removeActiveLayerInfo(e){const i=e.parent;i?i.children.remove(e):this.activeLayerInfos.remove(e);}_constructLegendElements(e){const i=e.layer;"featureCollections"in i&&i.featureCollections?e.buildLegendElementsForFeatureCollections(i.featureCollections):"renderer"in i&&i.renderer?e.buildLegendElementsForRenderer(i.renderer):"url"in i&&i.url?e.buildLegendElementsForTools():e.children.forEach((e=>this._constructLegendElements(e)));}};e$6([d$b({type:c$i})],u$9.prototype,"activeLayerInfos",void 0),e$6([d$b()],u$9.prototype,"basemapLegendVisible",void 0),e$6([d$b()],u$9.prototype,"groundLegendVisible",void 0),e$6([d$b()],u$9.prototype,"hideLayersNotInCurrentView",void 0),e$6([d$b()],u$9.prototype,"keepCacheOnDestroy",void 0),e$6([d$b()],u$9.prototype,"respectLayerVisibility",void 0),e$6([d$b()],u$9.prototype,"layerInfos",void 0),e$6([d$b({readOnly:!0})],u$9.prototype,"state",null),e$6([d$b()],u$9.prototype,"view",void 0),u$9=e$6([i$j("esri.widgets.Legend.LegendViewModel")],u$9);const I$3=u$9;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const d$9="http://www.w3.org/2000/svg",m$8={diamondContainer:"esri-relationship-ramp--diamond__container",diamondLeftCol:"esri-relationship-ramp--diamond__left-column",diamondRightCol:"esri-relationship-ramp--diamond__right-column",diamondMidCol:"esri-relationship-ramp--diamond__middle-column",diamondMidColLabel:"esri-relationship-ramp--diamond__middle-column--label",diamondMidColRamp:"esri-relationship-ramp--diamond__middle-column--ramp",squareTable:"esri-relationship-ramp--square__table",squareTableRow:"esri-relationship-ramp--square__table-row",squareTableCell:"esri-relationship-ramp--square__table-cell",squareTableLabel:"esri-relationship-ramp--square__table-label",squareTableLabelLeftBottom:"esri-relationship-ramp--square__table-label--left-bottom",squareTableLabelRightBottom:"esri-relationship-ramp--square__table-label--right-bottom",squareTableLabelLeftTop:"esri-relationship-ramp--square__table-label--left-top",squareTableLabelRightTop:"esri-relationship-ramp--square__table-label--right-top"};function u$8(e,a,r,l){const{focus:t,labels:s}=e,i=!!t,d=p$h(e,a,r,l);return i?n$i("div",{class:m$8.diamondContainer},n$i("div",{class:m$8.diamondLeftCol},s.left),n$i("div",{class:m$8.diamondMidCol},n$i("div",{class:m$8.diamondMidColLabel},s.top),d,n$i("div",{class:m$8.diamondMidColLabel},s.bottom)),n$i("div",{class:m$8.diamondRightCol},s.right)):n$i("div",{class:m$8.squareTable},n$i("div",{class:m$8.squareTableRow},n$i("div",{class:l$e(m$8.squareTableCell,m$8.squareTableLabel,m$8.squareTableLabelRightBottom)},s.left),n$i("div",{class:m$8.squareTableCell}),n$i("div",{class:l$e(m$8.squareTableCell,m$8.squareTableLabel,m$8.squareTableLabelLeftBottom)},s.top)),n$i("div",{class:m$8.squareTableRow},n$i("div",{class:m$8.squareTableCell}),d,n$i("div",{class:m$8.squareTableCell})),n$i("div",{class:m$8.squareTableRow},n$i("div",{class:l$e(m$8.squareTableCell,m$8.squareTableLabel,m$8.squareTableLabelRightTop)},s.bottom),n$i("div",{class:m$8.squareTableCell}),n$i("div",{class:l$e(m$8.squareTableCell,m$8.squareTableLabel,m$8.squareTableLabelLeftTop)},s.right)))}function b$4(e,a,r){const l=`${r}_arrowStart`,t=`${r}_arrowEnd`,s="left"===e,i={markerStart:null,markerEnd:null};switch(a){case"HL":s?i.markerStart=`url(#${t})`:i.markerEnd=`url(#${l})`;break;case"LL":i.markerStart=`url(#${t})`;break;case"LH":s?i.markerEnd=`url(#${l})`:i.markerStart=`url(#${t})`;break;default:i.markerEnd=`url(#${l})`;}return i}function p$h(o,u,p,c,h=60){const{focus:q,numClasses:f,colors:k,rotation:T}=o,_=!!q,L=Math.sqrt(h**2+h**2)+(_?0:5),g=[],C=[],v=[],w=(h||75)/f;for(let s=0;s<f;s++){const i=s*w;for(let o=0;o<f;o++){const n=o*w,d=v$7(k[s][o]),m=A$2(null),u={type:"rect",x:n,y:i,width:w,height:w};g.push(I$7(d)),C.push(b$9(u,d.fill,m,null)),v.push(T$2(u));}}const y=10,x=15,R=15,$=10;let E=null;_||(E="margin: -15px -15px -18px -15px");const M=b$4("left",q,u),S=b$4("right",q,u),j=U$2(v),B=L$8(j,L,L,0,!1,T,!1),H=L$8(j,L,L,0,!1,_?-45:null,!1);return n$i("div",{styles:{filter:c,opacity:null==p?null:`${p}`},class:_?m$8.diamondMidColRamp:m$8.squareTableCell},n$i("svg",{xmlns:d$9,width:L,height:L,style:E},n$i("defs",null,n$i("marker",{id:`${u}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},n$i("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),n$i("marker",{id:`${u}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},n$i("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),g),n$i("g",{transform:B},C),n$i("g",{transform:H},n$i("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":M.markerStart,"marker-end":M.markerEnd,x1:-y,y1:h-x,x2:-y,y2:x}),n$i("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":S.markerStart,"marker-end":S.markerEnd,x1:R,y1:h+$,x2:h-R,y2:h+$}))))}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const l$9=i$n(),r$1=10,n$e=20,s$a=10,a$b=20,c$h={univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",colorRamp:"esri-legend__color-ramp"};function f$6(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return "vertical"===e?n$i("svg",{height:"4",width:"10"},n$i("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):n$i("svg",{height:"10",width:"10"},n$i("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function p$g(e,t="vertical"){const o=document.createElement("div");return o.style.height=`${n$e}px`,o.className=c$h.univariateAboveAndBelowSymbol,null!=e&&(o.style.opacity=e.toString()),l$9.append(o,f$6.bind(null,t)),o}function m$7(t,o,i="vertical",l){t.infos.forEach(((t,r)=>{if(l&&2===r)t.preview=p$g(o,i);else {const o=u$f(t.size)+("horizontal"===i?a$b:s$a),l="div"===t.preview.tagName.toLowerCase(),r=l?t.preview:document.createElement("div");r.className=c$h.univariateAboveAndBelowSymbol,"horizontal"===i?r.style.width=`${o}px`:r.style.height=`${o}px`,l||r.appendChild(t.preview),t.preview=r;}}));}function u$7(t,o="classic"){const i=t.infos;return "classic"===o?(u$f(i[0].size)+s$a)/2:(u$f(i[0].size)-u$f(i[i.length-1].size))/2}function v$3(e,t){if(!e)return null;const i=e.infos.map((e=>e.color)),l=p$m("full"===t.type?i:"above"===t.type?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effect:t.effect});return l.className=c$h.colorRamp,null!=t.opacity&&(l.style.opacity=t.opacity.toString()),l}function h$7(t,o,i,l="vertical"){let c=0;const f=t.infos,p=Math.floor(f.length/2),m="full"===o||"above"===o?0:p,u="full"===o||"below"===o?f.length-1:p;for(let v=m;v<=u;v++)if(i&&v===p)c+="horizontal"===l?r$1:n$e;else {c+=u$f(f[v].size)+("horizontal"===l?a$b:s$a);}return Math.round(c)}function y$6(t,o,i,l="vertical"){const c=h$7(t,o,i,l),f=t.infos,p=Math.floor(f.length/2),m="full"===o||"above"===o?0:p,u="full"===o||"below"===o?f.length-1:p,v="full"===o?f[m].size+f[u].size:"above"===o?f[m].size:f[u].size,y=i?"vertical"===l?n$e:r$1:0,d="vertical"===l?s$a*("full"===o?2:1):a$b*("full"===o?2:1);return Math.round(c-(u$f(v)/2+y/2+d/2))}function d$8(e,t,o="vertical"){const i=e.infos;let l=i.filter((({type:e})=>"size-ramp"===e))[0],r=i.filter((({type:e})=>"color-ramp"===e))[0];var n;(l&&(l={...l},l.infos=[...l.infos]),r&&(r={...r},r.infos=[...r.infos]),m$7(l,t,o,!0),"horizontal"===o)&&(l.infos.reverse(),null==(n=r)||n.infos.reverse());return {sizeRampElement:l,colorRampElement:r}}function g$5(e,t="vertical"){const o=e.infos;let i=o.filter((({type:e})=>"size-ramp"===e))[0],l=o.filter((({type:e})=>"color-ramp"===e))[0];var r;(i&&(i={...i},i.infos=[...i.infos]),l&&(l={...l},l.infos=[...l.infos]),m$7(i,null,t,!1),"horizontal"===t)&&(i.infos.reverse(),null==(r=l)||r.infos.reverse());return {sizeRampElement:i,colorRampElement:l}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function n$d(e,n){return n}function t$3(e){const n=this;e.appendChild(n);}function r(t,r,i){if(!r)return;if("string"==typeof r||"number"==typeof r)return r;if("value"in r||"unit"in r)return s$f(t.dotValue,r);if("colorName"in r||"bandName"in r)return t[r.colorName]+": "+(t[r.bandName]||r.bandName);if("showCount"in r)return r.showCount?t.clusterCountTitle:null;let l=null;return n$d(r,i)?l=r.ratioPercentTotal?"showRatioPercentTotal":r.ratioPercent?"showRatioPercent":r.ratio?"showRatio":r.normField?"showNormField":r.field?"showField":null:o$2(r,i)&&(l=r.normField?"showNormField":r.normByPct?"showNormPct":r.field?"showField":null),l?s$f("showField"===l?"{field}":t[l],{field:r.field,normField:r.normField}):null}function o$2(e,n){return !n}function i$f(e,n){return !!(n&&"Stretched"===n&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const L$4={activated:"esri-legend--card__carousel-indicator--activated",base:"esri-legend--card",stacked:"esri-legend--stacked",carouselTitle:"esri-legend--card__carousel-title",indicator:"esri-legend--card__carousel-indicator",intervalSeparator:"esri-legend--card__interval-separator",imageryLayerStretchedImage:"esri-legend--card__imagery-layer-image--stretched",imageLabel:"esri-legend--card__image-label",layerCaption:"esri-legend--card__layer-caption",labelElement:"esri-legend--card__label-element",layerRow:"esri-legend--card__layer-row",labelCell:"esri-legend--card__label-cell",message:"esri-legend--card__message",rampLabel:"esri-legend--card__ramp-label",section:"esri-legend--card__section",relationshipSection:"esri-legend--card__relationship-section",serviceCaptionText:"esri-legend--card__service-caption-text",serviceContent:"esri-legend--card__service-content",service:"esri-legend--card__service",groupLayer:"esri-legend--card__group-layer",groupLayerChild:"esri-legend--card__group-layer-child",symbol:"esri-legend--card__symbol",sizeRampRow:"esri-legend--card__size-ramp-row",symbolRow:"esri-legend--card__symbol-row",symbolCell:"esri-legend--card__symbol-cell",indicatorContainer:"esri-legend--card__carousel-indicator-container",intervalSeparatorsContainer:"esri-legend--card__interval-separators-container",relationshipLabelContainer:"esri-legend--card__relationship-label-container",labelContainer:"esri-legend--card__label-container",serviceCaptionContainer:"esri-legend--card__service-caption-container",symbolContainer:"esri-legend--card__symbol-container",sizeRampContainer:"esri-legend--card__size-ramp-container",sizeRampPreview:"esri-legend--card__size-ramp-preview",rampContainer:"esri-legend__ramps",sizeRampHorizontal:"esri-legend__size-ramp--horizontal",rampLabelsContainer:"esri-legend__ramp-labels",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card",hidden:"esri-hidden"},C$2=25,x$3=25,S$3=768,z$1=100,R$2="#ddd",$$3=window.devicePixelRatio;function I$2(e){if(e){if(e.type.indexOf("3d")>-1){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const s=e.symbolLayers.getItemAt(t-1),i=s.resource&&s.resource.primitive;return "circle"===i||"cross"===i||"kite"===i||"sphere"===i||"cube"===i||"diamond"===i}{const t=e.style;return "circle"===t||"diamond"===t||"cross"===t}}}function k$1(e){if(e){if(e.type.indexOf("3d")>-1){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const s=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return "triangle"===s||"cone"===s||"tetrahedron"===s}return "triangle"===e.style}}let N$1=class extends z$3{constructor(e,s){super(e,s),this._handles=new u$e,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout="stack",this.messages=null,this.messagesCommon=null,this.type="card",this.view=null;}initialize(){this.own([this.watch("activeLayerInfos",(e=>{this._handles.removeAll(),this._watchForSectionChanges(e);}))]);}destroy(){this._handles.destroy(),this._handles=null;}render(){this._hasIndicators="auto"===this.layout&&this.view.container.clientWidth<=S$3||"stack"===this.layout;const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const s=this._sectionNames.length,i=this._sectionNames.map(((e,t)=>{const i=s$f(this.messagesCommon.pagination.pageText,{index:t+1,total:s});return n$i("div",{key:e,role:"tab",id:e,"aria-label":i,"aria-controls":`${e}-panel`,"aria-selected":(this._selectedSectionName===e).toString(),tabIndex:this._selectedSectionName===e?0:-1,title:i,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes(L$4.indicator,{[L$4.activated]:this._selectedSectionName===e}),"data-section-name":e})})),r=this._hasIndicators&&s>1?n$i("div",{class:L$4.indicatorContainer,key:"carousel-navigation",role:"tablist"},i):null,a=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):t&&t.length?t:null,o={[L$4.stacked]:this._hasIndicators};return n$i("div",{class:this.classes(L$4.base,o)},a||n$i("div",{class:L$4.message},this.messages.noLegend),r)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t);}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e);}}_switchSectionOnArrowPress(e){const t=e.key,s="ArrowLeft"===t?-1:1,i=e.target.getAttribute("data-section-name"),r=this._sectionNames.indexOf(i),a=this._sectionNames;let o=null;-1!==r&&(a[r+s]?o=document.getElementById(a[r+s]):"ArrowLeft"===t?o=document.getElementById(a[a.length-1]):"ArrowRight"===t&&(o=document.getElementById(a[0])),o&&o.focus());}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach((e=>{const t=`activeLayerInfo-${e.layer.uid}-version-change`;this._handles.remove(t),this._watchForSectionChanges(e.children),this._handles.add(e.watch("version",(()=>this._generateSectionNames())),t);}));const t="activeLayerInfos-collection-change";this._handles.remove(t),this._handles.add(e.on("change",(()=>this._watchForSectionChanges(e))),t);}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this);}_getSectionName(e,t,s){return `${this.id}${e.uid}-type-${t.type}-${s}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach(((t,s)=>{this._sectionNames.push(this._getSectionName(e.layer,t,s));}));}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return n$i("div",{key:e.layer.uid,class:this.classes(L$4.service,L$4.groupLayer)},n$i("div",{class:L$4.serviceCaptionContainer},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const s=t.some((e=>"relationship-ramp"===e.type)),i=t.map(((t,i)=>this._renderLegendForElement(t,e,i,s))).filter((e=>!!e));if(!i.length)return null;const r={[L$4.groupLayerChild]:!!e.parent};return n$i("div",{key:e.layer.uid,class:this.classes(L$4.service,r)},n$i("div",{class:L$4.serviceCaptionContainer},n$i("div",{class:L$4.serviceCaptionText},e.title)),n$i("div",{class:L$4.serviceContent},i))}}_renderLegendForElement(e,t,s,i=!1){const r$1="color-ramp"===e.type,a="opacity-ramp"===e.type,o="size-ramp"===e.type,n=t.layer;let c=null;if("string"==typeof e.title)c=e.title;else if(e.title){const t=e.title,s=r(this.messages,t,r$1||a);c=t.title?`${t.title} (${s})`:s;}const d=this._getSectionName(n,e,s),p=this._hasIndicators?n$i("div",null,n$i(s$g,{level:this.headingLevel,class:L$4.carouselTitle},t.title),n$i(s$g,{level:this.headingLevel+1,class:L$4.layerCaption},c)):c?n$i(s$g,{level:this.headingLevel,class:L$4.layerCaption},c):null,m=t.effect;let h=null;if("symbol-table"===e.type){const s=e.infos.map(((s,i)=>this._renderLegendForElementInfo(s,t,e.legendType,i))).filter((e=>!!e));if(s.length){const e=s[0].properties.classes&&s[0].properties.classes[L$4.symbolRow],t={[L$4.labelContainer]:!e&&!i,[L$4.relationshipLabelContainer]:i};h=n$i("div",{class:this.classes(t)},s);}}else "color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?h=this._renderLegendForRamp(e,n.opacity,m):o?h=this._renderSizeRamp(e,n.opacity):"relationship-ramp"===e.type?h=u$8(e,this.id,n.opacity,m):"univariate-above-and-below-ramp"===e.type?h=this._renderUnivariateAboveAndBelowRamp(e,n.opacity,m):"univariate-color-size-ramp"===e.type&&(h=this._renderUnivariateColorSizeRamp(e,n.opacity,m));if(!h)return null;const g=n$i("div",{key:d,class:L$4.section,id:`${d}-panel`,role:"tabpanel","aria-labelledby":d,tabIndex:0},[p,h]);return this._sectionMap.set(d,g),g}_renderUnivariateAboveAndBelowRamp(e,t,s){const{sizeRampElement:i,colorRampElement:r}=d$8(e,t,"horizontal"),a=h$7(i,"full",!0,"horizontal"),o=y$6(i,"above",!0,"horizontal"),l=y$6(i,"below",!0,"horizontal"),h=12,y=v$3(r,{width:o,height:h,rampAlignment:"horizontal",opacity:t,type:"above",effect:s}),_=v$3(r,{width:l,height:h,rampAlignment:"horizontal",opacity:t,type:"below",effect:s}),v=u$7(i,"card"),f=i.infos.map((e=>e.label)),u=f.length-1,w=f.map(((e,t)=>0===t||t===u?n$i("div",{key:t},e):null)),C={display:"flex",flexDirection:"column"},x={display:"flex",flexDirection:"row"},S={marginTop:"3px",marginLeft:`${v}px`,display:"flex"},z={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return n$i("div",{class:L$4.layerRow,key:"size-ramp-preview",styles:C},n$i("div",{class:this.classes(L$4.symbolContainer,L$4.sizeRampHorizontal),styles:x},i.infos.map(((e,t)=>n$i("div",{key:t,class:L$4.symbol,bind:e.preview,afterCreate:t$3})))),y?n$i("div",{class:L$4.univariateAboveAndBelowColorRamp,styles:S,key:"color-ramp-preview"},n$i("div",{bind:y,afterCreate:t$3}),n$i("div",{bind:_,afterCreate:t$3})):null,n$i("div",{class:L$4.layerInfo},n$i("div",{class:L$4.rampLabelsContainer,styles:z},w)))}_renderUnivariateColorSizeRamp(e,t,s){const{sizeRampElement:i,colorRampElement:r}=g$5(e,"horizontal"),a=h$7(i,"full",!1,"horizontal"),o=y$6(i,"full",!1,"horizontal"),l=v$3(r,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"full",effect:s}),n=u$7(i,"card"),y=i.infos.length-1,_=i.infos.map(((e,t)=>0===t||t===y?n$i("div",{key:t},e.label):null)),v={display:"flex",flexDirection:"column"},f={display:"flex",flexDirection:"row"},u={marginTop:"3px",marginLeft:`${n}px`,display:"flex"},w={width:`${a}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return n$i("div",{class:L$4.layerRow,key:"size-ramp-preview",styles:v},n$i("div",{class:this.classes(L$4.symbolContainer,L$4.sizeRampHorizontal),styles:f},i.infos.map(((e,t)=>n$i("div",{key:t,class:L$4.symbol,bind:e.preview,afterCreate:t$3})))),n$i("div",{class:L$4.univariateAboveAndBelowColorRamp,styles:u,key:"color-ramp-preview"},n$i("div",{bind:l,afterCreate:t$3})),n$i("div",{class:L$4.layerInfo},n$i("div",{class:L$4.rampLabelsContainer,styles:w},_)))}_renderLegendForElementInfo(e,t,s,i){const r$1=t.layer;if(e.type)return this._renderLegendForElement(e,t,i);const a=i$f(r$1,s);if(e.preview){var o,l;if(!e.symbol||-1===e.symbol.type.indexOf("simple-fill")){if(!e.label)return n$i("div",{key:i,bind:e.preview,afterCreate:t$3});const t={[L$4.symbolCell]:this._hasIndicators};return n$i("div",{key:i,class:this.classes(L$4.layerRow,{[L$4.symbolRow]:this._hasIndicators})},n$i("div",{class:this.classes(t),bind:e.preview,afterCreate:t$3}),n$i("div",{class:this.classes(L$4.imageLabel,{[L$4.labelCell]:this._hasIndicators})},r(this.messages,e.label,!1)||""))}let s=255,a=255,n=255,c=0,d=255,p=255,m=255,h=0;const _=e.symbol.color&&e.symbol.color.a,v=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;_&&(s=e.symbol.color.r,a=e.symbol.color.g,n=e.symbol.color.b,c=e.symbol.color.a*r$1.opacity),v&&(d=e.symbol.outline.color.r,p=e.symbol.outline.color.g,m=e.symbol.outline.color.b,h=e.symbol.outline.color.a*r$1.opacity);const f=null==(o=null==(l=e.symbol.color)?void 0:l.isBright)||o,u=f?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",w={background:_?`rgba(${s}, ${a}, ${n}, ${c})`:"none",color:f?"black":"white",textShadow:`-1px -1px 0 ${u},\n                                              1px -1px 0 ${u},\n                                              -1px 1px 0 ${u},\n                                              1px 1px 0 ${u}`,border:v?`1px solid rgba(${d}, ${p}, ${m}, ${h})`:"none",filter:t.effect};return n$i("div",{key:i,class:L$4.layerRow},n$i("div",{class:L$4.labelElement,styles:w}," ",e.label," "))}if(e.src){const t=this._renderImage(e,r$1,a);return n$i("div",{key:i,class:L$4.layerRow},t,n$i("div",{class:L$4.imageLabel},e.label||""))}}_renderImage(e,t,s){const{label:i,src:r$1,opacity:a}=e,o={[L$4.imageryLayerStretchedImage]:s,[L$4.symbol]:!s},l={opacity:`${null!=a?a:t.opacity}`};return n$i("img",{alt:r(this.messages,i,!1),src:r$1,border:0,width:e.width,height:e.height,class:this.classes(o),styles:l})}_renderSizeRampLines(e){const t=e.infos,i=t[0],r=t[t.length-1],a=i.symbol,o=this._hasIndicators,l=u$f(i.size+i.outlineSize)*$$3,n=u$f(r.size+r.outlineSize)*$$3,c=o?l:l+50*$$3,d=o?l/2+50*$$3:l,p=k$1(a),m=I$2(a),h=document.createElement("canvas");h.width=c,h.height=d,h.style.width=h.width/$$3+"px",h.style.height=h.height/$$3+"px";const y=h.getContext("2d");if(o){y.beginPath();const e=0,t=0,s=c/2-n/2,i=d;y.moveTo(e,t),y.lineTo(s,i);const r=c,a=0,o=c/2+n/2,l=d;y.moveTo(r,a),y.lineTo(o,l);}else {y.beginPath();const e=0,t=d/2-n/2,s=c,i=0;y.moveTo(e,t),y.lineTo(s,i);const r=0,a=d/2+n/2,o=c,l=d;y.moveTo(r,a),y.lineTo(o,l);}return y.strokeStyle=R$2,y.stroke(),n$i("div",{bind:h,afterCreate:t$3,styles:o?{display:"flex",marginTop:`-${p?0:m?l/2:0}px`,marginBottom:`-${p?n:m?n/2:0}px`}:{display:"flex",marginRight:`-${p?0:m?l/2:0}px`,marginLeft:`-${p?0:m?n/2:0}px`}})}_renderSizeRamp(e,t){const s=e.infos,i=s[0].label,r=s[s.length-1].label;let a=s[0].preview,o=s[s.length-1].preview;const l=this._hasIndicators,n={"flex-direction":l?"column":"row-reverse"};a&&(a=a.cloneNode(!0),a.style.display="flex"),o&&(o=o.cloneNode(!0),o.style.display="flex");const c={opacity:null!=t?`${t}`:""};return n$i("div",{class:this.classes(L$4.layerRow,{[L$4.sizeRampRow]:l})},n$i("div",{class:L$4.rampLabel},l?i:r),n$i("div",{class:L$4.sizeRampContainer,styles:n},n$i("div",{bind:a,afterCreate:t$3,class:L$4.sizeRampPreview,styles:c}),this._renderSizeRampLines(e),n$i("div",{bind:o,afterCreate:t$3,class:L$4.sizeRampContainer,styles:c})),n$i("div",{class:L$4.rampLabel},l?r:i))}_renderLegendForRamp(e,t,s){const i=e.infos,r="heatmap-ramp"===e.type,o=i.length-1,l=x$3,n=o>2&&!r?C$2*o:z$1,c=n+20,d=10,p=i.slice(0).reverse();p.forEach(((e,t)=>{e.offset=r?e.ratio:t/o;}));const m=p.length-1,h=p.length%2!=0&&p[p.length/2|0],y=h&&n$i("div",{class:L$4.intervalSeparatorsContainer},n$i("div",{class:L$4.intervalSeparator},"|"),n$i("div",{class:L$4.rampLabel},h.label)),g=i[i.length-1].label,_=i[0].label,v=[[{shape:{type:"path",path:`M0 ${l/2} L${d} 0 L${d} ${l} Z`},fill:p[0].color,stroke:{width:0}},{shape:{type:"rect",x:d,y:0,width:n,height:l},fill:{type:"linear",x1:d,y1:0,x2:n+d,y2:0,colors:p},stroke:{width:0}},{shape:{type:"path",path:`M${n+d} 0 L${c} ${l/2} L${n+d} ${l} Z`},fill:p[m].color,stroke:{width:0}}]],f=C$4(v,c,l),{messages:u}=this,w={filter:s,opacity:null==t?null:`${t}`};return n$i("div",{class:L$4.layerRow},n$i("div",{class:L$4.rampLabel},r?u[g]:g),n$i("div",{class:L$4.symbolContainer},n$i("div",{styles:w},f),y),n$i("div",{class:L$4.rampLabel},r?u[_]:_))}};e$6([d$b()],N$1.prototype,"activeLayerInfos",void 0),e$6([d$b()],N$1.prototype,"headingLevel",void 0),e$6([d$b()],N$1.prototype,"layout",void 0),e$6([d$b(),e$7("esri/widgets/Legend/t9n/Legend")],N$1.prototype,"messages",void 0),e$6([d$b(),e$7("esri/t9n/common")],N$1.prototype,"messagesCommon",void 0),e$6([d$b({readOnly:!0})],N$1.prototype,"type",void 0),e$6([d$b()],N$1.prototype,"view",void 0),e$6([t$5()],N$1.prototype,"_selectSection",null),N$1=e$6([i$j("esri.widgets.Legend.styles.Card")],N$1);const A$1=N$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const _={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},u$6="esri-legend__",f$5=24,L$3={display:"flex",alignItems:"flex-start"},w$4={marginLeft:"3px"},C$1={display:"table-cell",verticalAlign:"middle"};let R$1=class extends z$3{constructor(e,r){super(e,r),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic";}render(){const e=this.activeLayerInfos,r=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return n$i("div",null,r&&r.length?r:n$i("div",{class:_.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const r=!!e.children.length,l=`${u$6}${e.layer.uid}-version-${e.version}`,a=e.title?s$g({level:this.headingLevel,class:this.classes(_.header,_.label)},e.title):null;if(r){const r=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return n$i("div",{key:l,class:this.classes(_.service,_.groupLayer)},a,r)}{const r=e.legendElements;if(r&&!r.length)return null;const s=r.map((r=>this._renderLegendForElement(r,e.layer,e.effect))).filter((e=>!!e));if(!s.length)return null;const i={[_.groupLayerChild]:!!e.parent};return n$i("div",{key:l,class:this.classes(_.service,i),tabIndex:0},a,n$i("div",{class:_.layer},s))}}_renderLegendForElement(e,r$1,l,a){const i="color-ramp"===e.type,t="opacity-ramp"===e.type,n="size-ramp"===e.type;let o=null;if("symbol-table"===e.type||n){const a=e.infos.map((a=>this._renderLegendForElementInfo(a,r$1,l,n,e.legendType))).filter((e=>!!e));a.length&&(o=n$i("div",{class:_.layerBody},a));}else "color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?o=this._renderLegendForRamp(e,r$1.opacity):"relationship-ramp"===e.type?o=u$8(e,this.id,r$1.opacity,l):"univariate-above-and-below-ramp"===e.type?o=this._renderUnivariateAboveAndBelowRamp(e,r$1.opacity,l):"univariate-color-size-ramp"===e.type&&(o=this._renderUnivariateColorSizeRamp(e,r$1.opacity,l));if(!o)return null;const p=e.title;let m=null;if("string"==typeof p)m=p;else if(p){const e=r(this.messages,p,i||t);m=o$2(p,i||t)&&p.title?`${p.title} (${e})`:e;}const c=a?_.layerChildTable:_.layerTable,g=m?n$i("div",{class:_.layerCaption},m):null,v={[_.layerTableSizeRamp]:n||!a};return n$i("div",{class:this.classes(c,v)},g,o)}_renderUnivariateAboveAndBelowRamp(e,r,l){const{sizeRampElement:a,colorRampElement:s}=d$8(e,r),p=y$6(a,"above",!0),d=y$6(a,"below",!0),y=12,c=v$3(s,{width:y,height:p,rampAlignment:"vertical",opacity:r,type:"above",effect:l}),g=v$3(s,{width:y,height:d,rampAlignment:"vertical",opacity:r,type:"below",effect:l}),v=u$7(a),b=a.infos.map((e=>e.label)),u=b.map(((e,r)=>{const l=2===r;return 0===r?n$i("div",{key:r,class:e?c?_.univariateAboveAndBelowLabel:_.rampLabel:null},e):l?n$i("div",null):null})),f=b.length-1,R=Math.floor(b.length/2),A=b.map(((e,r)=>r===R||r===f?n$i("div",{key:r,class:e?c?_.univariateAboveAndBelowLabel:_.rampLabel:null},e):null)),S={display:"table-cell",verticalAlign:"middle"},j={marginTop:`${v}px`},I={height:`${p}px`},k={height:`${d}px`};return n$i("div",{key:"univariate-above-and-below-ramp-preview",styles:L$3},n$i("div",{class:_.layerBody},a.infos.map(((e,r)=>n$i("div",{class:this.classes(_.layerRow,_.sizeRamp)},n$i("div",{class:_.symbol,styles:S,bind:e.preview,afterCreate:t$3}),c||r%2!=0?null:n$i("div",{class:_.layerInfo},b[r]))))),c?n$i("div",{styles:j,key:"color-ramp-preview"},n$i("div",{styles:w$4},n$i("div",{styles:C$1},n$i("div",{class:_.rampContainer,bind:c,afterCreate:t$3})),n$i("div",{styles:C$1},n$i("div",{class:_.rampLabelsContainer,styles:I},u))),n$i("div",{styles:w$4},n$i("div",{styles:C$1},n$i("div",{class:_.rampContainer,bind:g,afterCreate:t$3})),n$i("div",{styles:C$1},n$i("div",{class:_.rampLabelsContainer,styles:k},A)))):null)}_renderUnivariateColorSizeRamp(e,r,l){const{sizeRampElement:a,colorRampElement:s}=g$5(e),i=u$7(a),d=12,y=y$6(a,"full",!1),c=v$3(s,{width:d,height:y,rampAlignment:"vertical",opacity:r,type:"full",effect:l}),g=a.infos.length-1,v=a.infos.map(((e,r)=>0===r||r===g?n$i("div",{key:r,class:e.label?s?_.univariateAboveAndBelowLabel:_.rampLabel:null},e.label):null)),b={display:"table-cell",verticalAlign:"middle"},u={marginTop:`${i}px`},f={height:`${y}px`};return n$i("div",{key:"univariate-above-and-below-ramp-preview",styles:L$3},n$i("div",{class:_.layerBody},a.infos.map((e=>n$i("div",{class:this.classes(_.layerRow,_.sizeRamp)},n$i("div",{class:_.symbol,styles:b,bind:e.preview,afterCreate:t$3}))))),n$i("div",{styles:u,key:"color-ramp-preview"},n$i("div",{styles:w$4},n$i("div",{styles:C$1},n$i("div",{class:_.rampContainer,bind:c,afterCreate:t$3})),n$i("div",{styles:C$1},n$i("div",{class:_.rampLabelsContainer,styles:f},v)))))}_renderLegendForRamp(e,r){const l=e.infos,a="opacity-ramp"===e.type,s="heatmap-ramp"===e.type,i="stretch-ramp"===e.type,t=e.preview,n=a?_.opacityRamp:"";t.className=`${_.colorRamp} ${n}`,null!=r&&(t.style.opacity=r.toString());const o=l.map((e=>n$i("div",{class:e.label?_.rampLabel:null},s?this.messages[e.label]:i?this._getStretchStopLabel(e):e.label))),p={width:`${f$5}px`},d={height:t.style.height};return n$i("div",{class:_.layerRow},n$i("div",{class:_.symbolContainer,styles:p},n$i("div",{class:_.rampContainer,bind:t,afterCreate:t$3})),n$i("div",{class:_.layerInfo},n$i("div",{class:_.rampLabelsContainer,styles:d},o)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:m$a(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"})):""}_renderLegendForElementInfo(e,r$1,l,a,s){if(e.type)return this._renderLegendForElement(e,r$1,l,!0);let i=null;const t=i$f(r$1,s);if(e.preview?i=n$i("div",{class:_.symbol,bind:e.preview,afterCreate:t$3}):e.src&&(i=this._renderImage(e,r$1,t)),!i)return null;const n={[_.imageryLayerInfoStretched]:t},o={[_.imageryLayerInfoStretched]:t,[_.sizeRamp]:!t&&a};return n$i("div",{class:_.layerRow},n$i("div",{class:this.classes(_.symbolContainer,o)},i),n$i("div",{class:this.classes(_.layerInfo,n)},r(this.messages,e.label,!1)||""))}_renderImage(e,r$1,l){const{label:a,src:s,opacity:i}=e,t={[_.imageryLayerStretchedImage]:l,[_.symbol]:!l},n={opacity:`${null!=i?i:r$1.opacity}`};return n$i("img",{alt:r(this.messages,a,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(t),styles:n})}};e$6([d$b()],R$1.prototype,"activeLayerInfos",void 0),e$6([d$b()],R$1.prototype,"headingLevel",void 0),e$6([d$b(),e$7("esri/widgets/Legend/t9n/Legend")],R$1.prototype,"messages",void 0),e$6([d$b({readOnly:!0})],R$1.prototype,"type",void 0),R$1=e$6([i$j("esri.widgets.Legend.styles.Classic")],R$1);const A=R$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const g$4={base:"esri-legend",widget:"esri-widget",panel:"esri-widget--panel",widgetIcon:"esri-icon-layer-list"};let f$4=class extends z$3{constructor(e,t){super(e,t),this._handles=new u$e,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.headingLevel=3,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=g$4.widgetIcon,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new A,this.view=null,this.viewModel=new I$3;}initialize(){this.own($$4(this,"view","resize",(()=>this.scheduleRender())),$$4(this,"activeLayerInfos","change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),f$b(this,"headingLevel",(e=>{const{style:s}=this;s&&(s.headingLevel=e);})),i$m(this,"style",((e,s)=>{s&&e!==s&&s.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel);})));}destroy(){this._handles.destroy(),this._handles=null;}castStyle(e){if(e instanceof A$1||e instanceof A)return e;if("string"==typeof e)return "card"===e?new A$1:new A;if(e&&"string"==typeof e.type){const s={...e};delete s.type;return new("card"===e.type?A$1:A)(s)}return new A}render(){return n$i("div",{class:this.classes(g$4.base,g$4.widget,this.style instanceof A?g$4.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender();}_renderOnActiveLayerInfoChange(e){const s=i$m(e,"version",(()=>this.scheduleRender()));this._handles.add(s,`version_${e.layer.uid}`);const i=$$4(e,"children","change",(()=>{e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)));}));this._handles.add(i,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)));}};e$6([o$6("viewModel.activeLayerInfos")],f$4.prototype,"activeLayerInfos",void 0),e$6([o$6("viewModel.basemapLegendVisible")],f$4.prototype,"basemapLegendVisible",void 0),e$6([o$6("viewModel.groundLegendVisible")],f$4.prototype,"groundLegendVisible",void 0),e$6([d$b()],f$4.prototype,"headingLevel",void 0),e$6([o$6("viewModel.hideLayersNotInCurrentView")],f$4.prototype,"hideLayersNotInCurrentView",void 0),e$6([o$6("viewModel.keepCacheOnDestroy")],f$4.prototype,"keepCacheOnDestroy",void 0),e$6([o$6("viewModel.respectLayerVisibility")],f$4.prototype,"respectLayerVisibility",void 0),e$6([d$b()],f$4.prototype,"iconClass",void 0),e$6([d$b({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],f$4.prototype,"label",void 0),e$6([o$6("viewModel.layerInfos")],f$4.prototype,"layerInfos",void 0),e$6([d$b(),e$7("esri/widgets/Legend/t9n/Legend")],f$4.prototype,"messages",void 0),e$6([d$b()],f$4.prototype,"style",void 0),e$6([c$n("style")],f$4.prototype,"castStyle",null),e$6([o$6("viewModel.view")],f$4.prototype,"view",void 0),e$6([d$b()],f$4.prototype,"viewModel",void 0),f$4=e$6([i$j("esri.widgets.Legend")],f$4);const L$2=f$4;

const arcgisLegendCss = "@import url('https://js.arcgis.com/next/esri/themes/light/main.css');";

let ArcGISLegend = class {
  constructor(hostRef) {
    registerInstance(this, hostRef);
  }
  validateView(value) {
    if (value) {
      this.widget.view = value;
      if (this.el.parentElement.tagName.toLowerCase() !== 'arcgis-expand') {
        this.widget.view.ui.add(this.widget, this.position);
      }
    }
  }
  componentWillLoad() {
    const legend = new L$2({
      container: this.el
    });
    if (this.view) {
      legend.view = this.view;
    }
    this.widget = legend;
  }
  render() {
    return (h$a("div", { class: "legend-container" }));
  }
  get el() { return getElement(this); }
  static get watchers() { return {
    "view": ["validateView"]
  }; }
};
ArcGISLegend.style = arcgisLegendCss;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let p$f=class extends(r$7(a$f)){constructor(t){super(t),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null;}};e$6([d$b()],p$f.prototype,"autoNavigate",void 0),e$6([d$b()],p$f.prototype,"filter",void 0),e$6([d$b()],p$f.prototype,"getResults",void 0),e$6([d$b()],p$f.prototype,"getSuggestions",void 0),e$6([d$b()],p$f.prototype,"maxResults",void 0),e$6([d$b()],p$f.prototype,"maxSuggestions",void 0),e$6([d$b()],p$f.prototype,"minSuggestCharacters",void 0),e$6([d$b()],p$f.prototype,"outFields",void 0),e$6([d$b()],p$f.prototype,"placeholder",void 0),e$6([d$b()],p$f.prototype,"popupEnabled",void 0),e$6([d$b()],p$f.prototype,"popupTemplate",void 0),e$6([d$b()],p$f.prototype,"prefix",void 0),e$6([d$b()],p$f.prototype,"resultGraphicEnabled",void 0),e$6([d$b()],p$f.prototype,"resultSymbol",void 0),e$6([d$b()],p$f.prototype,"suggestionsEnabled",void 0),e$6([d$b()],p$f.prototype,"suffix",void 0),e$6([d$b()],p$f.prototype,"withinViewEnabled",void 0),e$6([d$b()],p$f.prototype,"zoomScale",void 0),p$f=e$6([i$j("esri.widgets.Search.SearchSource")],p$f);const i$e=p$f;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const o$1=s$e.getLogger("esri.widgets.Search.support.geometryUtils");function s$9(r,t){var n,i;if(!t)return o$1.error("missing-parameter: view is missing."),Promise.reject(new s$h("searchgeometryutils:missing-parameter","view is missing."));if(!r)return o$1.error("missing-parameter: point is missing."),Promise.reject(new s$h("searchgeometryutils:missing-parameter","point is missing."));if(r.hasZ||"2d"===t.type)return Promise.resolve(r);const s=null==t||null==(n=t.map)?void 0:n.ground;return s&&s.layers.length?s.queryElevation(r,{cache:null==(i=t.basemapTerrain)?void 0:i.elevationQueryCache}).then((e=>e.geometry)):Promise.resolve(r)}function m$6(e){if(t$7(e))return null;switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":return e.getPoint(0);case"polyline":return e.getPoint(0,0)}return null}function a$a(e,r,n){return t$7(e)?null:"extent"===e.type?e:"multipoint"===e.type||"polygon"===e.type||"polyline"===e.type?e.extent:"point"===e.type?l$8(e,r,n):void 0}function p$e(e,r,n){return t$7(e)||t$7(r)?null:l$8(e.center,r,n)}function l$8(e,r,t){const o=e.hasZ?e.z:void 0;if(r&&r.map){return (t?c$o(r,t):r.extent).clone().centerAt(e).set({zmax:o,zmin:o})}return new M$2({xmin:e.x-.25,ymin:e.y-.25,xmax:e.x+.25,ymax:e.y+.25,spatialReference:e.spatialReference,zmin:o,zmax:o})}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const c$g=/https?:\/\/services.*\.arcgis\.com/i,d$7=/(?:\{([^}]+)\})/g,f$3=s$e.getLogger("esri.widgets.Search.support.layerSearchUtils");function m$5(t,r){const{exactMatch:i=!1,location:l,maxResults:o,spatialReference:s,source:u,sourceIndex:a,suggestResult:c,view:d}=t,{layer:m,filter:g,zoomScale:F}=u,b=d&&d.scale,j=p$d(u,d),T=r&&r.signal;return h$6(m).then((()=>{const e=m.popupTemplate;return e?e.getRequiredFields(m.fieldsIndex):null})).then((t=>{var r,p;const{objectIdField:h,returnZ:R}=m,S=x$2(u);if(!$$2(m,S))throw f$3.error("invalid-field: displayField is invalid."),new s$h("getResults():invalid-field","displayField is invalid.");const D=t&&t.length?t:[S],E=u.outFields||D,M=y$5(E);-1!==E.indexOf(h)||M||E.push(h);if(!(M||w$3(m,E)))throw f$3.error("invalid-field: outField is invalid."),new s$h("getResults():invalid-field","outField is invalid.");const O=m.createQuery(),{orderByFields:C}=u;if(C&&(O.orderByFields=C),s){O.outSpatialReference=s;const e=1/H$2(s);e&&(O.maxAllowableOffset=e);}const N="mesh"===m.geometryType||"multipatch"===m.geometryType,U=(null==(r=m.capabilities)||null==(p=r.data)?void 0:p.supportsZ)&&!N;if(O.returnZ=U&&!1!==R,O.returnGeometry=!0,O.multipatchOption=N?"xyFootprint":null,E&&(O.outFields=E),l)O.geometry=l;else if(c.key)O.objectIds=[c.key];else {const t=u.searchFields||[S];if(!w$3(m,t))throw f$3.error("invalid-field: search field is invalid."),new s$h("getResults():invalid-field","search field is invalid.");v$2(m)&&(O.num=o),j&&(O.geometry=j);if(!c.text.trim())return [];const{prefix:r="",suffix:n=""}=u,l=L$1({searchTerm:I$1(`${r}${c.text}${n}`),layer:m,searchFields:t,filter:g,exactMatch:i,type:"search"});if(!l)return [];O.where=l;}return m.queryFeatures(O,{signal:T}).then((e=>k(e,d,u,a,S,b,F)))}))}function g$3(t,r){const{source:i,spatialReference:n,view:l,suggestTerm:o,maxSuggestions:s,sourceIndex:u,exactMatch:a}=t,{layer:c,filter:m}=i,g=r&&r.signal,F=p$d(i,l);return h$6(c).then((()=>{if(!v$2(c))return [];const t=x$2(i),r=i.searchFields||[t],l=[];i.suggestionTemplate?i.suggestionTemplate.replace(d$7,((e,t)=>(l.push(t),e))):l.push(t);const p=y$5(l);-1!==l.indexOf(c.objectIdField)||p||l.push(c.objectIdField);const h=$$2(c,t),b=p||w$3(c,l),j=w$3(c,r);if(!h)throw f$3.error("invalid-field: displayField is invalid."),new s$h("getSuggestions():invalid-field","displayField is invalid.");if(!b)throw f$3.error("invalid-field: outField is invalid."),new s$h("getSuggestions():invalid-field","outField is invalid.");if(!j)throw f$3.error("invalid-field: search field is invalid."),new s$h("getSuggestions():invalid-field","search field is invalid.");const T=c.createQuery(),{orderByFields:R}=i;R&&(T.orderByFields=R),T.outSpatialReference=n,T.returnGeometry=!1,T.num=s,T.outFields=l,F&&(T.geometry=F);if(!o.trim())return [];const{prefix:S="",suffix:D=""}=i,E=L$1({searchTerm:I$1(`${S}${o}${D}`),layer:c,searchFields:r,filter:m,exactMatch:a,type:"suggest"});return E?(T.where=E,c.queryFeatures(T,{signal:g}).then((e=>C(e,i,u,t)))):[]}))}function p$d(e,t){const{filter:r,withinViewEnabled:i}=e,n=t&&t.extent;return r&&r.geometry||(i&&n?n:void 0)}function y$5(e){return e&&-1!==e.indexOf("*")}async function h$6(e){e&&await e.load();}function v$2(e){var t,r,i;return null!=(t=null==e||null==(r=e.capabilities)||null==(i=r.query)?void 0:i.supportsPagination)&&t}function F(e){var t,r,i,n;return null!=(t=null==e||null==(r=e.fieldsIndex)||null==(i=r.fields)||null==(n=i.find((e=>"string"===e.type)))?void 0:n.name)?t:""}function x$2(e){return e.displayField||e.layer.displayField||F(e.layer)}function w$3(e,t){return !(!e||!t)&&t.every((t=>$$2(e,t)))}function $$2(e,t){return !!e.getField(t)}function b$3(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return !0;return !1}function j$3(e,t,r){let i=null;const{codedValues:n}=e;return n&&n.some((e=>{const n=e.name,l=r?n:n.toLowerCase();return (r?t:t.toLowerCase())===l&&(i=e.code.toString(),!0)})),i}function I$1(e){return e.replace(/\'/g,"''")}function T(e,t){const r=t&&t.where;return r?`(${e}) AND (${r})`:e}function R({currentTerm:e,field:t,filter:r,exactMatch:i,url:n,type:l}){const o=t.type,s=t.name;if("string"===o||"date"===o||"global-id"===o){const t=c$g.test(n),o=t&&b$3(e)?"N":"";if(i&&"search"===l)return T(`${s} = ${o}'${e}'`,r);const u=t?s:`UPPER(${s})`,a=t?e:e.toUpperCase();return T(`${u} LIKE ${o}${i?`'${a}%'`:`'%${a}%'`}`,r)}if("oid"===o||"small-integer"===o||"integer"===o||"single"===o||"double"===o){const t=Number(e);return isNaN(t)?null:T(`${s} = ${t}`,r)}return T(`${s} = ${e}`,r)}function S$2(e,t){return e?` OR (${t})`:`(${t})`}function L$1({searchTerm:e,layer:t,searchFields:r,filter:i,exactMatch:n,type:l}){const{definitionExpression:o,url:s}=t;let u="";return e&&r&&r.forEach((r=>{const o=t.getField(r),a="function"==typeof t.getFieldDomain&&t.getFieldDomain(r),c=(a&&"coded-value"===a.type?j$3(a,e,n):null)||e||null;if(null!==c){const e=R({currentTerm:c,field:o,filter:i,exactMatch:n,url:s,type:l});e&&(u+=S$2(u,e));}})),o?`(${o}) AND (${u})`:u}function D(e,t){let r=null;const{codedValues:i}=e;return i&&i.length&&i.some((e=>e.code===t&&(r=e.name,!0))),r}function E(e,t){return e[Object.keys(e).find((e=>e.toLowerCase()===t.toLowerCase()))]}function M(e,t,r){const i=e.sourceLayer,{attributes:n}=e,l="function"==typeof i.getFieldDomain&&i.getFieldDomain(r);if(t)return s$f(t,n);if(r&&n){const e=i.getField(r),t=E(n,r);return null==t?"":l&&"coded-value"===l.type?D(l,t):"date"===(null==e?void 0:e.type)?L$7(new Date(t)):"number"==typeof t?t.toString():"string"!=typeof t?"":t.trim()}return ""}function O(e,t,r,i){const n=e.sourceLayer,{attributes:l}=e,{objectIdField:o}=n,s=l[o];return {text:M(e,t.suggestionTemplate,i),key:s,sourceIndex:r}}function C(e,t,r,i){return e.features.map((e=>O(e,t,r,i)))}function N(e,r,n,u,a,c,d){const f=e.clone(),m=e.sourceLayer,g=m&&m.objectIdField,p=g&&e.attributes[g],y=M(e,n.searchTemplate,a),h=a$a(f.geometry,r,c),v="number"==typeof d?p$e(l$f(h),r,d):h,F=e.clone();return r$6(v)&&(F.geometry=v$8.fromExtent(v)),{extent:v,target:F,feature:f,key:p,name:y,sourceIndex:u}}function k(e,t,r,i,n,l,o){return e.features.map((e=>N(e,t,r,i,n,l,o)))}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var o;let n$c=o=class extends i$e{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(e,t)=>m$5({source:this,...e},t),this.getSuggestions=(e,t)=>g$3({source:this,...e},t);}set layer(e){this._set("layer",e),e&&e.load().catch((()=>{}));}get name(){return this._getLayerTitle()||""}set name(e){void 0!==e?this._override("name",e):this._clearOverride("name");}clone(){return new o({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?l$f(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?l$f(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){var e,t;return null!=(e=null==(t=this.layer.fieldsIndex.fields.find((e=>"string"===e.type)))?void 0:t.name)?e:""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;if(!e.loaded)return "";return `: ${(t||[this._getDisplayField()]).map((t=>{const s=e.getField(t);return s&&s.alias||t})).join(", ")}`}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};e$6([d$b({json:{read:{source:"field.name"},write:{target:"field.name"}}})],n$c.prototype,"displayField",void 0),e$6([d$b({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],n$c.prototype,"exactMatch",void 0),e$6([d$b({value:null})],n$c.prototype,"layer",null),e$6([d$b()],n$c.prototype,"name",null),e$6([d$b({type:[String],json:{write:!0}})],n$c.prototype,"orderByFields",void 0),e$6([d$b()],n$c.prototype,"searchFields",void 0),e$6([d$b()],n$c.prototype,"searchTemplate",void 0),e$6([d$b()],n$c.prototype,"suggestionTemplate",void 0),n$c=o=e$6([i$j("esri.widgets.Search.LayerSearchSource")],n$c);const h$5=n$c;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function n$b(n){return n&&"number"==typeof n.x&&"number"==typeof n.y}function e$3(n){return n&&"number"==typeof n.xmin&&"number"==typeof n.ymin&&"number"==typeof n.xmax&&"number"==typeof n.ymax}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let i$d=class extends a$f{constructor(t){super(t),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null;}};e$6([d$b({type:String,json:{write:!0}})],i$d.prototype,"address",void 0),e$6([d$b({type:Object,json:{write:!0}})],i$d.prototype,"attributes",void 0),e$6([d$b({type:M$2,json:{write:!0}})],i$d.prototype,"extent",void 0),e$6([d$b({type:b$a,json:{write:!0}})],i$d.prototype,"location",void 0),e$6([d$b({type:Number,json:{write:!0}})],i$d.prototype,"score",void 0),i$d=e$6([i$j("esri.rest.support.AddressCandidate")],i$d);const c$f=i$d;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const t$2={type:String,json:{read:{source:"token"},write:{target:"token"}}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let l$7=class extends a$f{constructor(t){super(t),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null;}};e$6([d$b({type:Object,json:{write:!0}})],l$7.prototype,"address",void 0),e$6([d$b(t$2)],l$7.prototype,"apiKey",void 0),e$6([d$b({type:[String],json:{read:{source:"category",reader:t=>t?t.split(","):null},write:{target:"category",writer:(t,o)=>{o.category=t?t.join(","):null;}}}})],l$7.prototype,"categories",void 0),e$6([d$b({type:String,json:{write:!0}})],l$7.prototype,"countryCode",void 0),e$6([d$b({type:Boolean,json:{write:!0}})],l$7.prototype,"forStorage",void 0),e$6([d$b({type:b$a,json:{write:{writer:(t,o)=>{o.location=t?t.clone().normalize():null;}}}})],l$7.prototype,"location",void 0),e$6([d$b({type:String,json:{write:!0}})],l$7.prototype,"locationType",void 0),e$6([d$b({type:String,json:{write:!0}})],l$7.prototype,"magicKey",void 0),e$6([d$b({type:Number,json:{write:!0}})],l$7.prototype,"maxLocations",void 0),e$6([d$b({type:[String],json:{write:{writer:(t,o)=>{o.outFields=t?t.join(","):null;}}}})],l$7.prototype,"outFields",void 0),e$6([d$b({type:k$3,json:{read:{source:"outSR"},write:{target:"outSR"}}})],l$7.prototype,"outSpatialReference",void 0),e$6([d$b({type:M$2,json:{write:{writer:(t,o)=>{const e=t?t.shiftCentralMeridian():null;o.searchExtent=e;}}}})],l$7.prototype,"searchExtent",void 0),l$7=e$6([i$j("esri.rest.support.AddressToLocationsParameters")],l$7),l$7.from=b$b(l$7);const c$e=l$7;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
async function d$6(o,n,a){n=c$e.from(n);const d=e$b(o),{address:p,...m}=n.toJSON(),u={...p,...m,f:"json"},c=n$j({...d.query,...u}),j=r$8(c,a),l=`${d.path}/findAddressCandidates`;return E$1(l,j).then(f$2)}function f$2({data:r}){if(!r)return [];const{candidates:t,spatialReference:e}=r;return t?t.map((r=>{if(!r)return;const{extent:t,location:s}=r,i=!t||e$3(t);return n$b(s)&&i?(t&&(t.spatialReference=e),s.spatialReference=e,c$f.fromJSON(r)):void 0})):[]}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let p$c=class extends a$f{constructor(r){super(r),this.addresses=null,this.categories=null,this.countryCode=null,this.locationType=null,this.outSpatialReference=null;}};e$6([d$b({type:[Object],json:{read:{reader:r=>r&&r.records?r.records.map((r=>r.attributes)):null},write:{writer:(r,e)=>{const o=[];Array.isArray(r)&&r.forEach((r=>{o.push({attributes:r});})),e.addresses={records:o};}}}})],p$c.prototype,"addresses",void 0),e$6([d$b({type:[String],json:{read:{source:"category",reader:r=>r?r.split(","):null},write:{target:"category",writer:(r,e)=>{e.category=r?r.join(","):null;}}}})],p$c.prototype,"categories",void 0),e$6([d$b({type:String,json:{read:{source:"sourceCountry"},write:{target:"sourceCountry"}}})],p$c.prototype,"countryCode",void 0),e$6([d$b({type:String,json:{write:!0}})],p$c.prototype,"locationType",void 0),e$6([d$b({type:k$3,json:{read:{source:"outSR"},write:{target:"outSR"}}})],p$c.prototype,"outSpatialReference",void 0),p$c=e$6([i$j("esri.rest.support.AddressesToLocationsParameters")],p$c),p$c.from=b$b(p$c);const i$c=p$c;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
async function a$9(s,a,c){a=i$c.from(a);const p=e$b(s),f={...a.toJSON(),f:"json"},m=n$j({...p.query,...f}),u=r$8(m,c),d=`${p.path}/geocodeAddresses`;return E$1(d,u).then(i$b)}function i$b(o){const{data:r}=o;if(!r)return [];const{locations:t,spatialReference:e}=r;return t?t.map((o=>{const{location:r}=o;return r&&(r.spatialReference=e),c$f.fromJSON(o)})):[]}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let a$8=class extends a$f{constructor(o){super(o),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null;}};e$6([d$b(t$2)],a$8.prototype,"apiKey",void 0),e$6([d$b({type:b$a,json:{write:{writer:(o,r)=>{const t=o?o.clone().normalize():null,e=void 0!==t;r.location=e?t:null;}}}})],a$8.prototype,"location",void 0),e$6([d$b({type:String,json:{write:!0}})],a$8.prototype,"locationType",void 0),e$6([d$b({type:k$3,json:{read:{source:"outSR"},write:{target:"outSR"}}})],a$8.prototype,"outSpatialReference",void 0),a$8=e$6([i$j("esri.rest.support.LocationToAddressParameters")],a$8),a$8.from=b$b(a$8);const n$a=a$8;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
async function n$9(e,n,i){n=n$a.from(n);const c=e$b(e),m={...n.toJSON(),f:"json"},u=n$j({...c.query,...m}),f=r$8(u,i),p=`${c.path}/reverseGeocode`;return E$1(p,f).then(d$5)}function d$5({data:r}){if(!r)return;const{address:o,location:t}=r,s=o&&o.Match_addr||"";return c$f.fromJSON({address:s,attributes:o||{},location:t,score:100})}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let e$2=class extends a$f{constructor(o){super(o),this.isCollection=null,this.magicKey=null,this.text=null;}};e$6([d$b({type:Boolean,json:{write:!0}})],e$2.prototype,"isCollection",void 0),e$6([d$b({type:String,json:{write:!0}})],e$2.prototype,"magicKey",void 0),e$6([d$b({type:String,json:{write:!0}})],e$2.prototype,"text",void 0),e$2=e$6([i$j("esri.rest.support.SuggestionCandidate")],e$2);const p$b=e$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let c$d=class extends a$f{constructor(t){super(t),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null;}};e$6([d$b(t$2)],c$d.prototype,"apiKey",void 0),e$6([d$b({type:[String],json:{read:{source:"category",reader:t=>t?t.split(","):null},write:{target:"category",writer:(t,o)=>{o.category=t?t.join(","):null;}}}})],c$d.prototype,"categories",void 0),e$6([d$b({type:String,json:{write:!0}})],c$d.prototype,"countryCode",void 0),e$6([d$b({type:b$a,json:{write:{writer:(t,o)=>{o.location=t?t.clone().normalize():null;}}}})],c$d.prototype,"location",void 0),e$6([d$b({type:Number,json:{write:!0}})],c$d.prototype,"maxSuggestions",void 0),e$6([d$b({type:k$3,json:{read:{source:"outSR"},write:{target:"outSR"}}})],c$d.prototype,"outSpatialReference",void 0),e$6([d$b({type:M$2,json:{write:{writer:(t,o)=>{const e=t?t.shiftCentralMeridian():null;o.searchExtent=JSON.stringify(e);}}}})],c$d.prototype,"searchExtent",void 0),e$6([d$b({type:String,json:{write:!0}})],c$d.prototype,"text",void 0),c$d=e$6([i$j("esri.rest.support.SuggestLocationsParameters")],c$d),c$d.from=b$b(c$d);const l$6=c$d;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
async function u$5(n,u,m){const p=e$b(n),a={...(u=l$6.from(u)).toJSON(),f:"json"},f=n$j({...p.query,...a}),g=r$8(f,m),c=`${p.path}/suggest`;return E$1(c,g).then(i$a)}function i$a(t){const{data:o}=t;if(!o)return [];const{suggestions:r}=o;return r?r.map((t=>new p$b(t))):[]}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let n$8=class extends l$g{constructor(t){super(t),this.outSpatialReference=null,this.url=null;}addressToLocations(t,e){!t.outSpatialReference&&this.outSpatialReference&&(t.outSpatialReference=this.outSpatialReference);const o={...this.requestOptions,...e};return d$6(this.url,t,o)}suggestLocations(t,e){const o={...this.requestOptions,...e};return u$5(this.url,t,o)}addressesToLocations(t,e){!t.outSpatialReference&&this.outSpatialReference&&(t.outSpatialReference=this.outSpatialReference);const o={...this.requestOptions,...e};return a$9(this.url,t,o)}locationToAddress(t,e){!t.outSpatialReference&&this.outSpatialReference&&(t.outSpatialReference=this.outSpatialReference);const o={...this.requestOptions,...e};return n$9(this.url,t,o)}};e$6([d$b({type:k$3})],n$8.prototype,"outSpatialReference",void 0),e$6([d$b()],n$8.prototype,"url",void 0),n$8=e$6([i$j("esri.tasks.Locator")],n$8);const u$4=n$8;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const f$1="Single Line Input",d$4=3e5;function g$2(e,o){return e.location?j$2(e,o):$$1(e,o)}function p$a(e){const o=null==e?void 0:e.scale;return "number"==typeof o&&o<=d$4?e.get("extent.center"):null}function y$4(e,t){const{source:r,spatialReference:s,view:n,suggestTerm:c,maxSuggestions:a,sourceIndex:l}=e,m=new l$6,{apiKey:f,url:d}=r,g=I(r,n),y=t&&t.signal;if(!d)return Promise.resolve(null);f&&(m.apiKey=f),r.categories&&(m.categories=r.categories),s&&(m.outSpatialReference=s);const x=p$a(n);x&&(m.location=x);if(!c.trim())return Promise.resolve(null);const{prefix:v="",suffix:S=""}=r,w=`${v}${c}${S}`;return m.text=w,g&&(m.searchExtent=e$9(g)),m.maxSuggestions=a,r.countryCode&&(m.countryCode=r.countryCode),u$5(d,m,{signal:y}).then((e=>K$1(e,l)))}function x$1(e){return !!e&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(e)}function v$1(e){return !!e&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/gi.test(e)}function S$1(e){return !!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(e)}const w$2="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer";function j$2(e,o){const{source:t,spatialReference:r,location:s,sourceIndex:i,view:c}=e,{apiKey:u,url:l,zoomScale:m,defaultZoomScale:f}=t,d=c&&c.scale,g=o&&o.signal,p=new n$a;return p.location=s,u&&(p.apiKey=u),r&&(p.outSpatialReference=r),n$9(l,p,{signal:g}).then((e=>P$1([e],{sourceIndex:i,scale:d,view:c,zoomScale:m,defaultZoomScale:f})))}function I(e,o){const{filter:t,withinViewEnabled:r}=e,s=o&&o.scale,n=o&&o.extent,i=t&&t.geometry;return a$a(i,o,s)||(r&&n?n:void 0)}function $$1(e,t){const{source:r,suggestResult:n,spatialReference:i,view:a,maxResults:u,sourceIndex:l}=e,m=r&&r.zoomScale,d=r&&r.defaultZoomScale;if(!n.text.trim())return Promise.resolve(null);const g=!n.key&&r.prefix?r.prefix:"",y=!n.key&&r.suffix?r.suffix:"",x=`${g}${n.text}${y}`,v=new c$e,{apiKey:S,url:w}=r,j=a&&a.scale,$=I(r,a),h=t&&t.signal;if(S&&(v.apiKey=S),!w)return Promise.resolve(null);r.categories&&(v.categories=r.categories),r.locationType&&(v.locationType=r.locationType),i&&(v.outSpatialReference=i);const K=p$a(a);K&&(v.location=K),v.maxLocations=u,$&&(v.searchExtent=e$9($)),r.countryCode&&(v.countryCode=r.countryCode);const{key:L}=n,R=`${L}`;return L&&(v.magicKey=R),v.address={},v.address[r.singleLineFieldName||f$1]=x,r.outFields&&(v.outFields=r.outFields),d$6(w,v,{signal:h}).then((e=>P$1(e,{key:R,scale:j,sourceIndex:l,view:a,zoomScale:m,defaultZoomScale:d})))}function h$4(e,o){return {text:e.text,key:e.magicKey,sourceIndex:o}}function K$1(e,o){return e.map((e=>h$4(e,o)))}function L(o,s){const{key:n,scale:i,sourceIndex:c,view:a,zoomScale:u,defaultZoomScale:f}=s,{attributes:d,extent:g,location:p,address:y}=o,x=new h$d({geometry:p,attributes:d}),v=g||p,S=a$a(v,a,i),w="number"==typeof u?p$e(S,a,u):"number"==typeof f&&"point"===v.type?p$e(S,a,f):S,j=p?`${p.x},${p.y}`:"",I=y||j,$=x.clone();return r$6(w)&&($.geometry=v$8.fromExtent(w)),{extent:w,feature:x,target:$,key:n,name:I,sourceIndex:c}}function P$1(e,o){return e.filter(Boolean).map((e=>L(e,o)))}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var n$7;const u$3="esri.widgets.Search.LocatorSearchSource",h$3=s$e.getLogger(u$3);let d$3=n$7=class extends i$e{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(e,t)=>g$2({source:this,...e},t),this.getSuggestions=(e,t)=>y$4({source:this,...e},t);}set locator(e){r$9(h$3,"locator",{replacement:"url",version:"4.22"}),this._set("url",e.url),this._set("locator",e);}get locator(){return r$9(h$3,"locator",{replacement:"url",version:"4.22"}),this._get("locator")}clone(){return new n$7({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?l$f(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?l$f(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,locator:this.locator,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};e$6([d$b()],d$3.prototype,"apiKey",void 0),e$6([d$b()],d$3.prototype,"categories",void 0),e$6([d$b()],d$3.prototype,"countryCode",void 0),e$6([d$b({json:{write:!0}})],d$3.prototype,"defaultZoomScale",void 0),e$6([d$b({type:u$4,json:{read:!1,write:!1}})],d$3.prototype,"locator",null),e$6([d$b()],d$3.prototype,"locationType",void 0),e$6([d$b({json:{write:!0}})],d$3.prototype,"name",void 0),e$6([d$b({json:{write:!0}})],d$3.prototype,"placeholder",void 0),e$6([d$b()],d$3.prototype,"searchTemplate",void 0),e$6([d$b({json:{write:!0}})],d$3.prototype,"singleLineFieldName",void 0),e$6([d$b({json:{read:{source:"suggest"},write:{target:"suggest"}}})],d$3.prototype,"suggestionsEnabled",void 0),e$6([d$b({json:{write:!0}})],d$3.prototype,"url",void 0),e$6([d$b({json:{write:!0}})],d$3.prototype,"zoomScale",void 0),d$3=n$7=e$6([i$j(u$3)],d$3);const m$4=d$3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const u$2=s$e.getLogger("esri.widgets.support.geolocationUtils"),c$c={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function p$9(){const e=s$i("esri-geolocation");return e||u$2.warn("geolocation-unsupported","Geolocation unsupported."),e}function l$5(){const e=window.isSecureContext;return e||u$2.warn("insecure-context","Geolocation requires a secure origin."),e}function g$1(){return p$9()&&l$5()}function f(e){const r=15e3;return e||(e=c$c),new Promise(((o,i)=>{setTimeout((()=>i(new s$h("geolocation:timeout","getting the current geolocation position timed out"))),r),navigator.geolocation.getCurrentPosition(o,i,e);}))}function j$1(e,t){const{position:r,view:o}=e;return P(y$3(d$2(r)),o,t)}function d$2(e){const t=e&&e.coords||{},r={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e?{coords:r,timestamp:e.timestamp}:e}function y$3(e){const t=e&&e.coords;return t?new b$a({longitude:t.longitude,latitude:t.latitude,z:t.altitude||null,spatialReference:{wkid:4326}}):null}function P(e,r,o){if(!r)return Promise.resolve(e);const i=r.spatialReference;return i.isWGS84?Promise.resolve(e):i.isWebMercator?Promise.resolve(R$3(e)):w$1(o).then((r=>{if(!r)throw new s$h("geometry-service:missing-url","Geometry service URL is missing");const s=new a$g({geometries:[e],outSpatialReference:i});return n$k(r,s,o).then((e=>e[0]))}))}function w$1(t){if(t$9.geometryServiceUrl)return Promise.resolve(t$9.geometryServiceUrl);const r=B.getDefault();return r.load(t).catch((()=>{})).then((()=>r.get("helperServices.geometry.url")))}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function Z$1(e,t){return e.hasOwnProperty(t)&&null!=e[t]&&""!==e[t]}const q=()=>u$g("esri/widgets/Search/t9n/Search"),z="esri.widgets.Search.SearchViewModel",K=s$e.getLogger(z),W="highlight",X$1=S$7.ofType({key:e=>e.layer?"layer":"locator",base:i$e,typeMap:{layer:h$5,locator:m$4}}),Y$1=k$3.WGS84,$="esri/images/search/search-symbol-32.svg",ee$1="esri/images/search/search-symbol-32.png",te$1=/<(?:.|\s)*?>/g,se$1=-1;let re$1=class extends(e$c(n$l.EventedMixin(p$l))){constructor(e){super(e),this._handles=new u$e,this._gotoController=null,this._searching=null,this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new X$1,this.defaultSymbols={point:new n$m({url:a$h(s$i("trident")?ee$1:$),size:24,width:24,height:24}),polyline:new m$b({color:[130,130,130,1],width:2}),polygon:new S$6({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=B.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new X$1,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null;}initialize(){const e=async()=>{const e=await q();this.messages=e,this.defaultPopupTemplate=new M$3({title:e.searchResult,content:"{Match_addr}"});};e(),this._handles.add([$$4(this,["defaultSources","sources"],"change",(()=>this.notifyChange("allSources"))),i$m(this,["includeDefaultSources","view","portal"],(()=>this._update())),g$9(e)]);}destroy(){this._abortGoTo(),this.clearGraphics(),this._handles.destroy(),this._handles=null;}get activeSource(){return this.allSources.getItemAt(this.activeSourceIndex)||null}get activeSourceIndex(){return 1===this.allSources.length||!this.searchAllEnabled?0:se$1}set activeSourceIndex(e){void 0!==e?this._override("activeSourceIndex",e):this._clearOverride("activeSourceIndex");}get allPlaceholder(){var e;return null==(e=this.messages)?void 0:e.allPlaceholder}set allPlaceholder(e){e?this._override("allPlaceholder",e):this._clearOverride("allPlaceholder");}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:s}=this,r="function"==typeof s?s.call(null,{sources:e,defaultSources:t}):s?t.concat(e):e,o=this._get("allSources")||new X$1;return o.removeAll(),o.addMany(r.filter(Boolean)),o}get defaultSymbol(){return r$9(K,"defaultSymbol",{replacement:"defaultSymbols",version:"4.22"}),this._get("defaultSymbol")}set defaultSymbol(e){r$9(K,"defaultSymbol",{replacement:"defaultSymbols",version:"4.22"}),this._set("defaultSymbol",e);}get locationEnabled(){return this._get("locationEnabled")||g$1()}set locationEnabled(e){if(void 0===e)return void this._clearOverride("locationEnabled");const t=g$1();if(e&&!t){const e=new s$h("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});K.error(e);}this._override("locationEnabled",e&&t);}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:s}=this;if(t===se$1)return s;const r=e.getItemAt(t);return r?r.placeholder:""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),""===e&&this._clear();}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":0===this.allSources.length?"disabled":"ready"}get updating(){return null!=this._updatingPromise}clear(){this.searchTerm="";}clearGraphics(){this._removeHighlight(),this._closePopup(),this.view&&this.view.graphics.remove(this.resultGraphic),this._set("resultGraphic",null);}search(e,t){this.emit("search-start"),this.clearGraphics();const s=this._createSuggestionForSearch(e),r=this.when().then((()=>this._getResultsFromSources(s,t).then((e=>{var r;if(null!=(r=e$9(null==t?void 0:t.signal))&&r.aborted)return null;const o={activeSourceIndex:this.activeSourceIndex,searchTerm:s.text,numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(o,e,s);const l=this._getFirstResult(o.results),i=(s.location&&l?l.name:s.text).replace(te$1,"");return this._set("searchTerm",i),(s.key&&"number"==typeof s.sourceIndex||s.location)&&this._set("selectedSuggestion",s),this._set("results",o.results),this._set("resultCount",o.results.reduce(((e,t)=>e+t.results.length),0)),this.emit("search-complete",o),this._selectFirstResult(l).then((()=>o))})))).then((e=>(this._clearSearching(),e)),(e=>{throw this._clearSearching(),e}));return this._searching=r,this.notifyChange("state"),r}searchNearby(e){if(!this.locationEnabled){const e=new s$h("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});return K.error(e),Promise.reject(e)}const t=f().then((t=>j$1({position:t,view:this.view},e))).then((t=>this.search(t,e)));return this._searching=t,this.notifyChange("state"),t.catch((()=>{})).then((()=>this._clearSearching())),t}select(e){if(this.clearGraphics(),!e){const t=new s$h("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});return K.error(t),Promise.reject(t)}const{view:t}=this,s=Z$1(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),o=this.allSources.getItemAt(s);if(!o){const e=new s$h("select:missing-source","Cannot select without a source.",{source:o});return K.error(e),Promise.reject(e)}const l=o instanceof h$5?this._getLayerSourcePopupTemplate(o):o.popupTemplate,i=o.resultSymbol||this._getDefaultSymbol(e),a=Z$1(o,"resultGraphicEnabled")?o.resultGraphicEnabled:this.resultGraphicEnabled,u=Z$1(o,"autoNavigate")?o.autoNavigate:this.autoNavigate,c=Z$1(o,"popupEnabled")?o.popupEnabled:this.popupEnabled,h=c?l||this.popupTemplate||this.defaultPopupTemplate:null,{feature:p}=e;if(!p){const e=new s$h("select:missing-feature","Cannot select without a feature.",{feature:p});return K.error(e),Promise.reject(e)}const{attributes:d,geometry:y,layer:f,sourceLayer:S}=p,v=m$6(y),_={layerViewQuery:this._getLayerView(p),elevationQuery:t&&r$6(v)?s$9(v,t).catch((()=>v)):Promise.resolve(v)};return T$1(_).then((l=>{const n=l.layerViewQuery.value,m=l.elevationQuery.value;i instanceof c$p&&(i.text=e.name);const v=t&&u?e.target||e.extent:null;return (r$6(v)?this._goToSearchResult(v):Promise.resolve()).then((()=>{var l;const u=n?p:new h$d({geometry:y,symbol:i,attributes:d,layer:f,sourceLayer:S,popupTemplate:h}),g=c&&(null==(l=this.view)?void 0:l.popup),v=g&&u.getEffectivePopupTemplate(g.defaultPopupTemplateEnabled);return v&&t.popup.open({features:[u],location:m}),n&&e$d(n)&&!v&&this._highlightFeature({graphic:u,layerView:n}),!n&&a&&t&&t.graphics.push(u),this._set("selectedResult",e),this._set("resultGraphic",u),this.emit("select-result",{result:e,source:o,sourceIndex:s}),e}))}))}suggest(e,t,s){const r=e||this.searchTerm;return this.emit("suggest-start",{searchTerm:r}),this._suggestTimer(t,s).then((()=>this._suggestImmediate(r,s).then((e=>(this._set("suggestions",e.results),this._set("suggestionCount",e.results.reduce(((e,t)=>e+t.results.length),0)),this.emit("suggest-complete",e),e)))))}async when(){await g$8(this,"updating");}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const s=this._updatingPromise=T$1([null==e?void 0:e.load(),null==t?void 0:t.when()]);if(this.destroyed)return;if(this.notifyChange("updating"),await s,s!==this._updatingPromise)return}this._updatingPromise=null,this.notifyChange("updating");const s=a$i(this,"messages");this.destroyed||(this._handles.add(s),await s,this._updateDefaultSources());}_clearSearching(){this._searching=null,this.notifyChange("state");}_convertHelperServices(){var e,t;const r=null==(e=this.portal)||null==(t=e.helperServices)?void 0:t.geocode;if(!r)return [];return r.map((e=>{if(!1===e.placefinding)return;const t=t$9.apiKey&&S$1(e.url)?{url:w$2}:null,r=m$4.fromJSON({...e,...t}),o=r.url;if(S$1(o)||v$1(o)||x$1(o)){const e=r.outFields||["Addr_type","Match_addr","StAddr","City"],t=r.placeholder||this.messages.placeholder,s="number"==typeof r.defaultZoomScale?r.defaultZoomScale:2500;r.set({singleLineFieldName:"SingleLine",outFields:e,placeholder:t,defaultZoomScale:s});}return r.singleLineFieldName?r:void 0})).filter(Boolean)}_getLayerSources(e,t){var s;const r=null==(s=this.view)?void 0:s.map;return e.map((e=>{const s=r.findLayerById(e.id);if(!s)return;const o=this._getLayerJSON(e),l=h$5.fromJSON(o);return l.placeholder=t,this._getLayer(s,o).then((e=>{l.layer=e;})),l})).filter(Boolean).toArray()}_getTableSources(e,t){var s;const r=null==(s=this.view)?void 0:s.map;return e.map((e=>{const s=r.findTableById(e.id);if(!s)return;const o=this._getLayerJSON(e),l=h$5.fromJSON(o);return l.placeholder=t,this._getLayer(s,o).then((e=>{l.layer=e;})),l})).filter(Boolean).toArray()}_convertApplicationProperties(){var e,t,s;const r=null==(e=this.view)?void 0:e.map,o=null==r||null==(t=r.applicationProperties)||null==(s=t.viewing)?void 0:s.search;if(!o)return [];const{enabled:l,hintText:i,layers:a,tables:n}=o;if(!l)return [];return [...this._getLayerSources(a,i),...this._getTableSources(n,i)]}_getSubLayer(e,t){return e.load().then((()=>{if(!e.allSublayers)return Promise.reject();const s=e.allSublayers.find((e=>e.id===t.subLayer));return s?s.createFeatureLayer():Promise.reject()}))}async _getBuildingSubLayer(e,t){await e.load();const s=e.allSublayers.find((e=>e.id===t.subLayer));return "building-component"!==(null==s?void 0:s.type)?Promise.reject():(await s.load(),null==s.associatedLayer?Promise.reject():(await s.associatedLayer.load(),s))}_getLayer(e,t){return "feature"===e.type||"scene"===e.type||"csv"===e.type||"geojson"===e.type||"ogc-feature"===e.type?Promise.resolve(e):"map-image"===e.type?this._getSubLayer(e,t).catch((()=>{const t=new s$h("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return K.error(t),null})):"building-scene"===e.type?this._getBuildingSubLayer(e,t):Promise.resolve(null)}_getLayerJSON(e){return "function"==typeof e.toJSON?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()]),this.notifyChange("allSources");}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null;}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear");}_closePopup(){var e;const t=null==(e=this.view)?void 0:e.popup,{resultGraphic:s}=this;if(!t||!s)return;const{selectedFeature:r}=t;r&&r===s&&t.close();}_suggestTimer(e,t){const s=null!=e?e:this.suggestionDelay;return L$9(s,null,t&&t.signal)}_createLocationForSearch(e){return e instanceof h$d?m$6(e.geometry):e instanceof b$a?e:Array.isArray(e)&&2===e.length?new b$a({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&Z$1(e,"key")&&Z$1(e,"text")&&Z$1(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),s="string"==typeof e?e:this.searchTerm,{selectedSuggestion:r,selectedResult:o}=this,l=!e&&r&&o,i=l&&r.key===o.key&&r.sourceIndex===o.sourceIndex,a=l&&r.location;return i||a?r:{location:e$9(t),text:t?"":s,sourceIndex:null,key:null}}_getFirstResult(e){let t=null;return e&&e.some((e=>{const{results:s}=e,r=s[0],o=!!r;return o&&(t=r),o})),t}_selectFirstResult(e){return this.autoSelect&&e?this.select(e):Promise.resolve(null)}_suggestImmediate(e,t){return this.when().then((()=>this._getSuggestionsFromSources(e,t))).then((s=>{var r;if(null!=(r=e$9(null==t?void 0:t.signal))&&r.aborted)return null;const o={activeSourceIndex:this.activeSourceIndex,searchTerm:e,numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(o,s),o}))}_formatSourceResponse(e,t,s){const r=t&&t.value||[],o=t&&t.error,l=this.allSources.getItemAt(s);if(o){const t={sourceIndex:s,source:l,error:o};e.errors.push(t),K.error(o),e.numErrors++;}else {const t={sourceIndex:s,source:l,results:r};e.results.push(t),e.numResults+=r.length;}}_formatResponse(e,t,s){if(t)if(e.activeSourceIndex===se$1){const r=s&&Z$1(s,"sourceIndex")&&-1!==s.sourceIndex?s.sourceIndex:void 0;t.forEach(((t,s)=>{const o=void 0!==r?r:s;this._formatSourceResponse(e,t,o);}));}else this._formatSourceResponse(e,t[0],e.activeSourceIndex);}_getResultsFromSources(e,t){const{allSources:s}=this,r=!e.location&&Z$1(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,o=[];if(!s.length){const e=new s$h("search:no-sources-defined","At least one source is required.",{allSources:s});return K.error(e),Promise.reject(e)}return r===se$1?s.forEach(((s,r)=>{o.push(this._getResultsFromSource(e,r,t));})):o.push(this._getResultsFromSource(e,r,t)),T$1(o)}_getSuggestionsFromSources(e,t){const{allSources:s,activeSourceIndex:r}=this,o=[];if(!s.length){const e=new s$h("suggest:no-sources-defined","At least one source is required.",{allSources:s});return K.error(e),Promise.reject(e)}return r===se$1?s.forEach(((s,r)=>{o.push(this._getSuggestionsFromSource(e,r,t));})):o.push(this._getSuggestionsFromSource(e,r,t)),T$1(o)}_getResultsFromSource(e,t,s){var r;const o=this.allSources.getItemAt(t),{location:l=null}=e,i=(null==(r=this.view)?void 0:r.spatialReference)||Y$1,a=Z$1(o,"maxResults")?o.maxResults:this.maxResults,n=!!(o instanceof h$5&&Z$1(o,"exactMatch"))&&o.exactMatch,{view:u}=this;return o.getResults({view:u,sourceIndex:t,location:l,suggestResult:e,spatialReference:i,exactMatch:n,maxResults:a},s)}_getSuggestionsFromSource(e,t,s){const r=this.allSources.getItemAt(t),o=Z$1(r,"suggestionsEnabled")?r.suggestionsEnabled:this.suggestionsEnabled,l=e.length,i=Z$1(r,"minSuggestCharacters")?r.minSuggestCharacters:this.minSuggestCharacters;if(o&&e.trim()&&l>=i){var a;const o=(null==(a=this.view)?void 0:a.spatialReference)||Y$1,l=Z$1(r,"maxSuggestions")?r.maxSuggestions:this.maxSuggestions,{view:i}=this,n=!!(r instanceof h$5&&Z$1(r,"exactMatch"))&&r.exactMatch;return r.getSuggestions({view:i,sourceIndex:t,suggestTerm:e,spatialReference:o,maxSuggestions:l,exactMatch:n},s)}return Promise.resolve(null)}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return Z$1(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){const t=this.results;let s=null;return t.some((t=>t.results.some((r=>r===e&&(s=t.sourceIndex,!0))))),s}async _goToSearchResult(e){const t=!!e;this._abortGoTo();const s=new AbortController;this._gotoController=s;const r={target:{target:e},options:{animate:t,signal:s.signal}};await this.callGoTo(r),this._gotoController=null;}_getDefaultSymbol(e){var t;const{defaultSymbols:s}=this,r=null==(t=e.feature)?void 0:t.geometry;if(!r$6(r))return null;const o=this._get("defaultSymbol");if(o&&("point"===r.type||"multipoint"===r.type))return o;switch(r.type){case"point":case"multipoint":return s.point;case"polyline":return s.polyline;case"extent":case"polygon":return s.polygon;default:return null}}_removeHighlight(){this._handles.remove(W);}async _getLayerView(e){const{view:t}=this;if(!e||!t||"building-component"===e.layer.type||"subtype-sublayer"===e.layer.type)return Promise.resolve(null);const{layer:s}=e;return await t.when(),t.whenLayerView(s)}_highlightFeature(e){const{graphic:t,layerView:s}=e,{attributes:r,layer:o}=t,{objectIdField:l}=o,i=r&&r[l],a=s.highlight(i||t);this._handles.add(a,W);}};re$1.ALL_INDEX=se$1,e$6([d$b({readOnly:!0,value:null})],re$1.prototype,"activeSource",null),e$6([d$b()],re$1.prototype,"activeSourceIndex",null),e$6([d$b()],re$1.prototype,"allPlaceholder",null),e$6([d$b({readOnly:!0,dependsOn:["defaultSources.length","sources.length","includeDefaultSources"]})],re$1.prototype,"allSources",null),e$6([d$b()],re$1.prototype,"autoNavigate",void 0),e$6([d$b()],re$1.prototype,"autoSelect",void 0),e$6([d$b()],re$1.prototype,"defaultPopupTemplate",void 0),e$6([d$b({readOnly:!0})],re$1.prototype,"defaultSources",void 0),e$6([d$b()],re$1.prototype,"defaultSymbol",null),e$6([d$b()],re$1.prototype,"defaultSymbols",void 0),e$6([d$b()],re$1.prototype,"includeDefaultSources",void 0),e$6([d$b()],re$1.prototype,"locationEnabled",null),e$6([d$b()],re$1.prototype,"maxInputLength",void 0),e$6([d$b()],re$1.prototype,"maxResults",void 0),e$6([d$b()],re$1.prototype,"maxSuggestions",void 0),e$6([d$b()],re$1.prototype,"messages",void 0),e$6([d$b()],re$1.prototype,"minSuggestCharacters",void 0),e$6([d$b({readOnly:!0})],re$1.prototype,"placeholder",null),e$6([d$b()],re$1.prototype,"popupEnabled",void 0),e$6([d$b({type:M$3})],re$1.prototype,"popupTemplate",void 0),e$6([d$b({type:B})],re$1.prototype,"portal",void 0),e$6([d$b()],re$1.prototype,"resultCount",void 0),e$6([d$b()],re$1.prototype,"resultGraphicEnabled",void 0),e$6([d$b({readOnly:!0})],re$1.prototype,"resultGraphic",void 0),e$6([d$b({readOnly:!0})],re$1.prototype,"results",void 0),e$6([d$b({readOnly:!0})],re$1.prototype,"selectedSuggestion",void 0),e$6([d$b()],re$1.prototype,"searchAllEnabled",void 0),e$6([d$b({readOnly:!0})],re$1.prototype,"selectedResult",void 0),e$6([d$b()],re$1.prototype,"searchTerm",null),e$6([d$b({type:X$1})],re$1.prototype,"sources",void 0),e$6([d$b({readOnly:!0,dependsOn:["allSources.length","updating"]})],re$1.prototype,"state",null),e$6([d$b()],re$1.prototype,"suggestionDelay",void 0),e$6([d$b()],re$1.prototype,"suggestionCount",void 0),e$6([d$b({readOnly:!0})],re$1.prototype,"suggestions",void 0),e$6([d$b()],re$1.prototype,"suggestionsEnabled",void 0),e$6([d$b({readOnly:!0})],re$1.prototype,"updating",null),e$6([d$b()],re$1.prototype,"view",void 0),e$6([d$b()],re$1.prototype,"clear",null),re$1=e$6([i$j(z)],re$1);const oe$1=re$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const n$6={base:"esri-search-result-renderer esri-widget",anchor:"esri-widget__anchor",showMoreResults:"esri-search-result-renderer__more-results--show-more-results",moreResults:"esri-search-result-renderer__more-results",moreResultsList:"esri-search-result-renderer__more-results-list",moreResultsHeader:"esri-search-result-renderer__more-results-header",moreResultsItem:"esri-search-result-renderer__more-results-item",moreResultsListHeader:"esri-search-result-renderer__more-results-list-header"};let c$b=class extends z$3{constructor(e,s){super(e,s),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null;}render(){const e={[n$6.showMoreResults]:this.showMoreResultsOpen};return n$i("div",{class:n$6.base},n$i("div",{key:"esri-search-renderer__container",class:this.classes(n$6.moreResults,e)},this.renderSearchResultName(),this.renderMoreResults()))}renderMoreResults(){return n$i("div",{key:"esri-search-renderer__more-results"},this.renderMoreResultsButton(),this.renderMoreResultsLists())}renderSearchResultName(){var e;const s=null==(e=this.viewModel)?void 0:e.selectedResult,r=s&&s.name||"";return n$i("div",{key:"esri-search-renderer__result-name",class:n$6.moreResultsItem},r)}renderMoreResultsLists(){var e;const s=null==(e=this.viewModel)?void 0:e.results,{resultCount:r}=this.viewModel;if(r<2)return null;const t=s.map((e=>this.renderMoreResultsList(e)));return n$i("div",{key:"esri-search-renderer__more-results-container",class:n$6.moreResultsList},t)}renderMoreResultsButton(){const{messages:e}=this,{resultCount:s}=this.viewModel;return s<2?null:n$i("div",{key:"esri-search-renderer__more-results-button",class:n$6.moreResultsItem},n$i("a",{class:n$6.anchor,href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?e.hideMoreResults:e.showMoreResults))}renderMoreResultsHeader(e,s){return n$i("div",{key:`esri-search-result-renderer__header-${s}`,class:n$6.moreResultsListHeader},e)}renderMoreResultsList(e){var s,r;const{results:t}=e,o=t.length,l=!!o,i=null==(s=this.viewModel)?void 0:s.selectedResult,n=1===o&&t[0]===i,c=this._getSourceName(e.source,e.sourceIndex),d=(null==(r=this.viewModel)?void 0:r.results.length)>1&&!n?this.renderMoreResultsHeader(c,e.sourceIndex):null,a=l&&t.map(((e,s)=>this.renderMoreResultsListItem(e,s))),h=l&&!n?n$i("ul",{key:`esri-search-result-renderer__list-${e.sourceIndex}`},a):null;return l?n$i("div",{key:`esri-search-result-renderer__results-${e.sourceIndex}`},d,h):null}renderMoreResultsListItem(e,s){return e!==this.get("viewModel.selectedResult")?n$i("li",{key:`esri-search-result-renderer__list-item-${s}`},n$i("a",{class:n$6.anchor,href:"#",tabindex:"0",bind:this,"data-result":e,onclick:this._selectResultClick,onkeydown:this._selectResultClick},e.name)):null}_showMoreResultsClick(e){e.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const s=this.get("viewModel.view.popup");s&&s.reposition();}_selectResultClick(e){e.preventDefault();const s=e.currentTarget["data-result"];this.viewModel&&this.viewModel.select(s);}_getSourceName(e,s){return s===oe$1.ALL_INDEX?this.messages.all:e.name}};e$6([d$b(),e$7("esri/widgets/Search/t9n/Search")],c$b.prototype,"messages",void 0),e$6([d$b()],c$b.prototype,"showMoreResultsOpen",void 0),e$6([d$b()],c$b.prototype,"viewModel",void 0),e$6([t$5()],c$b.prototype,"_showMoreResultsClick",null),e$6([t$5()],c$b.prototype,"_selectResultClick",null),c$b=e$6([i$j("esri.widgets.Search.SearchResultRenderer")],c$b);const d$1=c$b;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const w={base:"esri-search esri-widget",loader:"esri-widget__loader",loaderText:"esri-widget__loader-text",loaderAnimation:"esri-widget__loader-animation",esriInput:"esri-input",hasMultipleSources:"esri-search--multiple-sources",isLoading:"esri-search--loading",isSearching:"esri-search--searching",showSuggestions:"esri-search--show-suggestions",showSources:"esri-search--sources",showWarning:"esri-search--warning",container:"esri-search__container",input:"esri-search__input",inputContainer:"esri-search__input-container",form:"esri-search__form",submitButton:"esri-search__submit-button",sourcesButton:"esri-search__sources-button",clearButton:"esri-search__clear-button",sourceName:"esri-search__source-name",suggestionsMenu:"esri-search__suggestions-menu",suggestionList:"esri-search__suggestions-list",suggestionListCurrentLocation:"esri-search__suggestions-list--current-location",sourcesMenu:"esri-search__sources-menu",source:"esri-search__source",warningMenu:"esri-search__warning-menu",warningMenuBody:"esri-search__warning-body",warningMenuHeader:"esri-search__warning-header",warningMenuText:"esri-search__warning-text",noValueText:"esri-search__no-value-text",esriWidgetDisabled:"esri-widget--disabled",button:"esri-widget--button",fallbackText:"esri-icon-font-fallback-text",header:"esri-widget__heading",locate:"esri-icon-locate-circled",menu:"esri-menu",menuList:"esri-menu__list",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuHeader:"esri-menu__header",loadingIcon:"esri-icon-loading-indicator esri-rotating",searchIcon:"esri-icon-search",dropdownIcon:"esri-icon-down-arrow esri-search__sources-button--down",dropupIcon:"esri-icon-up-arrow esri-search__sources-button--up",clearIcon:"esri-icon-close",noticeIcon:"esri-icon-notice-triangle",widgetIcon:"esri-icon-search",disabled:"esri-disabled"},S=/<[a-z/][\s\S]*>/i;let b$2=class extends z$3{constructor(e,t){super(e,t),this._activeMenuItemIndex=-1,this._handles=new u$e,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new d$1,this._locateFailed=null,this._container=null,this.activeMenu="none",this.activeSource=null,this.activeSourceIndex=null,this.allPlaceholder=null,this.allSources=null,this.autoNavigate=null,this.autoSelect=null,this.defaultSources=null,this.disabled=!1,this.goToOverride=null,this.iconClass=w.widgetIcon,this.includeDefaultSources=null,this.label=void 0,this.locationEnabled=null,this.maxResults=null,this.maxSuggestions=null,this.messages=null,this.messagesCommon=null,this.minSuggestCharacters=null,this.popupEnabled=null,this.popupTemplate=null,this.portal=null,this.resultGraphic=null,this.resultGraphicEnabled=null,this.results=null,this.searchAllEnabled=null,this.searchTerm=null,this.selectedResult=null,this.sources=null,this.suggestions=null,this.suggestionsEnabled=null,this.view=null,this.viewModel=new oe$1,this._clearActiveMenu=()=>{this.activeMenu="none";},this._removeActiveMenu=e=>{var t;const s=e.relatedTarget;s&&null!=(t=this._container)&&t.contains(s)||this._clearActiveMenu();},this.own(f$b(this,"searchTerm",(e=>{(e&&"warning"===this.activeMenu||!e&&!this.get("viewModel.selectedSuggestion.location"))&&this._clearActiveMenu();})),$$4(this,"viewModel.allSources","change",(()=>this._watchSourceChanges())),i$m(this,"activeMenu",(()=>this._resetActiveMenuItemIndex())),i$m(this,"viewModel.defaultPopupTemplate",(e=>{e&&(e.content=this._renderSearchResultsContent.bind(this));})));}destroy(){this._handles.destroy(),this._handles=null,this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),this._searchResultRenderer=null);}get displayedSearchTerm(){return `${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}clear(){}focus(){var e;null==(e=this._inputNode)||e.focus(),this.emit("search-focus");}blur(){var e;null==(e=this._inputNode)||e.blur(),this.emit("search-blur");}search(e){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const t=new AbortController,{signal:s}=t;return this._searchController=t,this.viewModel.search(e,{signal:s}).catch((e=>{if(this._searchController===t)return this._clearActiveMenu(),this._searchController=null,e})).then((e=>{if(this._searchController===t)return this.activeMenu=e.numResults?"none":"warning",this._searchController=null,e}))}suggest(e){this._cancelSuggest();const t=new AbortController,{signal:s}=t;return this._suggestController=t,this.viewModel.suggest(e,null,{signal:s}).then((e=>{if(this._suggestController===t)return this._suggestController=null,e.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),e})).catch((()=>{if(this._suggestController===t)return this._suggestController=null,null}))}render(){const{state:e}=this.viewModel,t={[w.disabled]:"disabled"===e,[w.esriWidgetDisabled]:this.disabled};return n$i("div",{class:this.classes(w.base,t)},"loading"===e?this.renderLoader():this.renderContainer())}renderSubmitButton(){const{messages:e}=this;return n$i("button",{"aria-label":e.searchButtonTitle,bind:this,class:this.classes(w.submitButton,w.button),key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:e.searchButtonTitle},n$i("span",{"aria-hidden":"true",class:w.searchIcon}))}renderWarningMenu(){return n$i("div",{key:"esri-search__error-menu",class:this.classes(w.menu,w.warningMenu)},n$i("div",{class:w.warningMenuBody},this.renderWarning()))}renderSourceMenuButton(){const{messages:e,activeMenu:t,sourceMenuId:s,sourceMenuButtonId:i}=this,{activeSourceIndex:r,allSources:n}=this.viewModel;return n.length>1?n$i("button",{id:i,key:"esri-search__source-menu-button",bind:this,"aria-label":e.searchIn,title:e.searchIn,"aria-haspopup":"true","aria-expanded":("source"===t).toString(),"aria-controls":s,class:this.classes(w.sourcesButton,w.button),onclick:this._handleSourcesMenuToggleClick,onfocus:this._clearActiveMenu,afterCreate:g$a,"data-node-ref":"_sourceMenuButtonNode"},n$i("span",{"aria-hidden":"true",class:w.dropdownIcon}),n$i("span",{"aria-hidden":"true",class:w.dropupIcon}),n$i("span",{class:w.sourceName},this._getSourceName(r))):null}renderSourcesList(){const{allSources:e,searchAllEnabled:t}=this.viewModel,{_activeMenuItemIndex:s,activeMenu:i,sourceMenuId:r,sourceMenuButtonId:n}=this,o="source"===i&&s>-1?this._buildId("source-item",s):null;return e.length>1?n$i("ul",{"aria-activedescendant":o,"aria-labelledby":n,id:r,role:"menu",bind:this,afterCreate:g$a,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,"data-node-ref":"_sourceListNode",class:w.menuList,tabIndex:-1},t?this.renderSource(oe$1.ALL_INDEX):null,e.map(((e,t)=>this.renderSource(t))).toArray()):null}renderSourcesMenu(){const{allSources:e}=this.viewModel;return e.length>1?n$i("div",{key:"esri-search__source-menu",class:this.classes(w.menu,w.sourcesMenu)},this.renderSourcesList()):null}renderLoader(){const{messages:e,messagesCommon:t}=this;return n$i("div",{class:w.loader,key:"base-loader"},n$i("span",{"aria-hidden":"true",class:w.loaderAnimation}),n$i("span",{class:w.fallbackText},e.searchButtonTitle),n$i("span",{class:w.loaderText},t.loading))}renderContainer(){const{allSources:e,state:t}=this.viewModel,{activeMenu:s}=this,i={[w.hasMultipleSources]:e.length>1,[w.isLoading]:"loading"===t,[w.isSearching]:"searching"===t,[w.showWarning]:"warning"===s,[w.showSources]:"source"===s,[w.showSuggestions]:"suggestion"===s};return n$i("div",{tabIndex:-1,afterCreate:e=>{this._container=e,e.addEventListener("focusout",this._removeActiveMenu);},afterRemoved:e=>{e.removeEventListener("focusout",this._removeActiveMenu);},class:this.classes(i,w.container),key:"base-container"},this.renderSourceMenuButton(),this.renderSourcesMenu(),this.renderInputContainer(),this.renderSubmitButton(),this.renderWarningMenu())}renderClearButton(){return this.searchTerm?n$i("button",{bind:this,class:this.classes(w.clearButton,w.button),key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle},n$i("span",{"aria-hidden":"true",class:w.clearIcon})):null}renderLocationGroup(){const{messages:e,locationEnabled:t,displayedSearchTerm:s}=this,i=t&&!s,r="suggestion"===this.activeMenu&&0===this._activeMenuItemIndex;return i?n$i("ul",{role:"group",key:"esri-search__suggestion-list-current-location",class:this.classes(w.menuList,w.suggestionList,w.suggestionListCurrentLocation)},n$i("li",{bind:this,"data-current-location-item":!0,onclick:this._handleUseCurrentLocationClick,id:this._buildId("suggestion-item",0),"aria-selected":("suggestion"===this.activeMenu&&0===this._activeMenuItemIndex).toString(),role:"option",class:this.classes(w.menuItem,r?w.menuItemFocus:null)},n$i("span",{"aria-hidden":"true",class:w.locate})," ",e.useCurrentLocation)):null}renderInput(){const{activeMenu:e,locationEnabled:t,displayedSearchTerm:s,messages:i,suggestionsMenuId:r,inputId:n,_activeMenuItemIndex:o}=this,{maxInputLength:a,placeholder:u,searchTerm:l,suggestionCount:c}=this.viewModel,d=!(!(t&&!s)&&!c),h="suggestion"===e&&o>-1?this._buildId("suggestion-item",o):null;return n$i("input",{"aria-activedescendant":h,"aria-autocomplete":"list","aria-expanded":(d&&"suggestion"===e).toString(),"aria-controls":d?r:null,"aria-haspopup":"listbox","aria-label":i.searchButtonTitle,bind:this,placeholder:u,maxlength:a,autocomplete:"off",type:"text",class:this.classes(w.esriInput,w.input),value:l,id:n,role:"combobox",onkeyup:this._handleInputKeyup,onclick:this._openSuggestionMenu,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:g$a,"data-node-ref":"_inputNode",onfocus:this.focus,onblur:this.blur,title:l?"":u})}renderForm(){return n$i("form",{key:"esri-search__form",bind:this,class:w.form,onsubmit:this._formSubmit,role:"search"},this.renderInput())}renderSuggestList(e){const{sourceIndex:t}=e,s=e.results.length,i=e.results;return s?n$i("ul",{role:"group",key:`esri-search__suggestion-list-${t}`,class:this.classes(w.menuList,w.suggestionList)},i.map((e=>this.renderSuggestion(e,this._menuItemCount++)))):null}renderSuggestionsGroup(){const{suggestions:e}=this.viewModel;return e?e.map((e=>[this.renderSuggestionHeader(e),this.renderSuggestList(e)])):null}renderSuggestionsMenu(){const{displayedSearchTerm:e,locationEnabled:t,suggestionsMenuId:s,inputId:i}=this,{suggestionCount:r}=this.viewModel,n=t&&!e||r;return this._menuItemCount=0,n?n$i("div",{id:s,key:"esri-search__suggestions-menu",class:this.classes(w.menu,w.suggestionsMenu),role:"listbox","aria-labelledby":i,bind:this,afterCreate:g$a,"data-node-ref":"_suggestionListNode"},this.renderLocationGroup(),this.renderSuggestionsGroup()):null}renderInputContainer(){return n$i("div",{key:"esri-search__input-container",class:w.inputContainer},this.renderForm(),this.renderSuggestionsMenu(),this.renderClearButton())}renderSuggestionHeader(e){const{allSources:t,activeSourceIndex:s}=this.viewModel,{sourceIndex:i}=e,r=e.results.length,n=t.length>1&&s===oe$1.ALL_INDEX;return r&&n?n$i("div",{key:`esri-search__suggestion-header-${i}`,class:w.menuHeader},this._getSourceName(i)):null}renderSuggestion(e,t){const{_activeMenuItemIndex:s,messages:i}=this,{searchTerm:r}=this.viewModel;if(r){const{text:n}=e,o=n||i.untitledResult,a=S.test(o),u=[];if(a)u.push(n$i("div",{innerHTML:o}));else {const e=this._splitResult(o,r),t=r.toLowerCase();e.forEach(((e,s)=>{e&&e.length&&(e.toLowerCase()===t?u.push(n$i("strong",{key:s},e)):u.push(e));}));}const l="suggestion"===this.activeMenu&&s===t;return n$i("li",{bind:this,id:this._buildId("suggestion-item",t),"aria-selected":("suggestion"===this.activeMenu&&this._activeMenuItemIndex===t).toString(),onclick:this._handleSuggestionClick,key:`esri-search__suggestion_${t}`,"data-suggestion":e,role:"option",class:this.classes(w.menuItem,l?w.menuItemFocus:null)},u)}}renderSource(e){const{activeSourceIndex:t,searchAllEnabled:s}=this.viewModel,i={[w.menuItemActive]:e===t,[w.menuItemFocus]:"source"===this.activeMenu&&e===(s?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},r=s?e+1:e;return n$i("li",{bind:this,key:`esri-search__source-${e}`,id:this._buildId("source-item",r),"aria-checked":(e===t).toString(),onclick:this._handleSourceClick,"data-source-index":e,role:"menuitemradio",class:this.classes(w.source,w.menuItem,i)},this._getSourceName(e))}renderNoResultsWarning(e){const{messages:t}=this,s=e?s$f(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return n$i("div",{key:"esri-search__no_results"},n$i("div",{class:w.warningMenuHeader},t.noResults),n$i("div",{class:w.warningMenuText},s))}renderEmptySearchWarning(){const{messages:e}=this;return n$i("div",{key:"esri-search__empty-search"},n$i("span",{"aria-hidden":"true",class:w.noticeIcon}),n$i("span",{class:w.noValueText},e.emptyValue))}renderLocateWarning(){const{messages:e}=this;return n$i("div",{key:"esri-search__locate-error"},n$i("span",{"aria-hidden":"true",class:w.noticeIcon}),n$i("span",{class:w.noValueText},e.locateError))}renderWarning(){var e;const{displayedSearchTerm:t,_locateFailed:s}=this,{viewModel:i}=this;return s?this.renderLocateWarning():null!=(e=i.selectedSuggestion)&&e.location||t?this.renderNoResultsWarning(t):this.renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1;}_buildId(e,t){return `${this.id}-${e}${void 0===t?"":`-${t}`}`}_watchSourceChanges(){const{_handles:e,viewModel:{allSources:t}}=this,s="sources";e.remove(s),t.forEach((t=>e.add(f$b(t,"name",(()=>this.scheduleRender())),s)));}_handleSourcesMenuToggleClick(){const e="source"===this.activeMenu;var t;(this.activeMenu=e?"none":"source",this.renderNow(),"source"===this.activeMenu)&&(null==(t=this._sourceListNode)||t.focus());}_handleClearButtonClick(){this.viewModel.clear(),this._focus();}_handleSearchButtonClick(){this.search();}_handleSuggestionClick(e){const t=e.currentTarget["data-suggestion"];t&&(this._focus(),this.search(t));}_handleUseCurrentLocationClick(){this._useCurrentLocation();}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const e=new AbortController,{signal:t}=e;this._searchController=e,this.viewModel.searchNearby({signal:t}).catch((()=>{this._locateFailed=!0,this.activeMenu="warning";})).then((()=>{this._searchController=null;}));}_handleSourceClick(e){this._setSourceFromMenuItem(e.currentTarget);}_setSourceFromMenuItem(e){var t;if(!e)return;const s=e["data-source-index"];this.viewModel.activeSourceIndex=s,this._clearActiveMenu(),null==(t=this._sourceMenuButtonNode)||t.focus();}_cancelSuggest(){this._suggestController&&(this._suggestController.abort(),this._suggestController=null);}_cancelSearch(){this._searchController&&(this._searchController.abort(),this._searchController=null),this._locateFailed=!1;}_handleInputKeyup(e){var s;const i=i$o(e);if(e.ctrlKey||e.metaKey||"Copy"===i||"ArrowLeft"===i||"ArrowRight"===i||"Shift"===i)return;if("Tab"===i||"Escape"===i||e.shiftKey&&"Tab"===i)return this._cancelSuggest(),void("Escape"===i&&this._clearActiveMenu());const r="Home"===i||"End"===i||"ArrowUp"===i||"ArrowDown"===i;if("Enter"===i&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const n=null==(s=this._suggestionListNode)?void 0:s.getElementsByTagName("li");if(null!=n&&n.length){if("suggestion"!==this.activeMenu&&this._openSuggestionMenu(),r)return e.preventDefault(),this._cancelSuggest(),void this.handleItemNavigation(i,n,this._suggestionListNode);const t=n[this._activeMenuItemIndex];if("Enter"===i&&t){const e=t["data-suggestion"];return void(e?(this._focus(),this.search(e)):t["data-current-location-item"]&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest();}handleItemNavigation(e,t,s){const i=this._activeMenuItemIndex;"Home"===e&&(this._activeMenuItemIndex=0),"End"===e&&(this._activeMenuItemIndex=t.length-1),"ArrowUp"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?t.length-1:this._activeMenuItemIndex-1),"ArrowDown"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex===t.length-1?0:this._activeMenuItemIndex+1),i!==this._activeMenuItemIndex&&w$8(t[this._activeMenuItemIndex],s);}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0);}_openSuggestionMenu(){this.activeMenu="suggestion";}_handleInputPaste(e){const t=e.target;this.viewModel.searchTerm!==t.value&&(this.viewModel.searchTerm=t.value),this.viewModel.searchTerm&&this.suggest();}_handleSourceMenuKeydown(e){const s=i$o(e);if(y$a(s)){e.preventDefault();const t=this._sourceListNode.getElementsByTagName("li")[this._activeMenuItemIndex];this._setSourceFromMenuItem(t);}else "ArrowUp"!==s&&"ArrowDown"!==s&&"End"!==s&&"Home"!==s||e.preventDefault();}_handleSourceMenuKeyup(e){var s;const i=i$o(e),r="ArrowUp"===i||"ArrowDown"===i||"End"===i||"Home"===i;var n;if(r&&e.preventDefault(),"Escape"===i)return this._clearActiveMenu(),void(null==(n=this._sourceMenuButtonNode)||n.focus());const o=null==(s=this._sourceListNode)?void 0:s.getElementsByTagName("li");return o&&0!==o.length&&r?("source"!==this.activeMenu&&(this.activeMenu="source"),void this.handleItemNavigation(i,o,this._sourceListNode.parentElement)):void 0}_focus(e){this.focus(),e&&(this.activeMenu=e);}_formSubmit(e){e.preventDefault(),-1===this._activeMenuItemIndex&&this.search();}_getSourceName(e){const{messages:t}=this,s=this.viewModel,{allSources:i}=s,r=i.getItemAt(e);return e===oe$1.ALL_INDEX?t.all:r&&r.name||t.untitledSource}_splitResult(e,t){const s=o$8(t);return e.replace(new RegExp(`(^|)(${s})(|$)`,"ig"),"$1|$2|$3").split("|")}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};e$6([d$b()],b$2.prototype,"_activeMenuItemIndex",void 0),e$6([d$b()],b$2.prototype,"displayedSearchTerm",null),e$6([d$b({readOnly:!0})],b$2.prototype,"inputId",null),e$6([d$b({readOnly:!0})],b$2.prototype,"suggestionsMenuId",null),e$6([d$b({readOnly:!0})],b$2.prototype,"sourceMenuId",null),e$6([d$b({readOnly:!0})],b$2.prototype,"sourceMenuButtonId",null),e$6([d$b()],b$2.prototype,"activeMenu",void 0),e$6([o$6("viewModel.activeSource")],b$2.prototype,"activeSource",void 0),e$6([o$6("viewModel.activeSourceIndex")],b$2.prototype,"activeSourceIndex",void 0),e$6([o$6("viewModel.allPlaceholder")],b$2.prototype,"allPlaceholder",void 0),e$6([o$6("viewModel.allSources")],b$2.prototype,"allSources",void 0),e$6([o$6("viewModel.autoNavigate")],b$2.prototype,"autoNavigate",void 0),e$6([o$6("viewModel.autoSelect")],b$2.prototype,"autoSelect",void 0),e$6([o$6("viewModel.defaultSources")],b$2.prototype,"defaultSources",void 0),e$6([d$b()],b$2.prototype,"disabled",void 0),e$6([o$6("viewModel.goToOverride")],b$2.prototype,"goToOverride",void 0),e$6([d$b()],b$2.prototype,"iconClass",void 0),e$6([o$6("viewModel.includeDefaultSources")],b$2.prototype,"includeDefaultSources",void 0),e$6([d$b({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],b$2.prototype,"label",void 0),e$6([o$6("viewModel.locationEnabled")],b$2.prototype,"locationEnabled",void 0),e$6([o$6("viewModel.maxResults")],b$2.prototype,"maxResults",void 0),e$6([o$6("viewModel.maxSuggestions")],b$2.prototype,"maxSuggestions",void 0),e$6([d$b(),e$7("esri/widgets/Search/t9n/Search")],b$2.prototype,"messages",void 0),e$6([d$b(),e$7("esri/t9n/common")],b$2.prototype,"messagesCommon",void 0),e$6([o$6("viewModel.minSuggestCharacters")],b$2.prototype,"minSuggestCharacters",void 0),e$6([o$6("viewModel.popupEnabled")],b$2.prototype,"popupEnabled",void 0),e$6([o$6("viewModel.popupTemplate")],b$2.prototype,"popupTemplate",void 0),e$6([o$6("viewModel.portal")],b$2.prototype,"portal",void 0),e$6([o$6("viewModel.resultGraphic")],b$2.prototype,"resultGraphic",void 0),e$6([o$6("viewModel.resultGraphicEnabled")],b$2.prototype,"resultGraphicEnabled",void 0),e$6([o$6("viewModel.results")],b$2.prototype,"results",void 0),e$6([o$6("viewModel.searchAllEnabled")],b$2.prototype,"searchAllEnabled",void 0),e$6([o$6("viewModel.searchTerm")],b$2.prototype,"searchTerm",void 0),e$6([o$6("viewModel.selectedResult")],b$2.prototype,"selectedResult",void 0),e$6([o$6("viewModel.sources")],b$2.prototype,"sources",void 0),e$6([o$6("viewModel.suggestions")],b$2.prototype,"suggestions",void 0),e$6([o$6("viewModel.suggestionsEnabled")],b$2.prototype,"suggestionsEnabled",void 0),e$6([o$6("viewModel.view")],b$2.prototype,"view",void 0),e$6([t$a(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),d$b({type:oe$1})],b$2.prototype,"viewModel",void 0),e$6([o$6("viewModel.clear")],b$2.prototype,"clear",null),b$2=e$6([i$j("esri.widgets.Search")],b$2);const y$2=b$2;

const arcgisSearchCss = "@import url('https://js.arcgis.com/next/esri/themes/light/main.css');";

let ArcGISSearch = class {
  constructor(hostRef) {
    registerInstance(this, hostRef);
    this.searchBlur = createEvent(this, "searchBlur", 7);
    this.searchClear = createEvent(this, "searchClear", 7);
    this.searchComplete = createEvent(this, "searchComplete", 7);
    this.searchFocus = createEvent(this, "searchFocus", 7);
    this.searchStart = createEvent(this, "searchStart", 7);
    this.selectResult = createEvent(this, "selectResult", 7);
    this.suggestComplete = createEvent(this, "suggestComplete", 7);
    this.suggestStart = createEvent(this, "suggestStart", 7);
  }
  validateView(newValue) {
    if (newValue) {
      this.widget.view = newValue;
      if (this.el.parentElement.tagName.toLowerCase() !== 'arcgis-expand') {
        this.widget.view.ui.add(this.widget, this.position);
      }
    }
  }
  componentWillLoad() {
    const search = new y$2({
      container: this.el
    });
    // proxy events
    search.on('search-blur', (e) => this.searchBlur.emit(e));
    search.on('search-clear', (e) => this.searchClear.emit(e));
    search.on('search-complete', (e) => this.searchComplete.emit(e));
    search.on('search-focus', (e) => this.searchFocus.emit(e));
    search.on('search-start', (e) => this.searchStart.emit(e));
    search.on('select-result', (e) => this.selectResult.emit(e));
    search.on('suggest-complete', (e) => this.suggestComplete.emit(e));
    search.on('suggest-start', (e) => this.suggestStart.emit(e));
    this.widget = search;
  }
  render() {
    return (h$a("div", { class: "search-container" }));
  }
  get el() { return getElement(this); }
  static get watchers() { return {
    "view": ["validateView"]
  }; }
};
ArcGISSearch.style = arcgisSearchCss;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const y$1=s$e.getLogger("esri.networks.Network");let m$3=class extends(l$h(m$c)){constructor(e){super(e),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null;}initialize(){this.when().catch((e=>{var r,t;d$d(e)||y$1.error("#load()",`Failed to load layer (title: '${null!=(r=this.title)?r:"no title"}', id: '${null!=(t=this.id)?t:"no id"}')`,{error:e});}));}get datasetName(){var e;return null==(e=this.dataElement)?void 0:e.name}get owner(){var e;return null==(e=this.dataElement)?void 0:e.userIdentity}get schemaGeneration(){var e;return null==(e=this.dataElement)?void 0:e.schemaGeneration}get parsedUrl(){const e=this.layerUrl;return e?U$3(e):null}get featureServiceUrl(){const e=this.parsedUrl&&d$e(this.parsedUrl.path);return r$6(e)?e.url.path:null}get networkServiceUrl(){return this.featureServiceUrl?this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer"):null}get layerId(){const e=this.parsedUrl&&d$e(this.parsedUrl.path);return r$6(e)?e.sublayer:null}async load(e){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),e)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,e)),this}getLayerIdBySourceId(e){if(this.dataElement){const r=this.dataElement.domainNetworks;for(const t of r){for(const r of t.edgeSources?t.edgeSources:[])if(r.sourceId===e)return r.layerId;for(const r of t.junctionSources?t.junctionSources:[])if(r.sourceId===e)return r.layerId}return null}return null}async _fetchLayerMetaData(e,t){const o=await E$1(e,{responseType:"json",query:{f:"json"},...t});this.read(o.data,{origin:"service"});}async _fetchDataElement(e,t,o){if(this.dataElement)return;const s=await E$1(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...o}).then((e=>{var r;return null==(r=e.data.layerDataElements)?void 0:r[0]}));s&&this.read(s,{origin:"service"});}};e$6([d$b({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}}},read:!1}})],m$3.prototype,"id",void 0),e$6([d$b({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}}},read:!1}})],m$3.prototype,"title",void 0),e$6([d$b({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],m$3.prototype,"layerUrl",void 0),e$6([d$b({type:Object,json:{origins:{service:{read:!0}},read:!1}})],m$3.prototype,"dataElement",void 0),e$6([d$b({type:M$2,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],m$3.prototype,"fullExtent",void 0),e$6([d$b({type:k$3,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],m$3.prototype,"spatialReference",void 0),e$6([d$b({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],m$3.prototype,"type",void 0),e$6([d$b({readOnly:!0})],m$3.prototype,"datasetName",null),e$6([d$b({readOnly:!0})],m$3.prototype,"owner",null),e$6([d$b({readOnly:!0})],m$3.prototype,"schemaGeneration",null),e$6([d$b({readOnly:!0})],m$3.prototype,"parsedUrl",null),e$6([d$b({readOnly:!0})],m$3.prototype,"featureServiceUrl",null),e$6([d$b({readOnly:!0})],m$3.prototype,"networkServiceUrl",null),e$6([d$b({readOnly:!0})],m$3.prototype,"layerId",null),m$3=e$6([i$j("esri.networks.Network")],m$3);const h$2=m$3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$8=class extends a$f{constructor(t){super(t),this.conditionBarriers=[],this.outputConditions=[],this.functions=[],this.functionBarriers=[],this.traversabilityScope=null,this.shortestPathNetworkAttributeName=null,this.includeBarriers=null,this.validateConsistency=null,this.ignoreBarriersAtStartingPoints=null;}};e$6([d$b({type:[Object],json:{write:!0}})],s$8.prototype,"conditionBarriers",void 0),e$6([d$b({type:[Object],json:{write:!0}})],s$8.prototype,"outputConditions",void 0),e$6([d$b({type:[Object],json:{write:!0}})],s$8.prototype,"functions",void 0),e$6([d$b({type:[Object],json:{write:!0}})],s$8.prototype,"functionBarriers",void 0),e$6([d$b({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],s$8.prototype,"traversabilityScope",void 0),e$6([d$b({type:String,json:{write:!0}})],s$8.prototype,"shortestPathNetworkAttributeName",void 0),e$6([d$b({type:Boolean,json:{write:!0}})],s$8.prototype,"includeBarriers",void 0),e$6([d$b({type:Boolean,json:{write:!0}})],s$8.prototype,"validateConsistency",void 0),e$6([d$b({type:Boolean,json:{write:!0}})],s$8.prototype,"ignoreBarriersAtStartingPoints",void 0),s$8=e$6([i$j("esri.networks.support.TraceConfiguration")],s$8);const i$9=s$8;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const t$1=new o$7({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork","subnetwork controllers":"subnetwork-controllers",loops:"loops",isolation:"isolation"});

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let i$8=class extends i$9{constructor(t){super(t),this.filterBarriers=[],this.domainNetworkName=null,this.filterBitsetNetworkAttributeName=null,this.filterFunctionBarriers=[],this.filterScope=null,this.includeContainers=null,this.includeContent=null,this.includeIsolated=null,this.includeStructures=null,this.includeUpToFirstSpatialContainer=null,this.nearestNeighbor=null,this.outputFilterCategories=[],this.outputFilters=[],this.propagators=[],this.subnetworkName=null,this.targetTierName=null,this.tierName=null,this.validateLocatability=null;}};e$6([d$b({type:[Object],json:{write:!0}})],i$8.prototype,"filterBarriers",void 0),e$6([d$b({type:String,json:{write:!0}})],i$8.prototype,"domainNetworkName",void 0),e$6([d$b({type:String,json:{write:!0}})],i$8.prototype,"filterBitsetNetworkAttributeName",void 0),e$6([d$b({type:[Object],json:{write:!0}})],i$8.prototype,"filterFunctionBarriers",void 0),e$6([d$b({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],i$8.prototype,"filterScope",void 0),e$6([d$b({type:Boolean,json:{write:!0}})],i$8.prototype,"includeContainers",void 0),e$6([d$b({type:Boolean,json:{write:!0}})],i$8.prototype,"includeContent",void 0),e$6([d$b({type:Boolean,json:{write:!0}})],i$8.prototype,"includeIsolated",void 0),e$6([d$b({type:Boolean,json:{write:!0}})],i$8.prototype,"includeStructures",void 0),e$6([d$b({type:Boolean,json:{write:!0}})],i$8.prototype,"includeUpToFirstSpatialContainer",void 0),e$6([d$b({type:Object,json:{write:!0}})],i$8.prototype,"nearestNeighbor",void 0),e$6([d$b({type:[Object],json:{write:!0}})],i$8.prototype,"outputFilterCategories",void 0),e$6([d$b({type:[Object],json:{write:!0}})],i$8.prototype,"outputFilters",void 0),e$6([d$b({type:[Object],json:{write:!0}})],i$8.prototype,"propagators",void 0),e$6([d$b({type:String,json:{write:!0}})],i$8.prototype,"subnetworkName",void 0),e$6([d$b({type:String,json:{write:!0}})],i$8.prototype,"targetTierName",void 0),e$6([d$b({type:String,json:{write:!0}})],i$8.prototype,"tierName",void 0),e$6([d$b({type:Boolean,json:{write:!0}})],i$8.prototype,"validateLocatability",void 0),i$8=e$6([i$j("esri.networks.support.UNTraceConfiguration")],i$8);const s$7=i$8;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let p$8=class extends O$3{constructor(r){super(r),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null;}readTraceConfiguration(r,e){return void 0!==r.tierName?s$7.fromJSON(r):i$9.fromJSON(r)}};e$6([d$b({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"}}},read:!1}})],p$8.prototype,"globalId",void 0),e$6([d$b({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],p$8.prototype,"title",void 0),e$6([d$b({type:i$9,json:{origins:{service:{read:!0}},read:!1}})],p$8.prototype,"traceConfiguration",void 0),e$6([o$9("service","traceConfiguration")],p$8.prototype,"readTraceConfiguration",null),e$6([d$b({type:Date,json:{origins:{service:{read:!0}},read:!1}})],p$8.prototype,"creationDate",void 0),e$6([d$b({type:String,json:{origins:{service:{read:!0}},read:!1}})],p$8.prototype,"creator",void 0),e$6([d$b({type:String,json:{origins:{service:{read:!0}},read:!1}})],p$8.prototype,"description",void 0),e$6([d$b({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"}}},read:!1}})],p$8.prototype,"minStartingPoints",void 0),e$6([d$b({type:[Object],json:{origins:{service:{read:!0}},read:!1}})],p$8.prototype,"resultTypes",void 0),e$6([d$b({type:[String],json:{origins:{service:{read:!0}},read:!1}})],p$8.prototype,"tags",void 0),e$6([d$b({type:t$1.apiValues,json:{type:t$1.jsonValues,origins:{service:{read:t$1.read}},read:!1}})],p$8.prototype,"traceType",void 0),p$8=e$6([i$j("esri.networks.support.NamedTraceConfiguration")],p$8);const c$a=p$8;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$6=class extends a$f{constructor(r){super(r),this.id=null,this.name=null;}};e$6([d$b({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],s$6.prototype,"id",void 0),e$6([d$b({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],s$6.prototype,"name",void 0),e$6([d$b({type:Boolean,json:{write:!0}})],s$6.prototype,"isUpstreamTerminal",void 0),s$6=e$6([i$j("esri.networks.support.Terminal")],s$6);const p$7=s$6;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const a$7=new o$7({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let n$5=class extends a$f{constructor(r){super(r),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null;}};e$6([d$b({type:String,json:{write:!0}})],n$5.prototype,"defaultConfiguration",void 0),e$6([d$b({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],n$5.prototype,"id",void 0),e$6([d$b({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],n$5.prototype,"name",void 0),e$6([d$b({type:[p$7],json:{write:!0}})],n$5.prototype,"terminals",void 0),e$6([d$b({type:a$7.apiValues,json:{type:a$7.jsonValues,read:a$7.read,write:a$7.write}})],n$5.prototype,"traversabilityModel",void 0),n$5=e$6([i$j("esri.networks.support.TerminalConfiguration")],n$5);const p$6=n$5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$5=class extends h$2{constructor(r){super(r),this.sharedNamedTraceConfigurations=[],this.type="utility";}get serviceTerritoryFeatureLayerId(){var r;return null==(r=this.dataElement)?void 0:r.serviceTerritoryFeatureLayerId}get terminalConfigurations(){var r;return (null==(r=this.dataElement)?void 0:r.terminalConfigurations.map((r=>p$6.fromJSON(r))))||[]}get domainNetworkNames(){var r;return (null==(r=this.dataElement)?void 0:r.domainNetworks.map((r=>r.domainNetworkName)))||[]}async load(r){return this.addResolvingPromise(super.load(r)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(r)),this}getTerminalConfiguration(r){let e=null,t=null;const o=r.layer;let a=null;if("feature"!==(null==o?void 0:o.type))return null;if(a=o.layerId,null===a)return null;const n=r.attributes;if(null==n)return null;for(const i of Object.keys(n))"ASSETGROUP"===i.toUpperCase()&&(e=r.getAttribute(i)),"ASSETTYPE"===i.toUpperCase()&&(t=r.getAttribute(i));if(!this.dataElement)return null;let s=null;const l=this.dataElement.domainNetworks;for(const i of l){var u;const r=null==(u=i.junctionSources)?void 0:u.find((r=>r.layerId===a));if(r){var d;const o=null==(d=r.assetGroups)?void 0:d.find((r=>r.assetGroupCode===e));if(o){var m;const r=null==(m=o.assetTypes)?void 0:m.find((r=>r.assetTypeCode===t));if(r){s=r.terminalConfigurationId;break}}}}if(null!=s){const r=this.dataElement.terminalConfigurations,e=null==r?void 0:r.find((r=>r.terminalConfigurationId===s));return e?p$6.fromJSON(e):null}return null}getTierNames(r){var e;const t=null==(e=this.dataElement)?void 0:e.domainNetworks.find((e=>e.domainNetworkName===r));return (null==t?void 0:t.tiers.map((r=>r.name)))||[]}async _loadNamedTraceConfigurationsFromNetwork(r){var e;if(0===(null==(e=this.sharedNamedTraceConfigurations)?void 0:e.length))return;const t=this.sharedNamedTraceConfigurations.map((r=>r.globalId)),o=await this._fetchTraceConfigData(this.networkServiceUrl,t,r);for(const a of this.sharedNamedTraceConfigurations){const r=null==o?void 0:o.find((r=>r.globalId===a.globalId));r&&a.read(r,{origin:"service"});}}_fetchTraceConfigData(r,t,o){return E$1(`${r}/traceConfigurations/query`,{responseType:"json",query:{globalIds:JSON.stringify(t),f:"json"},...o}).then((r=>r.data.traceConfigurations))}};e$6([d$b({type:[c$a],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],s$5.prototype,"sharedNamedTraceConfigurations",void 0),e$6([d$b({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],s$5.prototype,"type",void 0),e$6([d$b({readOnly:!0})],s$5.prototype,"serviceTerritoryFeatureLayerId",null),e$6([d$b({readOnly:!0})],s$5.prototype,"terminalConfigurations",null),e$6([d$b({readOnly:!0})],s$5.prototype,"domainNetworkNames",null),s$5=e$6([i$j("esri.networks.UtilityNetwork")],s$5);const l$4=s$5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$4=class extends a$f{constructor(r){super(r),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null;}};e$6([d$b({type:String,json:{write:!0}})],s$4.prototype,"facilityIdField",void 0),e$6([d$b({type:String,json:{write:!0}})],s$4.prototype,"layerId",void 0),e$6([d$b({type:String,json:{write:!0}})],s$4.prototype,"nameField",void 0),e$6([d$b({type:String,json:{write:!0}})],s$4.prototype,"siteIdField",void 0),e$6([d$b({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],s$4.prototype,"sublayerId",void 0),s$4=e$6([i$j("esri.layers.support.FacilityLayerInfo")],s$4);const i$7=s$4;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let i$6=class extends a$f{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null;}};e$6([d$b({type:String,json:{write:!0}})],i$6.prototype,"facilityIdField",void 0),e$6([d$b({type:String,json:{write:!0}})],i$6.prototype,"layerId",void 0),e$6([d$b({type:String,json:{write:!0}})],i$6.prototype,"levelIdField",void 0),e$6([d$b({type:String,json:{write:!0}})],i$6.prototype,"levelNumberField",void 0),e$6([d$b({type:String,json:{write:!0}})],i$6.prototype,"longNameField",void 0),e$6([d$b({type:String,json:{write:!0}})],i$6.prototype,"shortNameField",void 0),e$6([d$b({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],i$6.prototype,"sublayerId",void 0),e$6([d$b({type:String,json:{write:!0}})],i$6.prototype,"verticalOrderField",void 0),i$6=e$6([i$j("esri.layers.support.LevelLayerInfo")],i$6);const s$3=i$6;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$2=class extends a$f{constructor(r){super(r),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null;}};e$6([d$b({type:String,json:{write:!0}})],s$2.prototype,"layerId",void 0),e$6([d$b({type:String,json:{write:!0}})],s$2.prototype,"nameField",void 0),e$6([d$b({type:String,json:{write:!0}})],s$2.prototype,"siteIdField",void 0),e$6([d$b({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],s$2.prototype,"sublayerId",void 0),s$2=e$6([i$j("esri.layers.support.SiteLayerInfo")],s$2);const i$5=s$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let a$6=class extends a$f{constructor(r){super(r),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null;}};e$6([d$b({type:s$3,json:{write:!0}})],a$6.prototype,"levelLayer",void 0),e$6([d$b({type:i$7,json:{write:!0}})],a$6.prototype,"facilityLayer",void 0),e$6([d$b({type:i$5,json:{write:!0}})],a$6.prototype,"siteLayer",void 0),a$6=e$6([i$j("esri.support.MapFloorInfo")],a$6);const l$3=a$6;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var s$1;let a$5=s$1=class extends a$f{constructor(e){super(e),this.activeRange=null,this.currentRangeExtent=null,this.fullRangeExtent=null;}clone(){return new s$1(l$f({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}};e$6([d$b({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],a$5.prototype,"activeRange",void 0),e$6([d$b({type:[Number],json:{write:!0}})],a$5.prototype,"currentRangeExtent",void 0),e$6([d$b({type:[Number],json:{write:!0}})],a$5.prototype,"fullRangeExtent",void 0),a$5=s$1=e$6([i$j("esri.webdoc.RangeInfo")],a$5);const c$9=a$5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var s;let n$4=s=class extends a$f{constructor(e){super(e),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null;}clone(){return new s(l$f({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};e$6([d$b({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],n$4.prototype,"enabled",void 0),e$6([d$b({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],n$4.prototype,"longNames",void 0),e$6([d$b({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],n$4.prototype,"minimized",void 0),e$6([d$b({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],n$4.prototype,"pinnedLevels",void 0),e$6([d$b({type:String,json:{read:{source:"site"},write:{target:"site"}}})],n$4.prototype,"site",void 0),e$6([d$b({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],n$4.prototype,"facility",void 0),e$6([d$b({type:String,json:{read:{source:"level"},write:{target:"level"}}})],n$4.prototype,"level",void 0),n$4=s=e$6([i$j("esri.webdoc.widgets.FloorFilter")],n$4);const l$2=n$4;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var i$4;const n$3=new o$7({slider:"slider",picker:"picker"});let p$5=i$4=class extends a$f{constructor(e){super(e),this.interactionMode=null,this.numStops=null,this.stopInterval=null;}clone(){return new i$4({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};e$6([d$b({type:n$3.apiValues,nonNullable:!0,json:{type:n$3.jsonValues,default:null,read:{reader:n$3.read},write:{isRequired:!0,writer:n$3.write}}})],p$5.prototype,"interactionMode",void 0),e$6([d$b({type:Number,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const e=null!=this.stopInterval;return {enabled:!e,isRequired:!e}}}}})],p$5.prototype,"numStops",void 0),e$6([d$b({type:Number,json:{write:{overridePolicy(){return {isRequired:null==this.numStops}}}}})],p$5.prototype,"stopInterval",void 0),p$5=i$4=e$6([i$j("esri.webdoc.widgets.Range")],p$5);const a$4=p$5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var m$2;let c$8=m$2=class extends a$f{constructor(t){super(t),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null;}readCurrentTimeExtent(t){if(!t)return;const r=null!=t[0]?new Date(t[0]):null,o=null!=t[1]?new Date(t[1]):null;return new y$b({start:r,end:o})}writeCurrentTimeExtent(t,e,r){t&&o$a(r,[r$6(t.start)?t.start.getTime():null,r$6(t.end)?t.end.getTime():null],e);}readFullTimeExtent(t,r){const o=r.properties;if(!o)return;const s=null!=o.endTime?new Date(o.endTime):null,n=null!=o.startTime?new Date(o.startTime):null;return new y$b({start:n,end:s})}writeFullTimeExtent(t,e){if(!t)return;const r=e.properties=e.properties||{},o=t.end,s=t.start;o&&(r.endTime=r$6(o)?o.getTime():null),s&&(r.startTime=r$6(s)?s.getTime():null);}readStopInterval(t,e,o){return t?l$i.fromJSON({value:t.interval,unit:t.units},o):null}writeStopInterval(t,e,r,o){if(!t)return;const s=t.toJSON(o);o$a(r,{interval:s.value,units:s.unit},e);}readStops(t){return t&&t.length?t.map((t=>new Date(t))):null}writeStops(t,e,r){t&&t.length&&o$a(r,t.map((t=>t.getTime())),e);}clone(){return new m$2(l$f({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};e$6([d$b({type:y$b,json:{read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],c$8.prototype,"currentTimeExtent",void 0),e$6([o$9("currentTimeExtent")],c$8.prototype,"readCurrentTimeExtent",null),e$6([r$a("currentTimeExtent")],c$8.prototype,"writeCurrentTimeExtent",null),e$6([d$b({type:y$b,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],c$8.prototype,"fullTimeExtent",void 0),e$6([o$9("fullTimeExtent")],c$8.prototype,"readFullTimeExtent",null),e$6([r$a("fullTimeExtent")],c$8.prototype,"writeFullTimeExtent",null),e$6([d$b({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],c$8.prototype,"loop",void 0),e$6([d$b({type:Number,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){var t;const e=!!this.stopInterval,r=!(null==(t=this.stops)||!t.length),o=!(e||r);return {enabled:o,isRequired:o}}}}})],c$8.prototype,"numStops",void 0),e$6([d$b({type:[1,2],nonNullable:!0,json:{read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],c$8.prototype,"numThumbs",void 0),e$6([d$b({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],c$8.prototype,"stopDelay",void 0),e$6([d$b({type:l$i,json:{read:{source:"properties.timeStopInterval"},write:{target:"properties.timeStopInterval",overridePolicy(){var t;const e=null!=this.numStops,r=!(null==(t=this.stops)||!t.length);return {enabled:!r,isRequired:!(e||r)}}}}})],c$8.prototype,"stopInterval",void 0),e$6([o$9("stopInterval")],c$8.prototype,"readStopInterval",null),e$6([r$a("stopInterval")],c$8.prototype,"writeStopInterval",null),e$6([d$b({type:[Date],json:{read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return {isRequired:null==this.numStops&&!this.stopInterval}}}}})],c$8.prototype,"stops",void 0),e$6([o$9("stops")],c$8.prototype,"readStops",null),e$6([r$a("stops")],c$8.prototype,"writeStops",null),c$8=m$2=e$6([i$j("esri.webdoc.widgets.TimeSlider")],c$8);const d=c$8;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var m$1;let c$7=m$1=class extends a$f{constructor(r){super(r),this.range=null,this.timeSlider=null,this.floorFilter=null;}clone(){return new m$1(l$f({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};e$6([d$b({type:a$4,json:{write:!0}})],c$7.prototype,"range",void 0),e$6([d$b({type:d,json:{write:!0}})],c$7.prototype,"timeSlider",void 0),e$6([d$b({type:l$2,json:{write:!0}})],c$7.prototype,"floorFilter",void 0),c$7=m$1=e$6([i$j("esri.webdoc.Widgets")],c$7);const n$2=c$7;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const h$1={width:600,height:400},t=1.5;function i$3(i,e){e=e||h$1;let{width:d,height:n}=e;const g=d/n;return g<t?n=d/t:g>t&&(d=n*t),d>i.width&&(n*=i.width/d,d=i.width),n>i.height&&(d*=i.height/n,n=i.height),{width:Math.round(d),height:Math.round(n)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function n$1(n){return {enabled:!(null==n||!n.length)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var c$6;let a$3=c$6=class extends a$f{constructor(r){super(r),this.exactMatch=!1,this.name=null,this.type=null;}clone(){return new c$6({exactMatch:this.exactMatch,type:this.type,name:this.name})}};e$6([d$b({type:Boolean,json:{write:!0}})],a$3.prototype,"exactMatch",void 0),e$6([d$b({type:String,json:{write:!0}})],a$3.prototype,"name",void 0),e$6([r$b(i$p)],a$3.prototype,"type",void 0),a$3=c$6=e$6([i$j("esri.webdoc.applicationProperties.SearchLayerField")],a$3);const i$2=a$3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var c$5;let a$2=c$5=class extends a$f{constructor(r){super(r),this.field=null,this.id=null,this.subLayer=null;}clone(){return new c$5(l$f({field:this.field,id:this.id,subLayer:this.subLayer}))}};e$6([d$b({type:i$2,json:{write:{isRequired:!0}}})],a$2.prototype,"field",void 0),e$6([d$b({type:String,json:{write:{isRequired:!0}}})],a$2.prototype,"id",void 0),e$6([d$b({type:S$8,json:{write:!0}})],a$2.prototype,"subLayer",void 0),a$2=c$5=e$6([i$j("esri.webdoc.applicationProperties.SearchLayer")],a$2);const u$1=a$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var c$4;let a$1=c$4=class extends a$f{constructor(r){super(r),this.exactMatch=!1,this.name=null,this.type=null;}clone(){return new c$4({exactMatch:this.exactMatch,type:this.type,name:this.name})}};e$6([d$b({type:Boolean,json:{write:!0}})],a$1.prototype,"exactMatch",void 0),e$6([d$b({type:String,json:{write:!0}})],a$1.prototype,"name",void 0),e$6([r$b(i$p)],a$1.prototype,"type",void 0),a$1=c$4=e$6([i$j("esri.webdoc.applicationProperties.SearchTableField")],a$1);const i$1=a$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var p$4;let c$3=p$4=class extends a$f{constructor(r){super(r),this.field=null,this.id=null;}clone(){return new p$4(l$f({field:this.field,id:this.id}))}};e$6([d$b({type:i$1,json:{write:{isRequired:!0}}})],c$3.prototype,"field",void 0),e$6([d$b({type:String,json:{write:{isRequired:!0}}})],c$3.prototype,"id",void 0),c$3=p$4=e$6([i$j("esri.webdoc.applicationProperties.SearchTable")],c$3);const l$1=c$3;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var p$3;const b$1=S$7.ofType(u$1),h=S$7.ofType(l$1);let u=p$3=class extends a$f{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new b$1,this.tables=new h;}readAddressSearchEnabled(e){return !e}writeAddressSearchEnabled(e,r,o){r[o]=!e;}clone(){return new p$3(l$f({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};e$6([d$b({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],u.prototype,"addressSearchEnabled",void 0),e$6([o$9("addressSearchEnabled")],u.prototype,"readAddressSearchEnabled",null),e$6([r$a("addressSearchEnabled")],u.prototype,"writeAddressSearchEnabled",null),e$6([d$b({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],u.prototype,"enabled",void 0),e$6([d$b({type:String,json:{write:!0}})],u.prototype,"hintText",void 0),e$6([d$b({type:b$1,json:{write:{overridePolicy:n$1},origins:{"web-scene":{write:{isRequired:!0}}}}})],u.prototype,"layers",void 0),e$6([d$b({type:h,json:{read:!0,write:{overridePolicy:n$1}}})],u.prototype,"tables",void 0),u=p$3=e$6([i$j("esri.webdoc.applicationProperties.Search")],u);const y=u;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var p$2;let a=p$2=class extends a$f{constructor(r){super(r),this.search=null;}clone(){return new p$2(l$f({search:this.search}))}};e$6([d$b({type:y,json:{write:!0}})],a.prototype,"search",void 0),a=p$2=e$6([i$j("esri.webdoc.applicationProperties.Viewing")],a);const i=a;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var p$1;let n=p$1=class extends a$f{constructor(o){super(o),this.editing=null,this.offline=null,this.viewing=null;}clone(){return new p$1(l$f({editing:this.editing,offline:this.offline,viewing:this.viewing}))}};e$6([d$b({json:{write:!0}})],n.prototype,"editing",void 0),e$6([d$b({json:{write:!0}})],n.prototype,"offline",void 0),e$6([d$b({type:i,json:{write:!0}})],n.prototype,"viewing",void 0),n=p$1=e$6([i$j("esri.webmap.ApplicationProperties")],n);const c$2=n;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var e$1;let p=e$1=class extends a$f{constructor(){super(...arguments),this.url="";}destroy(){this.url="";}clone(){return new e$1({url:this.url})}};e$6([d$b({type:String,json:{write:{isRequired:!0}}})],p.prototype,"url",void 0),p=e$1=e$6([i$j("esri.webdoc.support.Thumbnail")],p);const c$1=p;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var j;const b="esri.webmap.Bookmark",v=s$e.getLogger(b);let g=j=class extends(r$7(a$f)){constructor(e){super(e),this.name=null,this.thumbnail=new c$1;}set extent(e){r$9(v,"extent",{replacement:"viewpoint",version:"4.17"}),this._set("viewpoint",new u$h({targetGeometry:e.clone()})),this._set("extent",e);}castThumbnail(e){return "string"==typeof e?new c$1({url:e}):b$b(c$1,e)}set viewpoint(e){const{targetGeometry:t,scale:o}=e;r$6(t)&&("extent"===t.type?this._set("extent",t.clone()):"point"===t.type&&t$7(o)&&v.warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",e)),this._set("viewpoint",e);}readViewpoint(e,o){const{extent:r,viewpoint:i}=o;return u$h.fromJSON(i||{targetGeometry:r})}writeViewpoint(e,t,o,i){if(!e)return;const{targetGeometry:n}=e;if(r$6(n)&&"extent"!==n.type){const e="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";null!=i&&i.messages?i.messages.push(new s$h("property:unsupported",e)):v.error(e);}else t[o]=e.toJSON();}clone(){return new j(l$f({name:this.name,thumbnail:this.thumbnail,viewpoint:this.viewpoint}))}};e$6([d$b({type:M$2,nonNullable:!0,json:{read:!1,write:{isRequired:!0}}})],g.prototype,"extent",null),e$6([d$b({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],g.prototype,"name",void 0),e$6([d$b({type:c$1,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.url)})}}})],g.prototype,"thumbnail",void 0),e$6([c$n("thumbnail")],g.prototype,"castThumbnail",null),e$6([d$b({type:u$h,nonNullable:!0,json:{write:!0}})],g.prototype,"viewpoint",null),e$6([o$9("viewpoint",["extent","viewpoint"])],g.prototype,"readViewpoint",null),e$6([r$a("viewpoint")],g.prototype,"writeViewpoint",null),g=j=e$6([i$j(b)],g);const x=g;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var c;let l=c=class extends p$l{constructor(o){super(o),this.background=null,this.rangeInfo=null,this.spatialReference=null,this.viewpoint=null;}clone(){return new c(l$f({background:this.background,rangeInfo:this.rangeInfo,spatialReference:this.spatialReference,viewpoint:this.viewpoint}))}};e$6([d$b({type:m$d})],l.prototype,"background",void 0),e$6([d$b({type:c$9})],l.prototype,"rangeInfo",void 0),e$6([d$b({type:k$3})],l.prototype,"spatialReference",void 0),e$6([d$b({type:u$h})],l.prototype,"viewpoint",void 0),l=c=e$6([i$j("esri.webmap.InitialViewProperties")],l);const m=l;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class e extends r$c{constructor(s,e){super(s,e,"webmap");}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const X=new e(2,23),Y="Web Map",Z=S$7.ofType(x),ee=S$7.ofType(l$4),te=s$e.getLogger("esri.WebMap"),re=new Map;re.set("image/jpeg","jpeg"),re.set("image/jpg","jpg"),re.set("image/png","png"),re.set("image/gif","gif");const ie="ArcGIS Pro",oe="ArcGIS API for JavaScript",ae="CollectorDisabled",se="Collector",ne="Data Editing",le="OfflineDisabled",pe="Offline",me="Workforce Project",ue="Workforce Worker",he="Workforce Dispatcher",de="Offline Map Areas",ce="FieldMapsDisabled",ye="DeveloperBasemap",we=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map((e=>e.toLowerCase()));let fe=class extends(l$h(m$c.LoadableMixin(n$n(j$7)))){constructor(e){super(e),this.applicationProperties=null,this.bookmarks=new Z,this.floorInfo=null,this.initialViewProperties=new m,this.portalItem=null,this.presentation=null,this.sourceVersion=null,this.widgets=null,this.utilityNetworks=null,this.authoringApp=this.authoringAppVersion=null,this._isAuthoringAppSetByUser=this._isAuthoringAppVersionSetByUser=!1;}destroy(){const e=this.portalItem;this.portalItem=null,null==e||e.destroy();}initialize(){if(this.when().catch((e=>{te.error("#load()","Failed to load web map",e);})),this.resourceInfo){let t;try{t=this._validateJSON(this.resourceInfo);}catch(e){return void this.addResolvingPromise(Promise.reject(e))}this.read(t);}}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e);}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp=oe;}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e);}writeAuthoringAppVersion(e,r){e&&this._isAuthoringAppVersionSetByUser?r.authoringAppVersion=e:r.authoringAppVersion=a$j;}readInitialViewProperties(e$1,t){var r;const o=new m;t.background&&(o.background=m$d.fromJSON(t.background));const a=null==(r=t.initialState)?void 0:r.viewpoint;if(a){if(a.rotation){e.parse(t.version||"","webmap").lessThan(2,20)&&t.authoringApp===ie&&(a.rotation*=-1);}o.viewpoint=u$h.fromJSON(a);}return t.mapRangeInfo&&(o.rangeInfo=c$9.fromJSON(t.mapRangeInfo)),t.spatialReference&&(o.spatialReference=k$3.fromJSON(t.spatialReference)),o}writeInitialViewProperties(e,t,r,i){if(!e)return;const o=e.background;o&&o.color&&(t.background=o.write({},i)),e.viewpoint&&(t.initialState={viewpoint:e.viewpoint.write({},i)}),e.rangeInfo&&(t.mapRangeInfo=e.rangeInfo.toJSON(i)),e.spatialReference&&(t.spatialReference=e.spatialReference.write({},i));}writeLayers(e,t,r,i){t[r]=this._writeLayers(e,i,"operational-layers");}readSourceVersion(e$1,t){const[r,i]=t.version.split(".");return new e(parseInt(r,10),parseInt(i,10))}writeSourceVersion(e,t,r){t[r]=`${X.major}.${X.minor}`;}writeTables(e,t,r,i){const o=this._writeLayers(e,i,"tables");o.length&&(t[r]=o);}get thumbnailUrl(){return this.portalItem&&this.portalItem.thumbnailUrl||null}set thumbnailUrl(e){e?(this._override("thumbnailUrl",e),this._thumbnailFilename=this._generateCustomThumbnailFilename(e)):this._clearThumbnailOverride();}load(e){return this.addResolvingPromise(this._loadFromSource()),Promise.resolve(this)}loadAll(){return n$o(this,(e=>{e(this.ground,this.basemap,this.layers,this.tables);}))}read(e,t){t={...t,origin:"web-map"};const r=this._getAuthoringPropsState();d$f(this,e,(t=>super.read(e,t)),t),this._restoreAuthoringPropsFromState(r);}write(e,t){if("loaded"!==this.loadStatus){const e=new s$h("webmap:not-loaded","Web map must be loaded before it can be serialized");throw te.error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),e}return this._removeDanglingLayerRefs(),t={...t,origin:"web-map",restrictedWebMapWriting:!0,webmap:this},super.write(e,t)}async save(e){e=e||{},this._validateItem(),await this._updateFromPromise,await this.load(),await this._loadLayerContainers(),await this._beforeSave(),this._validateMap();const t=this.portalItem,r={origin:"web-map",messages:[],writtenProperties:[],url:t.itemUrl&&U$3(t.itemUrl),portal:t.portal||B.getDefault()},i=this.write({},r);return this._validateJSONForWriting(r,e),await this._updateItemProperties(t),await this._updateItem(t,i,r),await this._updateItemThumbnail(),t}async saveAs(e,t){t=t||{};const r=this._getPortalItem(e);await this._updateFromPromise,await this.load(),await this._loadLayerContainers(),await this._beforeSave(),this._validateMap();const i={origin:"web-map",messages:[],writtenProperties:[],url:null,portal:r.portal},o=this.write({},i);this._validateJSONForWriting(i,t),await this._updateItemPropertiesForSaveAs(r);const a=this._getThumbnailState();return await this._createItem(r,o,i,t),this._restoreThumbnailFromState(a),await this._updateItemThumbnail(),r}async updateFrom(e,t){const r=this._updateFromInternal(e,t);this._updateFromPromise=r,await r;r===this._updateFromPromise&&(this._updateFromPromise=null);}getLayerJSONFromResourceInfo(e){var t,r,i,a;const s=this.resourceInfo;return this._collectAllLayersJSON(M$4([null==s||null==(t=s.baseMap)?void 0:t.baseMapLayers,null==s?void 0:s.operationalLayers,null==(r=this.basemap)||null==(i=r.resourceInfo)||null==(a=i.data)?void 0:a.baseMapLayers])).find((t=>t.id===e.id))}_collectAllLayersJSON(e){return e.reduce(((e,t)=>(e.push(t),"GroupLayer"===t.layerType&&(e=e.concat(this._collectAllLayersJSON(t.layers||[]))),e)),[])}_writeLayers(e,t,r){t={...t,layerContainerType:r};return e.map((e=>e$9(y$c(e,"tables"===r?null:this.getLayerJSONFromResourceInfo(e),t)))).filter(Boolean).toArray()}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-map"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):Promise.resolve(null)}_loadFromItem(e){return e.load().catch((e=>{throw new s$h("webmap:load-portal-item","Failed to load portal item",{error:e})})).then((()=>{if("Web Map"!==e.type)throw new s$h("webmap:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Map'",{type:e.type})})).then((()=>e.fetchData())).then((t=>(this.resourceInfo=t,this._readAndLoadFromJSON(t,{origin:"web-map",portal:e.portal||B.getDefault()})))).then((()=>this._computeInitialViewpoint()))}_readAndLoadFromJSON(e,t){const r=this._validateJSON(e);return this.read(r,t),this._loadFromJSON(r,t)}_validateJSON(e$1){const t=e.parse(e$1.version||"","webmap");return X.validate(t),e$1.version=`${t.major}.${t.minor}`,e$1}_loadFromJSON(e,t){const r={context:{...t,layerContainerType:"operational-layers"}};return this.portalItem&&(r.context.portal=this.portalItem.portal||B.getDefault()),import('./layersCreator-a5deb5c8.js').then((({populateOperationalLayers:t})=>{const i=[],o=e.operationalLayers;o&&o.length&&i.push(t(this.layers,o,r));const a={...r,context:{...r.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"},s=e.tables;return s&&s.length&&i.push(t(this.tables,s,a)),T$1(i).then((()=>{}))}))}async _computeInitialViewpoint(){var e,t;let r=this.initialViewProperties;if(null==(e=r)||null==(t=e.viewpoint)?void 0:t.targetGeometry)return;const o=await this._getExtentFromItem();o&&(r=r?r.clone():new m,r.viewpoint=new u$h,r.viewpoint.targetGeometry=o,this.initialViewProperties=r);}async _getExtentFromItem(){var e,t;const r=null==(e=this.initialViewProperties)?void 0:e.spatialReference,i=null==(t=this.portalItem)?void 0:t.extent;if(r&&i){if(r.isWGS84)return i.clone();if(r.isWebMercator)return R$3(i);return (await import('./geometryServiceUtils-22147327.js')).getGeometryServiceURL(this.portalItem).then((e=>{const t=new a$g;return t.geometries=[i],t.outSpatialReference=r,n$k(e,t)})).then((e=>e[0])).catch((e=>(te.error("Error projecting item's extent:",e),null)))}return null}_removeDanglingLayerRefs(){const e=this.applicationProperties,t=e&&e.viewing&&e.viewing.search,r=e=>!!this.allLayers.find((t=>t.id===e));t&&t.layers&&(t.layers=t.layers.filter((e=>r(e.id)))),t&&t.tables&&(t.tables=t.tables.filter((e=>!!this.tables.find((t=>t.id===e.id)))));const i=e&&e.editing&&e.editing.locationTracking;i&&i.info&&!r(i.info.layerId)&&(e.editing=null);const o=this.presentation&&this.presentation.slides;o&&o.forEach((e=>{e.visibleLayers&&(e.visibleLayers=e.visibleLayers.filter((e=>r(e.id))));}));}_validateMap(){if(!this.basemap||!this.basemap.baseLayers.length)throw new s$h("webmap:save","Map does not have a valid basemap with a base layer.")}_validateItem(){if(!this.portalItem)throw te.error("save: requires the portalItem property to be set"),new s$h("webmap:portal-item-not-set","Portal item to save to has not been set on the WebMap");this._validateItemType(this.portalItem);}_validateItemType(e){if(e.type!==Y)throw new s$h("webmap:portal-item-wrong-type",`Portal item needs to have type "${Y}"`)}_loadLayerContainers(){const e=[];return this.basemap&&e.push(this.basemap.load()),this.ground&&e.push(this.ground.load()),T$1(e).then((()=>{}))}async _beforeSave(){const e=[];for(const t of this.allLayers)if("beforeSave"in t&&"function"==typeof t.beforeSave){const r=t.beforeSave();r&&e.push(r);}await T$1(e);}_loadAllLayers(){const e=this._getAllLayersAndTables().map((e=>e.load()));return T$1(e).then((()=>{}))}_getAllLayersAndTables(){return this.allLayers.concat(this.allTables)}_validateJSONForWriting(e,t){let r=e.messages.filter((e=>"error"===e.type)).map((e=>new s$h(e.name,e.message,e.details)));if(t.ignoreUnsupported&&(r=r.filter((e=>"layer:unsupported"!==e.name&&"symbol:unsupported"!==e.name&&"symbol-layer:unsupported"!==e.name&&"property:unsupported"!==e.name&&"url:unsupported"!==e.name))),r.length>0)throw new s$h("webmap:save","Failed to save webmap due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}async _updateItemProperties(e){e.extent=await this._getWGS84Extent(this.initialViewProperties.viewpoint.targetGeometry),await this._updateTypeKeywords(e);}async _updateItemPropertiesForSaveAs(e){n$p(e,ae),n$p(e,le),n$p(e,me),n$p(e,ue),n$p(e,he),n$p(e,de),n$p(e,ce),await this._updateItemProperties(e);}async _getWGS84Extent(e){const t=e.clone().normalize();let r;if(t.length>1)for(const i of t)r?i.width>r.width&&(r=i):r=i;else r=t[0];return this._projectToWGS84(r)}async _projectToWGS84(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return j$6(e);const r=await import('./geometryServiceUtils-22147327.js'),i=await r.getGeometryServiceURL(this.portalItem),o=new a$g;o.geometries=[e],o.outSpatialReference=k$3.WGS84;return (await n$k(i,o))[0]}async _updateTypeKeywords(e){e$e(e,oe),await this._loadAllLayers(),this._evalCollectorKeyword(e),this._evalDataEditingKeyword(e),this._evalOfflineKeyword(e),this._evalDeveloperBasemapKeyword(e),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)));}_evalCollectorKeyword(e){t$b(e,ae)||t$b(e,me)||t$b(e,ue)||t$b(e,he)||!this._hasEditableFeatureLayer()?n$p(e,se):e$e(e,se);}_evalDataEditingKeyword(e){this._hasEditableFeatureLayer()?e$e(e,ne):n$p(e,ne);}_evalOfflineKeyword(e){!t$b(e,le)&&this._isOfflineCapableMap()?e$e(e,pe):n$p(e,pe);}_evalDeveloperBasemapKeyword(e){d$g(this.basemap)?e$e(e,ye):n$p(e,ye);}_hasEditableFeatureLayer(){return this._getAllLayersAndTables().some((e=>e.loaded&&this._isFeatureServiceLayer(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled))}_isFeatureServiceLayer(e){return !("feature"!==e.type||!e.source||"feature-layer"!==e.source.type)}_isOfflineCapableMap(){return this._getAllLayersAndTables().filter((e=>"group"!==e.type)).every((e=>e.loaded&&this._isOfflineCapableLayer(e)))}_isOfflineCapableLayer(e){return this._isFeatureServiceLayer(e)&&e.capabilities.operations.supportsSync||("tile"===e.type||"vector-tile"===e.type)&&(e.capabilities.operations.supportsExportTiles||this._isExportableAGOLTileLayer(e)||S$9(e))&&e.spatialReference.equals(this.initialViewProperties.spatialReference)}_isExportableAGOLTileLayer(e){return "tile"===e.type&&(L$a(e.url)&&we.some((t=>e.url.toLowerCase().indexOf("/"+t+"/")>-1)))}async _updateItem(e,t,r){await e.update({data:t}),this._syncUpInstanceWithItem(e,t,r);}async _createItem(e,t,r,i){const o=this.portalItem,a=!!(o&&o.id&&o.portal.user),n=e.portal;if(await n._signIn(),!await this._canCopyItem(o,a,n))throw new s$h("webmap:save-as-copy-not-allowed","Owner of this map does not allow others to save a copy");await n.user.addItem({item:e,folder:i.folder,data:t}),this.portalItem=e,this._syncUpInstanceWithItem(e,t,r);}async _canCopyItem(e,t,r){return !(r$6(e)&&e.id&&e.typeKeywords&&e.typeKeywords.indexOf("useOnly")>-1)||e.portal.portalHostname===r.portalHostname&&(t||await e.reload(),"admin"===e.itemControl||"update"===e.itemControl)}_syncUpInstanceWithItem(e,t,r){O$3.prototype.read.call(this,{version:t.version,authoringApp:t.authoringApp,authoringAppVersion:t.authoringAppVersion},{origin:"web-map",ignoreDefaults:!0,url:e.itemUrl&&U$3(e.itemUrl)}),r$d(r),this.resourceInfo=t;}async _updateItemThumbnail(){this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename}),this._clearThumbnailOverride());}_getPortalItem(e){let t=b$c.from(e);return t.id&&(t=t.clone(),t.id=null),t.type||(t.type=Y),t.portal||(t.portal=B.getDefault()),this._validateItemType(t),t}async _updateFromInternal(e,t){if(t=t||{},await d$c(e,"ready"),this._updateInitialViewProperties(e,t),e.map===this)for(const r of e.allLayerViews)for(const e of ["visible","featureEffect"])e in r&&e in r.layer&&r._isOverridden(e)&&(r.layer[e]=r[e]);await this._updateThumbnailUrl(e,t);}_updateInitialViewProperties(e,t){var r;t.backgroundExcluded||(this.initialViewProperties.background=null==(r=e.background)?void 0:r.clone());if(this.initialViewProperties.spatialReference=e.spatialReference.clone(),t.viewpointExcluded||(this.initialViewProperties.viewpoint=new u$h({rotation:e.rotation,scale:t.scalePreserved?e.scale:null,targetGeometry:this._getViewExtent(e)})),!t.widgetsExcluded)for(const i of e.persistableViewModels)i.updateWebDocument(this);}_getViewExtent(e){const t=e.center.clone().normalize(),r=e.extent.clone(),i=r.width/2;return r.xmin=t.x-i,r.xmax=t.x+i,r}async _updateThumbnailUrl(e,t){if(t.thumbnailExcluded)return;const r=i$3(e,t.thumbnailSize),i=await e.takeScreenshot({format:"png",width:r.width,height:r.height});this._setAutoGeneratedThumbnail(i.dataUrl);}_setAutoGeneratedThumbnail(e){this.thumbnailUrl=e,this._thumbnailFilename=null;}_clearThumbnailOverride(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null;}_generateCustomThumbnailFilename(e){if(G(e)){const t=V$1(e),r=t&&t.mediaType,i=r&&re.get(r.toLowerCase())||null,o=`thumbnail${Date.now()}`;return i?`${o}.${i}`:o}return null}_getThumbnailState(){let e=this.thumbnailUrl;return e&&(e=this._isOverridden("thumbnailUrl")?e:bt(e,"w","8192")),{thumbnailUrl:e,filename:this._thumbnailFilename}}_restoreThumbnailFromState(e){this.thumbnailUrl=e.thumbnailUrl,this._thumbnailFilename=e.filename;}_getAuthoringPropsState(){return {authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}_restoreAuthoringPropsFromState(e){e.isAuthoringAppSetByUser?this.authoringApp=e.authoringApp:this._isAuthoringAppSetByUser=!1,e.isAuthoringAppVersionSetByUser?this.authoringAppVersion=e.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1;}static fromJSON(e){const t=e;if(!t)throw new s$h("webmap:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:t})}};fe.VERSION=X,e$6([d$b({type:c$2,json:{write:!0}})],fe.prototype,"applicationProperties",void 0),e$6([d$b({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],fe.prototype,"authoringApp",null),e$6([r$a("authoringApp")],fe.prototype,"writeAuthoringApp",null),e$6([d$b({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],fe.prototype,"authoringAppVersion",null),e$6([r$a("authoringAppVersion")],fe.prototype,"writeAuthoringAppVersion",null),e$6([d$b({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],fe.prototype,"basemap",void 0),e$6([d$b({type:Z,json:{write:{overridePolicy:e=>({enabled:!!(e&&e.length>0),ignoreOrigin:!0})}}})],fe.prototype,"bookmarks",void 0),e$6([d$b({type:l$3,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],fe.prototype,"floorInfo",void 0),e$6([d$b({type:m,nonNullable:!0,json:{read:{source:["background","initialState.viewpoint","mapRangeInfo","spatialReference"]},write:{ignoreOrigin:!0,target:{background:{type:m$d},"initialState.viewpoint":{type:u$h},mapRangeInfo:{type:c$9},spatialReference:{type:k$3}}}}})],fe.prototype,"initialViewProperties",void 0),e$6([o$9("initialViewProperties")],fe.prototype,"readInitialViewProperties",null),e$6([r$a("initialViewProperties")],fe.prototype,"writeInitialViewProperties",null),e$6([d$b({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],fe.prototype,"layers",void 0),e$6([r$a("layers")],fe.prototype,"writeLayers",null),e$6([d$b({type:b$c})],fe.prototype,"portalItem",void 0),e$6([d$b({json:{write:!0}})],fe.prototype,"presentation",void 0),e$6([d$b()],fe.prototype,"resourceInfo",void 0),e$6([d$b({readOnly:!0,type:e,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],fe.prototype,"sourceVersion",void 0),e$6([o$9("sourceVersion")],fe.prototype,"readSourceVersion",null),e$6([r$a("sourceVersion")],fe.prototype,"writeSourceVersion",null),e$6([d$b({json:{read:!1,write:{ignoreOrigin:!0}}})],fe.prototype,"tables",void 0),e$6([r$a("tables")],fe.prototype,"writeTables",null),e$6([d$b()],fe.prototype,"thumbnailUrl",null),e$6([d$b({type:n$2,json:{write:!0}})],fe.prototype,"widgets",void 0),e$6([d$b({type:ee,json:{read:!0,write:!0}})],fe.prototype,"utilityNetworks",void 0),fe=e$6([i$j("esri.WebMap")],fe);const ge=fe;

const arcgisWebmapCss = "@import url('https://js.arcgis.com/next/esri/themes/light/main.css');.map-view{padding:0;margin:0}";

let ArcGISWebMap = class {
  constructor(hostRef) {
    registerInstance(this, hostRef);
  }
  validateApiKey(value) {
    t$9.apiKey = value;
  }
  validateItemId(value, old) {
    if (value && value !== old) {
      this.loadMap();
    }
  }
  componentWillLoad() {
    if (this.apiKey) {
      t$9.apiKey = this.apiKey;
    }
    if (this.itemId) {
      this.loadMap();
    }
  }
  componentDidRender() {
    const elem = this.el.querySelector('.esri-view-user-storage');
    if (elem) {
      const elems = Array.from(elem.children);
      for (let e of elems) {
        if (e.tagName.toLowerCase().includes('arcgis-')) {
          e.view = this.view;
        }
      }
    }
  }
  loadMap() {
    const map = new ge({
      portalItem: {
        id: this.itemId
      }
    });
    const params = {};
    if (this.zoom) {
      params.zoom = this.zoom;
    }
    if (this.center) {
      if (typeof this.center === 'string') {
        params.center = this.center.split(',').map((x) => Number(x));
      }
      else {
        params.center = this.center;
      }
    }
    const view = new G$1(Object.assign({ container: this.el, map }, params));
    this.view = view;
    view.when(() => console.log('view ready'));
  }
  render() {
    return (h$a("div", { class: "map-view" }));
  }
  get el() { return getElement(this); }
  static get watchers() { return {
    "apiKey": ["validateApiKey"],
    "itemId": ["validateItemId"]
  }; }
};
ArcGISWebMap.style = arcgisWebmapCss;

export { ArcGISSearch$1 as arcgis_expand, ArcGISLegend as arcgis_legend, ArcGISSearch as arcgis_search, ArcGISWebMap as arcgis_webmap };
