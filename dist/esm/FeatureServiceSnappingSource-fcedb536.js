import { p as p$2, af as t$1, A as r, e as e$1, d as d$1, i, a as i$1, u as u$1, cp as n$2, al as P, aE as b$1, dB as t$2 } from './messageBundle-f75b4090.js';
import { a as a$2, d as d$2 } from './HandleOwner-88326c19.js';
import { i as i$3, m as m$1, a as a$3 } from './reactiveUtils-8f9c3a3d.js';
import { o } from './mathUtils-e16f9389.js';
import { n as n$1 } from './vec4f64-2ec4ac08.js';
import { Z, r as rs, G } from './boundedPlane-030abe8d.js';
import { c as c$2 } from './layerViewUtils-4127a8cf.js';
import { o as o$2 } from './queryEngineUtils-e3beda43.js';
import { v, a as i$2 } from './geometry-7e07b1ba.js';
import { m, o as o$1 } from './aaBoundingRect-9468599b.js';
import { b } from './TileTreeDebugger-f912b010.js';
import { n as n$3 } from './WorkerHandle-a0a39e87.js';
import { j, p as p$3 } from './TileInfo-052b02b9.js';
import { p as p$4 } from './debugFlags-e9d86cce.js';
import './index-b157fcf2.js';
import './common-d5b993de.js';
import './vectorStacks-9205ea46.js';
import './quatf64-b9feea68.js';
import './mat4f64-677a419d.js';
import './vec2f64-35868783.js';
import './mat4-f34c6460.js';
import './lineSegment-4881dbd9.js';
import './plane-f3c19202.js';
import './sphere-c3d60863.js';
import './arcgis-editor-c0835cea.js';
import './opacityUtils-5e864561.js';
import './Color-d1b9b54f.js';
import './colorUtils-37750ea3.js';
import './screenUtils-49015526.js';
import './unitUtils-38774114.js';
import './Graphic-3961df6c.js';
import './PopupTemplate-6e5ecad2.js';
import './enumeration-d3301938.js';
import './Identifiable-da047c47.js';
import './symbols-b414aa72.js';
import './Symbol-cad56b52.js';
import './screenUtils-9bb7e30c.js';
import './aaBoundingBox-876621e6.js';
import './persistableUrlUtils-40bbec67.js';
import './Portal-c5cfa317.js';
import './jsonUtils-13b1f6fd.js';
import './executeQueryJSON-97747696.js';
import './utils-ab350511.js';
import './query-87b92407.js';
import './normalizeUtils-25a1ce55.js';
import './pbfQueryUtils-18f884ce.js';
import './pbf-6bd45926.js';
import './OptimizedFeature-44d5df5b.js';
import './OptimizedFeatureSet-27736f1f.js';
import './queryZScale-f42386f8.js';
import './zscale-faf9ffc2.js';
import './Query-d6335b3a.js';
import './TimeExtent-a024c0d8.js';
import './Field-bfaa8af9.js';
import './fieldType-66a19d8a.js';
import './FeatureSet-58481609.js';
import './TopFeaturesQuery-cc717439.js';
import './Heading-960a88b2.js';
import './widget-c014d189.js';
import './QueryTask-23c14fd1.js';
import './featureConversionUtils-cbd79ea2.js';
import './Task-21abc82a.js';
import './FeatureLayer-91daf6b1.js';
import './UniqueValueRenderer-3c55992d.js';
import './VisualVariablesMixin-0befdf7b.js';
import './colorRamps-22c88e98.js';
import './ColorStop-d4fc22fe.js';
import './sizeVariableUtils-4d3662df.js';
import './visualVariableUtils-26c41ea6.js';
import './lengthUtils-f033d4fe.js';
import './diffUtils-849b3672.js';
import './jsonUtils-ade233cd.js';
import './styleUtils-cb28c5ef.js';
import './DictionaryRenderer-bea76550.js';
import './LRUCache-d5842b88.js';
import './MemCache-78a9f000.js';
import './jsonUtils-aa645e92.js';
import './MultiOriginJSONSupport-cb4804f4.js';
import './HeightModelInfo-1a6d7a08.js';
import './Layer-b50ea610.js';
import './workers-c4ad1958.js';
import './APIKeyMixin-d7a9a0ad.js';
import './ArcGISService-49a9bda6.js';
import './arcgisLayerUrl-49ef2818.js';
import './BlendLayer-38b8abf7.js';
import './CustomParametersMixin-758e21ed.js';
import './labelingInfo-1bb19962.js';
import './OperationalLayer-d609e521.js';
import './ElevationInfo-be94499b.js';
import './LabelClass-47fb4a25.js';
import './labelUtils-8999bd11.js';
import './defaultsJSON-0b68054b.js';
import './OrderedLayer-7fa2fd9d.js';
import './PortalLayer-290979fa.js';
import './asyncUtils-fe35d349.js';
import './PortalItem-155284f3.js';
import './RefreshableLayer-f4d1c27c.js';
import './ScaleRangeLayer-584ce37b.js';
import './TemporalLayer-5a7f466a.js';
import './TimeInfo-44dec2e0.js';
import './FeatureType-aa59abbf.js';
import './fieldProperties-d7b323c6.js';
import './FieldsIndex-2a111e7e.js';
import './LayerFloorInfo-c2959bac.js';
import './styleUtils-61c488eb.js';
import './popupUtils-c3247ec1.js';
import './utils-c84cc443.js';
import './ItemCache-5d2cf877.js';
import './utils-f8425723.js';
import './Queue-a7e7a3e5.js';
import './GoTo-148cc420.js';
import './accessibleHandler-feb312a0.js';
import './vmEvent-6b909beb.js';
import './InputField-3a8ab041.js';
import './luxon-ec6026e9.js';
import './_commonjsHelpers-80e09147.js';
import './GraphicsLayer-86475574.js';
import './GraphicsCollection-58a35288.js';
import './drapedUtils-4802ed0b.js';
import './hitTestSelectUtils-779b69ca.js';
import './geodesicUtils-32a18b56.js';
import './geodesicConstants-54cb88d4.js';
import './vec2-5672471e.js';
import './geometry2dUtils-4e41c21e.js';
import './PointSnappingHint-bb0669ef.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function t(n,o$1){return Z(o$1.extent,e),rs(e,o(a$1,n.x,n.y,0))}const e=G(),a$1=n$1();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let c$1=class extends(a$2(p$2)){constructor(e){super(e),this.pointOfInterest=null;}get tiles(){const e=this.tilesCoveringView,t$1=r(this.pointOfInterest)?this.pointOfInterest:this.view.center;return e.sort(((e,r)=>t(t$1,e)-t(t$1,r))),e}scaleEnabled(){return c$2(this.view.scale,this.layer.minScale||0,this.layer.maxScale||0)}get tilesCoveringView(){if(!this.view.ready||!this.view.featuresTilingScheme||!this.view.state||t$1(this.tileInfo))return [];if(!this.scaleEnabled)return [];const{spans:e,lodInfo:t}=this.view.featuresTilingScheme.getTileCoverage(this.view.state,0),{level:r}=t,i=[];for(const{row:o,colFrom:s,colTo:l}of e)for(let e=s;e<=l;e++){const s={id:null,level:r,row:o,col:t.normalizeCol(e)};this.tileInfo.updateTileInfo(s),i.push(s);}return i}get tileInfo(){var e,t;return null!=(e=null==(t=this.view.featuresTilingScheme)?void 0:t.tileInfo)?e:null}get tileSize(){return r(this.tileInfo)?this.tileInfo.size[0]:256}initialize(){this.handles.add(this.watch("view.state.viewpoint",(()=>this.notifyChange("tilesCoveringView")),!0));}};e$1([d$1({readOnly:!0})],c$1.prototype,"tiles",null),e$1([d$1({readOnly:!0})],c$1.prototype,"scaleEnabled",null),e$1([d$1({readOnly:!0})],c$1.prototype,"tilesCoveringView",null),e$1([d$1({readOnly:!0})],c$1.prototype,"tileInfo",null),e$1([d$1({readOnly:!0})],c$1.prototype,"tileSize",null),e$1([d$1({constructOnly:!0})],c$1.prototype,"view",void 0),e$1([d$1({constructOnly:!0})],c$1.prototype,"layer",void 0),e$1([d$1()],c$1.prototype,"pointOfInterest",void 0),c$1=e$1([i("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles2D")],c$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let a=class extends d$2{constructor(e){super(e),this.pointOfInterest=null;}get tiles(){const e=this.tilesCoveringView,t$1=this.effectivePointOfInterest;if(r(t$1)){const r=e.map((e=>t(t$1,e)));for(let i=1;i<r.length;i++)if(r[i-1]>r[i])return e.sort(((e,r)=>t(t$1,e)-t(t$1,r))),e.slice()}return e}get tilesCoveringView(){var e,t;return this.filterTiles(null==(e=this.view.featureTiles)||null==(t=e.tiles)?void 0:t.toArray()).map(u)}get tileInfo(){var e,t;return null!=(e=null==(t=this.view.featureTiles)?void 0:t.tilingScheme.toTileInfo())?e:null}get tileSize(){var e,t;return null!=(e=null==(t=this.view.featureTiles)?void 0:t.tileSize)?e:256}get effectivePointOfInterest(){var e;const t=this.pointOfInterest;return r(t)?t:null==(e=this.view.pointsOfInterest)?void 0:e.focus.location}initialize(){this.handles.add(i$1(this.view,"featureTiles",(e=>{this.handles.remove(p$1),e&&this.handles.add(e.addClient(),p$1);})));}filterTiles(e){if(t$1(e))return [];return e.filter((e=>Math.abs(e.measures.screenRect[3]-e.measures.screenRect[1])>c&&2===e.measures.visibility))}};function u({lij:[e,t,r],extent:i}){return {id:`${e}/${t}/${r}`,level:e,row:t,col:r,extent:i}}e$1([d$1({readOnly:!0})],a.prototype,"tiles",null),e$1([d$1({readOnly:!0})],a.prototype,"tilesCoveringView",null),e$1([d$1({readOnly:!0})],a.prototype,"tileInfo",null),e$1([d$1({readOnly:!0})],a.prototype,"tileSize",null),e$1([d$1({constructOnly:!0})],a.prototype,"view",void 0),e$1([d$1()],a.prototype,"pointOfInterest",void 0),e$1([d$1()],a.prototype,"effectivePointOfInterest",null),a=e$1([i("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],a);const c=50,p$1="feature-tiles";

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let d=class extends b{constructor(e){super(e),this.handles=new u$1;}initialize(){const e=setInterval((()=>this.fetchDebugInfo()),2e3);this.handles.add(n$2((()=>clearInterval(e))));}destroy(){this.handles.destroy();}getTiles(){if(!this.debugInfo)return [];const e=new Map,t=new Map;this.debugInfo.storedTiles.forEach((t=>{e.set(t.data.id,t.featureCount);})),this.debugInfo.pendingTiles.forEach((r=>{e.set(r.data.id,r.featureCount),t.set(r.data.id,r.state);}));const r=r=>{var o;const s=t.get(r),a=null!=(o=e.get(r))?o:"?";return s?`${s}:${a}\n${r}`:`store:${a}\n${r}`},o=new Map;return this.debugInfo.storedTiles.forEach((e=>{o.set(e.data.id,e.data);})),this.debugInfo.pendingTiles.forEach((e=>{o.set(e.data.id,e.data);})),Array.from(o.values()).map((e=>({lij:[e.level,e.row,e.col],geometry:v.fromExtent(m(e.extent,this.view.spatialReference)),label:r(e.id)})))}fetchDebugInfo(){this.handle.getDebugInfo(null).then((e=>{this.debugInfo=e,this.update();}));}};e$1([d$1({constructOnly:!0})],d.prototype,"handle",void 0),d=e$1([i("esri.views.interactive.snapping.featureSources.WorkerTileTreeDebugger")],d);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let l=class extends d$2{constructor(e){super(e),this.availability=0,this.workerHandleUpdating=!0,this.editId=0;}get updating(){return this.updatingHandles.updating||this.workerHandleUpdating}destroy(){this.workerHandle.destroy();}initialize(){this.workerHandle=new p(this.schedule),this.handles.add([this.workerHandle.on("notify-updating",(({updating:e})=>this.workerHandleUpdating=e)),this.workerHandle.on("notify-availability",(({availability:e})=>this._set("availability",e)))]);}async setup(e,t){const r=this.serviceInfoFromLayer(e.layer);if(t$1(r))return;const o={configuration:this.convertConfiguration(e.configuration),serviceInfo:r,spatialReference:e.spatialReference.toJSON()};await this.updatingHandles.addPromise(this.workerHandle.invokeMethod("setup",o,t)),this.updatingHandles.addPromise(this.workerHandle.invokeMethod("whenNotUpdating",{},t));}async configure(e,t){const i=this.convertConfiguration(e);await this.updatingHandles.addPromise(this.workerHandle.invokeMethod("configure",i,t)),this.updatingHandles.addPromise(this.workerHandle.invokeMethod("whenNotUpdating",{},t));}async refresh(e){await this.updatingHandles.addPromise(this.workerHandle.invokeMethod("refresh",{},e)),this.updatingHandles.addPromise(this.workerHandle.invokeMethod("whenNotUpdating",{},e));}async fetchCandidates(e,t){const i={distance:e.distance,point:e.coordinateHelper.vectorToPoint(e.point).toJSON(),types:e.types,filter:r(e.filter)?e.filter.createQuery().toJSON():null};return this.workerHandle.invoke(i,t)}async updateTiles(e,t){const i={tiles:e.tiles,tileInfo:r(e.tileInfo)?e.tileInfo.toJSON():null,tileSize:e.tileSize};await this.updatingHandles.addPromise(this.workerHandle.invokeMethod("updateTiles",i,t)),this.updatingHandles.addPromise(this.workerHandle.invokeMethod("whenNotUpdating",{},t));}async applyEdits(e,t){var i,r,a,n,s,d;const l=this.editId++,p={id:l};await this.updatingHandles.addPromise(this.workerHandle.invokeMethod("beginApplyEdits",p,t)),this.updatingHandles.addPromise(this.workerHandle.invokeMethod("whenNotUpdating",{},t));const u=await this.updatingHandles.addPromise(P(e.result,t)),c={id:l,edits:{addedFeatures:null!=(i=null==(r=u.addedFeatures)?void 0:r.map((({objectId:e})=>e)))?i:[],deletedFeatures:null!=(a=null==(n=u.deletedFeatures)?void 0:n.map((({objectId:e,globalId:t})=>({objectId:e,globalId:t}))))?a:[],updatedFeatures:null!=(s=null==(d=u.updatedFeatures)?void 0:d.map((({objectId:e})=>e)))?s:[]}};await this.updatingHandles.addPromise(this.workerHandle.invokeMethod("endApplyEdits",c,t)),this.updatingHandles.addPromise(this.workerHandle.invokeMethod("whenNotUpdating",{},t));}getDebugInfo(e){return this.workerHandle.invokeMethod("getDebugInfo",{},e)}convertConfiguration(e){return {filter:r(e.filter)?e.filter.toJSON():null,customParameters:e.customParameters}}serviceInfoFromLayer(e){var t;return "multipatch"===e.geometryType||"mesh"===e.geometryType?null:{url:e.parsedUrl.path,fields:e.fields.map((e=>e.toJSON())),geometryType:i$2.toJSON(e.geometryType),capabilities:e.capabilities,objectIdField:e.objectIdField,globalIdField:e.globalIdField,spatialReference:e.spatialReference.toJSON(),timeInfo:null==(t=e.timeInfo)?void 0:t.toJSON()}}};e$1([d$1({constructOnly:!0})],l.prototype,"schedule",void 0),e$1([d$1({readOnly:!0})],l.prototype,"updating",null),e$1([d$1({readOnly:!0})],l.prototype,"availability",void 0),e$1([d$1()],l.prototype,"workerHandleUpdating",void 0),l=e$1([i("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorkerHandle")],l);class p extends n$3{constructor(e){super("FeatureServiceSnappingSourceWorker","fetchCandidates",e,{strategy:"dedicated"});}getTransferList(){return []}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let n=class extends p$2{constructor(e){super(e),this.pointOfInterest=null;}get tiles(){return [{id:"0/0/0",level:0,row:0,col:0,extent:o$1(-1e8,-1e8,1e8,1e8)}]}get tileInfo(){return new j({origin:new b$1({x:-1e8,y:1e8,spatialReference:this.layer.spatialReference}),size:[512,512],lods:[new p$3({level:0,scale:1,resolution:390625})],spatialReference:this.layer.spatialReference})}get tileSize(){return this.tileInfo.size[0]}};e$1([d$1({readOnly:!0})],n.prototype,"tiles",null),e$1([d$1({readOnly:!0})],n.prototype,"tileInfo",null),e$1([d$1({readOnly:!0})],n.prototype,"tileSize",null),e$1([d$1({constructOnly:!0})],n.prototype,"layer",void 0),e$1([d$1()],n.prototype,"pointOfInterest",void 0),n=e$1([i("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTilesSimple")],n);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let g=class extends(a$2(p$2)){constructor(e){super(e);}get updateTilesParameters(){return {tiles:this.tilesOfInterest.tiles,tileInfo:this.tilesOfInterest.tileInfo,tileSize:this.tilesOfInterest.tileSize}}get updating(){return this.workerHandle.updating||this.updatingHandles.updating}get configuration(){return {filter:this.layer.createQuery(),customParameters:this.layer.customParameters}}get availability(){return this.workerHandle.availability}get layer(){return this.layerSource.layer}initialize(){const e=this.view;if(r(e))switch(e.type){case"2d":this.tilesOfInterest=new c$1({view:e,layer:this.layer}),this.workerHandle=new l;break;case"3d":{const r=e.resourceController;this.tilesOfInterest=new a({view:e}),this.workerHandle=new l({schedule:e=>r.schedule(e)});break}}else this.tilesOfInterest=new n({layer:this.layer}),this.workerHandle=new l;this.handles.add([t$2(this.workerHandle)]),this.workerHandle.setup({layer:this.layer,spatialReference:this.spatialReference,configuration:this.configuration},null),this.updatingHandles.add(this,"updateTilesParameters",(()=>this.workerHandle.updateTiles(this.updateTilesParameters,null)),2),this.handles.add([i$3((()=>this.configuration),(e=>this.workerHandle.configure(e,null)),m$1)]),r(e)&&this.handles.add(i$3((()=>p$4.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES),(r=>{r&&!this.debug?(this.debug=new d({view:e,handle:this.workerHandle}),this.handles.add(t$2(this.debug),"debug")):!r&&this.debug&&this.handles.remove("debug");}),a$3)),this.handles.add(this.layerSource.layer.on("apply-edits",(e=>{this.workerHandle.applyEdits(e,null);})));}refresh(){this.workerHandle.refresh(null);}async fetchCandidates(e,r){return this.tilesOfInterest.pointOfInterest=e.coordinateHelper.vectorToPoint(e.point),(await this.workerHandle.fetchCandidates({...e,filter:null},r)).candidates.map((r=>o$2(r,e.coordinateHelper)))}getDebugInfo(e){return this.workerHandle.getDebugInfo(e)}};e$1([d$1({constructOnly:!0})],g.prototype,"spatialReference",void 0),e$1([d$1({constructOnly:!0})],g.prototype,"layerSource",void 0),e$1([d$1({constructOnly:!0})],g.prototype,"view",void 0),e$1([d$1()],g.prototype,"tilesOfInterest",void 0),e$1([d$1({readOnly:!0})],g.prototype,"updateTilesParameters",null),e$1([d$1({readOnly:!0})],g.prototype,"updating",null),e$1([d$1({readOnly:!0})],g.prototype,"configuration",null),e$1([d$1({readOnly:!0})],g.prototype,"availability",null),g=e$1([i("esri.views.interactive.snapping.featureSources.FeatureServiceSnappingSource")],g);

export { g as FeatureServiceSnappingSource };
