import { r as registerInstance, c as createEvent, g as getElement } from './index-b157fcf2.js';
import { e as e$9, d as d$6, i as i$8, p as p$d, a1 as a$9, S as S$1, f as c$a, o as o$3, c as s$7, co as t$4, G as u$6, F as g$2, a as i$a, r as n$5, j as e$a, z as z$2, l as n$6, ay as i$b, ce as e$b, aP as s$9, X as l$9, aC as y$1, s as s$a, bo as s$b, P as g$3, A as r$7, af as t$6, al as P$1, T as T$3, E as C$5, ai as l$b, ap as j$5, ax as m$b, h as h$6, g as f$5, aw as p$f, cp as n$7, aW as c$b, aE as b$7, c6 as r$9, a9 as j$6, a8 as R$1, aN as n$a, bm as E$5, V as e$e, u as u$7, a0 as k$2, $ as $$1, cq as a$f, bv as m$g, cr as p$i, k as a$g, H as s$e, aO as m$i, y as d$a, M as i$e } from './messageBundle-f75b4090.js';
import { a as a$a, d as d$8 } from './HandleOwner-88326c19.js';
import { a as a$b, l as r$5, o as re, h as h$8 } from './opacityUtils-5e864561.js';
import { h as h$3 } from './Color-d1b9b54f.js';
import { h as h$5, f as f$4, g as g$4, t as t$9, u as u$8, A as A$1, e as c$d, j as A$2, m as m$h } from './screenUtils-49015526.js';
import { h as h$4 } from './Graphic-3961df6c.js';
import { E as E$4 } from './FeatureLayer-91daf6b1.js';
import { r as r$4 } from './PopupTemplate-6e5ecad2.js';
import { E as E$3 } from './InputField-3a8ab041.js';
import { i as i$9 } from './Field-bfaa8af9.js';
import { s as s$8 } from './Heading-960a88b2.js';
import { t as t$5 } from './vmEvent-6b909beb.js';
import { l as luxon } from './luxon-ec6026e9.js';
import { r as r$6 } from './Identifiable-da047c47.js';
import { h as h$7 } from './GraphicsLayer-86475574.js';
import { i as i$c, p as p$e, m as m$e } from './reactiveUtils-8f9c3a3d.js';
import { e as e$c, c as c$c, i as i$d } from './screenUtils-9bb7e30c.js';
import { m as m$9 } from './diffUtils-849b3672.js';
import { s as s$c, a as a$d } from './drapedUtils-4802ed0b.js';
import { m as m$a } from './lengthUtils-f033d4fe.js';
import { l as l$a } from './sizeVariableUtils-4d3662df.js';
import { getRotationAngle as b$6, getSize as V$4 } from './visualVariableUtils-26c41ea6.js';
import { a as a$c } from './jsonUtils-ade233cd.js';
import { t as t$7 } from './hitTestSelectUtils-779b69ca.js';
import { e as e$d } from './layerViewUtils-4127a8cf.js';
import { j as j$9, y as y$3, S as S$2, m as m$f } from './symbols-b414aa72.js';
import { D as D$1, c as R$2, p as p$g } from './unitUtils-38774114.js';
import { v as v$6, c as t$a } from './geometry-7e07b1ba.js';
import { r as r$8 } from './ElevationInfo-be94499b.js';
import { y as y$2 } from './geodesicUtils-32a18b56.js';
import { q as q$3, o as o$4, j as j$7, a as a$e, s as s$d, p as p$h, m as m$d, _ as _$1, d as d$9 } from './vec2-5672471e.js';
import { n as n$8 } from './common-d5b993de.js';
import { n as n$9, t as t$8 } from './vec2f64-35868783.js';
import { m as m$c, b as b$8, l as l$c, M as M$4, q as q$4, d as d$7, j as j$8, k as k$1 } from './geometry2dUtils-4e41c21e.js';
import { t as t$b } from './accessibleHandler-feb312a0.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let e$8=class extends p$d{constructor(r){super(r),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1;}};e$9([d$6({constructOnly:!0})],e$8.prototype,"layer",void 0),e$9([d$6()],e$8.prototype,"enabled",void 0),e$9([d$6()],e$8.prototype,"updating",void 0),e$9([d$6()],e$8.prototype,"availability",void 0),e$8=e$9([i$8("esri.views.interactive.snapping.SnappingLayerSource")],e$8);const p$c=e$8;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let r$3=class extends a$9{constructor(){super(...arguments),this.enabled=!0;}};e$9([d$6({type:Boolean})],r$3.prototype,"enabled",void 0),r$3=e$9([i$8("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],r$3);let l$8=class extends a$9{constructor(e){super(e),this.lineSnapper=new r$3,this.parallelLineSnapper=new r$3,this.rightAngleSnapper=new r$3,this.rightAngleTriangleSnapper=new r$3,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new h$3([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5;}};e$9([d$6({type:r$3,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l$8.prototype,"lineSnapper",void 0),e$9([d$6({type:r$3,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l$8.prototype,"parallelLineSnapper",void 0),e$9([d$6({type:r$3,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l$8.prototype,"rightAngleSnapper",void 0),e$9([d$6({type:r$3,constructOnly:!0,nonNullable:!0,json:{write:!0}})],l$8.prototype,"rightAngleTriangleSnapper",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],l$8.prototype,"shortLineThreshold",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],l$8.prototype,"distance",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l$8.prototype,"pointThreshold",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l$8.prototype,"intersectionParallelLineThreshold",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l$8.prototype,"parallelLineThreshold",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l$8.prototype,"touchSensitivityMultiplier",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],l$8.prototype,"pointOnLineThreshold",void 0),e$9([d$6({type:h$3,nonNullable:!0})],l$8.prototype,"orange",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l$8.prototype,"lineHintWidthReference",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l$8.prototype,"lineHintWidthTarget",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],l$8.prototype,"lineHintFadedExtensions",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],l$8.prototype,"parallelLineHintWidth",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],l$8.prototype,"parallelLineHintLength",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],l$8.prototype,"parallelLineHintOffset",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],l$8.prototype,"rightAngleHintSize",void 0),e$9([d$6({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],l$8.prototype,"rightAngleHintOutlineSize",void 0),l$8=e$9([i$8("esri.views.interactive.snapping.Settings.Defaults")],l$8);const p$b=new l$8;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let p$a=class extends p$d{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new S$1,this.distance=p$b.distance,this.touchSensitivityMultiplier=p$b.touchSensitivityMultiplier;}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};e$9([d$6()],p$a.prototype,"enabled",void 0),e$9([d$6()],p$a.prototype,"enabledToggled",void 0),e$9([d$6()],p$a.prototype,"selfEnabled",void 0),e$9([d$6()],p$a.prototype,"featureEnabled",void 0),e$9([d$6({type:S$1.ofType(p$c)})],p$a.prototype,"featureSources",void 0),e$9([d$6()],p$a.prototype,"distance",void 0),e$9([d$6()],p$a.prototype,"touchSensitivityMultiplier",void 0),e$9([d$6({readOnly:!0})],p$a.prototype,"effectiveEnabled",null),e$9([d$6({readOnly:!0})],p$a.prototype,"effectiveSelfEnabled",null),e$9([d$6({readOnly:!0})],p$a.prototype,"effectiveFeatureEnabled",null),p$a=e$9([i$8("esri.views.interactive.snapping.SnappingOptions")],p$a);const l$7=p$a;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let p$9=class extends a$9{constructor(r){super(r),this.digitSeparator=!1,this.dateFormat=null,this.places=null;}};e$9([d$6()],p$9.prototype,"digitSeparator",void 0),e$9([d$6({json:{read:{source:"dateFormat",reader:r$4}}})],p$9.prototype,"dateFormat",void 0),e$9([d$6()],p$9.prototype,"places",void 0),p$9=e$9([i$8("esri.widgets.FeatureForm.Format")],p$9);const a$8=p$9;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$6=class extends p$d{constructor(o){super(o),this.description=null,this.domain=null,this.editable=!0,this.editorType=null,this.format=null,this.hint=null,this.includeTime=!0,this.label=null,this.maxLength=-1,this.minLength=-1,this.name=null,this.noValueOptionLabel=null,this.offValue=null,this.onValue=null,this.required=!1,this.requiredExpression=null,this.showNoValueOption=!1,this.visibilityExpression=null;}};e$9([d$6()],s$6.prototype,"description",void 0),e$9([d$6()],s$6.prototype,"domain",void 0),e$9([d$6()],s$6.prototype,"editable",void 0),e$9([d$6()],s$6.prototype,"editorType",void 0),e$9([d$6({type:a$8})],s$6.prototype,"format",void 0),e$9([d$6()],s$6.prototype,"hint",void 0),e$9([d$6()],s$6.prototype,"includeTime",void 0),e$9([d$6()],s$6.prototype,"label",void 0),e$9([d$6()],s$6.prototype,"maxLength",void 0),e$9([d$6()],s$6.prototype,"minLength",void 0),e$9([d$6()],s$6.prototype,"name",void 0),e$9([d$6()],s$6.prototype,"noValueOptionLabel",void 0),e$9([d$6()],s$6.prototype,"offValue",void 0),e$9([d$6()],s$6.prototype,"onValue",void 0),e$9([d$6()],s$6.prototype,"required",void 0),e$9([d$6()],s$6.prototype,"requiredExpression",void 0),e$9([d$6()],s$6.prototype,"showNoValueOption",void 0),e$9([d$6()],s$6.prototype,"visibilityExpression",void 0),s$6=e$9([i$8("esri.widgets.FeatureForm.FieldConfig")],s$6);const p$8=s$6;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let p$7=class extends p$d{constructor(o){super(o),this.description=null,this.fieldConfig=null,this.label=null,this.state="expanded",this.visibilityExpression=null;}castFieldConfig(o){return o?o.map((o=>o.declaredClass?o:new p$8(o))):null}};e$9([d$6()],p$7.prototype,"description",void 0),e$9([d$6()],p$7.prototype,"fieldConfig",void 0),e$9([c$a("fieldConfig")],p$7.prototype,"castFieldConfig",null),e$9([d$6()],p$7.prototype,"label",void 0),e$9([d$6()],p$7.prototype,"state",void 0),e$9([d$6()],p$7.prototype,"visibilityExpression",void 0),p$7=e$9([i$8("esri.widgets.FeatureForm.FieldGroupConfig")],p$7);const l$6=p$7;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let l$5=class extends(a$a(p$d)){constructor(i){super(i),this.arcade=null,this.config=null,this.description=null,this.feature=null,this.label=null,this.state=null,this.visibilityExpression=null;}get compiledFunc(){const{arcade:i}=this;return i&&i.arcadeUtils.createFunction(this.visibilityExpression)}get evaluatedVisibility(){const i=this.compiledFunc;if(!i)return;const{arcade:t}=this;return t.arcadeUtils.executeFunction(i,t.arcadeUtils.createExecContext(this.feature))}get inputFields(){return this._get("inputFields")}set inputFields(i){this.handles.removeAll(),i&&this.handles.add(i.map((i=>i.watch("visible",this._dirtyEvaluatedVisibility)))),this._set("inputFields",i);}get visible(){return !1!==this.evaluatedVisibility&&this.inputFields&&this.inputFields.some((i=>i.visible))}_dirtyEvaluatedVisibility(){this.visibilityExpression&&this.notifyChange("evaluatedVisibility");}};e$9([d$6()],l$5.prototype,"arcade",void 0),e$9([d$6()],l$5.prototype,"compiledFunc",null),e$9([d$6()],l$5.prototype,"config",void 0),e$9([d$6()],l$5.prototype,"evaluatedVisibility",null),e$9([o$3("config.description")],l$5.prototype,"description",void 0),e$9([d$6()],l$5.prototype,"feature",void 0),e$9([d$6()],l$5.prototype,"inputFields",null),e$9([o$3("config.label")],l$5.prototype,"label",void 0),e$9([o$3("config.state")],l$5.prototype,"state",void 0),e$9([o$3("config.visibilityExpression")],l$5.prototype,"visibilityExpression",void 0),e$9([d$6()],l$5.prototype,"visible",null),l$5=e$9([i$8("esri.widgets.FeatureForm.InputFieldGroup")],l$5);const p$6=l$5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function t$3(e){var i;const n={},t=[];return null==(i=e.expressionInfos)||i.map((e=>n[e.name]=e.expression)),{config:l$4(e.elements,n,t),encounteredUnsupportedTypes:t}}function o$2(n,t,o){const{description:l,domain:p,editable:r,fieldName:a,hint:s,input:u,label:d,requiredExpression:m,visibilityExpression:y}=n,f=t[m]||null,c=t[y]||null,x=new p$8({description:l,domain:p,editable:r,hint:s,label:d,name:a,requiredExpression:f,visibilityExpression:c});if(u)if("barcode-scanner"===u.type||"text-area"===u.type||"text-box"===u.type)x.editorType=u.type,x.minLength=u.minLength,x.maxLength=u.maxLength;else if("combo-box"===u.type||"radio-buttons"===u.type)x.editorType=u.type,x.noValueOptionLabel=u.noValueOptionLabel,x.showNoValueOption=u.showNoValueOption;else if("switch"===u.type)x.editorType=u.type,x.offValue=u.offValue,x.onValue=u.onValue;else if("datetime-picker"===u.type){x.editorType=u.type,x.includeTime=u.includeTime;const{max:i,min:n}=u;if(i||n){const t="range"===(null==p?void 0:p.type)?Math.min(null==i?void 0:i.getTime(),p.maxValue):null==i?void 0:i.getTime(),o="range"===(null==p?void 0:p.type)?Math.max(null==n?void 0:n.getTime(),p.minValue):null==n?void 0:n.getTime();x.domain=new i$9({maxValue:t,minValue:o,name:"__internal-range-domain-based-on-datetime-picker-input__"});}}else o.push({type:"unsupported-input-type",details:u});return x}function l$4(e,i,t,p=!0){return e.map((e=>{if("field"===e.type)return o$2(e,i,t);if("group"===e.type){if(!p)return t.push({type:"nested-group",details:e}),null;const o=i[e.visibilityExpression]||null;return new l$6({description:e.description,state:e.initialState,fieldConfig:l$4(e.elements,i,t,!1),label:e.label,visibilityExpression:o})}return t.push({type:"unsupported-element-type",details:e}),null})).filter((e=>!!e))}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function v$5(e){return !!e.inputFields}function F$2(e){return !!e.fieldConfig}const C$4=new h$4({attributes:{}}),j$4="esri.widgets.FeatureForm.FeatureFormViewModel",E$2=s$7.getLogger(j$4);let O$1=class extends(a$a(n$5.EventedAccessor)){constructor(e){super(e),this._arcade=null,this._fieldPool=new t$4(E$3),this._fieldGroupPool=new t$4(p$6),this._featureClone=C$4.clone(),this._initialFeature=C$4.clone(),this._needsArcade=!1,this.messages=null,this.strict=!1;}initialize(){const e=async()=>this.messages=await u$6("esri/widgets/FeatureForm/t9n/FeatureForm");e(),this.handles.add(g$2(e));const t=i$a(this,"fieldConfig",(async e=>{const i=[];e&&e.forEach((e=>{i.push(e.visibilityExpression),F$2(e)?e.fieldConfig.forEach((({requiredExpression:e,visibilityExpression:t})=>{i.push(e,t);})):i.push(e.requiredExpression);}));const r=i.filter((e=>!!e)),s=r.length>0;if(s){const e=await a$b(),{arcadeUtils:i}=e;r.some((e=>i.hasGeometryOperations(e)))&&(await i.enableGeometryOperations(),t.remove()),this._arcade=e,this.notifyChange("inputFields");}this._needsArcade=s;}));this.handles.add(t);}destroy(){this.fieldConfig=null,this.feature=null,this.layer=null,this._fieldPool.destroy(),this._fieldGroupPool.destroy();}get _allInputFields(){return this.inputFields.reduce(((e,t)=>v$5(t)?[...e,...t.inputFields]:[...e,t]),[])}get _inputFieldCache(){const e=this._get("_inputFieldCache")||new Map;e.forEach((e=>this._disposeInputOrGroup(e))),e.clear();return (this.get("layer.fields")||[]).forEach((t=>e.set(t,this._fieldPool.acquire()))),e}get _inputFieldGroupCache(){const e=this._get("_inputFieldGroupCache")||new Map;e.forEach((e=>this._disposeInputOrGroup(e))),e.clear();return (this.fieldConfig||[]).filter(F$2).forEach((t=>e.set(t,this._fieldGroupPool.acquire()))),e}get description(){var e;return null==(e=this.formTemplate)?void 0:e.description}set description(e){void 0===e?this._clearOverride("description"):this._override("description",e);}get feature(){return this._get("feature")}set feature(e){this._featureClone=e?e.clone():C$4.clone(),this._initialFeature=this._featureClone.clone(),this._set("feature",e);}get fieldConfig(){const{formTemplate:e}=this;if(!e)return null;const{config:t,encounteredUnsupportedTypes:i}=t$3(e);return i.length>0&&E$2.warn("form-info::unsupported-type","encountered unsupported elements/types when parsing form info",i),t}set fieldConfig(e){e?this._override("fieldConfig",e):this._clearOverride("fieldConfig");}castFieldConfig(e){return e?e.map((e=>e instanceof p$8||e instanceof l$6?e:F$2(e)?new l$6(e):new p$8(e))):null}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(e){void 0===e?this._clearOverride("formTemplate"):this._override("formTemplate",e);}get inputFields(){const{_arcade:e,_inputFieldCache:t,_inputFieldGroupCache:i,_featureClone:r,messages:s,_needsArcade:o,layer:l,state:a}=this,n=r.clone();if("ready"!==a||o&&!e)return [];const u=this.get("layer.fields")||[],p=this.fieldConfig||[];let d;return d=0!==p.length?p.map((r=>{if(F$2(r)){const o=i.get(r),a=r.fieldConfig.map((i=>{const r=u.find((e=>e.name===i.name)),a=t.get(r);return a.set({arcade:e,field:r,config:i,feature:n,group:o,initialFeature:this._initialFeature,layer:l,messages:s,value:this.getValue(r.name)}),a})).filter((e=>e.visible));return o.set({arcade:e,config:r,feature:n,inputFields:a}),o}const o=u.find((e=>e.name===r.name)),a=t.get(o);return a.set({arcade:e,field:o,config:r,feature:n,group:null,initialFeature:this._initialFeature,layer:l,messages:s,value:this.getValue(o.name)}),a})):u.map((i=>{const r=t.get(i);return r.set({arcade:e,config:null,field:i,feature:n,group:null,initialFeature:this._initialFeature,layer:l,messages:s,value:this.getValue(i.name)}),r})),d.filter((e=>e.visible))}get layer(){var e;return null!=(e=this.feature)&&e.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null}set layer(e){e?this._override("layer",e):this._clearOverride("layer");}get state(){return this.messages&&this.get("layer.loaded")?"ready":"disabled"}get title(){var e;return null==(e=this.formTemplate)?void 0:e.title}set title(e){void 0===e?this._clearOverride("title"):this._override("title",e);}get valid(){const e=this._allInputFields;return e.length>0&&e.every((({valid:e})=>e))}findField(e){return this._allInputFields.find((t=>t.name===e))}getValue(e){var t;const{_featureClone:i,layer:r}=this,s=!(null==r||!r.getField(e));return null!=(t=i.getAttribute(e))?t:s?null:void 0}setValue(e,t){const{_featureClone:i,strict:r}=this,s=this.findField(e);if(t=""===t?null:t,!s||i.getAttribute(e)===t)return;s.value=t;if(this.get("layer.typeIdField")===s.name&&"types"in this.layer){const e=new Set;this.layer.types.forEach((t=>Object.keys(t.domains).forEach((t=>e.add(t))))),e.forEach((e=>{const t=this.findField(e);t&&t.notifyChange("domain");}));}r&&!s.valid||(i.setAttribute(e,t),this.notifyChange("inputFields"),this._emitChangeEvent(s));}getValues(){return {...this._featureClone.attributes}}submit(){const e=this._allInputFields,t=e.filter((e=>e.valid)).map((({name:e})=>e)),i=e.filter((e=>!e.valid)).map((({name:e})=>e)),r=this.getValues();this.emit("submit",{valid:t,invalid:i,values:r});}_disposeInputOrGroup(e){v$5(e)?this._disposeGroup(e):this._disposeInput(e);}_disposeGroup(e){e.inputFields.forEach((e=>this._disposeInput(e))),this._fieldGroupPool.release(e);}_disposeInput(e){this._fieldPool.release(e);}_emitChangeEvent({name:e,valid:t,value:i}){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:e,value:i,valid:t});}};e$9([d$6({readOnly:!0})],O$1.prototype,"_allInputFields",null),e$9([d$6({readOnly:!0})],O$1.prototype,"_inputFieldCache",null),e$9([d$6({readOnly:!0})],O$1.prototype,"_inputFieldGroupCache",null),e$9([d$6()],O$1.prototype,"description",null),e$9([d$6()],O$1.prototype,"feature",null),e$9([d$6()],O$1.prototype,"fieldConfig",null),e$9([c$a("fieldConfig")],O$1.prototype,"castFieldConfig",null),e$9([d$6({type:E$4})],O$1.prototype,"formTemplate",null),e$9([d$6({readOnly:!0,dependsOn:["messages","feature","fieldConfig","layer.fields","layer.loaded","state"]})],O$1.prototype,"inputFields",null),e$9([d$6()],O$1.prototype,"layer",null),e$9([d$6()],O$1.prototype,"messages",void 0),e$9([d$6()],O$1.prototype,"state",null),e$9([d$6()],O$1.prototype,"strict",void 0),e$9([d$6()],O$1.prototype,"title",null),e$9([d$6()],O$1.prototype,"valid",null),e$9([d$6()],O$1.prototype,"getValues",null),e$9([d$6()],O$1.prototype,"submit",null),O$1=e$9([i$8(j$4)],O$1);const b$5=O$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const m$8={base:"esri-feature-form",form:"esri-feature-form__form",formHeader:"esri-feature-form__form-header",label:"esri-feature-form__label",inputField:"esri-feature-form__input",inputDate:"esri-feature-form__input--date",inputTime:"esri-feature-form__input--time",inputRadioGroup:"esri-feature-form__input--radio-group",inputRadio:"esri-feature-form__input--radio",inputRadioLabel:"esri-feature-form__input--radio-label",inputDisabled:"esri-feature-form__input--disabled",inputSwitch:"esri-feature-form__input--switch",inputInvalid:"esri-feature-form__input--invalid",inputIconInvalid:"esri-feature-form__input-icon--invalid",errorMessage:"esri-feature-form__field-error-message",description:"esri-feature-form__description-text",dateInputPart:"esri-feature-form__date-input-part",loneDateInputPart:"esri-feature-form__date-input-part--lone",dateInputContainer:"esri-feature-form__date-input-container",dateFormatHint:"esri-feature-form__date-format-hint",group:"esri-feature-form__group",groupLabel:"esri-feature-form__group-label",groupHeader:"esri-feature-form__group-header",groupHeading:"esri-feature-form__group-header",groupTitle:"esri-feature-form__group-title",groupDescription:"esri-feature-form__group-description",groupToggleIcon:"esri-feature-form__group-toggle-icon",groupCollapsed:"esri-feature-form__group--collapsed",groupSequential:"esri-feature-form__group--sequential",groupActive:"esri-feature-form__group--active",collapseIcon:"esri-icon-up",errorIcon:"esri-icon-notice-triangle",expandIcon:"esri-icon-down",widget:"esri-widget",panel:"esri-widget--panel",input:"esri-input",select:"esri-select"},f$3={datePattern:"D",timePattern:"tt"};function _(e){return e&&e.inputFields}let v$4=class extends z$2{constructor(e,t){super(e,t),this._activeDateFieldEdit=null,this._activeInputName=null,this._fieldFocusNeeded=!1,this._fieldToInitialIncompatibleDomainValue=new Map,this._switchFieldsWithInitialIncompatibleValue=new Set,this._userUpdatedInputFieldNames=new Set,this.description=null,this.feature=null,this.fieldConfig=null,this.formTemplate=null,this.groupDisplay="all",this.headingLevel=2,this.label=void 0,this.layer=null,this.messages=null,this.strict=null,this.title=null,this.viewModel=new b$5,this._handleRadioInputChange=e=>{this._commitInputValue(e.target);},this._handleInputInput=e=>{this._commitInputValue(e.target,!0);},this._handleFormKeyDown=this._handleFormKeyDown.bind(this),this._handleInputBlur=this._handleInputBlur.bind(this),this._handleInputFocus=this._handleInputFocus.bind(this),this._handleNumberInputMouseDown=this._handleNumberInputMouseDown.bind(this),this._handleInputKeyDown=this._handleInputKeyDown.bind(this),this._handleOptionChange=this._handleOptionChange.bind(this),this._handleGroupClick=this._handleGroupClick.bind(this),this._handleSubmit=this._handleSubmit.bind(this),this._afterInputCreateOrUpdate=this._afterInputCreateOrUpdate.bind(this);}initialize(){this.own(this.watch("feature",(()=>{const e=this._getFocusableInput("forward");this._activeInputName=e&&e.name,this._userUpdatedInputFieldNames.clear(),this._fieldToInitialIncompatibleDomainValue.clear(),this._switchFieldsWithInitialIncompatibleValue.clear(),this._fieldFocusNeeded=!0;})),this.on("submit",(e=>{if(e.invalid.length>0){const[t]=e.invalid;e.invalid.forEach((e=>this._userUpdatedInputFieldNames.add(e))),this._activeInputName=t,this._fieldFocusNeeded=!0,this.scheduleRender();}})));}loadDependencies(){return import('./calcite-switch-526029a1.js')}destroy(){this._userUpdatedInputFieldNames.clear(),this._userUpdatedInputFieldNames=null;}getValues(){return null}submit(){return null}render(){const{state:e}=this.viewModel;return n$6("div",{class:this.classes(m$8.base,m$8.widget,m$8.panel)},"ready"===e?this.renderForm():null)}renderForm(){const e=this.title?n$6(s$8,{key:"title",level:this.headingLevel},this.title):null,t=this.description?n$6("p",{class:m$8.description,key:"description"},this.description):null,i=e||t?n$6("div",{class:m$8.formHeader},e,t):null;return n$6("form",{class:m$8.form,novalidate:!0,onsubmit:this._handleSubmit,onkeydown:this._handleFormKeyDown},i,this.renderFields())}renderFields(){const{viewModel:{inputFields:e}}=this;return e.map(((e,t)=>_(e)?this.renderGroup(e,t):this.renderLabeledField(e)))}renderGroup(e,t){const{description:i,inputFields:a,label:l,state:r}=e,n=this.viewModel.findField(this._activeInputName),s=!(!n||n.group!==e),d=`${this.id}_group_${t}`,u=`${this.id}_group-label_${t}`,c=`${this.id}_group-description_${t}`,h=i?n$6("p",{class:this.classes(m$8.groupDescription,m$8.description),id:c},i):null,f="sequential"===this.groupDisplay,_=f?s:"expanded"===r,v=_?m$8.collapseIcon:m$8.expandIcon;return n$6("fieldset",{"aria-expanded":_.toString(),"aria-labelledby":u,"aria-describedby":i?c:"",class:this.classes(m$8.group,f?m$8.groupSequential:null,_?null:m$8.groupCollapsed,s?m$8.groupActive:null),"data-group":e,id:d,key:t,onclick:this._handleGroupClick},n$6("button",{role:f?"presentation":void 0,class:m$8.groupHeader,type:"button",tabIndex:f?-1:0},n$6("div",{class:m$8.groupTitle},n$6(s$8,{class:m$8.groupLabel,id:u,level:this.headingLevel+(this.title?1:0)},l),h),f?null:n$6("span",{class:this.classes(v,m$8.groupToggleIcon)})),a.map((e=>this.renderLabeledField(e))))}_getFocusableInput(e,t){const i=this.viewModel._allInputFields,a="forward"===e?i:i.slice().reverse();let l;if(t)if(_(t))l=a.indexOf(t.inputFields[0]);else {let i;if(this._isFieldInClosedCollapsibleGroup(t)){const{inputFields:a}=t.group;i="forward"===e?a[a.length-1]:a[0];}else i=t;l=a.indexOf(i)+1;}else l=0;for(let r=l;r<a.length;r++){const e=a[r];if(e.visible)return e}return null}renderLabeledField(e){const{label:t,layer:i,type:a}=e;return n$6("label",{key:`${i.id}-${e.name}`,class:m$8.label},[t,"unsupported"!==a?this.renderInputField(e):this.renderUnsupportedField(e),this.renderAuxiliaryText(e)])}renderInputField(e){const{viewModel:t}=this,{domain:i,editable:a,name:l,type:r}=e,n=t.getValue(l),s=!a,o=this.getCommonInputProps(e);if("coded-value"===(null==i?void 0:i.type)&&!s){if("switch"===e.editorType){if(!(this._switchFieldsWithInitialIncompatibleValue.has(l)||null==n||e.config.onValue!==n&&e.config.offValue!==n))return this.renderSwitchInputField(n,o);this._switchFieldsWithInitialIncompatibleValue.add(l);}return "radio-buttons"===e.editorType?this.renderRadioButtonsInputField(n,i.codedValues.map((({code:e,name:t})=>({value:e,name:t}))),o):this.renderSelectInputField(n,i.codedValues.map((({code:e,name:t})=>({value:e,name:t}))),o)}return "text"===r&&"text-area"===e.editorType||"rich-text"===e.editorType?n$6("textarea",{...o}):"datetime-picker"===e.editorType||"date"===r?this.renderDateInputField(n,o):n$6("input",{type:"text"===r?"text":"number",...o})}_parseDateTime(e,t,i){if(i){var a;let l=luxon.DateTime.fromJSDate(this._parseDate(e,i));const r=luxon.DateTime.fromMillis(null!=(a=t.value)?a:Date.now());return l="date"===i?l.set({hour:r.hour,minute:r.minute,second:r.second}):l.set({day:r.day,month:r.month,year:r.year}),l.isValid?l.toMillis():null}const l=luxon.DateTime.fromJSDate(this._parseDate(e));return l.isValid?l.toMillis():null}renderDateInputField(e,t){const{date:i,time:a}=this._formatDate(0),l=`${this.id}-${t.key}`,r=`${l}-date`,n=`${l}-time`,s=t["data-field"],{includeTime:o}=s,{_activeDateFieldEdit:d}=this;let{date:u,time:c}=this._formatDate(e);var h,f,_,v;(null==d?void 0:d.fieldName)===s.name&&(u=null!=(h=null==(f=d.date.input)?void 0:f.value)?h:u,c=null!=(_=null==(v=d.time.input)?void 0:v.value)?_:c);return n$6("div",{key:`${t.key}-date`,class:m$8.dateInputContainer},n$6("div",{class:this.classes(m$8.dateInputPart,o?null:m$8.loneDateInputPart)},n$6("input",{"aria-label":s.label,"aria-describedby":r,type:"text",...t,"data-date-part":"date",class:this.classes(t.class,m$8.inputDate),value:u}),n$6("div",{class:m$8.dateFormatHint,id:r},i)),o?n$6("div",{class:m$8.dateInputPart,key:"time-input"},n$6("input",{"aria-describedby":n,"aria-label":s.label,type:"text",...t,"data-date-part":"time",class:this.classes(t.class,m$8.inputTime),value:c}),n$6("div",{class:m$8.dateFormatHint,id:n},a)):null)}renderUnsupportedField(e){const t=this.getCommonInputProps(e);return n$6("input",{afterCreate:t.afterCreate,afterUpdate:t.afterUpdate,class:this.classes(m$8.input,m$8.inputField,m$8.inputDisabled),"data-field":t["data-field"],onfocus:t.onfocus,readOnly:!0,tabIndex:t.tabIndex,type:"text",value:t.value})}renderSelectInputField(e,t,i){const a=t.map((e=>n$6("option",{value:`${e.value}`,key:e.name},e.name))),l=i["data-field"];if(this.registerIncompatibleValue(e,t,l,(e=>{a.unshift(n$6("option",{value:`${e}`,key:"incompatible-option",readOnly:!0},e));})),!l.required&&("combo-box"!==l.editorType||l.config.showNoValueOption)){var r;const e="",t=(null==(r=l.config)?void 0:r.noValueOptionLabel)||this.messages.empty;a.unshift(n$6("option",{value:e,key:"empty-option"},t));}return n$6("select",{...i,class:this.classes(i.class,m$8.select),onchange:this._handleOptionChange},a)}registerIncompatibleValue(e,t,i,a){const l=this._fieldToInitialIncompatibleDomainValue,r=l.has(i.name);(r||null!=e&&""!==e&&!t.find((t=>t.value===e))||r)&&(r||l.set(i.name,e),null==a||a(l.get(i.name)));}renderRadioButtonsInputField(e,t,i){const a=i["data-field"],l=t.map((t=>this.renderRadioButton({key:t.name,label:t.name,name:a.name,value:t.value,selected:t.value===e,props:i})));if(this.registerIncompatibleValue(e,t,a),!a.required&&(!a.config||a.config.showNoValueOption)){var r;const t="",n=(null==(r=a.config)?void 0:r.noValueOptionLabel)||this.messages.empty,s=e===t||null===e;l.unshift(this.renderRadioButton({key:"empty-option",label:n,name:a.name,value:t,selected:s,props:i}));}return n$6("div",{key:`${i.key}-radio`,class:m$8.inputRadioGroup},l)}renderSwitchInputField(e,t){const i=t["data-field"];return n$6("calcite-switch",{...t,class:m$8.inputSwitch,switched:e===i.config.onValue,onCalciteSwitchChange:e=>{this._parseValue(e.currentTarget);}})}renderRadioButton({key:e,name:t,value:i,selected:a,label:l,props:r}){return n$6("label",{key:e,class:m$8.inputRadioLabel},n$6("input",{...r,class:m$8.inputRadio,name:t,type:"radio",value:i,checked:a,onchange:this._handleRadioInputChange}),l)}renderAuxiliaryText(e){return this._userUpdatedInputFieldNames.has(e.name)&&!e.valid?n$6("div",{key:"error-message"},n$6("span",{class:this.classes(m$8.inputIconInvalid,m$8.errorIcon)}),n$6("div",{class:m$8.errorMessage},e.errorMessage)):e.description?n$6("div",{key:"description",class:m$8.description},e.description):void 0}getCommonInputProps(e){const{groupDisplay:t,viewModel:i}=this,{editable:a,group:l,hint:r,maxLength:n,minLength:s,name:o,required:d,type:u,valid:p}=e,c=i.getValue(o),h=this._userUpdatedInputFieldNames.has(o),f=!a,_="all"===t&&"collapsed"===(null==l?void 0:l.state);return {afterCreate:this._afterInputCreateOrUpdate,afterUpdate:this._afterInputCreateOrUpdate,"aria-invalid":p?"false":"true",class:this.classes(m$8.input,m$8.inputField,f?m$8.inputDisabled:null,h&&!p?m$8.inputInvalid:null),key:o,minlength:s>-1?`${s}`:"",maxlength:n>-1?`${n}`:"",...this._getNumberFieldConstraints(e),readOnly:f,value:null==c?"":`${c}`,"data-field":e,onfocus:this._handleInputFocus,oninput:this._handleInputInput,onblur:this._handleInputBlur,onkeydown:this._handleInputKeyDown,onmousedown:"number"===u?this._handleNumberInputMouseDown:null,placeholder:"number"===u||"text"===u?r:"",required:d,tabIndex:_?-1:0}}_isFieldInClosedCollapsibleGroup(e){var t;return "all"===this.groupDisplay&&!_(e)&&"collapsed"===(null==e||null==(t=e.group)?void 0:t.state)}_handleNumberInputMouseDown({target:e}){e.focus(),this.scheduleRender();}_getNumberFieldConstraints(e){const t=r$5(e.domain)||re(e.field);return t&&t.max!==Number.MAX_VALUE&&t.min!==Number.MIN_VALUE?t:{min:null,max:null}}_afterInputCreateOrUpdate(e){const t=e["data-field"],i=this.viewModel.findField(this._activeInputName),a=this._fieldToInitialIncompatibleDomainValue.get(t.name)===t.value;this._fieldFocusNeeded&&i===t&&("radio-buttons"!==t.editorType||a||e.checked)&&(this._fieldFocusNeeded=!1,e.focus());}_handleInputFocus(e){const t=e.target,i=t["data-field"];this._activeInputName=i.name,"date"===i.type&&this._syncDateFieldEdits(t);}_handleInputBlur(e){const t=e.target,i=t["data-field"];if("date"===i.type){const l=e.relatedTarget,r=l&&l["data-field"];if(r&&"date"===i.type&&"date"===r.type&&i.field===r.field){if(""!==t.value&&""===l.value){var a;const r=l.getAttribute("data-date-part");l.value=this._formatDate(null!=(a=i.value)?a:Date.now())[r],this._parseDate(t.value,t.getAttribute("data-date-part"))&&this._commitInputValue(e.target,!0,!1);}return}}this._commitInputValue(t),this.scheduleRender();}_commitInputValue(e,t=!1,i=!0){const a=e["data-field"];if(this._activeDateFieldEdit){const{date:o,time:d}=this._activeDateFieldEdit,u=this._parseDateTime(e.value,a,o.active?"date":"time"),p=null!==this.viewModel.getValue(a.name),c=o.input&&(d.input||!a.includeTime),h=null===u;if(t){if(h)return;(c||!i||p)&&this._updateDateFieldValue(a,u);}else {var l,r;if(""===(null==(l=o.input)?void 0:l.value)||""===(null==(r=d.input)?void 0:r.value))this._updateDateFieldValue(a,null);else if(c){var n,s;const e=`${o.input.value} ${null!=(n=null==(s=d.input)?void 0:s.value)?n:""}`,t=this._parseDateTime(e,a);!(null!==t)&&p||this._updateDateFieldValue(a,t);}this._activeDateFieldEdit=null;}}else this._updateFieldValue(e);}_handleInputKeyDown(e){const{key:t,altKey:i,ctrlKey:a,metaKey:l}=e,r=e.target["data-field"];if("Enter"===t)this._isFieldInClosedCollapsibleGroup(r)&&(r.group.state="expanded");else {const{type:n}=r.field,s="single"===n||"double"===n,o=!i&&!a&&!l;if(("integer"===n||"small-integer"===n||s)&&o&&1===t.length){const i=Number(t),a=["-","+"],l=["e","."],r=s?[...a,...l]:a;isNaN(i)&&-1===r.indexOf(t)&&e.preventDefault();}}}_syncDateFieldEdits(e){var t,i;const a=e["data-field"];if("date"!==a.type)return;const l=e.getAttribute("data-date-part"),r="date"===l?{value:e.value,input:e,active:!0}:{...null==(t=this._activeDateFieldEdit)?void 0:t.date,active:!1},n="time"===l?{value:e.value,input:e,active:!0}:{...null==(i=this._activeDateFieldEdit)?void 0:i.time,active:!1};this._activeDateFieldEdit={fieldName:a.name,date:r,time:n};}_updateFieldValue(e){const t=e["data-field"];this.viewModel.setValue(t.name,this._parseValue(e)),this._userUpdatedInputFieldNames.add(t.name);}_updateDateFieldValue(e,t){this.viewModel.setValue(e.name,t),this._userUpdatedInputFieldNames.add(e.name);}_parseValue(e){const t=e["data-field"],i=e.value;if("switch"===t.editorType&&!(e instanceof HTMLSelectElement))return e.switched?t.config.onValue:t.config.offValue;if("radio-buttons"===t.editorType&&"radio"===e.type&&!e.checked)return t.value;const{type:a}=t;if("number"===a)return i?parseFloat(i):null;if("date"===a){if(!i)return null;const a=Number(i);if(!isNaN(a))return a;const l=e.getAttribute("data-date-part"),r=this._parseDate(i,l);if(!r)return null;let n=luxon.DateTime.fromJSDate(r);const s=t.domain,o=luxon.DateTime.now();let d=o;if(s&&"range"===s.type){const e=luxon.DateTime.fromMillis(s.maxValue);o<e&&(d=e);}const u=this.viewModel.getValue(t.name),p=null!=u?luxon.DateTime.fromMillis(u):d;return n="date"===l?n.set({hour:p.hour,minute:p.minute,second:p.second}):n.set({day:p.day,month:p.month,year:p.year}),n.toMillis()}return i}_handleOptionChange(e){this._commitInputValue(e.target),this.scheduleRender();}_handleGroupClick(e){var t;const i=e.currentTarget["data-group"],a="expanded"===i.state,l="sequential"===this.groupDisplay,r=`.${m$8.groupHeader}`;if(!(a&&!e.target.closest(r))){if(this._activeInputName=null==(t=this._getFocusableInput("forward",i))?void 0:t.name,l){const t=e.target.closest(r);if(a&&!t)return;this.viewModel.inputFields.forEach((e=>{_(e)&&e!==i&&(e.state="collapsed");}));}i.state=a?"collapsed":"expanded",this._fieldFocusNeeded=l,this.scheduleRender();}}_handleSubmit(e){e.preventDefault();}_handleFormKeyDown(e){"Enter"===e.key&&this.viewModel.submit();}_formatDate(e){if(null==e)return {date:"",time:""};const t=luxon.DateTime.fromMillis(e,{locale:i$b(),numberingSystem:"latn"});return {date:t.toLocaleString({year:"numeric",month:"2-digit",day:"2-digit"}),time:t.toFormat(f$3.timePattern)}}_parseDate(e,t){if(null==e||""===e)return null;const{timePattern:i,datePattern:a}=f$3,l=t?"date"===t?a:i:`${a} ${i}`,r=luxon.DateTime.fromFormat(e,l,{locale:i$b(),numberingSystem:"latn"});return r.isValid?r.toJSDate():null}};e$9([o$3("viewModel.description")],v$4.prototype,"description",void 0),e$9([o$3("viewModel.feature")],v$4.prototype,"feature",void 0),e$9([o$3("viewModel.fieldConfig")],v$4.prototype,"fieldConfig",void 0),e$9([o$3("viewModel.formTemplate")],v$4.prototype,"formTemplate",void 0),e$9([d$6()],v$4.prototype,"groupDisplay",void 0),e$9([d$6()],v$4.prototype,"headingLevel",void 0),e$9([d$6({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],v$4.prototype,"label",void 0),e$9([o$3("viewModel.layer")],v$4.prototype,"layer",void 0),e$9([d$6(),e$a("esri/widgets/FeatureForm/t9n/FeatureForm")],v$4.prototype,"messages",void 0),e$9([o$3("viewModel.strict")],v$4.prototype,"strict",void 0),e$9([o$3("viewModel.title")],v$4.prototype,"title",void 0),e$9([d$6(),t$5(["value-change","submit"])],v$4.prototype,"viewModel",void 0),e$9([o$3("viewModel.getValues")],v$4.prototype,"getValues",null),e$9([o$3("viewModel.submit")],v$4.prototype,"submit",null),v$4=e$9([i$8("esri.widgets.FeatureForm")],v$4);const g$1=v$4;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var n$4;const m$7=t=>`${t.label}-${t.layer.id}`;let p$5=n$4=class extends(a$a(p$d)){constructor(t){super(t),this._activeFetchInfo={id:null,request:null},this.description=null,this.label=null,this.layer=null,this.template=null,this.thumbnail=null;}initialize(){this.handles.add(i$a(this,["layer.renderer","template"],(()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null);})));}clone(){const t=this.thumbnail?this.thumbnail.cloneNode(!0):null,e=new n$4({layer:this.layer,template:this.template});return e._set("thumbnail",t),e}async fetchThumbnail(){const{_activeFetchInfo:t}=this;return m$7(this)===t.id||(t.id=m$7(this),t.request=this._getPreviewSymbol().then((async e=>{var r;if(m$7(this)!==t.id)return;const s={maxSize:36};"dictionary"===(null==(r=this.layer.renderer)?void 0:r.type)&&(s.fieldMap=this.layer.renderer.fieldMap,s.feature={attributes:this.template.prototype.attributes});const i=await h$5(e,s);m$7(this)===t.id&&this._set("thumbnail",i);}))),t.request}async _getPreviewSymbol(){const{layer:t,template:r,layer:{renderer:s}}=this;if(s){const t=new h$4({attributes:r.prototype.attributes}),i=await s.getSymbolAsync(t);if(i)return i}return this._getFallbackSymbolFromGeometry(t)}_getFallbackSymbolFromGeometry(t){const{geometryType:e}=t;return "point"===e||"multipoint"===e?import('./symbols-b414aa72.js').then(function (n) { return n.K; }).then((t=>new t.default)):"polyline"===e?import('./symbols-b414aa72.js').then(function (n) { return n.I; }).then((t=>new t.default)):"polygon"===e||"mesh"===e||"multipatch"===e?import('./symbols-b414aa72.js').then(function (n) { return n.J; }).then((t=>new t.default)):void 0}};e$9([d$6({aliasOf:"template.description"})],p$5.prototype,"description",void 0),e$9([d$6({aliasOf:"template.name"})],p$5.prototype,"label",void 0),e$9([d$6()],p$5.prototype,"layer",void 0),e$9([d$6()],p$5.prototype,"template",void 0),e$9([d$6({readOnly:!0})],p$5.prototype,"thumbnail",void 0),p$5=n$4=e$9([i$8("esri.widgets.FeatureTemplates.TemplateItem")],p$5);const c$9=p$5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let p$4=class extends(r$6(p$d)){constructor(r){super(r),this.items=null,this.label=null;}};e$9([d$6()],p$4.prototype,"items",void 0),e$9([d$6()],p$4.prototype,"label",void 0),p$4=e$9([i$8("esri.widgets.FeatureTemplates.TemplateItemGroup")],p$4);const c$8=p$4;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const p$3=({layer:e})=>({key:e,label:e.title}),m$6=({layer:e})=>e.geometryType;let u$5=class extends(a$a(n$5.EventedAccessor)){constructor(e){super(e),this._itemPool=new e$b(c$9),this._groupPool=new e$b(c$8),this.filterFunction=null,this.groupBy="layer",this.selectedItem=null;}destroy(){this._templateToLayer.clear();}get _templateToLayer(){const e=new Map;for(const{layer:t,templates:s}of this._featureTemplateInfos)for(const r of s)e.set(r,t);return e}set layers(e){const t="layers";if(this.handles.remove(t),e){const t=()=>this.notifyChange("state");this.handles.add(e.map((e=>s$9(e,"loadStatus",t))),"layers");}this._set("layers",e);}get layers(){return this._get("layers")}get state(){const{layers:e}=this;return e&&0!==e.length?e.some((e=>"loading"===e.loadStatus||"not-loaded"===e.loadStatus))?"loading":"ready":"disabled"}get _featureTemplateInfos(){return this.layers?this.layers.filter((({capabilities:e,loaded:t})=>t&&e.operations.supportsEditing&&e.operations.supportsAdd)).map((e=>({layer:e,templates:this._getTemplatesForLayer(e)}))).filter((e=>null!=e&&e.templates.length>0)):[]}get numberOfFeatureTemplates(){return this._featureTemplateInfos.reduce(((e,t)=>e+t.templates.length),0)}get items(){const e=this._featureTemplateInfos;if(0===e.length)return this._releasePreviousItems(),[];const{groupBy:t}=this;if("none"===t){const t=e.map((({templates:e})=>e.filter((({name:e})=>!this.filterFunction||this.filterFunction({label:e}))))).map((e=>e.map((e=>this._createItem(e))))).reduce(((e,t)=>[...e,...t]),[]);return this._releasePreviousItems(),t}const s=e.reduce(((e,{layer:s,templates:r})=>(r.forEach((r=>{const o=("layer"===t?p$3:"geometry"===t?m$6:t)({template:r,layer:s});if(o){const t="string"==typeof o?o:o.key,s="string"==typeof o?o:o.label;e.has(t)||e.set(t,{label:s,templates:[]}),e.get(t).templates.push(r);}})),e)),new Map);if(0===s.size)return this._releasePreviousItems(),[];const r=[],{filterFunction:o}=this;return s.forEach((e=>{const{label:t,templates:s}=e;if(!o||this.filterFunction(e))r.push(this._createGroup(t,s.map((e=>this._createItem(e)))));else {const e=s.filter((({name:e})=>this.filterFunction({label:e}))).map((e=>this._createItem(e)));e.length>0&&r.push(this._createGroup(t,e));}})),this._releasePreviousItems(),r}refresh(){this.notifyChange("items");}select(e){const t=(null==e?void 0:e.clone())||null;this._set("selectedItem",t),this.emit("select",{item:t,template:(null==t?void 0:t.template)||null});}_getTemplatesForLayer(e){const t=e.templates||[],s=(e.types||[]).map((e=>e.templates)).reduce(((e,t)=>[...e,...t]),[]);return [...t,...s]}_createItem(e){const t=this._itemPool.acquire();return t.set({template:e,layer:this._templateToLayer.get(e)}),t}_createGroup(e,t){const s=this._groupPool.acquire();return s.set("label",e),s.items=t,s}_releasePreviousItems(){this._destroyItems(this._get("items"));}_destroyItems(e){if(!e)return;e[0]instanceof c$9?e.forEach((e=>this._destroyItem(e))):e.forEach((e=>this._destroyGroup(e)));}_destroyGroup(e){e.items.forEach((e=>this._destroyItem(e))),e.items.length=0,this._groupPool.release(e);}_destroyItem(e){e.layer=null,e.template=null,this._itemPool.release(e);}};e$9([d$6({readOnly:!0})],u$5.prototype,"_templateToLayer",null),e$9([d$6()],u$5.prototype,"filterFunction",void 0),e$9([d$6()],u$5.prototype,"groupBy",void 0),e$9([d$6()],u$5.prototype,"layers",null),e$9([d$6()],u$5.prototype,"state",null),e$9([d$6({readOnly:!0})],u$5.prototype,"_featureTemplateInfos",null),e$9([d$6({readOnly:!0})],u$5.prototype,"numberOfFeatureTemplates",null),e$9([d$6({readOnly:!0})],u$5.prototype,"items",null),e$9([d$6({readOnly:!0})],u$5.prototype,"selectedItem",void 0),e$9([d$6()],u$5.prototype,"select",null),u$5=e$9([i$8("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],u$5);const c$7=u$5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const n$3={base:"esri-item-list",list:"esri-item-list__list",group:"esri-item-list__group",scroller:"esri-item-list__scroller",groupHeader:"esri-item-list__group-header",item:"esri-item-list__list-item",itemSelected:"esri-item-list__list-item--selected",itemContainer:"esri-item-list__list-item-container",itemLabel:"esri-item-list__list-item-label",noMatchesMessage:"esri-item-list__no-matches-message",noItemsMessage:"esri-item-list__no-items-message",filterContainer:"esri-item-list__filter-container",filterPlaceholder:"esri-item-list__filter-placeholder",filterInput:"esri-item-list__filter-input",filterPlaceholderText:"esri-item-list__filter-placeholder-text",searchIcon:"esri-icon-search",widget:"esri-widget",input:"esri-input"};function l$3(e){const{id:s,identify:l,filterEnabled:r=!0,headingLevel:c=4,items:m,selectedItem:d,messages:u,filterText:f="",onFilterChange:g,renderIcon:I,onItemMouseLeave:p,onItemMouseEnter:h,onItemSelect:_}=e;return n$6("div",{class:l$9(n$3.base,n$3.widget),key:s},r?a$7({filterText:f,messages:u,onFilterChange:g,id:s}):null,o$1({identify:l,items:m,selectedItem:d,messages:u,filterText:f,headingLevel:c,renderIcon:I,onItemMouseLeave:p,onItemMouseEnter:h,onItemSelect:_}))}function r$2(e){return !!e.items}function o$1(e){const{headingLevel:s,identify:l,items:o,renderIcon:a,filterText:d,onItemMouseLeave:u,onItemMouseEnter:f,onItemSelect:g,selectedItem:I}=e;return 0===o.length?n$6("div",{class:n$3.noMatchesMessage,key:"no-matches"},e.messages.noMatches):r$2(o[0])?n$6("div",{class:n$3.scroller,key:"item-container"},o.map((e=>m$5({filterText:d,group:e,headingLevel:s,identify:l,onItemMouseLeave:u,onItemMouseEnter:f,onItemSelect:g,renderIcon:a,selectedItem:I})))):n$6("ul",{class:l$9(n$3.list,n$3.scroller),key:"item-container"},o.map((e=>c$6({item:e,identify:l,grouped:!0,onItemMouseLeave:u,onItemMouseEnter:f,onItemSelect:g,renderIcon:a,filterText:d,selectedItem:I}))))}function a$7(e){const s=`${e.id}-placeholder`;return n$6("div",{class:n$3.filterContainer,key:"filter"},n$6("input",{"aria-labelledby":s,class:l$9(n$3.input,n$3.filterInput),oninput:t=>{const i=t.currentTarget;e.onFilterChange&&e.onFilterChange(i.value);},value:e.filterText,type:"search"}),e.filterText?null:n$6("div",{class:n$3.filterPlaceholder,id:s,key:"placeholder"},n$6("span",{class:n$3.searchIcon,"aria-hidden":"true"}),n$6("div",{class:n$3.filterPlaceholderText},e.messages.filterPlaceholder)))}function c$6(e){const{identify:l,item:r,selectedItem:o,grouped:a,filterText:c,onItemSelect:m,onItemMouseEnter:u,onItemMouseLeave:f,renderIcon:g}=e,I=`${(null==l?void 0:l(r))||r.id}__${r.label}`,p=o?`${(null==l?void 0:l(o))||o.id}__${o.label}`:"";return n$6("li",{"aria-level":a?"2":"",class:l$9(n$3.item,I===p&&n$3.itemSelected),"data-item":r,key:I,onclick:e=>{const t=e.currentTarget["data-item"];m&&m(t);},onmouseenter:e=>{const t=e.currentTarget["data-item"];u&&u(t);},onkeydown:e=>{if(!y$1(e.key))return;const t=e.currentTarget["data-item"];m&&m(t);},onmouseleave:e=>{const t=e.currentTarget["data-item"];f&&f(t);},tabIndex:0},n$6("div",{class:n$3.itemContainer},g&&g({item:r}),d$5({text:r.label,match:c})))}function m$5(i){const{group:s,headingLevel:l,identify:r,onItemMouseLeave:o,onItemMouseEnter:a,onItemSelect:m,filterText:u,renderIcon:f,selectedItem:g}=i,I=`${r&&r(s)||s.id}-heading`;return n$6("section",{"aria-labelledby":I,class:n$3.group,key:s.label},n$6(s$8,{id:I,class:n$3.groupHeader,level:l},d$5({text:s.label,match:u})),n$6("ul",{class:n$3.list},s.items.map((e=>c$6({item:e,identify:r,grouped:!0,onItemMouseLeave:o,onItemMouseEnter:a,onItemSelect:m,renderIcon:f,filterText:u,selectedItem:g})))))}function d$5(e){const{match:i,text:s}=e;let l=null;if(i){const e=s.toLowerCase(),n=i.toLowerCase(),r=e.indexOf(n);if(-1===r)l=s;else {const e=s.substring(0,r),n=s.substr(r,i.length),o=s.substring(r+i.length);l=n$6("span",null,e,n$6("strong",null,n),o);}}else l=s;return n$6("span",{class:n$3.itemLabel},l)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const h$2={base:"esri-feature-templates",loader:"esri-feature-templates__loader",itemIcon:"esri-feature-templates__list-item-icon",widget:"esri-widget"};function f$2(e){return "items"in e}function u$4(e){const{label:t}=e;return f$2(e)?t:`${t}–${e.layer.id}`}const v$3={filter:!0};let I$2=class extends(a$a(z$2)){constructor(e,t){super(e,t),this._iconIntersectionObserver=new IntersectionObserver(((e,t)=>{e.forEach((async e=>{if(e.isIntersecting){const r=e.target;if(!r["data-has-icon"]){const e=r["data-item"];r["data-has-icon"]=!0,t.unobserve(r),await e.fetchThumbnail();r["data-item"]===e&&e.thumbnail?r.appendChild(e.thumbnail):(r["data-has-icon"]=!1,t.observe(r));}}}));})),this.filterFunction=null,this.filterText="",this.groupBy=null,this.headingLevel=4,this.label=void 0,this.layers=null,this.messages=null,this.selectedItem=null,this.viewModel=new c$7,this.visibleElements={...v$3},this.renderItemIcon=this.renderItemIcon.bind(this),this._afterItemCreateOrUpdate=this._afterItemCreateOrUpdate.bind(this),this._afterItemRemoved=this._afterItemRemoved.bind(this);}initialize(){const e=({label:e})=>!this.filterText||e.toLowerCase().indexOf(this.filterText.toLowerCase())>-1;this.own(i$a(this,"viewModel",((t,r)=>{t&&!t.filterFunction&&(this.filterFunction=e),r&&r!==t&&r.filterFunction===e&&(r.filterFunction=null);})));}destroy(){this._iconIntersectionObserver&&(this._iconIntersectionObserver.disconnect(),this._iconIntersectionObserver=null);}castVisibleElements(e){return {...v$3,...e}}select(e){return null}render(){const{filterText:e,headingLevel:t,messages:r,viewModel:{items:s,selectedItem:i,state:o}}=this,a=this.visibleElements.filter;return n$6("div",{class:this.classes(h$2.base,h$2.widget),"aria-label":r.widgetLabel},"loading"===o?this.renderLoader():"ready"===o?n$6(l$3,{id:this.id,identify:u$4,filterText:e,items:s,headingLevel:t,messages:{filterPlaceholder:r.filterPlaceholder,noItems:r.noItems,noMatches:r.noMatches},filterEnabled:a,onItemSelect:e=>{this.viewModel.select(e);},onFilterChange:e=>{this.filterText=e,this.viewModel.refresh();},renderIcon:this.renderItemIcon,selectedItem:i}):null)}renderItemIcon({item:e}){return n$6("span",{key:"icon",class:h$2.itemIcon,afterCreate:this._afterItemCreateOrUpdate,afterUpdate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,"data-item":e,"data-has-icon":!1})}renderLoader(){return n$6("div",{class:h$2.loader,key:"loader"})}_afterItemCreateOrUpdate(e){this._iconIntersectionObserver.observe(e);}_afterItemRemoved(e){this._iconIntersectionObserver.unobserve(e);}};e$9([o$3("viewModel.filterFunction")],I$2.prototype,"filterFunction",void 0),e$9([d$6()],I$2.prototype,"filterText",void 0),e$9([o$3("viewModel.groupBy")],I$2.prototype,"groupBy",void 0),e$9([d$6()],I$2.prototype,"headingLevel",void 0),e$9([d$6({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],I$2.prototype,"label",void 0),e$9([o$3("viewModel.layers")],I$2.prototype,"layers",void 0),e$9([d$6(),e$a("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],I$2.prototype,"messages",void 0),e$9([o$3("viewModel.selectedItem")],I$2.prototype,"selectedItem",void 0),e$9([d$6(),t$5("select")],I$2.prototype,"viewModel",void 0),e$9([d$6()],I$2.prototype,"visibleElements",void 0),e$9([c$a("visibleElements")],I$2.prototype,"castVisibleElements",null),e$9([o$3("viewModel.select")],I$2.prototype,"select",null),I$2=e$9([i$8("esri.widgets.FeatureTemplates")],I$2);const b$4=I$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let t$2=class extends p$d{constructor(o){super(o),this.creationInfo=null,this.viewModel=null;}};e$9([d$6()],t$2.prototype,"creationInfo",void 0),e$9([d$6()],t$2.prototype,"viewModel",void 0),t$2=e$9([i$8("esri.widgets.Editor.BatchCreateWorkflowData")],t$2);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let n$2=class extends(a$a(n$5.EventedAccessor)){constructor(t){super(t),this._indexHistory=[],this._lastStepIndex=-1,this._stepIndex=-1,this._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"},this.data=void 0,this.started=!1,this.steps=[],this.type=null;}get hasNextStep(){const{steps:t}=this;return !!(t&&this._stepIndex<t.filter((t=>!t.parent)).length-1)}get hasPreviousStep(){return this._stepIndex>0}get stepId(){const{steps:t}=this,e=t&&t[this._stepIndex];return e&&e.id}async cancel(t={force:!0}){return !1!==t.force?this._cancel():new Promise(((t,s)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel().then(t);},deny:()=>s(new s$a("workflow:cancel-denied","Request to cancel workflow was denied."))}});}))}async commit(){this.handles.remove(this._handleKeys.beforeCommit),await this.onCommit(this.data),this.handles.remove(this._handleKeys.afterCommit),this.emit("commit"),this.started&&await this.reset();}async go(t){const{steps:e}=this,s=e.findIndex((e=>e.id===t));this._indexHistory.push(this._stepIndex),await this._go(s);}async next(){this._indexHistory.push(this._stepIndex),await this._go(this._stepIndex+1);}async previous(t={cancelCurrentStep:!1}){await this._go(this._indexHistory.pop(),t.cancelCurrentStep);}async reset(){await this._cancel(!1),await this.start();}async start(){this._set("started",!0);const t=-1===this._stepIndex?0:this._stepIndex;await this._go(t);}async _cancel(t=!0){this.started&&(this._set("started",!1),await this.steps[this._stepIndex].tearDown({cancelled:!0}),this.data&&this.data.viewModel.sketchViewModel.layer.removeAll()),this.handles.remove([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]),this._resetIndexing(t),t&&this.emit("cancel");}async _go(t=-1,e=!1){if(!(t<=-1||t>=this.steps.length)){if(!this.started)return this._stepIndex=t,void this._notifyStepProps();this._lastStepIndex>-1&&await this.steps[this._lastStepIndex].tearDown({cancelled:e}),await this.steps[t].setUp(),this._lastStepIndex=t,this._stepIndex=t,this._notifyStepProps();}}_resetIndexing(t=!0){this._stepIndex=-1,this._lastStepIndex=-1,this._indexHistory.length=0,t&&this._notifyStepProps();}_notifyStepProps(){this.notifyChange("stepId"),this.notifyChange("hasPreviousStep"),this.notifyChange("hasNextStep");}};e$9([d$6()],n$2.prototype,"data",void 0),e$9([d$6()],n$2.prototype,"hasNextStep",null),e$9([d$6()],n$2.prototype,"hasPreviousStep",null),e$9([d$6()],n$2.prototype,"onCommit",void 0),e$9([d$6()],n$2.prototype,"started",void 0),e$9([d$6({readOnly:!0})],n$2.prototype,"stepId",null),e$9([d$6()],n$2.prototype,"steps",void 0),e$9([d$6({readOnly:!0})],n$2.prototype,"type",void 0),e$9([d$6()],n$2.prototype,"commit",null),n$2=e$9([i$8("esri.widgets.Editor.Workflow")],n$2);const a$6=n$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let e$7=class extends n$5.EventedAccessor{constructor(r){super(r),this.tracking=!1,this.displaying=!1,this.isDraped=!1;}};e$9([d$6({constructOnly:!0})],e$7.prototype,"graphic",void 0),e$9([d$6()],e$7.prototype,"tracking",void 0),e$9([d$6()],e$7.prototype,"displaying",void 0),e$9([d$6()],e$7.prototype,"isDraped",void 0),e$7=e$9([i$8("esri.views.3d.layers.graphics.GraphicState")],e$7);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function v$2(e){const r=e.sourceLayer;if("feature"!==r.type||!z$1(r.renderer))return {rotation:null,size:null};let i=null,a=null;const n=r.renderer.getVisualVariablesForType("rotation").filter((r=>(!r.axis||"heading"===r.axis)&&r.field&&!r.valueExpression&&r$7(b$6(r,e))));1===n.length&&(i=S(n[0],r));const s=r.renderer.getVisualVariablesForType("size").filter((r=>r.field&&!r.useSymbolValue&&!r.valueExpression&&"real-world-size"===l$a(r)&&r$7(V$4(r,e))));return 1===s.length&&(a=V$3(s[0],r)),{rotation:i,size:a}}function S(e,t){const r="heading"===(e.axis||"heading")&&"arithmetic"===e.rotationType?-1:1,i=e.field,a=t.fields&&t.fields.filter((e=>e.name===i)),n=a&&1===a.length?a[0].type:"double",s={initial:0,current:0};return {field:i,getDefault:()=>Promise.resolve(0),getValue:e=>(s.current=s.initial-r*e,U$1((s.current+360)%360,n)),initValue:e=>{s.initial=null!=e?e:s.current,s.current=0;},isUpdatingInteractively:!1}}function j$3(e,t){switch(t){case"width":return e[0];case"depth":return e[1];case"height":return e[2];default:return e[2]||e[1]||e[0]}}async function I$1(e,t,i){if(t$6(t))return 0;const{symbol:a}=a$c(t);if(t$6(a)||"web-style"===a.type||"cim"===a.type)return 0;const n=a.symbolLayers.getItemAt(0);if(!n)return 0;switch(n.type){case"icon":{const{computeIconLayerResourceSize:e}=await import('./symbolLayerUtils-92e8379f.js');return n.size||Math.min(Q$1.icon,(await e(n,Q$1.icon))[0])||Q$1.icon}case"text":return n.size||Q$1.text;case"line":return n.size||Q$1.line;case"object":{const{computeObjectLayerResourceSize:t}=await import('./symbolLayerUtils-92e8379f.js');return j$3(await t(n,e.scale/Q$1.viewScaleSizeFactor),i)}case"path":return (null!=n.width?n.width:n.height)||e.scale/Q$1.viewScaleSizeFactor;case"extrude":return n.size||e.scale/Q$1.viewScaleSizeFactor;default:return 0}}function V$3(e,t){const r=e.field,i=e.axis,a=t.fields&&t.fields.filter((e=>e.name===r)),n=a&&1===a.length?a[0].type:"double",s={updating:!1,initial:0,current:0},o=m$a[e.valueUnit];let l;return l="area"===e.valueRepresentation?e=>(e*o/2)**2*Math.PI:"radius"===e.valueRepresentation||"distance"===e.valueRepresentation?e=>e*o/2:e=>e*o,{field:r,getDefault:async(e,t)=>U$1(l(await I$1(t,e,i)),n),getValue:(e,t)=>(s.initial||(s.initial=t.pixelSizeAt(t.center)),s.current=s.initial*e,U$1(s.current,n)),initValue:e=>{s.initial=null!=e?e:s.current,s.current=0;},isUpdatingInteractively:!1}}function U$1(e,t){switch(t){case"small-integer":case"integer":case"long":return Math.round(e);case"double":case"single":return e;default:return 0}}function z$1(e){switch(e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":return !0;default:return !1}}async function F$1(e){const r=await f$4(e,{useSourceLayer:!0,ignoreGraphicSymbol:!0}),i=m$9(e.symbol,r);r$7(i)&&(e.symbol=r);}function L$1(e){if("mesh"===e||"multipatch"===e)throw new Error("Mesh and Multipatch not supported");return e}async function x$1(e,t,r){await M$3(e,t);const i=e.on("create",(async i=>{if("cancel"===i.state)return M$3(e,t);if("complete"===i.state){const e=i.graphic;e.sourceLayer||(e.sourceLayer=t.layer),e.attributes||(e.attributes={...t.template.prototype.attributes}),await F$1(e),r(e);}}));return {remove:()=>{i.remove(),e.cancel();}}}async function M$3(e,t){const r=t.layer,i={...t.template.prototype.attributes};await R(e,r,i);const a={graphicProperties:{attributes:i,sourceLayer:r},hasZ:r.capabilities.data.supportsZ};return e.layer.elevationInfo=r.elevationInfo,e.create(L$1(r.geometryType),a)}async function R(t,i,a){var n;if("3d"!==t.view.type)return;const s=new h$4({sourceLayer:i,attributes:a}),{rotation:o,size:l}=v$2(s);let c=await f$4(s,{useSourceLayer:!0}),u=!1;for(const e of [l,o]){if(t$6(e))continue;null==a[e.field]&&(a[e.field]=await e.getDefault(c,t.view),u=!0);}switch(u&&(c=await f$4(s,{useSourceLayer:!0})),null==(n=c)?void 0:n.type){case"simple-fill":case"polygon-3d":t.polygonSymbol=c;break;case"simple-line":case"line-3d":t.polylineSymbol=c;break;case"simple-marker":case"point-3d":t.pointSymbol=c;}}function T$2(e,t){return e&&e.find((e=>e.layer===t))}async function E$1(e,t,r,i){if(0===e.length)return [];const{updatable:s,graphicsByLayer:o}=await r.async((async()=>{const{results:n}=await P$1(t$7(t,r),i),s=new Map,o=({layer:e})=>{const t=s.get(e);if(!t){const t=new Array;return s.set(e,t),t}return t};n.forEach((({graphic:e})=>o(e).push(e)));const l=e.filter((({supports:e,layer:t})=>e.indexOf("update")>-1&&s.has(t)));return 0!==l.length&&r.stopPropagation(),{updatable:l,graphicsByLayer:s}}));return P$1(T$3(s.map((async({layer:e})=>{const{objectIdField:t,displayField:r}=e,a=[t];e.fieldsIndex.has(r)&&a.push(r);const n=o.get(e);if(!!n.some((e=>a.some((t=>!(t in e.attributes)))))){const t=e.createQuery();return t.outFields=a,t.returnGeometry=!1,t.objectIds=n.map((e=>e.getObjectId())),e.queryFeatures(t,{signal:i}).then((({features:e})=>e))}return n}))),i)}async function k(e,t,r,i){if(0===e.length)return [];const s=await r.async((async()=>{const{results:n}=await P$1(t.hitTest(r),i);if(0===n.length)return [];const s=new Set;n.forEach((({graphic:e})=>s.add(e.layer)));const o=e.items.filter((({layer:e,supports:t})=>t.indexOf("update")>-1&&s.has(e)));return o.length>0&&r.stopPropagation(),o}));return P$1(T$3(s.map((({layer:e})=>{const{objectIdField:a,displayField:n}=e,s=[a];e.fieldsIndex.has(n)&&s.push(n);const o=e.createQuery();o.outFields=s,o.returnGeometry=!1;const l="renderer"in e?s$c({renderer:e.renderer,event:r}):0;return o.geometry=a$d(r.mapPoint,l,t),o.outSpatialReference=t.spatialReference,e.queryFeatures(o,{signal:i}).then((({features:e})=>e))}))),i)}async function A(e,t,r,i){switch(t.type){case"3d":return E$1(e,t,r,i);case"2d":return k(e,t,r,i)}}async function G(e,t,r){const i=e.layer,a=i.createQuery();return a.objectIds=[e.getAttribute(i.objectIdField)],a.outFields=["*"],a.outSpatialReference=t.spatialReference,a.returnM=i.capabilities.data.supportsM,a.returnZ=i.capabilities.data.supportsZ,(await i.queryFeatures(a,{signal:r})).features[0]}async function P(e,i,a,n){let s=!1;const{rotation:o,size:l}=n;[o,l].forEach((async a=>{if(t$6(a))return;const n=i.attributes[a.field];if(r$7(n))a.initValue(n);else {const t=await a.getDefault(i.symbol,e.view);a.initValue(t),i.setAttribute(a.field,t),s=!0;}})),s&&"3d"===e.view.type&&await F$1(i);const c={multipleSelectionEnabled:!1};return "point"===a.geometryType&&(c.enableRotation=r$7(o),c.enableScaling=r$7(l)),e.layer.elevationInfo=a.elevationInfo,e.update(i,c)}function q$2(e){return !e||"rotate-start"!==e.type&&"rotate"!==e.type&&"rotate-stop"!==e.type?null:e}function D(e){return !e||"scale-start"!==e.type&&"scale"!==e.type&&"scale-stop"!==e.type?null:e}async function O(e,r,i,a){var n;if(!r$7(r.geometry)||"point"!==(null==(n=r.geometry)?void 0:n.type))return;const s=a.rotation,o=q$2(i.toolEventInfo);if(r$7(s)&&r$7(o))if("rotate-stop"===o.type)s.isUpdatingInteractively=!1,s.initValue();else {s.isUpdatingInteractively=!0;const{field:t,getValue:i}=s;r.attributes[t]=i(o.angle,e);}const l=a.size,c=D(i.toolEventInfo);if(r$7(l)&&r$7(c))if("scale-stop"===c.type)l.isUpdatingInteractively=!1,l.initValue();else {l.isUpdatingInteractively=!0;const{field:t,getValue:i}=l;r.attributes[t]=i(c.xScale,e);}"3d"===e.type&&await F$1(r);}async function Z$1(e,a,n,s,c){const u=e.clone();await F$1(u),s.map.add(n.layer),n.layer.add(u);const p=e.sourceLayer,y=s.whenLayerView(p),f=()=>{const t=e.layer,r=e.attributes[t.objectIdField];return y.then((e=>e.setVisibility(r,!1)),(()=>{})),{remove(){y.then((e=>e.setVisibility(r,!0)),(()=>{}));}}};let d=null,m=null;if("3d"===s.type){const e=new e$7({graphic:u});d=s.trackGraphicState(e),i$a(e,"displaying",(e=>{m=e?f():s$b(m);}));}else m=f();await P(n,u,p,a);let h=null;y.then((e=>h=e),(()=>{}));const b=a.size,w=a.rotation,v=e.watch("attributes",(async e=>{let i=!1;for(const a in e){const n=e[a];n!==u.attributes[a]&&(u.setAttribute(a,n),r$7(b)&&!b.isUpdatingInteractively&&b.field===a&&b.initValue(n),r$7(w)&&!w.isUpdatingInteractively&&w.field===a&&w.initValue(n),(t$6(h)||h.requiredFields.includes(a))&&(i=!0));}i&&"3d"===s.type&&await F$1(u);})),S=n.on("update",(async e=>{const t=e.graphics[0];if("complete"===e.state)return P(n,t,p,a);await O(s,t,e,a),c(t.clone());})),j=n.on(["undo","redo"],(async e=>{c(e.graphics[0].clone());})),I=()=>{};return {interactive:{remove(){j.remove(),S.remove(),n.cancel(),v&&v.remove(),this.remove=I;}},visual:{remove(){s$b(m),s.whenLayerView(p).then((e=>g$3(e,"updating"))).then((()=>{s$b(d),n.layer.remove(u),this.remove=I;}));}}}}const Q$1={icon:e$c(24),text:e$c(12),line:e$c(1),viewScaleSizeFactor:100};function B$1(e,t,r){let i=!1;return e.filter((e=>!!i||(i=e===t,i))).map((e=>r[e]()))}function C$3(e){if(1!==e.length)return null;const t=e[0];if("items"in t){const e=t;return 1===e.items.length?e.items[0]:null}return t}function H$1(e,r){if(e.viewModel.refreshCreationTemplates(),"awaiting-feature-creation-info"===r[0].id){const i=C$3(e.viewModel.featureTemplatesViewModel.items);r$7(i)&&(e.creationInfo={layer:i.layer,template:i.template},r.shift());}return r}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var b$3;let M$2=b$3=class extends a$6{constructor(e){super(e),this.type="batch-create",this.createFeatureState="create-new",this.featureFormHandle=null,this.visualVariableAttributes={rotation:null,size:null},this.highlightHandles=new Map,this.preventDefaultActionOnCancel=!1;}get numPendingFeatures(){return this.data.viewModel.sketchViewModel.layer.graphics.length}get pendingFeatures(){return this.data.viewModel.sketchViewModel.layer.graphics}async updatePendingFeature(e){return this.preventDefaultActionOnCancel=!0,this.data.viewModel.sketchViewModel.cancel(),C$5(this.lastActiveGraphics,e),this.startUpdating(e)}static create(e,t,a,i){const r=new b$3({data:new t$2({creationInfo:t,viewModel:e}),onCommit:async e=>{await i(e.creationInfo.layer,{addFeatures:e.viewModel.sketchViewModel.layer.graphics.toArray()});}});return r._set("steps",this._createWorkflowSteps(r,a)),r}highlight(e){const t=this.data.viewModel.view;"3d"===t.type&&this.highlightHandles.set(e,t.highlight(e));}removeHighlight(e){s$b(this.highlightHandles.get(e)),this.highlightHandles.delete(e);}async startCreating(){return this.createFeatureState="create-new",M$3(this.data.viewModel.sketchViewModel,this.data.creationInfo)}async startUpdating(e){var t;const i=this.data.viewModel,r=i.sketchViewModel,s=this.data.creationInfo.layer;return i.featureFormViewModel.set({feature:e,fieldConfig:null==(t=T$2(i.layerInfos,s))?void 0:t.fieldConfig}),s$b(this.featureFormHandle),this.featureFormHandle=i.featureFormViewModel.on("value-change",(async()=>{e.attributes=i.featureFormViewModel.getValues(),"3d"===r.view.type&&await F$1(e);})),this.removeHighlight(e),this.createFeatureState="update-pending",this.visualVariableAttributes=v$2(e),P(r,e,s,this.visualVariableAttributes)}static _createWorkflowSteps(e,l="awaiting-feature-creation-info"){const{data:u,handles:d}=e;let h=null,p=!0;const f=B$1(["awaiting-feature-creation-info","batch-creating-features"],l,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){u.creationInfo=null,d.add(u.viewModel.featureTemplatesViewModel.on("select",(({item:e})=>{u.creationInfo={layer:e.layer,template:e.template},u.viewModel.activeWorkflow.next();})),this.id);},async tearDown(){d.remove(this.id);}}),"batch-creating-features":()=>({id:"batch-creating-features",async setUp(){const l=u.viewModel.view,f=u.viewModel.sketchViewModel;p=f.updateOnGraphicClick,f.updateOnGraphicClick=!1,e.lastActiveGraphics=[],e.featureFormHandle=s$b(e.featureFormHandle),e.visualVariableAttributes={rotation:null,size:null};const v=f.on("create",(async t=>{if("cancel"===t.state){if(e.preventDefaultActionOnCancel)return void(e.preventDefaultActionOnCancel=!1);if(e.lastActiveGraphics.length<1)return e.startCreating();const t=e.lastActiveGraphics.pop();return e.startUpdating(t)}if("complete"===t.state)return e.startUpdating(t.graphic)})),g=f.on("update",(async t=>{const a=t.graphics[0];if("complete"===t.state)return a!==h&&(e.lastActiveGraphics.push(a),e.highlight(a)),h=null,t.aborted&&e.preventDefaultActionOnCancel?void(e.preventDefaultActionOnCancel=!1):e.startCreating();"start"===t.state&&e.removeHighlight(a),await O(l,a,t,e.visualVariableAttributes);const r=a.attributes;if(r$7(e.visualVariableAttributes.rotation)){const{field:t}=e.visualVariableAttributes.rotation;u.viewModel.featureFormViewModel.setValue(t,r[t]);}if(r$7(e.visualVariableAttributes.size)){const{field:t}=e.visualVariableAttributes.size;u.viewModel.featureFormViewModel.setValue(t,r[t]);}})),w=f.on("delete",(async a=>{const i=a.graphics[0];C$5(e.lastActiveGraphics,i),h=i;}));let m=null;const b=i$c((()=>{var e;const t=f.snappingOptions.featureSources.find((e=>e.layer===u.creationInfo.layer));return {hasFeatureLayerSource:!!t,enabled:null!=(e=null==t?void 0:t.enabled)&&e}}),(({hasFeatureLayerSource:e,enabled:t})=>{const a=f.snappingOptions.featureSources;e?(t$6(m)&&(m=new p$c({layer:f.layer,enabled:t}),a.add(m)),m.enabled=t):(r$7(m)&&a.remove(m),m=l$b(m));}),p$e),M=l.on("immediate-click",(async t=>{const a=await l.hitTest(t,{include:f.layer});if(a.results.length>0){const t=a.results[0].graphic;if("transform"===f.activeTool||"reshape"===f.activeTool){if(f.updateGraphics.getItemAt(0)===t)return;await e.updatePendingFeature(t);}}}));await e.startCreating();const V={remove:()=>{s$b(e.featureFormHandle),v.remove(),g.remove(),w.remove(),b.remove(),r$7(m)&&f.snappingOptions.featureSources.remove(m),m=l$b(m),f.cancel(),M.remove();}};d.add(V,this.id);},async tearDown(e){e.cancelled&&u.viewModel.sketchViewModel.layer.removeAll(),d.remove(this.id),u.viewModel.sketchViewModel.updateOnGraphicClick=p;}})});return H$1(u,f)}};M$2=b$3=e$9([i$8("esri.widgets.Editor.BatchCreateWorkflow")],M$2);const V$2=M$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let e$6=class extends p$d{constructor(o){super(o),this.creationInfo=null,this.edits=null,this.viewModel=null;}};e$9([d$6()],e$6.prototype,"creationInfo",void 0),e$9([d$6()],e$6.prototype,"edits",void 0),e$9([d$6()],e$6.prototype,"viewModel",void 0),e$6=e$9([i$8("esri.widgets.Editor.CreateWorkflowData")],e$6);const c$5=e$6;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function a$5(t){return t$6(t)?null:JSON.stringify(t)}let u$3=class extends(a$a(p$d)){constructor(t){super(t),this._baselineAttributesJSON=null,this._baselineGeometryJSON=null,this.feature=null;}get attributesModified(){const{_baselineAttributesJSON:t,feature:e}=this;return !(!e||t===a$5(e.attributes))}get geometryModified(){const{_baselineGeometryJSON:t,feature:e}=this;return !(!e||t===a$5(e.geometry))}get modified(){return this.attributesModified||this.geometryModified}trackChanges(){this.feature&&(this._baselineAttributesJSON=a$5(this.feature.attributes),this._baselineGeometryJSON=a$5(this.feature.geometry),this.notifyChange("attributesModified"),this.notifyChange("geometryModified"));}updateAttributes(t){this.feature.attributes=t,this.notifyChange("attributesModified");}updateGeometry(t){this.feature.geometry=t,this.notifyChange("geometryModified");}};e$9([d$6()],u$3.prototype,"attributesModified",null),e$9([d$6()],u$3.prototype,"feature",void 0),e$9([d$6()],u$3.prototype,"geometryModified",null),e$9([d$6()],u$3.prototype,"modified",null),u$3=e$9([i$8("esri.widgets.Editor.Edits")],u$3);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var m$4;let p$2=m$4=class extends a$6{constructor(e){super(e),this.type="create";}static create(e,t,a){const r=new m$4({data:new c$5({edits:new u$3,viewModel:e}),onCommit:async e=>{await a(e.creationInfo.layer,{addFeatures:[e.edits.feature]});}});return r._set("steps",this._createWorkflowSteps(r,t)),r}static _createWorkflowSteps(e,a="awaiting-feature-creation-info"){const{data:o,handles:i}=e,r=B$1(["awaiting-feature-creation-info","awaiting-feature-to-create","editing-new-feature"],a,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){o.creationInfo=null,o.edits.feature=null,o.viewModel.featureTemplatesViewModel.select(null),i.add(o.viewModel.featureTemplatesViewModel.on("select",(({item:e})=>{o.creationInfo={layer:e.layer,template:e.template},o.viewModel.activeWorkflow.next();})),this.id);},async tearDown(){i.remove(this.id);}}),"awaiting-feature-to-create":()=>({id:"awaiting-feature-to-create",async setUp(){i.add(await x$1(o.viewModel.sketchViewModel,o.creationInfo,(e=>{o.edits.feature=e,o.viewModel.activeWorkflow.next();})),this.id);},async tearDown(){i.remove(this.id);}}),"editing-new-feature":()=>({id:"editing-new-feature",async setUp(){var e;const a=o.edits.feature,r=a.sourceLayer,s=o.viewModel,n=s.sketchViewModel;s.featureFormViewModel.set({feature:a,fieldConfig:null==(e=T$2(s.layerInfos,r))?void 0:e.fieldConfig}),n.allowDeleteKey=!1;const l=v$2(a);await P(n,a,r,l);const m=n.on("update",(async e=>{const a=e.graphics[0];if("complete"===e.state)return P(n,a,r,l);await O(n.view,a,e,l);const o=a.attributes;if(r$7(l.rotation)){const{field:e}=l.rotation;s.featureFormViewModel.setValue(e,o[e]);}if(r$7(l.size)){const{field:e}=l.size;s.featureFormViewModel.setValue(e,o[e]);}}));i.add([o.viewModel.featureFormViewModel.on("value-change",(async()=>{o.edits.updateAttributes(o.viewModel.featureFormViewModel.getValues()),a.attributes=o.edits.feature.attributes,"3d"===n.view.type&&await F$1(a);})),m],this.id);},async tearDown(e){e.cancelled&&o.viewModel.sketchViewModel.layer.removeAll(),i.remove(this.id);}})});return H$1(o,r)}};p$2=m$4=e$9([i$8("esri.widgets.Editor.CreateWorkflow")],p$2);const v$1=p$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$5=class extends p$d{constructor(o){super(o),this.candidates=null,this.editableItem=null,this.edits=null,this.viewModel=null;}};e$9([d$6()],s$5.prototype,"candidates",void 0),e$9([d$6()],s$5.prototype,"editableItem",void 0),e$9([d$6()],s$5.prototype,"edits",void 0),e$9([d$6()],s$5.prototype,"viewModel",void 0),s$5=e$9([i$8("esri.widgets.Editor.UpdateWorkflowData")],s$5);const i$7=s$5;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var y;const b$2="candidate-highlight";let M$1=y=class extends a$6{constructor(e){super(e),this.type="update";}static create(e,t,i){const a=new y({data:new i$7({edits:new u$3,viewModel:e}),onCommit:async e=>{const t=e.edits.feature,a=t.sourceLayer,s=t.clone();if(!e.edits.attributesModified){const{objectIdField:e}=a;s.attributes={[e]:t.getAttribute(e)};}e.edits.geometryModified||(s.geometry=null),await i(a,{updateFeatures:[s]});}});return a._set("steps",this._createWorkflowSteps(a,t)),a}highlight(e){const{data:{viewModel:{view:t}}}=this,i=e&&t.allLayerViews.items.find((({layer:t})=>t===e.layer));e$d(i)&&this.handles.add(i.highlight(e),b$2);}unhighlight(){this.handles.remove(b$2);}static _createWorkflowSteps(e,n="awaiting-feature-to-update"){const{data:l,handles:c}=e;return B$1(["awaiting-feature-to-update","awaiting-update-feature-candidate","editing-existing-feature","adding-attachment","editing-attachment"],n,{"awaiting-feature-to-update":()=>({id:"awaiting-feature-to-update",async setUp(){const{spinnerViewModel:e,view:t}=l.viewModel;let i=null;c.add({remove(){i&&(i.abort(),i=null);}},this.id),l.edits.feature=null;const r=t.on("immediate-click",(r=>{e.location=r.mapPoint,e.visible=!0,i&&i.abort();const{editableItems:d}=l.viewModel;i=new AbortController,new Promise(((e,o)=>{j$5(i.signal,(()=>o(m$b()))),e(A(d,t,r,i.signal));})).then((e=>{if(h$6(i),l.candidates=e.reduce(((e,t)=>t.error?e:[...e,...t.value]),[]),l.viewModel.spinnerViewModel.visible=1===l.candidates.length,0!==l.candidates.length)if(1===l.candidates.length){const e=l.candidates[0];l.edits.feature=e,l.viewModel.activeWorkflow.go("editing-existing-feature").catch((()=>{})).then((()=>l.viewModel.spinnerViewModel.visible=!1));}else l.viewModel.activeWorkflow.next();}));}));c.add(r,this.id);},async tearDown(){c.remove(this.id);}}),"awaiting-update-feature-candidate":()=>({id:"awaiting-update-feature-candidate",async setUp(){const{edits:t}=l;t.feature=null,c.add(f$5(t,"feature",(t=>{e.unhighlight(),e.highlight(t);})),this.id);},async tearDown(){e.unhighlight(),c.remove(this.id);}}),"editing-existing-feature":()=>({id:"editing-existing-feature",async setUp(){const a=l.edits.feature,s=l.viewModel;l.editableItem=s.editableItems.find((e=>e.layer===a.layer));const o=new AbortController;c.add({remove:()=>o.abort()},this.id);const d=s.view.whenLayerView(a.layer),n=G(a,s.view,o.signal),u=await d,m=await n;if(p$f(o))return;l.edits.updateGeometry(m.geometry),l.edits.updateAttributes(m.attributes),l.edits.trackChanges();const h=m.sourceLayer,w=T$2(s.layerInfos,h),y=w&&w.fieldConfig;s.attachmentsViewModel.set({graphic:m,mode:"view"}),s.featureFormViewModel.set({feature:m,fieldConfig:y});const b="createInteractiveEditSession"in u?u.createInteractiveEditSession(a):null,M=[s.featureFormViewModel.on("value-change",(e=>{l.edits.updateAttributes(s.featureFormViewModel.getValues()),m.attributes=l.edits.feature.attributes,b&&b.setAttribute(e.fieldName,e.value);})),s.attachmentsViewModel.watch("mode",(e=>{"add"===e&&l.viewModel.activeWorkflow.go("adding-attachment"),"edit"===e&&l.viewModel.activeWorkflow.go("editing-attachment");}))];b&&(M.push(n$7((()=>b.rollback()))),c.add(n$7((()=>b.commit())),e._handleKeys.afterCommit));const{supportsGeometryUpdate:V}=h.capabilities.editing;if(V){s.sketchViewModel.allowDeleteKey=!1;const t=v$2(m),{interactive:a,visual:o}=await Z$1(m,t,s.sketchViewModel,s.view,(({geometry:e,attributes:a})=>{if(r$7(t.rotation)){const{field:e}=t.rotation;s.featureFormViewModel.setValue(e,a[e]);}if(r$7(t.size)){const{field:e}=t.size;s.featureFormViewModel.setValue(e,a[e]);}l.edits.updateAttributes(a),l.edits.updateGeometry(e);}));M.push(a,o),c.add(a,e._handleKeys.beforeCommit),c.add(o,e._handleKeys.afterCommit);}else e.highlight(m);c.add(M,this.id);},async tearDown(){e.unhighlight(),c.remove(this.id);}}),"adding-attachment":()=>({id:"adding-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){}}),"editing-attachment":()=>({id:"editing-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){}})})}};M$1=y=e$9([i$8("esri.widgets.Editor.UpdateWorkflow")],M$1);const V$1=M$1;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function e$5(e){switch(e){case 0:break;case 1:return "not owned by a graphics layer";case 2:return "no geometry";case 3:return "the geometry type is not supported";case 4:return "the elevation mode is not supported";case 5:return "the symbol type is not supported"}return ""}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function r$1(t,n){return t$6(n)||!n.mode?t?"absolute-height":"on-the-ground":n.mode}function i$6(e,n){return r$1(!!r$7(e)&&e.hasZ,n)}function u$2(e){const t=l$2(e);return i$6(e.geometry,t)}function s$4(e){const r=l$2(e),u=i$6(e.geometry,r);return {mode:u,offset:r$7(r)&&"on-the-ground"!==u?c$b(r.offset,0)*r$8(c$b(r.unit,"meters")):0}}function a$4(e){if("on-the-ground"===u$2(e))return !1;const n=l$2(e),o=r$7(n)&&n.featureExpressionInfo?n.featureExpressionInfo.expression:null;return !(!o||"0"===o)}function l$2(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function c$4(o,r,i){if(t$6(i)||!i.mode)return;const u=o.hasZ?o.z:0,s=r$7(i.offset)?i.offset:0;switch(i.mode){case"absolute-height":return u-s;case"on-the-ground":return 0;case"relative-to-ground":return u-(c$b(r.elevationProvider.getElevation(o.x,o.y,o.z,o.spatialReference,"ground"),0)+s);case"relative-to-scene":return u-(c$b(r.elevationProvider.getElevation(o.x,o.y,o.z,o.spatialReference,"scene"),0)+s)}}function f$1(e,t,n,o=null){return g(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,n,o)}function v(e,t,n,o,r=null){return g(e,t[0],t[1],t.length>2?t[2]:0,n,o,r)}function g(n,o,r,i,u,s,a=null){if(t$6(s))return;const l=r$7(a)?a.mode:"absolute-height";if("on-the-ground"===l)return 0;return h$1(d$4(o,r,i,u,n,s),o,r,i,u,n,a,l)}function d$4(e,o,r,i,u,s){const a=r$7(s.offset)?s.offset:0;switch(s.mode){case"absolute-height":return r+a;case"on-the-ground":return c$b(u.elevationProvider.getElevation(e,o,0,i,"ground"),0);case"relative-to-ground":return r+c$b(u.elevationProvider.getElevation(e,o,r,i,"ground"),0)+a;case"relative-to-scene":return r+c$b(u.elevationProvider.getElevation(e,o,r,i,"scene"),0)+a}}function h$1(e,o,r,i,u,s,a,l){const c=r$7(a)&&r$7(a.offset)?a.offset:0;switch(l){case"absolute-height":return e-c;case"relative-to-ground":return e-(c$b(s.elevationProvider.getElevation(o,r,i,u,"ground"),0)+c);case"relative-to-scene":return e-(c$b(s.elevationProvider.getElevation(o,r,i,u,"scene"),0)+c)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function t$1(t){var n;if("graphics"!==(null==(n=t.layer)?void 0:n.type))return 1;if(t$6(t.geometry))return 2;switch(t.geometry.type){case"polygon":case"point":case"polyline":case"mesh":break;default:return 3}return "on-the-ground"!==u$2(t)&&a$4(t)?4:0}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var d$3;let h=d$3=class extends v$6{constructor(...e){super(...e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters";}normalizeCtorArgs(e,r){let t;if(e&&e.center)t=e;else {if(e&&e.rings)return super.normalizeCtorArgs(e,r);t={center:e};}return {...super.normalizeCtorArgs(),...t,...r}}initialize(){const e=this.center,s=this.numberOfPoints;if(this.hasZ=e&&e.hasZ,0!==this.rings.length||!e)return;const i=D$1(this.radius,this.radiusUnit,"meters"),o=e.spatialReference;let c,a="geographic";if(o.isWebMercator?a="webMercator":(null!=r$9[o.wkid]||o.wkt&&0===o.wkt.indexOf("PROJCS"))&&(a="projected"),this.geodesic){let r;switch(a){case"webMercator":r=j$6(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":r=e;}c=this._createGeodesicCircle(r,i,s),"webMercator"===a&&(c=R$1(c));}else {let r;"webMercator"===a||"projected"===a?r=i/this._convert2Meters(1,e.spatialReference):"geographic"===a&&(r=R$2(i,"meters",p$g(e.spatialReference).radius)),c=this._createPlanarCircle(e,r,s);}this.spatialReference=c.spatialReference,this.addRing(c.rings[0]);}clone(){const{center:e,numberOfPoints:r,radius:t,radiusUnit:s,geodesic:i}=this;return new d$3({center:e.clone(),numberOfPoints:r,radius:t,radiusUnit:s,geodesic:i})}_createGeodesicCircle(e,r,t){let s=0;const i=[];for(;s<360;){const o=[0,0],c=[e.x,e.y];y$2(o,c,s,r),this.hasZ&&o.push(e.z),i.push(o),s+=360/t;}return i.push(i[0]),new v$6(i)}_createPlanarCircle(e,r,t){const s=[],i=2*Math.PI/t;for(let o=0;o<t;++o){const t=i*o,c=[e.x+Math.cos(-t)*r,e.y+Math.sin(-t)*r];this.hasZ&&c.push(e.z),s.push(c);}return s.push(s[0]),new v$6({spatialReference:e.spatialReference,rings:[s]})}_convert2Meters(e,r){let t;if(null!=r$9[r.wkid])t=r$9.values[r$9[r.wkid]];else {const e=r.wkt,s=e.lastIndexOf(",")+1,i=e.lastIndexOf("]]");t=parseFloat(e.substring(s,i));}return e*t}};e$9([d$6({type:b$7})],h.prototype,"center",void 0),e$9([d$6()],h.prototype,"geodesic",void 0),e$9([d$6()],h.prototype,"numberOfPoints",void 0),e$9([d$6()],h.prototype,"radius",void 0),e$9([d$6()],h.prototype,"radiusUnit",void 0),h=d$3=e$9([i$8("esri.geometry.Circle")],h);const m$3=h;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function n$1(e){return u$1(e).result}function l$1(e){return u$1(e).geometry}function u$1(n){var l;if("graphics"!==(null==(l=n.layer)?void 0:l.type))return {result:1,geometry:null};if(t$6(n.geometry))return {result:2,geometry:null};return "on-the-ground"!==u$2(n)&&a$4(n)?{result:4,geometry:null}:"point"!==n.geometry.type&&"polyline"!==n.geometry.type&&("polygon"!==n.geometry.type||n.geometry instanceof m$3)?{result:3,geometry:null}:{result:0,geometry:n.geometry}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function s$3(s){var n;if("graphics"!==(null==(n=s.layer)?void 0:n.type))return 1;if(t$6(s.geometry))return 2;switch(s.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return 0;default:return 3}const i=r$7(s.symbol)&&"point-3d"===s.symbol.type&&s.symbol.symbolLayers;if(!(i&&i.length>0&&i.some((e=>"object"===e.type))))return 5;return "on-the-ground"!==u$2(s)&&a$4(s)?4:0}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function r(r,e,n){if(!e||!r||!r.map)return;const{map:a}=r,d=a.layers.find((r=>r===e));d||a.add(e,n),null!=n&&a.layers.reorder(d,n);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const e$4={redo:"r",undo:"z",center:"Alt",constraint:"Shift",snappingToggle:"Control",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function c$3(e,r){const t=e.x-r.x,o=e.y-r.y;return t*t+o*o}function i$5(e,r){const t=e.length===r.length&&e[0]===r[0]&&e[1]===r[1];switch(e.length){case 2:return t;case 3:return t&&e[2]===r[2];case 4:return t&&e[3]===r[3]}return !1}function a$3(r,t,o,n){return "2d"===n.type?n.toScreen(t.vectorToPoint(r,m$2)):(f(r,t,o,n,u),n.state.camera.projectToScreen(u,d$2),c$c(d$2[0],d$2[1]))}function f(e,r,t,n,c=n$8()){const i=r.toXYZ(e);return i[2]=v(n,i,r.spatialReference,t)||0,n.renderCoordsHelper.toRenderCoords(i,r.spatialReference,c),c}function l(e,r,t,o,n,c,i){const a=t.toXYZ(e),f=t.toXYZ(r),l=v(n,a,t.spatialReference,o),p=v(n,f,t.spatialReference,o),u=(null==l?p:null==p?l:Math.min(l,p))||0;a[2]=u,f[2]=u,n.renderCoordsHelper.toRenderCoords(a,t.spatialReference,c),n.renderCoordsHelper.toRenderCoords(f,t.spatialReference,i);}function p$1(e,r){r.sort(((r,o)=>q$3(r.targetPoint,e)-q$3(o.targetPoint,e)));}const u=n$8(),d$2=i$d(),m$2=new b$7;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class j$2{constructor(t){this.coordinateHelper=t;}}class m$1 extends j$2{constructor(t,s){super(t),this.point=s;}objectEqual(t){return t instanceof m$1&&i$5(this.point,t.point)}check(s){return q$3(s,this.point)<p$b.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}intersect(t){const s=[];return t instanceof b$1?s.push(...l$c({start:t.start,end:t.end,type:t instanceof E?1:0},this.point)):t instanceof T$1&&s.push(...k$1(t.center,t.radius,this.point)),s.map((s=>new H(this.coordinateHelper,s,this,t)))}}class b$1 extends j$2{constructor(t,s,e){super(t),this.start=s,this.end=e;}objectEqual(t){return t instanceof b$1&&(i$5(this.start,t.start)&&i$5(this.end,t.end))}intersect(t){const s=[];return t instanceof m$1?s.push(...l$c({start:this.start,end:this.end,type:this instanceof E?1:0},t.point)):t instanceof b$1?s.push(...M$4({start:this.start,end:this.end,type:this instanceof E?1:0},{start:t.start,end:t.end,type:t instanceof E?1:0})):t instanceof T$1&&s.push(...q$4({start:this.start,end:this.end,type:this instanceof E?1:0},t.center,t.radius)),s.map((s=>new H(this.coordinateHelper,s,this,t)))}}class q$1 extends b$1{constructor(t,s,e){super(t,s,e),this.dir=n$9(),this.p=n$9();}objectEqual(t){return t instanceof q$1&&super.objectEqual(t)}check(t){return o$4(this.dir,this.end,this.start),o$4(this.p,t,this.start),j$7(this.dir,this.p)>=0&&m$c(t,this.start,this.end)<p$b.pointOnLineThreshold}closestTo(t){const s=this.coordinateHelper.clone(t);return b$8(s,t,this.start,this.end),s}}class E extends b$1{constructor(t,s,e){super(t,s,e);}objectEqual(t){return t instanceof E&&super.objectEqual(t)}check(t){return m$c(t,this.start,this.end)<p$b.pointOnLineThreshold}closestTo(t){const s=this.coordinateHelper.clone(t);return d$7(s,t,this.start,this.end),s}}class H extends j$2{constructor(t,s,e,n){super(t),this.intersection=s,this.first=e,this.second=n;}objectEqual(t){return t instanceof H&&(this.first.objectEqual(t.first)&&this.second.objectEqual(t.second))}check(){return !1}closestTo(t){const s=this.coordinateHelper.clone(t);return a$e(s,this.intersection),s}intersect(){return []}}class T$1 extends j$2{constructor(t,s,e){super(t),this.center=s,this.radius=e;}objectEqual(t){return t instanceof T$1&&(this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius)}check(){return !1}closestTo(t){const s=this.coordinateHelper.clone(t);return j$8(s,t,this.center,this.radius),s}intersect(t){const s=[];return t instanceof b$1?s.push(...q$4({start:t.start,end:t.end,type:t instanceof E?1:0},this.center,this.radius)):t instanceof m$1&&s.push(...k$1(this.center,this.radius,t.point)),s.map((s=>new H(this.coordinateHelper,s,this,t)))}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class t{constructor(t,o,r){this.coordinateHelper=t,this.targetPoint=o,this.constraint=r;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class e$3 extends t{constructor({coordinateHelper:t,targetPoint:e,objectId:o,constraint:r}){super(t,e,r),this.objectId=o;}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class s$2{}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
s$7.getLogger("esri.views.interactive.snapping.hints.LineSnappingHint");class s$1 extends s$2{constructor(t,i,e,s=!0,n=!0){super(),this.type=t,this.lineStart=i,this.lineEnd=e,this.fadeLeft=s,this.fadeRight=n;}equals(t){return t instanceof s$1&&(this.type===t.type&&i$5(this.lineStart,t.lineStart)&&i$5(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class e$2 extends e$3{constructor(n){super({...n,constraint:new E(n.coordinateHelper,n.edgeStart,n.edgeEnd)});}get hints(){return [new s$1(1,this.constraint.start,this.constraint.end)]}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
s$7.getLogger("esri.views.interactive.snapping.hints.RightAngleSnappingHint");class i$4 extends s$2{constructor(e,t,r){super(),this.previousVertex=e,this.centerVertex=t,this.nextVertex=r;}equals(e){return e instanceof i$4&&(i$5(this.previousVertex,e.previousVertex)&&i$5(this.centerVertex,e.centerVertex)&&i$5(this.nextVertex,e.nextVertex))}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class i$3 extends t{constructor({coordinateHelper:t,targetPoint:e,constraint:r,previousVertex:i,otherVertex:o,otherVertexType:s,objectId:n}){super(t,e,r),this.previousVertex=i,this.otherVertex=o,this.otherVertexType=s,this.objectId=n;}get hints(){const t=this.previousVertex,i=1===this.otherVertexType?this.otherVertex:this.targetPoint,o=1===this.otherVertexType?this.targetPoint:this.otherVertex;return [new s$1(0,i,o),new s$1(1,t,i),new i$4(this.previousVertex,i,o)]}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let w$1=class extends d$8{constructor(e){super(e),this.sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null}};}get updating(){return n$a(this.snappingSources,(({snappingSource:e})=>e.updating))||this.updatingHandles.updating}get snappingSources(){var e;const t=this._get("snappingSources")||new Map,r=new Map;if(null!=(e=this.options)&&e.featureSources)for(const o of this.options.featureSources.items){const e=o.layer.uid,i=t.get(e);if(i){t.delete(e),r.set(e,i);continue}if(!o.layer.loaded){this.updatingHandles.addPromise(o.layer.load());continue}const a=this.createSourceInfo(o);r$7(a)&&r.set(e,a);}for(const[,o]of t)o.destroy();return r}initialize(){this.updatingHandles.add(this,"snappingSources",(()=>{this.notifyChange("updating");}),1),r$7(this.view)&&this.handles.add([this.view.on("layerview-create",(e=>this.updateLayerView(e.layer,e.layerView))),this.view.on("layerview-destroy",(e=>this.updateLayerView(e.layer,null)))]);}updateLayerView(e,t){for(const[,r]of this.snappingSources)r.snappingSource.layerSource.layer===e&&(r.layerView=t);}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy();}async fetchCandidates(e,t,r){if(!this.options.effectiveFeatureEnabled)return [];const o=[],i=this.computeScreeenSizeDistanceParameters(e,t),a={distance:i,point:e,coordinateHelper:t.coordinateHelper,types:this.types,filter:null};for(const[,{snappingSource:s,layerView:c}]of this.snappingSources)!s.layerSource.enabled||r$7(c)&&c.suspended||o.push(s.fetchCandidates(a,r).then((e=>e.filter((e=>!this.candidateIsExcluded(s,e,t.excludeFeature))))));const u=(await E$5(o)).flat();return this.addRightAngleCandidates(u,e,i,t),h$6(r),p$1(e,u),u}addRightAngleCandidates(e,t,r,o){var a,s,c,u,l,d,p,h;const g=r$7(o.vertexHandle)?null==(a=o.vertexHandle.rightEdge)||null==(s=a.rightVertex)?void 0:s.pos:r$7(o.editGeometryOperations)&&"polygon"===o.editGeometryOperations.data.type?null==(c=e$e(null==(u=o.editGeometryOperations.data.components[0])?void 0:u.getFirstVertex()))?void 0:c.pos:null,y=r$7(o.vertexHandle)?null==(l=o.vertexHandle.leftEdge)||null==(d=l.leftVertex)?void 0:d.pos:r$7(o.editGeometryOperations)?null==(p=e$e(null==(h=o.editGeometryOperations.data.components[0])?void 0:h.getLastVertex()))?void 0:p.pos:null,f=e.length;for(let n=0;n<f;n++)this.addRightAngleCandidate(e[n],y,t,r,o,e),this.addRightAngleCandidate(e[n],g,t,r,o,e);}addRightAngleCandidate(e,t,r,o,n,i){if(t$6(t)||!(e instanceof e$2))return;const s=e.constraint.closestTo(t),c=(s[0]-r[0])/o.x,u=(s[1]-r[1])/o.y;if(c*c+u*u<=1){const r=n.coordinateHelper;i.push(new i$3({coordinateHelper:r,targetPoint:s,otherVertex:t,otherVertexType:0,previousVertex:e.constraint.start,constraint:new q$1(r,t,s),objectId:e.objectId}));}}computeScreeenSizeDistanceParameters(e,t){const r=this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1);return t$6(this.view)?{x:r,y:r}:"2d"===this.view.type?{x:r*this.view.resolution,y:r*this.view.resolution}:this.computeScreeenSizeDistanceParameters3D(e,r,this.view,t)}computeScreeenSizeDistanceParameters3D(e,t,r,o){const{coordinateHelper:n,elevationInfo:i}=o,a=r.state.camera.computeScreenPixelSizeAt(f(e,n,i,r,x))*r.renderCoordsHelper.unitInMeters/r.mapCoordsHelper.unitInMeters,s=t*a;return {x:s/this.computeScreenMagnitudeOfMapOffset(e,a,0,r,o),y:s/this.computeScreenMagnitudeOfMapOffset(e,0,a,r,o)}}computeScreenMagnitudeOfMapOffset(e,t,r,o,{coordinateHelper:n,elevationInfo:i}){const a=n.clone(e);a[0]+=t,a[1]+=r;const s=a$3(e,n,i,o),c=a$3(a,n,i,o),u=c.x-s.x,l=c.y-s.y;return Math.sqrt(u*u+l*l)}get types(){return 3}candidateIsExcluded(e,t,r){if(t$6(r))return !1;const o=this.getCandidateObjectId(t);if(t$6(o))return !1;const n=e.layerSource.layer;return "graphics"===n.type?r.uid===o:r.sourceLayer===n&&(!(!r.attributes||!("objectIdField"in n))&&r.attributes[n.objectIdField]===o)}getCandidateObjectId(e){return e instanceof e$3?e.objectId:null}createSourceInfo(e){const t=this.createFeatureSnappingSourceType(e);if(t$6(t))return null;if("loading"in t)return this.updatingHandles.addPromise(t.loading.then((()=>{this.destroyed||this.notifyChange("snappingSources");}))),null;const r=r$7(this.view)?this.view.allLayerViews.find((t=>t.layer===e.layer)):null;return new j$1(t.source,r)}createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"subtype-group":case"wfs":return this.createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this.createFeatureSnappingSourceGraphicsLayer(e)}return null}createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source.type){case"feature-layer":{const t=this.getSourceModule("featureService");return r$7(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}case"memory":case"csv":case"geojson":case"wfs":{if("mesh"===e.layer.geometryType)return null;const t=this.getSourceModule("featureCollection");return r$7(t.module)?{source:new t.module.FeatureCollectionSnappingSource({layerSource:e})}:{loading:t.loader}}}return null}createFeatureSnappingSourceGraphicsLayer(e){const t=this.getSourceModule("graphics");return r$7(t.module)?{source:new t.module.GraphicsSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}getSourceModule(e){const t=this.sourceModules[e];if(t$6(t.loader)){const r=this.loadSourceModule(e).then((e=>{t.module=e;}));return t.loader=r,{module:t.module,loader:r}}return {module:t.module,loader:t.loader}}loadSourceModule(e){switch(e){case"featureService":return this.updatingHandles.addPromise(import('./FeatureServiceSnappingSource-fcedb536.js'));case"featureCollection":return this.updatingHandles.addPromise(import('./FeatureCollectionSnappingSource-4a524535.js'));case"graphics":return this.updatingHandles.addPromise(import('./GraphicsSnappingSource-a7e30b8d.js'))}return null}};e$9([d$6({constructOnly:!0})],w$1.prototype,"spatialReference",void 0),e$9([d$6({constructOnly:!0})],w$1.prototype,"view",void 0),e$9([d$6()],w$1.prototype,"options",void 0),e$9([d$6({readOnly:!0})],w$1.prototype,"updating",null),e$9([d$6({readOnly:!0})],w$1.prototype,"snappingSources",null),w$1=e$9([i$8("esri.views.interactive.snapping.FeatureSnappingEngine")],w$1);class j$1{constructor(e,t){this.snappingSource=e,this.layerView=t,this.handles=new u$7;const o=this.snappingSource.layerSource.layer;if("refresh"in o){const t=o;this.handles.add(t.on("refresh",(()=>e.refresh())));}this.handles.add([i$a(e,"updating",(t=>e.layerSource.updating=t),!0),i$a(e,"availability",(t=>e.layerSource.availability=t),!0)]);}destroy(){this.snappingSource.destroy(),this.handles.destroy();}}const x=n$8();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class i$2{constructor(e,r){this.view=e,this.options=r,this.squaredShortLineThreshold=p$b.shortLineThreshold*p$b.shortLineThreshold;}snap(t,r){return r$7(r.vertexHandle)?"vertex"!==r.vertexHandle.type?[]:this.snapExistingVertex(t,r):this.snapNewVertex(t,r)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold(e.leftVertex.pos,e.rightVertex.pos,t)}exceedsShortLineThreshold(e,t,{elevationInfo:i,editGeometryOperations:o}){const h=o.data.coordinateHelper;return 0===this.squaredShortLineThreshold||c$3(a$3(t,h,i,this.view),a$3(e,h,i,this.view))>this.squaredShortLineThreshold}squaredProximityTreshold(e){return "touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,r=e*t;return r*r}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class o extends t{constructor({coordinateHelper:t,lineStart:n,lineEnd:e,targetPoint:s}){super(t,s,new E(t,n,e)),this.referenceLineHint=new s$1(2,n,e);}get hints(){return [this.referenceLineHint,new s$1(0,this.lineEndClosestToTarget(),this.targetPoint)]}lineEndClosestToTarget(){const e=this.constraint.start,i=this.constraint.end;return Math.sign(j$7(o$4(c$2,i,e),o$4(a$2,this.targetPoint,e)))>0?i:e}}const a$2=n$9(),c$2=n$9();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class d$1 extends i$2{snapNewVertex(e,t){const o=t.editGeometryOperations.data.components[0],s=o.edges.length,i=[];if(s<1)return i;const n=t.coordinateHelper,d=a$3(e,n,t.elevationInfo,this.view),p=o.edges[s-1];let a=p;do{this.edgeExceedsShortLineThreshold(a,t)&&this._processCandidateProposal(a.leftVertex.pos,a.rightVertex.pos,e,d,t,i),a=a.leftVertex.leftEdge;}while(a&&a!==p);return i}snapExistingVertex(t,o){const s=[],i=e$e(o.vertexHandle),n=i.component;if(n.edges.length<2)return s;const d=o.coordinateHelper,p=a$3(t,d,o.elevationInfo,this.view),a=i.leftEdge,h=i.rightEdge;a&&h&&this.edgeExceedsShortLineThreshold(a,o)&&this.edgeExceedsShortLineThreshold(h,o)&&this._processCandidateProposal(a.leftVertex.pos,h.rightVertex.pos,t,p,o,s);const l=n.edges[0];let g=l;do{g!==i.leftEdge&&g!==i.rightEdge&&this.edgeExceedsShortLineThreshold(g,o)&&this._processCandidateProposal(g.leftVertex.pos,g.rightVertex.pos,t,p,o,s),g=g.rightVertex.rightEdge;}while(g&&g!==l);return s}_processCandidateProposal(e,o$1,d,p,a,h){const l=d$7(n$9(),d,e,o$1),g=a.coordinateHelper,c=g.fromXYZ(l,g.getZ(d,0));c$3(p,a$3(c,g,a.elevationInfo,this.view))<this.squaredProximityTreshold(a.pointer)&&h.push(new o({coordinateHelper:a.coordinateHelper,lineStart:e,lineEnd:o$1,targetPoint:c}));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
s$7.getLogger("esri.views.interactive.snapping.hints.ParallelSnappingHint");class e$1 extends s$2{constructor(i,t){super(),this.lineStart=i,this.lineEnd=t;}equals(i){return i instanceof e$1&&(i$5(this.lineStart,i.lineStart)&&i$5(this.lineEnd,i.lineEnd))}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class a$1 extends t{constructor({coordinateHelper:n,referenceLine:i,lineStart:s,targetPoint:a}){const f=n.clone(s);o$4(f,s$d(f,f,i.rightVertex.pos),i.leftVertex.pos),super(n,a,new E(n,s,f)),this._referenceLines=[{edge:i,fadeLeft:!0,fadeRight:!0}];}get hints(){return [new s$1(0,this.constraint.start,this.targetPoint),new e$1(this.constraint.start,this.targetPoint),...this._referenceLines.map((e=>new s$1(1,e.edge.leftVertex.pos,e.edge.rightVertex.pos,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((r=>{e.rightVertex.rightEdge===r.edge&&(r.fadeLeft=!1,t.fadeRight=!1),e.leftVertex.leftEdge===r.edge&&(r.fadeRight=!1,t.fadeLeft=!1);})),this._referenceLines.push(t);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class c$1 extends i$2{constructor(){super(...arguments),this._tmpProjection=n$9();}snapNewVertex(e,t){const r=t.editGeometryOperations.data.components[0],i=r.edges.length,o=r.vertices.length,n=[];if(i<2)return n;const a=a$3(e,t.coordinateHelper,t.elevationInfo,this.view),l=r.vertices[o-1],c=r.vertices[0],h=r.edges[i-1];let p=h;do{this.edgeExceedsShortLineThreshold(p,t)&&(this._checkEdgeForParalleLines(p,l.pos,e,a,t,n),this._checkEdgeForParalleLines(p,c.pos,e,a,t,n)),p=p.leftVertex.leftEdge;}while(p&&p!==h);return n}snapExistingVertex(t,r){const i=[],o=e$e(r.vertexHandle),n=o.component;if(n.edges.length<3)return i;const a=a$3(t,r.coordinateHelper,r.elevationInfo,this.view),l=o.leftEdge,c=o.rightEdge,h=n.vertices[0],p=n.vertices.length,d=n.vertices[p-1],g=n.edges[0];let m=g;do{m!==l&&m!==c&&this.edgeExceedsShortLineThreshold(m,r)&&(l&&this._checkEdgeForParalleLines(m,l.leftVertex.pos,t,a,r,i),c&&this._checkEdgeForParalleLines(m,c.rightVertex.pos,t,a,r,i),o===h?this._checkEdgeForParalleLines(m,d.pos,t,a,r,i):o===d&&this._checkEdgeForParalleLines(m,h.pos,t,a,r,i)),m=m.rightVertex.rightEdge;}while(m&&m!==g);return i}_checkEdgeForParalleLines(e,r,o,c,h,p){const d=e.leftVertex.pos,g=e.rightVertex.pos;if(d$7(this._tmpProjection,r,d,g),q$3(this._tmpProjection,r)<p$b.parallelLineThreshold)return;d$7(this._tmpProjection,o,d,g,r);const m=h.coordinateHelper,f=m.fromXYZ(this._tmpProjection,m.getZ(o,0));if(c$3(c,a$3(f,m,h.elevationInfo,this.view))<this.squaredProximityTreshold(h.pointer)){if(this.parallelToPreviousCandidate(e,p))return;p.push(new a$1({coordinateHelper:m,referenceLine:e,lineStart:r,targetPoint:f}));}}parallelToPreviousCandidate(e,r){const o=e.leftVertex.pos,s=e.rightVertex.pos;for(const n of r)if(d$7(this._tmpProjection,s,n.constraint.start,n.constraint.end,o),q$3(this._tmpProjection,s)<p$b.parallelLineThreshold)return n.addReferenceLine(e),!0;return !1}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class c extends i$2{constructor(){super(...arguments),this._tmp=n$9();}snapNewVertex(e,t){const r=t.editGeometryOperations.data.components[0],i=r.vertices.length,o=[];if(i<2)return o;const s=a$3(e,t.coordinateHelper,t.elevationInfo,this.view),n=r.vertices[i-1];this._checkForSnappingCandidate(o,n.leftEdge,n.pos,e,n.leftEdge.leftVertex.pos,n.pos,t,e,s);const p=r.vertices[0];return this._checkForSnappingCandidate(o,p.rightEdge,p.pos,e,p.rightEdge.rightVertex.pos,p.pos,t,e,s),o}snapExistingVertex(t,r){const i=[],o=e$e(r.vertexHandle),s=o.component,n=s.vertices.length;if(n<3)return i;const p=a$3(t,r.coordinateHelper,r.elevationInfo,this.view),g=o.leftEdge,a=o.rightEdge,d=s.vertices[0],c=s.vertices[n-1];if(!g)return this._checkForSnappingCandidate(i,d.rightEdge.rightVertex.rightEdge,d.rightEdge.rightVertex.pos,t,d.rightEdge.rightVertex.rightEdge.rightVertex.pos,d.rightEdge.rightVertex.pos,r,t,p),i;if(!a)return this._checkForSnappingCandidate(i,c.leftEdge.leftVertex.leftEdge,c.leftEdge.leftVertex.pos,t,c.leftEdge.leftVertex.leftEdge.leftVertex.pos,c.leftEdge.leftVertex.pos,r,t,p),i;if(g&&g.leftVertex.leftEdge){const e=g.leftVertex.leftEdge;this._checkForSnappingCandidate(i,e,g.leftVertex.pos,t,e.leftVertex.pos,g.leftVertex.pos,r,t,p);}if(a&&a.rightVertex.rightEdge){const e=a.rightVertex.rightEdge;this._checkForSnappingCandidate(i,e,a.rightVertex.pos,t,e.rightVertex.pos,a.rightVertex.pos,r,t,p);}return i}_checkForSnappingCandidate(e,p,c,f,l,x,V,m,E){if(!this.edgeExceedsShortLineThreshold(p,V))return;o$4(this._tmp,p.rightVertex.pos,p.leftVertex.pos);const v=t$8(this._tmp[1],-this._tmp[0]),u=j$7(v,o$4(this._tmp,f,c))/p$h(v),_=V.coordinateHelper,S=_.fromXYZ(m$d(n$9(),x,v,u),_.getZ(m,0));c$3(E,a$3(S,_,V.elevationInfo,this.view))<this.squaredProximityTreshold(V.pointer)&&e.push(new i$3({coordinateHelper:_,targetPoint:S,constraint:new q$1(_,x,m$d(_.createVector(),x,v,Math.sign(u))),previousVertex:l,otherVertex:x,otherVertexType:1}));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class e extends t{constructor({coordinateHelper:n,targetPoint:o,point1:p,point2:r}){super(n,o,new T$1(n,_$1(a,p,r,.5),.5*d$9(p,r))),this.p1=p,this.p2=r;}get hints(){return [new s$1(1,this.targetPoint,this.p1),new s$1(1,this.targetPoint,this.p2),new i$4(this.p1,this.targetPoint,this.p2)]}}const a=n$9();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class d extends i$2{snapNewVertex(e,t){const o=t.editGeometryOperations.data.components[0],r=[],s=o.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||s<2)return r;const i=o.vertices[0],n=o.vertices[s-1];return this._processCandidateProposal(i.pos,n.pos,e,t,r),r}snapExistingVertex(t,o){const r=[],s=e$e(o.vertexHandle),i=s.component;return i.edges.length<2?r:"polyline"!==o.editGeometryOperations.data.type||0!==s.index&&s.index!==i.vertices.length-1?(this._processCandidateProposal(s.leftEdge.leftVertex.pos,s.rightEdge.rightVertex.pos,t,o,r),r):r}_processCandidateProposal(e$1,s,d,m,l){if(!this.exceedsShortLineThreshold(e$1,s,m))return;const c=_$1(n$9(),e$1,s,.5),g=.5*d$9(e$1,s),h=j$8(n$9(),d,c,g),f=m.coordinateHelper,x=f.fromXYZ(h,f.getZ(d,0)),v=a$3(d,f,m.elevationInfo,this.view);c$3(v,a$3(x,f,m.elevationInfo,this.view))<this.squaredProximityTreshold(m.pointer)&&l.push(new e({coordinateHelper:f,targetPoint:x,point1:e$1,point2:s}));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let m=class extends p$d{constructor(s){super(s),this.updating=!1,this._snappers=new S$1;}initialize(){this._snappers.push(new c$1(this.view,this.options),new d$1(this.view,this.options),new c(this.view,this.options),new d(this.view,this.options));}set options(s){this._set("options",s);for(const o of this._snappers)o.options=s;}async fetchCandidates(s,o){if(!this.options.effectiveSelfEnabled)return [];const t=[];for(const r of this._snappers.items)t.push(...r.snap(s,o));return p$1(s,t),t}};e$9([d$6({readOnly:!0})],m.prototype,"updating",void 0),e$9([d$6({constructOnly:!0})],m.prototype,"view",void 0),e$9([d$6()],m.prototype,"options",null),m=e$9([i$8("esri.views.interactive.snapping.SelfSnappingEngine")],m);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class i$1 extends s$2{constructor(t){super(),this.intersectionPoint=t;}equals(n){return n instanceof i$1&&i$5(this.intersectionPoint,n.intersectionPoint)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class s extends t{constructor(i,n,s,r){super(i,n,new H(i,n,s.constraint,r.constraint)),this.first=s,this.second=r;}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new i$1(this.targetPoint)]}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let C$2=class extends(n$5.EventedMixin(d$8)){constructor(t){super(t),this.options=new l$7,this.engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[];}initialize(){this.handles.add([i$c((()=>{const{effectiveFeatureEnabled:t,effectiveSelfEnabled:e,touchSensitivityMultiplier:i,distance:n}=this.options;return {effectiveFeatureEnabled:t,effectiveSelfEnabled:e,touchSensitivityMultiplier:i,distance:n}}),(()=>{this.doneSnapping(),this.emit("changed");}),m$e),i$c((()=>this.options),(t=>{for(const e of this.engines)e.options=t;}),m$e),i$c((()=>this.view.ready),(t=>this.onViewReady(t)),p$e)]);}destroy(){this.destroyEngines();}get updating(){return this.engines.some((t=>t.updating))}onViewReady(t){var e,i;(this.destroyEngines(),t)&&(this.engines=[new m({view:this.view,options:this.options}),new w$1({view:this.view,spatialReference:null!=(e=null==(i=this.view)?void 0:i.spatialReference)?e:k$2.WGS84,options:this.options})]);}destroyEngines(){for(const t of this.engines)t.destroy();this.engines.length=0;}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:t,touchSensitivityMultiplier:e}=this.options,i=t*e;return i*i}async snap(t,e,i){const o=e.coordinateHelper.pointToVector(t),r=await this.fetchCandidates(o,e,i);return {get valid(){return !p$f(i)},apply:()=>{const{snappedPoint:t,hints:i}=this.processCandidates(o,r,e);return this.removeVisualization(),r$7(e.visualizer)&&this.handles.add(e.visualizer.draw(i,{coordinateHelper:e.coordinateHelper,elevationInfo:e.elevationInfo,view:this.view}),w),t}}}update(t,e){this.removeVisualization();let i=t;const s=[];if(r$7(this._currentMainCandidate)){const n=e.coordinateHelper,o=n.pointToVector(t),r=this._currentMainCandidate.constraint.closestTo(o);if(c$3(a$3(o,n,e.elevationInfo,this.view),a$3(r,n,e.elevationInfo,this.view))<this.squaredPointProximityThreshold(e.pointer)){i=n.vectorToDehydratedPoint(r),this._currentMainCandidate.targetPoint=r,s.push(...this._currentMainCandidate.hints);for(const t of this._currentOtherActiveCandidates)t.targetPoint=r,s.push(...t.hints);}else this._currentMainCandidate=null,this._currentOtherActiveCandidates=[];}return r$7(e.visualizer)&&this.handles.add(e.visualizer.draw(s,{coordinateHelper:e.coordinateHelper,elevationInfo:e.elevationInfo,view:this.view}),w),i}doneSnapping(){this.removeVisualization(),this._currentMainCandidate=null,this._currentOtherActiveCandidates=[];}removeVisualization(){this.handles.remove(w);}async fetchCandidates(t,e,i){return (await Promise.all(this.engines.map((n=>n.fetchCandidates(t,e,i))))).flat()}processCandidates(t,e,i){if(e.length<1)return this.doneSnapping(),{snappedPoint:i.coordinateHelper.vectorToDehydratedPoint(t),hints:[]};p$1(t,e);const s$1=this._currentMainCandidate;if(r$7(s$1)){const n=this.findOldConstraintInNewCandidates(s$1,e);if(n>=0){if(!(e[n]instanceof s))return this.intersectWithOtherCandidates(n,e,t,i);if(q$3(t,s$1.targetPoint)<this.squaredPointProximityThreshold(i.pointer))return this.updateSnappingCandidate(s$1,e,i)}}return this.intersectWithOtherCandidates(0,e,t,i)}findOldConstraintInNewCandidates(t,e){return t instanceof s?this.findOldCandidateIndex(e,t.first)>=0&&this.findOldCandidateIndex(e,t.second)>=0?0:-1:this.findOldCandidateIndex(e,t)}intersectWithOtherCandidates(t,e,i,n){const s$1=e[t],o=[],r=n.coordinateHelper;for(let a=0;a<e.length;++a){if(a===t)continue;const d=e[a];for(const t of s$1.constraint.intersect(d.constraint)){const e=r.fromXYZ(t.intersection,s$1.targetPoint[2]);o.push([new s(r,e,s$1,d),c$3(a$3(i,n.coordinateHelper,n.elevationInfo,this.view),a$3(e,n.coordinateHelper,n.elevationInfo,this.view))]);}}return o.length>0&&(o.sort(((t,e)=>t[1]-e[1])),o[0][1]<this.squaredPointProximityThreshold(n.pointer))?this.updateSnappingCandidate(o[0][0],e,n):this.updateSnappingCandidate(s$1,e,n)}updateSnappingCandidate(t,e,i){this.doneSnapping(),this._currentMainCandidate=t;const n=this._currentMainCandidate.targetPoint,s$1=[];s$1.push(...t.hints);for(const o of e){if(t instanceof s){if(o.constraint.objectEqual(t.first.constraint)||o.constraint.objectEqual(t.second.constraint))continue}else if(o.constraint.objectEqual(t.constraint))continue;o.constraint.check(n)&&(o.targetPoint=n,this._currentOtherActiveCandidates.push(o),s$1.push(...o.hints));}return {snappedPoint:i.coordinateHelper.vectorToDehydratedPoint(n),hints:s$1}}squaredPointProximityThreshold(t){return "touch"===t?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}findOldCandidateIndex(t,e){let i=-1;for(let n=0;n<t.length;++n)if(e.constraint.objectEqual(t[n].constraint)){i=n;break}return i}get test(){return {visualizationsActive:this.handles.has(w),engines:this.engines}}};e$9([d$6({constructOnly:!0})],C$2.prototype,"view",void 0),e$9([d$6()],C$2.prototype,"options",void 0),e$9([d$6({readOnly:!0})],C$2.prototype,"updating",null),e$9([d$6()],C$2.prototype,"engines",void 0),e$9([d$6()],C$2.prototype,"squaredMouseProximityTreshold",null),e$9([d$6()],C$2.prototype,"squaredTouchProximityThreshold",null),C$2=e$9([i$8("esri.views.interactive.snapping.SnappingManager")],C$2);const w="visualization-handle";

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let p=class extends n$5.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null;}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return "move";case"box":case"transform-3d":return "transform";case"reshape":case"reshape-3d":return "reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e);}resetHistory(){this.history.redo=[],this.history.undo=[];}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this.reset(),this.onEnd(),this.emit("complete");}cancel(){this.cancelled=!0,this.complete();}reset(){this.activeComponent.reset();}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh());}set undo(e){this._set("undo",(()=>{this.canUndo()&&e();}));}set redo(e){this._set("redo",(()=>{this.canRedo()&&e();}));}};e$9([d$6()],p.prototype,"activeComponent",void 0),e$9([d$6()],p.prototype,"cancelled",void 0),e$9([d$6()],p.prototype,"history",void 0),e$9([d$6()],p.prototype,"tool",null),e$9([d$6()],p.prototype,"type",void 0),e$9([d$6()],p.prototype,"canUndo",null),e$9([d$6()],p.prototype,"canRedo",null),e$9([d$6()],p.prototype,"onEnd",void 0),e$9([d$6()],p.prototype,"undo",null),e$9([d$6()],p.prototype,"redo",null),e$9([d$6()],p.prototype,"toggleTool",void 0),e$9([d$6()],p.prototype,"addToSelection",void 0),e$9([d$6()],p.prototype,"removeFromSelection",void 0),p=e$9([i$8("esri.widgets.Sketch.support.OperationHandle")],p);let n=class extends p{};e$9([d$6()],n.prototype,"activeComponent",void 0),n=e$9([i$8("esri.widgets.Sketch.support.CreateOperationHandle")],n);let i=class extends p{constructor(e){super(e);}};e$9([d$6()],i.prototype,"activeComponent",void 0),i=e$9([i$8("esri.widgets.Sketch.support.UpdateOperationHandle")],i);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const K="esri.widgets.Sketch.SketchViewModel",q=s$7.getLogger(K),Z={defaultZ:0},z={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,tool:"transform"};let B=class extends n$5.EventedAccessor{constructor(e){super(e),this._numUpdating=0,this._handles=new u$7,this._internalGraphicsLayer=new h$7({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandles=new u$7,this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new y$3({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new S$2({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new m$f({color:[130,130,130,1],width:2}),this._snappingManager=null,this.updateGraphics=new S$1,this.updateOnGraphicClick=!0,this.updatePointSymbol=new y$3({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}}),this.updatePolygonSymbol=new S$2({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}}),this.updatePolylineSymbol=new m$f({color:[12,207,255],width:2}),this.vertexSymbol=new y$3({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalAutoOpenEnabled=null,this.defaultCreateOptions=Z,this.defaultUpdateOptions=z,this.snappingOptions=new l$7;}initialize(){this._handles.add([f$5(this,"layer",(()=>{this.cancel(),this._internalGraphicsLayer.elevationInfo=r$7(this.layer)?this.layer.elevationInfo:null;})),$$1(this,"view.map.layers","change",(e=>{e.removed.includes(this.layer)&&this.cancel();})),$$1(this,"layer.graphics","change",(e=>{if(r$7(this._operationHandle))for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel());})),i$a(this,"layer.elevationInfo",(()=>{this.cancel(),this._internalGraphicsLayer.elevationInfo=r$7(this.layer)?this.layer.elevationInfo:null;}),!0),i$a(this,"view",(e=>{l$b(this._snappingManager),e&&(this._snappingManager=new C$2({view:e,options:this.snappingOptions}),"2d"===e.type?import('./editingTools-cad66de8.js'):"3d"===e.type&&(import('./editingTools-d335a363.js').then(function (n) { return n.e; }),import('./GraphicsLayerView3D-9767926e.js')));}),!0)]);}destroy(){this.cancel(),this._handles=l$b(this._handles),this._viewHandles=l$b(this._viewHandles),this._removeDefaultLayer(),this._snappingManager=l$b(this._snappingManager),this._set("view",null),this.emit("destroy");}get _defaultUpdateTool(){return "3d"===this.view.type?"move":"transform"}get updating(){return this._numUpdating>0}get activeTool(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null}get activeComponent(){return this._operationHandle?this._operationHandle.activeComponent:null}get createGraphic(){return !r$7(this.activeComponent)||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):e$e(this.activeComponent.graphic)}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...Z,...e});}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...z,...e,reshapeOptions:{...z.reshapeOptions,...null==e?void 0:e.reshapeOptions}});}set snappingOptions(e){r$7(this._snappingManager)&&(this._snappingManager.options=e),this._set("snappingOptions",e);}get state(){var e;const t=!(null==(e=this.view)||!e.ready||!this.layer),o=this._operationHandle;return t&&o?"active":t?"ready":"disabled"}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:o}=t;e&&(t.cursor=null),o&&o.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel();}const o="view-ready";this._handles.remove(o),e&&this._handles.add(s$9(e,"ready",(t=>{this._viewHandles.removeAll(),t&&this._viewHandles.add(this._generateViewHandles(e));}),!0),o),this._set("view",e);}cancel(){this._moduleLoaderAbortController=a$f(this._moduleLoaderAbortController),this._viewReadyAbortController=a$f(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel();}complete(){this._operationHandle&&this._operationHandle.complete();}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:o}=this,i=t.toArray();o.removeMany(i),this.cancel(),this._emitDeleteEvent({graphics:i,tool:e});}}async create(e,t){if(await this._waitViewReady(),"disabled"===this.state)throw this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),m$b();if(this.cancel(),r$7(this.view.activeTool)&&(this.view.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");r(this.view,this._internalGraphicsLayer);const o=await this._setupCreateOperation(e,t);if(t$6(o)||this.destroyed)return void this.view.map.remove(this._internalGraphicsLayer);const i=()=>{if(o===this._operationHandle){const t=this.createGraphic,i=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),o.cancelled||null==t||this.layer.add(t),this.emit("create",{graphic:t,state:i?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"});}};o.on("complete",i),this._operationHandle=o,this.view.ready&&g$4(this.view)&&this.view.focus();}async update(e,t){await this._waitViewReady();const{layer:o,view:i,state:a}=this;if("disabled"===a)throw i||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),o||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),m$b();this.cancel(),r$7(this.view.activeTool)&&(this.view.activeTool=null);const r$1=Array.isArray(e)?e:[e];if(null==e||!r$1||!r$1.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r$1.some((e=>e.layer!==o?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):t$6(e.geometry)?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):"2d"===i.type&&!i.spatialReference.equals(e.geometry.spatialReference)&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with a spatial reference different from the supplied MapView."),!0))))return;const s=await this._setupUpdateOperation(r$1,t);this.destroyed||t$6(s)||X(s)||(r(this.view,this._internalGraphicsLayer),this._setUpdateOperationHandle(s,t),this.emit("update",{graphics:r$1,state:"start",aborted:!1,tool:s.tool,toolEventInfo:null,type:"update"}));}undo(){this.canUndo()&&this._operationHandle.undo();}redo(){this.canRedo()&&this._operationHandle.redo();}canUndo(){return !(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return !(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool();}async _getFirstHit(e){const t=[];switch(this.view.type){case"2d":{const a=await this.view.hitTest(e);if(a.results.length>0){const e=a.results[0];if(e.graphic){var o,i;const a=e.graphic;"vector-tile"!==(null==(o=a.layer)?void 0:o.type)&&"imagery"!==(null==(i=a.layer)?void 0:i.type)&&t.push(e);}}}break;case"3d":{const o=[this.view.map.ground];this.view.map.allLayers.forEach((e=>{"integrated-mesh"===e.type&&o.push(e);}));const i=await this.view.hitTest(e,{exclude:o});if(i.results.length>0){const e=i.results[0];(!i.ground.mapPoint||this.view.map.ground.opacity<1||i.ground.distance-e.distance>-Math.min(3*i.ground.distance,"global"===this.view.viewingMode?p$g(this.view.renderCoordsHelper.spatialReference).radius/this.view.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY))&&t.push(e);}}}return {screenPoint:e,results:t}}_generateViewHandles(e){return [e.on("immediate-click",(async t=>{const o="active"===this.state&&"create"===this._operationHandle.type;if("disabled"===this.state||o||!this.updateOnGraphicClick)return;this._beginAsyncOperation();const i=(await t.async((()=>this._getFirstHit(t$9(t))))).results;let a=null;if(i.length){for(const r of i)if(r.graphic){const o=r.graphic;if(this.updateGraphics.includes(o)||o.layer===this.layer){t.stopPropagation(),a=o;break}"2d"!==e.type||this._isComponentGraphic(o)||"active"!==this.state||this.cancel();}}else "active"===this.state&&this.cancel();r$7(a)&&!this.updateGraphics.includes(a)&&await this.update([a],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}}),this._endAsyncOperation();}),u$8.WIDGET)]}async _setupCreateOperation(e,t){const o={hasZ:"3d"===this.view.type,...this.defaultCreateOptions,...t},i=await this._setupDrawGraphicTool(e,this.view,o);return t$6(i)?null:(this.view.tools.add(i),this.view.activeTool=i,this._setupCreateOperationHandle(i))}async _setupDrawGraphicTool(e,t,o){if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView"),null;const i="rectangle"!==e,a="rectangle"!==e;this.snappingOptions.enabledToggled=!1;const r={view:t,mode:"rectangle"===e||"circle"===e?"hybrid":"click",...o,snapToScene:!1,geometryType:e,graphicSymbol:this._getGraphicSymbolFromTool(e),snappingManager:this._snappingManager,forceUniformSize:a,centered:i};return "2d"===this.view.type?this._makeDrawGraphicTool2D(r):this._makeDrawGraphicTool3D(r)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(import('./editingTools-cad66de8.js'));return X(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:N(e.geometryType)?this.activeFillSymbol:null})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(import('./editingTools-d335a363.js').then(function (n) { return n.e; }));return X(t)||this.destroyed?null:new t.module.DrawGraphicTool3D({...e,elevationInfo:this.layer.elevationInfo,snapToScene:!r$7(this.layer.elevationInfo)||"absolute-height"===this.layer.elevationInfo.mode})}_setupCreateOperationHandle(e){let t=null;const o=e.forceUniformSize,i=e.centered,a=[this.view.on("key-down",(t=>{if(t.key===e$4.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===e$4.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==e$4.vertexAdd||t.repeat)t.key===e$4.undo?(t.stopPropagation(),r.undo()):t.key===e$4.redo?(t.stopPropagation(),r.redo()):t.key!==e$4.snappingToggle||"rectangle"===e.geometryType||"circle"===e.geometryType||t.repeat?t.key!==e$4.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===e$4.center&&(t.repeat||(e.centered=!i,t.stopPropagation())):(e.forceUniformSize=!o,t.stopPropagation()):(this.snappingOptions.enabledToggled=!0,t.stopPropagation());else {const o=e.drawOperation.geometryType;"polyline"!==o&&"polygon"!==o&&"multipoint"!==o||(t.stopPropagation(),e.drawOperation.commitStagedVertex());}}),u$8.WIDGET),this.view.on("key-up",(t=>{t.key===e$4.pan?e.enabled=!0:t.key===e$4.snappingToggle&&"rectangle"!==e.geometryType&&"circle"!==e.geometryType?(this.snappingOptions.enabledToggled=!1,t.stopPropagation()):t.key!==e$4.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===e$4.center&&(e.centered=i,t.stopPropagation()):(e.forceUniformSize=o,t.stopPropagation());}),u$8.WIDGET),e.on("vertex-add",(o=>{switch(t=t$6(t)?"start":"active",o.operation){case"apply":this.emit("create",{graphic:e$e(e.graphic),state:t,tool:this.activeTool,toolEventInfo:o,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e$e(e.graphic)],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e$e(e.graphic)],tool:e.geometryType});}})),e.on("cursor-update",(t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e$e(e.graphic),state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"});})),e.on("vertex-remove",(t=>{switch(t.operation){case"apply":this.emit("create",{graphic:e$e(e.graphic),state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e$e(e.graphic)],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e$e(e.graphic)],tool:e.geometryType});}})),e.on("complete",(e=>{this._set("createGraphic",e$e(e.graphic)),t="complete",e.aborted?r&&r.cancel():r&&r.complete();})),i$c((()=>this._getGraphicSymbolFromTool(e.geometryType)),(t=>{e.graphicSymbol=t;}))],r=new p({activeComponent:e,tool:e.geometryType,type:"update",onEnd:()=>{var t;a.forEach((e=>e.remove())),a.length=0,null==(t=this.view.tools)||t.remove(e),e.destroy();},undo:()=>{e.canUndo&&e.undo();},redo:()=>{e.canRedo&&e.redo();},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return r}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol;default:return null}}async _setupUpdateOperation(e,t){const{layer:o,view:i}=this,a={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...null==t?void 0:t.reshapeOptions}};let r=a.tool;for(const s of e)o.remove(s),o.add(s);if("3d"===i.type){if(0===e.length)return null;switch(r){case"move":return this._setupMove3DOperation(e,a,i,r);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=n$1(e[0]);return 0===t?this._setupReshape3DOperation(e[0],a,i):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${e$5(t)}).`),null)}case"transform":return this._setupGraphicTransform3DOperation(e,a,i)}}switch(r){case"move":return this._setupMoveOperation(e,a,i);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=n$1(e[0]);return 0===t?this._setupTransformOrReshapeOperation(e,r,a,i):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${e$5(t)}).`),null)}case"transform":if(1===e.length){const t=m$g(e[0].geometry,"type");"point"!==t&&"multipoint"!==t||(r="reshape");}return this._setupTransformOrReshapeOperation(e,r,a,i)}}async _setupMove3DOperation(e,t,o,i$1,a=!1){for(const l of e){const e=t$1(l);if(0!==e)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${e$5(e)}).`),null}const r=await this._requireModule(import('./editingTools-d335a363.js').then(function (n) { return n.e; }));if(X(r))return r;const s=new r.module.GraphicMoveTool({view:o,enableZ:t.enableZ,snappingManager:this._snappingManager});this.view.tools.add(s),s.graphics.addMany(e),a||this.updateGraphics.addMany(e);const n=[],p=new i({activeComponent:s,tool:i$1,type:"update",onEnd:()=>{var e;n.forEach((e=>e.remove())),n.length=0,null==(e=this.view.tools)||e.remove(s),s.destroyed||s.destroy();},undo:()=>{$(p,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i$1});},redo:()=>{Y(p,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i$1});},addToSelection:e=>{this.updateGraphics.push(e),s.graphics.push(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);p.history.undo.forEach((e=>e.updates.splice(t,1))),p.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?s.graphics.remove(e):p.complete();},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==i$1)return;const e=this.updateGraphics.getItemAt(0);if(0!==n$1(e))return;const a=await this._setupReshape3DOperation(e,t,o,!0);X(a)||(p.onEnd(),p.destroy(),this._setUpdateOperationHandle(a,t));}});return n.push(...this._getHandlesForComponent(p,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(p,e,t)),u$8.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(p,e),e.key===e$4.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation());}),u$8.WIDGET),o.on("key-up",(e=>{e.key===e$4.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation());}),u$8.WIDGET)),p}_setupGraphicTransform3DOperation(e,t,o,i=!1){if(1===e.length&&0===s$3(e[0])){const a=e[0],r=a.geometry;if(r$7(r)&&("point"===r.type||"mesh"===r.type))return this._setupPointTransform3DOperation(a,t,o);if(r$7(r)&&("polygon"===r.type||"polyline"===r.type))return this._setupPolyTransform3DOperation(a,t,o,i)}return this._setupMove3DOperation(e,t,o,"transform",i)}async _setupPointTransform3DOperation(e,t,o){const i$1="transform",{enableRotation:a,enableScaling:r,enableZ:s}=t,n=await this._requireModule(import('./editingTools-d335a363.js').then(function (n) { return n.e; }));if(X(n))return n;const p=new n.module.GraphicTransformTool({graphic:e,view:o,enableRotation:a,enableScaling:r,enableZ:s,snappingManager:this._snappingManager});this.view.tools.add(p),this.updateGraphics.add(e);const l=[],h=new i({activeComponent:p,tool:i$1,type:"update",onEnd:()=>{var e;l.forEach((e=>e.remove())),l.length=0,null==(e=this.view.tools)||e.remove(p),p.destroyed||p.destroy();},undo:()=>{$(h,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i$1});},redo:()=>{Y(h,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i$1});},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);X(i)||(h.onEnd(),h.destroy(),this._setUpdateOperationHandle(i,t));},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),h.complete();},toggleTool:()=>{}});return l.push(...this._getHandlesForComponent(h,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(h,e,t)),u$8.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(h,e),e.key===e$4.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation());}),u$8.WIDGET),o.on("key-up",(e=>{e.key===e$4.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation());}),u$8.WIDGET)),h}async _setupPolyTransform3DOperation(e,t,o,i$1=!1){const a="transform",{enableRotation:r,enableScaling:s,enableZ:n,preserveAspectRatio:p}=t,l=await this._requireModule(import('./editingTools-d335a363.js').then(function (n) { return n.e; }));if(X(l))return l;const h=new l.module.ExtentTransformTool({graphic:e,view:o,enableRotation:r,enableScaling:s,enableZ:n,preserveAspectRatio:p});this.view.tools.add(h),i$1||this.updateGraphics.add(e);const c=[],d=new i({activeComponent:h,tool:a,type:"update",onEnd:()=>{var e;c.forEach((e=>e.remove())),c.length=0,null==(e=this.view.tools)||e.remove(h),h.destroyed||h.destroy();},canUndo:()=>h.canUndo,undo:()=>{h.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a});},canRedo:()=>h.canRedo,redo:()=>{h.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a});},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);X(i)||(d.onEnd(),d.destroy(),this._setUpdateOperationHandle(i,t));},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),d.complete();},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const e=this.updateGraphics.getItemAt(0);if(0!==n$1(e))return;const i=await this._setupReshape3DOperation(e,t,o,!0);X(i)||(d.onEnd(),d.destroy(),this._setUpdateOperationHandle(i,t));}});return c.push(...this._getHandlesForComponent(d,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(d,e,t)),u$8.WIDGET),this.view.on("key-down",(e=>this._getCommonUpdateOperationKeyDownHandlers(d,e)),u$8.WIDGET),this.view.on("key-down",(e=>{e.key!==e$4.constraint||e.repeat||(h.preserveAspectRatio=!h.preserveAspectRatio,e.stopPropagation());}),u$8.WIDGET),this.view.on("key-up",(e=>{e.key===e$4.constraint&&(h.preserveAspectRatio=!h.preserveAspectRatio,e.stopPropagation());}),u$8.WIDGET)),d}async _setupMoveOperation(e,t,o){const i$1="move";this.updateGraphics.addMany(e);const a=await this._getGraphicMover(e,t,o);if(X(a))return a;const r=new i({activeComponent:a,tool:i$1,type:"update",onEnd:()=>{var e;this._displayDefaultCursor(),p.forEach((e=>e.remove())),n.forEach((e=>e.remove())),p=[],n=[],a.destroy(),null==(e=this._internalGraphicsLayer)||e.removeMany([...this.updateGraphics.toArray()]);},undo:()=>{const e=this.updateGraphics.toArray();$(r,e),r.refreshComponent(),this._emitUndoEvent({graphics:e,tool:i$1});},redo:()=>{const e=this.updateGraphics.toArray();Y(r,e),r.refreshComponent(),this._emitRedoEvent({graphics:e,tool:i$1});},addToSelection:e=>{this.updateGraphics.push(e),a.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);r.history.undo.forEach((e=>e.updates.splice(t,1))),r.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const o=this.updateGraphics.toArray();this.emit("update",{graphics:o,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?a.graphics=o:r.complete();}});let s=!1,n=[o.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(r,e,t)),u$8.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(r,e),e.key!==e$4.constraint||e.repeat||(s=!0,a.enableMoveAllGraphics=!a.enableMoveAllGraphics);}),u$8.WIDGET),o.on("key-up",(e=>{e.key===e$4.constraint&&s&&(s=!1,a.enableMoveAllGraphics=!a.enableMoveAllGraphics);}),u$8.WIDGET)],p=this._getHandlesForComponent(r,t);return r}async _setupReshape3DOperation(e,t,o,i$1=!1){const a="reshape",r=await this._requireModule(import('./editingTools-d335a363.js').then(function (n) { return n.e; }));if(X(r))return r;this.snappingOptions.enabledToggled=!1;const s=new r.module.GraphicReshapeTool({view:o,graphic:e,enableZVertex:t.enableZ&&"move"===t.reshapeOptions.vertexOperation,enableZShape:t.enableZ&&"move"===t.reshapeOptions.shapeOperation,enableMoveGraphic:"move"===t.reshapeOptions.shapeOperation||"move-xy"===t.reshapeOptions.shapeOperation,enableMidpoints:"split"===t.reshapeOptions.edgeOperation,enableEdgeOffset:"offset"===t.reshapeOptions.edgeOperation,snappingManager:this._snappingManager});o.tools.add(s),i$1||this.updateGraphics.add(e);const n=[],p=new i({activeComponent:s,tool:a,type:"update",onEnd:()=>{var e;n.forEach((e=>e.remove())),n.length=0,null==(e=this.view.tools)||e.remove(s),s.destroyed||s.destroy();},canUndo:()=>s.canUndo,undo:()=>{s.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a});},canRedo:()=>s.canRedo,redo:()=>{s.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a});},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const i=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,o,"transform",!0);X(i)||(p.onEnd(),p.destroy(),this._setUpdateOperationHandle(i,t));},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),p.complete();},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,o,!0);X(e)||(p.onEnd(),p.destroy(),this._setUpdateOperationHandle(e,t));}});return n.push(...this._getHandlesForComponent(p,t),o.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(p,e,t)),u$8.WIDGET),o.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(p,e),e.key===e$4.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation());}),u$8.WIDGET),o.on("key-up",(e=>{e.key===e$4.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation());}),u$8.WIDGET)),p}async _setupTransformOrReshapeOperation(e,t,o,i$1){const{multipleSelectionEnabled:a}=o;this.updateGraphics.addMany(e);const r="transform"===t?await this._getBox(e,o,i$1):await this._getReshape(e,o,i$1);if(X(r))return r;const s=new i({activeComponent:r,type:"update",onEnd:()=>{l.forEach((e=>e.remove())),p.forEach((e=>e.remove())),l=[],p=[],s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray());},undo:()=>{$(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool});},redo:()=>{Y(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool});},addToSelection:async e=>{let t=s.activeComponent;if("reshape"===t.type){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll();const a=await this._setupMoveOperation(t,o,i$1);if(X(a))return;s.onEnd(),s.destroy(),this._setUpdateOperationHandle(a,o);}else this.updateGraphics.add(e),t=t,t.graphics=this.updateGraphics.toArray(),t.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});},removeFromSelection:async e=>{const t=this.updateGraphics.indexOf(e);s.history.undo.forEach((e=>e.updates.splice(t,1))),s.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const o=this.updateGraphics.toArray();if(0===o.length)s.complete();else {const e=o[0].geometry;1!==o.length||!r$7(e)||"point"!==e.type&&"multipoint"!==e.type?s.activeComponent.graphics=o:s.toggleTool();}this.emit("update",{graphics:o,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"});},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const e=this.updateGraphics.getItemAt(0),t=e.geometry;if(r$7(t)&&("reshape"===s.tool&&("point"===t.type||"multipoint"===t.type)||"transform"===s.tool&&"extent"===t.type))return;let a=null;"transform"===s.tool?a=await this._getReshape([e],o,i$1):"reshape"===s.tool&&(a=await this._getBox([e],o,i$1)),X(a)||(s.activeComponent.destroy(),s.activeComponent=a,s.activeComponent&&(l.forEach((e=>e.remove())),l=this._getHandlesForComponent(s,o)));}});let p=[i$1.on("immediate-click",(async e=>{var t;const o=await e.async((()=>this._getFirstHit(t$9(e))));null!=(t=o.results)&&t.length?o.results.some((t=>{if(t.graphic){var o;const i=t.graphic;if(null!=(o=e.native)&&o.shiftKey&&a)return e.stopPropagation(),s.addToSelection(i),!0;if(i.layer===this.layer)return s.complete(),!0}return !1})):s.complete();}),u$8.WIDGET),i$1.on("key-down",(e=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,e),e.key!==e$4.snappingToggle||e.repeat||(this.snappingOptions.enabledToggled=!0,e.stopPropagation()),e.key===e$4.constraint&&!e.repeat&&s){const e=s.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio);}}),u$8.WIDGET),i$1.on("key-up",(e=>{var t;if(e.key===e$4.snappingToggle&&"reshape"===(null==s||null==(t=s.activeComponent)?void 0:t.type)&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation()),e.key===e$4.constraint&&s){const e=s.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio);}}),u$8.WIDGET)],l=this._getHandlesForComponent(s,o);return s}async _getGraphicMover(e,t,o){const{enableMoveAllGraphics:i}=t,a=await this._requireModule(import('./GraphicMover-524d7d98.js'));return X(a)?a:new a.module.default({enableMoveAllGraphics:i,graphics:e,view:o,callbacks:{onGraphicMoveStart:({dx:e,dy:t,graphic:o})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:o,type:"move-start"},type:"update"});},onGraphicMove:({dx:e,dy:t,graphic:o})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:o,type:"move"},type:"update"}),onGraphicMoveStop:({dx:e,dy:t,graphic:o})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:o,type:"move-stop"},type:"update"});},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,o){const{enableRotation:i,enableScaling:a,preserveAspectRatio:r}=t,s=await this._requireModule(import('./Box-40b12163.js'));return X(s)?s:new s.module.default({graphics:e,enableRotation:i,enableScaling:a,preserveAspectRatio:r,layer:this._internalGraphicsLayer,view:o,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(e,t,o){var i,a;const r="split"===(null==(i=t.reshapeOptions)?void 0:i.edgeOperation),s="move"===(null==(a=t.reshapeOptions)?void 0:a.shapeOperation),n=await this._requireModule(import('./Reshape-c2ebb47f.js'));return X(n)?n:new n.module.default({enableMidpoints:r,enableMovement:s,graphic:e[0],layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,view:o,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:({mover:e,type:t})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e,type:t},type:"update"}),onMoveStart:({dx:e,dy:t,mover:o,type:i})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:o,type:i},type:"update"}),onMove:({dx:e,dy:t,mover:o,type:i})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:o,type:i},type:"update"}),onMoveStop:({dx:e,dy:t,mover:o,type:i})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:o,type:i},type:"update"}),onVertexAdd:({added:e,type:t,vertices:o})=>{const i=e.map((e=>t$a(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:i,vertices:o,type:t},type:"update"});},onVertexRemove:({removed:e,type:t,vertices:o})=>{const i=e.map((e=>t$a(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:i,vertices:o,type:t},type:"update"});}}})}_getHandlesForComponent(e,t){const o=e.activeComponent;switch(o.type){case"graphic-mover":return [o.on("graphic-click",(({graphic:t,viewEvent:o})=>{var i;null!=(i=o.native)&&i.shiftKey&&(o.stopPropagation(),e.removeFromSelection(t));})),o.on("graphic-move-start",(t=>e.addToHistory(Q(t.allGraphics))))];case"box":return [o.on("graphic-click",(o=>this._onTransformOrReshape2DGraphicClick(e,t,o))),o.on("move-start",(t=>e.addToHistory(Q(t.graphics)))),o.on("rotate-start",(t=>e.addToHistory(Q(t.graphics)))),o.on("scale-start",(t=>e.addToHistory(Q(t.graphics))))];case"reshape":return [o.on("graphic-click",(o=>this._onTransformOrReshape2DGraphicClick(e,t,o))),o.on("move-start",(t=>e.addToHistory(Q([t.mover])))),o.on("reshape-start",(t=>e.addToHistory(Q([t.graphic])))),o.on("vertex-add",(t=>e.addToHistory(Q([t.oldGraphic])))),o.on("vertex-remove",(t=>e.addToHistory(Q([t.oldGraphic]))))];case"move-3d":return [o.on("graphic-move-start",(t=>{e.addToHistory(Q(t.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:t.allGraphics.length>0?t.allGraphics[0]:null,type:"move-start"},type:"update"});})),o.on("graphic-move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move"},type:"update"});})),o.on("graphic-move-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move-stop"},type:"update"});})),o.on("immediate-click",(o=>{o.shiftKey?this._toggleSelection([o.graphic],e,t):e.toggleTool();}))];case"transform-3d":return [o.on("record-undo",(({record:t})=>{e.addToHistory({updates:[t]});})),o.on("graphic-translate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"});})),o.on("graphic-translate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"});})),o.on("graphic-rotate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-start"},type:"update"});})),o.on("graphic-rotate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-stop"},type:"update"});})),o.on("graphic-scale-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"});})),o.on("graphic-scale-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"});})),o.on("graphic-translate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"});})),o.on("graphic-rotate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate"},type:"update"});})),o.on("graphic-scale",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"});})),o.on("immediate-click",(o=>{o.shiftKey?this._toggleSelection([o.graphic],e,t):e.toggleTool();}))];case"reshape-3d":return [o.on("reshape",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"});})),o.on("move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"});})),o.on("vertex-add",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"});})),o.on("vertex-remove",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"});})),o.on("immediate-click",(o=>{o.shiftKey?this._toggleSelection([o.graphic],e,t):e.toggleTool();}))];default:return}}_onTransformOrReshape2DGraphicClick(e,t,o){var i;const{graphic:a,viewEvent:r}=o;return null!=(i=r.native)&&i.shiftKey&&a.layer===this.layer?(r.stopPropagation(),e.removeFromSelection(a)):t.toggleToolOnClick?(r.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const o=this.view.map;this._disablePopup(t);const i=()=>{if(e===this._operationHandle){const i=this.updateGraphics.toArray(),a=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),o&&o.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:i,state:"complete",aborted:e.cancelled,tool:a,toolEventInfo:null,type:"update"});}};e.on("complete",i);}async _getCommonUpdateOperationClickHandlers(e,t,o){const i=t$9(t),a=(await t.async((()=>this._getFirstHit(i)))).results;if(!a.length)return void e.complete();if(t.native.shiftKey&&this._toggleSelection(a.map((e=>e.graphic)),e,o))return void t.stopPropagation();a.some((e=>e.graphic&&this.updateGraphics.includes(e.graphic)))?t.stopPropagation():e.complete();}_toggleSelection(e,t,o){const i=!!o.multipleSelectionEnabled;return e.some((e=>null!=e&&(!(!i||e.layer!==this.layer)&&(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),!0))))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const o=t.key;o===e$4.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):o===e$4.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):o===e$4.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&e$4.delete.includes(o)&&this._onDeleteKey(t);}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const t=this.activeComponent,o=this.updateGraphics.toArray();t$6(t)||"reshape-3d"===t.type||("reshape"!==t.type||1===o.length&&"point"===m$g(o[0].geometry,"type"))&&(e.stopPropagation(),this.delete());}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=l$b(this._internalGraphicsLayer));}_isComponentGraphic(e){const{activeComponent:t}=this;return !(!e||t$6(t))&&(!(!e.attributes||!e.attributes.esriSketchTool)||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_displayPointerCursor(){this.view&&this.view.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer");}_displayGrabbingCursor(){this.view&&this.view.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing");}_displayDefaultCursor(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null);}_logError(e,t,o){q.error(new s$a(e,t,o));}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const o=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:o}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"});}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"});}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"});}test(){return {operationHandle:this._operationHandle,defaultUpdateOptions:z}}wait(){return p$i(this,"updating")}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating");}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating");}_disablePopupEnabled(e){var t;return "3d"!==(null==(t=this.view)?void 0:t.type)||this.updateOnGraphicClick||r$7(e)&&e.toggleToolOnClick}_disablePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&t$6(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=t.autoOpenEnabled,t.autoOpenEnabled=!1);}_restorePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&r$7(this._originalAutoOpenEnabled)&&(t.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null);}async _waitViewReady(){this.view&&(a$f(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await P$1(a$g(this.view,"ready"),this._viewReadyAbortController.signal));}};function N(e){return "polygon"===e||"rectangle"===e||"circle"===e}function $(e,t){J("undo",e.history.undo,e.history.redo,t);}function Y(e,t){J("redo",e.history.redo,e.history.undo,t);}function J(e,t,o,i){const a=t.pop().updates,r=[];i.forEach(((t,o)=>{const i=a[o];null!=i&&("geometry"in i&&r$7(i.geometry)&&(r.push({geometry:t.geometry}),t.geometry=i.geometry),"symbol"in i&&r$7(i.symbol)&&(r.push({symbol:t.symbol}),t.symbol=i.symbol),"undo"in i&&(r.push(i),i[e](t)));})),o.push({updates:r});}function Q(e){return {updates:e.map((e=>({geometry:e.geometry})))}}function X(e){return "requireError"in e&&"aborted"===e.requireError}e$9([d$6()],B.prototype,"updating",null),e$9([d$6()],B.prototype,"_operationHandle",void 0),e$9([d$6({readOnly:!0})],B.prototype,"activeTool",null),e$9([d$6()],B.prototype,"activeFillSymbol",void 0),e$9([d$6()],B.prototype,"activeLineSymbol",void 0),e$9([d$6()],B.prototype,"activeVertexSymbol",void 0),e$9([d$6()],B.prototype,"allowDeleteKey",void 0),e$9([d$6({readOnly:!0})],B.prototype,"createGraphic",null),e$9([d$6()],B.prototype,"defaultCreateOptions",null),e$9([d$6()],B.prototype,"defaultUpdateOptions",null),e$9([d$6()],B.prototype,"layer",void 0),e$9([d$6({types:j$9})],B.prototype,"pointSymbol",void 0),e$9([d$6({types:j$9})],B.prototype,"polygonSymbol",void 0),e$9([d$6({types:j$9})],B.prototype,"polylineSymbol",void 0),e$9([d$6({type:l$7,nonNullable:!0})],B.prototype,"snappingOptions",null),e$9([d$6()],B.prototype,"_snappingManager",void 0),e$9([d$6({readOnly:!0})],B.prototype,"state",null),e$9([d$6({readOnly:!0})],B.prototype,"updateGraphics",void 0),e$9([d$6()],B.prototype,"updateOnGraphicClick",void 0),e$9([d$6({types:j$9})],B.prototype,"updatePointSymbol",void 0),e$9([d$6({types:j$9})],B.prototype,"updatePolygonSymbol",void 0),e$9([d$6({types:j$9})],B.prototype,"updatePolylineSymbol",void 0),e$9([d$6({types:j$9})],B.prototype,"vertexSymbol",void 0),e$9([d$6({value:null})],B.prototype,"view",null),e$9([d$6()],B.prototype,"cancel",null),e$9([d$6()],B.prototype,"complete",null),e$9([d$6()],B.prototype,"delete",null),e$9([d$6()],B.prototype,"create",null),e$9([d$6()],B.prototype,"update",null),e$9([d$6()],B.prototype,"undo",null),e$9([d$6()],B.prototype,"redo",null),e$9([d$6()],B.prototype,"canUndo",null),e$9([d$6()],B.prototype,"canRedo",null),e$9([d$6()],B.prototype,"toggleUpdateTool",null),B=e$9([i$8(K)],B);const ee=B;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const C$1="esri.widgets.Editor.EditorViewModel",b=s$7.getLogger(C$1),j=["create","update"];function M(e,t,a){b.error(new s$a(e,t,a));}function V(e,t){return e&&e.find((e=>e.layer===t))}let F=class extends(a$a(n$5.EventedAccessor)){constructor(e){super(e),this._sketchGraphicsLayer=new h$7({listMode:"hide",internal:!0}),this.activeWorkflow=null,this.activityQueue=[],this.failures=[],this.attachmentsViewModel=new A$1({abilities:{editing:!0}}),this.featureFormViewModel=new b$5,this.featureTemplatesViewModel=new c$7,this.layerInfos=null,this.sketchViewModel=new ee({layer:this._sketchGraphicsLayer}),this.snappingOptions=new l$7,this.spinnerViewModel=new c$d;}initialize(){this.handles.add([$$1(this,"activeWorkflow","cancel",(()=>this.emit("workflow-cancel"))),$$1(this,"activeWorkflow","commit",(()=>this.emit("workflow-commit"))),i$a(this,"view.map",(e=>{e&&e.add(this._sketchGraphicsLayer);})),f$5(this,"editableItems",(()=>{const{activeWorkflow:e}=this;if(this.refreshCreationTemplates(),!e)return;const{stepId:t}=e;"create"!==e.type?"update"===e.type&&("awaiting-feature-to-update"===t&&!this.canUpdate||"awaiting-update-feature-candidate"===t&&!e.data.candidates.some((e=>{const t=this.editableItems.find((t=>t.layer===e.layer));return t&&t.supports.indexOf("update")>-1})))&&this._cancelWorkflow():"awaiting-feature-creation-info"!==t||this.canCreate||this._cancelWorkflow();}))]);}destroy(){this._cancelWorkflow().then((()=>{var e;null!=(e=this.view)&&e.map&&this.view.map.remove(this._sketchGraphicsLayer),this.view=null;}));}get allowedWorkflows(){return this._get("allowedWorkflows")}set allowedWorkflows(e){e&&0!==e.length||(e=[...j]),this._set("allowedWorkflows",e);}get canCreate(){return this.editableItems.some((e=>e.supports.includes("create")))}get canUpdate(){return this.editableItems.some((e=>e.supports.includes("update")))}get editableItems(){var e,r,a;const o=null==(e=this.view)?void 0:e.allLayerViews;if(!o)return new S$1;const i=new Set(null==(r=this.view)||null==(a=r.map)?void 0:a.editableLayers);return o.filter((e=>i.has(e.layer))).map((e=>{const{layer:t,suspended:r}=e,{data:a,operations:o}=t.capabilities,i=V(this.layerInfos,t),s="supportsAttachment"in a&&a.supportsAttachment&&(!i||!1!==i.allowAttachments);if(r)return {hasAttachments:s,layer:t,supports:[]};const n=[];return o.supportsAdd&&this.allowedWorkflows.includes("create")&&(!i||!1!==i.enabled&&!1!==i.addEnabled)&&n.push("create"),o.supportsUpdate&&this.allowedWorkflows.includes("update")&&(!i||!1!==i.enabled&&!1!==i.updateEnabled)&&n.push("update"),!1!==(i&&i.deleteEnabled)&&o.supportsDelete&&n.push("delete"),{hasAttachments:s,layer:t,supports:n}})).reverse()}get state(){if(!this.get("view.ready")||0===this.editableItems.length)return "disabled";const e=this.attachmentsViewModel.mode;if("add"===e)return "adding-attachment";if("edit"===e)return "editing-attachment";const{activeWorkflow:t}=this;return t?t.stepId:"ready"}get syncing(){return this.activityQueue.length>0}set view(e){this.sketchViewModel.view=e,this.spinnerViewModel.view=e,this._set("view",e);}async startCreateWorkflowAtFeatureTypeSelection(){if(!this.canCreate)return void M("editing:unsupported-workflow","Create workflow is unsupported or disabled.");await this._cancelWorkflow();const e=this._createCreateWorkflow();await e.start(),this._set("activeWorkflow",e);}async startCreateWorkflowAtFeatureCreation(e){if(!this.canCreate)return void M("editing:unsupported-workflow","Create workflow is unsupported or disabled.");await this._cancelWorkflow();const t=this._createCreateWorkflow("awaiting-feature-to-create");t.data.creationInfo=e,await t.start(),this._set("activeWorkflow",t);}async startBatchCreateWorkflow(e,t="awaiting-feature-creation-info"){if(!this.canCreate)throw new s$a("editing:unsupported-workflow","Batch create workflow is unsupported or disabled.");await this._cancelWorkflow();const a=this._createBatchCreateWorkflow(e,t);await a.start(),this._set("activeWorkflow",a);}async startCreateWorkflowAtFeatureEdit(e){if(!this.canCreate)return void M("editing:unsupported-workflow","Create workflow is unsupported or disabled.");await this._cancelWorkflow();const t=this._createCreateWorkflow("editing-new-feature");t.data.edits.feature=e,await t.start(),this._set("activeWorkflow",t);}async startUpdateWorkflowAtFeatureSelection(){if(!this.canUpdate)return void M("editing:unsupported-workflow","Update workflow is unsupported or disabled.");await this._cancelWorkflow();const e=this._createUpdateWorkflow();await e.start(),this._set("activeWorkflow",e);}async startUpdateWorkflowAtMultipleFeatureSelection(e){if(!this.canUpdate)return void M("editing:unsupported-workflow","Update workflow is unsupported or disabled.");await this._cancelWorkflow();const t=this._createUpdateWorkflow("awaiting-update-feature-candidate");t.data.candidates=e,await t.start(),this._set("activeWorkflow",t);}async startUpdateWorkflowAtFeatureEdit(e){if(!this.canUpdate)return void M("editing:unsupported-workflow","Update workflow is unsupported or disabled.");await this._cancelWorkflow();const t=this._createUpdateWorkflow("editing-existing-feature");t.data.edits.feature=e,await t.start(),this._set("activeWorkflow",t);}async deleteFeatureFromWorkflow(){const{activeWorkflow:e}=this;e&&"update"===e.type?(await this._delete(e.data.edits.feature),await e.reset()):M("editing:unsupported-workflow","Deleting requires an active update workflow.");}async cancelWorkflow(e){return this._cancelWorkflow({warn:!0,...e})}refreshCreationTemplates(){const e=[];for(const{layer:t,supports:r}of this.editableItems)"templates"in t&&r.includes("create")&&e.push(t);this.featureTemplatesViewModel.layers=e;}async _cancelWorkflow(e){const t=this.activeWorkflow;if(!t)return void(e&&e.warn&&M("editing:no-active-workflow","There is no active workflow to cancel."));if(!e||!1!==e.force)return this.emit("workflow-cancel"),this._set("activeWorkflow",null),void await t.cancel(e);await t.cancel(e),this._set("activeWorkflow",null);}_createBatchCreateWorkflow(e,t){return V$2.create(this,e,t,((e,t)=>this._applyEdits(e,t)))}_createCreateWorkflow(e){return v$1.create(this,e,((e,t)=>this._applyEdits(e,t)))}_createUpdateWorkflow(e){return V$1.create(this,e,((e,t)=>this._applyEdits(e,t)))}async _delete(e){const t=e.sourceLayer;"applyEdits"in t&&await this._applyEdits(t,{deleteFeatures:[e]});}async _applyEdits(e,t){await this._queueOperation((async()=>{const r=await this.view.whenLayerView(e),a=await e.applyEdits(t);return await g$3(r,"updating"),a}));}_queueOperation(e){this.activityQueue.push(e),this.notifyChange("syncing");const t=(e,t)=>{const r=t.indexOf(e);r>-1&&t.splice(r,1);};return e().then((({addFeatureResults:e,deleteFeatureResults:t,updateFeatureResults:r})=>{const a=e.find((e=>!!e.error))||r.find((e=>!!e.error))||t.find((e=>!!e.error));if(a)throw a.error})).catch((r=>{M("editing:operation-error","An error occurred.",{error:r});const a={error:r,retry:()=>(t(a,this.failures),this._queueOperation(e)),cancel:()=>{t(a,this.failures);}};this._set("failures",[...this.failures,a]);})).then((()=>{t(e,this.activityQueue),this.notifyChange("syncing");}))}};e$9([d$6({readOnly:!0})],F.prototype,"activeWorkflow",void 0),e$9([d$6({readOnly:!0})],F.prototype,"activityQueue",void 0),e$9([d$6({value:[...j]})],F.prototype,"allowedWorkflows",null),e$9([d$6({readOnly:!0})],F.prototype,"canCreate",null),e$9([d$6({readOnly:!0})],F.prototype,"canUpdate",null),e$9([d$6({readOnly:!0})],F.prototype,"editableItems",null),e$9([d$6({readOnly:!0})],F.prototype,"failures",void 0),e$9([d$6()],F.prototype,"attachmentsViewModel",void 0),e$9([d$6()],F.prototype,"featureFormViewModel",void 0),e$9([d$6()],F.prototype,"featureTemplatesViewModel",void 0),e$9([d$6()],F.prototype,"layerInfos",void 0),e$9([d$6()],F.prototype,"sketchViewModel",void 0),e$9([o$3("sketchViewModel.snappingOptions")],F.prototype,"snappingOptions",void 0),e$9([d$6()],F.prototype,"spinnerViewModel",void 0),e$9([d$6()],F.prototype,"state",null),e$9([d$6({readOnly:!0})],F.prototype,"syncing",null),e$9([d$6()],F.prototype,"view",null),F=e$9([i$8(C$1)],F);const U=F;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const C={base:"esri-editor esri-widget esri-widget--panel",header:"esri-editor__header",scroller:"esri-editor__scroller",content:"esri-editor__content",contentGroup:"esri-editor__content-group",contentWrapper:"esri-editor__temp-wrapper",message:"esri-editor__message",controls:"esri-editor__controls",title:"esri-editor__title",backButton:"esri-editor__back-button",modeSelection:"esri-editor__mode-selection",progressBar:"esri-editor__progress-bar",warningCard:"esri-editor__warning-card",warningHeader:"esri-editor__warning-header",warningHeading:"esri-editor__warning-heading",warningMessage:"esri-editor__warning-message",warningDivider:"esri-editor__warning-divider",warningOption:"esri-editor__warning-option",warningOptionPrimary:"esri-editor__warning-option--primary",warningOptionNegative:"esri-editor__warning-option--negative",warningOptionPositive:"esri-editor__warning-option--positive",featureList:"esri-editor__feature-list",featureListItem:"esri-editor__feature-list-item",featureListItemDisabled:"esri-editor__feature-list-item--disabled",featureListName:"esri-editor__feature-list-name",featureListIcon:"esri-editor__feature-list-icon",featureListIndex:"esri-editor__feature-list-index",controlButton:"esri-editor__control-button",overlay:"esri-editor__overlay",errorIcon:"esri-icon-error2",basemapIcon:"esri-basemap",rightArrowIcon:"esri-icon-right",leftArrowIcon:"esri-icon-left",warningIcon:"esri-icon-notice-triangle",widgetIcon:"esri-icon-edit",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonSecondary:"esri-button--secondary",buttonTertiary:"esri-button--tertiary",buttonDrillIn:"esri-button--drill-in",buttonDrillInTitle:"esri-button--drill-in__title",input:"esri-input",interactive:"esri-interactive",select:"esri-select"};function T(e){e.focus();}let I=class extends(a$a(z$2)){constructor(e,t){super(e,t),this._candidateCommitted=!1,this._featureForm=new g$1,this._attachments=new A$2({visibleElements:{addSubmitButton:!1,cancelAddButton:!1,cancelUpdateButton:!1,deleteButton:!1,errorMessage:!1,progressBar:!1,updateButton:!1}}),this._featureTemplates=new b$4,this._filterText="",this._prompt=null,this._spinner=new m$h,this.activeWorkflow=null,this.allowedWorkflows=null,this.headingLevel=4,this.iconClass=C.widgetIcon,this.label=void 0,this.layerInfos=null,this.messages=null,this.messagesCommon=null,this.messagesTemplates=null,this.snappingOptions=new l$7,this.supportingWidgetDefaults=null,this.view=null,this.viewModel=new U,this._handleHeaderClickOrKeyDown=e=>{e.currentTarget["data-prevent-back"]||this._handleBack.call(this,e);},this._setCandidateFeature=(e,t=!1)=>{if(this._candidateCommitted)return;const i=this._assertActiveUpdateWorkflow();i.data.edits.feature=e,t&&(i.next(),this._candidateCommitted=!0);},this._handleSave=this._handleSave.bind(this),this._handleBack=this._handleBack.bind(this),this._handleDone=this._handleDone.bind(this),this._handleDelete=this._handleDelete.bind(this),this._handleAdd=this._handleAdd.bind(this),this._handleEdit=this._handleEdit.bind(this),this._handleAttachmentAdd=this._handleAttachmentAdd.bind(this),this._handleAttachmentUpdate=this._handleAttachmentUpdate.bind(this),this._handleAttachmentDelete=this._handleAttachmentDelete.bind(this);}initialize(){this.own([i$a(this,"headingLevel",(e=>{this._featureForm.headingLevel=e+1,this._featureTemplates.headingLevel=e+1;})),i$a(this,"viewModel",(e=>{this._featureForm.viewModel=e?e.featureFormViewModel:null,this._attachments.viewModel=e?e.attachmentsViewModel:null,this._featureTemplates.viewModel=e?e.featureTemplatesViewModel:null,this._spinner.viewModel=e?e.spinnerViewModel:null;})),i$a(this,"view",((e,t)=>{const i=`editor-${this.id}-spinner`;t&&t.ui.remove(this._spinner,i),e&&e.ui.add(this._spinner,{key:i,position:"manual"});})),$$1(this,"viewModel.sketchViewModel","create",(()=>{this.scheduleRender();})),$$1(this,"viewModel.activeWorkflow","cancel-request",(({controller:e})=>{const{messages:t,messagesCommon:i}=this;this._prompt={title:t.cancelRequestTitle,message:t.cancelRequestWarningMessage,options:[{label:i.form.no,type:"neutral",action:()=>(e.deny(),this._prompt=null)},{label:i.form.yes,type:"negative",action:()=>{e.allow(),this._prompt=null;}}]},this.scheduleRender();})),i$a(this,"supportingWidgetDefaults",(e=>{e&&(this._featureForm.set(e.featureForm),this._attachments.set(e.attachments),this._featureTemplates.set(e.featureTemplates),this.viewModel.sketchViewModel.set(e.sketch));})),f$5(this,"_attachments.error",(e=>{if(!e)return;const{messages:t,messagesCommon:i}=this;this._prompt={title:t.errorWarningTitle,message:e.message,options:[{label:i.form.ok,type:"neutral",action:()=>{this._prompt=null;}}]};})),f$5(this,"viewModel.failures",(e=>{if(!e)return;const{messages:t}=this,[{error:i,retry:r,cancel:s}]=e;this._prompt={title:t.errorWarningTitle,message:s$e(t.errorWarningMessageTemplate,{errorMessage:i.message}),options:[{label:t.retry,type:"positive",action:()=>{r(),this._prompt=null;}},{label:t.ignore,type:"neutral",action:()=>(s(),this._prompt=null)}]};})),f$5(this,"viewModel.state",(e=>{"awaiting-update-feature-candidate"===e&&(this._candidateCommitted=!1);})),f$5(this,["_attachments.selectedFile","_attachments.submitting"],(()=>this.scheduleRender())),m$i(this,"viewModel.activeWorkflow",(()=>this._featureTemplates.filterText=""))]);}destroy(){this._attachments.destroy(),this._featureForm.destroy(),this._featureTemplates.destroy();}startCreateWorkflowAtFeatureTypeSelection(){return this.viewModel.startCreateWorkflowAtFeatureTypeSelection()}startCreateWorkflowAtFeatureCreation(e){return this.viewModel.startCreateWorkflowAtFeatureCreation(e)}startCreateWorkflowAtFeatureEdit(e){return this.viewModel.startCreateWorkflowAtFeatureEdit(e)}startUpdateWorkflowAtFeatureSelection(){return this.viewModel.startUpdateWorkflowAtFeatureSelection()}startUpdateWorkflowAtMultipleFeatureSelection(e){return this.viewModel.startUpdateWorkflowAtMultipleFeatureSelection(e)}startUpdateWorkflowAtFeatureEdit(e){return this.viewModel.startUpdateWorkflowAtFeatureEdit(e)}deleteFeatureFromWorkflow(){return this.viewModel.deleteFeatureFromWorkflow()}cancelWorkflow(e){return this.viewModel.cancelWorkflow(e)}render(){const{_attachments:e,viewModel:t}=this;if(!t)return n$6("div",{class:C.base});const{state:i}=t,r=this._prompt?n$6("div",{class:C.overlay,key:"overlay"},this.renderPrompt({message:this._prompt.message,title:this._prompt.title,options:this._prompt.options})):null;return n$6("div",{class:C.base},t.syncing||e.submitting?this.renderProgressBar():null,"disabled"===i?null:"ready"===i?this.renderLanding():"awaiting-feature-creation-info"===i?this.renderTemplates():"editing-new-feature"===i||"editing-existing-feature"===i?this.renderAttributeEditing():"awaiting-feature-to-update"===i?this.renderFeatureUpdating():"awaiting-update-feature-candidate"===i?this.renderFeatureList():"awaiting-feature-to-create"===i?this.renderFeatureCreation():"adding-attachment"===i?this.renderAttachmentAdding():"editing-attachment"===i?this.renderAttachmentEditing():null,r)}renderTemplates(){return n$6("div",{class:C.contentWrapper,key:"wrapper"},this.renderHeader(this.messages.selectTemplate,!0),n$6("div",{key:"content",class:C.content},this._featureTemplates.render()))}renderAttributeEditing(){const{viewModel:e}=this,t=e.featureFormViewModel,i=this._assertActiveCreateOrUpdateWorklow(),r=i.data.edits.feature,s="update"===i.type&&!i.data.edits.modified||e.syncing||t.inputFields.length>0&&!t.valid,{messages:a,messagesCommon:n}=this,o="create"===i.type?n.add:n.update,l=[{label:o,type:"primary",disabled:s,clickHandler:this._handleSave}];let d=!1;"update"===i.type&&(i.data.editableItem.hasAttachments&&(d=!0),i.data.editableItem.supports.includes("delete")&&l.push({label:n.delete,type:"tertiary",clickHandler:this._handleDelete}));const c=this._getLabel(r);return n$6("div",{class:C.contentWrapper,key:"wrapper"},this.renderHeader(c,!0),n$6("div",{key:"content",class:this.classes(C.content,C.scroller)},n$6("div",{class:C.contentGroup},t.inputFields.length>0?this._featureForm.render():this.renderMessage(s$e(a.clickToFinishTemplate,{button:o})),d?n$6("div",{key:"attachments"},n$6("div",null,a.attachments),this._attachments.render()):null)),this.renderControls(l))}renderAttachmentAdding(){const{_attachments:e,messages:t,messagesCommon:i}=this,r=[{label:e.submitting?i.cancel:i.add,disabled:e.submitting||!e.selectedFile,type:"primary",clickHandler:this._handleAttachmentAdd}];return n$6("div",{class:C.contentWrapper,key:"wrapper"},this.renderHeader(t.addAttachment,!0,e.submitting),n$6("div",{key:"content",class:this.classes(C.content,C.scroller)},e.render()),this.renderControls(r))}renderAttachmentEditing(){const{_attachments:e,messages:t,messagesCommon:i}=this,r=[{label:i.update,disabled:e.submitting||!e.selectedFile,type:"primary",clickHandler:this._handleAttachmentUpdate},{label:i.delete,disabled:e.submitting,type:"tertiary",clickHandler:this._handleAttachmentDelete}];return n$6("div",{class:C.contentWrapper,key:"wrapper"},this.renderHeader(t.editAttachment,!0,e.submitting),n$6("div",{key:"content",class:this.classes(C.content,C.scroller)},e.render()),this.renderControls(r))}renderFeatureUpdating(){const{messages:e}=this;return n$6("div",{class:C.contentWrapper,key:"wrapper"},this.renderHeader(e.selectFeature,!0),n$6("div",{key:"content",class:this.classes(C.content,C.scroller)},this.renderMessage(e.selectFeatureToEdit)))}renderMessage(e){return n$6("div",{class:C.message},e)}renderFeatureCreation(){const{messages:e,viewModel:t}=this,i=t.sketchViewModel,r=this._assertActiveCreateWorkflow().data.creationInfo.layer,s=i.canUndo()&&i.createGraphic?i.createGraphic:null,a=this._getSketchingTip(r.geometryType,s);return n$6("div",{class:C.contentWrapper,key:"wrapper"},this.renderHeader(e.placeFeature,!0),n$6("div",{key:"content",class:this.classes(C.content,C.scroller)},this.renderMessage(a)))}renderControls(e){return n$6("div",{class:C.controls,key:"controls"},e.map((({disabled:e=!1,label:t,type:i,clickHandler:r},s)=>this.renderButton({label:t,class:this.classes(C.controlButton,C.button,"secondary"===i?C.buttonSecondary:"tertiary"===i?C.buttonTertiary:null,e?C.buttonDisabled:null),disabled:e,clickHandler:r,key:s}))))}renderPrompt({title:e,message:i,options:r=[]}){return n$6("div",{class:C.warningCard,role:"alert"},n$6("div",{class:C.warningHeader},n$6("span",{class:C.warningIcon,"aria-hidden":"true"}),n$6(s$8,{class:C.warningHeading,level:this.headingLevel},e)),n$6("div",{class:C.warningMessage},i),n$6("div",{class:C.warningDivider}),r.map((({label:e,action:i,type:r},s)=>{const a=0===s;return n$6("div",{afterCreate:a?T:null,class:this.classes(C.warningOption,a?C.warningOptionPrimary:null,"positive"===r?C.warningOptionPositive:"negative"===r?C.warningOptionNegative:null),key:s,onclick:i,onkeydown:e=>{const r=i$e(e);y$1(r)&&(e.preventDefault(),i.call(null));},tabIndex:0,role:"button"},e)})))}renderProgressBar(){return n$6("div",{class:this.classes(C.progressBar),key:"progress-bar"})}renderButton(e){return n$6("button",{class:e.class,disabled:e.disabled,key:e.key,onclick:e.clickHandler,type:"button"},e.label)}renderHeader(e,t=!1,i=!1){const{messagesCommon:r}=this;return n$6("header",{class:C.header,key:"header"},t?n$6("div",{"aria-label":r.back,class:this.classes(C.backButton,C.interactive,i?C.buttonDisabled:null),key:"back-button","data-prevent-back":i,onclick:this._handleHeaderClickOrKeyDown,onkeydown:this._handleHeaderClickOrKeyDown,role:"button",tabIndex:0,title:r.back},n$6("span",{"aria-hidden":"true",class:d$a(this.container)?C.rightArrowIcon:C.leftArrowIcon})):null,n$6(s$8,{class:C.title,level:this.headingLevel},e))}renderLanding(){const{messages:e}=this,{allowedWorkflows:t,canCreate:i,canUpdate:r}=this.viewModel,s=d$a(this.container)?C.leftArrowIcon:C.rightArrowIcon;return n$6("div",{class:C.contentWrapper,key:"wrapper"},this.renderHeader(e.widgetLabel),n$6("div",{key:"content",class:C.content,role:"group"},n$6("div",{class:C.modeSelection,key:"mode-selection"},t.indexOf("update")>-1?n$6("div",{"aria-disabled":r?"false":"true",class:this.classes(C.featureListItem,r?null:C.featureListItemDisabled),key:"update",onclick:this._handleEdit,onkeydown:this._handleEdit,role:"button",tabIndex:r?0:-1},n$6("span",{class:C.featureListName},e.editFeature),n$6("span",{"aria-hidden":"true",class:this.classes(C.featureListIcon,s)})):null,t.indexOf("create")>-1?n$6("div",{class:this.classes(C.featureListItem,i?null:C.featureListItemDisabled),key:"create",onclick:this._handleAdd,onkeydown:this._handleAdd,role:"button",tabIndex:i?0:-1},n$6("span",{class:C.featureListName},e.addFeature),n$6("span",{"aria-hidden":"true",class:this.classes(C.featureListIcon,s)})):null)))}renderFeatureList(){const{messages:e,messagesTemplates:t,viewModel:{editableItems:i}}=this,r=this._assertActiveUpdateWorkflow().data.candidates,s=s$e(e.multipleFeaturesTemplate,{total:r.length}),a=new Map;r.map((e=>({label:this._getLabel(e),id:e.attributes[e.layer.objectIdField],data:e}))).filter((e=>{const{label:t,data:i}=e,r=this._filterText.toLowerCase(),{title:s}=i.layer,a=this.viewModel.editableItems.find((e=>e.layer===i.layer));return a.supports.indexOf("update")>-1&&(!r||t.toLowerCase().indexOf(r)>-1||s.toLowerCase().indexOf(r)>-1)})).forEach((e=>{const t=e.data.layer;a.has(t)?a.get(t).items.push(e):a.set(t,{id:`${t.id}`,label:t.title,items:[e]});}));const n=i.filter((({layer:e})=>a.has(e))).map((({layer:e})=>a.get(e))).toArray();return n$6("div",{class:C.contentWrapper,key:"wrapper"},this.renderHeader(s,!0),n$6("div",{key:"content",class:this.classes(C.content,C.scroller)},l$3({id:this.id,filterText:this._filterText,items:n,messages:{filterPlaceholder:t.filterPlaceholder,noItems:t.noItems,noMatches:t.noMatches},onItemMouseEnter:({data:e})=>this._setCandidateFeature(e),onItemMouseLeave:()=>this._setCandidateFeature(null),onItemSelect:({data:e})=>this._setCandidateFeature(e,!0),onFilterChange:e=>this._filterText=e})))}_getSketchingTip(e,t){const{messages:i}=this;if("point"===e)return i.tips.clickToAddPoint;if("polygon"===e||"polyline"===e){if(!t)return i.tips.clickToStart;const r=t.geometry,s="polygon"===e?"rings":"paths",[a]=r[s];return "polygon"===e&&a<4?i.tips.clickToContinue:i.tips.clickToContinueThenDoubleClickToEnd}return i.tips.clickToAddFeature}_getLabel(e){const t=e.layer,{objectIdField:i}=t,{attributes:r}=e,s=h$8(t);return s&&r[s]&&`${r[s]}`||s$e(this.messages.untitledFeatureTemplate,{id:r[i]})}_handleDelete(){const{messages:e,messagesCommon:t}=this;this._prompt={title:e.deleteWarningTitle,message:e.deleteWarningMessage,options:[{label:e.keepFeature,type:"neutral",action:()=>this._prompt=null},{label:t.delete,type:"positive",action:()=>{this.viewModel.deleteFeatureFromWorkflow(),this._prompt=null;}}]};}_handleSave(){this.viewModel.activeWorkflow.commit();}_handleAttachmentAdd(){const{_attachments:e}=this,{activeWorkflow:t}=this.viewModel;e.addAttachment().then((()=>t.previous()));}_handleAttachmentUpdate(){const{_attachments:e}=this,{activeWorkflow:t}=this.viewModel;e.updateAttachment().then((()=>t.previous()));}_handleAttachmentDelete(){const{messages:e,messagesCommon:t}=this;this._prompt={title:e.deleteAttachmentWarningTitle,message:e.deleteAttachmentWarningMessage,options:[{label:e.keepAttachment,type:"neutral",action:()=>this._prompt=null},{label:t.delete,type:"positive",action:()=>{const{_attachments:e}=this,{activeWorkflow:t}=this.viewModel;e.deleteAttachment(e.viewModel.activeAttachmentInfo).then((()=>{t.previous(),this._prompt=null;}));}}]};}_handleAdd(){this.viewModel.canCreate&&this.viewModel.startCreateWorkflowAtFeatureTypeSelection();}_handleEdit(){this.viewModel.canUpdate&&this.viewModel.startUpdateWorkflowAtFeatureSelection();}_handleDone(){this.viewModel.cancelWorkflow({force:!0});}_handleBack(){const{messages:e}=this,t=this._assertActiveCreateOrUpdateWorklow(),{stepId:i,data:r,type:s}=t,a=()=>{t.hasPreviousStep?t.previous({cancelCurrentStep:!0}):this.viewModel.cancelWorkflow({force:!0});};if("editing-new-feature"===i||"editing-existing-feature"===i&&r.edits.modified){const t="create"===s?e.cancelAddWarningMessage:e.cancelEditWarningMessage,i="create"===s?e.cancelAddTitle:e.cancelEditTitle,r="create"===s?e.continueAdding:e.continueEditing,n="create"===s?e.discardFeature:e.discardEdits;this._prompt={title:i,message:t,options:[{label:r,type:"neutral",action:()=>this._prompt=null},{label:n,type:"negative",action:()=>{a(),this._prompt=null;}}]};}else a();}_assertActiveCreateWorkflow(){if("create"===this.viewModel.activeWorkflow.type)return this.viewModel.activeWorkflow;throw Error("Expected activeWorkflow to be a CreateWorkflow")}_assertActiveUpdateWorkflow(){if("update"===this.viewModel.activeWorkflow.type)return this.viewModel.activeWorkflow;throw Error("Expected activeWorkflow to be an UpdateWorkflow")}_assertActiveCreateOrUpdateWorklow(){switch(this.viewModel.activeWorkflow.type){case"create":case"update":return this.viewModel.activeWorkflow}throw Error("Expected activeWorkflow to be either CreateWorkflow or UpdateWorkflow")}};e$9([d$6()],I.prototype,"_attachments",void 0),e$9([o$3("viewModel.activeWorkflow")],I.prototype,"activeWorkflow",void 0),e$9([o$3("viewModel.allowedWorkflows")],I.prototype,"allowedWorkflows",void 0),e$9([d$6()],I.prototype,"headingLevel",void 0),e$9([d$6()],I.prototype,"iconClass",void 0),e$9([d$6({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],I.prototype,"label",void 0),e$9([o$3("viewModel.layerInfos")],I.prototype,"layerInfos",void 0),e$9([d$6(),e$a("esri/widgets/Editor/t9n/Editor")],I.prototype,"messages",void 0),e$9([d$6(),e$a("esri/t9n/common")],I.prototype,"messagesCommon",void 0),e$9([d$6(),e$a("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],I.prototype,"messagesTemplates",void 0),e$9([o$3("viewModel.snappingOptions")],I.prototype,"snappingOptions",void 0),e$9([d$6()],I.prototype,"supportingWidgetDefaults",void 0),e$9([o$3("viewModel.view")],I.prototype,"view",void 0),e$9([d$6(),t$5(["workflow-cancel","workflow-commit"])],I.prototype,"viewModel",void 0),e$9([t$b()],I.prototype,"_handleDelete",null),e$9([t$b()],I.prototype,"_handleAttachmentAdd",null),e$9([t$b()],I.prototype,"_handleAttachmentUpdate",null),e$9([t$b()],I.prototype,"_handleAttachmentDelete",null),e$9([t$b()],I.prototype,"_handleAdd",null),e$9([t$b()],I.prototype,"_handleEdit",null),e$9([t$b()],I.prototype,"_handleDone",null),e$9([t$b()],I.prototype,"_handleBack",null),I=e$9([i$8("esri.widgets.Editor")],I);const L=I;

const arcgisEditorCss = "@import url('https://js.arcgis.com/next/esri/themes/light/main.css');";

let ArcGISEditor = class {
  constructor(hostRef) {
    registerInstance(this, hostRef);
    this.loaded = createEvent(this, "loaded", 7);
    this.position = 'bottom-left';
  }
  validateAllowedWorkflows(value) {
    if (value && this.widget) {
      this.widget.allowedWorkflows = value.split(',');
    }
  }
  validateView(value) {
    if (value) {
      this.widget.view = value;
      if (this.el.parentElement.tagName.toLowerCase() !== 'arcgis-expand') {
        this.widget.view.ui.add(this.widget, this.position);
      }
    }
  }
  componentWillLoad() {
    const params = {
      container: this.el,
    };
    if (this.allowedWorkflows) {
      params.allowedWorkflows = this.allowedWorkflows.split(',');
    }
    if (this.view) {
      params.view = this.view;
    }
    const widget = new L(params);
    this.widget = widget;
    this.loaded.emit(true);
  }
  get el() { return getElement(this); }
  static get watchers() { return {
    "allowedWorkflows": ["validateAllowedWorkflows"],
    "view": ["validateView"]
  }; }
};
ArcGISEditor.style = arcgisEditorCss;

export { ArcGISEditor as A, i$4 as a, s$2 as b, c$4 as c, i$5 as d, e$1 as e, f$1 as f, f as g, i$6 as h, i$1 as i, e$7 as j, s$4 as k, l, m$3 as m, n$1 as n, l$1 as o, p$b as p, r as q, r$1 as r, s$1 as s, t$1 as t, u$2 as u, e$4 as v, e$3 as w, m$1 as x, e$2 as y, p$1 as z };
