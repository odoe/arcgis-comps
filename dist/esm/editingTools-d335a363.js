import { e as e$2, A as r$5, af as t$9, ct as i$4, cs as h$9, u as u$6, V as e$5, aW as c$8, a as i$6, dB as t$e, p as p$9, d as d$7, i as i$7, r as n$a, bN as r$f, cp as n$c, ai as l$a, dC as o$b, K as s$9, S as S$7, bo as s$a, aI as A$6, cR as n$e, aE as b$8 } from './messageBundle-f75b4090.js';
import { p as p$7, g as f$4, l as l$8, h as i$8, j as e$8, r as r$h, k as s$6, c as c$a, t as t$g, f as f$7, n as n$d, o as l$d } from './arcgis-editor-c0835cea.js';
import { x as x$3 } from './ElevationInfo-be94499b.js';
import { h as h$b } from './Color-d1b9b54f.js';
import { o as o$7, c as c$6, M as M$4, r as r$6, I as I$3, q as q$2, a as j$4, _ as _$2, u as u$5, f as y$5, F as F$2, E as D$6, B as a$8, v as v$5, e as e$6, t as a$9, y as y$6, d as d$8, h as r$e, s as s$8, z as z$6, S as S$6, H as H$2, i as p$b, m as m$b, g as x$7, a7 as R$4, V as b$9 } from './mathUtils-e16f9389.js';
import { n as n$6, b as t$c, r as r$7, f as f$8 } from './common-d5b993de.js';
import { r as r$8, t as t$d } from './vec4f32-d544d091.js';
import { D as o$8, aM as p$5, aN as d$5, aO as g$5, aP as l$5, aQ as s$4, au as W$2, P as P$7, n as n$9, W as W$3, aR as r$b, aF as m$8, a1 as h$a, aS as a$a, ax as j$6, u as l$9, aw as b$5, av as d$9, aT as h$c, aI as h$d } from './ColorMaterial-cf44e08d.js';
import { v as v$3, h as h$8, j as j$3, m as m$7, l as l$6 } from './lineSegment-4881dbd9.js';
import { P as P$6, j as j$5, d as d$6, p as p$6, b as a$c, h as h$e } from './sphere-c3d60863.js';
import { t as t$b, c as c$7 } from './LineVisualElement-7e3bfc5b.js';
import { n as n$8 } from './vec2f64-35868783.js';
import { n as n$7, r as r$a, e as e$7 } from './vec4f64-2ec4ac08.js';
import { p as p$4, v as v$4, D as D$7, W as W$4 } from './plane-f3c19202.js';
import { t as t$a } from './glUtil-240efd97.js';
import { A as A$5 } from './InterleavedLayout-4358b016.js';
import { c as c$5, x as x$5, r as r$i, R as R$3, e as e$9, f as f$6, q as q$4, b as b$7, i as i$9, m as m$d } from './mat4-f34c6460.js';
import { e as e$4, r as r$j, a as a$e } from './mat4f64-677a419d.js';
import { a as a$7, t as t$4, n as n$4, e as e$3, b as t$5, c as t$6, d as n$5, f as t$8, o as o$9, aE as z$5, aF as E$2, i as i$3, m as b$4 } from './Texture-1e5e4be2.js';
import { o as o$6, s as s$7 } from './CameraSpace.glsl-6a9b6d21.js';
import { g as g$4, t as t$7, r as r$4 } from './OrderIndependentTransparency-3e6c26be.js';
import { f as f$3, h as h$7 } from './FramebufferObject-3d2e79da.js';
import { D as D$5 } from './Util-68fde664.js';
import { i as i$5, d as d$a, l as l$b, x as x$6 } from './screenUtils-9bb7e30c.js';
import { v as v$6, o as o$a, l as l$7, r as r$9, s as s$5, B as B$3, j as j$8, f as f$9, M as M$8 } from './vec2-5672471e.js';
import { b as gn, x as xn, w as wn, o as on } from './projection-f3d8779d.js';
import { M as M$5, B as B$2, a as a$b, _ as _$3 } from './aaBoundingBox-876621e6.js';
import { c as c$9, t as t$f, f as f$5 } from './vectorStacks-9205ea46.js';
import { T as T$2 } from './intersectorUtils-8d04b3d1.js';
import { y as y$7 } from './RightAngleQuadVisualElement-dedbfc92.js';
import { r as r$c, e as e$a } from './SnappingContext-78e35b42.js';
import { y as y$8, p as p$8, q as q$5 } from './colorUtils-ed185d63.js';
import { v as v$7 } from './dehydratedFeatures-7a1dd0b3.js';
import { r as r$d } from './Identifiable-da047c47.js';
import { g as g$6 } from './geometryDataUtils-7e4c8d4a.js';
import { q as q$3, Y as Y$2, d as d$b, O as O$6, j as j$7, v as v$a, y as y$a, i as it, s as st$1, a as jt, b as at, o as ot$1, c as vt, P as Pt, Z as Ze, W as We, Q as Qe, K as Ke, t as tt } from './sliceToolUtils-fa4900f3.js';
import { O as O$5, M as M$6, x as x$4, n as n$b, r as r$g, b as b$6, y as y$9, z as z$7, m as m$9, a as M$7, p as p$a, D as D$8, q as q$6, d as c$b, e as c$c, S as S$8, v as v$9 } from './drawSurfaces-747daa60.js';
import { a as a$d, d as d$c } from './HandleOwner-88326c19.js';
import { F as F$3 } from './aaBoundingRect-9468599b.js';
import './mat3-6a23d9ad.js';
import './quatf64-b9feea68.js';
import './quat-2d7a417b.js';
import './vec3f32-109cf143.js';
import { v as v$8 } from './GraphicManipulator-3b7bea3e.js';
import { l as l$c, z as z$8, e as e$b, t as t$h, i as i$b, a as i$c } from './EditGeometryOperations-2cb8256d.js';
import { m as m$a } from './geometry-7e07b1ba.js';
import { w as w$3 } from './utils-c84cc443.js';
import { S as S$9 } from './mathUtils-8e5ad7fe.js';
import { i as i$a, m as m$c } from './reactiveUtils-8f9c3a3d.js';
import { v as v$b, l as l$e } from './axisAngleDegrees-8d7a62d6.js';
import { H as H$3 } from './unitUtils-38774114.js';
import { K, G as G$5, D as D$9 } from './boundedPlane-030abe8d.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function a$6(a,t){a.extensions.add("GL_OES_standard_derivatives"),a.fragment.include(a$7),a.include(o$6),a.fragment.uniforms.add("glowColor","vec3"),a.fragment.uniforms.add("glowWidth","float"),a.fragment.uniforms.add("glowFalloff","float"),a.fragment.uniforms.add("innerColor","vec3"),a.fragment.uniforms.add("innerWidth","float"),a.fragment.uniforms.add("depthMap","sampler2D"),a.fragment.uniforms.add("nearFar","vec2"),a.fragment.uniforms.add("frameColor","sampler2D"),t.contrastControlEnabled&&a.fragment.uniforms.add("globalAlphaContrastBoost","float"),a.fragment.code.add(t$4`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),a.fragment.code.add(t$4`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),a.fragment.code.add(t$4`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),a.fragment.code.add(t$4`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
float depth = linearDepthFromTexture(depthMap, uv, nearFar);
if (-depth == nearFar[0]) {
return false;
}
pos = reconstructPosition(gl_FragCoord.xy, depth);
normal = normalize(cross(dFdx(pos), dFdy(pos)));
float ddepth = fwidth(depth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);
return true;
}`),t.contrastControlEnabled?a.fragment.code.add(t$4`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`):a.fragment.code.add(t$4`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function a$5(a){const t=new n$4;return t.include(a$6,a),t.vertex.uniforms.add("uModelViewMatrix","mat4"),t.vertex.uniforms.add("uProjectionMatrix","mat4"),t.attributes.add("start","vec3"),t.attributes.add("end","vec3"),t.attributes.add("up","vec3"),t.attributes.add("extrude","vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),t.vertex.uniforms.add("glowWidth","float"),t.vertex.uniforms.add("pixelToNDC","vec2"),t.vertex.code.add(t$4`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = uModelViewMatrix * vec4(pos, 1);
vec4 projPos = uProjectionMatrix * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (uModelViewMatrix * vec4(start, 1)).xyz;
vViewEnd = (uModelViewMatrix * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),t.fragment.uniforms.add("globalAlpha","float"),t.fragment.uniforms.add("perScreenPixelRatio","float"),t.fragment.code.add(t$4`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));
gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),t}const t$3=Object.freeze({__proto__:null,build:a$5});

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class p$3 extends t$6{initializeProgram(r){const o=p$3.shader.get(),t=this.configuration,i=o.build(t);return new n$5(r.rctx,i,p$3.attributeLocations)}bind(r,t,i){this.program.setUniform3fv("innerColor",r.innerColor),this.program.setUniform1f("innerWidth",r.innerWidth*i.pixelRatio),this.program.setUniform3fv("glowColor",r.glowColor),this.program.setUniform1f("glowWidth",r.glowWidth*i.pixelRatio),this.program.setUniform1f("glowFalloff",r.glowFalloff),this.program.setUniform1f("globalAlpha",r.globalAlpha),this.program.setUniform1f("perScreenPixelRatio",i.perScreenPixelRatio),this.program.setUniform2f("pixelToNDC",2/i.fullWidth,2/i.fullHeight),this.program.setUniformMatrix4fv("uProjectionMatrix",i.projectionMatrix),c$5(c$4,i.viewMatrix,t),this.program.setUniformMatrix4fv("uModelViewMatrix",c$4),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=r.globalAlphaContrastBoost?r.globalAlphaContrastBoost:1);}initializePipeline(){return g$4({blending:t$7(1,771),colorWrite:r$4})}}p$3.shader=new t$8(t$3,(()=>import('./LaserlinePath.glsl-b106f425.js'))),p$3.attributeLocations=new Map([["start",0],["end",1],["up",2],["extrude",3]]);class g$3 extends t$5{constructor(){super(...arguments),this.contrastControlEnabled=!1;}}e$2([e$3()],g$3.prototype,"contrastControlEnabled",void 0);const c$4=e$4();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class c$3{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=n$6(),this._dirty=!1,this._count=0,this._vao=null;}set vertices(e){const t=new Float64Array(3*e.length);let r=0;for(const s of e)t[r++]=s[0],t[r++]=s[1],t[r++]=s[2];this.buffers=[t];}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);o$7(this._origin,e[t+0],e[t+1],e[t+2]);}else o$7(this._origin,0,0,0);this._dirty=!0;}get origin(){return this._origin}draw(t){const r=this.ensureVAO(t);r$5(r)&&(t.bindVAO(r),t.drawArrays(4,0,this._count));}dispose(){r$5(this._vao)&&this._vao.dispose();}ensureVAO(e){return t$9(this._buffers)?null:(t$9(this._vao)&&(this._vao=this.createVAO(e,this._buffers)),this.ensureVertexData(this._vao,this._buffers),this._vao)}createVAO(e,t){const r=this.createDataBuffer(t);return this._dirty=!1,new f$3(e,p$3.attributeLocations,{data:t$a(d$4)},{data:h$7.createVertex(e,35044,r)})}ensureVertexData(e,t){if(!this._dirty)return;const r=this.createDataBuffer(t);e.vertexBuffers.data.setData(r),this._dirty=!1;}numberOfRenderVertices(e){return 3*(2*(e.length/3-1))}createDataBuffer(e){const t=e.reduce(((e,t)=>e+this.numberOfRenderVertices(t)),0);this._count=t;const i=d$4.createBuffer(t),o=this._origin;let u=0,f=0;for(const n of e){for(let e=0;e<n.length;e+=3){const t=o$7(l$4,n[e+0],n[e+1],n[e+2]);0===e?f=this._renderCoordsHelper.getAltitude(t):this._renderCoordsHelper.setAltitude(t,f);const a=this._renderCoordsHelper.worldUpAtPosition(t,h$6),c=u+2*e,d=c$6(l$4,t,o);if(e<n.length-3){i.up.setVec(c,a),i.up.setVec(c+3,a),i.up.setVec(c+5,a);for(let e=0;e<6;e++)i.start.setVec(c+e,d);i.extrude.setValues(c+0,0,-1),i.extrude.setValues(c+1,1,-1),i.extrude.setValues(c+2,1,1),i.extrude.setValues(c+3,0,-1),i.extrude.setValues(c+4,1,1),i.extrude.setValues(c+5,0,1);}if(e>0){i.up.setVec(c-2,a),i.up.setVec(c-4,a),i.up.setVec(c-5,a);for(let e=-6;e<0;e++)i.end.setVec(c+e,d);}}u+=this.numberOfRenderVertices(n);}return i.buffer}}const h$6=n$6(),l$4=n$6(),d$4=A$5().vec3f("start").vec3f("end").vec3f("up").vec2f("extrude");

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const l$3=M$4(6);function o$5(e){const l=new n$4;return l.extensions.add("GL_OES_standard_derivatives"),l.include(o$8),l.include(a$6,e),l.fragment.uniforms.add("angleCutoff","vec2"),l.fragment.uniforms.add("globalAlpha","float"),e.heightManifoldEnabled&&l.fragment.uniforms.add("heightPlane","vec4"),e.pointDistanceEnabled&&l.fragment.uniforms.add("pointDistanceSphere","vec4"),e.lineVerticalPlaneEnabled&&l.fragment.uniforms.add("lineVerticalPlane","vec4").add("lineVerticalStart","vec3").add("lineVerticalEnd","vec3"),(e.heightManifoldEnabled||e.pointDistanceEnabled||e.lineVerticalPlaneEnabled)&&l.fragment.uniforms.add("maxPixelDistance","float"),e.intersectsLineEnabled&&l.fragment.uniforms.add("intersectsLineStart","vec3").add("intersectsLineEnd","vec3").add("intersectsLineDirection","vec3").add("intersectsLineRadius","float").add("perScreenPixelRatio","float"),(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)&&l.fragment.code.add(t$4`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.pointDistanceEnabled&&l.fragment.code.add(t$4`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.intersectsLineEnabled&&l.fragment.code.add(t$4`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&l.fragment.code.add(t$4`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),l.fragment.code.add(t$4`void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),e.heightManifoldEnabled&&l.fragment.code.add(t$4`{
float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));
vec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));
color = max(color, heightManifoldColor * heightManifoldAlpha);
}`),e.pointDistanceEnabled&&l.fragment.code.add(t$4`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`),e.lineVerticalPlaneEnabled&&l.fragment.code.add(t$4`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`),e.intersectsLineEnabled&&l.fragment.code.add(t$4`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`),l.fragment.code.add(t$4`gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),l}const s$3=Object.freeze({__proto__:null,defaultAngleCutoff:l$3,build:o$5});

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class d$3 extends t$6{initializeProgram(o){const t=d$3.shader.get(),e=this.configuration,r=t.build(e);return new n$5(o.rctx,r,o$9)}bind(o,e){this.program.setUniform3fv("innerColor",o.innerColor),this.program.setUniform1f("innerWidth",o.innerWidth*e.pixelRatio),this.program.setUniform3fv("glowColor",o.glowColor),this.program.setUniform1f("glowWidth",o.glowWidth*e.pixelRatio),this.program.setUniform1f("glowFalloff",o.glowFalloff),this.program.setUniform1f("globalAlpha",o.globalAlpha),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=o.globalAlphaContrastBoost?o.globalAlphaContrastBoost:1);const r=null!=o.angleCutoff?o.angleCutoff:l$3;this.program.setUniform2f("angleCutoff",Math.cos(r),Math.cos(Math.max(0,r-M$4(2)))),this.configuration.intersectsLineEnabled&&this.program.setUniform1f("perScreenPixelRatio",e.perScreenPixelRatio);}initializePipeline(){return g$4({blending:t$7(1,771),colorWrite:r$4})}}d$3.shader=new t$8(s$3,(()=>import('./Laserlines.glsl-e68182ea.js')));class c$2 extends t$5{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.contrastControlEnabled=!1;}}e$2([e$3()],c$2.prototype,"heightManifoldEnabled",void 0),e$2([e$3()],c$2.prototype,"pointDistanceEnabled",void 0),e$2([e$3()],c$2.prototype,"lineVerticalPlaneEnabled",void 0),e$2([e$3()],c$2.prototype,"intersectsLineEnabled",void 0),e$2([e$3()],c$2.prototype,"contrastControlEnabled",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const y$4=n$6(),I$2=n$7(),O$4={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:M$4(6),globalAlphaContrastBoost:2};function H$1(e,t,i,n){const s=y$4,r=I$2;I$3(s,t,n),r$6(r,i),r[3]=0,y$5(r,r,n),v$4(s,r,e);}class z$4{constructor(e,t={},i={contrastControlEnabled:!1}){this._renderCoordsHelper=e,this._config=i,this._technique=null,this._projInfo=n$7(),this._zScale=n$8(),this._heightManifoldEnabled=!1,this._heightManifoldTarget=n$6(),this._pointDistanceEnabled=!1,this._pointDistanceOrigin=n$6(),this._pointDistanceTarget=n$6(),this._lineVerticalPlaneEnabled=!1,this._lineVerticalPlaneSegment=v$3(),this._intersectsLineEnabled=!1,this._intersectsLineSegment=v$3(),this._intersectsLineRadius=3,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._tempNormal=n$6(),this._tempDir=n$6(),this._tempUp=n$6(),this._tempVec3A=n$6(),this._tempVec3B=n$6(),this._tempVec4=n$7(),this._tempPlane=p$4(),this._tempSphere=P$6(),this._params=z$5(t,O$4);}get renderSlots(){return [this._config.contrastControlEnabled?15:14]}get needsLinearDepth(){return !0}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender());}get heightManifoldTarget(){return this._heightManifoldTarget}set heightManifoldTarget(e){r$6(this._heightManifoldTarget,e),this._requestRender();}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender());}get pointDistanceTarget(){return this._pointDistanceTarget}set pointDistanceTarget(e){r$6(this._pointDistanceTarget,e),this._requestRender();}get pointDistanceOrigin(){return this._pointDistanceOrigin}set pointDistanceOrigin(e){r$6(this._pointDistanceOrigin,e),this._requestRender();}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender());}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){h$8(e,this._lineVerticalPlaneSegment),this._requestRender();}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender());}get intersectsLineSegment(){return this._intersectsLineSegment}set intersectsLineSegment(e){h$8(e,this._intersectsLineSegment),this._requestRender();}get intersectsLineRadius(){return this._intersectsLineRadius}set intersectsLineRadius(e){e!==this._intersectsLineRadius&&(this._intersectsLineRadius=e,this._requestRender());}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender());}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,r$5(this._pathVerticalPlaneData)&&this._requestRender());}set pathVerticalPlaneVertices(e){t$9(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new c$3(this._renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender();}set pathVerticalPlaneBuffers(e){t$9(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new c$3(this._renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender();}setParameters(e){E$2(this._params,e)&&this._requestRender();}initializeRenderContext(e){this._context=e;const t=e.renderContext.rctx;this._quadVAO=i$3(t),this._techniqueRepository=e.shaderTechniqueRep,this._techniqueConfig=new c$2;const i=new g$3;i.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(p$3,i);}uninitializeRenderContext(){this._quadVAO=i$4(this._quadVAO),this._technique=h$9(this._technique),this._pathVerticalPlaneData=i$4(this._pathVerticalPlaneData),this._pathTechnique=h$9(this._pathTechnique);}render(e){const t=this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled,i=this.pathVerticalPlaneEnabled;if(!t&&!i)return !1;const n=e.camera;return D$5(n.projectionMatrix,n.fullWidth,n.fullHeight,this._projInfo,this._zScale),t&&this.renderUnified(e),i&&this.renderPath(e),!0}renderUnified(e){const t=e.rctx,i=this._selectTechnique(),n=i.program;t.useProgram(n),i.bindPipelineState(t),this._bindGlobalUniforms(e,n),this.bindHeightManifoldUniforms(e,n),this.bindPointDistanceUniforms(e,n),this.bindLineVerticalPlaneUniforms(e,n),this.bindIntersectsLineUniforms(e,n),i.bind(this._params,e.camera),t.bindVAO(this._quadVAO),t.drawArrays(5,0,4);}renderPath(e){if(t$9(this._pathVerticalPlaneData)||t$9(this._pathTechnique))return;const t=e.rctx,n=this._pathTechnique,s=n.program;t.useProgram(s),n.bindPipelineState(t),this._bindGlobalUniforms(e,s),n.bind(this._params,this._pathVerticalPlaneData.origin,e.camera),this._pathVerticalPlaneData.draw(e.rctx);}bindHeightManifoldUniforms(e,t){if(!this.heightManifoldEnabled)return;const i=this._tempVec3A,n=this._tempPlane;this._renderCoordsHelper.worldUpAtPosition(this._heightManifoldTarget,i),H$1(n,this._heightManifoldTarget,i,e.camera.viewMatrix),t.setUniform4fv("heightPlane",n);}bindPointDistanceUniforms(e,t){if(!this._pointDistanceEnabled)return;const i=e.camera,n=this._tempSphere;r$6(n,this._pointDistanceOrigin),I$3(n,n,i.viewMatrix),n[3]=q$2(this._pointDistanceOrigin,this._pointDistanceTarget),t.setUniform4f("pointDistanceSphere",n[0],n[1],n[2],n[3]);}bindLineVerticalPlaneUniforms(e,t){if(!this._lineVerticalPlaneEnabled)return;const i=this._renderCoordsHelper,n=e.camera,s=this._tempPlane,r=this._tempVec3A,l=this._tempUp,d=this._tempDir,m=this._tempNormal;j$3(this._lineVerticalPlaneSegment,.5,r),i.worldUpAtPosition(r,l),j$4(d,this._lineVerticalPlaneSegment.vector),_$2(m,l,d),j$4(m,m),H$1(s,this._lineVerticalPlaneSegment.origin,m,n.viewMatrix),t.setUniform4fv("lineVerticalPlane",s);const p=this._tempVec3A;r$6(p,this._lineVerticalPlaneSegment.origin),i.setAltitude(p,0),I$3(p,p,n.viewMatrix),t.setUniform3fv("lineVerticalStart",p);const f=this._tempVec3B;u$5(f,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector),i.setAltitude(f,0),I$3(f,f,n.viewMatrix),t.setUniform3fv("lineVerticalEnd",f);}bindIntersectsLineUniforms(e,t){if(!this._intersectsLineEnabled)return;const i=B$1,n=G$4;if(this._intersectsLineInfinite){const t=e.camera;if(p$5(j$5(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),k$3),k$3.c0=-Number.MAX_VALUE,!d$5(t.frustum,k$3))return;g$5(k$3,i),l$5(k$3,n);}else r$6(i,this._intersectsLineSegment.origin),u$5(n,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);const s=this._tempVec3A;I$3(s,i,e.camera.viewMatrix),t.setUniform3fv("intersectsLineStart",s);const r=this._tempVec4;r$6(r,this._intersectsLineSegment.vector),this._tempVec4[3]=0,y$5(this._tempVec4,this._tempVec4,e.camera.viewMatrix),I$3(n,n,e.camera.viewMatrix),t.setUniform3fv("intersectsLineEnd",n),j$4(r,r),t.setUniform3f("intersectsLineDirection",r[0],r[1],r[2]),t.setUniform1f("intersectsLineRadius",this._intersectsLineRadius);}_bindGlobalUniforms(e,t){const i=e.camera;t.setUniform4fv("projInfo",this._projInfo),t.setUniform2fv("zScale",this._zScale),t.setUniform2f("nearFar",i.near,i.far),this._heightManifoldEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._heightManifoldTarget)):this._pointDistanceEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin)),t.bindTexture(e.offscreenRenderingHelper.linearDepthTexture,"depthMap"),t.bindTexture(e.offscreenRenderingHelper.mainColorTexture,"frameColor");}_requestRender(){this._context&&this._context.requestRender();}_selectTechnique(){return this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._technique=this._techniqueRepository.releaseAndAcquire(d$3,this._techniqueConfig,this._technique),this._technique}}const k$3=s$4(),B$1=n$6(),G$4=n$6();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class o$4 extends t$b{constructor(e){super(e.view),this._angleCutoff=l$3,this._style={},this._heightManifoldTarget=n$6(),this._heightManifoldEnabled=!1,this._intersectsLine=v$3(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProps(e);}get testData(){return this.renderer}createResources(){this.ensureRenderer();}destroyResources(){this.disposeRenderer();}updateVisibility(){this.syncHeightManifold(),this.syncIntersectsLine(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance();}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff());}get style(){return this._style}set style(e){this._style=e,this.syncStyle();}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(t){r$5(t)?(r$6(this._heightManifoldTarget,t),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this.syncRenderer(),this.syncHeightManifold();}set intersectsWorldUpAtLocation(e){if(t$9(e))return void(this.intersectsLine=null);const i=this.view.renderCoordsHelper.worldUpAtPosition(e,f$2);this.intersectsLine=m$7(e,i),this.intersectsLineInfinite=!0;}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(t){r$5(t)?(h$8(t,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer();}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite();}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(t){this._lineVerticalPlaneSegment=r$5(t)?h$8(t):null,this.syncLineVerticalPlane(),this.syncRenderer();}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncRenderer();}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(t){this._pointDistanceLine=r$5(t)?{origin:t$c(t.origin),target:t$c(t.target)}:null,this.syncPointDistance(),this.syncRenderer();}syncRenderer(){this.attached&&(this._intersectsLineEnabled||this._heightManifoldEnabled||r$5(this._pointDistanceLine)||r$5(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer();}ensureRenderer(){r$5(this.renderer)||(this.renderer=new z$4(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightManifold(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer));}syncStyle(){t$9(this.renderer)||(this.renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius));}syncAngleCutoff(){t$9(this.renderer)||this.renderer.setParameters({angleCutoff:this._angleCutoff});}syncHeightManifold(){t$9(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget));}syncIntersectsLine(){t$9(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine));}syncIntersectsLineInfinite(){t$9(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite);}syncPathVerticalPlane(){t$9(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=r$5(this._pathVerticalPlaneBuffers)&&this.visible,r$5(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers));}syncLineVerticalPlane(){t$9(this.renderer)||(this.renderer.lineVerticalPlaneEnabled=r$5(this._lineVerticalPlaneSegment)&&this.visible,r$5(this._lineVerticalPlaneSegment)&&(this.renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment));}syncPointDistance(){t$9(this.renderer)||(this.renderer.pointDistanceEnabled=r$5(this._pointDistanceLine)&&this.visible,r$5(this._pointDistanceLine)&&(this.renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this.renderer.pointDistanceTarget=this._pointDistanceLine.target));}disposeRenderer(){r$5(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null);}}const f$2=n$6();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class P$5 extends c$7{constructor(t){super(t),this._ray=d$6(),this._externalResources=null,this._handles=new u$6,this._isWorldDown=!1,this._start=n$6(),this._end=r$7(1,0,0),this._width=1,this._color=r$8(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=r$8(1,1,1,1),this._stippleIntegerRepeats=!0,this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._extensionType=0,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=4,this._fadedExtensions=T$1,this.applyProps(t);}createExternalResources(){const e=new W$2(this.materialParameters);this._handles.add(this.view.state.watch("camera",(()=>{this.updateGeometry();})));const t=new o$4({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t};}destroyExternalResources(){r$5(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll();}forEachExternalMaterial(e){r$5(this._externalResources)&&e(this._externalResources.material);}createGeometries(e){const t=[n$6(),n$6()],i=3===this.extensionType;i&&t.push(n$6(),n$6());const r=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,n=P$7.createPolylineGeometry(t,null,r);e.addGeometry(n,e$5(this._externalResources).material),this.updateVertices(e);}updateVisibility(e){super.updateVisibility(e),r$5(this._externalResources)&&(this._externalResources.laserline.visible=e);}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,r$6(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),c$6(this._end,e,this._end),p$6(this._start,this._end,this._ray),this.updateGeometry();}get start(){return this._start}set start(e){this._isWorldDown=!1,F$2(this._start,e)||(r$6(this._start,e),p$6(this._start,this._end,this._ray),this.updateGeometry());}get end(){return this._end}set end(e){this._isWorldDown=!1,F$2(this._end,e)||(r$6(this._end,e),p$6(this._start,this._end,this._ray),this.updateGeometry());}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial());}get color(){return this._color}set color(e){D$6(e,this._color)||(a$8(this._color,e),this.updateMaterial());}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this.updateMaterial());}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this.updateMaterial());}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial());}get innerColor(){return this._innerColor}set innerColor(e){D$6(e,this._innerColor)||(a$8(this._innerColor,e),this.updateMaterial());}get stippleIntegerRepeats(){return this._stippleIntegerRepeats}set stippleIntegerRepeats(e){e!==this._stippleIntegerRepeats&&(this._stippleIntegerRepeats=e,this.updateMaterial());}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const s=r$5(e)!==r$5(this._stipplePattern);this._stipplePattern=e,s?this.recreate():this.updateMaterial();}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(t$9(e)||t$9(this._stippleOffColor)||!D$6(e,this._stippleOffColor))&&(this._stippleOffColor=r$5(e)?t$d(e):null,this.updateMaterial());}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial());}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.updateGeometry());}get _laserlineAttached(){return this._laserlineEnabled&&r$5(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,r$5(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,r$5(e)&&(this._externalResources.laserline.style=e));}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,r$5(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached));}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial());}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=c$8(e,T$1),this.recreateGeometry();}updateMaterial(){if(t$9(this._externalResources))return;this._externalResources.material.setParameters(this.materialParameters);}get materialParameters(){return {width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stippleIntegerRepeats:this._stippleIntegerRepeats,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}updateGeometry(){r$5(this.object)&&this.updateVertices(this.object);}updateVertices(e){const s=3===this._extensionType?this.updateLineSegmentFinite(S$5):this.updateLineSegmentInfinite(this._extensionType,S$5);this.updateVertexAttributes(e,s),r$5(this._externalResources)&&(this._externalResources.laserline.intersectsLine=s);}updateLineSegmentFinite(e){return l$6(this._start,this._end,e)}updateLineSegmentInfinite(e,t){const s=this.view.state.camera;switch(p$5(this._ray,D$4),e){case 0:D$4.c0=-Number.MAX_VALUE;break;case 1:case 2:{const e=this._ray.origin,t=c$8(this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),s=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&s<t&&v$5(D$4.ray.direction,D$4.ray.direction),2===this._extensionType&&null!=t&&(D$4.c1=Math.abs(s-t));break}}if(!d$5(s.frustum,D$4))return l$6(this._start,this._end,t);const i=g$5(D$4,A$4),n=l$5(D$4,W$1);return l$6(i,n,t)}updateVertexAttributes(e,t){const s=e.geometries[0].getMutableAttribute("position").data;if(3===this.extensionType){const e=j$3(t,-this.fadedExtensions.start,A$4);s[0]=e[0],s[1]=e[1],s[2]=e[2];const i=j$3(t,0,A$4);s[3]=i[0],s[4]=i[1],s[5]=i[2];const r=j$3(t,1,A$4);s[6]=r[0],s[7]=r[1],s[8]=r[2];const n=j$3(t,1+this.fadedExtensions.end,A$4);s[9]=n[0],s[10]=n[1],s[11]=n[2];}else {const e=j$3(t,0,A$4);s[0]=e[0],s[1]=e[1],s[2]=e[2];const i=j$3(t,1,A$4);s[3]=i[0],s[4]=i[1],s[5]=i[2];}e.geometryVertexAttrsUpdated(e.geometryRecords[0]);}}const D$4=s$4(),A$4=n$6(),W$1=n$6(),S$5=v$3(),G$3=1/3,T$1={start:G$3,end:G$3};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class G$2 extends c$7{constructor(t){super(t),this._handles=new u$6,this._location=n$6(),this._direction=r$7(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=r$8(1,0,1,1),this._renderOccluded=4,this.applyProps(t);}get location(){return this._location}set location(e){F$2(this._location,e)||(r$6(this._location,e),this.updateGeometry());}get direction(){return this._direction}set direction(e){F$2(this._direction,e)||(r$6(this._direction,e),this.updateGeometry());}setDirectionFromPoints(e,t){j$4(this._direction,c$6(this._direction,t,e)),this.updateGeometry();}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial());}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this.updateGeometry());}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this.updateGeometry());}get color(){return this._color}set color(e){D$6(e,this._color)||(a$8(this._color,e),this.updateMaterial());}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial());}createExternalResources(){const e=new W$2(this.materialParameters);this._handles.add(this.view.state.watch("camera",(()=>{this.updateGeometry();}))),this._externalResources={material:e};}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null;}createGeometries(e){const r=P$7.createPolylineGeometry([n$6(),n$6()]),s=P$7.createPolylineGeometry([n$6(),n$6()]),i=e$5(this._externalResources).material;e.addGeometry(r,i),e.addGeometry(s,i),this.updateVertices(e);}forEachExternalMaterial(e){r$5(this._externalResources)&&e(this._externalResources.material);}updateMaterial(){if(t$9(this._externalResources))return;this._externalResources.material.setParameters(this.materialParameters);}get materialParameters(){return {width:this._width,color:this._color,renderOccluded:this._renderOccluded}}updateGeometry(){const e=this.object;t$9(e)||this.updateVertices(e);}updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,O$3),u$5(R$2,this.location,this.direction),t.projectToScreen(R$2,v$2),v$6(v$2,o$a(v$2,v$2,O$3)),this.updateVertexAttributes(t,e,0,O$3,v$2,1),this.updateVertexAttributes(t,e,1,O$3,v$2,-1);}updateVertexAttributes(e,t,r,s,i,o){const a=t.geometryRecords[r],l=a.geometry.getMutableAttribute("position").data,d=l$7(P$4,r$9(P$4,i[1]*o,i[0]*-o),this.offset+this.width/2),u=s$5(V,s$5(V,s$5(V,s,l$7(V,i,this.length/2)),d),d),m=s$5(k$2,u,l$7(k$2,i,-this.length));e.unprojectFromScreen(u,R$2),l[0]=R$2[0],l[1]=R$2[1],l[2]=R$2[2],e.unprojectFromScreen(m,R$2),l[3]=R$2[0],l[4]=R$2[1],l[5]=R$2[2],t.geometryVertexAttrsUpdated(a);}}const R$2=n$6(),O$3=i$5(),v$2=i$5(),P$4=i$5(),V=i$5(),k$2=i$5();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class o$3{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1;}destroy(){this._destroyResources();}get object(){return r$5(this._resources)?this._resources.object:null}get resources(){return r$5(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible());}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources());}recreate(){this.attached&&this._createResources();}recreateGeometry(){if(!this.resourceFactory.recreateGeometry)return void this.recreate();const e=this.resourceFactory.view._stage;if(t$9(this._resources)||!e)return;const r=this._resources.object;this._resources.external.forEach((s=>{2===s.type&&e.remove(s);})),r.removeAllGeometries();const t=this.resourceFactory.recreateGeometry(this._resources.external,r,this._resources.layer);e.addMany(t);}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources();}_createResources(){this._destroyResources();const e=this.resourceFactory.view._stage;if(!e)return;const s=new n$9({isPickable:!1,updatePolicy:1});e.add(s);const o=new T$2({castShadow:!1}),i=this.resourceFactory.createResources(o,s);i.forEach((s=>e.add(s))),e.add(o),s.add(o),this._syncVisible();const a=this.resourceFactory.cameraChanged?i$6(this.resourceFactory.view.state,"camera",(e=>this.resourceFactory.cameraChanged(e))):null;this._resources={layer:s,object:o,external:i,cameraHandle:a};}_destroyResources(){if(t$9(this._resources))return;const e=this.resourceFactory.view._stage;null==e||e.remove(this._resources.object),null==e||e.remove(this._resources.layer),this._resources.external.forEach((s=>{null==e||e.remove(s),"dispose"in s&&s.dispose();})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null;}_syncVisible(){t$9(this._resources)||this._resources.object.setVisible(this._visible);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class _$1{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=r$a(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=r$a(1,1,1,1),this._elevationInfo=null,this.resources=new o$3({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometry=this.recreateGeometry(t,e.material),r$5(e.geometry)?[e.geometry]:[])});let t=!0;for(const r in e)r in this?"attached"===r?t=e[r]:this[r]=e[r]:console.error("Cannot set unknown property",r);this.attached=t;}destroy(){this.resources.destroy();}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e;}get attached(){return this.resources.attached}set attached(e){this.resources.attached=e;}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry();}get size(){return this._size}set size(e){if(e!==this._size){const t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?r$5(this.resources)&&this.resources.recreate():this.updateSizeAttribute();}}get color(){return this._color}set color(e){D$6(e,this._color)||(a$8(this._color,e),this.updateMaterial());}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this.updateMaterial());}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,r$5(this.resources)&&this.resources.recreate());}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial());}get outlineColor(){return this._outlineColor}set outlineColor(e){D$6(e,this._outlineColor)||(a$8(this._outlineColor,e),this.updateMaterial());}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry();}updateMaterial(){const e=this.resources.resources;t$9(e)||e.material.setParameters(this.materialParameters(e.texture.id));}updateSizeAttribute(){const e=this.resources.resources,t=this.resources.object;if(t$9(e)||t$9(t))return;const r=e.geometry;if(t$9(r))return;const s=r.getMutableAttribute("size").data,o=this.geometrySize;s[0]=o,s[1]=o,t.geometryVertexAttrsUpdated(t.geometryRecords[0]);}materialParameters(e){return {color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:x$2,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get geometrySize(){return this._size/S$4}recreateGeometry(e,t){const i=this.createRenderGeometry();return r$5(i)&&e.addGeometry(i,t),i}createResources(e){const t=this.createTexture(),i=new W$3(this.materialParameters(t.id)),s=this.recreateGeometry(e,i);return {material:i,texture:t,geometry:s,forEach(e){e(t),e(i),r$5(this.geometry)&&e(this.geometry);}}}get preferredTextureSize(){return e$6(a$9(2*this.geometrySize),16,128)}createTexture(){const e=this.preferredTextureSize;return new b$4(r$b(this._primitive,e,e*S$4),{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})}calculateMapBounds(e){if(t$9(this.resources.resources)||t$9(this.resources.resources.geometry))return !1;const t=this.resources.resources.geometry.vertexAttributes.get("position");return gn(t.data,this.view.renderCoordsHelper.spatialReference,z$3,this.view.spatialReference),M$5(e,z$3),!0}createRenderGeometry(){const e=this.geometry;if(t$9(e))return null;const{renderCoordsHelper:t,elevationProvider:r}=this.view,o=m$8(e,r,h$a.fromElevationInfo(this.elevationInfo),t),n=o$7(c$9.get(),e.x,e.y,o),a=c$9.get();gn(n,e.spatialReference,a,t.spatialReference);const l=this.geometrySize;return P$7.createPointGeometry(null,a,null,[l,l],[0,0,0,1])}}const S$4=.5,x$2=[S$4/2,S$4/2,1-S$4/2,1-S$4/2],z$3=n$6();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class m$6 extends r$c{visualizeIntersectionPoint(t,i){const{coordinateHelper:o,elevationInfo:r,view:l}=i;return t$e(new _$1({view:l,primitive:"circle",geometry:o.vectorToPoint(t.intersectionPoint),elevationInfo:r,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:h$b.toUnitRGBA(p$7.orange),pixelSnappingEnabled:!1}))}visualizePoint(t,i){const{coordinateHelper:o,elevationInfo:r,view:l}=i;return t$e(new _$1({view:l,primitive:"circle",geometry:o.vectorToPoint(t.point),elevationInfo:r,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:h$b.toUnitRGBA(p$7.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{coordinateHelper:i,elevationInfo:o,view:r}=t;return t$e(this.createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,i,o,r,e.fadeLeft,e.fadeRight))}visualizeParallelSign(i,o){const{coordinateHelper:a,elevationInfo:l,view:d}=o,p=f$4(i.lineStart,a,l,o.view),m=f$4(i.lineEnd,a,l,o.view),u=y$6(m,p,m,.5),v=new G$2({view:d,attached:!1,offset:p$7.parallelLineHintOffset,length:p$7.parallelLineHintLength,width:p$7.parallelLineHintWidth,color:h$b.toUnitRGBA(p$7.orange),location:u,renderOccluded:16});return v.setDirectionFromPoints(p,u),v.attached=!0,t$e(v)}visualizeRightAngleQuad(t,i){const{coordinateHelper:o,elevationInfo:r,view:a}=i;return t$e(new y$7({view:a,attached:!0,color:h$b.toUnitRGBA(p$7.orange),renderOccluded:2,outlineRenderOccluded:16,outlineColor:h$b.toUnitRGBA(p$7.orange),outlineSize:p$7.rightAngleHintOutlineSize,size:p$7.rightAngleHintSize,geometry:{previous:f$4(t.previousVertex,o,r,a),center:f$4(t.centerVertex,o,r,a),next:f$4(t.nextVertex,o,r,a)}}))}createLineSegmentHintFromMap(e,n,t,o,r,a,l=!0,s=!0){const c=n$6(),p=n$6();return l$8(n,t,o,r,a,c,p),this.createLineSegmentHint(e,a,c,p,l,s)}createLineSegmentHint(n,t,i,r,a=!0,l=!0){const c=new P$5({view:t,extensionType:3,start:i,end:r,color:h$b.toUnitRGBA(p$7.orange),renderOccluded:16});switch(n){case 0:c.width=p$7.lineHintWidthTarget,c.fadedExtensions={start:0,end:p$7.lineHintFadedExtensions};break;case 2:c.width=p$7.lineHintWidthReference,c.fadedExtensions={start:0,end:0};break;case 1:c.width=p$7.lineHintWidthReference,c.fadedExtensions={start:a?p$7.lineHintFadedExtensions:0,end:l?p$7.lineHintFadedExtensions:0};}return c.attached=!0,c}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const s$2={main:new h$b([255,127,0]),selected:new h$b([255,255,255]),staged:new h$b([12,207,255]),outline:new h$b([0,0,0,.5]),selectedOutline:new h$b([255,255,255])},n$3=.3;function r$3(t,e){const i=t.clone();return i.a*=e,i}function h$5(t,o){const l=t.clone(),s=y$8(l);s.s*=o;const n=p$8(s);return l.r=n.r,l.g=n.g,l.b=n.b,l}function c$1(t,e){if(e)for(const i in e)t[i]=e[i];}class a$4{constructor(t){this.color=s$2.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,c$1(this,t);}}class d$2{constructor(t){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=s$2.main,this.outlineColor=s$2.outline,this.renderOccluded=16,this.hoverOutlineColor=s$2.selectedOutline,c$1(this,t);}apply(t,e){const i=this[t];e.setParameters({color:b$3(i),transparent:"color"!==t||i.a<1,renderOccluded:this.renderOccluded});}}class u$4{constructor(t){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=r$3(s$2.main,.5),this.hoverColor=s$2.main,this.renderOccluded=2,this.minSquaredEdgeLength=900,c$1(this,t);}apply(t,e){const i=this[t];e.setParameters({color:b$3(i),transparent:i.a<1,renderOccluded:this.renderOccluded});}}class p$2{constructor(t){this.vertex=new d$2({color:s$2.main,outlineColor:s$2.outline}),this.edge=new d$2({color:h$5(r$3(s$2.main,2/3),.5),outlineColor:r$3(s$2.outline,.5),size:8,collisionPadding:8}),this.selected=new d$2({color:s$2.selected,outlineColor:s$2.outline}),this.edgeOffset=new u$4,c$1(this,t);}}class g$2{constructor(t){this.color=s$2.selected,this.width=1.5,this.stipplePattern=a$a(5),this.stippleOffColor=s$2.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=s$2.selected,this.renderOccluded=4,c$1(this,t);}apply(t){t.color=b$3(this.color),t.width=this.width,t.stipplePattern=this.stipplePattern,t.stippleOffColor=b$3(this.stippleOffColor),t.falloff=this.falloff,t.innerWidth=this.innerWidth,t.innerColor=b$3(this.innerColor),t.renderOccluded=this.renderOccluded;}}class w$2{constructor(t){this.color=s$2.selected,this.size=4,this.outlineSize=1,this.outlineColor=s$2.outline,this.shape="square",c$1(this,t);}apply(t){t.color=b$3(this.color),t.size=this.size,t.outlineSize=this.outlineSize,t.outlineColor=b$3(this.outlineColor),t.primitive=this.shape;}}class f$1{constructor(t){this.innerColor=s$2.selected,this.innerWidth=1,this.glowColor=s$2.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=n$3,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=s$2.main,c$1(this,t);}apply(e,i=1){const o={glowColor:h$b.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:h$b.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*i,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=o:e.laserlineStyle=o;}}class C$3{constructor(t){this.outline=new g$2({color:s$2.outline,renderOccluded:8,stippleOffColor:s$2.selected,stipplePattern:a$a(5),width:1.5,innerWidth:0}),this.staged=new g$2({color:s$2.selected,renderOccluded:8,innerColor:s$2.staged,stippleOffColor:s$2.outline,stipplePattern:a$a(5),width:1.5}),this.shadowStyle=new f$1({globalAlpha:n$3,glowColor:s$2.main,glowFalloff:8,glowWidth:8,innerColor:s$2.selected,innerWidth:1}),c$1(this,t);}}class m$5{constructor(t){this.outline=new w$2({color:s$2.selected,outlineColor:s$2.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new f$1({globalAlpha:n$3,glowColor:s$2.main,glowFalloff:1.5,glowWidth:6,innerColor:s$2.selected,innerWidth:1,radius:2}),c$1(this,t);}}class O$2 extends g$2{constructor(t){super(),this.extensionType=2,c$1(this,t);}}class W{constructor(t){this.lineGraphics=new C$3,this.pointGraphics=new m$5,this.heightPlane=new f$1({globalAlpha:n$3,glowColor:s$2.main,glowFalloff:8,glowWidth:8,innerColor:s$2.selected,innerWidth:1}),this.heightBox=new f$1({globalAlpha:n$3,glowColor:s$2.main,glowFalloff:8,glowWidth:8,innerColor:s$2.selected,innerWidth:0,heightFillColor:s$2.main}),this.zVerticalLine=new O$2({color:r$3(s$2.main,5*n$3/3),falloff:2,innerColor:r$3(s$2.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,c$1(this,t);}}class z$2{constructor(t){this.visualElements=new W,this.reshapeManipulators=new p$2,this.zManipulator=new a$4,c$1(this,t);}colorToVec4(t){return b$3(t)}}function b$3(e){return e$7(h$b.toUnitRGBA(e))}const A$3=new z$2;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class a$3{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1;}destroy(){this._destroyResources();}get resources(){return r$5(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer());}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources());}recreate(){this.attached&&this._createResources();}recreateGeometry(){this.resourceFactory.recreateGeometry?t$9(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate();}_createOrDestroyResources(){this._attached?t$9(this._resources)&&this._createResources():this._destroyResources();}_createResources(){var e;this._destroyResources();const r=this.resourceFactory.createResources();this._resources={layerView:new u$3({view:this.resourceFactory.view}),external:r,geometriesAdded:!1},this._syncGeometriesToRenderer();const s=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;s&&s.registerDrapeSource(this._resources.layerView);}_destroyResources(){var e;if(t$9(this._resources))return;this.ensureRenderGeometriesRemoved();const r=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;r&&r.unregisterDrapeSource(this._resources.layerView),this._resources=null;}_syncGeometriesToRenderer(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved();}ensureRenderGeometriesRemoved(){var e;if(t$9(this._resources)||null==(e=this.resourceFactory.view)||!e.basemapTerrain)return;if(!this._resources.geometriesAdded)return;this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1;}ensureRenderGeometriesAdded(){if(t$9(this._resources))return;if(this._resources.geometriesAdded)return;this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0;}}let u$3=class extends(r$d(p$9)){constructor(e){super(e),this.drapeSourceType=1,this.updatePolicy=1;}};e$2([d$7({constructOnly:!0})],u$3.prototype,"view",void 0),e$2([d$7({readOnly:!0})],u$3.prototype,"drapeSourceType",void 0),u$3=e$2([i$7("DrapedVisualElementLayerView")],u$3);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class A$2{constructor(t){this.view=null,this._attachmentOrigin=v$7(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new n$a,this._isDraped=!1,this._geometry=null,this._width=1,this._color=r$8(1,0,1,1),this._innerWidth=0,this._innerColor=r$8(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new o$3({view:t.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometries.length=0,this.recreateGeometry(t,e.material,e.geometries),e.geometries)}),this._attachmentOrigin.spatialReference=t.view.spatialReference,this.drapedResources=new a$3({view:t.view,createResources:()=>this.createDrapedResources(),recreateGeometry:e=>{e.geometries=this.createRenderGeometriesDraped(e.material),this.attachmentOriginChanged();}});let r=!0;this._laserline=new o$4({view:t.view});for(const e in t)e in this?"attached"===e?r=t[e]:this[e]=t[e]:console.error("Cannot set unknown property",e);this.attached=r;}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy();}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached);}get laserlineAttached(){return this.attached&&this.visible&&r$5(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached;}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(e){this.updateAttached(e);}updateAttached(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged();}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry();}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial());}get color(){return this._color}set color(e){D$6(e,this._color)||(a$8(this._color,e),this.updateMaterial());}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial());}get innerColor(){return this._innerColor}set innerColor(e){D$6(e,this._innerColor)||(a$8(this._innerColor,e),this.updateMaterial());}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const r=r$5(e)!==r$5(this._stipplePattern);this._stipplePattern=e,r?this.resources.recreate():this.updateMaterial();}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&D$6(e,this._stippleOffColor)||(this._stippleOffColor=e?t$d(e):null,this.updateMaterial());}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial());}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources.recreateGeometry();}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,r$5(e)&&(this._laserline.style=e);}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached);}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial());}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=r$5(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;o$7(S$3,0,0,0);let s=0;for(const t of e){const e=t.vertexAttributes.get("position"),i=t.indices.get("position"),o=e$5(this.resources.resources).material.isClosed(e.data,i);g$6(e,i,o,I$1)&&(u$5(S$3,S$3,I$1),s++);}return 0===s?null:(d$8(S$3,S$3,1/s),this.view.renderCoordsHelper.fromRenderCoords(S$3,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}updateMaterial(){r$5(this.resources.resources)&&this.resources.resources.material.setParameters(this.materialParameters),r$5(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this.materialParameters);}get isClosed(){return r$5(this.geometry)&&"polygon"===this.geometry.type}get materialParameters(){return {width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}recreateGeometry(e,t,r){const s=this.createRenderGeometries();for(const i of s)e.addGeometry(i,t),r.push(i);this.attachmentOriginChanged();}attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed");}createResources(e){const t=new W$2(this.materialParameters),r=[];return this.recreateGeometry(e,t,r),{material:t,geometries:r,forEach:e=>{e(t),r.forEach(e);}}}createDrapedResources(){const e=new W$2(this.materialParameters);return {material:e,geometries:this.createRenderGeometriesDraped(e)}}createRenderGeometriesDraped(e){const t=this.geometry;if(t$9(t))return [];const r=j$6(t,this.view.basemapTerrain.spatialReference),i=[];for(const{position:s}of r.lines){const t={attributeData:{position:s},removeDuplicateStartEnd:this.isClosed?1:0},r=new l$9(b$5(t),e),a=B$2(M$3);M$5(a,s),r$e(r.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),i.push(r);}return i}calculateMapBounds(e){if(t$9(this.resources.resources))return !1;const t=this.view.renderCoordsHelper;for(const r of this.resources.resources.geometries){const s=r.vertexAttributes.get("position"),i=new Float64Array(s.data.length);xn(s.data,t.spatialReference,0,i,this.view.spatialReference,0,s.data.length/3),M$5(e,i);}return !0}createRenderGeometries(){var e;const t=this.geometry;if(t$9(t))return [];const r=d$9(t,this.view.elevationProvider,this.view.renderCoordsHelper,h$a.fromElevationInfo(null!=(e=this.elevationInfo)?e:new x$3({mode:i$8(t,null)}))),i=[],a=[];for(const{position:s,mapPosition:o}of r.lines){const e={attributeData:{position:s,mapPosition:o},removeDuplicateStartEnd:this.isClosed?1:0};i.push(b$5(e)),a.push(s);}return this._laserline.pathVerticalPlane=a,i}}const M$3=a$b(),I$1=n$6(),S$3=n$6();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class u$2 extends c$7{constructor(e){super(e),this.view=null,this._renderOccluded=4,this._vertices=null,this._spatialReference=null,this._color=A$3.colorToVec4(A$3.reshapeManipulators.vertex.color),this._size=A$3.reshapeManipulators.vertex.size,this._outlineColor=A$3.colorToVec4(A$3.reshapeManipulators.vertex.outlineColor),this._outlineSize=A$3.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e);}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial());}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry();}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry();}get color(){return this._color}set color(e){D$6(e,this._color)||(a$8(this._color,e),this.updateMaterial());}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this.updateMaterial());}get outlineColor(){return this._outlineColor}set outlineColor(e){D$6(e,this._outlineColor)||(a$8(this._outlineColor,e),this.updateOutlineMaterial());}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial());}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry();}get vertexMaterialParameters(){return {color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return {color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}updateMaterial(){this.attached&&this.vertexMaterial.setParameters(this.vertexMaterialParameters);}updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameters(this.vertexOutlineMaterialParameters);}createRenderGeometries(){const r=this.vertices;if(t$9(r)||0===r.length)return [];const i=.5,s=.5,a=h$c(r,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,h$a.fromElevationInfo(this.elevationInfo)),o=[],c=a.numVertices,h=a.position;for(let e=0;e<c;++e){const r=o$7(d$1,h[3*e+0],h[3*e+1],h[3*e+2]),a=p$1(i,r),l=p$1(s,r);o.push({vertexGeometry:a,vertexOutlineGeometry:l});}return o}createGeometries(e){const t=this.createRenderGeometries();for(const{vertexGeometry:r,vertexOutlineGeometry:i}of t)e.addGeometry(r,this.vertexMaterial),e.addGeometry(i,this.vertexOutlineMaterial);}createExternalResources(){this.vertexMaterial=new q$3({...this.vertexMaterialParameters,writeDepth:!0,cullFace:2,screenSizeEnabled:!0}),this.vertexOutlineMaterial=new q$3({...this.vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1});}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null;}forEachExternalMaterial(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial);}}const d$1=n$6();function p$1(e,t){return P$7.createSphereGeometry(e,16,16,{offset:t})}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let y$3=class extends O$5{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this.geometryType=null,this.type="draw-3d";}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new x$3({mode:e,offset:t});}normalizeCtorArgs(e){if(!e.elevationInfo){var t;const i=null==(t=e.hasZ)||t;return {...e,elevationInfo:{mode:i?"absolute-height":"on-the-ground",offset:0}}}return e}initializeGraphic(e){return this._createGraphicState=new e$8({graphic:e}),r$f([this.view.maskOccludee(e),this.view.trackGraphicState(this._createGraphicState),i$6(this._createGraphicState,"isDraped",(e=>{r$5(this._outlineVisualElement)&&(this._outlineVisualElement.isDraped=e);}))])}makeDrawOperation(){return new M$6({view:this.view,manipulators:this.manipulators,geometryType:x$4(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new n$b(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new r$g(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new m$6})}onActiveVertexChanged(e){return r$5(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],null):(this._activeVertexVisualElement=new u$2({view:this.view,spatialReference:this.view.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:A$3.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=A$3.colorToVec4(A$3.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,n$c((()=>{this._activeVertexVisualElement=l$a(this._activeVertexVisualElement);})))}onOutlineChanged(e){if(r$5(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;const t=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new A$2({view:this.view,geometry:e,elevationInfo:t,isDraped:r$5(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===r$h(this.hasZ,t),attached:!1}),A$3.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),A$3.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,n$c((()=>{this._outlineVisualElement=l$a(this._outlineVisualElement);}))}onRegularVerticesChanged(e){return r$5(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new u$2({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:A$3.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,n$c((()=>{this._verticesVisualElement=l$a(this._verticesVisualElement);})))}};e$2([d$7({constructOnly:!0})],y$3.prototype,"elevationInfo",void 0),e$2([d$7({constructOnly:!0})],y$3.prototype,"geometryType",void 0),e$2([d$7({readOnly:!0})],y$3.prototype,"type",void 0),e$2([d$7({constructOnly:!0,nonNullable:!0})],y$3.prototype,"view",void 0),y$3=e$2([i$7("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],y$3);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function t$2(o,t=s$6(o)){return "on-the-ground"!==t.mode&&!(t$9(o.geometry)||!o.geometry.hasZ)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class e$1{constructor(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null;}update(e){this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,s)=>{if(0===s&&(this.zManipulator=e),e instanceof Y$2&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),t$9(this.firstGrabbedXY)&&e.grabbing&&1===s&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=1,s){case 0:this.grabbingState|=2;break;case 1:this.grabbingState|=4;}}));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function v$1(t){const{view:a,graphic:n}=t,i=new e$8({graphic:n}),l=y$2(t,i),s=[l,E$1(t,l.visualElement,i),a.maskOccludee(n),a.trackGraphicState(i)];return {visualElement:l.visualElement,remove:()=>r$f(s).remove()}}function y$2(a,n){const{view:i,graphic:l}=a,s=new A$2({view:i,geometry:S$2(l)?l.geometry:null,elevationInfo:s$6(l),attached:!1});A$3.visualElements.lineGraphics.shadowStyle.apply(s);const o=()=>{s.attached=n.displaying;};A$3.visualElements.lineGraphics.outline.apply(s);const r=[n.watch("displaying",o),n.watch("isDraped",(e=>s.isDraped=e)),n.on("changed",(()=>s.geometry=S$2(l)?l.geometry:null)),t$e(s)];return o(),{visualElement:s,remove:()=>r$f(r).remove()}}function E$1(i,l,s){const{graphic:o,view:r}=i,p=[],g=s$6(o),f="on-the-ground"===g.mode||!g.offset&&"absolute-height"!==g.mode,v=new e$1,y=new P$5({view:r,extensionType:A$3.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});A$3.visualElements.pointGraphics.shadowStyle.apply(y);const E=M$4(A$3.visualElements.heightPlaneAngleCutoff),j=new o$4({view:r,attached:!1,angleCutoff:E});A$3.visualElements.heightPlane.apply(j);let M=1,G=1;const L=()=>{if(v.update(i),!s.displaying||f&&(s.isDraped||!S$2(o)||!o.geometry.hasZ))return l.laserlineEnabled=!1,y.attached=!1,void(j.attached=!1);l.laserlineEnabled=!0;{const e=4&v.grabbingState?A$3.visualElements.laserlineAlphaMultiplier:1;e!==M&&(M=e,A$3.visualElements.lineGraphics.shadowStyle.apply(l,e),A$3.visualElements.pointGraphics.shadowStyle.apply(y,e));}{const e=2&v.grabbingState?A$3.visualElements.laserlineAlphaMultiplier:1;e!==G&&(G=e,A$3.visualElements.heightPlane.apply(j,e));}w$1(y,v),b$2(i,l,j,v);};A$3.visualElements.zVerticalLine.apply(y),p.push(s.on("changed",L),s.watch("displaying",L),l.events.on("attachment-origin-changed",L),t$e(y),t$e(j));const D=[],C=()=>{r$f(D).remove(),D.length=0,i.forEachManipulator((e=>D.push(e.events.on("grab-changed",L)))),i.forEachManipulator((e=>D.push(e.events.on("select-changed",L)))),L();};return C(),p.push(i.onManipulatorsChanged(C),o$b((()=>r$f(D)))),r$f(p)}function w$1(e,t){const a=1===t.numSelected?t.firstSelected:t.numSelected>1&&r$5(t.firstGrabbedXY)?t.firstGrabbedXY:null;r$5(a)?(e.setStartEndFromWorldDownAtLocation(a.renderLocation),e.attached=!0):e.attached=!1;}function b$2(e,t,a,n){if(n.numSelected>0){o$7(j$2,0,0,0);let t=0;e.forEachManipulator(((e,a)=>{1===a&&e.selected&&e instanceof Y$2&&(u$5(j$2,j$2,e.renderLocation),t++);})),t>0?(a.heightManifoldTarget=d$8(j$2,j$2,1/t),a.attached=!0):a.attached=!1;}else {const n=t.attachmentOrigin;r$5(n)&&e.view.renderCoordsHelper.toRenderCoords(n,j$2)?(a.heightManifoldTarget=j$2,a.attached=!0):a.attached=!1;}}function S$2(e){return r$5(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const j$2=n$6();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function S$1(t){const{view:n,graphic:o}=t,i=new e$8({graphic:o}),a=[],s=P$3(t,i,a);return L(t,i,a,s),a.push(n.trackGraphicState(i)),{visualElement:s,remove(){r$f(a).remove();}}}function L(e,n,s,l){const{view:c,graphic:m}=e,d=new P$5({view:c,extensionType:A$3.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});A$3.visualElements.zVerticalLine.apply(d);const w=new o$4({view:c,intersectsLineInfinite:!0,attached:!1});A$3.visualElements.pointGraphics.shadowStyle.apply(w);const x=M$4(A$3.visualElements.heightPlaneAngleCutoff),S=new o$4({view:c,attached:!1,angleCutoff:x});A$3.visualElements.heightPlane.apply(S);const L=s$6(e.graphic),P=h$a.fromElevationInfo(L),C="on-the-ground"===L.mode||!L.offset&&"absolute-height"!==L.mode,M=new e$1;let R=1,G=1;const V=()=>{M.update(e);const t=A$1(m),o=C&&(n.isDraped||t$9(t)||!t.hasZ);let s=!0;if(!o&&r$5(t)){const e=m$8(t,c.elevationProvider,P,c.renderCoordsHelper);o$7(U$2,t.x,t.y,e),gn(U$2,t.spatialReference,U$2,c.renderCoordsHelper.spatialReference),d.setStartEndFromWorldDownAtLocation(U$2),w.intersectsWorldUpAtLocation=U$2;}else s=!1;const f=2&M.grabbingState?A$3.visualElements.laserlineAlphaMultiplier:1;f!==R&&(R=f,A$3.visualElements.heightPlane.apply(S,f));const g=B$2(D$3);!o&&n.displaying&&l.calculateMapBounds(g)&&gn(_$3(g,U$2),c.spatialReference,U$2,c.renderCoordsHelper.spatialReference)?(S.heightManifoldTarget=U$2,S.attached=!0):S.attached=!1;const y=4&M.grabbingState?A$3.visualElements.laserlineAlphaMultiplier:1;y!==G&&(G=y,A$3.visualElements.pointGraphics.shadowStyle.apply(w,y));const E=s&&n.displaying&&!o;w.attached=E,d.attached=E;};s.push(n.watch(["displaying","isDraped"],V),n.on("changed",V)),e.forEachManipulator((e=>{s.push(e.events.on("grab-changed",V));})),s.push(t$e(w)),s.push(t$e(d)),s.push(t$e(S)),V();}function P$3(e,n,o){const{view:i,graphic:a}=e,s=new _$1({view:i,geometry:A$1(a),elevationInfo:s$6(a),attached:!1});return C$2(e,s,n,o),o.push(t$e(s)),s}function A$1(e){const t=e.geometry;return t$9(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}function C$2(e,t,n,o){const i=()=>t.attached=n.displaying;M$2(e,t,n,o),A$3.visualElements.pointGraphics.outline.apply(t),o.push(i$6(n,"displaying",i));}function M$2(e,t,o,i){const{view:s,graphic:r}=e;let l=null;const p=e=>{r$5(l)&&(l.remove(),l=null),o.isDraped&&r$5(e)&&(l=R$1(s,e,(()=>{t.geometry=e;})));},c=()=>{const e=A$1(r);p(e),t.geometry=e;};i.push(o.on("changed",c),o$b((()=>l))),c();}function R$1(e,t,n){const o=e.elevationProvider.spatialReference;wn(t,U$2,o);const i=U$2[0],a=U$2[1];return e.elevationProvider.on("elevation-change",(e=>{F$3(e.extent,i,a)&&n();}))}const U$2=n$6(),D$3=a$b();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function i$2(i){switch(e$5(i.graphic.geometry).type){case"point":case"mesh":return S$1(i);case"polygon":case"polyline":return v$1(i);default:return null}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const t$1=[1,.5,0],a$2=128,e=70,h$4=80,M$1=.02,c=54,o$2=100,I=Math.ceil(e/3*2),P$2=160,i$1=.5,l$2=24,n$2=9,p=P$2+30,r$2=P$2+53,s$1=60,x$1=23,b$1=5*Math.PI/12,d=1*Math.PI/3,f=10,g$1=.2,j$1=30,k$1=53,m$4=.2,q$1=.3,u$1=200,v=3,w=1e6;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class t{constructor(){this._available=!0;}set location(a){this.forEachManipulator3D((t=>t.location=a));}set elevationAlignedLocation(a){this.forEachManipulator3D((t=>t.elevationAlignedLocation=a));}set elevationInfo(a){this.forEachManipulator3D((t=>t.elevationInfo=a));}get renderLocation(){let a;return this.forEachManipulator3D((t=>{a||(a=t.renderLocation);})),a}get available(){return this._available}set available(a){this._available=a,this.forEachManipulator3D((t=>t.available=a));}get grabbing(){return this.someManipulator((a=>a.grabbing))}get dragging(){return this.someManipulator((a=>a.dragging))}hasManipulator(a){return this.someManipulator((t=>t===a))}someManipulator(a){let t=!1;return this.forEachManipulator((i=>{!t&&a(i)&&(t=!0);})),t}forEachManipulator3D(t){this.forEachManipulator(((i,o)=>{i instanceof Y$2&&t(i,o);}));}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function P$1(e,r){return h$3(e,(()=>r))}function U$1(e){return h$3(e,(e=>e.plane))}function h$3(t,s){const c=n$6(),l=n$6();let a=!1;return i=>{const u=s(i);if("start"===i.action){const r=d$a(i.screenStart,l$b(t$f.get())),s=s$7(t.state.camera,r,J);r$5(s)&&(a=D$7(u,s,c));}if(!a)return null;const p=d$a(i.screenEnd,l$b(t$f.get())),d=s$7(t.state.camera,p,J);return t$9(d)?null:D$7(u,d,l)?{...i,renderStart:c,renderEnd:l,plane:u,ray:d}:null}}function k(t,n,o,c=null,l=null){let a=null;return i=>{if("start"===i.action&&(a=t.sceneIntersectionHelper.intersectElevationFromScreen(i$5(i.screenStart.x,i.screenStart.y),n,o,l),r$5(a)&&r$5(c)&&!on(a,a,c)))return null;if(t$9(a))return null;const u=t.sceneIntersectionHelper.intersectElevationFromScreen(i$5(i.screenEnd.x,i.screenEnd.y),n,o,l);return r$5(u)?r$5(c)&&!on(u,u,c)?null:{...i,mapStart:a,mapEnd:u}:null}}function M(e,r,t,n=null,o=null){return k(e,t,c$a(r,e,t),n,o)}function R(e,r,t,n=null,o=null){return M(e,t,s$6(r),n,o)}function T(r,t,n,o){const s=t.toMap(r.screenStart,{include:[n]});return r$5(s)?R(t,n,s,o):null}function F$1(e,r){const t=z$1,n=B,o=p$4();e.renderCoordsHelper.worldUpAtPosition(r,t);const s=_$2(o,t,c$6(n,r,e.state.camera.eye));return _$2(s,s,t),v$4(r,s,o)}function A(e,r,t){let n=null;const o=new b$6;return o.next(P$1(e,F$1(e,r))).next(D$2(e,r)).next(q(e,t)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,n=e;})),e=>(n=null,o.execute(e),n)}function D$2(e,r){const t=n$6(),n=s$8(r);e.renderCoordsHelper.worldUpAtPosition(r,t);const o=n$6(),s=n$6(),d=o=>{if(c$6(o,o,r),a$c(t,o,o),"global"===e.viewingMode){s$8(o)*Math.sign(z$6(t,o))<.001-n&&c$6(o,d$8(o,t,.001),r);}return u$5(o,o,r),o};return e=>(e.renderStart=d(r$6(o,e.renderStart)),e.renderEnd=d(r$6(s,e.renderEnd)),e)}function q(r,t){const n=r.renderCoordsHelper;return r=>{const o=n.fromRenderCoords(r.renderStart,t),s=n.fromRenderCoords(r.renderEnd,t);return r$5(o)&&r$5(s)?{...r,mapStart:o,mapEnd:s}:null}}const z$1=n$6(),B=n$6(),J=d$6();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function r$1(t,r,a,c){const i=t.graphic,o=(t,e)=>r({action:t,graphic:i,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY});return a(((t,r,a)=>{const s=r.next((t=>("start"===t.action&&o("start",t),t))).next(y$9(i,c)).next((t=>{switch(t.action){case"start":case"update":(t.translationX||t.translationY||t.translationZ)&&o("update",t);break;case"end":o("end",t);}return t}));return a.next(z$7(i)).next((()=>{o("end",{screenDeltaX:0,screenDeltaY:0});})),s}))}function a$1(e){if(t$9(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const n=("polyline"===e.type?e.paths:e.rings)[0];if(!n||n.length<2)return 0;const r=n[0],a=n[1];return Math.atan2(a[1]-r[1],a[0]-r[0])}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class U extends t{constructor(t){super(),this._handles=new u$6,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this.createMaterial(),this._transparentMaterial=this.createMaterial(.5),this._angle=0,this._scale=1,this._radius=e,this._updateAfterDrag=!1,this.events=new n$a,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulators(),this.forEachManipulator((t=>this._tool.manipulators.add(t)));}set orthogonalAvailable(t){this._arrowManipulatorInfos[1].manipulator.available=t,this._arrowManipulatorInfos[3].manipulator.available=t;}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy();})),this._handles=l$a(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0;}forEachManipulator(t){for(const{manipulator:a}of this._arrowManipulatorInfos)t(a,1);}createGraphicDragPipeline(t,a,r){const e=a.graphic,i=s$6(e),s=e$5(e.geometry).spatialReference;return r$1(a,r,(a=>this.createDragPipeline(((r,e,i,o,s)=>a(r,t(r,e,i,o,s),i)),i,s,e)),this._view.state.viewingMode)}createDragPipeline(t,a,r,i){return r$f(this._arrowManipulatorInfos.map((({manipulator:e},o)=>m$9(e,((e,s,n,l,p)=>{const u=s.next((t=>({...t,manipulatorType:1}))).next(M$7(this._view,e.elevationAlignedLocation)).next(M(this._view,e.elevationAlignedLocation,a,r,i)).next(p$a(e.location,this.angle+(o+1)*Math.PI*.5)).next(D$8());t(e,u,n,l,p);})))))}get angle(){return this._angle}set angle(t){this._angle=t,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform();}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform();}get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=t,this._updateManipulators());}_updateManipulators(){for(let t=0;t<this._arrowManipulatorInfos.length;t++)this._updateArrowManipulator(this._arrowManipulatorInfos[t],t);this._updateManipulatorTransform();}_updateArrowManipulator({manipulator:t,transform:a},r){const e$1=this._radius/e,i=c*e$1,o=i*Math.sqrt(3)/2,u=P$7.createExtrudedTriangle(o,i/2,i/2,M$1);P$7.transformInPlace(u,x$5(f$5.get(),o$7(c$9.get(),0,-o/3,0))),t.renderObjects=[{geometry:u,material:this._opaqueMaterial,stateMask:2},{geometry:u,material:this._transparentMaterial,stateMask:1}],t.radius=o/3*2*1.2;const h=r$i(f$5.get());R$3(h,r*Math.PI/2);const m=r$i(f$5.get());x$5(m,o$7(c$9.get(),0,o$2*e$1,0)),e$9(a,h,m);}_createManipulators(){for(let t=0;t<4;t++){const a=this._createArrowManipulator(t);this._arrowManipulatorInfos.push(a);}this._updateManipulatorTransform();}_updateManipulatorTransform(){const t=this.angle,a=r$i(f$5.get());f$6(a,a,t,r$7(0,0,1));const r=q$4(f$5.get(),o$7(c$9.get(),this.displayScale,this.displayScale,this.displayScale)),e=r$i(f$5.get());e$9(e,r,a);for(const i of this._arrowManipulatorInfos){const t=e$9(f$5.get(),e,i.transform);i.manipulator.modelTransform=t;}}_createArrowManipulator(t){const a=new Y$2({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:r$7(0,0,1)}}),r={manipulator:a,transform:e$4()};return this._updateArrowManipulator(r,t),this._handles.add(a.events.on("drag",(t=>{this._updateAfterDrag&&"end"===t.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1);}))),r}createMaterial(a=1){const r=h$b.toUnitRGBA(s$2.main);return r[3]*=a,new h$d({color:r,transparent:1!==a,cullFace:2,renderOccluded:2})}get test(){return {arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:t})=>t))}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class a{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new b$6,this._enabled=!1;}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&r$5(this.lastDragEvent)){const n=this.lastDragEvent.mapEnd,a=this.snap(this.lastDragEvent.screenEnd);if(r$5(a)){const t={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?a:n,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(t);}}this._enabled=e;}snap(n){const a=r$5(this.view)?this.view.toMap(n,{exclude:[]}):null;return r$5(a)&&r$5(this.view)&&(a.z=c$a(a,this.view,this.elevationInfo)),a}createDragEventPipelineStep(e,n){return this.view=e,this.elevationInfo=n,this.lastDragEvent=null,e=>{if(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const n=this.snap(e.screenEnd);return r$5(n)?{action:e.action,mapStart:e.mapStart,mapEnd:n,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return {action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class b extends t{constructor(t){super(),this._handles=new u$6,this._snapToScene=new a,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=e,this._view=t.view,this._tool=t.tool,null!=t.snapToScene&&(this.snapToScene=t.snapToScene),null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)));}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy();})),this._tool=null,this._view=null,this._manipulator=null;}forEachManipulator(t){t(this._manipulator,1);}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform();}get snapToScene(){return this._snapToScene.enabled}set snapToScene(t){this._snapToScene.enabled=t;}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator());}createGraphicDragPipeline(t,e,a){const r=e.graphic,s=s$6(r),o=e$5(r.geometry).spatialReference;return r$1(e,a,(e=>this.createDragPipeline(((i,a,r,s,o)=>e(i,t(i,a,r,s,o),r)),s,o,r)),this._view.state.viewingMode)}createDragPipeline(t,e,i,a){const r=this._view;return m$9(this._manipulator,((s,o,n,l,p)=>{const c=o.next(M$7(r,s.elevationAlignedLocation)).next(M(r,s.elevationAlignedLocation,e,i,a)).next(this._snapToScene.createDragEventPipelineStep(r,e),this._snapToScene.next).next((t=>({...t,manipulatorType:1}))).next(D$8());t(s,c,n,l,p);}))}_updateManipulatorTransform(){const t=q$4(f$5.get(),o$7(c$9.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=t;}_createManipulator(){const t=this._view;this._manipulator=new Y$2({view:t,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:r$7(0,0,1)},worldOriented:!0}),this._updateManipulator();}_updateManipulator(){const t=P$7.createCylinderGeometry(M$1,1,a$2,r$7(0,0,1),r$7(0,0,0)),e$1=q$4(e$4(),r$7(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:t,material:this._discMaterial,transform:e$1,stateMask:2},{geometry:t,material:this._discMaterialTransparent,transform:e$1,stateMask:1}],this._manipulator.radius=h$4*(this._radius/e);}_createMaterial(e=1){const i=h$b.toUnitRGBA(s$2.main);return i[3]*=e,new h$d({color:i,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return {discManipulator:this._manipulator}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class x extends t{constructor(t){super(),this._handles=new u$6,this._radius=e,this.events=new n$a,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this.createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)));}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy();}));}forEachManipulator(t){t(this._manipulator,0);}createGraphicDragPipeline(t,e,r){const a=e$5(e.graphic.geometry).spatialReference;return r$1(e,r,(e=>this.createDragPipeline(((r,a,i,o,s)=>e(r,t(r,a,i,o,s),i)),a)),this._view.state.viewingMode)}createDragPipeline(t,e){const r=this._view;return m$9(this._manipulator,((a,i,o,s,n)=>{const l=i.next((t=>({...t,manipulatorType:0}))).next(A(r,a.renderLocation,e)).next(D$8());t(a,l,o,s,n);}))}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this.updateManipulator());}updateManipulator(){const e$1=this._radius/e,r=A$3.zManipulator.height*e$1,a=A$3.zManipulator.coneHeight*e$1,i=A$3.zManipulator.coneWidth*e$1,m=A$3.zManipulator.width*e$1,p=[r$7(0,0,0),r$7(0,0,r)],c=P$7.createTubeGeometry(p,m/2,16,!1),u=P$7.createConeGeometry(a,i/2,16,!1),h=[r$7(0,0,0),r$7(0,0,r+a)],d=t=>{const e=e$4();if(c$5(e,e,[0,0,r]),b$7(e,e,Math.PI/2),t){const r=1+2*t/i;i$9(e,e,[r,r,r]);}return e},f=d(0),_=(e,r)=>{const a=q$5(A$3.zManipulator.color,r);return [a.r/255,a.g/255,a.b/255,A$3.zManipulator.color.a*e]},y=d$b(_(1,.25),1),w=d$b(_(1,0),1),k=d$b(_(.7,0),A$3.zManipulator.renderOccluded),b=d$b(_(.85,0),A$3.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:u,transform:f,material:y,stateMask:1},{geometry:c,material:y,stateMask:1},{geometry:u,transform:f,material:w,stateMask:2},{geometry:c,material:w,stateMask:2},{geometry:u,transform:f,material:k,stateMask:1},{geometry:c,material:k,stateMask:1},{geometry:u,transform:f,material:b,stateMask:2},{geometry:c,material:b,stateMask:2}],this._manipulator.radius=m/2+2,this._manipulator.collisionType={type:"line",paths:[h]};}createManipulator(){const t=new Y$2({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=t=>{const e$1=this._view.state.camera,r=D$1;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,r);const i=S$6(e$1.eye,r),o=e$1.computeRenderPixelSizeAtDist(i),s=c$6(E,r,e$1.eye);j$4(s,s);const n=O$1;this._view.renderCoordsHelper.worldUpAtPosition(D$1,n);const l=Math.abs(z$6(s,n)),f=_$2(E,s,n),M=_$2(E,f,n),_=e$6(l,.01,1),g=1-Math.sqrt(1-_*_)/_/e$1.fullWidth,y=this._radius/e,w=A$3.zManipulator.width*y;d$8(M,j$4(M,M),(1/g-1)*i+o*w),t[12]-=E[0],t[13]-=E[1],t[14]-=E[2];},this._manipulator=t,this.updateManipulator();}get test(){return {manipulator:this._manipulator}}}const D$1=n$6(),E=n$6(),O$1=n$6();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class h$2 extends t{constructor(a){super(),this._handles=new u$6,this._angleDeferred=null,this._interactive=!0;const{tool:t,view:e,snapToScene:n,radius:s}=a;this._view=e,this.xyManipulation=new b({tool:t,view:e,snapToScene:n,radius:s}),this.xyAxisManipulation=new U({tool:t,view:e,radius:s}),this.zManipulation=new x({tool:t,view:e,radius:s}),this.xyManipulation.available=a.xyAvailable,this.xyAxisManipulation.available=a.xyAxisAvailable,this.zManipulation.available=a.zAvailable,this.autoHideXYAxis(),this.forEachManipulator((i=>{this._handles.add(i.events.on("grab-changed",(()=>this.updateManipulatorInteractivity())));}));}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy();}createGraphicDragPipeline(i,t,e){return r$f([this.xyManipulation.createGraphicDragPipeline(((a,t,e,n,s)=>i(0,a,t,e,n,s)),t,e),this.xyAxisManipulation.createGraphicDragPipeline(((a,t,e,n,s)=>i(1,a,t,e,n,s)),t,e),this.zManipulation.createGraphicDragPipeline(((a,t,e,n,s)=>i(2,a,t,e,n,s)),t,e)])}createDragPipeline(i,t,e,n){return r$f([this.xyManipulation.createDragPipeline(((a,t,e,n,s)=>i(0,a,t,e,n,s)),t,e,n),this.xyAxisManipulation.createDragPipeline(((a,t,e,n,s)=>i(1,a,t,e,n,s)),t,e,n),this.zManipulation.createDragPipeline(((a,t,e,n,s)=>i(2,a,t,e,n,s)),e)])}set snapToScene(i){this.xyManipulation.snapToScene=i;}set angle(i){this._angleDeferred=null,this.xyAxisManipulation.angle=i;}set angleDeferred(i){this.xyAxisVisible?this.angle=i():this._angleDeferred=i;}set interactive(i){this._interactive!==i&&(this._interactive=i,this.updateManipulatorInteractivity());}set radius(i){this.xyAxisManipulation.radius=i,this.xyManipulation.radius=i,this.zManipulation.radius=i;}set displayScale(i){this.xyManipulation.displayScale=i,this.xyAxisManipulation.displayScale=i;}forEachManipulator(i){this.xyManipulation.forEachManipulator((a=>i(a,1))),this.xyAxisManipulation.forEachManipulator((a=>i(a,1))),this.zManipulation.forEachManipulator((a=>i(a,0)));}get xyAxisVisible(){const i=this.xyManipulation.someManipulator((i=>i.focused))||this.xyAxisManipulation.someManipulator((i=>i.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||i}autoHideXYAxis(){const i=this.xyAxisManipulation,a=this.xyManipulation;if(s$9("esri-mobile"))return;const n=[];a.forEachManipulator((i=>n.push(i))),i.forEachManipulator((i=>n.push(i)));const s=()=>{const a=[];this.xyAxisVisible?r$5(this._angleDeferred)&&(this.angle=this._angleDeferred()):i.forEachManipulator((i=>a.push(i.disableDisplay()))),this._handles.remove(u),this._handles.add(a,u);};for(const t of n)this._handles.add(t.events.on("focus-changed",s));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",s)),s();}updateManipulatorInteractivity(){const i=this.grabbing;this.forEachManipulator((a=>{a.interactive=!i&&this._interactive||a.grabbing;}));}static radiusForSymbol(i){const a=r$5(i)&&"point-3d"===i.type&&i.symbolLayers;return !!a&&a.length>0&&a.some((i=>"icon"===i.type))?I:e}}const u="disable-xy-axis-display";

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class h$1 extends t{constructor(i){super(),this._handles=new u$6,this._view=i.view,this._tool=i.tool,this._graphicState=i.graphicState,this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)));}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy();})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null;}forEachManipulator(t){t(this._manipulator,1);}createGraphicDragPipeline(t){return r$1(this._graphicState,t,(t=>this.createDragPipeline(t)),this._view.state.viewingMode)}createDragPipeline(t){const r=this._view,a=this._graphicState.graphic,l=r$5(a.geometry)?a.geometry.spatialReference:null;return m$9(this._manipulator,((i,o,h,p,c)=>{const m=o.next(T(c,r,a,l)).next(q$6()).next(D$8());t(i,m,h,p,c);}))}_createManipulator(){const t=this._view,i=this._graphicState.graphic;this._manipulator=new v$8({graphic:i,view:t,selectable:!0,cursor:"move"});}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class O{constructor(t){this.allGraphics=t,this.type="graphic-move-start";}}class z{constructor(t,e,i){this.dx=t,this.dy=e,this.allGraphics=i,this.type="graphic-move";}}class H{constructor(t){this.allGraphics=t,this.type="graphic-move-stop";}}let X=class extends(a$d(n$a.EventedMixin(c$b))){constructor(t){super(t),this.graphics=new S$7,this.enableZ=!0,this.type="move-3d",this._toolHandles=new u$6,this.snappingPipeline=new c$c;}initialize(){this._toolHandles.add([this.graphics.on("change",(()=>this._refreshManipulators()))]),this._refreshManipulators(),this.complete();}destroy(){this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null);}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const t=this.graphics.toArray().filter((t=>0===t$g(t))).map((t=>new Y$1(t)));t.length&&(this.createManipulators(t),this.createVisualElements(t),this.handles.add(t.map((t=>this.view.trackGraphicState(t.state)))),this.updateMoveManipulation(t));}createManipulators(t){for(const e of t){const i=e.state;e.manipulationXY=new h$1({tool:this,view:this.view,graphicState:i}),e.manipulationXY.forEachManipulator((t=>this.handles.add(t.events.on("immediate-click",(t=>{this.emit("immediate-click",{...t,graphic:i.graphic}),t.stopPropagation();}))))),this.handles.add(e.manipulationXY.createDragPipeline(((e,i,a,n)=>this.buildDragEventPipeline(t,0,e,i,a,n))));}this.createMoveManipulation(t);}createMoveManipulation(t){const e$1=new h$2({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===t.length?h$2.radiusForSymbol(t[0].graphic.symbol):e});this._moveManipulation=e$1,e$1.elevationInfo={mode:"absolute-height",offset:0},e$1.forEachManipulator((t=>{this.handles.add(t.events.on("immediate-click",(i=>{e$1.zManipulation.hasManipulator(t)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation();})));}));const i=()=>this.updateMoveManipulation(t);for(const n of t)this.handles.add([n.state.on("changed",i),n.state.watch("displaying",i)]);const a=t[t.length-1];this.handles.add(a.state.on("changed",(()=>this.updateMoveManipulationAngle(a)))),this.handles.add(e$1.createDragPipeline(((e,i,a,n,o)=>this.buildDragEventPipeline(t,e,i,a,n,o)),s$6(a.graphic),e$5(a.graphic.geometry).spatialReference,a.graphic)),this.updateMoveManipulationAngle(a);}createVisualElements(t){for(const e of t){const i=e.graphic,a=i$2({view:this.view,graphic:i,forEachManipulator:t=>{e.manipulationXY.forEachManipulator(t),this._moveManipulation.forEachManipulator(t);},onManipulatorsChanged:()=>n$c()});t$9(a)||(e.geometryRepresentation=a.visualElement,e.geometryRepresentation instanceof A$2&&this.handles.add([e.geometryRepresentation.events.on("attachment-origin-changed",(()=>{e.state.isDraped||this.updateMoveManipulation(t);})),e.state.watch("isDraped",(()=>this.updateMoveManipulation(t)))]),this.handles.add(a));}}updateMoveManipulationAngle(t){this._moveManipulation.angleDeferred=()=>a$1(t.graphic.geometry);}updateMoveManipulation(t){const e=v$7(0,0,0,this.view.spatialReference);let i=0,a=!1;const n=this._moveManipulation;for(const o of t){if(!o.state.displaying)continue;const t=o.state.graphic;this.enableZ&&t$2(t)&&(a=!0);const n=o.geometryRepresentation instanceof A$2&&!o.state.isDraped?o.geometryRepresentation.attachmentOrigin:O$6(this.view,t);r$5(n)&&(e.x+=n.x,e.y+=n.y,e.z+=n.z,i++);}i>0?(e.x/=i,e.y/=i,e.z/=i,n.location=e,n.xyManipulation.available=!0,n.xyAxisManipulation.available=!0,n.zManipulation.available=a):n.available=!1;}buildDragEventPipeline(t,e,i,a,n,o){const s=[],r=[];let p=null,l=null;const h=()=>{for(const t of s)t.dragging=!1;s.length=0,r.length=0,p=null,l=null,this._moveManipulation.interactive=!0;};if(1===t.length&&0===e){const e=t[0].graphic;a=this.buildSnappingPipelineSteps(e,s$6(e),a,n,o);}const c=a.next((e=>{if("start"===e.action){s.length=0,r.length=0;for(const e of t)e.dragging||!e.manipulationXY.hasManipulator(i)&&e.manipulationXY.grabbing||(s.push(e),r.push(e.graphic),e.dragging=!0);if(0!==r.length&&(this._moveManipulation.interactive=!1,p=S$8(r,this.view.state.viewingMode),l=v$9(r),this.emit("graphic-move-start",new O(r)),this.destroyed))return null}return 0!==r.length?e:null})).next((t=>p(t))).next((t=>{switch(t.action){case"start":case"update":if(t.translationX||t.translationY||t.translationZ){const e=this.view.toScreen(t.mapStart),i=this.view.toScreen(t.mapEnd),a=i.x-e.x,n=i.y-e.y;if(this.emit("graphic-move",new z(a,n,r)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new H(r)),this.destroyed)return null;h();}}));return n.next((t=>l(t))).next((()=>{if(this.emit("graphic-move-stop",new H(r)),this.destroyed)return null;h();})),c}buildSnappingPipelineSteps(t,e,i,a,n){const o=t.geometry;if(t$9(o)||"point"!==o.type&&"mesh"!==o.type)return i;const s=("point"===o.type?o:o.anchor).clone(),p=new e$a({elevationInfo:e,pointer:n,editGeometryOperations:l$c.fromGeometry(s,this.view.state.viewingMode),visualizer:new m$6,excludeFeature:t}),l=this.snappingManager;return i.next((e=>{s.z=f$7(this.view,s,s$6(t),{mode:"absolute-height",offset:0});return {...e,snapOrigin:p.coordinateHelper.pointToVector(s)}})).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:p,snappingManager:l,cancel:a,updatingHandles:this.updatingHandles}),this.snappingPipeline.next)}};e$2([d$7({constructOnly:!0,nonNullable:!0})],X.prototype,"view",void 0),e$2([d$7({readOnly:!0})],X.prototype,"graphics",void 0),e$2([d$7({constructOnly:!0,nonNullable:!0})],X.prototype,"enableZ",void 0),e$2([d$7({constructOnly:!0})],X.prototype,"snappingManager",void 0),e$2([d$7({readOnly:!0})],X.prototype,"type",void 0),e$2([d$7({readOnly:!0})],X.prototype,"updating",null),X=e$2([i$7("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],X);class Y$1{constructor(t){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new e$8({graphic:t});}get graphic(){return this.state.graphic}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function l$1(e,r,o){const n="on-the-ground"===o.mode?1:0;return new z$8(e,n,r,0)}function j(r,o,n){const s=n$6();if(!r.renderCoordsHelper.toRenderCoords(o,s))return null;const c=h(r,o,W$4(n.plane)),i=h(r,o,n.edgeDirection);if(t$9(c)||t$9(i))return null;const u=_$2(n$6(),c,i);return v$4(s,u,p$4())}function h(e,r,o){const n=v$7(r.x+o[0],r.y+o[1],r.z+o[2],r.spatialReference),t=n$6(),c=n$6();return e.renderCoordsHelper.toRenderCoords(r,t)&&e.renderCoordsHelper.toRenderCoords(n,c)?H$2(c,t,c):null}function y$1(e,r,o){const c=W$4(e),i=H$2(n$6(),r,o),p=_$2(n$6(),i,c),m=_$2(n$6(),i,p);return r$j(i[0],i[1],i[2],0,p[0],p[1],p[2],0,m[0],m[1],m[2],0,0,0,0,1)}function C$1(e,n,t){const s=t.projectToRenderScreen(e,x$6()),d=t.projectToRenderScreen(n,x$6());return r$5(s)&&r$5(d)?p$b(c$6(s,s,d)):0}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let ne=class extends(n$a.EventedMixin(d$c)){constructor(e){super(e),this._vertexManipulatorMaterial=d$b(A$3.colorToVec4(A$3.reshapeManipulators.vertex.color),A$3.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=j$7(A$3.colorToVec4(A$3.reshapeManipulators.vertex.outlineColor),A$3.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=j$7(A$3.colorToVec4(A$3.reshapeManipulators.vertex.hoverOutlineColor),A$3.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=d$b(A$3.colorToVec4(A$3.reshapeManipulators.edge.color),A$3.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=j$7(A$3.colorToVec4(A$3.reshapeManipulators.edge.outlineColor),A$3.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=d$b(A$3.colorToVec4(A$3.reshapeManipulators.edgeOffset.color),A$3.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=d$b(A$3.colorToVec4(A$3.reshapeManipulators.edgeOffset.hoverColor),A$3.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=d$b(A$3.colorToVec4(A$3.reshapeManipulators.selected.color),A$3.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=j$7(A$3.colorToVec4(A$3.reshapeManipulators.selected.outlineColor),A$3.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=j$7(A$3.colorToVec4(A$3.reshapeManipulators.selected.hoverOutlineColor),A$3.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new u$6,this._manipulatorInfos=[],this._editGeometryOperations=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=0,this._outlineVisualElement=null,this.tool=null,this.outputGeometry=null,this._snappingPipeline=new c$c,this._snappingPipelineHandle=new c$c,this._vertexLaserLineVisualElement=null;}initialize(){const e=new e$8({graphic:this.graphic});this._graphicState=e,this.handles.add([e.watch("displaying",(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e;})),this.view.trackGraphicState(e)]);}destroy(){this._editGeometryOperations=l$a(this._editGeometryOperations),this._moveManipulation=l$a(this._moveManipulation),this._graphicMoveManipulation=l$a(this._graphicMoveManipulation),this._manipulatorHandles=l$a(this._manipulatorHandles),this.manipulators.removeAll(),this._manipulatorInfos=[],this._resetGrabbingDragging();}get inputGeometry(){return r$5(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e);}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.handle.type));this._removeVertices(e);}manipulatorSelectionChanged(){this.emit("manipulators-changed");}_removeManipulators(){this._moveManipulation=l$a(this._moveManipulation),this._graphicMoveManipulation=l$a(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[];}_resetGrabbingDragging(){this._numGrabbing=0,this._numDragging=0;}_createManipulators(){if(t$9(this._editGeometryOperations))return;const e=s$6(this.graphic);for(const t of this._editGeometryOperations.data.components){for(const i of t.vertices)this._createVertexOrEdgeManipulator(i,e);for(const i of t.edges)this._createVertexOrEdgeManipulator(i,e);}this._createGraphicMoveManipulators(e);}get canRedo(){return r$5(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return r$5(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if(t$9(this._editGeometryOperations))return null;const e=this._editGeometryOperations.redo();return r$5(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if(t$9(this._editGeometryOperations))return null;this.emit("undo");const e=this._editGeometryOperations.undo();return r$5(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._removeManipulators(),this._resetGrabbingDragging(),this._createManipulators();}_recreateEditGeometryAndManipulators(e=this.inputGeometry){this._removeManipulators(),this._resetGrabbingDragging(),t$9(e)||(l$a(this._editGeometryOperations),this._editGeometryOperations=l$c.fromGeometry(e,this.view.state.viewingMode),this._createManipulators());}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return;let i=0;const a=[],n=this._manipulatorInfos.some((e=>"vertex"===e.handle.type&&e.manipulator.selected)),r=1===e&&n;for(const o of this._manipulatorInfos)oe(o)&&(o.manipulator.grabbing||r&&!o.manipulator.selected||a.push(o),i++);if(0===a.length)return;this._moveVertices(a,t);if(a.length===i){if(this._updateEventState(1),this.destroyed)return;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic});}else {if(this._updateEventState(2),this.destroyed)return;this.emit("reshape",{type:"reshape",mover:this.graphic});}}_isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)oe(t)&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(2),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:a}=e;if(!t&&!i&&!a)return;const n=[];for(const r of this._manipulatorInfos)oe(r)&&(r.manipulator.selected&&!r.manipulator.grabbing||r===e.info)&&n.push(r);this._moveVertices(n,e,1),this.emit("reshape",{type:"reshape",mover:this.graphic});}_updateEventState(e){if(e===this._reshapeEventState)return !1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return !1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic});}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic});}}if(this.destroyed)return !1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){if(this._graphicMoveManipulation=new h$1({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic){let e=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((t,i,a)=>{i.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=e$5(this._editGeometryOperations).createUndoGroup()),t))).next((t=>{this._perGraphicManipulatorDragAction(0,t),"end"===t.action&&(e=s$a(e));})),a.next(this._cancelDragOperation((()=>e=s$a(e))));})));}else this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null;}));this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation();}))]))),this._moveManipulation=new h$2({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&t$2(this.graphic),snapToScene:!1,radius:h$2.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((e=>{this.handles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation();}))]);})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const t=e$5(this.graphic.geometry).spatialReference;this.handles.add([this._moveManipulation.createDragPipeline(((t,i,a,n,r)=>{const o=a.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>oe(e)&&e.manipulator.selected));return 1===e.manipulatorType&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:{...e,info:null}})).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:e=>!!e.info,cancel:n,snappingManager:this.tool.snappingManager,snappingContext:new e$a({editGeometryOperations:e$5(this._editGeometryOperations),elevationInfo:e,pointer:r,excludeFeature:this.graphic,visualizer:new m$6}),updatingHandles:this.updatingHandles}),this._snappingPipelineHandle.next).next(q$6()).next((e=>(this._perGraphicManipulatorDragAction(1,e),e)));return n.next(this._cancelDragOperation()),o}),e,t,this.graphic),i$6(this._graphicState,"displaying",(()=>{this._updateMoveManipulationPosition();})),this._graphicState.on("changed",(()=>this._updateMoveManipulationPosition())),i$6(this._graphicState,"isDraped",(()=>{const e="align-move-manipulation";this._graphicState.isDraped?this.handles.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),e):this.handles.remove(e);}))]),this._updateMoveManipulationPosition();const i=i$2({view:this.view,graphic:this.graphic,forEachManipulator:e=>{if(!this.destroyed){r$5(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,1);this._moveManipulation.forEachManipulator(e);}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});r$5(i)&&(this._outlineVisualElement=i.visualElement instanceof A$2?i.visualElement:null),r$5(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition();})),this._graphicState.watch("isDraped",(()=>this._updateMoveManipulationPosition()))]),this._manipulatorHandles.add(i);}_createEdgeOffsetManipulator(e,t=s$6(this.graphic)){const i=A$3.reshapeManipulators.edgeOffset,a=i.size/2,r=a+i.collisionPadding;if(t$9(this._edgeOffsetManipulatorGeometryInside)||t$9(this._edgeOffsetManipulatorGeometryOutside)){const e=a/r,t=e*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=P$7.createExtrudedTriangle(t,e/2,e/2,i.height,i.offset),this._edgeOffsetManipulatorGeometryOutside=P$7.createExtrudedTriangle(-t,e/2,e/2,i.height,-i.offset);}const o=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2}],p=new Y$2({view:this.view,renderObjects:o,elevationInfo:"on-the-ground"!==t.mode||w$3(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:r,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:r$7(0,0,1)},collisionPriority:1}),h=new Y$2({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default"}),d={manipulator:p,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:h,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(d,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(d);const u=this._getManipulatorInfoFromHandle(d.handle.leftVertex).manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(d))),c=this._getManipulatorInfoFromHandle(d.handle.rightVertex).manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(d)));d.locationUpdateHandle=r$f([u,c]),this._manipulatorHandles.add(d.locationUpdateHandle,p),this._manipulatorHandles.add([this._watchAndUpdateGrabState(p,!0),this._watchAndUpdateGrabState(h,!0)],p),this._manipulatorHandles.add(m$9(p,this._createEdgeOffsetPipeline(d,t)),p),this._manipulatorHandles.add(m$9(h,((e,i,a,n)=>{if("touch"===n){this._createEdgeOffsetPipeline(d,t)(e,i,a);}else if(this.enableMoveGraphic){const n=this.graphic,r=r$5(n.geometry)?n.geometry.spatialReference:null;i.next((e=>this._trackNumDragging(e))).next(M$7(this.view,e.elevationAlignedLocation)).next(M(this.view,e.elevationAlignedLocation,t,r,n)).next(D$8()).next(q$6()).next((e=>this._perGraphicManipulatorDragAction(0,e))),a.next(this._cancelDragOperation());}})),p);const m=e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation();};return this._manipulatorHandles.add([p.events.on("immediate-click",m),h.events.on("immediate-click",m)],p),this._manipulatorInfos.push(d),this.manipulators.add(p),this.manipulators.add(h),this.emit("manipulators-changed"),d}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,a=e.edgeManipulator,r=()=>{s$a(e.visibilityHandle);const r=C$1(this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!a.focused||r)&&(i.grabbable=!r,a.grabbable=!r,e.visibilityHandle=r$f([i.disableDisplay(),{remove:()=>{i.grabbable=!0,a.grabbable=this.enableMoveGraphic;}}]));};this._manipulatorHandles.add([i.events.on("focus-changed",r),a.events.on("focus-changed",r),{remove:()=>{s$a(e.visibilityHandle),this.manipulators.remove(a);}}],i),r();}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const t=e$5(this._editGeometryOperations).data.coordinateHelper,i=j(this.view,e.manipulator.elevationAlignedLocation,l$1(t,e.handle,e$5(e.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,n=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,r=r$5(i)?y$1(i,a,n):a$e;e.manipulator.modelTransform=r,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=r;const o=s$8(c$6(pe,a,n))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-o,0,0],[o,0,0]]]};}_createEdgeOffsetPipeline(e,t){return (i,a,n)=>{this._clearSelection();const{step:r,cleanup:o}=this._initializeEdgeOffset(e,t);a.next((e=>this._trackNumDragging(e))).next(M$7(this.view,i.elevationAlignedLocation)).next(r).next(U$1(this.view)).next(q(this.view,e$5(this._editGeometryOperations).data.spatialReference)).next(q$6()).next(this._applyEdgeOffsetStep(e)).next((e=>{"end"===e.action&&o();})),n.next((e=>(o(),e))).next(this._cancelDragOperation());}}_initializeEdgeOffset(e,t){const i=e$5(this._editGeometryOperations),a=l$1(i.data.coordinateHelper,e.handle,t),o=i.createUndoGroup(),s=j(this.view,e.manipulator.elevationAlignedLocation,a);a.requiresSplitEdgeLeft&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge),1),a.requiresSplitEdgeRight&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge),0);const d=()=>new m$a({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:e$5(this._editGeometryOperations).data.spatialReference}),u=new A$2({view:this.view,isDraped:this._graphicState.isDraped,geometry:d(),elevationInfo:e.elevationInfo,width:A$3.visualElements.lineGraphics.outline.width,color:A$3.colorToVec4(s$2.main),attached:!0});let c;const m=()=>{this._cleanEdgeOffsetCollapsedEdges(e),c=s$a(c);},g=this.on("undo",m);return c=r$f([t$e(u),this._graphicState.watch("isDraped",(e=>u.isDraped=e)),this._graphicState.on("changed",(()=>u.geometry=d())),o,g]),{step:e=>t$9(a)||t$9(s)?(m(),null):{...e,operation:a,plane:s},cleanup:m}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||t$9(t.operation))return t;this._updateEventState(2);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:n}=t;return (i||a||n)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_cleanEdgeOffsetCollapsedEdges(e){var t,i;const a=null==(t=e.handle.leftVertex.leftEdge)?void 0:t.leftVertex,n=e.handle.leftVertex,r=null==(i=e.handle.rightVertex.rightEdge)?void 0:i.rightVertex,o=e.handle.rightVertex,s=e$5(this._editGeometryOperations).data.coordinateHelper,l=1e-6,h=[];a&&s.distance(a.pos,n.pos)<l&&h.push(this._getManipulatorInfoFromHandle(n)),(s.distance(n.pos,o.pos)<l||r&&s.distance(r.pos,o.pos)<l)&&h.push(this._getManipulatorInfoFromHandle(o)),h.length&&this._removeVertices(h);}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return {size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e,t=s$6(this.graphic)){if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(t$9(this._vertexManipulatorGeometry)||t$9(this._vertexManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(A$3.reshapeManipulators.vertex);this._vertexManipulatorGeometry=P$7.createSphereGeometry(e,16,16),this._vertexManipulatorOutlineGeometry=P$7.createSphereGeometry(t,16,16);}if(t$9(this._edgeManipulatorGeometry)||t$9(this._edgeManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(A$3.reshapeManipulators.edge);this._edgeManipulatorGeometry=P$7.createSphereGeometry(e,16,16),this._edgeManipulatorOutlineGeometry=P$7.createSphereGeometry(t,16,16);}const i=r$5(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|he.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|he.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|he.Vertex},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}];this.enableMidpoints&&i.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|he.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|he.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|he.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|he.Edge});const a=new Y$2({view:this.view,renderObjects:i,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(a,e,t);const r="edge"===e.type?{manipulator:a,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:a,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(r),this.manipulators.add(a),this._updateManipulatorPosition(r),"edge"===r.type){const e=this._getManipulatorInfoFromHandle(r.handle.leftVertex).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(r))),t=this._getManipulatorInfoFromHandle(r.handle.rightVertex).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(r)));r.locationUpdateHandle=r$f([e,t]),this._manipulatorHandles.add(r.locationUpdateHandle,a);}this._manipulatorHandles.add(this._watchAndUpdateGrabState(a,!0),a);const o=m$9(a,((e,i,a,n)=>{let o=null;i.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&(o=e$5(this._editGeometryOperations).createUndoGroup()),se(r)){const t=this._splitEdgeManipulator(r);return {...e,info:t,snapOrigin:t.handle.pos}}return {...e,info:r,snapOrigin:r.handle.pos}})).next(M$7(this.view,e.elevationAlignedLocation)).next(R(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),cancel:a,snappingManager:this.tool.snappingManager,snappingContext:new e$a({editGeometryOperations:e$5(this._editGeometryOperations),elevationInfo:t,pointer:n,excludeFeature:this.graphic,visualizer:new m$6}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next(q$6()).next((e=>{this._perVertexManipulatorDragAction(e),"end"===e.action&&(o=s$a(o));})),a.next(this._cancelDragOperation((()=>o=s$a(o))));}));return this._manipulatorHandles.add(o,a),this._manipulatorHandles.add([a.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,r))),a.events.on("select-changed",(()=>{r.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition();}))],a),this.emit("manipulators-changed"),r}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--;}return e}_cancelDragOperation(e){return ()=>{switch(this._numDragging--,this.undo(),this.outputGeometry=r$5(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null,r$5(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._reshapeEventState){case 0:break;case 1:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape",mover:this.graphic});}e&&e(),this.destroyed||this._updateEventState(0);}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=he.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=A$3.reshapeManipulators.vertex.size/2+A$3.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=r$5(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=he.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=A$3.reshapeManipulators.edge.size/2+A$3.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==i.mode||w$3(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i;}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>{if("start"===i.action)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==i.pointerType||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((e=>{e.manipulator.interactive=!this._numGrabbing&&r$5(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in e&&(e.edgeManipulator.interactive=!this._numGrabbing);})),e$5(this._graphicMoveManipulation).forEachManipulator((e=>e.interactive=!this._numGrabbing)));}))}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1);}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"));}_removeManipulator(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"));}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(!e)return;const t=e$5(this._editGeometryOperations);if("vertex"===e.handle.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,le),e.manipulator.grabbing&&r$5(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator,a=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator;if(r$5(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const n=i.location,r=a.location,o=.5,s=n.x+o*(r.x-n.x),l=n.y+o*(r.y-n.y),p=n.hasZ&&r.hasZ?0:void 0;e.manipulator.location=v$7(s,l,p,t.data.spatialReference);}else y$6(pe,i.renderLocation,a.renderLocation,.5),e.manipulator.renderLocation=pe;}}_splitEdgeManipulator(e,t=.5){const i=e$5(this._editGeometryOperations),a=e$5(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const n=s$6(this.graphic);let r;this.enableEdgeOffset?(this._removeManipulator(e),r=this._createVertexOrEdgeManipulator(a)):(r=e,r.handle=a,r.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,n)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(r),this._updateSelection(e.manipulator);const o=this._updateEventState(2),s=i.data.coordinateHelper.vectorToArray(r.handle.pos),l=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:s,componentIndex:l,vertexIndex:e$5(a.index)}],added:s}),o&&this._updateEventState(0),r}_updateMoveManipulationPosition(){const e=o$7(pe,0,0,0);let t=0,i=!1,a=null,n=null;for(const r of this._manipulatorInfos)oe(r)&&(r.manipulator.selected?(t++,u$5(e,e,r.manipulator.renderLocation),t$9(a)||r.selectedIndex>a.selectedIndex?(n=a,a=r):(t$9(n)||r.selectedIndex>n.selectedIndex)&&(n=r)):i=!0);if(0!==t){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&t$2(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t;}else {const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&t$2(this.graphic);}if(0!==t){let e=0;if(r$5(a)){const t=a.handle.pos,i=r$5(n)?n.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,r=!r$5(n)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;i&&r?this._moveManipulation.xyAxisManipulation.available=!1:i?e=re(i,t):r&&(e=re(t,r));}this._moveManipulation.angle=e,this._moveManipulation.radius=I;}else this._moveManipulation.angleDeferred=()=>a$1(e$5(this.graphic.geometry)),this._moveManipulation.radius=h$2.radiusForSymbol(this.graphic.symbol);0!==t&&i?(d$8(e,e,1/t),le.spatialReference=e$5(this._editGeometryOperations).data.spatialReference,le.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,le),this._moveManipulation.elevationAlignedLocation=le):r$5(this._outlineVisualElement)&&!this._graphicState.isDraped&&r$5(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:v$a(this.view,this._moveManipulation,this.graphic);}_removeVertices(e){const t=[],i=e$5(this._editGeometryOperations);for(const a of e)if("vertex"===a.handle.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const e=e$5(i.removeVertices([a.handle]).removedVertices[0].createdEdge);e&&this._createVertexOrEdgeManipulator(e);}if(t.length>0){const e=t.map((e=>{const t=i.data.components.indexOf(e.component);return {coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:e$5(e.index)}}));this.outputGeometry=i.data.geometry;const a=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(a&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition();}}_moveVertices(e,t,i=("start"===t.action?0:1)){const a=e$5(this._editGeometryOperations);a.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=a.data.geometry;for(const n of e)this._updateManipulatorPosition(n);}_offsetEdge(e,t){if(t$9(t.operation))return;const i=e$5(this._editGeometryOperations),a=t.operation.clone();a.distance=t.operation.signedDistanceToPoint(t.mapEnd),i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex));}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),se(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation();}};function re(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function oe(e){return "vertex"===e.handle.type}function se(e){return "edge"===e.handle.type}e$2([d$7({constructOnly:!0})],ne.prototype,"tool",void 0),e$2([d$7()],ne.prototype,"inputGeometry",null),e$2([d$7()],ne.prototype,"outputGeometry",void 0),e$2([d$7({readOnly:!0})],ne.prototype,"updating",null),ne=e$2([i$7("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],ne);const le=v$7(0,0,null,null),pe=n$6();var he;!function(e){e.Vertex=16,e.Edge=32;}(he||(he={}));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let m$3=class extends(n$a.EventedMixin(c$b)){constructor(e){super(e),this._handles=new u$6,this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.snappingManager=null,this.automaticManipulatorSelection=!1;}destroy(){this._handles=l$a(this._handles),this._reshapeOperation=l$a(this._reshapeOperation),this._set("view",null),this._set("graphic",null);}get updating(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.updating)&&e}_updateGeometry(){const e=l$d(this.graphic);this._reshapeOperation.inputGeometry=r$5(e)?e.clone():null;}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0!==n$d(this.graphic))return;const e=this.watch("graphic.geometry",(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry();}),!0);this._handles.add(e,"onGraphicGeometryChange");}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged();}_updateGeometryInternally(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1;}_onReshapeGeometryChanged(){t$9(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone());}initialize(){this._reshapeOperation=new ne({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e);})),this._reshapeOperation.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e);})),this._reshapeOperation.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e);})),this._reshapeOperation.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e);})),this._reshapeOperation.on("immediate-click",(e=>this.emit("immediate-click",e))),this.view.on("pointer-down",["Shift"],(e=>{e.stopPropagation();})),i$6(this,"graphic",(()=>{this._updateGraphic();}),!0)]),this.complete();}get canUndo(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canUndo)&&e}undo(){r$5(this.snappingManager)&&this.snappingManager.doneSnapping(),r$5(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone());}get canRedo(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canRedo)&&e}redo(){r$5(this.snappingManager)&&this.snappingManager.doneSnapping(),r$5(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone());}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices();}reset(){}get test(){return {snappingManager:this.snappingManager}}};e$2([d$7()],m$3.prototype,"_reshapeOperation",void 0),e$2([d$7({constructOnly:!0,nonNullable:!0})],m$3.prototype,"view",void 0),e$2([d$7({constructOnly:!0})],m$3.prototype,"graphic",void 0),e$2([d$7({constructOnly:!0,nonNullable:!0})],m$3.prototype,"enableZShape",void 0),e$2([d$7({constructOnly:!0,nonNullable:!0})],m$3.prototype,"enableZVertex",void 0),e$2([d$7({constructOnly:!0,nonNullable:!0})],m$3.prototype,"enableMoveGraphic",void 0),e$2([d$7({constructOnly:!0,nonNullable:!0})],m$3.prototype,"enableMidpoints",void 0),e$2([d$7({constructOnly:!0,nonNullable:!0})],m$3.prototype,"enableEdgeOffset",void 0),e$2([d$7({readOnly:!0})],m$3.prototype,"type",void 0),e$2([d$7({constructOnly:!0})],m$3.prototype,"snappingManager",void 0),e$2([d$7({readOnly:!0})],m$3.prototype,"updating",null),e$2([d$7()],m$3.prototype,"automaticManipulatorSelection",void 0),m$3=e$2([i$7("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],m$3);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var rt;!function(t){t.ScaleIn=32,t.ScaleOut=64,t.RotateLeft=128,t.RotateRight=256,t.Unlocked=1024,t.DelayedFocused=2048,t.TouchInput=32768;}(rt||(rt={}));class st{constructor(e){this.mode=null,this._handles=new u$6,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new n$a,this.getFocused=()=>this.ringManipulator.focused,this.getScale=()=>r$5(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this.adapter.scale:1,this.tool=e.tool,this.mode=e.mode,this.adapter=e.adapter,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform();}get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(t){this.ringManipulator.location=t;}set elevationAlignedLocation(t){this.ringManipulator.elevationAlignedLocation=t;}get grabbing(){return this.ringManipulator.grabbing}set interactive(t){this.ringManipulator.interactive=t;}destroy(){r$5(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=l$a(this._handles),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null;}startAnimation(t){this.cancelActiveAnimation(),t.start();const a=A$6({update:({deltaTime:a})=>{t.update(a)&&this.cancelActiveAnimation();}});this._activeAnimation={...t,frameTask:a};}cancelActiveAnimation(){r$5(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=l$a(this._activeAnimation));}forEachManipulator(t){t(this.ringManipulator,4);}createManipulator(){this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);const t=this.ringManipulator,a=this.tool.graphicState.graphic,s=m$9(t,((t,s,o)=>{this._scaleRotateDragData=null,this.adapter.restart();const n={mode:"none",origin:t$c(t.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=n,this.updateDragState();const l=c$9.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,l),s.next(P$1(this.tool.view,v$4(t.renderLocation,l,p$4()))).next((t=>{const s=W$4(t.plane),o=y$a(t.renderStart,t.renderEnd,n.origin,s),l=S$9.shortestSignedDiff(n.angle,o);n.angleDir=e$6(n.angleDir+l,-q$1,q$1),n.angle=o;const c=ot(n,t),h=c-this.adapter.scale;if(n.scaleDir=e$6(n.scaleDir+h,-m$4,m$4),this.onScaleChanged(),"none"===n.mode){const e=this.mode||nt(t,t.plane,n.origin,this.tool.view.state.camera);if(r$5(e)){switch(e){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:a,angle:0}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:a,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});}n.mode=e;}}switch(n.mode){case"rotate":this.adapter.angle=n.initialAngle+o;break;case"scale":this.adapter.scale=c,this.onScaleChanged();}switch(this.updateDragState(),this.updateManipulatorTransform(),t.action){case"start":case"update":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:a,angle:m$b(n.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:a,xScale:c,yScale:c});}break;case"end":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:a,angle:m$b(n.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:a,xScale:c,yScale:c});}}"end"===t.action&&(this.startAnimation(ct(this,(()=>this.onScaleChanged()))),this._scaleRotateDragData=null,this.updateDragState());})),o.next((()=>{if(this.adapter.cancel(),r$5(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:a,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:a,xScale:1,yScale:1});}this.startAnimation(ct(this,(()=>this.onScaleChanged()))),this._scaleRotateDragData=null,this.updateDragState();}}));}));this._handles.add(s),this._handles.add([this.ringManipulator.events.on("focus-changed",(t=>{"focus"===t.action?this.startAnimation(ht(this,(()=>this.updateDelayedFocusedState()))):this.updateDelayedFocusedState();})),this.ringManipulator.events.on("immediate-click",(t=>{t.stopPropagation();})),i$6(this.tool.graphicState,"displaying",(t=>this.ringManipulator.available=t))]);}onScaleChanged(){this.events.emit("scale-changed"),this.updateManipulatorTransform();}updateDelayedFocusedState(){this.ringManipulator.updateStateEnabled(rt.DelayedFocused,this.getFocused());}updateDragState(){if(this.ringManipulator.updateStateEnabled(rt.Unlocked,!(r$5(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),r$5(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(rt.ScaleIn|rt.ScaleOut,!1),this.ringManipulator.updateStateEnabled(rt.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(rt.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(rt.RotateLeft|rt.RotateRight,!1),this.ringManipulator.updateStateEnabled(rt.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(rt.ScaleOut,this._scaleRotateDragData.scaleDir>=0);}else this.ringManipulator.updateStateEnabled(rt.ScaleIn|rt.ScaleOut|rt.RotateLeft|rt.RotateRight,!1);}updateManipulatorTransform(){const t=r$i(f$5.get()),a=this.adapter.angle;f$6(t,t,a,r$7(0,0,1));const e=this.getScale(),i=q$4(f$5.get(),o$7(c$9.get(),e,e,e)),r=r$i(f$5.get());e$9(r,i,t),this.ringManipulator.modelTransform=r;}createRingManipulator(){const t=(t,a,e)=>{const i=[],r=Math.ceil(a$2*(a-t)/(2*Math.PI));for(let s=0;s<r+1;s++){const o=t+s*(a-t)/r;i.push(r$7(e*Math.cos(o),e*Math.sin(o),0));}return i},a=a=>t(0,2*Math.PI,a),e=t=>[[-t/2,0],[t/2,0],[t/2,i$1/2],[-t/2,i$1/2]],i=(t,a)=>P$7.createPathExtrusionGeometry(e(a),t,[],[],!1),r=a(P$2),s=i(r,l$2),o={left:[],right:[]},n=[];for(let R=0;R<2;R++){const a=R*Math.PI-Math.PI/4,e=Math.PI/2-b$1,r=a+e,s=a+Math.PI/2-e,l=t(r,s,p),c=i(l,n$2);n.push(l),n.push(t(r,s,r$2-l$2/2)),o.left.push(c),o.right.push(c);for(let t=0;t<2;t++){const a=0===t,e=e$4();if(a){i$9(e,e,[1,-1,1]),f$6(e,e,-r,[0,0,1]);const t=Math.round(g$1*(l.length-1));e[12]=l[t][0],e[13]=l[t][1],e[14]=l[t][2];}else {f$6(e,e,s,[0,0,1]);const t=Math.round((1-g$1)*(l.length-1));e[12]=l[t][0],e[13]=l[t][1],e[14]=l[t][2];}const i=P$7.createExtrudedTriangle(s$1,0,x$1,i$1);P$7.transformInPlace(i,e),(a?o.left:o.right).push(i);}}const l=[];for(let h=0;h<2;h++){const a=h*Math.PI-Math.PI/4,e=Math.PI/2-d,r=a+e,s=a+Math.PI/2-e,o=t(r,s,r$2);l.push(i(o,n$2));}const c=a(P$2+j$1),d$1=a(P$2+k$1),g=i(c,n$2),m=i(d$1,n$2),f=a(P$2-j$1),M=a(P$2-k$1),D=i(f,n$2),S=i(M,n$2),y=this.createMaterial(),v=this.createMaterial(.66),b=this.createMaterial(.5),k=this.createMaterial(.33);let _=[{geometry:s,material:y,stateMask:rt.DelayedFocused},{geometry:s,material:b,stateMask:0}];this.mode&&"scale"!==this.mode||(_=_.concat([{geometry:l,material:y,stateMask:rt.DelayedFocused|rt.Unlocked},{geometry:g,material:v,stateMask:rt.DelayedFocused|rt.ScaleIn},{geometry:m,material:k,stateMask:rt.DelayedFocused|rt.ScaleIn},{geometry:D,material:v,stateMask:rt.DelayedFocused|rt.ScaleOut},{geometry:S,material:k,stateMask:rt.DelayedFocused|rt.ScaleOut}])),this.mode&&"rotate"!==this.mode||(_=_.concat([{geometry:o.right,material:y,stateMask:rt.DelayedFocused|rt.Unlocked},{geometry:o.left,material:y,stateMask:rt.DelayedFocused|rt.RotateLeft},{geometry:o.right,material:y,stateMask:rt.DelayedFocused|rt.RotateRight}]));const j=[r,...n];return new Y$2({view:this.tool.view,renderObjects:_,autoScaleRenderObjects:!1,worldOriented:!0,radius:l$2,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:s$6(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:j,direction:r$7(0,0,1)}})}createMaterial(t=1){const a=[...t$1,t];return new h$d({color:a,transparent:1!==t,cullFace:2,renderOccluded:2})}get test(){return {ringManipulator:this.ringManipulator}}}function ot(t,a){const e=c$6(c$9.get(),a.renderStart,t.origin),i=c$6(c$9.get(),a.renderEnd,t.origin),r=s$8(e),s=s$8(i);return 0===r?0:s/r}function nt(t,a,e,i){const{renderStart:r,renderEnd:s}=t,o=lt(r,i,c$9.get()),n=lt(s,i,c$9.get());if(x$7(o,n)<f*f)return null;const l=c$6(c$9.get(),r,e),c=_$2(c$9.get(),l,W$4(a)),h=r,d=u$5(c$9.get(),h,c),g=lt(e,i,c$9.get()),p=o,u=lt(d,i,c$9.get()),m=c$6(c$9.get(),u,p),M=c$6(c$9.get(),o,g),v=j$5(p,m),R=j$5(g,M);return h$e(v,n)<h$e(R,n)?"rotate":"scale"}function lt(t,a,e){return a.projectToScreen(t,dt),o$7(e,dt[0],dt[1],0)}function ct(t,a){let e=null,i=1;const r=()=>i;return {start:()=>{i=t.getScale(),e=t.getScale,t.getScale=r,a();},update:t=>(i+=((i+1)/2-i)*Math.min(t*v,1),a(),Math.abs(i-1)<.01?1:0),destroy:()=>{t.getScale=e,a();}}}function ht(t,a){let e=0,i=null;const r=()=>!1;return {start:()=>{i=t.getFocused,t.getFocused=r,e=0,a();},update:t=>(e+=t,!i()||e>u$1?1:0),destroy:()=>{t.getFocused=i,a();}}}const dt=i$5();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function r(t){return r$5(t.geometry)&&"mesh"===t.geometry.type?o$1(t.geometry):n$1(t)}function o$1(t){return r$5(t.transform)?m$2(t,t.transform):i(t)}function n$1(e){let r=e.geometry,o=n$e;return {undo(e){o=e.geometry,e.geometry=r;},redo(e){r=e.geometry,e.geometry=o;}}}function m$2(t,r){let o=r.clone(),n=null;return {undo:r=>{n=r$5(t.transform)?t.transform.clone():null,t.transform=o,r.notifyGeometryChanged();},redo:r=>{o=r$5(t.transform)?t.transform.clone():null,t.transform=n,r.notifyGeometryChanged();}}}function i(e){let t,r=e.vertexAttributes.clonePositional();return {undo:o=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=r,o.notifyGeometryChanged();},redo:o=>{r=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,o.notifyGeometryChanged();}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let g=class extends d$c{constructor(e){super(e),this.angle=0,this.scale=1,this.initialAngle=0,this.previousAngle=0,this.previousScale=1;}initialize(){this.restart();}restart(){this.handles.remove(m$1);const e=this.geometry.transform;if(this.scale=1,r$5(e)){const t=l$e(e.rotation)[2];Math.abs(t)>.999999&&(this.angle=M$4(v$b(e.rotation))*Math.sign(t));}this.initialAngle=this.angle,this.previousAngle=this.angle,this.previousScale=this.scale,this.handles.add(i$a((()=>({angle:this.angle,scale:this.scale})),(e=>this.update(e)),m$c),m$1);}cancel(){this.scale=1,this.angle=this.initialAngle;}createUndoRecord(){return r(this.graphic)}update({scale:e,angle:t}){const s=this.geometry.anchor,o=1===this.viewingMode;e!==this.previousScale&&(this.geometry.scale(e/this.previousScale,{origin:s,geographic:o}),this.previousScale=e,this.graphic.notifyGeometryChanged()),t!==this.previousAngle&&(this.geometry.rotate(0,0,m$b(t-this.previousAngle),{origin:s,geographic:o}),this.previousAngle=t,this.graphic.notifyGeometryChanged());}};e$2([d$7({constructOnly:!0})],g.prototype,"graphic",void 0),e$2([d$7({constructOnly:!0})],g.prototype,"geometry",void 0),e$2([d$7({constructOnly:!0})],g.prototype,"viewingMode",void 0),e$2([d$7()],g.prototype,"angle",void 0),e$2([d$7()],g.prototype,"scale",void 0),g=e$2([i$7("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],g);const m$1="scale-heading-update-key";

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let y=class extends d$c{constructor(t){super(t),this.angle=0,this.scale=1,this.symbol=null,this.initialAngle=0;}initialize(){this.restart();}restart(){this.handles.remove(m);const t=r$5(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:n$e;if(this.symbol=r$5(t)?t.clone():null,this.initialSizes=[],r$5(t)){const e=this.findLayerView();r$5(e)&&(this.initialSizes=t.symbolLayers.map((i=>"object"===i.type?e.getSymbolLayerSize(t,i):null)).toArray());}this.angle=0,r$5(t)&&t.symbolLayers.some((t=>!("object"!==t.type||!r$5(t.heading))&&(this.angle=-M$4(t.heading),!0))),this.initialAngle=this.angle,this.scale=1,this.handles.add(i$a((()=>({angle:this.angle,scale:this.scale})),(t=>this.updateSymbol(t)),m$c),m);}cancel(){this.graphic.symbol=this.symbol;}createUndoRecord(){let t=this.graphic.symbol,e=null;return {undo:i=>{e=i.symbol,i.symbol=t,this.restart();},redo:i=>{t=i.symbol,i.symbol=e,this.restart();}}}updateSymbol({scale:t,angle:e}){const i=this.graphic.symbol;if(t$9(this.symbol)||t$9(i)||"point-3d"!==i.type)return;const r=i.clone(),h=-m$b(e-this.initialAngle);let c=!1;this.forEachObjectSymbolLayerPair(this.symbol,r,((e,i,s)=>{const r=c$8(e.heading,0)+h;i.heading!==r&&(i.heading=r,c=!0);const a=this.initialSizes[s];if(r$5(a)&&"width"in a){a.width=this.sizeFilter(a.width),a.height=this.sizeFilter(a.height),a.depth=this.sizeFilter(a.depth);const e=a.width*t;i.width!==e&&(i.width=e,c=!0);const s=a.depth*t;i.depth!==s&&(i.depth=s,c=!0);const o=a.height*t;i.height!==o&&(i.height=o,c=!0);}})),c&&(this.graphic.symbol=r);}forEachObjectSymbolLayerPair(t,e,i){t.symbolLayers.forEach(((t,s)=>{const o=e.symbolLayers.getItemAt(s);"object"===t.type&&"object"===o.type&&i(t,o,s);}));}};e$2([d$7()],y.prototype,"angle",void 0),e$2([d$7()],y.prototype,"scale",void 0),e$2([d$7({constructOnly:!0})],y.prototype,"graphic",void 0),e$2([d$7()],y.prototype,"symbol",void 0),e$2([d$7({constructOnly:!0})],y.prototype,"findLayerView",void 0),e$2([d$7({constructOnly:!0})],y.prototype,"sizeFilter",void 0),y=e$2([i$7("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],y);const m="scale-heading-update-key";

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let G$1=class extends(a$d(n$a.EventedMixin(c$b))){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.type="transform-3d",this.scaleRotate=null,this.snappingPipeline=new c$c;}initialize(){this.graphicState=new e$8({graphic:this.graphic}),this.moveManipulation=new h$2({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&t$2(this.graphic),radius:h$2.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((t=>this.handles.add(t.events.on("immediate-click",(t=>{this.emit("immediate-click",{...t,graphic:this.graphicState.graphic}),t.stopPropagation();}))))),this.moveManipulation.elevationInfo=s$6(this.graphic);const t=this.graphic.geometry;if(this.moveManipulation.createGraphicDragPipeline(((e,a,i,n,s)=>(r$5(t)&&0===e&&(i=i.next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new e$a({elevationInfo:s$6(this.graphic),pointer:s,editGeometryOperations:l$c.fromGeometry(new b$8({spatialReference:t.spatialReference}),this.view.state.viewingMode),visualizer:new m$6,excludeFeature:this.graphic}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:n}),this.snappingPipeline.next)),i)),this.graphicState,(t=>{const{action:e,graphic:a,dxScreen:i,dyScreen:o}=t,n={graphic:a,dxScreen:i,dyScreen:o};switch(e){case"start":this.emit("graphic-translate-start",n),this.emit("record-undo",{record:this.createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",n);break;case"end":this.emit("graphic-translate-stop",n);}})),this.moveManipulation.angle=r$5(this.scaleRotate)?this.scaleRotate.angle:0,this.scaleRotateAdapter=this.createScaleRotateAdapter(),this.handles.add(this.scaleRotateAdapter.watch("angle",(()=>this.updateMoveAngle()))),this.enableScaling||this.enableRotation){const t=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new st({tool:this,mode:t,adapter:this.scaleRotateAdapter}),this.handles.add(this.scaleRotate.events.on("scale-changed",(()=>this.onScaleChanged())));}this.handles.add([i$2({view:this.view,graphic:this.graphic,forEachManipulator:t=>this.forEachManipulator(t),onManipulatorsChanged:()=>n$c()}),this.graphicState.on("changed",(()=>this.onGeometryChanged())),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(()=>this.updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged(),this.updateMoveAngle(),this.forEachManipulator((t=>{t instanceof Y$2&&this.handles.add(t.events.on("grab-changed",(()=>this.updateManipulatorsInteractive())));})),this.complete();}updateManipulatorsInteractive(){t$9(this.scaleRotate)||(this.scaleRotate.interactive=!this.moveManipulation.grabbing,this.moveManipulation.interactive=!this.scaleRotate.grabbing);}createScaleRotateAdapter(){return r$5(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new g({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new y({graphic:this.graphic,sizeFilter:t=>this.enforceNonZeroSize(t),findLayerView:()=>this.view.allLayerViews.find((t=>t.layer===this.graphic.layer))})}forEachManipulator(t){this.moveManipulation.forEachManipulator(t),r$5(this.scaleRotate)&&this.scaleRotate.forEachManipulator(t);}hideManipulatorsForGraphicState(){return this.graphicState.watch("displaying",(t=>{this.forEachManipulator((e=>e.available=t)),this.moveManipulation.zManipulation.available=t&&this.enableZ&&t$2(this.graphic);}))}createGeometryUndoRecord(){return r(this.graphic)}destroy(){this.moveManipulation.destroy(),this.scaleRotate=l$a(this.scaleRotate),this.scaleRotateAdapter=l$a(this.scaleRotateAdapter),this._set("view",null),this._set("graphic",null);}set snapToScene(t){this.moveManipulation&&(this.moveManipulation.snapToScene=t),this._set("snapToScene",t);}get updating(){return this.updatingHandles.updating}set location(t){this.moveManipulation.location=t,r$5(this.scaleRotate)&&(this.scaleRotate.location=t);}set elevationAlignedLocation(t){this.moveManipulation.elevationAlignedLocation=t,r$5(this.scaleRotate)&&(this.scaleRotate.elevationAlignedLocation=t);}reset(){}onDetach(){r$5(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation();}onHide(){r$5(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation();}onScaleChanged(){if(t$9(this.scaleRotate))return;const t=this.scaleRotate.getScale();this.moveManipulation.displayScale=t;}updateMoveAngle(){2===this.view.state.viewingMode||this.view.scale<w?this.moveManipulation.angle=this.scaleRotateAdapter.angle:this.moveManipulation.angle=0;}onGeometryChanged(){v$a(this.view,this,this.graphic);}enforceNonZeroSize(t){return t||this.view.state.camera.computeRenderPixelSizeAt(this.moveManipulation.renderLocation)}get test(){return {discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,zManipulator:this.moveManipulation.zManipulation.test.manipulator,ringManipulator:r$5(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}};e$2([d$7({constructOnly:!0,nonNullable:!0})],G$1.prototype,"view",void 0),e$2([d$7({constructOnly:!0,nonNullable:!0})],G$1.prototype,"graphic",void 0),e$2([d$7({constructOnly:!0,nonNullable:!0})],G$1.prototype,"enableZ",void 0),e$2([d$7()],G$1.prototype,"enableRotation",void 0),e$2([d$7()],G$1.prototype,"enableScaling",void 0),e$2([d$7({value:!1})],G$1.prototype,"snapToScene",null),e$2([d$7({constructOnly:!0})],G$1.prototype,"snappingManager",void 0),e$2([d$7({readOnly:!0})],G$1.prototype,"type",void 0),e$2([d$7({readOnly:!0})],G$1.prototype,"updating",null),G$1=e$2([i$7("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],G$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const D="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAACuFBMVEUAAAD/AAD/gAD/VQD/gAD/bQD/gAD/cQD/gAD/dAD/eAD/gAD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fQD/gAD/fQD/fQD/egD/fQD/gAD/fQD/ewD/fQD/gAD/gAD/fQD/gAD/fAD/fgD/fgD/fAD/fgD/fAD/fgD/fAD/fgD/gAD/fAD/fgD/fAD/fQD/fgD/fgD/fQD/fgD/fgD/fQD/fgD/fQD/fQD/fgD/fgD/fQD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fgD/gAL/fgD/gAb/gAT/gwr/gQj/hA7/hAz/hxH/iBP/ixn/iRf/jBz/jR7/jyP/kCX/kyr/lS7/lCz/li//mTT/mTf/nDr/mjn/nTz/n0H/nT//oET/oEL/okf/oEX/o0r/pU3/o0v/pU//qFL/plH/qFX/qFP/qVb/q1n/rV3/rFz/rmD/rl7/sGL/rmH/tW3/s2v/tW//tW7/t3L/tnD/uHT/unb/unn/unf/vHv/vX3/v4D/vX7/w4n/xY3/xIv/x4//xY3/x5H/yZP/x5H/yJP/y5f/yZX/zZv/y5n/zZ3/zJv/z5//z6D/z6H/0aT/0KP/0qb/06j/1av/06r/1q3/1q//17H/2rb/2rb/2rj/3bz/4MH/38D/38H/4sX/4MT/48f/4sb/4sf/5Mr/5s3/5cz/5s3/59D/59D/6dT/6dP/6dT/6tb/6tX/6tf/69n/69j/7dr/7Nn/7dz/7dv/7t3/7t7/7t3/7+H/8eL/8uX/8eP/8+j/8+f/9On/8+j/9Or/9ez/9e3/9ez/9e3/9+//9+7/+PD/9+//+PH/+PD/+fL/+PH/+fT/+vX/+fT/+vb/+vX/+/b/+vb/+/j/+/j//Pr//Pn//fv//v3//vz//fz//fv//v3//fz//////v7//v3///9vf1WOAAAA53RSTlMAAQIDBgcICQoLERIYGRobKCkqKywtLzAxMjM4OTo+P0BAQUVGR0hPUFFSUlNUWlthYmNlZmdoamtvcHR1dnd4eXx9f4CAgYGCgoODhIWGhoeIiYqLjIyNjo+QkJGSkpOTlJSVlpaXmJiZmZqbnJydnZ6eoqKjo6Skpaanp6ipqqqvsLCxsbKzs7S1tbe3uLi5uru8vL2+wMDBwsTGx8jLzc3O0NDR0dLT1dXW19ja2tvc3N3e3t/f4ODh4uLl5ufn6urr6+zt7u7v8PDx8fLy8/P09fX29vf3+Pn6+vv8/Pz8/f3+/v7EBDCzAAADmklEQVR42qXXd3sUVRQG8BNDKkU3KLYUIFkLLBo0yRJNBszuuwQlGISIDUTFhljAhhUbtlXEYEcjoEJUNCqKPXZUUCDU0FvI+RpkZpa5c9iZzMzD7+/d88yde+95z5CbvIIhIyqrtbo6rboyUlKQR4GcGI7GIMSi4QHkU1bRKDgaVZRF3nKGanClDc4hD4Nq0CvtzAzqRd8L4GlkX3IVGg0fxpxMzjLOgk9hx2VkRuBbJNPh/+cjpQnezkuvcC6Q8vVseItkkKTWP6Pr17HwVkbCQFg+YJ4P3U0vtrS1t//c9u6zM+DgFLH/av+m7Gfe1IhpLf+ysmbxVBxrdD4ptvPzDvdY2trNUvfytBLlZDkdloZt3GPvPk5z8K0EpFMpJacWlmTqmdnBd1dBqMkm01BY4n+waTsb1nd0drHl/2kQSsiQpcHyKKd0MP/YfOt4AJfPWtTOKRumw04z+0MRlNV81PezoNz5JZv+boRdIemisMxkS+ck2M3rZMPHskcZ/Q/KR6y8D2HqWjbMh11/IgrDfoiU7lsgXGNW6GgQB1quYPrClk9+WnuITash3WGWfw02VUR5MUCKX3n7w8m3P1z121xIzazbMg5KLJcK4Ntl5vV4EDYhGgz/XmDdcnmWRsC/iQeM1wibYVSBAL5g3WQoF9JFCOBN1t0PpZo0BDCPdU9BqaU6BPAA65JQLglWYDbrFooCGgJ4jHXPiSUEeokvse4hKNXBtnEF624W2xiBf/GN3GP3pVCG0xAIE57+9h64uZd1bbApFpcpMXfFLuaVcLOKdS/DJiSu87UHucfhOb0+wIEmeZ0pCqWVdX+Nh5MJ61i3BDaVsqVhphkCnyaQrt68SYdvhE0pEQ2AzRI2LBuX3k1a2fAe7PoRyTU0/seGb66ANPkHNqxpEG1dBIvhvkNs2PLMWCiJ5FY27LlbBouMNsOTXWz6p/lqmK57fR2buh+HjDYVrsqCLhWmK5cuXvbZBhUVzzuGK+XUwO6J3exs5yMQLs6mlNMg3PY7O/nlBkiDyDISQv2CHXysrckEpHI5ZEmTXpUzyp+vTOx1yHLIp/icN74y927z54vuiiNNiISwc5hNub6pHoo8xNI5CCSS4T5sw/ewLZ1wNnwbnklOyuBPrJRcnKTBhzEDyVV+OTyV5x/fZ98Z5CG7RIOr2pJs8tanMApH0cI+5FP/sqoYhFhVaT8KJDdUHKkwP/8rhhWHct1+dwRTps/cplDIpwAAAABJRU5ErkJggg==";

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
const n={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function o(r){return r.fromData(D,(()=>new b$4(D,n)))}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
class s{constructor(){this.lastDragEvent=null,this.next=new b$6,this._enabled=!1;}get enabled(){return this._enabled}set enabled(a){if(this._enabled!==a&&r$5(this.lastDragEvent)){const t={...this.lastDragEvent,action:"update"};a&&this.adjustScaleFactors(t),this.next.execute(t);}this._enabled=a;}createDragEventPipelineStep(){return this.lastDragEvent=null,t=>(this.lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this.adjustScaleFactors(t),t)}adjustScaleFactors(t){const e=it(t.handle)?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):0===t.handle.direction[0]?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-e:e,t.factor2=t.factor2<0?-e:e;}get test(){return {adjustScaleFactors:t=>this.adjustScaleFactors(t)}}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
function l(s,o){return F(s,o,!1)}function C(s,o){return F(s,o,!0)}function F(s,o,i){if(s instanceof e$b){if(s.operation instanceof t$h)return S(s.operation,o,i),!0;if(s.operation instanceof i$b)return Y(s.operation,o,i),!0;if(s.operation instanceof i$c)return _(s.operation,o,i),!0}return !1}function S(s,o,i=!1){const n=i?-1:1,r=r$7(n*s.dx,n*s.dy,n*s.dz);u$5(o.origin,o.origin,r);}function Y(s,o,i=!1){const n=i?-s.angle:s.angle;R$4(o.basis1,o.basis1,f$8,n),R$4(o.basis2,o.basis2,f$8,n);}function _(o,i,n=!1){const r=n?1/o.factor1:o.factor1,t=n?1/o.factor2:o.factor2;d$8(i.basis1,i.basis1,r),d$8(i.basis2,i.basis2,t),B$3(i.origin,i.origin,o.origin,o.axis1,r),B$3(i.origin,i.origin,o.origin,o.axis2,t);}function G(s,c,b,g){g||(g=G$5());const f=r$9(t$f.get(),s[1],-s[0]),u=r$9(t$f.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),p=r$9(t$f.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),m=t$f.get();c.components.forEach((t=>t.vertices.forEach((t=>{const a=t.pos;r$9(m,j$8(s,a),j$8(f,a)),f$9(u,u,m),M$8(p,p,m);}))));const I=1e-6,d=r$9(t$f.get(),p[0]-u[0]<I?b/2:0,p[1]-u[1]<I?b/2:0);return o$a(u,u,d),s$5(p,p,d),l$7(g.basis1,s,(p[0]-u[0])/2),l$7(g.basis2,f,(p[1]-u[1])/2),r$9(g.origin,u[0]*s[0]+u[1]*f[0],u[0]*s[1]+u[1]*f[1]),s$5(g.origin,g.origin,g.basis1),s$5(g.origin,g.origin,g.basis2),g}function P(s,o,i,n=0,r){r||(r=G$5()),o.toRenderCoords(s.origin,i,r.origin);const t=c$9.get();u$5(t,s.origin,s.basis1),u$5(t,t,s.basis2),o.toRenderCoords(t,i,t);const a=c$9.get();u$5(a,s.origin,s.basis1),c$6(a,a,s.basis2),o.toRenderCoords(a,i,a);const e=c$9.get();c$6(e,s.origin,s.basis1),c$6(e,e,s.basis2),o.toRenderCoords(e,i,e);const b=c$9.get();c$6(b,s.origin,s.basis1),u$5(b,b,s.basis2),o.toRenderCoords(b,i,b);const N=y$6(c$9.get(),t,a,.5);c$6(N,N,r.origin);const j=y$6(c$9.get(),e,b,.5);c$6(j,r.origin,j),y$6(r.basis1,N,j,.5);const T=y$6(c$9.get(),b,t,.5);c$6(T,T,r.origin);const h=y$6(c$9.get(),a,e,.5);c$6(h,r.origin,h),y$6(r.basis2,T,h,.5);const k=_$2(c$9.get(),r.basis1,r.basis2),v=_$2(k,k,r.basis1);return j$4(v,v),d$8(r.basis2,v,z$6(r.basis2,v)),d$8(r.basis1,r.basis1,1+n/s$8(r.basis1)),d$8(r.basis2,r.basis2,1+n/s$8(r.basis2)),K(r),r}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let St=class extends(n$a.EventedMixin(c$b)){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this._preserveAspectRatio=new s,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this.handles=new u$6,this.moveZManipulator=null,this.resizeManipulators=null,this.rotateManipulator=null,this.attachmentOrigin=null,this.outlineVisualElement=null,this.mapBounds=G$5(),this.mapBoundsStart=G$5(),this.displayBounds=G$5(),this.displayBoundsStart=G$5(),this.displayBoundsMarginStart=0,this.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}];}initialize(){this.graphicState=new e$8({graphic:this.graphic});const t=this.graphic.geometry;this.editGeometryOperations=l$c.fromGeometry(t,this.view.state.viewingMode),this.graphicMoveManipulation=new h$1({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this.createMoveXYGraphicDragPipeline()),this.moveZManipulator=st$1(this.view,0),this.moveZManipulator.state|=jt,this.handles.add(this.watch("enableZ",(()=>this.updateManipulatorAvailability(this.moveZManipulator,0)))),this.handles.add(this.createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map((t=>{const e=at(this.view,t);return this.handles.add(this.watch("enableScaling",(()=>this.updateManipulatorAvailability(e,2)))),e.events.on("grab-changed",(t=>this.onResizeGrab(t))),this.handles.add(this.createResizeDragPipeline(e,t)),e})),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=o(this.view.toolViewManager.textures),this.rotateManipulator=ot$1(this.view,this.rotateManipulatorTexture.texture),this.handles.add(this.watch("enableRotation",(()=>this.updateManipulatorAvailability(this.rotateManipulator,3)))),this.rotateManipulator.events.on("grab-changed",(t=>{this.onRotateGrab(t);})),this.handles.add(this.createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds();const e=i$2({view:this.view,graphic:this.graphic,forEachManipulator:t=>this.forEachManipulator(t),onManipulatorsChanged:()=>n$c()});r$5(e)&&(this.outlineVisualElement=e.visualElement instanceof A$2?e.visualElement:null),r$5(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",(()=>this.updateDisplayBounds()))),this.handles.add(e),this.handles.add([this.graphicState.on("changed",(()=>this.onGeometryChanged())),this.graphicState.watch("displaying",(()=>this.updateAllManipulatorAvailability())),i$6(this.graphicState,"isDraped",(()=>this.graphicDrapedChanged())),this.view.trackGraphicState(this.graphicState)]);const i=this.view.pointsOfInterest;i&&this.handles.add(i.centerOnSurfaceFrequent.watch("location",(()=>this.updateDisplayBounds())));const s=t=>{this.handles.add(t.events.on("grab-changed",(()=>{this.grabbing=t.grabbing,this.updateAllManipulatorAvailability();})));};this.forEachManipulator(s);const o$1=(t,e)=>{this.handles.add(t.events.on("immediate-click",(t=>{1===e&&this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation();})));};this.forEachManipulator(o$1),this.onGeometryChanged(),this.updateAllManipulatorAvailability(),this.complete();}graphicDrapedChanged(){this.handles.remove(bt),this.updateDisplayBounds(),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",(t=>{r$5(this.attachmentOrigin)&&F$3(t.extent,this.attachmentOrigin.x,this.attachmentOrigin.y)&&this.updateDisplayBounds();})),bt);}updateAllManipulatorAvailability(){this.forEachManipulator(((t,e)=>this.updateManipulatorAvailability(t,e)));}updateManipulatorAvailability(t,e){const i=this.grabbing&&!t.grabbing;if(t.interactive=!i,t instanceof Y$2){const a=this.graphicState.displaying,s=this.enableZ&&t$2(this.graphic);switch(e){case 3:t.available=a&&this.enableRotation;break;case 2:t.available=a&&(this.enableScaling||this.enableRotation||s),t.interactive=!i&&this.enableScaling,t.state=this.enableScaling?vt:Pt;break;case 0:t.available=a&&s;break;default:t.available=a;}}}forEachManipulator(t){this.graphicMoveManipulation.forEachManipulator(t),this.resizeManipulators.forEach((e=>t(e,2))),t(this.rotateManipulator,3),t(this.moveZManipulator,0);}destroy(){this.rotateManipulatorTexture.release(),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.editGeometryOperations.destroy(),this._set("view",null),this._set("graphic",null);}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(t){this._preserveAspectRatio.enabled=t,this._set("preserveAspectRatio",t);}reset(){}onDetach(){this.mapBounds=null,this.displayBounds=null;}onGeometryChanged(){this.updateDisplayBounds();}calculateMapBounds(){const t=this.graphic.geometry,e=this.editGeometryOperations.data,i=e.components[0].edges[0],a=o$a(t$f.get(),i.leftVertex.pos,i.rightVertex.pos);v$6(a,a);const s=c$8(O$6(this.view,this.graphic),t.extent.center);let r=xt*this.view.pixelSizeAt(s);const n=this.view.spatialReference;n!==t.spatialReference&&(r*=H$3(n)/H$3(t.spatialReference)),G(a,e,r,this.mapBounds);}updateDisplayBounds(){const t=this.graphic.geometry;if(t$9(t))return;const e=r$5(this.outlineVisualElement)&&!this.graphicState.isDraped&&r$5(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:O$6(this.view,this.graphic);this.attachmentOrigin=c$8(e,t.extent.center);const i=r$5(e)?e.z:m$8(this.mapBounds.origin,this.view.elevationProvider,h$a.fromElevationInfo(s$6(this.graphic)),this.view.renderCoordsHelper),a=D$9(this.mapBounds);a.origin[2]=i,P(a,this.view.renderCoordsHelper,t.spatialReference,this.displayBoundsMargin,this.displayBounds),this.updateManipulators();}get displayBoundsMargin(){const t=this.view.pointsOfInterest,e=t?t.centerOnSurfaceFrequent.location:this.editGeometryOperations.data.geometry.extent.center;return Bt*this.view.pixelSizeAt(e)}createMoveXYGraphicDragPipeline(){return this.graphicMoveManipulation.createDragPipeline(((t,e,i)=>this.applyGraphicMoveSteps(e,i)))}createMoveZDragPipeline(){const t=this.view,e=this.editGeometryOperations.data.spatialReference;return m$9(this.moveZManipulator,((i,a,s)=>{const r=t$c(i.renderLocation),o=a.next(A(t,r,e)).next(D$8());this.applyGraphicMoveSteps(o,s);}))}applyGraphicMoveSteps(t,e){const i=t.next((t=>("start"===t.action&&(this.inputState={type:"move"},D$9(this.mapBounds,this.mapBoundsStart),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY})),t))).next(q$6()).next(this.moveDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY};switch(t.action){case"start":case"update":(t.mapEnd.x-t.mapStart.x||t.mapEnd.y-t.mapStart.y||t.mapEnd.z-t.mapStart.z)&&this.emit("graphic-translate",e);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",e);}return t}));return e.next((()=>{r$5(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this.cancel();})),i}moveDragUpdateGeometry(){return t=>{if(t$9(this.inputState)||"move"!==this.inputState.type)return t;const e=[];for(const s of this.editGeometryOperations.data.components)e.push(...s.vertices);const i="start"===t.action?0:1,a=this.editGeometryOperations.moveVertices(e,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i);return l(a,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,t}}onResizeGrab(t){if("start"!==t.action)return;const e=this.calculatePickRay(t.screenPoint);D$7(this.displayBounds.plane,e,c$9.get())&&(D$9(this.displayBounds,this.displayBoundsStart),D$9(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin,this.inputState={type:"resize"});}createResizeDragPipeline(t,e){return m$9(t,((t,i,a)=>{t$9(this.inputState)||(i.next((t=>("start"===t.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),t))).next(P$1(this.view,this.displayBoundsStart.plane)).next((t=>({...t,handle:e}))).next(this.resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this.resizeDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,xScale:t.factor1,yScale:t.factor2};switch(t.action){case"start":case"update":this.emit("graphic-scale",e);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",e);}return t})),a.next((()=>{r$5(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this.cancel();})));}))}resizeDragRenderPlaneToFactors(){return t=>{const e=this.displayBoundsStart,i=t.handle.direction,a=this.displayBoundsMargin,s=this.displayBoundsMarginStart,r=r$6(c$9.get(),e.origin);b$9(r,r,e.basis1,-i[0]),b$9(r,r,e.basis2,-i[1]);const o=c$6(c$9.get(),t.renderEnd,r),n=c$6(c$9.get(),t.renderStart,r),p=it(t.handle),h=tt(e),l=tt(this.displayBounds)/h,c=(t,e)=>{if(0===t)return 1;let i=s$8(e),r=.5*t*z$6(e,o)/i;const h=r<0?-1:1;if(p){r+=(i-.5*t*z$6(e,n)/i)*h*l;}const c=i<1.5*s?1:Gt;return i=Math.max(i-s,Gt),h>0&&(r-=a),h*Math.max(h*(r/i),c)};return {...t,factor1:c(i[0],e.basis1),factor2:c(i[1],e.basis2)}}}resizeDragUpdateGeometry(){return t=>{const e=r$6(n$6(),this.mapBoundsStart.origin);b$9(e,e,this.mapBoundsStart.basis1,-t.handle.direction[0]),b$9(e,e,this.mapBoundsStart.basis2,-t.handle.direction[1]);const i=r$9(n$8(),this.mapBoundsStart.basis1[0],this.mapBoundsStart.basis1[1]);v$6(i,i);const a=[];for(const o of this.editGeometryOperations.data.components)a.push(...o.vertices);const s="start"===t.action?0:1,r=this.editGeometryOperations.scaleVertices(a,e,i,t.factor1,t.factor2,s,1);return D$9(this.mapBoundsStart,this.mapBounds),l(r,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,t}}onRotateGrab(t){if("start"!==t.action)return;const e=Ze(this.displayBounds,this.view.renderCoordsHelper,1,p$4()),i=this.calculatePickRay(t.screenPoint);D$7(e,i,c$9.get())&&(D$9(this.displayBounds,this.displayBoundsStart),D$9(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:e});}createRotateDragPipeline(t){return m$9(t,((t,e,i)=>{const a=this.inputState;t$9(a)||(e.next((t=>("start"===t.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),t))).next(P$1(this.view,a.rotatePlane)).next(this.rotateDragRenderPlaneToRotate(a)).next(this.rotateDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,angle:m$b(t.rotateAngle)};switch(t.action){case"start":case"update":this.emit("graphic-rotate",e);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",e);}return t})),i.next((()=>{r$5(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this.cancel();})));}))}rotateDragRenderPlaneToRotate(t){return e=>{const i=W$4(t.rotatePlane),a=y$a(e.renderStart,e.renderEnd,this.displayBounds.origin,i);return {...e,rotateAxis:i,rotateAngle:a}}}rotateDragUpdateGeometry(){return t=>{const e=r$6(n$6(),this.mapBoundsStart.origin),i=[];for(const r of this.editGeometryOperations.data.components)i.push(...r.vertices);const a="start"===t.action?0:1,s=this.editGeometryOperations.rotateVertices(i,e,t.rotateAngle,a,1);return D$9(this.mapBoundsStart,this.mapBounds),l(s,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,t}}calculatePickRay(t){const e=d$6(),i=d$a(t);return s$7(this.view.state.camera,i,e),j$4(e.direction,e.direction),e}updateManipulators(){if(!this.visible)return;const t=We(this.displayBounds,f$5.get());Qe(this.rotateManipulator,t,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,t),this.resizeManipulators.forEach(((e,i)=>{Ke(e,this.resizeHandles[i],t,this.displayBounds);}));}updateZMoveHandle(t,e){const i=this.displayBounds,a={basis:i.basis1,direction:-1,position:c$6(c$9.get(),i.origin,i.basis1),edge:2},s=f$5.get();m$d(s,e,a.edge*Math.PI/2),s[12]=0,s[13]=0,s[14]=0,t.modelTransform=s,t.renderLocation=a.position;}cancel(){const t=this.editGeometryOperations.lastOperation;t$9(t)||(this.editGeometryOperations.undo(),this.graphic.geometry=this.editGeometryOperations.data.geometry,C(t,this.mapBounds),this.updateDisplayBounds(),this.inputState=null);}get canUndo(){return this.editGeometryOperations.canUndo}undo(){if(r$5(this.inputState))this.view.activeTool=null;else if(this.canUndo){const t=this.editGeometryOperations.undo();this.graphic.geometry=this.editGeometryOperations.data.geometry,C(e$5(t),this.mapBounds),this.updateDisplayBounds();}}get canRedo(){return this.editGeometryOperations.canRedo}redo(){if(this.canRedo){const t=this.editGeometryOperations.redo();this.graphic.geometry=this.editGeometryOperations.data.geometry,l(e$5(t),this.mapBounds),this.updateDisplayBounds();}}get test(){return {resizeManipulators:this.resizeManipulators,rotateManipulator:this.rotateManipulator,moveZManipulator:this.moveZManipulator}}};e$2([d$7({constructOnly:!0,nonNullable:!0})],St.prototype,"view",void 0),e$2([d$7({constructOnly:!0,nonNullable:!0})],St.prototype,"graphic",void 0),e$2([d$7({constructOnly:!0,nonNullable:!0})],St.prototype,"enableZ",void 0),e$2([d$7()],St.prototype,"enableRotation",void 0),e$2([d$7()],St.prototype,"enableScaling",void 0),e$2([d$7()],St.prototype,"preserveAspectRatio",null),e$2([d$7()],St.prototype,"grabbing",void 0),e$2([d$7()],St.prototype,"inputState",void 0),e$2([d$7({readOnly:!0})],St.prototype,"type",void 0),St=e$2([i$7("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],St);const bt="draped-elevation-changes",Bt=10,xt=80,Gt=1e-6;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/

const editingTools = /*#__PURE__*/Object.freeze({
	__proto__: null,
	get DrawGraphicTool3D () { return y$3; },
	get GraphicMoveTool () { return X; },
	get GraphicReshapeTool () { return m$3; },
	get GraphicTransformTool () { return G$1; },
	get ExtentTransformTool () { return St; }
});

export { a$5 as a, editingTools as e, l$3 as l, o$5 as o };
