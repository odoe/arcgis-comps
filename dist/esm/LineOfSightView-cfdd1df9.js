import { e, d as d$1, i as i$1, p, D as l, dD as p$1, C as l$1, af as t$1, A as r$1, r as n$4, u as u$1, aE as b$1, aW as c$1, bN as r$2, cq as a, cu as F, bd as g$1, cp as n$5, bo as s$3, cR as n$6, S as S$2, ai as l$4, bp as o } from './messageBundle-f75b4090.js';
import { l as l$3, a as a$1 } from './HandleOwner-88326c19.js';
import { e as e$3 } from './AnalysisView3D-b50a297f.js';
import './geometry-7e07b1ba.js';
import { i as i$3, p as p$3, m as m$4 } from './reactiveUtils-8f9c3a3d.js';
import { r, d as d$3, a as j, u, z, c, J, S as S$1, a9 as g$2 } from './mathUtils-e16f9389.js';
import { n as n$2, b as t$2, e as e$1 } from './common-d5b993de.js';
import { d as bn } from './projection-f3d8779d.js';
import { j as j$1, B as B$1 } from './aaBoundingRect-9468599b.js';
import { m as m$2, l as l$2, p as p$2, d as d$4 } from './sphere-c3d60863.js';
import { d as d$2 } from './screenUtils-9bb7e30c.js';
import { t } from './vectorStacks-9205ea46.js';
import { O } from './dehydratedFeatures-7a1dd0b3.js';
import { s as s$2 } from './CameraSpace.glsl-6a9b6d21.js';
import { A as n$3, m as m$3 } from './arcgis-webscene-b45ae58e.js';
import { y, i as i$2 } from './ColorMaterial-cf44e08d.js';
import { D, f } from './Scheduler-3464f717.js';
import { h } from './Color-d1b9b54f.js';
import { e as e$2 } from './mat4f64-677a419d.js';
import { m as m$5 } from './LineVisualElement-7e3bfc5b.js';
import './index-b157fcf2.js';
import './unitUtils-38774114.js';
import './mat4-f34c6460.js';
import './geodesicConstants-54cb88d4.js';
import './vec4f64-2ec4ac08.js';
import './quatf64-b9feea68.js';
import './vec2f64-35868783.js';
import './byteSizeEstimations-b3396570.js';
import './aaBoundingBox-876621e6.js';
import './quantizationUtils-e08f723c.js';
import './jsonUtils-13b1f6fd.js';
import './Field-bfaa8af9.js';
import './enumeration-d3301938.js';
import './fieldType-66a19d8a.js';
import './vec2-5672471e.js';
import './Texture-1e5e4be2.js';
import './mat3-6a23d9ad.js';
import './quat-2d7a417b.js';
import './vec3f32-109cf143.js';
import './Texture-f0375c04.js';
import './FramebufferObject-3d2e79da.js';
import './BlendLayer-38b8abf7.js';
import './colorUtils-37750ea3.js';
import './Util-68fde664.js';
import './utils-c65673fb.js';
import './doublePrecisionUtils-68dc07e3.js';
import './geometryDataUtils-7e4c8d4a.js';
import './lineSegment-4881dbd9.js';
import './BufferView-35ef10d7.js';
import './OrderIndependentTransparency-3e6c26be.js';
import './DefaultUI-022795b8.js';
import './Basemap-409fdf8e.js';
import './Portal-c5cfa317.js';
import './loadAll-9b2a160e.js';
import './asyncUtils-fe35d349.js';
import './PortalItem-155284f3.js';
import './writeUtils-04a97640.js';
import './compilerUtils-848c8917.js';
import './opacityUtils-5e864561.js';
import './CollectionFlattener-2d3512bc.js';
import './basemapUtils-d3dee4db.js';
import './TablesMixin-95a0923b.js';
import './Layer-b50ea610.js';
import './Identifiable-da047c47.js';
import './TimeExtent-a024c0d8.js';
import './GraphicsCollection-58a35288.js';
import './Graphic-3961df6c.js';
import './PopupTemplate-6e5ecad2.js';
import './symbols-b414aa72.js';
import './Symbol-cad56b52.js';
import './persistableUrlUtils-40bbec67.js';
import './HeightModelInfo-1a6d7a08.js';
import './screenUtils-49015526.js';
import './executeQueryJSON-97747696.js';
import './utils-ab350511.js';
import './query-87b92407.js';
import './normalizeUtils-25a1ce55.js';
import './pbfQueryUtils-18f884ce.js';
import './pbf-6bd45926.js';
import './OptimizedFeature-44d5df5b.js';
import './OptimizedFeatureSet-27736f1f.js';
import './queryZScale-f42386f8.js';
import './zscale-faf9ffc2.js';
import './Query-d6335b3a.js';
import './FeatureSet-58481609.js';
import './TopFeaturesQuery-cc717439.js';
import './Heading-960a88b2.js';
import './widget-c014d189.js';
import './QueryTask-23c14fd1.js';
import './featureConversionUtils-cbd79ea2.js';
import './Task-21abc82a.js';
import './FeatureLayer-91daf6b1.js';
import './UniqueValueRenderer-3c55992d.js';
import './VisualVariablesMixin-0befdf7b.js';
import './colorRamps-22c88e98.js';
import './ColorStop-d4fc22fe.js';
import './sizeVariableUtils-4d3662df.js';
import './visualVariableUtils-26c41ea6.js';
import './lengthUtils-f033d4fe.js';
import './diffUtils-849b3672.js';
import './jsonUtils-ade233cd.js';
import './styleUtils-cb28c5ef.js';
import './DictionaryRenderer-bea76550.js';
import './LRUCache-d5842b88.js';
import './MemCache-78a9f000.js';
import './jsonUtils-aa645e92.js';
import './MultiOriginJSONSupport-cb4804f4.js';
import './workers-c4ad1958.js';
import './APIKeyMixin-d7a9a0ad.js';
import './ArcGISService-49a9bda6.js';
import './arcgisLayerUrl-49ef2818.js';
import './CustomParametersMixin-758e21ed.js';
import './labelingInfo-1bb19962.js';
import './OperationalLayer-d609e521.js';
import './ElevationInfo-be94499b.js';
import './LabelClass-47fb4a25.js';
import './labelUtils-8999bd11.js';
import './defaultsJSON-0b68054b.js';
import './OrderedLayer-7fa2fd9d.js';
import './PortalLayer-290979fa.js';
import './RefreshableLayer-f4d1c27c.js';
import './ScaleRangeLayer-584ce37b.js';
import './TemporalLayer-5a7f466a.js';
import './TimeInfo-44dec2e0.js';
import './FeatureType-aa59abbf.js';
import './fieldProperties-d7b323c6.js';
import './FieldsIndex-2a111e7e.js';
import './LayerFloorInfo-c2959bac.js';
import './styleUtils-61c488eb.js';
import './popupUtils-c3247ec1.js';
import './utils-c84cc443.js';
import './ItemCache-5d2cf877.js';
import './utils-f8425723.js';
import './Queue-a7e7a3e5.js';
import './layerViewUtils-4127a8cf.js';
import './GoTo-148cc420.js';
import './accessibleHandler-feb312a0.js';
import './vmEvent-6b909beb.js';
import './heightModelInfoUtils-b573abf5.js';
import './Viewpoint-f60966b5.js';
import './mathUtils-8e5ad7fe.js';
import './mat2d-13076132.js';
import './mat2df32-93736424.js';
import './mat2df64-30d0a354.js';
import './vec2f32-29d55de5.js';
import './capabilities-ffdc19e3.js';
import './originUtils-a479af22.js';
import './multiOriginJSONSupportUtils-984fb5af.js';
import './Viewing-639f1e51.js';
import './TileInfo-052b02b9.js';
import './saveUtils-503e6a55.js';
import './resourceUtils-ff309ca6.js';
import './scaleUtils-70512275.js';
import './Thumbnail-cf2b8bad.js';
import './Version-9295fea2.js';
import './boundedPlane-030abe8d.js';
import './plane-f3c19202.js';
import './ElevationSampler-301a577f.js';
import './objectResourceUtils-46d77106.js';
import './devEnvironmentUtils-9331429c.js';
import './vec33-df10f43c.js';
import './DefaultMaterial_COLOR_GAMMA-f230b01e.js';
import './types-c8f64c05.js';
import './InterleavedLayout-4358b016.js';
import './glUtil-240efd97.js';
import './LayerView3D-ad87e12d.js';
import './earcut-05cd758b.js';
import './triangulationUtils-501cc2c4.js';
import './deduplicate-c3c4ee02.js';
import './intersectorUtils-8d04b3d1.js';
import './callExpressionWithFeature-e06d2f0b.js';
import './MeshComponent-3b6a4fdf.js';
import './screenshotUtils-f9728729.js';
import './projection-5f2268ed.js';
import './RenderingContext-c805bbcc.js';
import './floatRGBA-7e1629d8.js';
import './labelFormatUtils-4a5ae67f.js';
import './vec4f32-d544d091.js';
import './geometryServiceUtils-ba2d6c3e.js';
import './project-a5d2456b.js';
import './LercDecoder-35d1826d.js';
import './WorkerHandle-a0a39e87.js';
import './VectorTile-7c020d07.js';
import './config-768959de.js';
import './TiledDisplayObject-ec3aafee.js';
import './DisplayObject-d9d14391.js';
import './TileKey-284eee69.js';
import './LayerView-f319a853.js';
import './rasterUtils-da611f50.js';
import './quatf32-a39c89f4.js';
import './EdgeProcessingWorker-7a107dc2.js';
import './hitTestSelectUtils-779b69ca.js';
import './debugFlags-e9d86cce.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let i=class extends p{constructor(t){super(t),this.elevationAlignedTargetLocation=null,this.inputPoints={isValid:!1,observer:n$2(),observerSurfaceNormal:null,target:n$2(),targetSurfaceNormal:null,observerAdjusted:n$2(),targetAdjusted:n$2()},this.computationResult={start:n$2(),end:n$2(),intersection:n$2(),isValid:!1,isTargetVisible:!1},this.result=null;}updateComputationResults(){this.notifyChange("computationResult");}updateInputPoints(){this.notifyChange("inputPoints");}onElevationChange(){this.notifyChange("elevationAlignedTargetLocation");}};e([d$1()],i.prototype,"target",void 0),e([d$1()],i.prototype,"elevationAlignedTargetLocation",void 0),e([d$1()],i.prototype,"inputPoints",void 0),e([d$1()],i.prototype,"computationResult",void 0),e([d$1()],i.prototype,"result",void 0),i=e([i$1("esri.views.3d.analysis.LineOfSight.LineOfSightAnalysis")],i);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
var m$1;let n$1=m$1=class extends p{clone(){return new m$1({type:this.type,id:l(this.id),point:l(this.point),normal:l(this.normal),ray:l(this.ray)})}equals(o){return this.type===o.type&&this.id===o.id&&p$1(this.point,o.point)&&l$1(this.normal,o.normal)&&m$2(this.ray,o.ray)}};e([d$1()],n$1.prototype,"type",void 0),e([d$1()],n$1.prototype,"id",void 0),e([d$1()],n$1.prototype,"point",void 0),e([d$1()],n$1.prototype,"normal",void 0),e([d$1()],n$1.prototype,"ray",void 0),n$1=m$1=e([i$1("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],n$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let R=class extends p{constructor(e){super(e);}initialize(){this.intersector=new y(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=0;}getScreenPointIntersection(e){const t$1=d$2(e,t.get()),r=s$2(this.view.state.camera,t$1,T);return this._getRayIntersection(r)}_getRayIntersection(e){if(t$1(e))return null;this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,this.intersector);const t=this.intersector.results.min,o=S;if(!t||!t.getIntersectionPoint(o))return null;const i=this.view.renderCoordsHelper.fromRenderCoords(o,this.view.spatialReference),n=n$2();r(n,t.normal);const m=z(n,e.direction)>0?-1:1;d$3(n,n,m);const l=n$3(t,this.view);if(r$1(l)){const r=l.layer,s=l.sourceLayer;let o;if(s)switch(s.type){case"scene":o=O(l,s.objectIdField);break;case"integrated-mesh":{const e=t.target;o=`${e.metadata.nodeIndex}/${e.metadata.componentIndex}`;break}default:o=l.uid;}else o=l.uid;return new n$1({type:"Graphic",id:`${r.uid}/${o}`,ray:l$2(e),normal:n,point:i})}if("TerrainRenderer"===t.intersector){const r=t.target.metadata.tile.lij.slice();return new n$1({type:"Terrain",id:r,ray:l$2(e),normal:n,point:i})}return null}_canUpdateFromIntersectionResult(e,t){if(t$1(e)||!t||e.type!==t.type)return !1;switch(e.type){case"Terrain":{const r=e.id,s=t.id;return r[0]===s[0]&&r[1]===s[1]&&r[2]===s[2]||m$3(r,s)}case"Graphic":case"I3S":return e.id===t.id}}updateFromIntersectionResult(e){let t;if("Terrain"===e.type&&r$1(e.point)){const r=S,s=U$1,o=C$1;this.view.renderCoordsHelper.toRenderCoords(e.point,s),this.view.renderCoordsHelper.worldUpAtPosition(s,o);const i=this.view.basemapTerrain.elevationBounds,n=this.view.renderCoordsHelper.getAltitude(s),a=i?Math.abs(i.max-i.min)/Math.abs(n):100,c=n>0?1:-1;j(o,o),d$3(o,o,c*a),u(r,s,o),p$2(r,s,T),t=this._getRayIntersection(T);}else t=this._getRayIntersection(e.ray);return this._canUpdateFromIntersectionResult(t,e)?t.point:null}};e([d$1()],R.prototype,"view",void 0),e([d$1()],R.prototype,"intersector",void 0),R=e([i$1("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],R);const S=n$2(),U$1=n$2(),C$1=n$2(),T=d$4();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s$1=class extends p{constructor(o){super(o),this.target=null,this.intersectedGraphic=null,this.intersectedLocation=null,this.elevationAlignedTargetLocation=null;}};e([d$1()],s$1.prototype,"target",void 0),e([d$1()],s$1.prototype,"intersectedGraphic",void 0),e([d$1()],s$1.prototype,"intersectedLocation",void 0),e([d$1()],s$1.prototype,"elevationAlignedTargetLocation",void 0),e([d$1()],s$1.prototype,"visible",void 0),s$1=e([i$1("esri.views.3d.analysis.LineOfSight.LineOfSightResult")],s$1);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let U=class extends(n$4.EventedMixin(p)){constructor(e){super(e),this._updatingHandles=new l$3,this._frameTask=D,this._handles=new u$1,this._analysisHandles=new u$1;}initialize(){var e;const t=null==(e=this.view.resourceController)?void 0:e.scheduler;t&&(this._frameTask=t.registerTask(f.LINE_OF_SIGHT_TOOL)),this._handles.add([this._connectObserver(),this._connectAnalyses(),this._connectTargets()]),this._intersector=new R({view:this.view});}destroy(){this._handles.destroy(),this._analysisHandles.destroy(),this._analyses.removeAll(),this._updatingHandles.destroy();}get updating(){return this._frameTask.updating||this._updatingHandles.updating}get priority(){return this._frameTask.priority}set priority(e){this._frameTask.priority=e;}get _analyses(){return this.analysisViewData.analyses}get _observerEngineLocation(){return this.analysisViewData.observerEngineLocation}set _observerEngineLocation(e){this.analysisViewData.observerEngineLocation=e;}get _screenPixelSize(){return this.view.state.camera.computeScreenPixelSizeAt(this._observerEngineLocation)}getLineOfSightComputationDependencies(e){const{inputPoints:t}=e;return {inputPoints:t}}computeAnalysis(e){const t=e.analysis,{inputPoints:s,computationResult:n}=t,{observerAdjusted:i,targetAdjusted:r$1}=s,{start:o,end:a}=n;r(o,i),r(a,r$1);this._canComputeAnalysis(t)?this._computeAnalysisIntersection(e):this._interpolateAnalysisIntersection(e),t.updateComputationResults(),this.emit("result-changed",{target:e.analysis.target,result:t.result});}_adjustStartEndPositions(e){const t=this._screenPixelSize,s=this.view,{inputPoints:n}=e,{observer:i,observerSurfaceNormal:r$2,target:a,targetSurfaceNormal:l,observerAdjusted:c$1,targetAdjusted:h}=n,p=W;r$1(r$2)?r(p,r$2):c(p,a,i);const d=t;j(p,p),d$3(p,p,Math.min(d,1)),u(c$1,i,p),r$1(l)?r(p,l):c(p,i,a);const g=s.state.camera.computeScreenPixelSizeAt(a);j(p,p),d$3(p,p,Math.min(g,1)),u(h,a,p);}_computeAnalysisIntersection({analysis:e,interpolationInfo:t}){const{view:s}=this,{sceneIntersectionHelper:n,renderCoordsHelper:i}=s;if(t$1(n))return;const r$2=this._intersector.intersector,{computationResult:l,inputPoints:c}=e,{observer:h,target:p}=c,{start:d,end:g}=l,u=p$2(d,g,Z);n.intersectToolIntersectorRay(u,r$2);const y=l.intersection,m=W,_=!!r$2.results.min&&r$2.results.min.getIntersectionPoint(y);let v=!0;if(_){r(t.originalIntersection,y),r(t.originalObserver,d),r(t.originalTarget,g),i.fromRenderCoords(y,m,s.spatialReference);const e=1-S$1(g,p)/S$1(d,p);v=S$1(h,y)>=e*S$1(h,p);}const A=new b$1(m,s.spatialReference);{const{result:t,target:n}=e;r$1(t)?(t.target=n,t.intersectedGraphic=v?null:n$3(r$2.results.min,s),t.intersectedLocation=v?null:A,t.visible=!!_&&v):e.result=new s$1({target:n,elevationAlignedTargetLocation:e.elevationAlignedTargetLocation,intersectedGraphic:v?null:n$3(r$2.results.min,s),intersectedLocation:v?null:A,visible:!!_&&v});}l.isValid=c.isValid=!0,l.isTargetVisible=v;}_interpolateAnalysisIntersection({analysis:e,interpolationInfo:t}){const{computationResult:s,inputPoints:n}=e,{start:i,end:r$1,intersection:o}=s,{originalIntersection:a,originalObserver:l,originalTarget:c}=t;if(r(o,a),n.isValid){const e=W,t=S$1(l,a)/S$1(l,c);J(e,i,l),d$3(e,e,1-t),u(o,o,e),J(e,r$1,c),d$3(e,e,t),u(o,o,e),s.isValid=!0;}else e.result=new s$1,s.isValid=!1,s.isTargetVisible=!1;}_canComputeAnalysis(e){const t=this.analysisViewData.elevationAlignedObserver,s=this.view.frustum;if(t$1(t)||t$1(e.target)||t$1(s))return !1;const{observerAdjusted:n,targetAdjusted:i}=e.inputPoints,r=s.intersectsPoint(n),o=s.intersectsPoint(i);return r&&o}_onObserverChange(e){if(t$1(e))return this.analysis.targets.removeAll(),void(this.analysisViewData.elevationAlignedObserver=null);this.analysisViewData.elevationAlignedObserver=this._applyElevationAlignment(e,this.analysis.intersection);const t=n$2();this.view.renderCoordsHelper.toRenderCoords(this.analysisViewData.elevationAlignedObserver,t),this._observerEngineLocation=t,this.priority=f.LINE_OF_SIGHT_TOOL_INTERACTIVE;}_applyElevationAlignment(e,t){if(e.hasZ&&(t$1(t)||"Graphic"===t.type))return e;const s=e.clone();return s.z=c$1(i$2(this.view.elevationProvider,s),0),s}_onObserverChangeForAnalysis(e){e.inputPoints.isValid=!1;}_onObserverEngineForAnalysis(e,t,s){const{inputPoints:n}=e;if(r(n.observer,t),r$1(s)){const e=this._intersector.updateFromIntersectionResult(s);r$1(e)&&this.view.renderCoordsHelper.toRenderCoords(e,n.observer),n.observerSurfaceNormal=t$2(s.normal);}else n.observerSurfaceNormal=null;this._adjustStartEndPositions(e),e.updateInputPoints(),this.priority=f.LINE_OF_SIGHT_TOOL_INTERACTIVE;}_onTargetLocationChange(e,t,s){const n=e.inputPoints;if(n.isValid=!1,r$1(t)){if(e.elevationAlignedTargetLocation=this._applyElevationAlignment(t,s),this.view.renderCoordsHelper.toRenderCoords(e.elevationAlignedTargetLocation,n.target),r$1(s)){const e=this._intersector.updateFromIntersectionResult(s);r$1(e)&&this.view.renderCoordsHelper.toRenderCoords(e,n.target),n.targetSurfaceNormal=t$2(s.normal);}else n.targetSurfaceNormal=null;this._adjustStartEndPositions(e),e.updateInputPoints();}this.priority=f.LINE_OF_SIGHT_TOOL_INTERACTIVE;}_connectAnalysisToTarget(e){return i$3((()=>({analysis:e,targetLocation:e.target.location,targetIntersection:e.target.intersection})),(({analysis:e,targetLocation:t,targetIntersection:s})=>{r$1(t)&&this._onTargetLocationChange(e,t,s);}),p$3)}_connectAnalysisToObserver(e){return i$3((()=>({analysis:e,observer:this.analysisViewData.elevationAlignedObserver})),(({analysis:e})=>{this._onObserverChangeForAnalysis(e);}),p$3)}_connectAnalysisToObserverEngine(e){return i$3((()=>({analysis:e,observer:this._observerEngineLocation,observerIntersection:this.analysis.intersection})),(({analysis:e,observer:t,observerIntersection:s})=>{this._onObserverEngineForAnalysis(e,t,s);}),p$3)}_connectAnalysisToCamera(e){return i$3((()=>({camera:this.view.state.camera,isDirty:this._isCameraDirty})),(({isDirty:t})=>{e.inputPoints.isValid&&!t||e.updateInputPoints();}),m$4)}_connectAnalysisToElevation(e){return this.view.elevationProvider.on("elevation-change",(t=>{if(!this._canComputeAnalysis(e))return;const s=this.analysis.observer;M(t.extent,t.spatialReference,s)&&this._onObserverChange(s);const n=e.target;r$1(n)&&M(t.extent,t.spatialReference,n.location)&&e.onElevationChange();}))}_connectAnalysisForCompute(e){let t=n$6;const s={analysis:e,interpolationInfo:{originalIntersection:n$2(),originalObserver:n$2(),originalTarget:n$2()}};return r$2([i$3((()=>this.getLineOfSightComputationDependencies(e)),(()=>{t=a(t),t=F((async e=>{await g$1(this._frameTask.schedule((()=>this.computeAnalysis(s)),e));}));}),p$3),n$5((()=>t=a(t)))])}_connectAnalysis(e){const t=this._analysisHandles;t.has(e)||t.add([this._connectAnalysisToTarget(e),this._connectAnalysisToObserver(e),this._connectAnalysisToObserverEngine(e),this._connectAnalysisToCamera(e),this._connectAnalysisToElevation(e),this._connectAnalysisForCompute(e)]);}_disconnectAnalysis(e){this._analysisHandles.remove(e);}_onAnalysesCollectionChange(e){e.added.forEach((e=>this._connectAnalysis(e))),e.removed.forEach((e=>this._disconnectAnalysis(e)));}_onTargetsChange(){return this._analyses.removeAll(),this.analysis.targets.forEach((e=>this._addTarget(e))),this._updatingHandles.addOnCollectionPropertyChange(this.analysis,"targets",(e=>this._onTargetCollectionChange(e)))}_onTargetCollectionChange(e){e.added.forEach((e=>this._addTarget(e))),e.removed.forEach((e=>this._removeTarget(e)));}_onCursorTargetChange(e,t){r$1(t)&&this._removeTarget(t),r$1(e)&&this._addTarget(e);}_addTarget(e){this._analyses.some((t=>t.target===e))||this._analyses.add(new i({target:e}));}_removeTarget(e){const t=this._analyses.find((t=>t.target===e));this._analyses.remove(t);}_connectObserver(){return r$2([i$3((()=>this.analysis.observer),(e=>this._onObserverChange(e)),p$3)])}_connectAnalyses(){let e=null;return r$2([i$3((()=>this._analyses),(()=>{s$3(e),e=this._updatingHandles.addOnCollectionPropertyChange(this,"_analyses",(e=>this._onAnalysesCollectionChange(e))),this._analyses.forEach((e=>this._connectAnalysis(e)));}),p$3),n$5((()=>e=s$3(e)))])}_connectTargets(){let e=null;return r$2([i$3((()=>this.analysis.targets),(()=>{e=s$3(e),e=this._onTargetsChange();}),p$3),i$3((()=>this.analysisViewData.cursorTarget),((e,t)=>{this._onCursorTargetChange(e,t);})),n$5((()=>{e=s$3(e);}))])}get _isCameraDirty(){const e=this.analysisViewData.elevationAlignedObserver,{view:t}=this,{renderCoordsHelper:s}=t;if(t$1(e)||t$1(s))return !1;const n=W;s.toRenderCoords(e,n);const i=t.state.camera.computeScreenPixelSizeAt(n);return Math.abs((i-this._screenPixelSize)/this._screenPixelSize)>B}};function M(e,t,s){return !t$1(s)&&(bn(e,t,q,s.spatialReference),j$1(q,s))}e([d$1({constructOnly:!0})],U.prototype,"analysis",void 0),e([d$1({constructOnly:!0})],U.prototype,"analysisViewData",void 0),e([d$1({constructOnly:!0})],U.prototype,"view",void 0),e([d$1()],U.prototype,"updating",null),e([d$1()],U.prototype,"priority",null),e([d$1()],U.prototype,"_analyses",null),e([d$1()],U.prototype,"_observerEngineLocation",null),e([d$1()],U.prototype,"_screenPixelSize",null),e([d$1({readOnly:!0})],U.prototype,"_updatingHandles",void 0),e([d$1()],U.prototype,"_frameTask",void 0),e([d$1()],U.prototype,"_isCameraDirty",null),U=e([i$1("esri.views.3d.analysis.LineOfSight.LineOfSightController")],U);const B=.1,W=n$2(),Z=d$4(),q=B$1();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let s=class extends p{constructor(o){super(o),this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new h([3,252,111,1]),this.visibleOuterColor=new h([3,252,111,.15]),this.occludedInnerColor=new h([252,3,69,1]),this.occludedOuterColor=new h([252,3,69,.1]),this.undefinedInnerColor=new h([255,255,255,1]),this.undefinedOuterColor=new h([127,127,127,.2]);}};e([d$1({type:Number})],s.prototype,"innerWidth",void 0),e([d$1({type:Number})],s.prototype,"outerWidth",void 0),e([d$1({type:h})],s.prototype,"visibleInnerColor",void 0),e([d$1({type:h})],s.prototype,"visibleOuterColor",void 0),e([d$1({type:h})],s.prototype,"occludedInnerColor",void 0),e([d$1({type:h})],s.prototype,"occludedOuterColor",void 0),e([d$1({type:h})],s.prototype,"undefinedInnerColor",void 0),e([d$1({type:h})],s.prototype,"undefinedOuterColor",void 0),s=e([i$1("esri.views.3d.analysis.LineOfSight.LineOfSightConfiguration")],s);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let n=class extends p{constructor(){super(...arguments),this.analyses=new S$2,this.elevationAlignedObserver=null,this.configuration=new s,this.observerEngineLocation=n$2(),this.cursorTarget=null;}};e([d$1()],n.prototype,"analyses",void 0),e([d$1()],n.prototype,"elevationAlignedObserver",void 0),e([d$1({type:s})],n.prototype,"configuration",void 0),e([d$1()],n.prototype,"observerEngineLocation",void 0),e([d$1()],n.prototype,"cursorTarget",void 0),n=e([i$1("esri.views.3d.analysis.LineOfSight.LineOfSightLayerViewData")],n);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let g=class extends p{constructor(i){super(i),this._handle=null,this._analysisHandles=new u$1;}initialize(){this._handle=this._connectAnalyses();}destroy(){this._handle=s$3(this._handle),this._analysisHandles=l$4(this._analysisHandles);}get visible(){return this.analysisView.visible&&!this.analysisView.suspended}get _analyses(){return this.analysisView.analysisViewData.analyses}get _configuration(){return this.analysisView.analysisViewData.configuration}get _opacity(){return this.analysisView.fullOpacity}createLineOfSightVisualization(){const i=this._configuration,t=this._opacity,n={view:this.view,attached:!0,width:i.outerWidth,innerWidth:i.innerWidth},o=h.toUnitRGBA(i.visibleOuterColor);g$2(o,o,t);const s=h.toUnitRGBA(i.visibleInnerColor);g$2(s,s,t);const r=h.toUnitRGBA(i.occludedOuterColor);g$2(r,r,t);const a=h.toUnitRGBA(i.occludedInnerColor);g$2(a,a,t);const c=h.toUnitRGBA(i.undefinedOuterColor);g$2(c,c,t);const u=h.toUnitRGBA(i.undefinedInnerColor);g$2(u,u,t);return {visibleLineVisualElement:new m$5({...n,color:o,innerColor:s}),occludedLineVisualElement:new m$5({...n,color:r,innerColor:a}),undefinedLineVisualElement:new m$5({...n,color:c,innerColor:u})}}destroyLineOfSightVisualization(i){i.visibleLineVisualElement=l$4(i.visibleLineVisualElement),i.occludedLineVisualElement=l$4(i.occludedLineVisualElement),i.undefinedLineVisualElement=l$4(i.undefinedLineVisualElement);}updateLineOfSightVisualization(i,t){const n=this.visible,o=this._configuration,{computationResult:s,inputPoints:r}=i,{start:a,end:c$1,intersection:u,isValid:d,isTargetVisible:m}=s,{observer:h$1}=r,p=L;p[12]=h$1[0],p[13]=h$1[1],p[14]=h$1[2];const v=c(_,a,h$1),V=c(b,c$1,h$1),g=c(C,u,h$1),{visibleLineVisualElement:O,occludedLineVisualElement:A,undefinedLineVisualElement:E}=t;if(!n)return O.visible=!1,A.visible=!1,void(E.visible=!1);if(O.visible=!0,A.visible=!0,E.visible=!0,O.geometry=null,A.geometry=null,E.geometry=null,d)if(m){O.geometry=[[e$1(v),e$1(V)]],O.transform=p;const i=h.toUnitRGBA(o.visibleOuterColor);O.color=g$2(i,i,this._opacity);}else {O.geometry=[[e$1(v),e$1(g)]],O.transform=p;const i=h.toUnitRGBA(o.occludedOuterColor);O.color=g$2(i,i,this._opacity),A.geometry=[[e$1(g),e$1(V)]],A.transform=p;}else E.geometry=[[e$1(v),e$1(V)]],E.transform=p;}updateVisualizationOpacity(i,t){const n=this._configuration,o=this._opacity,s=h.toUnitRGBA(n.visibleOuterColor);g$2(s,s,o);const r=h.toUnitRGBA(n.visibleInnerColor);g$2(r,r,o);const a=h.toUnitRGBA(n.occludedOuterColor);g$2(a,a,o);const c=h.toUnitRGBA(n.occludedInnerColor);g$2(c,c,o);const u=h.toUnitRGBA(n.undefinedOuterColor);g$2(u,u,o);const d=h.toUnitRGBA(n.undefinedInnerColor);g$2(d,d,o),t.visibleLineVisualElement.color=i.computationResult.isTargetVisible?s:a,t.visibleLineVisualElement.innerColor=r,t.occludedLineVisualElement.color=a,t.occludedLineVisualElement.innerColor=c,t.undefinedLineVisualElement.color=u,t.undefinedLineVisualElement.innerColor=d;}getLineOfSightVisualizationDependencies(i){const{computationResult:e}=i,{occludedOuterColor:t,visibleOuterColor:n}=this._configuration;return {computationResult:e,occludedOuterColor:t,visibleOuterColor:n,visible:this.visible}}_connectAnalysis(i){const e=this._analysisHandles;if(e.has(i))return;const t=this.createLineOfSightVisualization();e.add([i$3((()=>this.getLineOfSightVisualizationDependencies(i)),(()=>this.updateLineOfSightVisualization(i,t)),p$3),i$3((()=>this._opacity),(()=>this.updateVisualizationOpacity(i,t)),m$4),n$5((()=>this.destroyLineOfSightVisualization(t)))],i);}_disconnectAnalysis(i){this._analysisHandles.remove(i);}_connectAnalyses(){let i=null;return r$2([i$3((()=>this._analyses),(e=>{i=s$3(i),i=e.on("change",(i=>this._onAnalysesCollectionChange(i))),this._onAnalysesCollectionChange({target:e,added:e.items,removed:[],moved:[]});}),p$3),n$5((()=>i=s$3(i)))])}_onAnalysesCollectionChange(i){i.added.forEach((i=>this._connectAnalysis(i))),i.removed.forEach((i=>this._disconnectAnalysis(i)));}};e([d$1({constructOnly:!0})],g.prototype,"analysis",void 0),e([d$1({constructOnly:!0})],g.prototype,"analysisView",void 0),e([d$1({constructOnly:!0})],g.prototype,"view",void 0),e([d$1({readOnly:!0})],g.prototype,"visible",null),e([d$1()],g.prototype,"_analyses",null),e([d$1()],g.prototype,"_configuration",null),e([d$1()],g.prototype,"_opacity",null),g=e([i$1("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],g);const _=n$2(),b=n$2(),C=n$2(),L=e$2();

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
let d=class extends(e$3(a$1(n$4.EventedMixin(p)))){constructor(s){super(s),this.type="line-of-sight-view",this.suspended=!1,this.fullOpacity=1,this.analysisViewData=new n;}initialize(){const s=this.view,t=this.analysis;this._analysisController=new U({analysis:t,analysisViewData:this.analysisViewData,view:s}),this._analysisVisualization=new g({analysis:t,analysisView:this,view:s}),this.handles.add([this._analysisController.on("result-changed",(s=>{s.target!==this.analysisViewData.cursorTarget&&this.emit("result-changed",s);}))]);}destroy(){this._analysisController=l$4(this._analysisController),this._analysisVisualization=l$4(this._analysisVisualization);}get results(){return this.analysisViewData.analyses.map((s=>s.result))}get priority(){return this._analysisController.priority}set priority(s){this._analysisController.priority=s;}get updating(){return r$1(this._analysisController)&&this._analysisController.updating}getResultForTarget(s){const t=this.analysisViewData.analyses.find((t=>t.target===s)),i=o(t,(s=>s.result));return c$1(i,null)}get test(){return {visualization:this._analysisVisualization,controller:this._analysisController}}};e([d$1()],d.prototype,"type",void 0),e([d$1()],d.prototype,"analysis",void 0),e([d$1({readOnly:!0})],d.prototype,"results",null),e([d$1()],d.prototype,"priority",null),e([d$1()],d.prototype,"suspended",void 0),e([d$1()],d.prototype,"fullOpacity",void 0),e([d$1()],d.prototype,"analysisViewData",void 0),e([d$1()],d.prototype,"updating",null),e([d$1()],d.prototype,"_analysisController",void 0),e([d$1()],d.prototype,"_analysisVisualization",void 0),d=e([i$1("esri.views.3d.analysis.LineOfSight.LineOfSightView")],d);const m=d;

export default m;
